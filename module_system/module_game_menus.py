# -*- coding: cp1254 -*-
from header_game_menus import *
from header_parties import *
from header_items import *
from header_mission_templates import *
from header_music import *
from header_terrain_types import *

#SB : optional menu toggles
from header_triggers import key_left_shift, key_right_shift
from module_constants import *

#from compiler import *
####################################################################################################################
#  (menu-id, menu-flags, menu_text, mesh-name, [<operations>], [<options>]),
#
#   Each game menu is a tuple that contains the following fields:
#
#  1) Game-menu id (string): used for referencing game-menus in other files.
#     The prefix menu_ is automatically added before each game-menu-id
#
#  2) Game-menu flags (int). See header_game_menus.py for a list of available flags.
#     You can also specify menu text color here, with the menu_text_color macro
#  3) Game-menu text (string).
#  4) mesh-name (string). Not currently used. Must be the string "none"
#  5) Operations block (list). A list of operations. See header_operations.py for reference.
#     The operations block is executed when the game menu is activated.
#  6) List of Menu options (List).
#     Each menu-option record is a tuple containing the following fields:
#   6.1) Menu-option-id (string) used for referencing game-menus in other files.
#        The prefix mno_ is automatically added before each menu-option.
#   6.2) Conditions block (list). This must be a valid operation block. See header_operations.py for reference.
#        The conditions are executed for each menu option to decide whether the option will be shown to the player or not.
#   6.3) Menu-option text (string).
#   6.4) Consequences block (list). This must be a valid operation block. See header_operations.py for reference.
#        The consequences are executed for the menu option that has been selected by the player.
#
#
# Note: The first Menu is the initial character creation menu.
####################################################################################################################

game_menus = [
("start_game_0",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Welcome to Aut Caesar aut nihil",
  "none",[
    (allow_ironman,0),#no save without quite
    (assign, "$difficulty_type", camp_d2),	#beginner
    (assign, "$g_gore_on", 0), # gore
    (assign, "$g_charge_on", 0), # charge animation
    (assign, "$use_player_auxiliary", 1), # player respawn after death
    (assign, "$g_autoloot_active", 1), # autoloot
    (assign, "$g_realistic_wounding", 0), # troops get wounded during battle instead of dead
    (assign, "$vc_wounds_on", 0), # player may get wounded
    (assign, "$moralep_on", 0), # resting moral effect
    (assign, "$g_body_guard_on", 1), # body guards
    (assign, "$g_allow_curb_power", 0), # curb power war goal
    (assign, "$g_schield_bash", 0), # AI uses shieldbash
    (assign, "$g_governor_appointment_message", 1), # message governor/lord gets a center notification
    (assign, "$show_truce_expired", 0), # message truce expired
    (assign, "$show_raid_messages", 0), # message raid
    (assign, "$g_love_messages_on", 1), # message love affair
    (assign, "$g_show_senate_meeting", 1), # message senate meeting
    (assign, "$g_report_enemies", 0), # message enemy spotted
    (assign, "$g_display_gift", 0), # message lord recieves gift
    (options_set_damage_to_player, 0),	#0 = 1/4, 1 = 1/2, 2 = 1/1
    (options_set_damage_to_friends, 0),	#0 = 1/2, 1 = 3/4, 2 = 1/1
    (options_set_combat_ai, 2),		#0 = good, 1 = average, 2 = poor
    (options_set_campaign_ai, 2),	#0 = good, 1 = average, 2 = poor
    (options_set_combat_speed, 0),	#0 = slowest, 1 = slower, 2 = normal, 3 = faster, 4 = fastest
    (assign, reg60, 1),
    (start_presentation, "prsnt_vc_options"),
  ],[
  ("go_back",[],"Go back",[
    (change_screen_quit),
  ]),
]),

("start_phase_2",mnf_disable_all_keys,
  "{s30}",
  "none",[
    (try_begin),
        (this_or_next|eq, "$g_campaign_type", g_campaign_king),
        (this_or_next|eq, "$g_campaign_type", g_campaign_lord),
        (eq, "$g_campaign_type", g_campaign_sandbox),
        (jump_to_menu, "mnu_auto_return_map"),
    (else_try),
        (eq, "$g_is_emperor", 1),
        (str_store_string, s30, "str_start_emperor_1"),
        (assign, "$g_do_one_more_meeting_with_merchant", 3),
        (quest_set_slot, "qst_town_trade", slot_quest_menu_1, 1),
        ##senate system
        (troop_set_slot, "trp_senator_dummy", slot_senate_next_meeting, 4),##in 4 days
        (troop_set_slot, "trp_senator_dummy", slot_senate_support,40),##support
  	(else_try),
        (str_store_string, s30, "str_start_slave_1"),
        ##senate system
        (troop_set_slot, "trp_senator_dummy", slot_senate_next_meeting, 4),##in 4 days
        (troop_set_slot, "trp_senator_dummy", slot_senate_support, 0),##support
	  (try_end),
],[
  ("beggar",[
    (eq, "$g_campaign_type", g_campaign_story_rome),
	  (is_between, "$guard_god", 1, 7),
	  (neq, "$g_is_emperor", 1),
	  (eq, "$current_startup_quest_phase", 0),
  ],"Continue.",[
    (assign, "$current_town", "p_town_6"),
    (assign, "$g_starting_town", "$current_town"),
    (troop_set_slot, "trp_player", slot_troop_renown, 20),

    (set_show_messages, 0),
    (troop_add_item, "trp_player", "itm_club"),
    (troop_add_item, "trp_player", "itm_roman_poor2"),
    (troop_add_item, "trp_player", "itm_graves_simple_2"),
    # (troop_add_item, "trp_player", "itm_stones"),
    (troop_equip_items, "trp_player"),
    (set_show_messages, 1),
    #0 player
    #1-12 other slaves
    #13, 14, 15, 18 guards
    #16 master, 17 daughter of master
    #19, 20, 21 servants/other civilians
    #(jump_to_menu, "mnu_start_phase_3"),
    (assign, "$temp", 0),
    (assign, "$talk_context",tc_mission_1_talk),
    (set_jump_mission,"mt_starting_mission"),
    (modify_visitors_at_site,"scn_starting_villa"),
    (reset_visitors, 0),
    (set_visitor,0,"trp_player"), #player
    (try_for_range, ":entry", 1, 13),
        (store_random_in_range, ":number", 1, 4),
        (set_visitors, ":entry", "trp_slave", ":number"),
    (try_end),
    (set_visitors, 13, "trp_vigilia",1),
    (set_visitors, 14, "trp_vigilia",1),
    (set_visitors, 15, "trp_vigilia", 2),
    (set_visitors, 18, "trp_vigilia",2),
    (set_visitors, 16, "trp_guest",1),
    (set_visitors, 17, "trp_guest_female",1),
    (set_visitors, 19, "trp_roman_town_walker",3),
    (set_visitors, 20, "trp_roman_town_walker_female",2),
    (set_visitors, 21, "trp_roman_town_walker_female",1),
    (jump_to_scene,"scn_starting_villa"),
    (change_screen_mission),
  ]),
]),

("start_game_3",mnf_disable_all_keys,
  "Choose your scenario:",
  "none",[
    (assign, "$g_custom_battle_scenario", 0),
    (assign, "$g_custom_battle_scenario", "$g_custom_battle_scenario"),
  ],[
  ("go_back",[],"Go back",[
    (change_screen_quit),
  ]),
]),

("tutorial",mnf_disable_all_keys,
  "Disabled feature.",
   "none",[
  ],[
  ("go_back_dot",[
  ],"Go back.",[
    (change_screen_quit),
  ]),
]),

("reports",mnf_enable_hot_keys,
  "Nothing",
  "none",[
    (try_begin),
      (eq,"$temp",6), #waiting, building, exit
      (assign,"$temp",0), #waiting, building, exit
      (change_screen_map),
    (else_try),
      (start_presentation, "prsnt_character_report"),
    (try_end),
  ],[
  ("resume_travelling",[
  ],"Resume travelling.",[
    (change_screen_return),
  ]),
]),

("custom_battle_scene",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "(NO_TRANS)",
  "none",[
  ],[
  ("quick_battle_scene_1",[],"{!}quick_battle_scene_1",[
    (set_jump_mission,"mt_ai_training"),
    (jump_to_scene,"scn_quick_battle_scene_1"),(change_screen_mission)
  ]),
  ("quick_battle_scene_2",[],"{!}quick_battle_scene_2",[
    (set_jump_mission,"mt_ai_training"),
    (jump_to_scene,"scn_quick_battle_scene_2"),(change_screen_mission)
  ]),
  ("quick_battle_scene_3",[],"{!}quick_battle_scene_3",[
    (set_jump_mission,"mt_ai_training"),
    (jump_to_scene,"scn_quick_battle_scene_3"),(change_screen_mission)
  ]),
  ("quick_battle_scene_4",[],"{!}quick_battle_scene_4",[
    (set_jump_mission,"mt_ai_training"),
    (jump_to_scene,"scn_quick_battle_scene_4"),(change_screen_mission)
  ]),
  ("quick_battle_scene_5",[],"{!}quick_battle_scene_5",[
    (set_jump_mission,"mt_ai_training"),
    (jump_to_scene,"scn_quick_battle_scene_5"),(change_screen_mission)
  ]),
  ("go_back",[],"{!}Go back",[
    (change_screen_quit),
  ]),
]),

("custom_battle_end",mnf_disable_all_keys,
  "The battle is over. {s1} Your side killed {reg5} enemies and lost {reg6} troops over the battle. You personally slew {reg7} men in the fighting.",
  "none",[
    (music_set_situation, 0),
    (assign, reg5, "$g_custom_battle_team2_death_count"),
    (assign, reg6, "$g_custom_battle_team1_death_count"),
    (get_player_agent_kill_count, ":kill_count"),
    (get_player_agent_kill_count, ":wound_count", 1),
    (store_add, reg7, ":kill_count", ":wound_count"),
    (try_begin),
      (eq, "$g_battle_result", 1),
      (str_store_string, s1, "str_battle_won"),
      (set_background_mesh, "mesh_pic_defeat"),
    (else_try),
      (str_store_string, s1, "str_battle_lost"),
      (set_background_mesh, "mesh_pic_victory"),
    (try_end),
  ],[
  ("continue",[],"Continue...",[
    (change_screen_quit),
  ]),
]),

("start_game_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Roman, remember that you shall rule the nations by your authority, for this is to be your skill, to make peace the custom, to spare the conquered,^"
  +"and to wage war until the haughty are brought low.^ Virgil, Aeneid^^"+
  "Fortuna offers you three different clothes: a purple robe, a simple toga or an old and smelly tunic. You take the tunic.",
  "none",[
    (set_background_mesh, "mesh_pic_elysium"),
  ],[
  ("continue",[],"Fortes fortuna adiuvat!",[
    (start_presentation, "prsnt_intro"),
  ]),
  ("go_back",[],"Go back",[
    (assign, reg60, 1),
    (start_presentation, "prsnt_vc_options"),
  ]),
]),

("start_game_sandbox",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "This service is currently not available.",
  "none",[
    (try_begin),
        (this_or_next|eq, "$g_campaign_type", g_campaign_lord),
        (eq, "$g_campaign_type", g_campaign_king),
        (assign, "$temp_troop", -1),
        (start_presentation, "prsnt_select_kingdom"),
    (else_try),
        (eq, "$g_campaign_type", g_campaign_sandbox),
        (assign, "$background_answer_4", "fac_culture_1"),
        (start_presentation, "prsnt_mcc_character_creation"),
    (try_end),
  ],[
  ("emperor_cheat",[],"Go back",[
    (change_screen_quit),
  ]),
]),

("start_game_11",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Exit?",
  "none",[
    (change_screen_quit),
  ],[
]),

("choose_attribute_1",mnf_disable_all_keys,
  "At your birth, the gods blessed you ...",
  "none",[
    (set_background_mesh, "mesh_pic_girls"),
    (assign, reg11, "$character_gender"), #SB : every string now uses reg11 for daughter/son boy/girl etc
  ],[
    ("agility",[],"... Ceres gave you (sexual) potency.",[
      (assign, "$guard_god", cb_ceres),
      (display_message, "@Ceres guards you!", color_good_news),
      (jump_to_menu,"mnu_choose_skill"),
    ]),
    ("agility",[],"... Diana gave you agility.",[
      (assign, "$guard_god", cb_diana),
      (display_message, "@Diana guards you!", color_good_news),
      (jump_to_menu,"mnu_choose_skill"),
    ]),
    ("mind",[],"... Minerva gave you a sharp mind.",[
      (assign, "$guard_god", cb_minerva),
      (display_message, "@Minerva guards you!", color_good_news),
      (jump_to_menu,"mnu_choose_skill"),
    ]),
    ("strength",[],"... Mars gave you strength.",[
      (assign, "$guard_god", cb_mars),
      (display_message, "@Mars guards you!", color_good_news),
      (jump_to_menu,"mnu_choose_skill"),
    ]),
    ("knowledge",[],"... Mercurius gave you knowledge.",[
      (assign, "$guard_god", cb_mercurius),
      (display_message, "@Mercurius guards you!", color_good_news),
      (jump_to_menu,"mnu_choose_skill"),
    ]),
    ("charisma",[],"... Jupiter gave you the will to power.",[
      (assign, "$guard_god", cb_jupiter),
      (display_message, "@Jupiter guards you!", color_good_news),
      (jump_to_menu,"mnu_choose_skill"),
    ]),

    ("go_back",[],"Go back.",[
      (jump_to_menu,"mnu_start_game_1"),
    ]),
]),

("choose_skill",mnf_scale_picture|mnf_disable_all_keys,
  "{s25}",
  "none",[
    (try_begin),
        (eq, "$g_campaign_type", g_campaign_story_rome),
        (set_background_mesh, "mesh_pic_yourbirth"),
        (try_begin),
            (eq, "$character_gender", tf_male),
            (call_script, "script_get_character_name_for_troop", "$character_gender", "fac_culture_7"),
            (troop_set_name, "trp_player", s12),
            (troop_set_plural_name, "trp_player", s12),
        (else_try),
            (troop_set_name, "trp_player", "@Julia"),
            (troop_set_plural_name, "trp_player", "@Julia"),
        (try_end),
        (str_store_string, s25, "@You never knew your birth parents.^^The man you would later call father found you screaming loudly in a reed basket, floating along the Tiber. It was only with great effort that he managed to get you out of the water and pull you to the safe shore.^^He and his wife no longer had children of their own. The last one died just a few days earlier as an infant in the crib. They interpreted your appearance as a divine sign and adopted you as their {reg11?daughter:son}. They gave you a new home and their love. ^^Your father was Magister Ludi. He taught you to read and write. You received your first trading lessons from the woman who became your mother. You helped her in your little street business and when there wasn't anyone willing to buy your goods, you looked for other ways to get the much-needed money out of other people's pockets.^^So you went begging until you learned how to cut wallets and how to pick locks. Despite everything, you were spared suffering and illness and had an overall pleasant childhood. Nevertheless, you always had the feeling that life had to have more in store for you.^^When you grew up everything changed. First your parents told you how they found you in the Tiber and adopted you.^^You immediately tried to find out more about your origins, but your search was unsuccessful, although not unnoticed. You searched the banks of the Tiber upstream for clues or witnesses, but nobody remembered anything or knew a story of a child abandoned in the river. In the taverns you were promised answers for money, but while your money was real, the answers you hoped for were fictional. Just when you were about to give up your search, you got knowledge of an old slave who was said to have been in the service of an influential family for some time. With newly gained hope you made your way to her, but instead of the longed-for answers you only found her fresh grave. Deeply dejected, you got drunk in a tavern that evening. ^^That very night your parents were robbed and murdered in their home. Tormented by your grief at having lost your parents, again, you looked for their murderers. When you finally found them, you mercilessly slayed them all. However, you were surprised in the act and arrested by the Vigilia to be sold into slavery."),
    (else_try),
        (this_or_next|eq, "$g_campaign_type", g_campaign_king),
        (this_or_next|eq, "$g_campaign_type", g_campaign_sandbox),
        (eq, "$g_campaign_type", g_campaign_lord),
        (str_store_string, s25, "@You have made some choices. You will not be able to change them later after the game starts. Would you like to keep them and continue?"),
        (try_begin),
            (neq, "$g_campaign_type", g_campaign_sandbox),
            (eq, "$background_type", cb_noble),
            (neg|troop_slot_ge, "trp_player", slot_troop_banner_scene_prop, 1),
            (assign, "$g_presentation_next_presentation", -1),
            (assign, "$g_edit_banner_troop", "trp_player"),
            (start_presentation, "prsnt_banner_selection"),
        (try_end),
        (try_begin),
            (is_edit_mode_enabled),
            (display_message, "@WARNING: EDIT MODE IS ENABLED", message_alert),
        (try_end),
        (try_begin),
            (is_cheat_mode_enabled),
            (display_message, "@cheats are enabled, PILOS is watching", message_negative),
        (try_end),
    (try_end),
  ],[
  ("go_back_dot",[
    (this_or_next|eq, "$g_campaign_type", g_campaign_king),
    (this_or_next|eq, "$g_campaign_type", g_campaign_sandbox),
    (eq, "$g_campaign_type", g_campaign_lord),
  ],"Continue.",[
    (troop_get_slot, ":culture", "trp_player", slot_troop_culture),
    (call_script, "script_initialize_custom_troops", ":culture"),
    (change_screen_return),
  ]),

  ("begin_adventuring",[
    (eq, "$g_campaign_type", g_campaign_story_rome),
  ],"Continue.",[
    (call_script, "script_player_start_story"),
    (change_screen_return),
  ]),

  ("go_back_dot",[],"Return to main menu.",[
    (change_screen_quit),
  ]),
]),

("past_life_explanation",mnf_disable_all_keys,
  "{s3}",
  "none",[
    (try_begin),
      (gt,"$current_string_reg",14),
      (assign,"$current_string_reg",10),
    (try_end),
    (str_store_string_reg,s3,"$current_string_reg"),
    (try_begin),
      (ge,"$current_string_reg",14),
      (str_store_string,s5,"@Back to the beginning..."),
    (else_try),
      (str_store_string,s5,"@View next segment..."),
    (try_end),
  ],[
    ("view_next",[],"{s5}",[
      (val_add,"$current_string_reg",1),
      (jump_to_menu, "mnu_past_life_explanation"),
    ]),
    ("continue",[],"Continue...",[
    ]),
    ("go_back_dot",[],"Go back.",[
      (jump_to_menu, "mnu_choose_skill"),
    ]),
]),

("auto_return",0,
  "{!}This menu automatically returns to caller.",
  "none",[
    (change_screen_return, 0)
],[
]),

("auto_return_map",0,
  "{!}This menu automatically returns to world map.",
  "none",[
    (change_screen_map)
],[
]),

("auto_presentation",0,
  "stub",
  "none",[
    (start_presentation, "$g_presentation_next_presentation"),
  ],[
]),

("return_to_party_screen",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "If you see this you are fucked.",
  "none",[
    (party_clear, "p_looter_spawn_point"),
    (change_screen_exchange_members, 1, "p_looter_spawn_point"),
    (try_begin),
      (eq, "$temp", 2),
      (jump_to_menu, "mnu_simple_encounter"),
    (else_try),
      (eq, "$temp", 1),
      (assign, "$temp", 2),
    (try_end),
  ],[
]),

("return_to_game_options",0,
  "You should not be seeing this.",
  "none",[
    (try_begin),
      (eq, "$temp", 1),
      (modify_visitors_at_site, "scn_presentation_scene"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (assign, "$tem"),
      (set_jump_mission, "mt_return_to_game_options"),
      (jump_to_scene, "scn_presentation_scene"),
      (change_screen_mission),
    (else_try),
      (jump_to_menu, "mnu_simple_encounter"),
    (try_end),
],[]),

 ("morale_report",0,    #modified motomataru chief
  "You can lead up to {reg23} troops. You can manage {reg22} troops without a party moral penalty. {s1}",
  "none",
  [
    (call_script, "script_game_get_party_companion_limit", "p_main_party"),
    (assign, reg23, reg0),
    (store_div, reg22, reg23, 2),

    (call_script, "script_get_player_party_morale_values"),

    #(party_set_morale, "p_main_party", reg0),
    (assign, reg6, 50),
    (assign, ":sum_modifiers", reg6),

    (assign, reg1, "$g_player_party_morale_modifier_party_size"),
    (try_begin),
      (gt, reg1, 0),
      (str_store_string, s2, "@{!} -"),
    (else_try),
      (str_store_string, s2, "str_space"),
    (try_end),
    (val_sub, ":sum_modifiers", reg1),

    # (assign, reg2, "$g_player_party_morale_modifier_leadership"),    included in party size modifier now
    # (try_begin),
      # (gt, reg2, 0),
      # (str_store_string, s3, "@{!} +"),
    # (else_try),
      # (str_store_string, s3, "str_space"),
    # (try_end),

    (assign, reg2, "$g_player_party_morale_modifier_weariness"),
    (try_begin),
      (gt, reg2, 0),
      (str_store_string, s3, "@{!} -"),
    (else_try),
      (str_store_string, s3, "str_space"),
    (try_end),
    (val_sub, ":sum_modifiers", reg2),

    (try_begin),
      (gt, "$g_player_party_morale_modifier_no_food", 0),
      (assign, reg7, "$g_player_party_morale_modifier_no_food"),
      (str_store_string, s5, "@^No food:  -{reg7}"),
      (val_sub, ":sum_modifiers", reg7),
    (else_try),
      (str_store_string, s5, "str_space"),
    (try_end),

    (assign, reg3, "$g_player_party_morale_modifier_food"),
    (try_begin),
      (gt, reg3, 0),
      (str_store_string, s4, "@{!} +"),
    (else_try),
      (str_store_string, s4, "str_space"),
    (try_end),
    (val_add, ":sum_modifiers", reg3),

    (try_begin),
      (gt, "$g_player_party_morale_modifier_debt", 0),
      (assign, reg7, "$g_player_party_morale_modifier_debt"),
      (str_store_string, s6, "@^Wage debt:  -{reg7}"),
      (val_sub, ":sum_modifiers", reg7),
    (else_try),
      (str_store_string, s6, "str_space"),
    (try_end),

    (party_get_morale, reg5, "p_main_party"),
    (store_sub, reg4, reg5, ":sum_modifiers"),
    (try_begin),
      (gt, reg4, 0),
      (str_store_string, s7, "@{!} +"),
    (else_try),
      (str_store_string, s7, "str_space"),
    (try_end),

    (str_store_string, s1, "@Current party morale is {reg5}.^Current party morale modifiers are:^^Base morale:  +{reg6}^Party size unmanageable: {s2}{reg1}^Lack of rest: {s3}{reg2}^Food variety: {s4}{reg3}{s5}{s6}^Recent events: {s7}{reg4}^TOTAL:  {reg5}^^^"),

    (try_for_range, ":kingdom_no", npc_kingdoms_begin, npc_kingdoms_end),
      (faction_get_slot, ":faction_morale", ":kingdom_no",  slot_faction_morale_of_player_troops),
      (val_div, ":faction_morale", 100),
      (neq, ":faction_morale", 0),
      (assign, reg6, ":faction_morale"),
      (str_store_faction_name, s9, ":kingdom_no"),
      (str_store_string, s1, "str_s1extra_morale_for_s9_troops__reg6_"),
    (try_end),
   ],
   [
     ("continue",[],"Continue...",
     [
       (jump_to_menu, "mnu_reports"),
     ]),
   ]
 ),

("courtship_relations",0,
  "{s1}",
  "none",[
    (str_store_string, s1, "str_courtships_in_progress_"),
    (try_for_range, ":lady", kingdom_ladies_begin, kingdom_ladies_end),
      (troop_slot_eq, ":lady", slot_troop_met, 2),
      (call_script, "script_troop_get_relation_with_troop", "trp_player", ":lady"),
      (gt, reg0, 0),
      (assign, reg3, reg0),

      (str_store_troop_name, s2, ":lady"),

      (store_current_hours, ":hours_since_last_visit"),
      (troop_get_slot, ":last_visit_hour", ":lady", slot_troop_last_talk_time),
      (val_sub, ":hours_since_last_visit", ":last_visit_hour"),
      (store_div, ":days_since_last_visit", ":hours_since_last_visit", 24),
      (assign, reg4, ":days_since_last_visit"),

      (str_store_string, s1, "str_s1_s2_relation_reg3_last_visit_reg4_days_ago"),
    (try_end),

    (str_store_string, s1, "str_s1__poems_known"),
    (try_begin),
      (gt, "$allegoric_poem_recitations", 0),
      (str_store_string, s1, "str_s1_storming_the_castle_of_love_allegoric"),
    (try_end),
    (try_begin),
      (gt, "$tragic_poem_recitations", 0),
      (str_store_string, s1, "str_s1_kais_and_layali_tragic"),
    (try_end),
    (try_begin),
      (gt, "$comic_poem_recitations", 0),
      (str_store_string, s1, "str_s1_a_conversation_in_the_garden_comic"),
    (try_end),
    (try_begin),
      (gt, "$heroic_poem_recitations", 0),
      (str_store_string, s1, "str_s1_helgered_and_kara_epic"),
    (try_end),
    (try_begin),
      (gt, "$mystic_poem_recitations", 0),
      (str_store_string, s1, "str_s1_a_hearts_desire_mystic"),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_reports"),
    ]),
]),

("lord_relations",0,
  "{s1}",
  "none",[
    (assign, ":met_lord_count", 0),
    (try_for_range, ":active_npc", heroes_begin, kingdom_ladies_end),
      (troop_slot_eq, ":active_npc", slot_troop_occupation, slto_kingdom_hero),
      (troop_slot_ge, ":active_npc", slot_troop_met, 1),
      (val_add, ":met_lord_count", 1),
      (troop_set_slot, ":active_npc", slot_troop_temp_slot, 0),
    (try_end),
    (str_clear, s1),
    ##diplomacy start+
    #Add support for promoted kingdom ladies.
    #(try_for_range, ":unused", active_npcs_begin, active_npcs_end),#<- changed
    #We counted the number of heroes, so we can cut down on the number of
    #iterations (since expanding this from active_npcs to heroes means that
    #a lot of them will not be lords).
    (try_for_range, ":unused", 0, ":met_lord_count"),#<- added
      (assign, ":score_to_beat", -100),
      (assign, ":best_relation_remaining_npc", -1),
      #Add support for promoted kingdom ladies
      #(try_for_range, ":active_npc", active_npcs_begin, active_npcs_end),#<-changed
      (try_for_range, ":active_npc", heroes_begin, kingdom_ladies_end),#<-added
        (troop_slot_eq, ":active_npc", slot_troop_temp_slot, 0),
        (troop_slot_eq, ":active_npc", slot_troop_occupation, slto_kingdom_hero),
        (troop_slot_ge, ":active_npc", slot_troop_met, 1),

        (call_script, "script_troop_get_player_relation", ":active_npc"),
        (assign, ":relation_with_player", reg0),
        (ge, ":relation_with_player", ":score_to_beat"),

        (assign, ":score_to_beat", ":relation_with_player"),
        (assign, ":best_relation_remaining_npc", ":active_npc"),
      (try_end),
      (gt, ":best_relation_remaining_npc", -1),

      (str_store_troop_name_link, s4, ":best_relation_remaining_npc"),
      (assign, reg4, ":score_to_beat"),
      (str_store_string, s1, "@{!}{s1}^{s4}: {reg4}"),
      (troop_set_slot, ":best_relation_remaining_npc", slot_troop_temp_slot, 1),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_reports"),
    ]),
]),

("faction_orders",0,
  "{!}{s9}",
  "none",[
    (str_clear, s9),
    (store_current_hours, ":cur_hours"),
    (try_for_range, ":faction_no", kingdoms_begin, kingdoms_end),
      (faction_slot_eq, ":faction_no", slot_faction_state, sfs_active),
      (neq, ":faction_no", "fac_player_supporters_faction"),
      (faction_get_slot, ":old_faction_ai_state", ":faction_no", slot_faction_ai_state),
      (try_begin),
        (faction_get_slot, ":faction_marshal", ":faction_no", slot_faction_marshall),
        (gt, ":faction_marshal", -1),
        (assign, ":faction_ai_decider", ":faction_marshal"),
      (else_try),
        (faction_get_slot, ":faction_ai_decider", ":faction_no", slot_faction_leader),
      (try_end),

      (call_script, "script_npc_decision_checklist_faction_ai_alt", ":faction_ai_decider"),
      (assign, ":new_strategy", reg0),
      (str_store_string, s26, s14),

      #(3*) these three lines moved to here from (*4)
      (faction_get_slot, ":faction_ai_state", ":faction_no", slot_faction_ai_state),
      (faction_get_slot, ":faction_ai_object", ":faction_no", slot_faction_ai_object),
      (faction_get_slot, ":faction_marshall", ":faction_no", slot_faction_marshall),

      (faction_get_slot, ":faction_ai_offensive_max_followers", ":faction_no", slot_faction_ai_offensive_max_followers),
      (str_store_faction_name, s10, ":faction_no"),

      (try_begin),
        (faction_get_slot, ":faction_issue", ":faction_no", slot_faction_political_issue),

        (try_begin),
          (eq, ":faction_issue", 1),
          (str_store_string, s11, "@Appoint next marshal"),
        (else_try),
          (is_between, ":faction_issue", centers_begin, centers_end),
          (str_store_party_name, s12, ":faction_issue"),
          (str_store_string, s11, "@Award {s12} as fief"),
        (else_try),
          (eq, ":faction_issue", 0),
          (str_store_string, s11, "str_dplmc_none"),
        (else_try),
          (assign, reg3, ":faction_issue"),
          (str_store_string, s11, "@{!}Error ({reg3})"),
        (try_end),

        (store_current_hours, reg4),
        (faction_get_slot, ":faction_issue_put_on_agenda", ":faction_no", slot_faction_political_issue_time),
        (val_sub, reg4, ":faction_issue_put_on_agenda"),

            (str_store_string, s10, "@{!}{s10}^Faction political issue: {s11}"),
        (try_begin),
          (faction_slot_ge, ":faction_no", slot_faction_political_issue, 1),
          (str_store_string, s10, "@{!}{s10} (on agenda {reg4} hours)"),
        (try_end),
      (try_end),
      (assign, reg2, ":faction_ai_offensive_max_followers"),
      (try_begin),
        (eq, ":faction_ai_state", sfai_default),
        (str_store_string, s11, "@{!}Defending"),
      (else_try),
        (eq, ":faction_ai_state", sfai_gathering_army),
        (str_store_string, s11, "@{!}Gathering army"),
      (else_try),
        (eq, ":faction_ai_state", sfai_attacking_center),
        (str_store_party_name, s11, ":faction_ai_object"),
        (str_store_string, s11, "@{!}Besieging {s11}"),
      (else_try),
        (eq, ":faction_ai_state", sfai_raiding_village),
        (str_store_party_name, s11, ":faction_ai_object"),
        (str_store_string, s11, "@{!}Raiding {s11}"),
      (else_try),
        (eq, ":faction_ai_state", sfai_attacking_enemy_army),
        (str_store_party_name, s11, ":faction_ai_object"),
        (str_store_string, s11, "str_attacking_enemy_army_near_s11"),
      (else_try),
        (eq, ":faction_ai_state", sfai_feast),
        (str_store_party_name, s11, ":faction_ai_object"),
        (str_store_string, s11, "str_holding_feast_at_s11"),
      (else_try),
        (eq, ":faction_ai_state", sfai_attacking_enemies_around_center),
        (str_store_party_name, s11, ":faction_ai_object"),
        (str_store_string, s11, "@{!}Attacking enemies around {s11}"),
      (else_try),
        (assign, reg4, ":faction_ai_state"),
        (str_store_string, s11, "str_sfai_reg4"),
      (try_end),

      (try_begin),
        (lt, ":faction_marshall", 0),
        (str_store_string, s12, "@No one"),
      (else_try),
        (str_store_troop_name, s12, ":faction_marshall"),
        (troop_get_slot, reg21, ":faction_marshall", slot_troop_controversy),
        (str_store_string, s12, "@{!}{s12} (controversy: {reg21})"),
      (try_end),

      (try_for_parties, ":screen_party"),
        (party_slot_eq, ":screen_party", slot_party_ai_state, spai_screening_army),
        (store_faction_of_party, ":screen_party_faction", ":screen_party"),
        (eq, ":screen_party_faction", ":faction_no"),

        (str_store_party_name, s38, ":screen_party"),
        (str_store_string, s12, "@{!}{s12}^Screening party: {s38}"),
      (try_end),

      (try_begin),
        #new condition to rest, (a faction's new strategy should be feast or default) and (":hours_at_current_state" > 20)
        (this_or_next|eq, ":new_strategy", sfai_default),
        (eq, ":new_strategy", sfai_feast),

        (store_current_hours, ":hours_at_current_state"),
        (faction_get_slot, ":current_state_started", ":faction_no", slot_faction_ai_current_state_started),
        (val_sub, ":hours_at_current_state", ":current_state_started"),
        (ge, ":hours_at_current_state", 18),

        (store_current_hours, ":hours"),
        (faction_set_slot, ":faction_no", slot_faction_ai_last_rest_time, ":hours"),
      (try_end),

      #Change of strategy
      (try_begin),
        (neq, ":new_strategy", ":old_faction_ai_state"),

        (store_current_hours, ":hours"),
        (faction_set_slot, ":faction_no", slot_faction_ai_current_state_started, ":hours"),
      (try_end),

      (call_script, "script_evaluate_realm_stability", ":faction_no"),
      (assign, ":disgruntled_lords", reg0),
      (assign, ":restless_lords", reg1),

      (faction_get_slot, ":last_feast_ended", ":faction_no", slot_faction_last_feast_start_time),
      (store_sub, ":hours_since_last_feast", ":cur_hours", ":last_feast_ended"),
      (val_sub, ":hours_since_last_feast", 72),

      (faction_get_slot, ":current_state_started", ":faction_no", slot_faction_ai_current_state_started),
      (store_sub, ":hours_at_current_state", ":cur_hours", ":current_state_started"),

      (faction_get_slot, ":faction_ai_last_offensive_time", ":faction_no", slot_faction_last_offensive_concluded),
      (store_sub, ":hours_since_last_offensive", ":cur_hours", ":faction_ai_last_offensive_time"),

      (faction_get_slot, ":faction_ai_last_rest", ":faction_no", slot_faction_ai_last_rest_time),
      (store_sub, ":hours_since_last_rest", ":cur_hours", ":faction_ai_last_rest"),

      (faction_get_slot, ":faction_ai_last_decisive_event", ":faction_no", slot_faction_ai_last_decisive_event),
      (store_sub, ":hours_since_last_decisive_event", ":cur_hours", ":faction_ai_last_decisive_event"),

      (assign, reg3, ":hours_at_current_state"),
      (assign, reg4, ":hours_since_last_offensive"),
      (assign, reg5, ":hours_since_last_feast"),

      (assign, reg7, ":disgruntled_lords"),
      (assign, reg8, ":restless_lords"),
      (assign, reg9, ":hours_since_last_rest"),
      (assign, reg10, ":hours_since_last_decisive_event"),
      (str_store_string, s14, s26),

      (str_store_string, s9, "str_s9s10_current_state_s11_hours_at_current_state_reg3_current_strategic_thinking_s14_marshall_s12_since_the_last_offensive_ended_reg4_hours_since_the_decisive_event_reg10_hours_since_the_last_rest_reg9_hours_since_the_last_feast_ended_reg5_hours_percent_disgruntled_lords_reg7_percent_restless_lords_reg8__"),
    (try_end),

    (try_begin),
      (neg|is_between, "$g_cheat_selected_faction", kingdoms_begin, kingdoms_end),
      (call_script, "script_get_next_active_kingdom", kingdoms_end),
      (assign, "$g_cheat_selected_faction", reg0),
    (try_end),
    (str_store_faction_name, s10, "$g_cheat_selected_faction"),
    (str_store_string, s9, "@Selected faction is: {s10}^^{s9}"),
  ],[
    ("faction_orders_next_faction", [],"{!}Select next faction.",[
      (call_script, "script_get_next_active_kingdom", "$g_cheat_selected_faction"),
      (assign, "$g_cheat_selected_faction", reg0),
      (jump_to_menu, "mnu_faction_orders"),
    ]),

    #SB : debug slots
    ("faction_orders_slots", [],"{!}Debug slots.",[
      (assign, "$g_presentation_input", rename_kingdom),
      (assign, "$g_presentation_state", 0),
      (start_presentation, "prsnt_modify_slots"),
    ]),

    ("faction_orders_political_collapse", [],"{!}CHEAT - Cause all lords in faction to fall out with their liege.",[
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
        (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
        (store_faction_of_troop, ":troop_faction", ":lord"),
        (eq, ":troop_faction", "$g_cheat_selected_faction"),
        (faction_get_slot, ":faction_liege", ":troop_faction", slot_faction_leader),
        (call_script, "script_troop_change_relation_with_troop", ":lord", ":faction_liege", -200),
      (try_end),
    ]),

    ("faction_orders_defend", [],"{!}Force defend.",[
      (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_state, sfai_default),
      (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_object, -1),
      (jump_to_menu, "mnu_faction_orders"),
    ]),
    ("faction_orders_feast", [],"{!}Force feast.",[
      (assign, ":location_high_score", 0),
      (try_for_range, ":location", walled_centers_begin, walled_centers_end),
        (neg|party_slot_ge, ":location", slot_center_is_besieged_by, 1),
        (store_faction_of_party, ":location_faction", ":location"),
        (eq, ":location_faction", "$g_cheat_selected_faction"),
        (party_get_slot, ":location_lord", ":location", slot_town_lord),
        (troop_get_slot, ":location_score", ":location_lord", slot_troop_renown),
        (store_random_in_range, ":random", 0, 1000), #will probably be king or senior lord
        (val_add, ":location_score", ":random"),
        (gt, ":location_score", ":location_high_score"),
        (assign, ":location_high_score", ":location_score"),
        (assign, ":location_feast", ":location"),
      (try_end),

      (try_begin),
        (gt, ":location_feast", centers_begin),
        (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_state, sfai_feast),
        (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_object, ":location_feast"),
        (try_begin),
          (eq, "$g_player_eligible_feast_center_no", ":location_feast"),
          (assign, "$g_player_eligible_feast_center_no", -1),
        (try_end),

        (store_current_hours, ":hours"),
        (faction_set_slot, "$g_cheat_selected_faction", slot_faction_last_feast_start_time, ":hours"),
      (try_end),
      (jump_to_menu, "mnu_faction_orders"),
    ]),
    ("faction_orders_gather", [],"{!}Force gather army.",[
      (store_current_hours, ":cur_hours"),
      (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_state, sfai_gathering_army),
      (faction_set_slot, "$g_cheat_selected_faction", slot_faction_last_offensive_concluded, ":cur_hours"),
      (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_offensive_max_followers, 1),
      (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_object, -1),
      (jump_to_menu, "mnu_faction_orders"),
    ]),
    ("faction_orders_increase_time", [],"{!}Increase last offensive time by 24 hours.",[
      (faction_get_slot, ":faction_ai_last_offensive_time", "$g_cheat_selected_faction", slot_faction_last_offensive_concluded),
      (val_sub, ":faction_ai_last_offensive_time", 24),
      (faction_set_slot, "$g_cheat_selected_faction", slot_faction_last_offensive_concluded, ":faction_ai_last_offensive_time"),
      (jump_to_menu, "mnu_faction_orders"),
    ]),
    ("faction_orders_rethink", [],"{!}Force rethink.",[
      (call_script, "script_init_ai_calculation"),
      (call_script, "script_decide_faction_ai", "$g_cheat_selected_faction"),
      (jump_to_menu, "mnu_faction_orders"),
    ]),
    ("faction_orders_rethink_all", [],"{!}Force rethink for all factions.",[
      # (call_script, "script_recalculate_ais"),
      (jump_to_menu, "mnu_faction_orders"),
    ]),
    ("faction_orders_init_econ", [],"{!}Initialize economic stats.",[
      (call_script, "script_initialize_economic_information"),
      (jump_to_menu, "mnu_faction_orders"),
    ]),
    ("go_back_dot",[],"{!}Go back.",[
      (jump_to_menu, "mnu_reports"),
    ]),
]),
("destory_fortifications",mnf_scale_picture|mnf_enable_hot_keys,
  "You have set up fortifications. What do you wish to do?",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("resume_travelling",[],"Camp Menu.",[
      (jump_to_menu, "mnu_camp"),
    ]),
    ("resume_travelling",[],"Abandon fortifications.",[
      (troop_set_slot, "trp_global_variables", g_player_trench, 0),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("resume_travelling",[],"Continue camping.",[
      (jump_to_menu, "mnu_auto_return_map"),
      (assign,"$g_camp_mode", 1),
      (assign, "$g_infinite_camping", 0),
      (assign, "$g_player_icon_state", pis_camping),
      (rest_for_hours_interactive, 24 * 365, 5, 1), #rest while attackable
      (leave_encounter),
      #(change_screen_map),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("camp",mnf_scale_picture|mnf_enable_hot_keys,
  "{s23}^^{s37}^^Current party stance: {s36}^^{s60}",
  "none",[
    (call_script, "script_get_region_of_pos22", "p_main_party"),
    (try_begin),
      (check_quest_active, "qst_elysium"),
      (quest_slot_eq, "qst_elysium", slot_quest_current_state, 2),
      (store_distance_to_party_from_party, ":distance", "p_main_party", "p_island"),
      (lt, ":distance", 5),
      (jump_to_menu, "mnu_wait_storm"),
    (else_try),
      # We get here when original camp submenus return back to top level
      (eq, "$g_encountered_party_template", "pt_player_camp"),
      (jump_to_menu, "mnu_player_camp"),
    (else_try),
      # If Camp is pressed just near a camp, switch to it
      (call_script, "script_find_closest_player_camp", "p_main_party"),
      (gt, reg0, 0), # camp party
      (eq, reg1, 0), # distance
      (assign, "$auto_enter_town", reg0),
      (change_screen_return),
    (else_try),
      (eq,"$temp",6), #waiting, building, exit
      (assign,"$temp",0), #waiting, building, exit
      (jump_to_menu, "mnu_auto_return_map"),
      (try_begin),
        (troop_slot_eq, "trp_global_variables", g_player_trench, 1),
        (eq,"$g_camp_mode", 1),
        (assign, "$g_infinite_camping", 0),
        (assign, "$g_player_icon_state", pis_camping),
        (rest_for_hours_interactive, 24 * 365, 5, 1), #rest while attackable
        (leave_encounter),
        #(change_screen_map),
        (jump_to_menu, "mnu_auto_return_map"),#phaiak
      (try_end),
    (else_try),
      (start_presentation,"prsnt_camp_menu"),
      (party_slot_eq, "p_main_party", slot_party_on_water, 0),
      (assign, "$g_player_icon_state", pis_normal),
    (try_end),

    (str_clear, s60),
    (try_begin),
      (ge, "$cheat_mode", 1),
      (set_fixed_point_multiplier, 1000),
      (party_get_position, pos1, "p_main_party"),
      (position_get_x, reg44, pos1),
      (position_get_y, reg45, pos1),
      (position_get_z, reg46, pos1),
      (str_store_string, s60, "@Coordinates: x={reg44} y={reg45} z={reg46}."),
      (display_message, "@{s60}"),
    (try_end),
    (set_background_mesh, "mesh_pic_camp"),
  ],[
      ("resume_travelling",[],"Resume travelling.",[
        (change_screen_return),
      ]),
]),

#######camp follower party management
("hire_follower_party",0,
  "To creat a follower party you need at least 10 non-wounded women in your main party and 2,500 denars for hiring a physician and mules.^^On creation all women will be moved to the follower party.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
  ("option_2",[
    (store_troop_gold, ":g", "trp_player"),
    (ge, ":g", 2500),

    (assign, ":total_valor", 0),
    (party_get_num_companion_stacks, ":num_of_stacks", "p_main_party"),

    (try_for_range, ":i", 0, ":num_of_stacks"),
      (party_stack_get_troop_id, ":stack_troop", "p_main_party", ":i"),
      (is_between, ":stack_troop", "trp_follower_woman", "trp_caravan_master"),

      (party_stack_get_size, ":stack_size", "p_main_party", ":i"),
      (party_stack_get_num_wounded, ":stack_wounded", "p_main_party", ":i"),
      (val_sub, ":stack_size", ":stack_wounded"),
      (val_add, ":total_valor", ":stack_size"),
    (try_end),
    (ge, ":total_valor", 10),
  ],"Creat a follower party.",[
    (troop_remove_gold, "trp_player", 2500),
    (party_get_num_companion_stacks, ":num_of_stacks", "p_main_party"),

    (try_for_range_backwards, ":i", 0, ":num_of_stacks"),
      (party_stack_get_size, ":stack_size", "p_main_party", ":i"),
      (party_stack_get_num_wounded, ":stack_wounded", "p_main_party", ":i"),
      (val_sub, ":stack_size", ":stack_wounded"),
      (ge, ":stack_size", 1),

      (party_stack_get_troop_id, ":stack_troop", "p_main_party", ":i"),
      (is_between, ":stack_troop", "trp_follower_woman", "trp_caravan_master"),

      (party_add_members,"p_follower_party", ":stack_troop", ":stack_size"),
      (party_remove_members, "p_main_party", ":stack_troop", ":stack_size"),
      # (assign, ":stack_size", 0),
      # (assign, ":stack_troop", -1),
      # (assign, ":stack_wounded", 0),
    (try_end),
    (assign, "$temp", 0),
    (jump_to_menu, "mnu_follower_party"),
  ]),
  ("back_1",[],"Go Back.",[
    (jump_to_menu, "mnu_camp"),
  ]),
]),

("follower_party",0,
  "Your follower party consists of mules, a doctor and the women you assigned to it, which grant additional storage, healing heavy wounds quickly and a morale boost."
  +" But the follower party has the disadvantage of making your army advance more slowly.^^"
  +" You can drive away followers any time, but doing so will have an impact on the morale of your army and all items stored on the mules will disappear.^^"
  +" If you decide to reduce the size of your army below 40 men or if your army suffers high losses or a serious defeat, followers may abandon you.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
    (party_get_num_companion_stacks, ":num_of_stacks", "p_follower_party"),
    (try_for_range_backwards, ":i", 0, ":num_of_stacks"),
      (party_stack_get_troop_id, ":stack_troop", "p_follower_party", ":i"),
      (neg|is_between, ":stack_troop", "trp_follower_woman", "trp_caravan_master"),
      (neq, ":stack_troop", "trp_sailor"),#can give sailors to follower party too
      (gt, ":stack_troop", 0),
      (party_stack_get_size, ":stack_size", "p_follower_party", ":i"),
      (party_add_members, "p_main_party", ":stack_troop", ":stack_size"),
      (party_remove_members, "p_follower_party", ":stack_troop", ":stack_size"),
      (display_message, "@You can't give soldiers to your follower party!", message_alert),
    (try_end),
  ],[
  ("option_0",[
    (troop_get_inventory_capacity, ":capacity", "trp_player"),
    (try_for_range, ":inventory_slot", ek_food + 1, ":capacity"),
      (troop_get_inventory_slot, ":item", "trp_player", ":inventory_slot"),
      (is_between, ":item", "itm_wine", "itm_smoked_fish"),
      (troop_get_inventory_slot_modifier, ":imod", "trp_player", ":inventory_slot"),
      (neq, ":imod", imod_rotten),
      (troop_inventory_slot_get_item_amount, ":slot_amount", "trp_player", ":inventory_slot"),
      (ge, ":slot_amount", 1),
      (assign, ":capacity", -1), # break loop
    (try_end),
    (eq, ":capacity", -1),
    (store_free_inventory_capacity, ":free", "trp_follower_party_mules"),
    (ge, ":free", 1),
  ],"Move all drinkable items from your inventory on the mules.",[
    (troop_get_inventory_capacity, ":capacity", "trp_player"),
    (try_for_range, ":inventory_slot", ek_food + 1, ":capacity"),
      (troop_get_inventory_slot, ":item", "trp_player", ":inventory_slot"),
      (is_between, ":item",  "itm_wine", "itm_smoked_fish"),
      (troop_get_inventory_slot_modifier, ":imod", "trp_player", ":inventory_slot"),
      (neq, ":imod", imod_rotten),
      (troop_inventory_slot_get_item_amount, ":slot_amount", "trp_player", ":inventory_slot"),
      (ge, ":slot_amount", 1),
      (troop_get_inventory_capacity, ":capacity_follower", "trp_follower_party_mules"),
      (assign, ":selected_slot", -1),
      (try_for_range, ":free_slot", ek_food + 1, ":capacity_follower"),
        (troop_get_inventory_slot, ":free_item", "trp_follower_party_mules", ":free_slot"),
        (eq, ":free_item", -1),
        (assign, ":capacity_follower", -1),
        (assign, ":selected_slot", ":free_slot"),
      (try_end),
      (eq, ":capacity_follower", -1),
      (gt, ":selected_slot", -1),
      (troop_set_inventory_slot, "trp_follower_party_mules", ":selected_slot", ":item"),
      (troop_inventory_slot_set_item_amount, "trp_follower_party_mules", ":selected_slot", ":slot_amount"),
      (troop_set_inventory_slot, "trp_player", ":inventory_slot", -1),
    (try_end),
  ]),
  ("option_0",[
    (troop_get_inventory_capacity, ":capacity", "trp_player"),
    (try_for_range, ":inventory_slot", ek_food + 1, ":capacity"),
      (troop_get_inventory_slot, ":item", "trp_player", ":inventory_slot"),
      (is_between, ":item", food_begin, food_end),
      (troop_get_inventory_slot_modifier, ":imod", "trp_player", ":inventory_slot"),
      (neq, ":imod", imod_rotten),
      (troop_inventory_slot_get_item_amount, ":slot_amount", "trp_player", ":inventory_slot"),
      (ge, ":slot_amount", 1),
      (assign, ":capacity", -1), # break loop
    (try_end),
    (eq, ":capacity", -1),
    (store_free_inventory_capacity, ":free", "trp_follower_party_mules"),
    (ge, ":free", 1),
  ],"Move all food items from your inventory on the mules.",[
    (troop_get_inventory_capacity, ":capacity", "trp_player"),
    (try_for_range, ":inventory_slot", ek_food + 1, ":capacity"),
      (troop_get_inventory_slot, ":item", "trp_player", ":inventory_slot"),
      (is_between, ":item", food_begin, food_end),
      (troop_get_inventory_slot_modifier, ":imod", "trp_player", ":inventory_slot"),
      (neq, ":imod", imod_rotten),
      (troop_inventory_slot_get_item_amount, ":slot_amount", "trp_player", ":inventory_slot"),
      (ge, ":slot_amount", 1),
      (troop_get_inventory_capacity, ":capacity_follower", "trp_follower_party_mules"),
      (assign, ":selected_slot", -1),
      (try_for_range, ":free_slot", ek_food + 1, ":capacity_follower"),
        (troop_get_inventory_slot, ":free_item", "trp_follower_party_mules", ":free_slot"),
        (eq, ":free_item", -1),
        (assign, ":capacity_follower", -1),
        (assign, ":selected_slot", ":free_slot"),
      (try_end),
      (eq, ":capacity_follower", -1),
      (gt, ":selected_slot", -1),
      (troop_set_inventory_slot, "trp_follower_party_mules", ":selected_slot", ":item"),
      (troop_inventory_slot_set_item_amount, "trp_follower_party_mules", ":selected_slot", ":slot_amount"),
      (troop_set_inventory_slot, "trp_player", ":inventory_slot", -1),
    (try_end),
  ]),
  ("option_1",[],"Manage follower party.",[
    (change_screen_exchange_members, 1, "p_follower_party"),
  ]),
  ("option_2",[],"Store items on the mules.",[
    (change_screen_loot, "trp_follower_party_mules"),
  ]),
  ("option_2",[],"Talk with the physician.",[
    (call_script, "script_setup_troop_meeting", "trp_healer_2", -1, -1),
  ]),
  ("back_1",[],"Dismiss follower party.",[
    (jump_to_menu, "mnu_followers_remove"),
  ]),
  ("back_1",[],"Go Back.",[
    (try_begin),
      (store_party_size_wo_prisoners, ":size", "p_follower_party"),
      (gt, ":size", 0),
      (try_begin),
        (eq, "$temp", 0),
        (jump_to_menu, "mnu_auto_return_map"),
      (else_try),
        (jump_to_menu, "mnu_auto_return_map"),
      (try_end),
    (else_try),
      (display_message, "@Follower party is empty!", color_bad_news),
      (display_message, "@Place some women in the follower party or dismiss it!"),
    (try_end),
  ]),
]),
("followers_remove",0,
  "Are you sure you want to disperse your followers? This will make your followers stop accompanying your army. " +
  "This may mean a strong negative impact on the morale of your troops.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
  ("remove_yes",[],"Yes.",[
    (party_clear, "p_follower_party"),
    (troop_clear_inventory, "trp_follower_party_mules"),
    (call_script, "script_change_player_party_morale", -15),
    (display_message,"@You chose to disperse your followers."),
    (jump_to_menu, "mnu_camp"),
  ]),
  ("remove_no",[],"No.",[
    (assign, "$temp", 0),
    (jump_to_menu, "mnu_follower_party"),
  ]),
]),

("followers_camp_leave",0,
  "Follower party leaves!^^Recent events and the drastic reduction in the number of your troops have caused your camp followers disperse...",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
  ("follw_yes",[],"Damn.",[
    (call_script, "script_change_player_party_morale", -10),
    (party_clear, "p_follower_party"), #
    (troop_clear_inventory, "trp_follower_party_mules"), #player lose mules
    (jump_to_menu, "mnu_auto_return_map"),#phaiak
  ]),
]),

#######camp wait
("camp_action_rest_fort",0,
  "Fortifing your camp will give you an advantage against attacking enemies.^^You or one of your companions need an engineer skill higher than 5 and you need a set of tools inside your inventory.^^ Currently your party has an engineer skill of {reg55}.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
    (party_get_skill_level, reg55, "p_main_party", "skl_engineer"),
  ],[
  ("camp_wait_here",[
    (ge, reg55, 5),
    (store_item_kind_count, ":tools", "itm_tools", "trp_player"),
    (ge, ":tools", 1),
  ],"Build fortifications.",[
    (assign,"$g_presentations_next_presentation",-1),
    (presentation_set_duration,0),
    (assign,"$g_camp_mode", 1),
    (assign, "$g_infinite_camping", 0),
    (assign, "$g_player_icon_state", pis_camping),
    (rest_for_hours_interactive, 24 * 365, 5, 1), #rest while attackable
    (leave_encounter),
    #(change_screen_map),
    (jump_to_menu, "mnu_auto_return_map"),#phaiak
    (troop_set_slot, "trp_global_variables", g_player_trench, 1),
  ]),
  ("resume_travelling",[],"Back.",[
    (change_screen_return),
  ]),
]),
#######camp wait
("fortify_siege_camp",0,
  "Fortifing your camp will give you an advantage against attacking enemies.^^You or one of your companions need an engineer skill higher than 5 and you need a set of tools inside your inventory.^^ Currently your party has an engineer skill of {reg55}.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
    (party_get_skill_level, reg55, "p_main_party", "skl_engineer"),
  ],[
  ("camp_wait_here",[
    (ge, reg55, 5),
    (store_item_kind_count, ":tools", "itm_tools", "trp_player"),
    (ge, ":tools", 1),
  ],"Build fortifications.",[
    (jump_to_menu, "mnu_auto_return_map"),
    (troop_set_slot, "trp_global_variables", g_player_trench, 1),
  ]),
  ("resume_travelling",[],"Back.",[
    (change_screen_return),
  ]),
]),

("camp_action_rest",0,
  "Camping allows your troops to rest for a while and recover from the hard life of travels.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
  ("camp_wait_here",[],"Wait here for some time.",[
    (assign,"$g_presentations_next_presentation",-1),
    (presentation_set_duration,0),
    (assign,"$g_camp_mode", 1),
    (assign, "$g_infinite_camping", 0),
    (assign, "$g_player_icon_state", pis_camping),
    (rest_for_hours_interactive, 24 * 365, 5, 1), #rest while attackable
    (leave_encounter),
    #(change_screen_map),
    (jump_to_menu, "mnu_auto_return_map"),#phaiak
  ]),
  ("resume_travelling",[],"Back.",[
    (change_screen_return),
  ]),
]),

("camp_cheat",0,
  "Select a cheat:",
  "none",[
  ],[
    ("camp_cheat_find_item",[(troop_slot_ge, "trp_global_variables", g_is_dev, 1),], "Find an item...",
       [(jump_to_menu, "mnu_cheat_find_item"),]
    ),
    ("camp_cheat_weather",[
      (neg|party_slot_eq, "p_main_party", slot_party_on_water, 1),
    ],"Destroy your ship.",[
      (try_for_parties, ":ship"),
        (party_is_active, ":ship"),
        (party_slot_eq, ":ship", slot_party_type, spt_ship),
        (party_get_template_id,":landet_ship_template", ":ship"),
        (eq, ":landet_ship_template", "pt_landet_ships"),
        (remove_party, ":ship"),
        (display_message, "@Destroyed your ship!"),
      (try_end),
      (assign, "$players_ship", -1),
      (troop_add_gold, "trp_player", 40000),
      (display_message, "@You get money to buy yourself a new ship"),
    ]),

    # ("camp_cheat_weather",[
    #   (neg|party_slot_eq, "p_main_party", slot_party_on_water, 1),
    # ],"Party Details.",[
    #   (store_num_parties_of_template, reg10, "pt_refugees"),
    #   (display_message, "@Curr number of refugees: {reg10}"),
    #   (assign, reg10, 0),
    #   (display_message, "@number; name; closest center"),
    #   (try_for_parties, ":ship"),
    #     (try_begin),
    #       (party_is_active, ":ship"),
    #       (call_script, "script_get_closest_center", ":ship"),
    #       (assign, ":closest_center", reg0),
    #       (str_store_party_name, s10, ":ship"),
    #       (str_store_party_name, s11, ":closest_center"),
    #       (display_message, "@{reg10}; {s10}; {s11}"),
    #     (else_try),
    #       (display_message, "@{reg10}; inactive; none"),
    #     (try_end),
    #     (val_add, reg10, 1),
    #   (try_end),
    # ]),

    # ("camp_cheat_weather",[(troop_slot_ge, "trp_global_variables", g_is_dev, 1),],
    #     "Set names to grain.",
    #     [
    # (try_for_range, ":village", centers_begin, centers_end),
    #     (party_get_slot, reg22, ":village", slot_center_acres_grain),
    #     (party_set_name, ":village", "@Grain: {reg22}"),
    # (try_end),
    # ]),

    # ("camp_cheat_weather",[], "Reset bugged economic values (tariffs rents wealths)",[
    #    (try_for_range, ":faction", kingdoms_begin, kingdoms_end),
    #     (faction_get_slot, ":aristocracy", ":faction", dplmc_slot_faction_aristocracy),
    #     (neg|is_between, ":aristocracy", -3, 4),
    #     (faction_set_slot, ":faction", dplmc_slot_faction_aristocracy, 0),
    #     (str_store_faction_name, s2, ":faction"),
    #     (display_message, "@Fixed bugged dplmc_slot_faction_aristocracy value for {s2}"),
    #    (try_end),

    #     (try_for_range, ":center", centers_begin, centers_end),
    #       (party_get_slot, ":tarrifs", ":center", slot_center_accumulated_tariffs),
    #       (party_get_slot, ":rents", ":center", slot_center_accumulated_rents),
    #       (str_store_party_name, s2, ":center"),
    #       (try_begin),
    #         (lt, ":tarrifs", 0),
    #         (party_set_slot, ":center", slot_center_accumulated_tariffs, 1000),
    #         (assign, reg20, ":tarrifs"),
    #         (display_message, "@Reset {s2} tariffs to 1000 denars, was {reg20}"),
    #         (assign, reg20, 0),
    #       (try_end),
    #       (try_begin),
    #         (ge, ":tarrifs", 100000),
    #         (party_set_slot, ":center", slot_center_accumulated_tariffs, 1000),
    #         (assign, reg20, ":tarrifs"),
    #         (display_message, "@Reset {s2} tariffs to 1000 denars, was {reg20}"),
    #         (assign, reg20, 0),
    #       (try_end),
    #       (try_begin),
    #         (lt, ":rents", 0),
    #         (party_set_slot, ":center", slot_center_accumulated_rents, 10000),
    #         (assign, reg20, ":rents"),
    #         (display_message, "@Reset {s2} rents to 10000 denars, was {reg20}"),
    #         (assign, reg20, 0),
    #       (try_end),
    #       (try_begin),
    #         (ge, ":rents", 100000),
    #         (party_set_slot, ":center", slot_center_accumulated_rents, 10000),
    #         (assign, reg20, ":rents"),
    #         (display_message, "@Reset {s2} rents to 10000 denars, was {reg20}"),
    #         (assign, reg20, 0),
    #       (try_end),
    #     (try_end),

    #     (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
    #       (troop_get_slot, ":wealth", ":npc", slot_troop_wealth),
    #       (try_begin),
    #         (ge, ":wealth", 500000),
    #         (troop_set_slot, ":npc", slot_troop_wealth, 60000),
    #         (assign, reg20, ":wealth"),
    #         (str_store_troop_name, s2, ":npc"),
    #         (display_message, "@Reset {s2} wealth to 60000 denars, was {reg20}"),
    #         (assign, reg20, 0),
    #       (else_try),
    #         (lt, ":wealth", 0),
    #         (troop_set_slot, ":npc", slot_troop_wealth, 60000),
    #         (assign, reg20, ":wealth"),
    #         (str_store_troop_name, s2, ":npc"),
    #         (display_message, "@Reset {s2} wealth to 60000 denars, was {reg20}"),
    #         (assign, reg20, 0),
    #       (try_end),
    #     (try_end),
    #     (store_add, ":end", "trp_christian_priest", 1),
    #     (try_for_range, ":lord", 0, ":end"),
    #       (store_troop_gold, ":g", ":lord"),
    #       (try_begin),
    #         (ge, ":g", 1000000),
    #         #(val_mul, ":g", -1),
    #         (troop_remove_gold, ":lord", ":g"),
    #         (str_store_troop_name, s22, ":lord"),
    #         (display_message, "@{s22} has very high gold"),
    #       (else_try),
    #         (le, ":g", -1),
    #         (val_mul, ":g", -1),
    #         (troop_add_gold, ":lord", ":g"),
    #         (str_store_troop_name, s22, ":lord"),
    #         (display_message, "@{s22} has negative gold"),
    #       (try_end),
    #       (neq, ":lord", "trp_banner_background_color_array"),
    #       (neq, ":lord", "trp_dplmc_chamberlain"),
    #       (try_for_range, ":slot", 0, 10000),
    #         (neg|is_between, ":slot", 85, 100),
    #         (troop_slot_ge, ":lord", ":slot", 1000000),
    #         (assign, reg20, ":slot"),
    #         (str_store_troop_name, s22, ":lord"),
    #         (display_message, "@Troop: {s22}: slot {reg20} has a value higher than 1 Mio."),
    #         (troop_set_slot, ":lord", ":slot", 0),
    #       (else_try),
    #         (neg|is_between, ":slot", 85, 100),
    #         (neg|troop_slot_ge, ":lord", ":slot", -1000000),
    #         (assign, reg20, ":slot"),
    #         (str_store_troop_name, s22, ":lord"),
    #         (display_message, "@Troop: {s22}: slot {reg20} has a value lower than - 1 Mio."),
    #         (troop_set_slot, ":lord", ":slot", 0),
    #       (try_end),
    #     (try_end),
    #     (assign, ":active_party_count", 0),
    #     (try_for_parties, ":party"),
    #       # (try_begin),
    #         # (party_is_active, ":party"),
    #         # (party_get_template_id, ":template", ":party"),
    #         # (eq, ":template", "pt_kingdom_caravan_party"),
    #         # (party_slot_eq, ":party", slot_party_type, spt_kingdom_caravan),
    #         # (remove_party, ":party"),
    #         # (display_message, "@Removed a caravan"),
    #       # (try_end),
    #       (party_is_active, ":party"),
    #       (val_add, ":active_party_count", 1),
    #       (try_for_range, ":slot", 0, 1000),
    #         (party_slot_ge, ":party", ":slot", 1000000),
    #         (assign, reg20, ":slot"),
    #         (str_store_party_name, s22, ":party"),
    #         (display_message, "@Party: {s22}: slot {reg20} has a value higher than 1 Mio."),
    #         (party_set_slot, ":party", ":slot", 0),
    #       (else_try),
    #         (neg|party_slot_ge, ":party", ":slot", -1000000),
    #         (assign, reg20, ":slot"),
    #         (str_store_party_name, s22, ":party"),
    #         (display_message, "@Party: {s22}: slot {reg20} has a value higher than -1 Mio."),
    #         (party_set_slot, ":party", ":slot", 0),
    #       (try_end),
    #     (try_end),

    #     (assign, reg20, ":active_party_count"),
    #     (display_message, "@Number of active parties: {reg20}"),

    #     (try_begin),
    #       (ge, reg0, 1000000),
    #       (display_message, "@reg0 very high"),
    #       (assign, reg0, 0),
    #     (else_try),
    #       (le, reg0, -1000000),
    #       (display_message, "@reg0 very negative"),
    #       (assign, reg0, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg1, 1000000),
    #       (display_message, "@reg1 very high"),
    #       (assign, reg1, 0),
    #     (else_try),
    #       (le, reg1, -1000000),
    #       (display_message, "@reg1 very negative"),
    #       (assign, reg1, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg2, 1000000),
    #       (display_message, "@reg2 very high"),
    #       (assign, reg2, 0),
    #     (else_try),
    #       (le, reg2, -1000000),
    #       (display_message, "@reg2 very negative"),
    #       (assign, reg2, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg3, 1000000),
    #       (display_message, "@reg3 very high"),
    #       (assign, reg3, 0),
    #     (else_try),
    #       (le, reg3, -1000000),
    #       (display_message, "@reg3 very negative"),
    #       (assign, reg3, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg4, 1000000),
    #       (display_message, "@reg4 very high"),
    #       (assign, reg4, 0),
    #     (else_try),
    #       (le, reg4, -1000000),
    #       (display_message, "@reg4 very negative"),
    #       (assign, reg4, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg5, 1000000),
    #       (display_message, "@reg5 very high"),
    #       (assign, reg5, 0),
    #     (else_try),
    #       (le, reg5, -1000000),
    #       (display_message, "@reg5 very negative"),
    #       (assign, reg5, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg6, 1000000),
    #       (display_message, "@reg6 very high"),
    #       (assign, reg6, 0),
    #     (else_try),
    #       (le, reg6, -1000000),
    #       (display_message, "@reg6 very negative"),
    #       (assign, reg6, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg7, 1000000),
    #       (display_message, "@reg7 very high"),
    #       (assign, reg7, 0),
    #     (else_try),
    #       (le, reg7, -1000000),
    #       (display_message, "@reg7 very negative"),
    #       (assign, reg7, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg8, 1000000),
    #       (display_message, "@reg8 very high"),
    #       (assign, reg8, 0),
    #     (else_try),
    #       (le, reg8, -1000000),
    #       (display_message, "@reg8 very negative"),
    #       (assign, reg8, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg9, 1000000),
    #       (display_message, "@reg9 very high"),
    #       (assign, reg9, 0),
    #     (else_try),
    #       (le, reg9, -1000000),
    #       (display_message, "@reg9 very negative"),
    #       (assign, reg9, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg10, 1000000),
    #       (display_message, "@reg10 very high"),
    #       (assign, reg10, 0),
    #     (else_try),
    #       (le, reg10, -1000000),
    #       (display_message, "@reg10 very negative"),
    #       (assign, reg10, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg11, 1000000),
    #       (display_message, "@reg11 very high"),
    #       (assign, reg11, 0),
    #     (else_try),
    #       (le, reg11, -1000000),
    #       (display_message, "@reg11 very negative"),
    #       (assign, reg11, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg12, 1000000),
    #       (display_message, "@reg12 very high"),
    #       (assign, reg12, 0),
    #     (else_try),
    #       (le, reg12, -1000000),
    #       (display_message, "@reg12 very negative"),
    #       (assign, reg12, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg13, 1000000),
    #       (display_message, "@reg13 very high"),
    #       (assign, reg13, 0),
    #     (else_try),
    #       (le, reg13, -1000000),
    #       (display_message, "@reg13 very negative"),
    #       (assign, reg13, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg14, 1000000),
    #       (display_message, "@reg14 very high"),
    #       (assign, reg14, 0),
    #     (else_try),
    #       (le, reg14, -1000000),
    #       (display_message, "@reg14 very negative"),
    #       (assign, reg14, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg15, 1000000),
    #       (display_message, "@reg15 very high"),
    #       (assign, reg15, 0),
    #     (else_try),
    #       (le, reg15, -1000000),
    #       (display_message, "@reg15 very negative"),
    #       (assign, reg15, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg16, 1000000),
    #       (display_message, "@reg16 very high"),
    #       (assign, reg16, 0),
    #     (else_try),
    #       (le, reg16, -1000000),
    #       (display_message, "@reg16 very negative"),
    #       (assign, reg16, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg17, 1000000),
    #       (display_message, "@reg17 very high"),
    #       (assign, reg17, 0),
    #     (else_try),
    #       (le, reg17, -1000000),
    #       (display_message, "@reg17 very negative"),
    #       (assign, reg17, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg18, 1000000),
    #       (display_message, "@reg18 very high"),
    #       (assign, reg18, 0),
    #     (else_try),
    #       (le, reg18, -1000000),
    #       (display_message, "@reg18 very negative"),
    #       (assign, reg18, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg19, 1000000),
    #       (display_message, "@reg19 very high"),
    #       (assign, reg19, 0),
    #     (else_try),
    #       (le, reg19, -1000000),
    #       (display_message, "@reg19 very negative"),
    #       (assign, reg19, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg20, 1000000),
    #       (display_message, "@reg20 very high"),
    #       (assign, reg20, 0),
    #     (else_try),
    #       (le, reg20, -1000000),
    #       (display_message, "@reg20 very negative"),
    #       (assign, reg20, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg21, 1000000),
    #       (display_message, "@reg21 very high"),
    #       (assign, reg21, 0),
    #     (else_try),
    #       (le, reg21, -1000000),
    #       (display_message, "@reg21 very negative"),
    #       (assign, reg21, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg22, 1000000),
    #       (display_message, "@reg22 very high"),
    #       (assign, reg22, 0),
    #     (else_try),
    #       (le, reg22, -1000000),
    #       (display_message, "@reg22 very negative"),
    #       (assign, reg22, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg23, 1000000),
    #       (display_message, "@reg23 very high"),
    #       (assign, reg23, 0),
    #     (else_try),
    #       (le, reg23, -1000000),
    #       (display_message, "@reg23 very negative"),
    #       (assign, reg23, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg24, 1000000),
    #       (display_message, "@reg24 very high"),
    #       (assign, reg24, 0),
    #     (else_try),
    #       (le, reg24, -1000000),
    #       (display_message, "@reg24 very negative"),
    #       (assign, reg24, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg25, 1000000),
    #       (display_message, "@reg25 very high"),
    #       (assign, reg25, 0),
    #     (else_try),
    #       (le, reg25, -1000000),
    #       (display_message, "@reg25 very negative"),
    #       (assign, reg25, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg26, 1000000),
    #       (display_message, "@reg26 very high"),
    #       (assign, reg26, 0),
    #     (else_try),
    #       (le, reg26, -1000000),
    #       (display_message, "@reg26 very negative"),
    #       (assign, reg26, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg27, 1000000),
    #       (display_message, "@reg27 very high"),
    #       (assign, reg27, 0),
    #     (else_try),
    #       (le, reg27, -1000000),
    #       (display_message, "@reg27 very negative"),
    #       (assign, reg27, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg28, 1000000),
    #       (display_message, "@reg28 very high"),
    #       (assign, reg28, 0),
    #     (else_try),
    #       (le, reg28, -1000000),
    #       (display_message, "@reg28 very negative"),
    #       (assign, reg28, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg29, 1000000),
    #       (display_message, "@reg29 very high"),
    #       (assign, reg29, 0),
    #     (else_try),
    #       (le, reg29, -1000000),
    #       (display_message, "@reg29 very negative"),
    #       (assign, reg29, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg30, 1000000),
    #       (display_message, "@reg30 very high"),
    #       (assign, reg30, 0),
    #     (else_try),
    #       (le, reg30, -1000000),
    #       (display_message, "@reg30 very negative"),
    #       (assign, reg30, 0),
    #     (try_end),
    #     (try_begin),
    #       (ge, reg31, 1000000),
    #       (display_message, "@reg31 very high"),
    #       (assign, reg31, 0),
    #     (else_try),
    #       (le, reg31, -1000000),
    #       (display_message, "@reg31 very negative"),
    #       (assign, reg31, 0),
    #     (try_end),
    #     (assign, reg32, 0),
    #     (assign, reg33, 0),
    #     (assign, reg34, 0),
    #     (assign, reg35, 0),
    #     (assign, reg36, 0),
    #     (assign, reg37, 0),
    #     (assign, reg38, 0),
    #     (assign, reg39, 0),
    #     (assign, reg40, 0),
    #     (assign, reg41, 0),
    #     (assign, reg42, 0),
    #     (assign, reg43, 0),
    #     (assign, reg44, 0),
    #     (assign, reg45, 0),
    #     (assign, reg46, 0),
    #     (assign, reg47, 0),
    #     (assign, reg48, 0),
    #     (assign, reg49, 0),
    #     (assign, reg50, 0),
    #     (assign, reg51, 0),
    #     (assign, reg52, 0),
    #     (assign, reg53, 0),
    #     (assign, reg54, 0),
    #     (assign, reg55, 0),
    #     (assign, reg56, 0),
    #     (assign, reg57, 0),
    #     (assign, reg58, 0),
    #     (assign, reg59, 0),
    #     (assign, reg60, 0),
    #     (assign, reg61, 0),
    #     (assign, reg62, 0),
    #     (assign, reg63, 0),
    #     # (set_fixed_point_multiplier, 1),
    #     # (try_for_range, ":register", 31, 64),
    #       # (convert_to_fixed_point, ":register"),
    #       # (ge, reg(":register"), 1000000),
    #       # (convert_from_fixed_point, ":register"),
    #       # (assign, reg0, ":register"),
    #       # (display_message, "@reg{reg0} very high"),
    #     # (else_try),
    #       # (convert_to_fixed_point, ":register"),
    #       # (le, reg(":register"), -1000000),
    #       # (convert_from_fixed_point, ":register"),
    #       # (assign, reg0, ":register"),
    #       # (display_message, "@reg{reg0} very negative"),
    #     # (try_end),
    #     (try_begin),
    #       (ge, reg65, 1000000),
    #       (display_message, "@reg65 very high"),
    #       (assign, reg65, 0),
    #     (else_try),
    #       (le, reg65, -1000000),
    #       (display_message, "@reg65 very negative"),
    #       (assign, reg65, 0),
    #     (try_end),
    #     ]),

      ("camp_cheat_0",[],"{!}Increase player right to rule.",
       [
          (try_begin),
            (this_or_next|key_is_down, key_left_shift),
            (key_is_down, key_right_shift),
            (call_script, "script_change_player_right_to_rule", 25),
          (else_try),
            (call_script, "script_change_player_right_to_rule", 3),
          (try_end),
        ]
       ),

      ("camp_cheat_1",[],"{!}Increase player renown.",
       [
          (try_begin),
            (this_or_next|key_is_down, key_left_shift),
            (key_is_down, key_right_shift),
            (call_script, "script_change_troop_renown", "trp_player", 500),
          (else_try),
            (call_script, "script_change_troop_renown", "trp_player", 100),
          (try_end),
        ]
       ),
      ("camp_cheat_1",[],"{!}Decrease player renown.",
       [
          (try_begin),
            (this_or_next|key_is_down, key_left_shift),
            (key_is_down, key_right_shift),
            (call_script, "script_change_troop_renown", "trp_player", -500),
          (else_try),
            (call_script, "script_change_troop_renown", "trp_player", -100),
          (try_end),
        ]
       ),

      ("camp_cheat_2",[],"{!}Increase player honor.",
       [
          (try_begin),
            (this_or_next|key_is_down, key_left_shift),
            (key_is_down, key_right_shift),
            (call_script, "script_change_player_honor", 50),
            (call_script, "script_add_piety", 50, 1),
          (else_try),
            (call_script, "script_change_player_honor", 5),
            (call_script, "script_add_piety", 5, 1),
          (try_end),
        ]
       ),

     ("camp_cheat_2",[],"{!}Decrease player honor.",
       [
          (try_begin),
            (this_or_next|key_is_down, key_left_shift),
            (key_is_down, key_right_shift),
            (call_script, "script_change_player_honor", -50),
            (call_script, "script_add_piety", -50, 1),
          (else_try),
            (call_script, "script_change_player_honor", -5),
            (call_script, "script_add_piety", -5, 1),
          (try_end),
        ]
       ),

      ("camp_cheat_3",[(troop_slot_eq, "trp_global_variables", g_is_dev, 1),],"{!}Update political notes.",
       [
         (try_for_range, ":hero", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":hero", slot_troop_occupation, slto_kingdom_hero),
           (call_script, "script_update_troop_political_notes", ":hero"),
         (try_end),

         (try_for_range, ":kingdom", kingdoms_begin, kingdoms_end),
           (call_script, "script_update_faction_political_notes", ":kingdom"),
         (try_end),
        ]
       ),

      ("camp_cheat_4",[(troop_slot_eq, "trp_global_variables", g_is_dev, 1),],"{!}Update troop notes.",
       [
         (try_for_range, ":hero", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":hero", slot_troop_occupation, slto_kingdom_hero),
           (call_script, "script_update_troop_notes", ":hero"),
         (try_end),

         (try_for_range, ":lady", kingdom_ladies_begin, kingdom_ladies_end),
           (call_script, "script_update_troop_notes", ":lady"),
           (call_script, "script_update_troop_political_notes", ":lady"),
           (call_script, "script_update_troop_location_notes", ":lady", 0),
         (try_end),
        ]
       ),

       # #SB : update tavern npcs
      # ("camp_cheat_5",[],"{!}Scramble taverngoers.",
       # [
        # (try_for_range, ":slots", slot_center_ransom_broker, slot_center_tavern_minstrel + 1),
          # (neq, ":slots", slot_center_traveler_info_faction),
          # #initialize
          # (try_for_range, ":towns", towns_begin, towns_end),
            # (party_set_slot, ":towns", ":slots", -1),
          # (try_end),

          # (try_begin), #parse
            # (eq, ":slots", slot_center_ransom_broker),
            # (assign, ":start", ransom_brokers_begin),
            # (assign, ":end", ransom_brokers_end),
          # (else_try),
            # (eq, ":slots", slot_center_tavern_traveler),
            # (assign, ":start", tavern_travelers_begin),
            # (assign, ":end", tavern_travelers_end),
          # (else_try),
            # (eq, ":slots", slot_center_tavern_minstrel),
            # (assign, ":start", tavern_minstrels_begin),
            # (assign, ":end", tavern_minstrels_end),
          # (else_try),
            # (eq, ":slots", slot_center_tavern_bookseller),
            # (assign, ":start", tavern_booksellers_begin),
            # (assign, ":end", tavern_booksellers_end),
          # (try_end),

          # #populate
          # (assign, ":num_towns", 0),
          # (str_store_string, s51, "@nowhere in particular"),
          # (try_for_range, ":troop_no", ":start", ":end"),
            # (troop_set_slot, ":troop_no", slot_troop_cur_center, -1),
            # (store_random_in_range, ":town_no", towns_begin, towns_end),

            # (try_begin), #ensure no overlaps
              # (party_slot_ge, ":town_no", ":slots", ":start"),
              # # (assign, ":limit", towns_end),
              # # (try_for_range, ":center_no", towns_begin, ":limit"),
                # # (assign, ":town_used", 0),
                # # (try_for_range, ":other_troop", ":start", ":troop_no"),
                  # # (troop_slot_eq, ":other_troop", slot_troop_cur_center, ":center_no"),
                  # # (assign, ":town_used", 1),
                # # (try_end),
                # # (eq, ":town_used", 0), #no other troop uses this slot
                # # (party_set_slot, ":center_no", ":slots", ":troop_no"),
                # # (assign, ":limit", 1),
              # # (try_end),
            # (else_try),
              # (val_add, ":num_towns", 1),
              # (str_store_party_name_link, s50, ":town_no"),
              # (party_set_slot, ":town_no", ":slots", ":troop_no"),
              # (troop_set_slot, ":troop_no", slot_troop_cur_center, ":town_no"),
              # (try_begin),
                # (eq, ":num_towns", 1),
                # (str_store_string, s51, s50),
              # (else_try),
                # (str_store_string, s51, "str_s50_comma_s51"),
              # (try_end),
            # (try_end),
          # (try_end),
          # (str_store_troop_name_plural, s10, ":start"), #default titles "book_merchant" "ransom_broker" etc
          # (str_store_string_reg, s11, s51),
          # (display_message, "@You can find {s10}s at {s11}."),
        # (try_end),
        # (call_script, "script_update_mercenary_units_of_towns"), #might as well
        # ]
       # ),

      ("camp_cheat_6",[(troop_slot_eq, "trp_global_variables", g_is_dev, 1),],"{!}Infinite camp",
       [
         (assign,"$g_camp_mode", 1),
         (assign, "$g_infinite_camping", 1),
         (assign, "$g_player_icon_state", pis_camping),
         (rest_for_hours_interactive, 10 * 24 * 365, 20), #10 year rest while not attackable with 20x speed
         (change_screen_return),
        ]
       ),

	   ##nested diplomacy start+
	  # ("camp_cheat_7",[
      # (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
      # (troop_slot_ge, "trp_player", slot_troop_spouse, 1),],"{!}Divorce player spouse",
       # [
	 	 # (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
        # #set this before the loop below, to avoid potential wierdness in the family relation check
		 # (troop_set_slot, ":spouse", slot_troop_spouse, -1),
	     # (troop_set_slot, "trp_player", slot_troop_spouse, -1),

		# #apply relation loss with the spouse
		 # (call_script, "script_change_player_relation_with_troop", ":spouse", -40),
	    # #change relations with family - inverse of gain from marriage
		# (try_for_range, ":family_member", heroes_begin, kingdom_ladies_end),
		    # (neq, ":family_member", ":spouse"),
			# (call_script, "script_dplmc_troop_get_family_relation_to_troop", ":spouse", ":family_member"),
			# (gt, reg0, 0),
			# (val_mul, reg0, -2),
			# (val_div, reg0, 3),
			# (val_min, reg0, -1),
			# (call_script, "script_change_player_relation_with_troop", ":family_member", reg0),
		# (try_end),
        # ]
       # ),
	   ##nested diplomacy end+

      ("cheat_faction_orders",[(ge,"$cheat_mode",1),
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
      ],
	  "{!}Cheat: Set Debug messages to All.",
       [(assign,"$cheat_mode",1),
         (jump_to_menu, "mnu_camp_cheat"),
        ]
       ),
      ("cheat_faction_orders",[
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
	  (ge, "$cheat_mode", 1),
	  (neq,"$cheat_mode",3)],"{!}Cheat: Set Debug messages to Econ Only.",
       [(assign,"$cheat_mode",3),
         (jump_to_menu, "mnu_camp_cheat"),
        ]
       ),
      ("cheat_faction_orders",[
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
	  (ge, "$cheat_mode", 1),
	  (neq,"$cheat_mode",4)],"{!}Cheat: Set Debug messages to Political Only.",
       [(assign,"$cheat_mode",4),
         (jump_to_menu, "mnu_camp_cheat"),
        ]
       ),
      # ("camp_cheat_heal",[],"Heal party.",
       # [
         # (heal_party, "p_main_party"),
        # ]
       # ),
    ("camp_cheat_xp",[
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
    ],"Add xp to party.",[
      (set_show_messages, 0),
      (party_get_num_companion_stacks, ":num_stacks", "p_main_party"),
      (try_for_range, ":stack", 0, ":num_stacks"), #include player if too lazy to ctrl+x
          (party_stack_get_troop_id, ":id", "p_main_party", ":stack"),
          (try_begin),
              # (troop_is_hero, ":id"),
              # (store_character_level, ":level", ":id"),
              # (get_level_boundary, ":xp", ":level"),
              # (troop_get_xp, ":cur_exp", ":id"),
              # (val_sub, ":xp", ":cur_exp"),
              # (add_xp_to_troop, ":xp", ":id"),
          # (else_try),
              (party_stack_get_size, ":size", "p_main_party", ":stack"),
              (call_script, "script_game_get_upgrade_xp", ":id"),
              (store_mul, ":xp", reg0, ":size"),
              (try_begin),
                (troop_is_hero, ":id"),
                # (troop_get_xp, ":cur_exp", ":id"),
                # (val_sub, ":xp", ":cur_exp"),
                (store_character_level, ":level", ":id"),
                ##this is so stupid but it works (probably), but add_xp_to_troop caps out at 29999
                (assign, ":end", 100),
                (try_begin), #assign block of exp
                  (le, ":level", 10),
                  (assign, ":xp", 100),
                (else_try),
                  (le, ":level", 25),
                  (assign, ":xp", 1000),
                (else_try), #most people stop before level 30
                  (le, ":level", 35),
                  (assign, ":xp", 10000),
                (else_try),
                  (le, ":level", 50),
                  (assign, ":xp", 30000),
                (else_try),
                  (le, ":level", 60),
                  (assign, ":xp", 1000000),
                (else_try), #good luck, level caps at 63
                  (assign, ":xp", 10000000),
                (try_end),
                # (val_mul, ":xp", ":level"),
                (try_for_range, ":unused", 0, ":end"),
                  (party_add_xp_to_stack, "p_main_party", ":stack", ":xp"),
                  (add_xp_to_troop, 1, ":id"), #this actually upgrades the level
                  # (add_xp_as_reward, ":xp"),
                  (store_character_level, ":cur_level", ":id"),
                  (lt, ":level", ":cur_level"), #done
                  (assign, ":end", 0),
                (try_end),
              (else_try),
                (party_add_xp_to_stack, "p_main_party", ":stack", ":xp"),
              (try_end),
          (try_end),
      (try_end),
      (set_show_messages, 1),
      # (party_upgrade_with_xp, "p_main_party", 1, 0), #random upgrade - disabled
      # (jump_to_menu, "mnu_camp_cheat"),
    ]),
      # ("camp_cheat_prisoner",[
          # (party_get_num_prisoner_stacks, ":stack", "p_main_party"),
          # (gt, ":stack", 0),
          # (try_for_range, ":i_stack", 0, ":stack"),
            # (party_prisoner_stack_get_troop_id, ":troop", "p_main_party", ":i_stack"),
            # (neg|troop_is_hero, ":troop"),
            # (assign, ":stack", 0),
          # (try_end),
          # (eq, ":stack", 0), #found one non-hero entity
      # ],"Recruit all prisoners.",
       # [ # (call_script, "script_party_add_party_prisoners"),
         # # (call_script, "script_party_remove_all_prisoners"),
         # (party_get_num_prisoner_stacks, ":num_stacks", "p_main_party"),
         # (try_for_range_backwards, ":stack", 0, ":num_stacks"),
            # (party_prisoner_stack_get_troop_id, ":troop", "p_main_party", ":stack"),
            # (neg|troop_is_hero, ":troop"),
            # (gt, ":troop", 0),
            # (party_prisoner_stack_get_size, ":amount", "p_main_party", ":stack"),
            # (party_remove_prisoners, "p_main_party", ":troop", ":amount"),
            # (party_add_members, "p_main_party", ":troop", ":amount"),
         # (try_end),
         # # (jump_to_menu, "mnu_camp_cheat"),
        # ]
       # ),
       #do not add more cheat options, no more room in one menu
    ("back_to_camp_menu",[],"Grain prices.",[
      (try_for_range, ":center", centers_begin, centers_end),
          (store_sub, ":item_slot_no", "itm_grain", trade_goods_begin),
          (val_add, ":item_slot_no", slot_town_trade_good_prices_begin),
          (party_get_slot, ":price_factor", ":center", ":item_slot_no"),
          (val_mul, ":price_factor", 100), #normalize price factor to range 0..100
          (val_div, ":price_factor", average_price_factor),
          (assign, reg1, ":price_factor"),
          (str_store_party_name, s1, ":center"),
          (display_message, "@{s1}: grain price: {reg1}"),
      (try_end),
    ]),


    ("back_to_camp_menu",[],"{!}Back to camp menu.",[
      (jump_to_menu, "mnu_camp"),
    ]),
]),

  ("cheat_find_item",0,
   "{!}Current item range: {reg5} to {reg6}",
   "none",
   [

    (assign, reg5, "$cheat_find_item_range_begin"),
    (store_add, reg6, "$cheat_find_item_range_begin", max_inventory_items),
    (val_min, reg6, itm_items_end),
    (val_sub, reg6, 1),
     ],
    [

    #SB : easier debug
      ("cheat_find_item_prev_range",[], "{!}Move to previous range.",
       [
        (val_sub, "$cheat_find_item_range_begin", max_inventory_items),
        (try_begin),
          (lt, "$cheat_find_item_range_begin", 0),
          (assign, "$cheat_find_item_range_begin", itm_items_end-max_inventory_items),
        (try_end),
        (jump_to_menu, "mnu_cheat_find_item"),
       ]
       ),
      ("cheat_find_item_next_range",[], "{!}Move to next item range.",
       [
        (val_add, "$cheat_find_item_range_begin", max_inventory_items),
        (try_begin),
          (ge, "$cheat_find_item_range_begin", itm_items_end),
          (assign, "$cheat_find_item_range_begin", 0),
        (try_end),
        (jump_to_menu, "mnu_cheat_find_item"),
       ]
       ),

       ("cheat_find_item_choose_this",[], "{!}Choose from this range.",
       [
        (troop_clear_inventory, "trp_find_item_cheat"),
        (store_add, ":max_item", "$cheat_find_item_range_begin", max_inventory_items),
        (val_min, ":max_item", itm_items_end),
        (store_sub, ":num_items_to_add", ":max_item", "$cheat_find_item_range_begin"),
        (try_begin), #SB : even more super-cheats
          (this_or_next|key_is_down, key_left_shift),
          (key_is_down, key_right_shift),
          (try_for_range, ":i_slot", 0, ":num_items_to_add"),
            (store_add, ":item_id", "$cheat_find_item_range_begin", ":i_slot"),
            (item_get_type, ":i_type", ":item_id"),
            (try_begin),
              (eq, ":i_type", itp_type_horse),
              (troop_add_item, "trp_find_item_cheat", ":item_id", imod_champion),
            (else_try),
              (this_or_next|eq, ":i_type", itp_type_shield),
              (is_between, ":i_type", itp_type_head_armor, itp_type_pistol),
              (troop_add_item, "trp_find_item_cheat", ":item_id", imod_lordly),
            (else_try),
              (this_or_next|is_between, ":i_type", itp_type_one_handed_wpn, itp_type_goods),
              (is_between, ":i_type", itp_type_pistol, itp_type_animal),
              (troop_add_item, "trp_find_item_cheat", ":item_id", imod_masterwork),
            (else_try),
              (troop_add_item, "trp_find_item_cheat", ":item_id", imod_plain),
            (try_end),
          (try_end),
          (change_screen_loot, "trp_find_item_cheat"),
        (else_try), #Native behaviour
          (try_for_range, ":i_slot", 0, ":num_items_to_add"),
            (store_add, ":item_id", "$cheat_find_item_range_begin", ":i_slot"),
            (troop_add_items, "trp_find_item_cheat", ":item_id", 1),
          (try_end),
          (change_screen_trade, "trp_find_item_cheat"),

        (try_end),
       ]
       ),

       ("camp_action_4",[],"{!}Back to camp menu.",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

   ("cheat_change_weather",0,
   "{!}Current cloud amount: {reg5}^Current Fog Strength: {reg6}",
   "none",
   [
     (get_global_cloud_amount, reg5),
     (get_global_haze_amount, reg6),
     ],
    [
      ("cheat_increase_cloud",[], "{!}Increase Cloud Amount.",
       [
	    (get_global_cloud_amount, ":cur_cloud_amount"),
		(val_add, ":cur_cloud_amount", 5),
		(val_min, ":cur_cloud_amount", 100),
	    (set_global_cloud_amount, ":cur_cloud_amount"),
	   ]
       ),
      ("cheat_decrease_cloud",[], "{!}Decrease Cloud Amount.",
       [
	    (get_global_cloud_amount, ":cur_cloud_amount"),
		(val_sub, ":cur_cloud_amount", 5),
		(val_max, ":cur_cloud_amount", 0),
	    (set_global_cloud_amount, ":cur_cloud_amount"),
	   ]
       ),
      ("cheat_increase_fog",[], "{!}Increase Fog Amount.",
       [
	    (get_global_haze_amount, ":cur_fog_amount"),
		(val_add, ":cur_fog_amount", 5),
		(val_min, ":cur_fog_amount", 100),
	    (set_global_haze_amount, ":cur_fog_amount"),
	   ]
       ),
      ("cheat_decrease_fog",[], "{!}Decrease Fog Amount.",
       [
	    (get_global_haze_amount, ":cur_fog_amount"),
		(val_sub, ":cur_fog_amount", 5),
		(val_max, ":cur_fog_amount", 0),
	    (set_global_haze_amount, ":cur_fog_amount"),
	   ]
       ),

      ("camp_action_4",[],"{!}Back to camp menu.",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

("camp_action",0,
  "Choose an action:",
  "none",
  [],[
    # does not work
    # ("camp_action",[
    #   (eq, "$g_campaign_type", g_campaign_story_rome),
    #   (ge, "$cheat_mode", 1),
    # ],"Cheat: Progress to battle of Bedriacum in story (Vespasian).",[
    #   # finish start quests
    #   #Finish quest 1
    #   (call_script, "script_succeed_quest", "qst_collect_men"),
    #   (call_script, "script_end_quest", "qst_collect_men"),
    #   #Setup quest 2: find location of brother
    #   (str_store_party_name, s9, "$current_town"),
    #   (str_store_string, s2, "str_start_up_quest_message_2"),
    #   (call_script, "script_start_quest", "qst_learn_where_merchant_brother_is", "$g_talk_troop"),
    #   #Finish quest 2
    #   (call_script, "script_succeed_quest", "qst_learn_where_merchant_brother_is"),
    #   (call_script, "script_end_quest", "qst_learn_where_merchant_brother_is"),
    #   #Setup quest 3: rescue brother
    #   (str_store_troop_name, s10, "$g_talk_troop"),
    #   (str_store_string, s2, "str_find_the_lair_near_s9_and_free_the_brother_of_the_prominent_s10_merchant"),
    #   (call_script, "script_start_quest", "qst_save_relative_of_merchant", "$g_talk_troop"),
    #   #Finish quest 3
    #   (assign, "$relative_of_merchant_is_found", 1),
    #   (call_script, "script_succeed_quest", "qst_save_relative_of_merchant"),
    #   (call_script, "script_finish_quest", "qst_save_relative_of_merchant", 100),
    #   (troop_add_gold, "trp_player", 200),
    #   #Setup quest 4: fight bandits
    #   (str_store_party_name_link, s9, "$g_starting_town"),
    #   (str_store_string, s2, "str_save_town_from_bandits"),
    #   (call_script, "script_start_quest", "qst_save_town_from_bandits", "$g_talk_troop"),
    #   #Finish quest 4
    #   (assign, "$current_startup_quest_phase", 4),
    #   (call_script, "script_change_player_relation_with_center", "$g_starting_town", 1),
    #   (troop_add_gold, "trp_player", 200),
    #   (call_script, "script_succeed_quest", "qst_save_town_from_bandits"),
    #   (call_script, "script_end_quest", "qst_save_town_from_bandits"),
    #   #So he'll reappear in the tavern (unless you don't immediately speak with him)
    #   (assign, "$dialog_with_merchant_ended", 1),
    #   (assign, "$g_do_one_more_meeting_with_merchant", 1),

    #   (call_script, "script_succeed_quest", "qst_poking_the_lion"),
    #   (call_script, "script_end_quest", "qst_poking_the_lion"),

    #   (str_store_troop_name_link, s22, "trp_senator_1"),
    #   (str_store_troop_name_link, s23, "trp_legatus_11"),
    #   (str_store_troop_name_link, s24, "trp_statthalter_9"),
    #   (str_store_troop_name_link, s25, "trp_senator_2"),

    #   (add_quest_note_from_sreg, "qst_blank_quest_19", 6, "@You staged a revolt in Judea! Now you need to find allies among {s22}, {s23}, {s24} or {s25}.", 1),

    #   (str_store_string, s2, "@Antonia ordered you to gain the trust of either {s22}, {s23}, {s24} or {s25}. Antonia favors {s23}, but you can choose whomever you like.^(Hint: Improve your relation to be at least 50 and have 750 influence points, then in the influence-dialogue-menu a new dialogue option will appear.)"),
    #   (quest_set_slot, "qst_four_emperors", slot_quest_current_state, 1),
    #   (call_script, "script_start_quest", "qst_four_emperors", "trp_fortuna"),

    #   (assign, "$jewish_revolt", 1),

    #   (call_script, "script_add_notification_menu", "mnu_player_raises_to_nobility",0,0),#make player join rome

    #   (call_script, "script_add_notification_menu", "mnu_fire_of_rome", 0, 0), # fire of rome

    #   (troop_add_gold, "trp_player", 10000000),
    #   (troop_set_slot, "trp_player", slot_troop_influence, 10000),
    #   (troop_set_slot, "trp_player", slot_troop_renown, 10000),
    #   (quest_set_slot, "qst_four_emperors", slot_quest_current_state, 5),
    #   (quest_set_slot, "qst_four_emperors", slot_quest_timer, 1),
    #   (quest_set_slot, "qst_four_emperors", slot_quest_target_troop, "trp_legatus_11"),

    #   (setup_quest_text,"qst_blank_quest_19"),
    #   (str_store_string, s2, "@You descended into Hades and talked with several great figures. Among them the oracle Teiresias foretold your future: One day you would bear the title of Caesar Augustus and rule in Rome."),
    #   (call_script, "script_start_quest", "qst_blank_quest_19", "trp_fortuna"),
    #   (quest_set_slot, "qst_blank_quest_19", slot_quest_object_state, 5),
    #   (change_screen_map),
    # ]),
    # ("camp_cheat", [(ge, "$cheat_mode", 1)], "Find Roman parties",[
    #   (display_message, "@Searching for roman parties"),
    #   (display_message, "@name; type; template;"),
    #   (try_for_parties, ":party"),
    #     (party_is_active, ":party"),
    #     (store_faction_of_party, ":faction", ":party"),
    #     (eq, ":faction", "fac_kingdom_7"),
    #     (party_get_template_id, ":template", ":party"),
    #     (assign, reg10, ":template"),
    #     (str_store_party_name, s10, ":party"),
    #     (party_get_slot, reg11, ":party", slot_party_type),
    #     (display_message, "@{s10}; {reg11}; {reg10}"),
    #     # (party_relocate_near_party, ":party", "p_main_party", 2),
    #   (try_end),
    #   (display_message, "@End"),
    # ]),
    ("camp_action",[
    ],"Show legendary items.",[
      (assign, "$cheat_find_item_range_begin", 0),
      (assign,"$current_item",-1),
      (assign,"$selected_item",-1),

      (start_presentation, "prsnt_display_special_items"),
    ]),

    # ("camp_action",[
    # ],"Debug sulla event.",[
    #   (jump_to_menu, "mnu_freelancer_event_pret_9"),
    # ]),

    # ("camp_action",[
    # ],"Export volunteer limits.",[
    #   ## init recruits for player recruitement
    #   (display_message, "@type, province, center, peasants, nobles, mercs"),
    #   (try_for_range, ":center_no", centers_begin, centers_end),
    #       (call_script, "script_get_volunteer_limits", ":center_no"),
    #       (party_set_slot, ":center_no", slot_center_peasant_troop_amount, reg1),
    #       (party_set_slot, ":center_no", slot_center_volunteer_noble_troop_amount, reg2),
    #       (party_set_slot, ":center_no", slot_center_mercenary_troop_amount, reg3),
    #       (str_store_party_name, s10, ":center_no"),
    #       (try_begin),
    #           (is_between, ":center_no", villages_begin, villages_end),
    #           (str_store_string, s11, "@village"),
    #       (else_try),
    #           (is_between, ":center_no", castles_begin, castles_end),
    #           (str_store_string, s11, "@castle"),
    #       (else_try),
    #           (str_store_string, s11, "@town"),
    #       (try_end),
    #       (party_get_slot, ":province", ":center_no", slot_center_province),
    #       (val_add, ":province", str_province_begin),
    #       (str_store_string, s12, ":province"),
    #       (display_message, "@{s11}, {s12}, {s10}, {reg1}, {reg2}, {reg3}"),
    #   (try_end),
    # ]),
    # ("camp_action",[
    # ],"Test scene.",[
    #   #1,2 player antonia,
    #   #3-10: guards
    #   #11-36 people
    #   #37 camera
    #   (jump_to_scene, "scn_cutscene_rome_victory_2"),
    #   (change_screen_mission),
    # ]),
    # ("camp_action",[
    #   (ge, "$cheat_mode", 1)
    # ],"CHEAT add all legendary items.",[
    #   (try_for_range, ":item", legendary_items_begin, legendary_items_end),
    #       (troop_add_item, "trp_player", ":item", 0),
    #   (try_end),
    # ]),
    # Original camp menus
    ("camp_action",[
      (ge, "$cheat_mode", 1)
    ],"CHEAT ACTIVATE SPORUS.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 17),
      (troop_set_slot, "trp_sporus", slot_troop_betrothed, 0),
      (change_screen_map),
    ]),
    # ("camp_action",[
    # ],"Test event",[
    #   (jump_to_menu, "mnu_emperor_event_26"),
    # ]),
    # ("camp_action",[
    #   (ge, "$cheat_mode", 1)
    # ],"Test marshal election.",[
    #   (faction_set_slot, "fac_kingdom_7", slot_faction_political_issue, 1),
    #   (call_script, "script_npc_decision_checklist_take_stand_on_issue", "trp_kingdom_7_lord"),
    #   (change_screen_map),
    # ]),
    ("camp_action",[
      (ge, "$cheat_mode", 1),
    ],"CHEAT skip wlod 1 and wlod 2 and wlod 3 and 4.",[
      (troop_set_slot, "trp_olivarius", slot_troop_met, 1),
      (troop_set_slot, "trp_wlodowiecus", slot_troop_met, 1),
      (troop_set_slot, "trp_hadrianus", slot_troop_met, 1),
      (troop_set_slot, "trp_varus", slot_troop_met, 1),
      (troop_set_slot, "trp_old_mercenary", slot_troop_met, 1),
      (troop_set_slot, "trp_mancinellus", slot_troop_met, 1),

      (troop_set_slot, "trp_lybian", slot_troop_met, 1),
      (troop_set_slot, "trp_chinese_commander", slot_troop_met, 1),
      (troop_set_slot, "trp_temur", slot_troop_met, 1),
      (troop_set_slot, "trp_xiao", slot_troop_met, 1),
      (troop_set_slot, "trp_alan_guide", slot_troop_met, 1),
      (troop_set_slot, "trp_ali", slot_troop_met, 1),
      (troop_set_slot, "trp_phamanus", slot_troop_met, 1),

      (add_xp_as_reward, 10000000),
      (call_script, "script_start_quest", "qst_wlodowiecus_adventure_1", "trp_fortuna"),
      (quest_set_slot, "qst_wlodowiecus_adventure_1", slot_quest_current_state, 6),
      (call_script, "script_end_quest", "qst_wlodowiecus_adventure_1", "trp_fortuna"),
      (call_script, "script_start_quest", "qst_wlodowiecus_adventure_2", "trp_fortuna"),
      (quest_set_slot, "qst_wlodowiecus_adventure_2", slot_quest_current_state, 6),
      (call_script, "script_end_quest", "qst_wlodowiecus_adventure_2", "trp_fortuna"),
      (call_script, "script_start_quest", "qst_wlodowiecus_adventure_3", "trp_fortuna"),
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 12),
      (call_script, "script_end_quest", "qst_wlodowiecus_adventure_3", "trp_fortuna"),
      (call_script, "script_start_quest", "qst_wlodowiecus_adventure_4", "trp_fortuna"),
      (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 13),
      (call_script, "script_end_quest", "qst_wlodowiecus_adventure_4", "trp_fortuna"),

      (store_current_day, ":day"),
      (val_max, ":day", 1),
      (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_timer, ":day"),

      (change_screen_map),
    ]),

    ("camp_cheat",[
      (ge, "$cheat_mode", 1)
    ], "CHEATS!",[
      (jump_to_menu, "mnu_camp_cheat"),
    ]),
    # ("action_view_world_map",[
    #   (ge, "$cheat_mode", 1),
    # ],"Change your culture",[
    #   (jump_to_menu, "mnu_select_culture"),
    # ]),

    ("options",[
      (faction_slot_eq, "fac_kingdom_25", slot_faction_state, sfs_active),
      (ge, "$cheat_mode", 1),
    ],"CONQUER JUDEA BY VESPASIAN.",[
      (try_for_range, ":center", walled_centers_begin, walled_centers_end),
          (store_faction_of_party, ":fac", ":center"),
          (eq, ":fac", "fac_kingdom_17"),
          (call_script, "script_give_center_to_faction", ":center", "fac_kingdom_25"),
      (try_end),
    ]),

    ("options",[
      (faction_slot_eq, "fac_kingdom_27", slot_faction_state, sfs_active),
      (ge, "$cheat_mode", 1),
    ],"CONQUER VITELLIUS MAN BA BY GALBA.",[
      (try_for_range, ":center", walled_centers_begin, walled_centers_end),
          (store_faction_of_party, ":fac", ":center"),
          (eq, ":fac", "fac_kingdom_26"),
          (call_script, "script_give_center_to_faction", ":center", "fac_kingdom_27"),
      (try_end),
    ]),

    ("options",[
      (ge, "$cheat_mode", 1),
    ],"MORE CHEATS.",[
      (jump_to_menu, "mnu_cheat_menu2"),
    ]),

    # ("options",[
    # ],"Increase level by 2.",[
    #   (call_script, "script_raise_level", "trp_player", 2),
    # ]),

    # ("options",[
    # ],"Increase level by 3.",[
    #   (call_script, "script_raise_level", "trp_player", 3),
    # ]),

    # ("options",[
    # ],"Show level boundaries.",[
    #   (assign, ":previous_level_boundary", 0),
    #   (try_for_range, ":level", 0, 63),
    #       (assign, reg20, ":level"),

    #       (get_level_boundary, reg21, reg20),

    #       (store_sub, reg22, reg21, ":previous_level_boundary"),
    #       (display_message, "@level {reg20} requires {reg21} exp. Diff to previous: {reg22}"),
    #       (assign, ":previous_level_boundary", reg21),
    #   (try_end),
    # ]),

    # ("back_to_camp_menu",[],"Check for invalid parties",[
    #   (assign, reg22, 0),
    #   (assign, reg23, 0),
    #   (try_for_parties, ":party"),
    #     (party_is_active, ":party"),
    #     (gt, ":party", last_static_party),
    #     (store_party_size_wo_prisoners, reg20, ":party"),
    #     (le, reg20, 0),
    #     (str_store_party_name, s20, ":party"),
    #     (display_message, "@{s20}: {reg20} (size)"),
    #     (val_add, reg23, 1),
    #   (else_try),
    #     (gt, ":party", last_static_party),
    #     (display_message, "@Inactive party"),
    #     (val_add, reg22, 1),
    #   (try_end),
    #   (display_message, "@Active invalide parties: {reg23}, Inactive parties: {reg22}"),
    # ]),

    # ("back_to_camp_menu",[],"Export trade good prices as csv to log",[
    #   (str_store_string, s2, "@towns"),
    #   (try_for_range, ":items", trade_goods_begin, trade_goods_end),
    #       (str_store_item_name, s1, ":items"),
    #       (str_store_string, s2, "@{s2}, {s1}"),
    #   (try_end),

    #   (store_sub, ":trade_good_slot_ends", trade_goods_end, trade_goods_begin),
    #   (val_add, ":trade_good_slot_ends", slot_town_trade_good_prices_begin),
    #   (try_for_range, ":towns", towns_begin, towns_end),
    #       (str_store_party_name, s1, ":towns"),
    #       (str_store_string, s2, "@{s2}^{s1}"),
    #       (try_for_range, ":cur_goods_price", slot_town_trade_good_prices_begin, ":trade_good_slot_ends"),
    #         (party_get_slot, reg1, ":towns", ":cur_goods_price"),
    #         (str_store_string, s2, "@{s2}, {reg1}"),
    #       (try_end),
    #   (try_end),
    #   (display_message, "@{s2}"),
    # ]),
    # ("options",[
    #   (ge, "$cheat_mode", 1),
    # ],"test capital.",[
    #   (try_for_range, ":walled_center", centers_begin, centers_end),
    #       (party_get_slot, reg22, ":walled_center", slot_center_capital),
    #       (str_store_party_name, s22, ":walled_center"),
    #       (display_message, "@{s22}: {reg22} denars wealth"),
    #   (try_end),
    # ]),

    # ("options",[
    #   (ge, "$cheat_mode", 1),
    #   (ge, "$g_civil_war", 1),
    #   (faction_slot_eq, "fac_kingdom_25", slot_faction_state, sfs_active),
    # ],"CHEAT: End civil war vespasian",[
    #   (call_script, "script_add_notification_menu", "mnu_end_civil_war", "fac_kingdom_25", -1),
    # ]),

    ("options",[
      (ge, "$cheat_mode", 1),
    ],"Add 20,000 denars",[
      (troop_add_gold, "trp_player", 20000),
    ]),

    ("pray",[
      (eq, "$g_wait_judgment", 0),
      (troop_slot_ge, "trp_player", slot_troop_religion, 1),
      (troop_get_slot,":god", "trp_player", slot_troop_religion),
      (store_add, ":string", ":god", "str_gods_begin"),
      (str_store_string, s20, ":string"),
      (lt, "$gods_judgment", 4),
    ], "Pray to {s20}.",[
      (try_begin),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_christus),
          (jump_to_menu, "mnu_gods_judgment_christus"),
          (assign, "$g_wait_judgment", 1),
      # (else_try),
      #     (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
      #     (jump_to_menu, "mnu_gods_judgment_yhwh"),
      #     (assign, "$g_wait_judgment", 1),
      (else_try),
          (neg|troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
          (jump_to_menu, "mnu_gods_judgment"),
          (assign, "$g_wait_judgment", 1),
      (try_end),
    ]),
    ("convert_christianity",[
      (neg|troop_slot_eq, "trp_player", slot_troop_religion, worships_christus),#is not a crhist
      (assign, reg10, 0),
      (try_begin),
          (this_or_next|troop_slot_ge, "trp_memercius", slot_troop_met, 1),#has etiher met one of those
          (troop_slot_ge, "trp_muscullus", slot_troop_met, 1),
          (assign, reg10, 1),
      (else_try),
          (neq, "$g_fire", 0),#or fire happened
          (assign, reg10, 1),
      (try_end),
      (eq, reg10, 1),
    ], "Convert to Christianity.",[
      (jump_to_menu, "mnu_christian"),
    ]),
    ("camp_recruit_prisoners",[
      (party_get_num_prisoners, ":prisoners", "p_main_party"),
      (ge, ":prisoners", 1),
      (troops_can_join, 1),
      (store_current_hours, ":cur_time"),
      (val_sub, ":cur_time", 24),
      (gt, ":cur_time", "$g_prisoner_recruit_last_time"),
      (try_begin),
          (gt, "$g_prisoner_recruit_last_time", 0),
          (assign, "$g_prisoner_recruit_troop_id", 0),
          (assign, "$g_prisoner_recruit_size", 0),
          (assign, "$g_prisoner_recruit_last_time", 0),
      (try_end),
    ], "Recruit some of your prisoners to your party.",[
      (jump_to_menu, "mnu_camp_recruit_prisoners"),
    ]),
    ("camp_recruit_prisoners",[
      (assign, ":num_non_slaves", 0),
      (party_get_num_prisoner_stacks, ":num_stacks", "p_main_party"),
      (assign, ":end_condition", ":num_stacks"),
      (try_for_range_backwards, ":i_stack", 0, ":end_condition"),
          (party_prisoner_stack_get_troop_id, ":stack_troop","p_main_party",":i_stack"),
          (neq, ":stack_troop", "trp_slave"),
          (neq, ":stack_troop", "trp_slave_female"),
          (call_script, "script_game_check_prisoner_can_be_sold", ":stack_troop"),
          (eq, reg0, 1),
          (val_add, ":num_non_slaves", 1),
          (assign, ":end_condition", 0),
      (try_end),
      (ge, ":num_non_slaves", 1),
    ], "Convert your prisoners to slaves.",[
      (jump_to_menu, "mnu_camp_make_slaves"),
    ]),
    ("action_read_book",[],"Select a book to read.",[
      (jump_to_menu, "mnu_camp_action_read_book"),
    ]),
    ("action_food",[],"Change your party's food consumption habits.",[
      (start_presentation, "prsnt_food_options"),
    ]),
    ("camp_change_name",[],"Rename your party.",[
      (assign, "$g_presentation_state", rename_party),
      (assign, "$g_encountered_party", "p_main_party"),
      (start_presentation, "prsnt_name_kingdom"),
    ]),
    ("action_modify_factions_color",[],"Change faction colors.",[
      (assign, "$g_presentation_state", recolor_kingdom),
      (assign, "$temp", 0),
      (try_begin),
          (is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
          (store_sub, "$temp", "$players_kingdom", npc_kingdoms_begin),
          (store_sub, "$temp", 8, "$temp"), #3 to 8 are npc kingdoms
      (else_try),
          (assign, "$temp", 9), #player faction
      (try_end),
      (start_presentation, "prsnt_change_color"),
    ]),
    ("action_rename_kingdom",[
      #SB : use bits
      (store_and, ":name_set", "$players_kingdom_name_set", rename_kingdom),
      (eq, ":name_set", rename_kingdom),
      (faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_active),
      (faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
      (str_store_string, s11, "@kingdom"),
      (try_begin),
          (faction_slot_eq, "fac_player_supporters_faction", slot_faction_government_type, gov_imperial),
          (str_store_string, s11, "@Empire"),
      (try_end),
    ],"Rename your {s11}.",[
      #SB : explicitly state kingdom
      (assign, "$g_presentation_state", rename_kingdom),
      (start_presentation, "prsnt_name_kingdom"),
    ]),
    ("action_change_policies",[
      (gt, "$cheat_mode", 0),
      #SB : name set bits
      (store_and, ":name_set", "$players_kingdom_name_set", rename_kingdom),
      (eq, ":name_set", rename_kingdom),
      (faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_active),
      (faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
    ],"{!}Cheat: Change kingdom policies",[
      (start_presentation, "prsnt_dplmc_policy_management"),
    ]),
    ("action_modify_banner",[
      (this_or_next|troop_slot_ge, "trp_player", slot_troop_banner_scene_prop, 1),
      (troop_slot_eq, "trp_player", slot_troop_banner_scene_prop, -1),
      (neg|is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
    ],"Change your banner.",[
      #(start_presentation, "prsnt_banner_selection"),
      #(start_presentation, "prsnt_custom_banner"),
      (assign, "$g_edit_banner_troop", "trp_player"),
      (assign, "$g_presentation_next_presentation", -1),
      (jump_to_menu, "mnu_choose_banner"),
    ]),
    ("action_retire",[],"Commit suicide. [End game]",[
      (jump_to_menu, "mnu_retirement_verify"),
    ]),
    ("camp_action_4",[],"Back to camp menu.",[
      (jump_to_menu, "mnu_camp"),
    ]),
]),

("camp_recruit_prisoners",0,
  "You offer your prisoners freedom if they agree to join you as soldiers. {s18}",
  "none",[
    (assign, ":num_regular_prisoner_slots", 0),
    (party_get_num_prisoner_stacks, ":num_stacks", "p_main_party"),
    (try_for_range, ":cur_stack", 0, ":num_stacks"),
      (party_prisoner_stack_get_troop_id, ":cur_troop_id", "p_main_party", ":cur_stack"),
      # (neg|troop_is_hero, ":cur_troop_id"),
      #SB : use script check
      (call_script, "script_game_check_prisoner_can_be_sold", ":cur_troop_id"),
      (eq, reg0, 1),
      (val_add, ":num_regular_prisoner_slots", 1),
    (try_end),
    (try_begin),
      (eq, ":num_regular_prisoner_slots", 0),
      (jump_to_menu, "mnu_camp_no_prisoners"),
    (else_try),
      (eq, "$g_prisoner_recruit_troop_id", 0),
      (store_current_hours, "$g_prisoner_recruit_last_time"),
      (store_random_in_range, ":rand", 0, 100),
      (store_skill_level, ":persuasion_level", "skl_persuasion", "trp_player"),
      (store_sub, ":reject_chance", 15, ":persuasion_level"),
      (val_mul, ":reject_chance", 4),
      (try_begin),
        (lt, ":rand", ":reject_chance"),
        (assign, "$g_prisoner_recruit_troop_id", -7),
      (else_try),
        # (assign, ":num_regular_prisoner_slots", 0),
        # (party_get_num_prisoner_stacks, ":num_stacks", "p_main_party"),
        # (try_for_range, ":cur_stack", 0, ":num_stacks"),
          # (party_prisoner_stack_get_troop_id, ":cur_troop_id", "p_main_party", ":cur_stack"),
          # (neg|troop_is_hero, ":cur_troop_id"),
          # (val_add, ":num_regular_prisoner_slots", 1),
        # (try_end),
        (store_random_in_range, ":random_prisoner_slot", 0, ":num_regular_prisoner_slots"),
        (try_for_range, ":cur_stack", 0, ":num_stacks"),
          (party_prisoner_stack_get_troop_id, ":cur_troop_id", "p_main_party", ":cur_stack"),
          (call_script, "script_game_check_prisoner_can_be_sold", ":cur_troop_id"),
          (eq, reg0, 1), #SB : use script call to prevent quest troops from being recruited
          (val_sub, ":random_prisoner_slot", 1),
          (lt, ":random_prisoner_slot", 0),
          (assign, ":num_stacks", 0),
          (assign, "$g_prisoner_recruit_troop_id", ":cur_troop_id"),
          (party_prisoner_stack_get_size, "$g_prisoner_recruit_size", "p_main_party", ":cur_stack"),
        (try_end),
      (try_end),

      (try_begin),
        (gt, "$g_prisoner_recruit_troop_id", 0),
        (party_get_free_companions_capacity, ":capacity", "p_main_party"),
        (val_min, "$g_prisoner_recruit_size", ":capacity"),
        (assign, reg1, "$g_prisoner_recruit_size"),
        (gt, "$g_prisoner_recruit_size", 0),
        (try_begin),
          (gt, "$g_prisoner_recruit_size", 1),
          (assign, reg2, 1),
        (else_try),
          (assign, reg2, 0),
        (try_end),
        (str_store_troop_name_by_count, s1, "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
        (str_store_string, s18, "@{reg1} {s1} {reg2?accept:accepts} the offer."),
      (else_try),
        (str_store_string, s18, "@No one accepts the offer."),
      (try_end),
    (try_end),
  ],[
    ("camp_recruit_prisoners_accept",[
      (gt, "$g_prisoner_recruit_troop_id", 0),
    ],"Take them.",[
      (remove_troops_from_prisoners, "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
      (party_add_members, "p_main_party", "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
      #SB : change base morale reduction by difficulty
      (game_get_reduce_campaign_ai, ":reduce"), #0 to 2
      (val_sub, ":reduce", 4), #-4 to -2
      (store_mul, ":morale_change", ":reduce", "$g_prisoner_recruit_size"),
      (store_troop_faction, ":troop_faction", "$g_prisoner_recruit_troop_id"),
      (store_character_level, ":troop_level", "$g_prisoner_recruit_troop_id"),

      (try_for_range, ":faction", kingdoms_begin, kingdoms_end),
        (faction_set_slot, ":faction", slot_faction_temp_slot, 0),
      (try_end),
      (try_begin), #give extra penalty to faction morale if we recruit high-level enemy troops
        (this_or_next|eq, ":troop_faction", "fac_outlaws"),
        (eq, ":troop_faction", "fac_deserters"),
        (call_script, "script_objectionable_action", tmt_aristocratic, "str_hire_deserters"),
      (else_try),
        (is_between, ":troop_faction", npc_kingdoms_begin, npc_kingdoms_end),
        (faction_get_slot, ":troop_faction_culture", ":troop_faction", slot_faction_culture),
        (try_begin), #no penalty for same faction
          (faction_slot_eq,"$players_kingdom", slot_faction_culture, ":troop_faction_culture"),
          # (val_sub, ":relation", ":morale_change"), #bonus
          (assign, ":morale_change", 0),
          (assign, "$g_prisoner_recruit_troop_id", 0),
          (assign, "$g_prisoner_recruit_size", 0),
        (else_try), #one point per offended party
          (party_get_num_companion_stacks, ":cap", "p_main_party"),
          (try_for_range, ":stack", 1, ":cap"),
            (party_stack_get_troop_id, ":troop", "p_main_party", ":stack"),
            # (neg|troop_is_hero, ":troop"),
            # (neq, ":troop", "$g_prisoner_recruit_troop_id"), #not just recruited
            (store_faction_of_troop, ":stack_faction", ":troop"),
            # (neq, ":stack_faction", ":troop_faction"),
            (store_relation, ":faction_relation", ":troop_faction", ":stack_faction"),
            (lt, ":faction_relation", 0),
            (faction_get_slot, ":amount", ":stack_faction", slot_faction_temp_slot),
            (party_stack_get_size, ":reduce", "p_main_party", ":stack"),
            (val_sub, ":amount", ":reduce"),
            (faction_set_slot, ":stack_faction", slot_faction_temp_slot, ":amount"),
          (try_end),
        (try_end),
      (try_end),
      (call_script, "script_change_player_party_morale", ":morale_change"),
      (try_for_range, ":faction", kingdoms_begin, kingdoms_end),
        (faction_get_slot, ":relation", ":faction", slot_faction_temp_slot),
        (neq, ":relation", 0),
        (val_sub, ":relation", ":troop_level"),
        (call_script, "script_change_faction_troop_morale", ":faction", ":relation", 1),
      (try_end),
      (jump_to_menu, "mnu_camp"),
    ]),
    ("camp_recruit_prisoners_reject",[
      (gt, "$g_prisoner_recruit_troop_id", 0),
    ],"Reject them.",[
      (jump_to_menu, "mnu_camp"),
      (assign, "$g_prisoner_recruit_troop_id", 0),
      (assign, "$g_prisoner_recruit_size", 0),
    ]),
    ("continue",[
      (le, "$g_prisoner_recruit_troop_id", 0),
    ],"Go back.",[
      (jump_to_menu, "mnu_camp"),
    ]),
]),

("camp_make_slaves",0,
  "By selling their equipment to your men you can make your prisoners to slaves. From now on, they will lose their social status and their standing within their faction.",
  "none",[
    (set_background_mesh, "mesh_pic_prisoner_man"),
  ],[
    ("camp_recruit_prisoners_accept",[],"Make them to slaves!",[
      (assign, ":gold", 0),
      (assign, ":num_non_slaves_male", 0),
      (assign, ":num_non_slaves_female", 0),
      (party_get_num_prisoner_stacks, ":num_stacks", "p_main_party"),
      (try_for_range_backwards, ":i_stack", 0, ":num_stacks"),
        (party_prisoner_stack_get_troop_id, ":stack_troop","p_main_party",":i_stack"),
        (call_script, "script_game_check_prisoner_can_be_sold", ":stack_troop"),
        (eq, reg0, 1),
        (party_prisoner_stack_get_size,":size", "p_main_party", ":i_stack"),
        (store_character_level, ":level", ":stack_troop"),

        (try_begin),
          (call_script, "script_cf_dplmc_troop_is_female", ":stack_troop"),
          (val_add, ":num_non_slaves_female", ":size"),
        (else_try),
          (val_add, ":num_non_slaves_male", ":size"),
          (val_mul,":level", 3),
        (try_end),
        (try_begin),
          (neq, ":stack_troop", "trp_slave"),
          (neq, ":stack_troop", "trp_slave_female"),
          (val_add, ":gold", ":level"),
        (try_end),
        (party_remove_prisoners, "p_main_party", ":stack_troop", ":size"),
      (try_end),

      (try_begin),
        (ge, ":num_non_slaves_male", 1),
        (party_force_add_prisoners, "p_main_party","trp_slave", ":num_non_slaves_male"),
      (try_end),

      (try_begin),
        (ge, ":num_non_slaves_female", 1),
        (party_force_add_prisoners, "p_main_party","trp_slave_female", ":num_non_slaves_female"),
      (try_end),
      # (val_add, ":num_non_slaves_male", ":num_non_slaves_female"),
      # (val_mul, ":num_non_slaves_male", 100),
      (troop_add_gold, "trp_player", ":gold"),
      (display_message, "@You gain some gold from the equipment you sell to your men.", color_good_news),
      (call_script, "script_change_party_morale", "p_main_party", 5),
      (jump_to_menu, "mnu_camp"),
    ]),

    ("continue",[
      (le, "$g_prisoner_recruit_troop_id", 0)
    ],"Go back.",[
      (jump_to_menu, "mnu_camp"),
    ]),
]),

  ("camp_no_prisoners",0,
   "You have no prisoners to recruit from.",
   "none",
   [],
    [
      ("continue",[],"Continue...",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

  ("camp_action_read_book",0,
   "Choose a book to read:",
   "none",
   [],
    [
      ("action_read_book_1",[(player_has_item, "itm_book_tactics"),
                             (item_slot_eq, "itm_book_tactics", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_tactics"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_tactics"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_2",[(player_has_item, "itm_book_persuasion"),
                             (item_slot_eq, "itm_book_persuasion", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_persuasion"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_persuasion"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_3",[(player_has_item, "itm_book_leadership"),
                             (item_slot_eq, "itm_book_leadership", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_leadership"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_leadership"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_4",[(player_has_item, "itm_book_intelligence"),
                             (item_slot_eq, "itm_book_intelligence", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_intelligence"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_intelligence"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_5",[(player_has_item, "itm_book_trade"),
                             (item_slot_eq, "itm_book_trade", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_trade"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_trade"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_6",[(player_has_item, "itm_book_weapon_mastery"),
                             (item_slot_eq, "itm_book_weapon_mastery", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_weapon_mastery"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_weapon_mastery"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_7",[(player_has_item, "itm_book_engineering"),
                             (item_slot_eq, "itm_book_engineering", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_engineering"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_engineering"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),

       ("action_read_book_8",[(player_has_item, "itm_book_economy"),
                             (item_slot_eq, "itm_book_economy", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_economy"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_economy"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),

       ("action_read_book_9",[(player_has_item, "itm_book_gallic_wars"),
                             (item_slot_eq, "itm_book_gallic_wars", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_gallic_wars"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_gallic_wars"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
       ("action_read_book_10",[(player_has_item, "itm_book_love"),
                             (item_slot_eq, "itm_book_love", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_love"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_love"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
       ("action_read_book_11",[(player_has_item, "itm_book_sorrows"),
                             (item_slot_eq, "itm_book_sorrows", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_sorrows"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_sorrows"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
       ("action_read_book_12",[(player_has_item, "itm_book_odysseus"),
                             (item_slot_eq, "itm_book_odysseus", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_odysseus"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_odysseus"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
       ("action_read_book_12",[(player_has_item, "itm_book_poop"),
                             (item_slot_eq, "itm_book_poop", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_poop"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_poop"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("camp_action_4",[],"Back to camp menu.",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

("camp_action_read_book_start",0,
  "{s1}",
  "none",[
    (assign, ":new_book", "$temp"),
    (str_store_item_name, s2, ":new_book"),
    (try_begin),
        (store_attribute_level, ":int", "trp_player", ca_intelligence),
        (item_get_slot, ":int_req", ":new_book", slot_item_intelligence_requirement),
        (le, ":int_req", ":int"),
        (str_store_string, s1, "@You start reading {s2}. After a few pages, you feel you could learn a lot from this book. You decide to keep it close by and read whenever you have the time."),
        (assign, "$g_player_reading_book", ":new_book"),
    (else_try),
        (str_store_string, s1, "@You flip through the pages of {s2}, but you find the text confusing and difficult to follow. Try as you might, it soon gives you a headache, and you're forced to give up the attempt."),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_camp"),
    ]),
]),

  ("retirement_verify",0,
   "You are at day {reg0}. Your current luck is {reg1}. Are you sure you want to take your life into the hands of the gods?",
   "none",
   [
     (store_current_day, reg0),
     (assign, reg1, "$g_player_luck"),
     ],
    [
      ("retire_yes",[],"Yes.",
       [
         (start_presentation, "prsnt_retirement"),
        ]
       ),
      ("retire_no",[],"No.",
       [
         (jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

  # ("end_game",0,
   # "The decision is made, and you resolve to give up your adventurer's\
 # life and settle down. You sell off your weapons and armour, gather up\
 # all your money, and ride off into the sunset....",
   # "none",
   # [],
    # [
      # ("end_game_bye",[],"Farewell.",
       # [
         # (change_screen_quit),
        # ]
       # ),
      # ]
  # ),

("cattle_herd",mnf_scale_picture,
  "You encounter a herd of cattle.",
  "none",[
    (play_sound, "snd_cow_moo"),
    (set_background_mesh, "mesh_pic_cattle"),
   ],[
    ("cattle_drive_away",[],"Drive the cattle onward.",[
      (party_set_slot, "$g_encountered_party", slot_cattle_driven_by_player, 1),
      (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_driven_by_party),
      (party_set_ai_object,"$g_encountered_party", "p_main_party"),
      (party_set_extra_text, "$g_encountered_party", "str_ai_bhvr_driven_by_party"),
      (change_screen_return),
    ]),
    ("cattle_drag_with",[
    ],"Drag the cattle with you.",[
      (party_set_slot, "$g_encountered_party", slot_cattle_driven_by_player, 1),
      (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_escort_party),
      (party_set_ai_object,"$g_encountered_party", "p_main_party"),
      (party_set_extra_text, "$g_encountered_party", "str_ai_bhvr_escort_party"),
      (change_screen_return),
    ]),

    ("cattle_stop",[],"Bring the herd to a stop.",[
      (party_set_slot, "$g_encountered_party", slot_cattle_driven_by_player, 0),
      (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_hold),
      (party_set_extra_text, "$g_encountered_party", "@Grazing"),
      (change_screen_return),
    ]),
    ("cattle_kill",[
      (assign, ":continue", 1),
      (try_begin),
        (check_quest_active, "qst_move_cattle_herd"),
        (quest_slot_eq, "qst_move_cattle_herd", slot_quest_target_party, "$g_encountered_party"),
        (assign, ":continue", 0),
      (try_end),
      (eq, ":continue", 1),
    ],"Slaughter some of the animals.",[
      (jump_to_menu, "mnu_cattle_herd_kill"),
    ]),
    ("gods_opfern",[
      (str_store_string, s58, "@the gods"),
      (try_begin),
        (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
        (str_store_string, s58, "@YHWH"),
      (try_end),
      (assign, ":continue", 1),
      (try_begin),
        (check_quest_active, "qst_move_cattle_herd"),
        (quest_slot_eq, "qst_move_cattle_herd", slot_quest_target_party, "$g_encountered_party"),
        (assign, ":continue", 0),
      (try_end),
      (eq, ":continue", 1),
      (eq, "$can_sacrific", 1),
    ],"Sacrifice some of the animals to the {s58}.",[
      (assign, "$temp3", 0),
      (jump_to_menu, "mnu_cattle_herd_kill_opfer"),
    ]),

    ("leave",[],"Leave.",[
      (change_screen_return),
    ]),
]),
("cattle_herd_kill_opfer",0,
  "How many animals do you want to sacrifice to honor {s58}?^^You gain 1 pietas per 5 cattle. If you sacrifice less than 5 cattle it is random if {s58} accepts your sacrifice! If you have already more than 100 pietas, you won't gain any additional pietas from cattle-sacrifices. A hecatomb (killing 100 cattle) will circumvent this limitation, however it is only possible if you are dedicated yourself to worship a specific deity."
  +"^^But be aware that performing a sacrifice will take time and you will be vulnerable to enemy attacks.",
  "none",[
    (str_store_string, s58, "@the gods"),
    (try_begin),
        (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
        (str_store_string, s58, "@YHWH"),
    (try_end),
    (party_get_num_companions, reg5, "$g_encountered_party")
  ],[
    ("cattle_kill_1",[(ge, reg5, 1),],"One.",[
      (store_random_in_range, ":random", 0, 7),
      (try_begin),
        (le, ":random", 1),
        (le, "$player_piety", 100),
        (call_script, "script_add_piety", 1, 1),
        (call_script, "script_change_player_honor", 1),
        (display_message, "@The sacrifice was sufficient. You gain pietas!", color_good_news),
      (else_try),
        (display_message, "@The sacrifice was too small.", color_bad_news),
      (try_end),
      (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 1),
      (call_script, "script_change_party_morale", "p_main_party", 1),
      (store_random_in_range, ":rand", 0, 100),
      (try_begin),
        (le, ":rand", 25),
        (troop_slot_ge, "trp_player", slot_troop_religion, 1),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", "trp_fortuna"),
        (ge, reg0, -20),
        (troop_get_slot,":god", "trp_player", slot_troop_religion),
        (store_add, ":string", ":god", "str_gods_begin"),
        (str_store_string, s20, ":string"),
        (display_message, "@You feel so alive! {s20} has healed you!", color_good_news),
        (troop_set_health, "trp_player", 100),
      (try_end),
      (jump_to_menu, "mnu_cattle_herd_kill_opfer_end"),
      (play_sound, "snd_cow_slaughter"),
      (val_add, "$temp3", 1),
    ]),
    ("cattle_kill_2",[(ge, reg5, 2),],"Two.",[
      (store_random_in_range, ":random", 0, 7),
      (try_begin),
        (le, ":random", 2),
        (le, "$player_piety", 100),
        (call_script, "script_add_piety", 1, 1),
        (call_script, "script_change_player_honor", 1),
        (display_message, "@The sacrifice was sufficient. You gain pietas!", color_good_news),
      (else_try),
        (display_message, "@The sacrifice was too small.", color_bad_news),
      (try_end),
      (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 2),
      (call_script, "script_change_party_morale", "p_main_party", 2),
      (store_random_in_range, ":rand", 0, 100),
      (try_begin),
        (le, ":rand", 15),
        (troop_slot_ge, "trp_player", slot_troop_religion, 1),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", "trp_fortuna"),
        (ge, reg0, -20),
        (troop_get_slot,":god", "trp_player", slot_troop_religion),
        (store_add, ":string", ":god", "str_gods_begin"),
        (str_store_string, s20, ":string"),
        (display_message, "@You feel so alive! {s20} has healed you!", color_good_news),
        (troop_set_health, "trp_player", 100),
      (try_end),
      (jump_to_menu, "mnu_cattle_herd_kill_opfer_end"),
      (play_sound, "snd_cow_slaughter"),
      (val_add, "$temp3", 2),
    ]),
    ("cattle_kill_3",[(ge, reg5, 3),],"Three.",[
      (store_random_in_range, ":random", 0, 7),
      (try_begin),
        (le, ":random", 3),
        (le, "$player_piety", 100),
        (call_script, "script_add_piety", 1, 1),
        (call_script, "script_change_player_honor", 1),
        (display_message, "@The sacrifice was sufficient. You gain pietas!", color_good_news),
      (else_try),
        (display_message, "@The sacrifice was too small.", color_bad_news),
      (try_end),
      (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 3),
      (call_script, "script_change_party_morale", "p_main_party", 3),
      (store_random_in_range, ":rand", 0, 100),
      (try_begin),
        (le, ":rand", 20),
        (troop_slot_ge, "trp_player", slot_troop_religion, 1),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", "trp_fortuna"),
        (ge, reg0, -20),
        (troop_get_slot,":god", "trp_player", slot_troop_religion),
        (store_add, ":string", ":god", "str_gods_begin"),
        (str_store_string, s20, ":string"),
        (display_message, "@You feel so alive! {s20} has healed you!", color_good_news),
        (troop_set_health, "trp_player", 100),
      (try_end),
      (jump_to_menu, "mnu_cattle_herd_kill_opfer_end"),
      (play_sound, "snd_cow_slaughter"),
      (val_add, "$temp3", 3),
    ]),
    ("cattle_kill_4",[(ge, reg5, 4),],"Four.",[
      (store_random_in_range, ":random", 0, 7),
      (try_begin),
        (le, ":random", 4),
        (le, "$player_piety", 100),
        (call_script, "script_add_piety", 1, 1),
        (call_script, "script_change_player_honor", 1),
        (display_message, "@The sacrifice was sufficient. You gain pietas!", color_good_news),
      (else_try),
        (display_message, "@The sacrifice was too small.", color_bad_news),
      (try_end),
      (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 4),

      (call_script, "script_change_party_morale", "p_main_party", 4),
      (store_random_in_range, ":rand", 0, 100),
      (try_begin),
        (le, ":rand", 25),
        (troop_slot_ge, "trp_player", slot_troop_religion, 1),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", "trp_fortuna"),
        (ge, reg0, -20),
        (troop_get_slot,":god", "trp_player", slot_troop_religion),
        (store_add, ":string", ":god", "str_gods_begin"),
        (str_store_string, s20, ":string"),
        (display_message, "@You feel so alive! {s20} has healed you!", color_good_news),
        (troop_set_health, "trp_player", 100),
      (try_end),

      (jump_to_menu, "mnu_cattle_herd_kill_opfer_end"),
      (play_sound, "snd_cow_slaughter"),
      (val_add, "$temp3", 4),
    ]),
    ("cattle_kill_5",[(ge, reg5, 5),],"Five.",[
      (try_begin),
        (le, "$player_piety", 100),
        (call_script, "script_add_piety", 1, 1),
        (call_script, "script_change_player_honor", 1),
        (display_message, "@The sacrifice was sufficient. You gain pietas!", color_good_news),
      (try_end),
      (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 5),

      (call_script, "script_change_party_morale", "p_main_party", 5),
      (store_random_in_range, ":rand", 0, 100),
      (try_begin),
        (le, ":rand", 30),
        (troop_slot_ge, "trp_player", slot_troop_religion, 1),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", "trp_fortuna"),
        (ge, reg0, -20),
        (troop_get_slot,":god", "trp_player", slot_troop_religion),
        (store_add, ":string", ":god", "str_gods_begin"),
        (str_store_string, s20, ":string"),
        (display_message, "@You feel so alive! {s20} has healed you!", color_good_news),
        (troop_set_health, "trp_player", 100),
      (try_end),

      (jump_to_menu, "mnu_cattle_herd_kill_opfer_end"),
      (play_sound, "snd_cow_slaughter"),
      (val_add, "$temp3", 5),
    ]),
    ("cattle_kill_10",[(ge, reg5, 10),],"Ten.",[
      (try_begin),
        (le, "$player_piety", 100),
        (call_script, "script_change_player_honor", 2),
        (call_script, "script_add_piety", 2, 1),
        (display_message, "@The sacrifice was sufficient. You gain pietas!", color_good_news),
      (try_end),
      (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 10),
      (call_script, "script_change_party_morale", "p_main_party", 10),
      (store_random_in_range, ":rand", 0, 100),
      (try_begin),
        (le, ":rand", 35),
        (troop_slot_ge, "trp_player", slot_troop_religion, 1),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", "trp_fortuna"),
        (ge, reg0, -20),
        (troop_get_slot,":god", "trp_player", slot_troop_religion),
        (store_add, ":string", ":god", "str_gods_begin"),
        (str_store_string, s20, ":string"),
        (display_message, "@You feel so alive! {s20} has healed you!", color_good_news),
        (troop_set_health, "trp_player", 100),
      (try_end),

      (jump_to_menu, "mnu_cattle_herd_kill_opfer_end"),
      (play_sound, "snd_cow_slaughter"),
      (val_add, "$temp3", 10),
    ]),

    ("cattle_kill_10",[
      (ge, reg5, 100),
      (troop_get_slot, ":diety", "trp_player", slot_troop_religion),
      (ge, ":diety", 1),
      (val_add, ":diety", "str_gods_begin"),
      (str_store_string, s8, ":diety"),
    ],"Hecatomb in honor of {s8}. (100 cattle)",[
      # (try_begin),
        # (le, "$player_piety", 100),
      (call_script, "script_change_player_honor", 20),
      (call_script, "script_add_piety", 20, 1),
      (display_message, "@The sacrifice was sufficient. You gain pietas!", color_good_news),
      # (try_end),
      (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 100),
      (call_script, "script_change_party_morale", "p_main_party", 100),
      (store_random_in_range, ":rand", 0, 100),
      (try_begin),
        (le, ":rand", 35),
        (troop_slot_ge, "trp_player", slot_troop_religion, 1),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", "trp_fortuna"),
        (ge, reg0, -20),
        (troop_get_slot,":god", "trp_player", slot_troop_religion),
        (store_add, ":string", ":god", "str_gods_begin"),
        (str_store_string, s20, ":string"),
        (display_message, "@You feel so alive! {s20} has healed you!", color_good_news),
        (troop_set_health, "trp_player", 100),
      (try_end),

      (jump_to_menu, "mnu_cattle_herd_kill_opfer_end"),
      (play_sound, "snd_cow_slaughter"),

      (val_add, "$temp3", 100),
    ]),
    ("go_back_dot",[],"Go back.",[
      (try_begin),
        (gt, "$temp3", 0),
        (val_div, "$temp3", 10),
        (val_max, "$temp3", 1),
        (rest_for_hours, "$temp3", 15, 1),
        (jump_to_menu, "mnu_auto_return_map"),
      (else_try),
        (jump_to_menu, "mnu_cattle_herd"),
      (try_end),
    ]),
]),
("cattle_herd_kill",0,
  "How many animals do you want to slaughter?",
  "none",[
    (party_get_num_companions, reg5, "$g_encountered_party"),
    (set_background_mesh, "mesh_pic_cattle"),
  ],[
  ("cattle_kill_1",[(ge, reg5, 1),],"One.",[
    (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 1),
    (jump_to_menu, "mnu_cattle_herd_kill_end"),
    (change_screen_loot, "trp_temp_troop"),
    (play_sound, "snd_cow_slaughter"),
  ]),
  ("cattle_kill_2",[(ge, reg5, 2),],"Two.",[
    (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 2),
    (jump_to_menu, "mnu_cattle_herd_kill_end"),
    (change_screen_loot, "trp_temp_troop"),
    (play_sound, "snd_cow_slaughter"),
  ]),
  ("cattle_kill_3",[(ge, reg5, 3),],"Three.",[
    (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 3),
    (jump_to_menu, "mnu_cattle_herd_kill_end"),
    (change_screen_loot, "trp_temp_troop"),
    (play_sound, "snd_cow_slaughter"),
  ]),
  ("cattle_kill_4",[(ge, reg5, 4),],"Four.",[
    (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 4),
    (jump_to_menu, "mnu_cattle_herd_kill_end"),
    (change_screen_loot, "trp_temp_troop"),
    (play_sound, "snd_cow_slaughter"),
  ]),
  ("cattle_kill_5",[(ge, reg5, 5),],"Five.",[
    (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 5),
    (jump_to_menu, "mnu_cattle_herd_kill_end"),
    (change_screen_loot, "trp_temp_troop"),
    (play_sound, "snd_cow_slaughter"),
  ]),
  ("cattle_kill_5",[(ge, reg5, 10),],"Ten.",[
    (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 10),
    (jump_to_menu, "mnu_cattle_herd_kill_end"),
    (change_screen_loot, "trp_temp_troop"),
    (play_sound, "snd_cow_slaughter"),
  ]),
  ("go_back_dot",[],"Go back.",[
    (jump_to_menu, "mnu_cattle_herd"),
  ]),
]),

("cattle_herd_kill_opfer_end",0,
  "The sacrifice is performed according to the traditions.",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
  ],[
    ("continue",[],"Continue...",[
      (try_begin),
        (party_is_active, "$g_encountered_party"),
        (jump_to_menu, "mnu_cattle_herd_kill_opfer"),
        (assign, "$can_sacrific", 0),
      (else_try),
        (jump_to_menu, "mnu_auto_return_map"),
        (val_div, "$temp3", 10),
        (val_max, "$temp3", 1),
        (rest_for_hours, "$temp3", 15, 1),
        (jump_to_menu, "mnu_auto_return_map"),
      (try_end),
    ]),
]),

("cattle_herd_kill_end",0,
  "{!}You shouldn't be reading this.",
  "none",[
    (change_screen_return),
  ],[
]),

("arena_duel_fight",0,
  "You and your opponent prepare to duel.",
  "none",[
    (troop_get_slot, ":leader_troop_faction", "$g_duel_troop", slot_troop_original_faction),
    (try_begin),
      (eq, ":leader_troop_faction", fac_kingdom_1),
      (set_background_mesh, "mesh_pic_swad"),
    (else_try),
      (this_or_next|eq, ":leader_troop_faction", fac_kingdom_2),
      (this_or_next|eq, ":leader_troop_faction", fac_kingdom_8),
      (this_or_next|eq, ":leader_troop_faction", fac_kingdom_9),
      (eq, ":leader_troop_faction", fac_kingdom_10),
      (set_background_mesh, "mesh_pic_vaegir"),
    (else_try),
      (this_or_next|eq, ":leader_troop_faction", fac_kingdom_3),
      (this_or_next|eq, ":leader_troop_faction", fac_kingdom_11),
      (eq, ":leader_troop_faction", fac_kingdom_12),
      (set_background_mesh, "mesh_pic_khergit"),
    (else_try),
      (this_or_next|eq, ":leader_troop_faction", fac_kingdom_4),
      (this_or_next|eq, ":leader_troop_faction", fac_kingdom_13),
      (this_or_next|eq, ":leader_troop_faction", fac_kingdom_14),
      (this_or_next|eq, ":leader_troop_faction", fac_kingdom_15),
      (eq, ":leader_troop_faction", fac_kingdom_16),
      (set_background_mesh, "mesh_pic_nord"),
    (else_try),
      (this_or_next|eq, ":leader_troop_faction", fac_kingdom_5),
      (eq, ":leader_troop_faction", fac_kingdom_6),
      (set_background_mesh, "mesh_pic_rhodock"),
    (else_try),
      (eq, ":leader_troop_faction", fac_kingdom_17),
      (set_background_mesh, "mesh_pic_mountain_bandits"),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (assign, "$g_leave_encounter", 0),
      (assign, ":closest_town", "$g_encountered_party"),

      #restructure this to take into account $g_start_arena_fight_at_nearest_town
      (try_begin), #check if the parameter is necessary
        (neg|is_between, ":closest_town", walled_centers_begin, walled_centers_end),
        (is_between, "$g_start_arena_fight_at_nearest_town", walled_centers_begin, walled_centers_end),
        (assign, ":closest_town", "$g_start_arena_fight_at_nearest_town"),
        (assign, "$g_start_arena_fight_at_nearest_town", 0),
      (try_end),

      (try_begin),
        (is_between, ":closest_town", towns_begin, towns_end),
        (party_get_slot, ":duel_scene", ":closest_town", slot_town_arena),
      # (else_try), #SB : duels at castle arena
        # (is_between, ":closest_town", castles_begin, castles_end),
        # (party_get_slot, ":duel_scene", ":closest_town", slot_castle_exterior),
      (else_try),
        (party_get_current_terrain, ":terrain", "p_main_party"),
        (eq, ":terrain", rt_snow),
        (assign, ":duel_scene", "scn_training_ground_ranged_melee_3"),
      (else_try),
        (this_or_next|eq, ":terrain", rt_desert),
        (eq, ":terrain", rt_steppe), #this is the actual steppe scene
        (assign, ":duel_scene", "scn_training_ground_ranged_melee_4"),
      (else_try),
        (assign, ":duel_scene", "scn_training_ground_ranged_melee_1"),
      (try_end),
      (modify_visitors_at_site, ":duel_scene"),
      (reset_visitors),
      # (set_visitor, 0, "trp_player"),
      # (set_visitor, 1, "$g_duel_troop"),
      (troop_set_slot, "trp_tournament_participants", 0, "trp_player"),
      (troop_set_slot, "trp_tournament_participants", 1, "$g_duel_troop"),
      (set_jump_mission, "mt_duel_with_lord"),
      #SB : check relative standing, 0 = (higher renown)
      (try_begin),
        (troop_is_hero, "$g_duel_troop"),
        (troop_get_slot, ":player_renown", "trp_player", slot_troop_renown),
        (troop_slot_ge, "$g_duel_troop", slot_troop_renown, ":player_renown"),
        #swap positions
        (troop_set_slot, "trp_tournament_participants", 1, "trp_player"),
        (troop_set_slot, "trp_tournament_participants", 0, "$g_duel_troop"),
      (try_end),
      #SB : set up additional equipment, do not always use sword_medieval_a
      (troop_get_slot, ":faction", "$g_duel_troop", slot_troop_original_faction),
      (faction_get_slot, ":faction1", ":faction", slot_faction_culture),
      (try_begin),
        (eq, ":faction1", "fac_culture_1"),
        (assign, ":weapon", "itm_dacian_sword"),
      (else_try),
        (this_or_next|eq, ":faction1", "fac_culture_9"),
        (eq, ":faction1", "fac_culture_3"),
        (assign, ":weapon", "itm_sarmatian_ringsword_4"),
      (else_try),
        (eq, ":faction1", "fac_culture_2"),
        (assign, ":weapon", "itm_celtic_axe2"),
      (else_try),
        (eq, ":faction1", "fac_culture_2_1"),
        (assign, ":weapon", "itm_celtic_axe2"),
      (else_try),
        (eq, ":faction1", "fac_culture_4"),
        (assign, ":weapon", "itm_germanic_axe1"),
      # (else_try),
        # (eq, ":faction", "fac_kingdom_5"), #no requirement
        # (assign, ":weapon", "itm_military_cleaver_b"),
      (else_try),
        (this_or_next|eq, ":faction1", "fac_culture_5"),
        (eq, ":faction1", "fac_culture_6"),
        (assign, ":weapon", "itm_eastern_sword1"),
      (else_try),
        (this_or_next|eq, ":faction1", "fac_culture_8"),
        (eq, ":faction1", "fac_culture_7"),
        (assign, ":weapon", "itm_roman_spatha"),
      (else_try),
        (assign, ":weapon", "itm_arena_sword"),
      (try_end),

      (try_for_range, ":cur_entry_point", 0, 2),
        (troop_get_slot, ":cur_troop", "trp_tournament_participants", ":cur_entry_point"),
        (try_begin), #within the courtyard, 23/24 is guard entry
          (is_between, ":closest_town", castles_begin, castles_end),
          (val_add, ":cur_entry_point", 2), #to use the new mission template entries 3 & 4
        (try_end),

        (mission_tpl_entry_clear_override_items, "mt_duel_with_lord", ":cur_entry_point"),
        #weapon, make sure they have no difficulty requirement
        (mission_tpl_entry_add_override_item, "mt_duel_with_lord", ":cur_entry_point", ":weapon"),
        # (item_get_type, ":type", ":weapon"),
        # (try_begin),
          # (is_between, ":type", itp_type_pistol, itp_type_bullets),
          # (mission_tpl_entry_add_override_item, "mt_duel_with_lord", ":cur_entry_point", "itm_cartridges2"),
          # (mission_tpl_entry_add_override_item, "mt_duel_with_lord", ":cur_entry_point", "itm_dagger"),#backup
        # (else_try),
          # (eq, ":type", itp_type_crossbow),
          # (mission_tpl_entry_add_override_item, "mt_duel_with_lord", ":cur_entry_point", "itm_practice_bolts_9_amount"),
          # (mission_tpl_entry_add_override_item, "mt_duel_with_lord", ":cur_entry_point", "itm_estoc"),#backup
        # (else_try),
          # (eq, ":type", itp_type_bow),
          # (mission_tpl_entry_add_override_item, "mt_duel_with_lord", ":cur_entry_point", "itm_practice_arrows_10_amount"),
          # (mission_tpl_entry_add_override_item, "mt_duel_with_lord", ":cur_entry_point", ":backup"),#backup
        # (try_end),

        #armor, they're statistically almost the same
        # (troop_get_slot, ":renown", ":cur_troop", slot_troop_renown),
        # (val_min, ":renown", 2000),
        # (store_div, ":armor", ":renown", 500),#0 to 3
        # (val_add, ":armor", "itm_heraldic_mail_with_surcoat"),
        # (mission_tpl_entry_add_override_item, "mt_duel_with_lord", ":cur_entry_point", ":armor"),

        (set_visitor, ":cur_entry_point", ":cur_troop"),
      (try_end),

      (jump_to_scene, ":duel_scene"),
      (jump_to_menu, "mnu_arena_duel_conclusion"),
      (change_screen_mission),
    ]),
]),

("arena_duel_conclusion",0,
  "{!}{s11}",
  "none",[
    (try_begin),
      (eq, "$g_leave_encounter", 1),
      (change_screen_return),
    (try_end),
    (str_store_troop_name, s10, "$g_duel_troop"),
    #SB : change to loop
    (store_add, ":end", lady_quests_end, 2),
    (try_for_range, ":quest", "qst_duel_for_lady", ":end"),
      (try_begin),
        (eq, ":quest", lady_quests_end),
        (assign, ":quest", "qst_denounce_lord"),
      (try_end),
      (quest_slot_eq, ":quest", slot_quest_target_troop, "$g_duel_troop"),
      (try_begin),
        (check_quest_succeeded, ":quest"),
        (str_store_string, s11, "str_s10_lies_in_the_arenas_dust_for_several_minutes_then_staggers_to_his_feet_you_have_won_the_duel"),
        (set_background_mesh, "mesh_pic_victory"),
      (else_try),
        (check_quest_failed, ":quest"),
        (str_store_string, s11, "str_you_lie_stunned_for_several_minutes_then_stagger_to_your_feet_to_find_your_s10_standing_over_you_you_have_lost_the_duel"),
        (set_background_mesh, "mesh_pic_defeat"),
      (try_end),
    (try_end),
  ],[
  ("continue",[],"Continue...",[
    (assign, "$talk_context", tc_after_duel),
    (try_begin), #SB : use the appropriate script calls
      (is_between, "$g_encountered_party", centers_begin, centers_end),
      (call_script, "script_start_court_conversation", "$g_duel_troop", "$g_encountered_party"), #SB : script call
    (else_try),
      (call_script, "script_setup_troop_meeting", "$g_duel_troop", -1, -1), #SB : script call
    (try_end),
  ]),
]),

("simple_encounter",mnf_enable_hot_keys|mnf_scale_picture,
  "{s3}",
  "none",[

    (assign, ":auto_return", 0),

    (str_clear, s47),
    (try_begin),
        (gt, "$enlisted_party", -1),
        (quest_get_slot, reg50,"qst_freelancing", slot_quest_freelancer_agent_limit),
        (ge, reg50, 1),
        (str_store_string, s47, "@You will command {reg50} men during battle."),
    (try_end),
    (assign, "$g_enemy_party", "$g_encountered_party"),
    (assign, "$g_ally_party", -1),
    (try_begin),
        (eq, "$new_encounter", 1),
        (party_get_template_id, ":template_id", "$g_enemy_party"),
        (neq, ":template_id", "pt_routed_warriors"), #chief, los que huyen no luchan
        (call_script, "script_let_nearby_parties_join_current_battle", 0, 0),
    (try_end),
    (call_script, "script_encounter_calculate_fit"),
    (try_begin),
        (eq, "$new_encounter", 1),
        # (assign, "$new_encounter", 0),#moved to end
        (assign, "$g_encounter_is_in_village", 0),
        (assign, "$g_encounter_type", 0),
        (party_get_current_terrain, ":terrain_type", "p_main_party"),

        (try_begin),
            (party_slot_eq, "$g_enemy_party", slot_party_ai_state, spai_raiding_around_center),
            (party_get_slot, ":village_no", "$g_enemy_party", slot_party_ai_object),
            (store_distance_to_party_from_party, ":dist", ":village_no", "$g_enemy_party"),
            (try_begin),
                (lt, ":dist", raid_distance),
                (assign, "$g_encounter_is_in_village", ":village_no"),
                (assign, "$g_encounter_type", enctype_fighting_against_village_raid),
            (try_end),
        (try_end),
        (try_begin),
            (gt, "$g_player_raiding_village", 0),
            (assign, "$g_encounter_is_in_village", "$g_player_raiding_village"),
            (assign, "$g_encounter_type", enctype_catched_during_village_raid),
            (party_quick_attach_to_current_battle, "$g_encounter_is_in_village", 1), #attach as enemy
            (str_store_string, s1, "@Villagers"),
            (display_message, "str_s1_joined_battle_enemy", message_negative), #SB : colorize
        (else_try),
            (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
            (party_quick_attach_to_current_battle, "$g_encounter_is_in_village", 0), #attach as friend
            (str_store_string, s1, "@Villagers"),
            (display_message, "str_s1_joined_battle_friend", message_positive), #SB : colorize
            # Let village party join battle at your side
        (try_end),

        (assign, ":ambush_ai_yes", 10),
        (try_begin),
            (neg|troop_slot_eq, "trp_player", slot_troop_culture, "fac_culture_7"),# not Roman
            (store_skill_level,":tactical_player", "skl_tactics", "trp_player"),
            (ge, ":tactical_player", 5),
            (assign,"$player_ambushed",5),
        (else_try),
            (eq, "$g_encountered_party_template", "pt_slave_revolt"),
            (assign,"$player_ambushed",1),
        (else_try),
            (neq, "$g_encounter_type", enctype_fighting_against_village_raid),
            (neq, "$g_player_icon_state", pis_camping), #camp normal
            (troop_slot_eq, "trp_global_variables", g_player_trench, 0),#not entrenched
            #  (neq, "$g_encounter_type", ambush_ai_yes),
            (le,"$player_ambushed",0),
            (eq, "$encountered_party_hostile", 1),
            (party_get_current_terrain, ":terrain_type", "p_main_party"),
            (neq,":terrain_type",0),	#no ambushes at sea
            (neq,":terrain_type",7),
            (neq,":terrain_type",8),
            #limit parties that ambush
            (neg|is_between, "$g_encountered_party_template",      "pt_merchant_caravan", "pt_kingdom_hero_party"),
            (neg|is_between, "$g_encountered_party_template",      "pt_steppe_bandit_lair", "pt_legio_i_adjutrix_staff"),
            (neg|party_slot_eq, "$g_encountered_party",      slot_party_ai_state, spai_besieging_center),
            (neg|party_slot_eq, "$g_encountered_party",      slot_party_ai_state, spai_raiding_around_center),
            (neg|party_slot_eq, "$g_encountered_party",      slot_party_ai_state, spai_accompanying_army),
            (neg|party_slot_eq, "$g_encountered_party",      slot_party_ai_state, spai_visiting_village),
            #end limit parties that ambush
            (store_faction_of_party, ":faction", "$g_encountered_party"),
            (neg|faction_slot_eq, ":faction", slot_faction_culture, "fac_culture_7"),
            (try_begin),
                (this_or_next|faction_slot_eq, ":faction", slot_faction_culture, "fac_culture_8"),
                (eq, ":faction", "fac_mountain_bandits"),
                (val_add, ":ambush_ai_yes", 100),
            (try_end),
            (try_begin), ##germans make more ambush
                (this_or_next|faction_slot_eq, ":faction", slot_faction_culture, "fac_culture_2_1"),
                (this_or_next|faction_slot_eq, ":faction", slot_faction_culture, "fac_culture_2"),
                (faction_slot_eq, ":faction", slot_faction_culture, "fac_culture_4"),
                (val_add, ":ambush_ai_yes", 90),
            (try_end),
            (try_begin),
                (eq, ":terrain_type", rt_steppe),
                (val_sub, ":ambush_ai_yes", 10),
            (else_try),
                (eq, ":terrain_type", rt_plain),
                (val_sub, ":ambush_ai_yes", 5),
            (else_try),
                (eq, ":terrain_type", rt_snow),
                (val_add, ":ambush_ai_yes", 5),
            (else_try),
                (eq, ":terrain_type", rt_desert),
                (val_add, ":ambush_ai_yes", 5),
            (else_try),
                (eq, ":terrain_type", rt_steppe_forest),
                (val_add, ":ambush_ai_yes", 40),
            (else_try),
                (eq, ":terrain_type", rt_forest),
                (val_add, ":ambush_ai_yes", 70),
            (else_try),
                (eq, ":terrain_type", rt_snow_forest),
                (val_add, ":ambush_ai_yes", 48),
            (else_try),
                (val_add, ":ambush_ai_yes", 5),
            (try_end),
            #no ambush from small armies
            (store_party_size_wo_prisoners, ":enemy_strength", "$g_encountered_party"),
            (ge, ":enemy_strength", 40),#at least 30 men
            (try_begin),
                (le, ":enemy_strength", 80),
                (val_sub, ":ambush_ai_yes", 10),
            (else_try),
                (le, ":enemy_strength", 160),
                (val_sub, ":ambush_ai_yes", 5),
            (try_end),
            #player skills helping to avoid ambush
            (call_script, "script_get_max_skill_of_player_party", "skl_spotting"),
            (assign, ":spotting_skill", reg0),
            (val_sub,":ambush_ai_yes",":spotting_skill"),
            (try_begin),
                (eq, "$g_stance", 1),#forced march
                (val_mul, ":ambush_ai_yes", 7),
                (val_div, ":ambush_ai_yes", 5),#+40%
            (else_try),
                (eq, "$g_stance", 2),#screen
                #(val_mul, ":ambush_ai_yes", 2),
                (val_div, ":ambush_ai_yes", 2),
            (try_end),
            #(val_max, ":ambush_ai_yes", 1),
            (store_random_in_range,":ambush_ratio",0,200),
            (try_begin),
                (lt,":ambush_ratio",":ambush_ai_yes"),
                (assign,"$player_ambushed",1),
                (assign, "$cant_leave_encounter", 1),
            (else_try),
                (assign,"$player_ambushed",2), #ambush check only once per battle
            (try_end),
        (try_end),

        # (assign,"$player_ambushed",1),

        #(call_script, "script_let_nearby_parties_join_current_battle", 0, 0),
        (call_script, "script_encounter_init_variables"),
        (assign, "$encountered_party_hostile", 0),
        (assign, "$encountered_party_friendly", 0),
        (try_begin),
            (gt, "$g_encountered_party_relation", 0),
            (try_begin), #SB : apply provocation override
                (check_quest_active, "qst_cause_provocation"),
                (neg|check_quest_concluded, "qst_cause_provocation"),
                (quest_slot_eq, "qst_cause_provocation", slot_quest_target_faction, "$g_encountered_party_faction"),
                (party_slot_eq, "$g_encountered_party", slot_party_type, spt_kingdom_caravan),
                (assign, "$encountered_party_friendly", 0),
            (else_try),
                (assign, "$encountered_party_friendly", 1),
            (try_end),
        (try_end),

        (try_begin),
            (lt, "$g_encountered_party_relation", 0),
            (assign, "$encountered_party_hostile", 1),
            (try_begin),
                (encountered_party_is_attacker),
                (assign, "$cant_leave_encounter", 1),
            (try_end),
        (try_end),
        (assign, "$talk_context", tc_party_encounter),
        (call_script, "script_setup_party_meeting", "$g_encountered_party"),
        (assign, ":auto_return", 2),
    (else_try), #second or more turn
        #          (try_begin),
        #            (call_script, "script_encounter_calculate_morale_change"),
        #          (try_end),
        (try_begin),
            # We can leave battle only after some troops have been killed.
            (eq, "$cant_leave_encounter", 1),
            (call_script, "script_party_count_members_with_full_health", "p_main_party_backup"),
            (assign, ":org_total_party_counts", reg0),
            (call_script, "script_party_count_members_with_full_health", "p_encountered_party_backup"),
            (val_add, ":org_total_party_counts", reg0),

            (call_script, "script_party_count_members_with_full_health", "p_main_party"),
            (assign, ":cur_total_party_counts", reg0),
            (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
            (val_add, ":cur_total_party_counts", reg0),

            (store_sub, ":leave_encounter_limit", ":org_total_party_counts", 10),
            (lt, ":cur_total_party_counts", ":leave_encounter_limit"),
            (assign, "$cant_leave_encounter", 0),
        (try_end),
        (eq, "$g_leave_encounter",1),
        (assign, ":auto_return", 1),
    (try_end),
    (try_begin),
        (troop_slot_eq, "trp_global_variables", g_player_trench, 0),
        (eq, "$g_encountered_party_template", "pt_kingdom_hero_party"),
        (eq, "$encountered_party_friendly", 0),
        (neg|troop_is_wounded, "trp_player"),
        #(neq, "$g_empieza_asedio", 1),#no in sieges
        (party_get_current_terrain,":terrain","p_main_party"),
        (neq,":terrain",0),
        (neq,":terrain",7),
        (neq,":terrain",8),
        (ge,"$player_ambushed",2),
        (le, "$g_empieza_campeon", 0),
        (store_random_in_range,":commander_lords",0,10),
        (assign, ":commander_effect",0),# speech, religion, skirmishes
        (try_begin),
            (eq, ":commander_lords",1),#
            (assign, ":commander_effect",1),# speech = more morale to enemy Impassion your men with a rousing speech
            (call_script, "script_change_party_morale", "$g_enemy_party", 14),
            (assign, "$g_empieza_campeon", 1),
        (else_try),
            (is_between, ":commander_lords",2,6),#
            (assign, ":commander_effect",2),# Religion
            (call_script, "script_change_party_morale", "$g_enemy_party", 9),
            (assign, "$g_empieza_campeon", 1),
        (else_try),
            (is_between, ":commander_lords",6,9),#
            (assign, ":commander_effect",3),# skirmishes.
            (assign, "$g_empieza_campeon", 1),
            ### muertos
            # (call_script, "script_simulate_battle_with_parties", 32, "$g_enemy_party", 36, "$g_ally_party", 0),
            (call_script, "script_inflict_casualties_to_party", "p_main_party", 2),
            (call_script, "script_encounter_calculate_fit"), ### call reg10 and reg11 again
        (else_try),
            (assign, ":commander_effect",0),
        (try_end),
    (try_end),
    (try_begin),
        (party_is_active, "$g_encountered_party"),
        (str_store_party_name, s1,"$g_encountered_party"),
        (try_begin),
            (eq, "$encountered_party_friendly", 0),
            (troop_slot_eq, "trp_global_variables", g_player_trench, 1),
            (str_store_string,s2,"@You have encountered {s1}.^^The enemy is preparing an attack on your fortified camp.^"), #
          # (assign, "$cant_leave_encounter", 1),
        (else_try),
            (eq, "$encountered_party_friendly", 0),
            (eq, "$player_ambushed",1),#Ambush Yes
            (try_begin),
                (le, "$g_empieza_campeon", 0),
                (call_script, "script_inflict_casualties_to_party", "p_main_party", 2),
                (assign, "$g_empieza_campeon", 1),
            (try_end),
            (str_store_string,s2,"@Ambush! The enemy has maneuvered to gain a good position, and you fell into an ambush. Some of their troops attacked your rearguard and caused casualties.^^Being ambushed puts you in a poor and disorganized defensive position, and your men will have morale problems and reduced ability to cause damage to your enemies.^^"), #
            (assign, "$cant_leave_encounter", 1),
        (else_try), #chief ambush end
            (eq, "$encountered_party_friendly", 0),
            (eq, "$g_encounter_type", 0),
            (eq, ":commander_effect",1),
            (str_store_string, s2,"@You have encountered {s1}.^^The enemy commander encourages his men with a rousing speech. Your enemies have very high morale.^^"),
        (else_try),
            (eq, "$encountered_party_friendly", 0),
            (eq, "$g_encounter_type", 0),
            (eq, ":commander_effect",2),
            (str_store_string, s2,"@You have encountered {s1}.^^The enemy commander gathers his men to pray and invoke the protection of their gods. Your enemies have high morale.^^"),
        (else_try),
            (eq, "$encountered_party_friendly", 0),
            (eq, "$g_encounter_type", 0),
            (eq, ":commander_effect",3),
            (str_store_string, s2,"@You have encountered {s1}.^^Before we were prepared, we were surprised by enemy missile troops. They caused some casualties.^^"),
        (else_try), #chief commands lords end
            (eq, "$g_encounter_type", 0),
            (str_store_string, s2,"@You have encountered {s1}."),
        (else_try),
            (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
            (str_store_party_name, s3, "$g_encounter_is_in_village"),
            (str_store_string, s2,"@You have engaged {s1} while they were raiding {s3}."),
        (else_try),
            (eq, "$g_encounter_type", enctype_catched_during_village_raid),
            (str_store_party_name, s3, "$g_encounter_is_in_village"),
            (str_store_string, s2,"@You were caught by {s1} while your forces were raiding {s3}."),
        (try_end),
    (try_end),

    (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":num_enemy_regulars_remaining", reg0),
        (assign, ":enemy_finished", 0),
        (try_begin),
            (eq, "$g_battle_result", 1), #battle won

            (this_or_next|le, ":num_enemy_regulars_remaining", 0), #battle won
            (le, ":num_enemy_regulars_remaining",  "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

            (assign, ":enemy_finished",1),
        (else_try),
            (eq, "$g_engaged_enemy", 1),

            (this_or_next|le, ":num_enemy_regulars_remaining", 0),
            (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

            (ge, "$g_friend_fit_for_battle",1),
            (assign, ":enemy_finished",1),
        (try_end),

        (this_or_next|eq, ":enemy_finished",1),
        # (this_or_next|eq, ":num_enemy_regulars_remaining",0),
        (eq,"$g_enemy_surrenders",1),
        (assign, "$g_next_menu", -1),
        (assign, ":auto_return",  "mnu_total_victory"),
    (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":num_our_regulars_remaining", reg0),
        (assign, ":friends_finished",0),
        (try_begin),
            (eq, "$g_battle_result", -1),
            #(eq, ":num_our_regulars_remaining", 0), #battle lost
            (le, ":num_our_regulars_remaining",  "$num_routed_us"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
            (assign,  ":friends_finished", 1),
        (else_try),
            (eq, "$g_engaged_enemy", 1),
            (ge, "$g_enemy_fit_for_battle",1),
            (le, "$g_friend_fit_for_battle",0),
            (assign, ":friends_finished",1),
        (try_end),

        (this_or_next|eq, ":friends_finished",1),
        (eq,"$g_player_surrenders",1),
        (assign, "$g_next_menu", "mnu_captivity_start_wilderness"),
        (assign, ":auto_return",  "mnu_total_defeat"),
    (try_end),

    (call_script, "script_get_background_pic_for_battle", "$g_encountered_party_template", "$g_encountered_party_faction"),
    (try_begin),
        (gt, reg0, -1),
        (set_background_mesh, reg0),
    (try_end),
    (assign, "$new_encounter", 0),

    (try_begin),
        (check_quest_active, "qst_four_emperors"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 10),
        (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_legatus_11"),
        (assign, ":auto_return",  "mnu_the_final_speech"),
    (else_try),
        (check_quest_active, "qst_four_emperors"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 11),
        (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_legatus_11"),
        (assign, "$cant_leave_encounter", 1),
    (else_try),
        (check_quest_active, "qst_four_emperors"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 14),
        (this_or_next|quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_senator_2"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_statthalter_9"),
        (assign, ":auto_return",  "mnu_the_final_speech"),
    (else_try),
        (check_quest_active, "qst_four_emperors"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 15),
        (this_or_next|quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_senator_2"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_statthalter_9"),
        (assign, "$cant_leave_encounter", 1),
    (try_end),

    (str_store_string, s3,
      "@{s2} You have {reg10} troops fit for battle against their {reg11}.^^"
      +"Note: You can access inventory, party screen and character screen via respective keys.^^{s47}"
    ),

    (try_begin), # enable presentation if no skip
        (eq, ":auto_return", 0),
        (start_presentation, "prsnt_simple_encounter"),
        # (display_message, "@Check 1"),
    (else_try), # auto return
        (eq, ":auto_return", 1),
        (change_screen_return),
        # (display_message, "@Check 2"),
    (else_try), # do nothing
        (eq, ":auto_return", 2),
        # (display_message, "@Check 3"),
    (else_try), # jump to menu
        (jump_to_menu, ":auto_return"),
        # (display_message, "@Check 4"),
    (try_end),
  ],[
    # ("battle_size",[
    #   (eq, "$encountered_party_friendly", 0),#display only during hositle encounter
    #   (call_script, "script_current_battle_size"),
    #   (assign,reg34, reg0),
    # ],"Battlesize: {reg34} (press shift to add to battlesize)",[
    #   (options_get_battle_size, reg35), #0-1000
    #   (try_begin),
    #       (this_or_next|key_is_down, key_left_shift),
    #       (key_is_down, key_right_shift),
    #       (val_add, reg35, 28),
    #       (display_message, "@Increased battlesize",message_alert),
    #   (else_try),
    #       (val_sub, reg35, 28),
    #       (display_message, "@Reduced battlesize",message_alert),
    #   (try_end),
    #   (val_clamp, reg35, 0, 1001),
    #   (options_set_battle_size, reg35), #0-1000

    #   (call_script, "script_current_battle_size"),
    #   (assign,reg34, reg0),
    # ]),

	  # ("option_speed",[
    #   (eq, "$encountered_party_friendly", 0),#display only during hositle encounter
    #   (options_get_combat_speed, ":speed"),
    #   (store_add, ":string", ":speed", "str_slowest"),
    #   (str_store_string, s56, ":string"),
    # ],"Battlespeed: {s56}",[
    #   (options_get_combat_speed, ":speed"),
    #   (try_begin),
    #       (eq, ":speed", 0),
    #       (options_set_combat_speed, 1),
    #       (display_message, "@Changed combat speed from: slowest to slow",message_alert),
    #   (else_try),
    #       (eq, ":speed", 1),
    #       (options_set_combat_speed, 2),
    #       (display_message, "@Changed combat speed from: slow to normal",message_alert),
    #   (else_try),
    #       (eq, ":speed", 2),
    #       (options_set_combat_speed, 3),
    #       (display_message, "@Changed combat speed from: normal to fast",message_alert),
    #   (else_try),
    #       (eq, ":speed", 3),
    #       (options_set_combat_speed, 4),
    #       (display_message, "@Changed combat speed from: fast to fastest",message_alert),
    #   (else_try),
    #       (eq, ":speed", 4),
    #       (options_set_combat_speed, 0),
    #       (display_message, "@Changed combat speed from: fastest to slowest",message_alert),
    #   (try_end),
    # ]),

    # ("playerambush_attack",[
    #   (eq,"$player_ambushed",5),
    #   (eq, "$encountered_party_friendly", 0),
    #   (neg|troop_is_wounded, "trp_player"),
    #   (neq, "$g_encounter_type", enctype_fighting_against_village_raid),
    #   (party_get_current_terrain, ":terrain_type", "p_main_party"),
    #   (neq,":terrain_type",0),	#no ambushes at sea
    #   (neq,":terrain_type",7),
    #   (neq,":terrain_type",8),
    #   #limit parties that ambush
    #   (neg|is_between, "$g_encountered_party","pt_merchant_caravan", "pt_kingdom_hero_party"),
    #   (neg|is_between, "$g_encountered_party","pt_steppe_bandit_lair", "pt_legio_i_adjutrix_staff"),
    #   (troop_slot_eq, "trp_global_variables", g_player_trench, 0),
    # ],"Ambush the enemy!",[
    #   (assign,"$player_ambushed",4),
    #   (assign, "$g_battle_result", 0),
    #   (assign, "$g_engaged_enemy", 1),

    # #	(assign, "$player_deploy_troops", 1),
    #   #(assign,"$player_ambushed",1),
    #   (call_script, "script_calculate_renown_value"),
    #   ##diplomacy start+
    #   (try_begin),
		# 			#Call this to properly set cached values for strength
		# 			(eq, "$g_dplmc_terrain_advantage", DPLMC_TERRAIN_ADVANTAGE_ENABLE),
		# 			(assign, ":terrain_code", dplmc_terrain_code_none),#defined in header_terrain_types.py
		# 			(try_begin),
    #           (this_or_next|eq, "$g_encounter_type", enctype_fighting_against_village_raid),
    #           (eq, "$g_encounter_type", enctype_catched_during_village_raid),
    #           (assign, ":terrain_code", dplmc_terrain_code_village),#defined in header_terrain_types.py
		# 			(else_try),
    #           (encountered_party_is_attacker),
    #           (call_script, "script_dplmc_get_terrain_code_for_battle", "$g_encountered_party", "p_main_party"),
    #           (assign, ":terrain_code", reg0),
		# 			(else_try),
    #           (call_script, "script_dplmc_get_terrain_code_for_battle", "p_main_party", "$g_encountered_party"),
    #           (assign, ":terrain_code", reg0),
		# 			(try_end),
		# 			(neq, ":terrain_code", dplmc_terrain_code_none),
		# 			(call_script, "script_dplmc_party_calculate_strength_in_terrain", "p_main_party", ":terrain_code", 0, 1),
		# 			(call_script, "script_dplmc_party_calculate_strength_in_terrain", "$g_encountered_party", ":terrain_code", 0, 1),
    #   (try_end),
    #   ##diplomacy end+
    #   (call_script, "script_calculate_battle_advantage"),
    #   (set_battle_advantage, reg0),
    #   (set_party_battle_mode),

    #   (display_message, "@You have ambushed the enemy!", message_positive),
    #   (set_jump_mission,"mt_lead_charge_ambush_attack"),
    #   (party_get_current_terrain, ":terrain_type", "p_main_party"),
    #   (call_script, "script_setup_random_scene_ambush", ":terrain_type"),
    #   (jump_to_scene, reg0),
    #   (assign, "$g_next_menu", "mnu_simple_encounter"),
    #   (jump_to_menu, "mnu_battle_debrief"),
    #   (change_screen_mission),
    # ]),

	  # ("ambush123",[
    #   (eq,"$player_ambushed",1),
    #   (eq, "$encountered_party_friendly", 0),
    # ],"Defend!",[
    #   (assign,"$player_ambushed",3),
    #   (assign, "$g_battle_result", 0),
    #   (assign, "$g_engaged_enemy", 1),
    #   (call_script, "script_calculate_renown_value"),
    #   ##diplomacy start+
    #   (try_begin),
    #       #Call this to properly set cached values for strength
    #       (eq, "$g_dplmc_terrain_advantage", DPLMC_TERRAIN_ADVANTAGE_ENABLE),
    #       (assign, ":terrain_code", dplmc_terrain_code_none),#defined in header_terrain_types.py
    #       (try_begin),
    #           (this_or_next|eq, "$g_encounter_type", enctype_fighting_against_village_raid),
    #               (eq, "$g_encounter_type", enctype_catched_during_village_raid),
    #           (assign, ":terrain_code", dplmc_terrain_code_village),#defined in header_terrain_types.py
    #       (else_try),
    #           (encountered_party_is_attacker),
    #           (call_script, "script_dplmc_get_terrain_code_for_battle", "$g_encountered_party", "p_main_party"),
    #           (assign, ":terrain_code", reg0),
    #       (else_try),
    #           (call_script, "script_dplmc_get_terrain_code_for_battle", "p_main_party", "$g_encountered_party"),
    #           (assign, ":terrain_code", reg0),
    #       (try_end),
    #       (neq, ":terrain_code", dplmc_terrain_code_none),
    #       (call_script, "script_dplmc_party_calculate_strength_in_terrain", "p_main_party", ":terrain_code", 0, 1),
    #       (call_script, "script_dplmc_party_calculate_strength_in_terrain", "$g_encountered_party", ":terrain_code", 0, 1),
    #   (try_end),
    #   ##diplomacy end+
    #   (call_script, "script_calculate_battle_advantage"),
    #   (set_battle_advantage, reg0),
    #   (set_party_battle_mode),

    #   (display_message, "@You have been ambushed!", message_negative),
    #   (set_jump_mission,"mt_lead_charge_ambush"),

    #   (party_get_current_terrain, ":terrain_type", "p_main_party"),
    #   (call_script, "script_setup_random_scene_ambush", ":terrain_type"),
    #   (jump_to_scene, reg0),

    #   (assign, "$g_next_menu", "mnu_simple_encounter"),
    #   (jump_to_menu, "mnu_battle_debrief"),
    #   (change_screen_mission),
    # ]),

    ###chief tacticas, discursos, combate campeones etc...
    # ("tactical_nuevo",[
    #   (neq, "$player_ambushed",1),#Ambush Yes
    #   (neq, "$g_empieza_asedio", 1),#no in sieges
    #   (eq, "$encountered_party_friendly", 0),
    #   (neg|troop_is_wounded, "trp_player"),
    #   (party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
    #   (ge, ":tactics", 4),
    #   (party_get_current_terrain,":terrain","p_main_party"),
    #   (neq,":terrain",0),
    #   (neq,":terrain",7),
    #   (neq,":terrain",8),
    #   (neq,":terrain",6),
    #   (troop_slot_eq, "trp_global_variables", g_player_trench, 0),
    # ],"Commander's Options.",[
    #   (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
    #   (assign, ":num_men", 0),
    #   (try_for_range, ":i_stack", 0, ":num_stacks"),
    #       (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
    #       (val_add, ":num_men", ":stack_size"),
    #   (try_end),
    #   (try_begin),
    #       (ge, ":num_men", 50), # deja pasar si el player tiene por lo menos 50 hombres
    #       #(assign,"$emboscada_time", 1), #antes de 48 horas no puede haber otra emboscada ambush chief
    #       (jump_to_menu,"mnu_panel_comandante"),
    #   (else_try),
    #       (display_message,"@You need to have 50 or more men in order to use the commander panel."),
    #   (try_end),
    # ]),

    # ("encounter_attack",[
    #   (neq, "$player_ambushed",1),#Ambush Yes
    #   (party_get_current_terrain, ":terrain_type", "p_main_party"),
    #   (neq,":terrain_type",0),	#no ambushes at sea
    #   (neq,":terrain_type",7),
    #   (neq,":terrain_type",8),
    #   (neq,":terrain_type",6),
    #   (eq, "$encountered_party_friendly", 0),
    #   (neg|troop_is_wounded, "trp_player"),
    # ],"Charge the enemy.",[
    #   (assign, "$g_battle_result", 0),
    #   (assign, "$g_engaged_enemy", 1),

    #   (assign, "$player_deploy_troops", 1),
    #   # (party_get_template_id, ":encountered_party_template", "$g_encountered_party"),

    #   (call_script, "script_calculate_renown_value"),
    #   ##diplomacy start+
    #   (try_begin),
    #       #Call this to properly set cached values for strength
    #       (eq, "$g_dplmc_terrain_advantage", DPLMC_TERRAIN_ADVANTAGE_ENABLE),
    #       (assign, ":terrain_code", dplmc_terrain_code_none),#defined in header_terrain_types.py
    #       (try_begin),
    #           (this_or_next|eq, "$g_encounter_type", enctype_fighting_against_village_raid),
    #           (eq, "$g_encounter_type", enctype_catched_during_village_raid),
    #           (assign, ":terrain_code", dplmc_terrain_code_village),#defined in header_terrain_types.py
    #       (else_try),
    #           (encountered_party_is_attacker),
    #           (call_script, "script_dplmc_get_terrain_code_for_battle", "$g_encountered_party", "p_main_party"),
    #           (assign, ":terrain_code", reg0),
    #       (else_try),
    #           (call_script, "script_dplmc_get_terrain_code_for_battle", "p_main_party", "$g_encountered_party"),
    #           (assign, ":terrain_code", reg0),
    #       (try_end),
    #       (neq, ":terrain_code", dplmc_terrain_code_none),
    #       (call_script, "script_dplmc_party_calculate_strength_in_terrain", "p_main_party", ":terrain_code", 0, 1),
    #       (call_script, "script_dplmc_party_calculate_strength_in_terrain", "$g_encountered_party", ":terrain_code", 0, 1),
    #   (try_end),
    #   ##diplomacy end+
    #   (call_script, "script_calculate_battle_advantage"),
    #   (set_battle_advantage, reg0),
    #   (set_party_battle_mode),
    #   (try_begin),
    #       (troop_slot_eq, "trp_global_variables", g_player_trench, 1),
    #       (set_jump_mission,"mt_camp_defend"),
    #       (call_script, "script_get_camp_scene"),
    #       (jump_to_scene, reg0),
    #   (else_try),
    #       (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
    #       (set_jump_mission,"mt_village_raid"),
    #       (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
    #       (jump_to_scene, ":scene_to_use"),
    #   (else_try),
    #       (eq, "$g_encounter_type", enctype_catched_during_village_raid),
    #       (set_jump_mission,"mt_village_raid"),
    #       (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
    #       (jump_to_scene, ":scene_to_use"),
    # # (else_try),
    #   # (this_or_next|eq, ":terrain_type", rt_desert),
    #   # (eq, ":terrain_type", rt_desert_forest),
    #   # (eq, ":encountered_party_template", "pt_kingdom_caravan_party"),
    #   # (assign, ":scene_to_use", "scn_caravan_ambush_desert"),
    #   # (jump_to_scene, ":scene_to_use"),
    #   # (set_jump_mission,"mt_lead_charge"),
    # # (else_try),
    #   # (this_or_next|eq, ":terrain_type", rt_snow),
    #   # (eq, ":terrain_type", rt_snow_forest),
    #   # (eq, ":encountered_party_template", "pt_kingdom_caravan_party"),
    #   # (assign, ":scene_to_use", "scn_caravan_ambush_med"),
    #   # (jump_to_scene, ":scene_to_use"),
    #   # (set_jump_mission,"mt_lead_charge"),
    # # (else_try),
    #   # (eq, ":encountered_party_template", "pt_kingdom_caravan_party"),
    #   # (assign, ":scene_to_use", "scn_caravan_ambush"),
    #   # (jump_to_scene, ":scene_to_use"),
    #   # (set_jump_mission,"mt_lead_charge"),
    #   (else_try),
    #       (check_quest_active, "qst_four_emperors"),
    #       (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 11),
    #       (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_legatus_11"),
    #       (set_jump_mission,"mt_lead_charge"),
    #       (jump_to_scene, "scn_second_battle_of_bedriacum"),
    #   (else_try),
    #       (check_quest_active, "qst_four_emperors"),
    #       (this_or_next|quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_senator_2"),
    #       (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_statthalter_9"),
    #       (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 15),
    #       (set_jump_mission,"mt_lead_charge"),
    #       (jump_to_scene, "scn_second_battle_of_bedriacum"),
    #   (else_try),
    #     # (call_script, "script_encounter_calculate_fit"),
    #     # (try_begin),
    #       # (this_or_next|ge, reg10, 100),
    #       # (ge, reg11, 100),
    #       # (set_jump_mission,"mt_lead_charge_large"),
    #       # (call_script, "script_setup_random_scene"),
    #     # (else_try),
    #       (set_jump_mission,"mt_lead_charge"),
    #       (call_script, "script_setup_random_scene"),
    #     # (try_end),
    #   (try_end),
    #   (assign, "$g_next_menu", "mnu_simple_encounter"),
    #   (jump_to_menu, "mnu_battle_debrief"),
    #   (change_screen_mission),
    # ]),

    # ("encounter_attack",[
    #   (eq, "$encountered_party_friendly", 0),
    #   (neg|troop_is_wounded, "trp_player"),
		# 	(party_slot_eq, "p_main_party", slot_party_on_water, 1),
	  #   (party_get_current_terrain, ":terrain_type", "p_main_party"),
		# 	(this_or_next|eq,":terrain_type",0),	#no ambushes at sea
		# 	(this_or_next|eq,":terrain_type",7),
		# 	(this_or_next|eq,":terrain_type",8),
		# 	(eq,":terrain_type",6),
    # ],"Close in and board the enemy.",[
    #   (assign, "$g_battle_result", 0),
    #   (assign, "$g_engaged_enemy", 1),
    #   (call_script, "script_calculate_renown_value"),
    #   (call_script, "script_calculate_battle_advantage"),
    #   (set_battle_advantage, reg0),
    #   (set_party_battle_mode),
    #   (try_begin),
    #       (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
    #       (set_jump_mission,"mt_village_raid"),
    #       (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
    #       (jump_to_scene, ":scene_to_use"),
    #   (else_try),
    #       (eq, "$g_encounter_type", enctype_catched_during_village_raid),
    #       (set_jump_mission,"mt_village_raid"),
    #       (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
    #       (jump_to_scene, ":scene_to_use"),
    #   (else_try),
    #       (set_jump_mission,"mt_ship_battle"),
    #         # (try_begin),
    #         # (store_faction_of_party, ":fac","$g_enemy_party"),
    #         # (faction_slot_eq, ":fac", slot_faction_culture, "fac_culture_7"),
    #       (jump_to_scene, "scn_sea_roman"),
    #         # (else_try),
    #         # (jump_to_scene, "scn_sea_barbarian"),
    #       # (try_end),
    #         #Wulf end
    #   (try_end),
    #   (assign, "$g_next_menu", "mnu_simple_encounter"),
    #   (jump_to_menu, "mnu_battle_debrief"),
    #   (change_screen_mission),
    # ]),

    # ("encounter_order_attack",[
    #   (neq, "$player_ambushed",1),#Ambush Yes
    #   (eq, "$encountered_party_friendly", 0),
    #   #(call_script, "script_party_count_members_with_full_health", "p_main_party"),(ge, reg0, 4),
    # ],
    # "Order your troops to attack without you.",
    # [
    #   (jump_to_menu, "mnu_order_attack_begin"),
    # ]),

    # ("encounter_leave",[
    #   (neq, "$player_ambushed",1),
    #   (eq,"$cant_leave_encounter", 0),
    #   (eq, "$enlisted_party",-1),
    # ],"Leave.",[
    #   (try_begin),
    #       (eq, "$encountered_party_friendly", 0),
    #       (encountered_party_is_attacker),
    #       (call_script, "script_objectionable_action", tmt_aristocratic, "str_flee_battle"),
    #   (try_end),
    #   (try_begin),
    #       (eq, "$encountered_party_friendly", 0),
    #       (party_get_num_companion_stacks, ":num_stacks", "p_encountered_party_backup"),
    #       (try_for_range, ":stack_no", 0, ":num_stacks"),
    #           (party_stack_get_troop_id,   ":stack_troop","p_encountered_party_backup",":stack_no"),
    #           (is_between, ":stack_troop", active_npcs_begin, active_npcs_end),
    #           (troop_slot_eq, ":stack_troop", slot_troop_occupation, slto_kingdom_hero),
    #           (store_troop_faction, ":victorious_faction", ":stack_troop"),
    #           (call_script, "script_add_log_entry", logent_player_retreated_from_lord, "trp_player",  -1, ":stack_troop", ":victorious_faction"),
    #       (try_end),
    #   (try_end),
    #   (leave_encounter),
    #   (change_screen_return),
    # ]),

    # ("encounter_leave",[
    #   (neq, "$player_ambushed",1),
    #   (eq,"$cant_leave_encounter", 0),
    #   (gt, "$enlisted_party",-1),
    #   (call_script, "script_party_count_fit_for_battle", "$g_enemy_party"),
    #   (gt, reg0, 0),
    # ],"Leave. [Try to end current battle.]",[
    #   (leave_encounter),
    #   (change_screen_return),
    #   (party_leave_cur_battle, "$enlisted_party"),
    #   (party_relocate_near_party, "$enlisted_party", "$g_encountered_party", 3),
    # ]),

    # ("encounter_leave",[
    #   (neq, "$player_ambushed",1),
    #   (eq,"$cant_leave_encounter", 0),
    #   (gt, "$enlisted_party",-1),
    #   (call_script, "script_party_count_fit_for_battle", "$g_enemy_party"),
    #   (le, reg0, 0),
    # ],"Leave.",[
    #   (try_begin),
    #       (eq, "$encountered_party_friendly", 0),
    #       (encountered_party_is_attacker),
    #       (call_script, "script_objectionable_action", tmt_aristocratic, "str_flee_battle"),
    #   (try_end),
    #   (try_begin),
    #       (eq, "$encountered_party_friendly", 0),
    #       (party_get_num_companion_stacks, ":num_stacks", "p_encountered_party_backup"),
    #       (try_for_range, ":stack_no", 0, ":num_stacks"),
    #           (party_stack_get_troop_id,   ":stack_troop","p_encountered_party_backup",":stack_no"),
    #           (is_between, ":stack_troop", active_npcs_begin, active_npcs_end),
    #           (troop_slot_eq, ":stack_troop", slot_troop_occupation, slto_kingdom_hero),
    #           (store_troop_faction, ":victorious_faction", ":stack_troop"),
    #           (call_script, "script_add_log_entry", logent_player_retreated_from_lord, "trp_player",  -1, ":stack_troop", ":victorious_faction"),
    #       (try_end),
    #   (try_end),
    #   (leave_encounter),
    #   (change_screen_map),
    # ]),

    # ("encounter_retreat",[
    #   (neq, "$player_ambushed",1),
    #   (eq,"$cant_leave_encounter", 1),
    #   (call_script, "script_get_max_skill_of_player_party", "skl_tactics"),
    #   (assign, ":max_skill", reg0),
    #   (val_add, ":max_skill", 4),

    #   (call_script, "script_party_count_members_with_full_health", "p_collective_enemy", 0),
    #   (assign, ":enemy_party_strength", reg0),
    #   (val_div, ":enemy_party_strength", 2),

    #   (val_div, ":enemy_party_strength", ":max_skill"),
    #   (val_max, ":enemy_party_strength", 1),

    #   (call_script, "script_party_count_fit_regulars", "p_main_party"),
    #   (assign, ":player_count", reg0),
    #   (ge, ":player_count", ":enemy_party_strength"),
    # ],"Pull back, leaving some soldiers behind to cover your retreat.",
    # [
    #   (jump_to_menu, "mnu_encounter_retreat_confirm"),
    # ]),

    # ("encounter_surrender",[
    #   (eq,"$cant_leave_encounter", 1),
    # ],"Surrender.",[
    #   (assign,"$g_player_surrenders",1)
    # ]),
]),

  (
    "encounter_retreat_confirm",0,
    "As the party member with the highest tactics skill,\
 ({reg2}), {reg3?you devise:{s3} devises} a plan that will allow you and your men to escape with your lives,\
 but you'll have to leave {reg4} soldiers behind to stop the enemy from giving chase.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_tactics"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),
     (val_add, ":max_skill", 4),

     (call_script, "script_party_count_members_with_full_health", "p_collective_enemy", 0),
     (assign, ":enemy_party_strength", reg0),
     (val_div, ":enemy_party_strength", 2),

     (store_div, reg4, ":enemy_party_strength", ":max_skill"),
     (val_max, reg4, 1),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),

    #SB : add tableau
     (set_fixed_point_multiplier, 100),
     (position_set_x, pos0, 70),
     (position_set_y, pos0, 5),
     (position_set_z, pos0, 75),
     (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", ":max_skill_owner", pos0),
     ],
    [
      ("leave_behind",[],"Go on. The sacrifice of these men will save the rest.",[
          (assign, ":num_casualties", reg4),
          (try_for_range, ":unused", 0, ":num_casualties"),
            (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
            (assign, ":lost_troop", reg0),
            (store_random_in_range, ":random_no", 0, 100),
            (ge, ":random_no", 30),
            (party_add_prisoners, "$g_encountered_party", ":lost_troop", 1),
           (try_end),
           (call_script, "script_change_player_party_morale", -20),
           (call_script, "script_change_troop_renown", "trp_player", -7), #SB : renown change
           (try_begin), #SB: max skill owner uses tactics
             # (eq, reg3, 0),
             (call_script, "script_get_max_skill_of_player_party", "skl_tactics"),
             (is_between, reg1, companions_begin, companions_end),
             (call_script, "script_change_troop_renown", reg1, dplmc_companion_battle_renown), #SB : renown change, less reward
           (try_end),
           (jump_to_menu, "mnu_encounter_retreat"),
          ]),
      ("dont_leave_behind",[],"No. We leave no one behind.",[(jump_to_menu, "mnu_simple_encounter"),]),
    ]
  ),
  (
    "encounter_retreat",0,
    "You tell {reg4} of your troops to hold the enemy while you retreat with the rest of your party.",
    "none",
    [
     ],
    [
      ("continue",[],"Continue...",
	  [
###Troop commentary changes begin
          (call_script, "script_objectionable_action", tmt_aristocratic, "str_flee_battle"),
          (party_get_num_companion_stacks, ":num_stacks", "p_encountered_party_backup"),
          (try_for_range, ":stack_no", 0, ":num_stacks"),
              (party_stack_get_troop_id,   ":stack_troop","p_encountered_party_backup",":stack_no"),
              (is_between, ":stack_troop", active_npcs_begin, active_npcs_end),
              (troop_slot_eq, ":stack_troop", slot_troop_occupation, slto_kingdom_hero),
              (store_troop_faction, ":victorious_faction", ":stack_troop"),
              (call_script, "script_add_log_entry", logent_player_retreated_from_lord_cowardly, "trp_player",  -1, ":stack_troop", ":victorious_faction"),
          (try_end),
###Troop commentary changes end
        (party_ignore_player, "$g_encountered_party", 1),
        (leave_encounter),
		(change_screen_return),
          ##diplomacy begin
          #(assign, "$g_move_fast", 1),
          ##diplomacy end
          ]),
    ]
  ),

("order_attack_begin",0,
  "Your troops prepare to attack the enemy.",
  "none",[
    (set_background_mesh, "mesh_pic_charge"),
  ],[
    ("order_attack_begin",[
    ],"Order the attack to begin.",[
      (assign, "$g_engaged_enemy", 1),
      (jump_to_menu,"mnu_order_attack_2"),
    ]),
    ("call_back",[
    ],"Call them back.",[
      (jump_to_menu,"mnu_simple_encounter")
    ]),
]),

("order_attack_2",mnf_disable_all_keys,
  "{s4}^^Your casualties: {s8}^^Enemy casualties: {s9}",
  "none",[
      (set_background_mesh, "mesh_pic_charge"),

      (call_script, "script_party_calculate_strength", "p_main_party", 1), #exclude player
      (assign, ":player_party_strength", reg0),

      (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
      (assign, ":enemy_party_strength", reg0),

      (party_collect_attachments_to_party, "p_main_party", "p_collective_ally"),
      (call_script, "script_party_calculate_strength", "p_collective_ally", 1), #exclude player
      (assign, ":total_player_and_followers_strength", reg0),
      (try_begin),
        (le, ":total_player_and_followers_strength", ":enemy_party_strength"),
        (assign, ":minimum_power", ":total_player_and_followers_strength"),
      (else_try),
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_end),

      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 1),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 2),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 3),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 4),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 5),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 6),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 7),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 8),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 9),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 10),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 11),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 12),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 13),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 14),
      (else_try),
        (assign, ":division_constant", 15),
      (try_end),

      (val_div, ":player_party_strength", ":division_constant"), #1.126, ":division_constant" was 5 before
      (val_max, ":player_party_strength", 1), #1.126
      (val_div, ":enemy_party_strength", ":division_constant"), #1.126, ":division_constant" was 5 before
      (val_max, ":enemy_party_strength", 1), #1.126
      (val_div, ":total_player_and_followers_strength", ":division_constant"), #1.126, ":division_constant" was 5 before
      (val_max, ":total_player_and_followers_strength", 1), #1.126

      (store_mul, "$g_strength_contribution_of_player", ":player_party_strength", 100),
      (val_div, "$g_strength_contribution_of_player", ":total_player_and_followers_strength"),

      (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),

      (try_begin),
        (ge, "$g_ally_party", 0),
        (inflict_casualties_to_party_group, "$g_ally_party", ":enemy_party_strength", "p_temp_casualties"),
        (str_store_string_reg, s8, s0),
      (try_end),

      (try_begin),
          (ge, "$cheat_mode", 1),
          (val_mul, ":total_player_and_followers_strength", 500),
      (try_end),
      (inflict_casualties_to_party_group, "$g_encountered_party", ":total_player_and_followers_strength", "p_temp_casualties"),

      #ozan begin
      (party_get_num_companion_stacks, ":num_stacks", "p_temp_casualties"),
      (try_for_range, ":stack_no", 0, ":num_stacks"),
        (party_stack_get_troop_id, ":stack_troop", "p_temp_casualties", ":stack_no"),
        (try_begin),
          (party_stack_get_size, ":stack_size", "p_temp_casualties", ":stack_no"),
          (gt, ":stack_size", 0),
          (party_add_members, "p_total_enemy_casualties", ":stack_troop", ":stack_size"), #addition_to_p_total_enemy_casualties
          (party_stack_get_num_wounded, ":stack_wounded_size", "p_temp_casualties", ":stack_no"),
          (gt, ":stack_wounded_size", 0),
          (party_wound_members, "p_total_enemy_casualties", ":stack_troop", ":stack_wounded_size"),
        (try_end),
      (try_end),
      #ozan end

      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),

      (party_collect_attachments_to_party, "$g_encountered_party", "p_collective_enemy"),
      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":num_our_regulars_remaining", reg0),
        (store_add, ":num_routed_us_plus_one", "$num_routed_us", 1),
        (le, ":num_our_regulars_remaining", ":num_routed_us_plus_one"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_order_attack_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":num_enemy_regulars_remaining", reg0),
        (this_or_next|le, ":num_enemy_regulars_remaining", 0),
        (le, ":num_enemy_regulars_remaining", "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
        (assign, ":continue", 0),
        (party_get_num_companion_stacks, ":party_num_stacks", "p_collective_enemy"),
        (try_begin),
          (eq, ":party_num_stacks", 0),
          (assign, ":continue", 1),
        (else_try),
          (party_stack_get_troop_id, ":party_leader", "p_collective_enemy", 0),
          (try_begin),
            (neg|troop_is_hero, ":party_leader"),
            (assign, ":continue", 1),
          (else_try),
            (troop_is_wounded, ":party_leader"),
            (assign, ":continue", 1),
          (try_end),
        (try_end),
        (eq, ":continue", 1),
        (assign, "$g_battle_result", 1),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_order_attack_success"),
      (else_try),
      (str_store_string, s4, "str_order_attack_continue"),
    (try_end),
  ],[
    ("order_attack_continue",[(eq, "$no_soldiers_left", 0)],"Order your soldiers to continue the attack.",[
      (jump_to_menu,"mnu_order_attack_2"),
    ]),
    ("order_retreat",[(eq, "$no_soldiers_left", 0)],"Call your soldiers back.",[
      (jump_to_menu,"mnu_simple_encounter"),
    ]),
    ("continue",[(eq, "$no_soldiers_left", 1)],"Continue...",[
      (jump_to_menu,"mnu_simple_encounter"),
    ]),
]),

("battle_debrief",mnf_scale_picture|mnf_disable_all_keys,
  "{s11}^^Your Casualties:{s8}{s10}^^Enemy Casualties:{s9}^^Kill count:{s12}",
  "none",[
    (call_script, "script_recover_class_name"),
    # (try_begin),
      # (gt, "$enlisted_party", -1),##freelancing
      # (quest_get_slot, ":progress", "qst_freelancing", slot_quest_freelancer_progress),
      # (val_add, ":progress", 5),
      # (quest_set_slot, "qst_freelancing", slot_quest_freelancer_progress, ":progress"),
      # (display_message, "@You gained {reg3} progress points from participating in battle."),
    # (try_end),
    #copy backup to main party
    (try_begin),
        (eq, "$auxilary_player_active", 1),

        ###new method, adjust the main party, by the manualy counted one
        ##adjust the party to pre battle
        (party_get_num_companion_stacks, ":stack_num", "p_temp_casualties_3"),
        (try_for_range, ":stack_no", 0, ":stack_num"),
            (party_stack_get_troop_id, ":stack_troop", "p_temp_casualties_3",":stack_no"),
            (neq, ":stack_troop", "trp_player"), #player does not count
            (neg|troop_is_hero, ":stack_troop"), #heroes either
            (party_count_members_of_type,":main_troop_count","p_main_party",":stack_troop"), #get number of troops from main
            (party_count_members_of_type,":sub_troop_count","p_temp_casualties_3",":stack_troop"), #get number of troops from sub
            (try_begin),
                (gt, ":sub_troop_count", ":main_troop_count"), #sub party has more members
                (store_sub, ":amount", ":sub_troop_count", ":main_troop_count"), #calculate number of troops to adjust
                (party_add_members, "p_main_party", ":stack_troop", ":amount"), #adjust number of troops in the main party
            (else_try),
                (lt, ":sub_troop_count", ":main_troop_count"), #sub party has less members
                (store_sub, ":amount", ":main_troop_count", ":sub_troop_count"), #calculate number of troops to adjust
                (party_remove_members, "p_main_party", ":stack_troop", ":amount"), #adjust number of troops in the main party
            (try_end),
            #wound the members, only if there are less wounded in the main party
            (party_stack_get_num_wounded, ":num_wounded_sub", "p_temp_casualties_3", ":stack_no"),
            (party_stack_get_num_wounded, ":num_wounded_main", "p_main_party", ":stack_no"),
            (try_begin),
                (gt, ":num_wounded_sub", ":num_wounded_main"), #sub has more wounded
                (store_sub, ":amount", ":num_wounded_sub", ":num_wounded_main"), #calculate number of troops to wound
                (party_wound_members, "p_main_party", ":stack_troop", ":amount"),
            (try_end),
        (try_end),
        ##adjust the party based on the casualties sustained on the battlefield
        (party_get_num_companion_stacks, ":num_stacks","p_player_casualties"),
        (try_for_range, ":stack_no", 0, ":num_stacks"),
            (party_stack_get_troop_id, ":stack_troop","p_player_casualties",":stack_no"),
            (neq, ":stack_troop", "trp_player"), #player does not count
            (neg|troop_is_hero, ":stack_troop"), #heroes either
            (party_stack_get_size, ":stack_size","p_player_casualties",":stack_no"),
            (party_stack_get_num_wounded, ":num_wounded", "p_player_casualties", ":stack_no"),
            (val_sub, ":stack_size", ":num_wounded"),
            (party_remove_members, "p_main_party", ":stack_troop", ":stack_size"),
            (party_wound_members, "p_main_party", ":stack_troop", ":num_wounded"),
        (try_end),
        (party_clear, "p_temp_casualties_3"),
        (assign, "$auxilary_player_active", 0),
    (try_end),
    #TOM
    (try_begin),
        (eq, "$g_battle_result", 1),
        (try_begin),
            (eq, "$g_encountered_party_template", "pt_kingdom_hero_party"),#is fighting a lord
            (store_div, ":influence", "$battle_renown_value", 2),
            (is_between, "$players_kingdom", npc_kingdoms_begin,npc_kingdoms_end),
            (call_script, "script_change_influence", "trp_player", ":influence"),#add also influence
            #  (faction_slot_eq, "$players_kingdom", slot_faction_government_type, gov_imperial),
        (try_end),
        (call_script, "script_change_troop_renown", "trp_player", "$battle_renown_value"),
        #SB : also distribute amount to companions, maybe pretender/spouse in party as well
        (assign, ":amount", 0),
        (try_for_range, ":companions", companions_begin, companions_end),
            (main_party_has_troop, ":companions"),
            (val_add, ":amount", 1),
        (try_end),
        (try_begin),
            (gt, ":amount", 0),
            (store_div, ":amount", "$battle_renown_value", ":amount"),
            (val_max, ":amount", dplmc_companion_battle_renown),
            (try_for_range, ":companions", companions_begin, companions_end),
                (main_party_has_troop, ":companions"),
                # (neg|troop_is_wounded, ":companions"), #survived, or stayed at the back
                (call_script, "script_change_troop_renown", ":companions", ":amount"),
            (try_end),
        (try_end),
    (try_end),

    (call_script, "script_count_casualties_and_adjust_morale"),#new
    (call_script, "script_encounter_calculate_fit"),

    (call_script, "script_party_count_fit_regulars", "p_main_party"),
    (assign, "$playerparty_postbattle_regulars", reg0),

    (try_begin),
        (eq, "$g_battle_result", 1),
        (eq, "$g_enemy_fit_for_battle", 0),
        (str_store_string, s11, "@You were victorious!"),
  #       (play_track, "track_bogus"), #clear current track.
  #       (call_script, "script_music_set_situation_with_culture", mtf_sit_victorious),
        (try_begin),
            (gt, "$g_friend_fit_for_battle", 1),
            (set_background_mesh, "mesh_pic_victory"),
        (try_end),
    (else_try),
        (eq, "$g_battle_result", -1),
        (ge, "$g_enemy_fit_for_battle",1),
        (this_or_next|le, "$g_friend_fit_for_battle",0),
        (le, "$playerparty_postbattle_regulars", 0),
        (str_store_string, s11, "@The battle was lost. Your forces were utterly crushed."), #SB : "The battle"
        (set_background_mesh, "mesh_pic_defeat"),
    (else_try),
        (eq, "$g_battle_result", -1),
        (str_store_string, s11, "@Your companions carry you away from the fighting."),
      ##diplomacy start+ Test gender with script
        #(troop_get_type, ":is_female", "trp_player"),#<- replaced
        (set_background_mesh, "mesh_pic_wounded"),
      ##diplomacy end+
    (else_try),
        (eq, "$g_battle_result", 1),
        (str_store_string, s11, "@You have defeated the enemy."),
        (try_begin),
            (gt, "$g_friend_fit_for_battle", 1),
            (set_background_mesh, "mesh_pic_victory"),
        (try_end),
    (else_try),
        (eq, "$g_battle_result", 0),
        (str_store_string, s11, "@You have retreated from the fight."),
    (try_end),
    #NPC companion changes begin
    ##check for excessive casualties, more forgiving if battle result is good
    (try_begin),
        (gt, "$playerparty_prebattle_regulars", 9),
        (store_add, ":divisor", 3, "$g_battle_result"),
        (store_div, ":half_of_prebattle_regulars", "$playerparty_prebattle_regulars", ":divisor"),
        (lt, "$playerparty_postbattle_regulars", ":half_of_prebattle_regulars"),
        (call_script, "script_objectionable_action", tmt_egalitarian, "str_excessive_casualties"),
        (call_script, "script_objectionable_action", tmt_casualties, "str_excessive_casualties"),
    (try_end),
    #NPC companion changes end
    (call_script, "script_print_casualties_to_s0", "p_player_casualties", 0),
    (str_store_string_reg, s8, s0),
    (call_script, "script_print_casualties_to_s0", "p_enemy_casualties", 0),
    (str_store_string_reg, s9, s0),
    ## CC chief commander
    (call_script, "script_print_kill_count_to_s0"),
    (str_store_string_reg, s12, s0),
    ## CC
    (str_clear, s10),
    (try_begin),
        (eq, "$any_allies_at_the_last_battle", 1),
        (call_script, "script_print_casualties_to_s0", "p_ally_casualties", 0),
        (str_store_string, s10, "@^^Ally Casualties:{s0}"),
    (try_end),
  ],[
  ("continue",[],"Continue...",[
    (jump_to_menu, "$g_next_menu"),
  ]),
]),

("total_victory", 0,
  "You shouldn't be reading this... {s9}",
  "none",[
    (try_begin), # main story final victory
        (assign, ":legatus", -1),
        (quest_get_slot, ":bitch", "qst_four_emperors", slot_quest_main_antonia_or_poppaea),
        (assign, ":enemy_goy", -1),
        (try_begin),
            (check_quest_active, "qst_four_emperors"),
            (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 11),
            (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_legatus_11"),
            (assign, ":legatus", "trp_legatus_11"),
            (assign, ":enemy_goy", "trp_senator_2"),
            (quest_set_slot, "qst_four_emperors", slot_quest_current_state, 12),
        (else_try),
            (check_quest_active, "qst_four_emperors"),
            (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 15),
            (this_or_next|quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_senator_2"),
            (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_statthalter_9"),
            (assign, ":legatus", "trp_legatus_12"),
            (try_begin),
                (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_senator_2"),
                (assign, ":enemy_goy", "trp_statthalter_9"),
            (else_try),
                (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_statthalter_9"),
                (assign, ":enemy_goy", "trp_senator_2"),
            (try_end),
            (quest_set_slot, "qst_four_emperors", slot_quest_current_state, 16),
        (try_end),
        (gt, ":legatus", -1),
        (gt, ":bitch", -1),
        (gt, ":enemy_goy", -1),
        (assign, "$talk_context", tc_hero_defeated),

        (set_jump_mission, "mt_conversation_encounter"),
        (modify_visitors_at_site, "scn_speech_second_battle_of_bedriacum"),
        (reset_visitors),
        # 1-3 player, antonia, vespasian
        (set_visitor, 0, ":enemy_goy"),

        (mission_tpl_entry_set_override_flags, "mt_conversation_encounter", 2, af_override_everything),
        (mission_tpl_entry_clear_override_items),
        (mission_tpl_entry_add_override_item, "mt_conversation_encounter", 2, itm_caligea),#itm_caligea,itm_roman_lupa_dress_2,itm_cloak_5
        (mission_tpl_entry_add_override_item, "mt_conversation_encounter", 2, itm_roman_lupa_dress_2),#itm_caligea,itm_roman_lupa_dress_2,itm_cloak_5
        (mission_tpl_entry_add_override_item, "mt_conversation_encounter", 2, itm_cloak_5),#itm_caligea,itm_roman_lupa_dress_2,itm_cloak_5
        (set_visitor, 2, ":bitch"),
        (set_visitor, 3, ":legatus"),
        (set_visitor, 1, "trp_player"),

        # 4 to 11 troops
        (troop_set_slot, "trp_temp_array_c", 4, 1),
        (troop_set_slot, "trp_temp_array_c", 5, 1),
        (troop_set_slot, "trp_temp_array_c", 6, 3),
        (troop_set_slot, "trp_temp_array_c", 7, 3),
        (troop_set_slot, "trp_temp_array_c", 8, 7),
        (troop_set_slot, "trp_temp_array_c", 9, 7),
        (troop_set_slot, "trp_temp_array_c", 10, 11),
        (troop_set_slot, "trp_temp_array_c", 11, 11),
        (try_for_range, ":entry", 4, 12),
            (troop_get_slot, ":legion", "trp_temp_array_c", ":entry"),
            (val_add, ":legion", "trp_ballistarii"),
            (set_visitors, ":entry", ":legion", 15),
        (try_end),
        (try_for_range, ":entry", 20, 28),
            (set_visitor, ":entry", "trp_centurio_west"),
            (set_visitor, ":entry", "trp_signifer"),
            (set_visitor, ":entry", "trp_cornicen"),
        (try_end),

        # 12,13: aquilifer and vexilarius legion 1
        # ...
        # 18 19: aquilifer and vexilarius legion 4
        (set_visitor, 12, "trp_aquilifer_v_alaudae"),
        (set_visitor, 13, "trp_vexilarius_v_alaudae"),
        (set_visitor, 14, "trp_aquilifer_i"),
        (set_visitor, 15, "trp_vexilarius_i"),
        (set_visitor, 16, "trp_aquilifer_xi"),
        (set_visitor, 17, "trp_vexilarius_xi"),
        (set_visitor, 18, "trp_aquilifer_x"),
        (set_visitor, 19, "trp_vexilarius_x"),

        (jump_to_scene, "scn_speech_second_battle_of_bedriacum"),
        (change_screen_map_conversation, ":bitch"),
    (else_try), #special battle event 1
        (troop_slot_eq, "trp_global_variables", g_lord_event_possible, 0),

        (troop_slot_eq, "trp_player", slot_player_battle_event, 0),
        (get_player_agent_kill_count, ":wounded", 1),
        (get_player_agent_kill_count, ":kill"),
        (val_add, ":kill", ":wounded"),
        (ge, ":kill", 5),
        (troop_set_slot, "trp_player", slot_player_battle_event, 1),
        (jump_to_menu, "mnu_matters_of_life"),
        (assign, "$temp4_1", "mnu_total_victory"),
        (troop_set_slot, "trp_global_variables", g_lord_event_possible, 1),
    (else_try),#special battle event 2
        (troop_slot_eq, "trp_global_variables", g_lord_event_possible, 0),
        (troop_slot_eq, "trp_player", slot_player_battle_event, 1),
        (get_player_agent_kill_count, ":wounded", 1),
        (get_player_agent_kill_count, ":kill"),
        (val_add, ":kill", ":wounded"),
        (ge, ":kill", 50),
        (troop_set_slot, "trp_player", slot_player_battle_event, 2),
        (jump_to_menu, "mnu_matters_of_life"),
        (assign, "$temp4_1", "mnu_total_victory"),
        (troop_set_slot, "trp_global_variables", g_lord_event_possible, 1),
    (else_try), #freelancer, special battle events
        (ge, "$enlisted_party", 1),
        (check_quest_active, "qst_freelancing"),
        (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_event_2, 0),
        (quest_set_slot, "qst_freelancing", slot_quest_freelancer_event_2, 1),
        (jump_to_menu, "mnu_freelancing_battle_event"),
        (assign, "$temp4_1", "mnu_total_victory"),
    (else_try),#freelancer battle
        (try_begin),
            (check_quest_active, "qst_elusive_bandits"),
            (neg|check_quest_succeeded, "qst_elusive_bandits"),
            (neg|check_quest_failed, "qst_elusive_bandits"),

            (quest_get_slot, ":quest_party", "qst_elusive_bandits", slot_quest_target_party),
            (party_is_active, ":quest_party"),
            (party_get_attached_to, ":quest_party_attached",":quest_party"),
            (this_or_next|eq, ":quest_party", "$g_enemy_party"),
            (eq, ":quest_party_attached", "$g_enemy_party"),
            (call_script, "script_succeed_quest", "qst_elusive_bandits"),
        (try_end),
        # We exploit the menu condition system below.
        # The conditions should make sure that always another screen or menu is called.
        (assign, ":break", 0),
        (try_begin),
            (eq, "$routed_party_added", 0), #new
            (assign, "$routed_party_added", 1),
            #add new party to map (routed_warriors)
            (call_script, "script_add_routed_party"),
        (try_end),
        (try_begin),
            (check_quest_active, "qst_track_down_bandits"),
            (neg|check_quest_succeeded, "qst_track_down_bandits"),
            (neg|check_quest_failed, "qst_track_down_bandits"),
            (quest_get_slot, ":quest_party", "qst_track_down_bandits", slot_quest_target_party),
            (party_is_active, ":quest_party"),
            (party_get_attached_to, ":quest_party_attached", ":quest_party"),
            (this_or_next|eq, ":quest_party", "$g_enemy_party"),
            (eq, ":quest_party_attached", "$g_enemy_party"),
            (call_script, "script_succeed_quest", "qst_track_down_bandits"),
        (try_end),
        #for patrol slots to be clears
        (try_for_range, ":town", towns_begin, towns_end),
            (party_get_slot, ":patrol", ":town", slot_town_patrol_party),#clear slot
            (party_is_active, ":patrol"),
            (ge, ":patrol", 1),
            (party_get_attached_to, ":patrol_party_attached", ":patrol"),
            (this_or_next|eq, ":patrol", "$g_enemy_party"),
            (eq, ":patrol_party_attached", "$g_enemy_party"),
            (party_set_slot, ":town", slot_town_patrol_party, 0),
        (try_end),
        (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_party_type, spt_rebellion),
            (display_log_message, "@A rebellion was defeated!", message_defeated),
            (party_get_slot, ":target", "$g_encountered_party", slot_rebellion_target),
            (party_set_slot, ":target", slot_center_ongoing_rebellion, 0),
        (try_end),
        (try_begin),
            (gt, "$g_private_battle_with_troop", 0),
            (troop_slot_eq, "$g_private_battle_with_troop", slot_troop_leaded_party, "$g_encountered_party"),
            (assign, "$g_private_battle_with_troop", 0),
            ##diplomacy start+
            #g_disable_condescending_comments is also used to track the "enhanced/diminished prejudice" setting
            (try_begin),
                (eq, "$g_disable_condescending_comments", 0),
                (assign, "$g_disable_condescending_comments", 1),
            (else_try),
                (eq, "$g_disable_condescending_comments", 2),
                (assign, "$g_disable_condescending_comments", 3),
            ##diplomacy end+
            (try_end),
        (try_end),
        #new - begin
        (party_get_num_companion_stacks, ":num_stacks", "p_collective_enemy"),
        (try_for_range, ":i_stack", 0, ":num_stacks"),
            (party_stack_get_troop_id, ":stack_troop", "p_collective_enemy", ":i_stack"),
            (is_between, ":stack_troop", lords_begin, lords_end),
            (troop_is_wounded, ":stack_troop"),
            (party_add_members, "p_total_enemy_casualties", ":stack_troop", 1),
        (try_end),
        #new - end
        (try_begin),
            # Talk to ally leader
            (eq, "$thanked_by_ally_leader", 0),
            (assign, "$thanked_by_ally_leader", 1),

            (gt, "$g_ally_party", 0),
            #(store_add, ":total_str_without_player", "$g_starting_strength_ally_party", "$g_starting_strength_enemy_party"),

            (store_add, ":total_str_without_player", "$g_starting_strength_friends", "$g_starting_strength_enemy_party"),
            (val_sub, ":total_str_without_player", "$g_starting_strength_main_party"),

            (store_sub, ":ally_strength_without_player", "$g_starting_strength_friends", "$g_starting_strength_main_party"),

            (store_mul, ":ally_advantage", ":ally_strength_without_player", 100),
            (val_add, ":total_str_without_player", 1),
            (val_div, ":ally_advantage", ":total_str_without_player"),
            #Ally advantage=50  means battle was evenly matched

            (store_sub, ":enemy_advantage", 100, ":ally_advantage"),

            (store_mul, ":faction_reln_boost", ":enemy_advantage", "$g_starting_strength_enemy_party"),
            (val_div, ":faction_reln_boost", 3000),
            (val_min, ":faction_reln_boost", 4),

            (store_mul, "$g_relation_boost", ":enemy_advantage", ":enemy_advantage"),
            (val_div, "$g_relation_boost", 700),
            (val_clamp, "$g_relation_boost", 0, 20),

            (party_get_num_companion_stacks, ":num_ally_stacks", "$g_ally_party"),
            (gt, ":num_ally_stacks", 0),
            (store_faction_of_party, ":ally_faction","$g_ally_party"),
            (call_script, "script_change_player_relation_with_faction", ":ally_faction", ":faction_reln_boost"),
            (party_stack_get_troop_id, ":ally_leader", "$g_ally_party"),
            (party_stack_get_troop_dna, ":ally_leader_dna", "$g_ally_party", 0),
            (try_begin),
                (troop_is_hero, ":ally_leader"),
                (troop_get_slot, ":hero_relation", ":ally_leader", slot_troop_player_relation),
                (assign, ":rel_boost", "$g_relation_boost"),
                (try_begin),
                    (lt, ":hero_relation", -5),
                    (val_div, ":rel_boost", 3),
                (try_end),
                (call_script,"script_change_player_relation_with_troop", ":ally_leader", ":rel_boost"),
            (try_end),
            (eq, "$enlisted_party", -1),#freelancer
            (assign, "$talk_context", tc_ally_thanks),
            (call_script, "script_setup_troop_meeting", ":ally_leader", ":ally_leader_dna", -1),
        (else_try),
            # Talk to enemy leaders

            ## main story: not main battle
            (assign, ":block", 0),
            (try_begin),
                (check_quest_active, "qst_blank_quest_19"),
                (quest_slot_eq,"qst_blank_quest_19", slot_quest_object_state, 5),
                (assign, ":block", 1),
            (try_end),
            (eq, ":block", 0),
            (eq, "$enlisted_party", -1),#freelancer
            (assign, ":break", 0),

            (party_get_num_companion_stacks, ":num_stacks", "p_total_enemy_casualties"), #p_encountered changed to total_enemy_casualties

            (try_for_range, ":stack_no", "$last_defeated_hero", ":num_stacks"), #May 31 bug note -- this now returns some heroes in victorious party as well as in the other party
                (eq, ":break", 0),
                (party_stack_get_troop_id, ":stack_troop", "p_total_enemy_casualties", ":stack_no"),
                (party_stack_get_troop_dna, ":stack_troop_dna", "p_total_enemy_casualties", ":stack_no"),
                (troop_is_hero, ":stack_troop"),
                (store_troop_faction, ":defeated_faction", ":stack_troop"),
                #steve post 0912 changes begin - removed, this is duplicated elsewhere in game menus
                #(call_script, "script_add_log_entry", logent_lord_defeated_by_player, "trp_player",  -1, ":stack_troop", ":defeated_faction"),
                (try_begin),
                    (store_relation, ":relation", ":defeated_faction", "fac_player_faction"),
                    (ge, ":relation", 0),
                    (str_store_troop_name, s4, ":stack_troop"),
                    (try_begin),
                        (eq, "$cheat_mode", 1),
                        (display_message, "@{!}{s4} skipped in p_total_enemy_casualties capture queue because is friendly"),
                    (try_end),
                (else_try),
                    (store_add, "$last_defeated_hero", ":stack_no", 1),
                    (call_script, "script_remove_troop_from_prison", ":stack_troop"),
                    (troop_set_slot, ":stack_troop", slot_troop_leaded_party, -1),

                    (call_script, "script_cf_check_hero_can_escape_from_player", ":stack_troop"),

                    (str_store_troop_name, s1, ":stack_troop"),
                    (str_store_faction_name, s3, ":defeated_faction"),
                    (str_store_string, s17, "@{s1} of {s3} managed to escape."),
                    (display_log_message, "@{!}{s17}"),
                    (try_begin),#steal money from heroes
                        (lt, "$player_honor", 0),
                        (troop_get_slot, ":wealth", ":stack_troop", slot_troop_wealth),
                        (ge, ":wealth", 15000),
                        (store_skill_level, ":looting", "skl_looting", "trp_player"),
                        (store_random_in_range, ":r", 0, 15),
                        (lt, ":r", ":looting"),
                        (try_begin),
                            (lt, "$player_honor", -90),
                            (assign, ":fraction", 50),
                        (else_try),
                            (lt, "$player_honor", -70),
                            (assign, ":fraction", 35),
                        (else_try),
                            (lt, "$player_honor", -40),
                            (assign, ":fraction", 20),
                        (else_try),
                            (lt, "$player_honor", -20),
                            (assign, ":fraction", 8),
                        (else_try),
                            (assign, ":fraction", 2),
                        (try_end),
                        (store_mul, ":money", ":wealth", ":fraction"),
                        (val_div, ":money", 100),
                        (troop_add_gold, "trp_player", ":money"),
                        (assign, reg32, ":money"),
                        (str_store_troop_name, s39, ":stack_troop"),
                        (display_message, "@You have stolen {s39} {reg32} denars."),
                        (val_div, ":money", -2),
                        (call_script, "script_add_to_troop_wealth", ":stack_troop", ":money"),
                    (try_end),
                    (jump_to_menu, "mnu_enemy_slipped_away"),
                    (assign, ":break", 1),
                (else_try),
                    (store_add, "$last_defeated_hero", ":stack_no", 1),
                    (call_script, "script_remove_troop_from_prison", ":stack_troop"),
                    (troop_set_slot, ":stack_troop", slot_troop_leaded_party, -1),
                    (try_begin),#steal money from heroes
                        (lt, "$player_honor", 0),
                        (troop_get_slot, ":wealth", ":stack_troop", slot_troop_wealth),
                        (ge, ":wealth", 15000),
                        (store_skill_level, ":looting", "skl_looting", "trp_player"),
                        (store_random_in_range, ":r", 0, 12),
                        (lt, ":r", ":looting"),
                        (try_begin),
                            (lt, "$player_honor", -90),
                            (assign, ":fraction", 60),
                        (else_try),
                            (lt, "$player_honor", -70),
                            (assign, ":fraction", 40),
                        (else_try),
                            (lt, "$player_honor", -40),
                            (assign, ":fraction", 25),
                        (else_try),
                            (lt, "$player_honor", -20),
                            (assign, ":fraction", 10),
                        (else_try),
                            (assign, ":fraction", 10),
                        (try_end),
                        (store_mul, ":money", ":wealth", ":fraction"),
                        (val_div, ":money", 100),
                        (troop_add_gold, "trp_player", ":money"),
                        (assign, reg32, ":money"),
                        (str_store_troop_name, s39, ":stack_troop"),
                        (display_message, "@You have stolen {s39} {reg32} denars."),
                        (val_div, ":money", -2),
                        (call_script, "script_add_to_troop_wealth", ":stack_troop", ":money"),
                    (try_end),
                    (assign, "$talk_context", tc_hero_defeated),
                    (call_script, "script_setup_troop_meeting", ":stack_troop", ":stack_troop_dna", -1),
                    (assign, ":break", 1),
                (try_end),
            (try_end),
            (eq, ":break", 1),
        (else_try),
            # Talk to freed heroes
            (eq, "$enlisted_party", -1),#freelancer
            (assign, ":break", 0),
            (party_get_num_prisoner_stacks, ":num_prisoner_stacks", "p_collective_enemy"),
            (try_for_range, ":stack_no", "$last_freed_hero", ":num_prisoner_stacks"),
                (eq, ":break", 0),
                (party_prisoner_stack_get_troop_id, ":stack_troop", "p_collective_enemy", ":stack_no"),
                (troop_is_hero, ":stack_troop"),
                (party_prisoner_stack_get_troop_dna, ":stack_troop_dna", "p_collective_enemy", ":stack_no"),
                (store_add, "$last_freed_hero", ":stack_no", 1),
                (assign, "$talk_context", tc_hero_freed),
                (call_script, "script_setup_troop_meeting", ":stack_troop", ":stack_troop_dna", -1),
                (assign, ":break", 1),
            (try_end),
            (eq, ":break", 1),
        (else_try),
            (check_quest_active, "qst_pirates"),
            (eq, "$g_encountered_party_template", "pt_barbarus_fleet"),
            (jump_to_menu, "mnu_barbarus_defeated"),
            (assign, ":break", 1),
        (else_try),
            (party_stack_get_troop_id, ":party_leader", "$g_encountered_party", 0),
            (eq, ":party_leader", "trp_albus"),
            (check_quest_active, "qst_slave_revolt"),
            (neg|check_quest_succeeded, "qst_slave_revolt"),
            (eq, "$g_encountered_party_template", "pt_slave_revolt"),
            ##hierher
            (assign, "$talk_context", tc_hero_defeated),
            (call_script, "script_setup_troop_meeting", "trp_albus", -1, -1),
            (assign, ":break", 1),
        (else_try),
            (eq, "$capture_screen_shown", 0),
            (assign, "$capture_screen_shown", 1),

            ## main story: not main battle
            (assign, ":block", 0),
            (try_begin),
                (check_quest_active, "qst_blank_quest_19"),
                (quest_slot_eq,"qst_blank_quest_19", slot_quest_object_state, 5),
                (assign, ":block", 1),
            (try_end),
            (eq, ":block", 0),

            (party_clear, "p_temp_party"),
            (assign, "$g_move_heroes", 0),
            #(call_script, "script_party_prisoners_add_party_companions", "p_temp_party", "p_collective_enemy"),

            #p_total_enemy_casualties deki yarali askerler p_temp_party'e prisoner olarak eklenecek.
            (call_script, "script_party_add_wounded_members_as_prisoners", "p_temp_party", "p_total_enemy_casualties"),

            (call_script, "script_party_prisoners_add_party_prisoners", "p_temp_party", "p_collective_enemy"),
            (try_begin),
                (call_script, "script_party_calculate_strength", "p_collective_friends_backup",0),
                (assign,":total_initial_strength", reg(0)),
                (gt, ":total_initial_strength", 0),
                #(gt, "$g_ally_party", 0),
                (call_script, "script_party_calculate_strength", "p_main_party_backup",0),
                (assign,":player_party_initial_strength", reg(0)),
                # move ally_party_initial_strength/(player_party_initial_strength + ally_party_initial_strength) prisoners to ally party.
                # First we collect the share of prisoners of the ally party and distribute those among the allies.
                (store_sub, ":ally_party_initial_strength", ":total_initial_strength", ":player_party_initial_strength"),

                #(call_script, "script_party_calculate_strength", "p_ally_party_backup"),
                #(assign,":ally_party_initial_strength", reg(0)),
                #(store_add, ":total_initial_strength", ":player_party_initial_strength", ":ally_party_initial_strength"),
                (store_mul, ":ally_share", ":ally_party_initial_strength", 1000),
                (val_div, ":ally_share", ":total_initial_strength"),
                (assign, "$pin_number", ":ally_share"), #we send this as a parameter to the script.
                (party_clear, "p_temp_party_2"),
                (call_script, "script_move_members_with_ratio", "p_temp_party", "p_temp_party_2"),

                #TODO: This doesn't handle prisoners if our allies joined battle after us.
                (try_begin),
                    (gt, "$g_ally_party", 0),
                    (distribute_party_among_party_group, "p_temp_party_2", "$g_ally_party"),
                (try_end),
                #next if there's anything left, we'll open up the party exchange screen and offer them to the player.
            (try_end),
            (party_get_num_companions, ":num_rescued_prisoners", "p_temp_party"),
            (party_get_num_prisoners,  ":num_captured_enemies", "p_temp_party"),

            (store_add, ":total_capture_size", ":num_rescued_prisoners", ":num_captured_enemies"),

            (eq, "$enlisted_party", -1),#freelancer
            (gt, ":total_capture_size", 0),
            (change_screen_exchange_with_party, "p_temp_party"),
        (else_try),
            (eq, "$loot_screen_shown", 0),
            (assign, "$loot_screen_shown", 1),

            ## main story: not main battle
            (assign, ":block", 0),
            (try_begin),
                (check_quest_active, "qst_blank_quest_19"),
                (quest_slot_eq,"qst_blank_quest_19", slot_quest_object_state, 5),
                (assign, ":block", 1),
            (try_end),
            (eq, ":block", 0),

            (troop_clear_inventory, "trp_temp_troop"),
            (call_script, "script_party_calculate_loot", "p_total_enemy_casualties"), #p_encountered_party_backup changed to total_enemy_casualties
            (gt, reg0, 0),
            (troop_sort_inventory, "trp_temp_troop"),
            (eq, "$enlisted_party", -1),#freelancer
            ##diplomacy start+
            #Here: we jump to rubik's autoloot from CC if applicable instead of using the standard loot screen
            (try_begin),
                (call_script, "script_cf_dplmc_player_party_meets_autoloot_conditions"),###1
                (assign, "$dplmc_return_menu", "mnu_total_victory"),
                (assign, "$lord_selected", "trp_player"),
                (jump_to_menu, "mnu_dplmc_manage_loot_pool"),
            (else_try),
              #Old behavior:
                (change_screen_loot, "trp_temp_troop"),
            (try_end),
            ##diplomacy end+
        (else_try),
            #finished all
            (try_begin),
                (le, "$g_ally_party", 0),
                (end_current_battle),
            (try_end),
            (call_script, "script_party_give_xp_and_gold", "p_total_enemy_casualties"), #p_encountered_party_backup changed to total_enemy_casualties
            (try_begin),
                (eq, "$g_enemy_party", 0),
                (display_message,"str_error_string"),
            (try_end),
            (try_begin),
                (party_is_active, "$g_ally_party"),
                (call_script, "script_battle_political_consequences", "$g_enemy_party", "$g_ally_party"),
            (try_end),
            (call_script, "script_battle_political_consequences", "$g_enemy_party", "p_main_party"),

            (call_script, "script_event_player_defeated_enemy_party", "$g_enemy_party"),
            (call_script, "script_clear_party_group", "$g_enemy_party"),
            (try_begin),
                (eq, "$g_next_menu", -1),
                #NPC companion changes begin
                (call_script, "script_post_battle_personality_clash_check"),
                #NPC companion changes end
                #Post 0907 changes begin
                (party_stack_get_troop_id, ":enemy_leader", "p_encountered_party_backup",0),
                (try_begin),
                    (is_between, ":enemy_leader", active_npcs_begin, active_npcs_end),
                    (neg|is_between, "$g_encountered_party", centers_begin, centers_end),
                    (store_troop_faction, ":enemy_leader_faction", ":enemy_leader"),
                    (try_begin),
                        (eq, "$g_ally_party", 0),
                        (call_script, "script_add_log_entry", logent_lord_defeated_by_player, "trp_player",  -1, ":enemy_leader", ":enemy_leader_faction"),
                        (try_begin),
                            (eq, "$cheat_mode", 1),
                            (display_message, "@{!}Victory comment. Player was alone"),
                        (try_end),
                    (else_try),
                        (ge, "$g_strength_contribution_of_player", 40),
                        (call_script, "script_add_log_entry", logent_lord_defeated_by_player, "trp_player",  -1, ":enemy_leader", ":enemy_leader_faction"),
                        (try_begin),
                            (eq, "$cheat_mode", 1),
                            (display_message, "@{!}Ordinary victory comment. The player provided at least 40 percent forces."),
                        (try_end),
                    (else_try),
                        (gt, "$g_starting_strength_enemy_party", 1000),
                        (call_script, "script_get_closest_center", "p_main_party"),
                        (assign, ":battle_of_where", reg0),
                        (call_script, "script_add_log_entry", logent_player_participated_in_major_battle, "trp_player",  ":battle_of_where", -1, ":enemy_leader_faction"),
                        (try_begin),
                            (eq, "$cheat_mode", 1),
                            (display_message, "@{!}Player participation comment. The enemy had at least 1k starting strength."),
                        (try_end),
                    (else_try),
                        (eq, "$cheat_mode", 1),
                        (display_message, "@{!}No victory comment. The battle was small, and the player provided less than 40 percent of allied strength"),
                    (try_end),
                (try_end),
                #Post 0907 changes end
                (val_add, "$g_total_victories", 1),
                (leave_encounter),
                (change_screen_return),
            (else_try),
                (eq, "$enlisted_party", -1),#freelancer
                (try_begin), #my kingdom
                  ##diplomacy begin
                    (eq, "$g_next_menu", "mnu_dplmc_town_riot_removed"),
                    (jump_to_menu, "$g_next_menu"),
                (else_try),
                    ##diplomacy end
                    #(change_screen_return),
                    (eq, "$g_next_menu", "mnu_castle_taken"),

                    (call_script, "script_add_log_entry", logent_castle_captured_by_player, "trp_player", "$g_encountered_party", -1, "$g_encountered_party_faction"),
                    (store_current_hours, ":hours"),
                    (faction_set_slot, "$players_kingdom", slot_faction_ai_last_decisive_event, ":hours"),

                    (try_begin), #player took a walled center while he is a vassal of npc kingdom.
                      ##diplomacy start+ Handle player is co-ruler of NPC faction
                        (assign, ":is_coruler", 0),
                        (is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
                        (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", "$players_kingdom"),
                        (ge, reg0, DPLMC_FACTION_STANDING_LEADER_SPOUSE),
                        (assign, ":is_coruler", 1),

                        (assign, "$g_center_taken_by_player_faction", "$g_encountered_party"),
                        (faction_get_slot, ":faction_leader", "fac_player_supporters_faction", slot_faction_leader),
                        (try_begin),
                            (eq, ":faction_leader", "trp_player"),
                            (assign, ":faction_leader", kingdom_ladies_end),
                            (try_for_range, ":troop_no", heroes_begin, ":faction_leader"),
                                (this_or_next|troop_slot_eq, slot_troop_spouse, "trp_player"),
                                (troop_slot_eq, "trp_player", slot_troop_spouse, ":troop_no"),
                                (neg|troop_slot_ge, ":faction_leader", slot_troop_prisoner_of_party, 0),#Not a prisoner
                                (neg|troop_slot_ge, ":faction_leader", slot_troop_occupation, slto_retirement),#Not retired, exiled, dead
                                (assign, ":faction_leader", ":troop_no"),#assign and break the loop
                            (try_end),
                        (try_end),
                        (is_between, ":faction_leader", heroes_begin, kingdom_ladies_end),#Not the player, and not a bogus value
                        (neg|troop_slot_ge, ":faction_leader", slot_troop_prisoner_of_party, 0),#Not a prisoner
                        (neg|troop_slot_ge, ":faction_leader", slot_troop_occupation, slto_retirement),#Not retired, exiled, dead
                        (assign, "$g_loot_decide", 1),#let player decide how to loot it
                        (change_screen_return),
                        (start_map_conversation, ":faction_leader", -1),
                    (else_try),
                        #player took a walled center while he is a vassal of npc kingdom.
                        (neq, ":is_coruler", 1),
                        ##diplomacy end+
                        (try_begin),#Nero influence for siege
                            (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
                            (call_script, "script_change_influence", "trp_player", 500),
                        (else_try),
                            (call_script, "script_change_influence", "trp_player", 250),
                        (try_end),
                        (is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
                        (assign, "$g_loot_decide", 0),#let player decide how to loot it
                        (jump_to_menu, "$g_next_menu"),
                    (else_try), #player took a walled center while he is a vassal of rebels.
                        (eq, "$players_kingdom", "fac_player_supporters_faction"),
                        (assign, "$g_center_taken_by_player_faction", "$g_encountered_party"),
                        (neg|faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
                        (faction_get_slot, ":faction_leader", "fac_player_supporters_faction", slot_faction_leader),
                        (change_screen_return),
                        (assign, "$g_loot_decide", 1),#let player decide how to loot it
                        # (start_map_conversation, ":faction_leader", -1), #SB : script call
                        (assign, "$talk_context", tc_give_center_to_fief),
                        (call_script, "script_start_court_conversation", ":faction_leader", "$current_town"),
                    (else_try), #player took a walled center for player's kingdom
                          ##diplomacy start+ Handle player is co-ruler of faction
                        (this_or_next|eq, ":is_coruler", 1),
                        ##diplomacy end+
                        (neg|is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
                        (assign, "$g_center_taken_by_player_faction", "$g_encountered_party"),
                        (assign, "$talk_context", tc_give_center_to_fief),
                        (change_screen_return),

                        (assign, ":best_troop", "trp_hired_blade"),
                        (try_begin),
                            (faction_get_slot, ":players_culture", "$players_kingdom", slot_faction_culture),
                            (is_between, ":players_culture", cultures_begin, cultures_end),
                            (faction_get_slot, reg0, ":players_culture", slot_faction_guard_troop),
                            (ge, reg0, soldiers_begin),
                            (assign, ":best_troop", reg0),
                        (else_try),
                            (troop_get_slot, ":players_culture", "trp_player", slot_faction_culture),
                            (is_between, ":players_culture", cultures_begin, cultures_end),
                            (faction_get_slot, reg0, ":players_culture", slot_faction_guard_troop),
                            (ge, reg0, soldiers_begin),
                            (assign, ":best_troop", reg0),
                        (try_end),
                        (try_begin),
                            (neq, ":best_troop", "trp_hired_blade"),
                            (store_character_level, ":maximum_troop_score", ":best_troop"),
                        (else_try),
                            (assign, ":maximum_troop_score", 0),
                        (try_end),
                        (party_get_num_companion_stacks, ":num_stacks", "p_main_party"),
                        (try_for_range, ":stack_no", 0, ":num_stacks"),
                            (party_stack_get_troop_id, ":stack_troop", "p_main_party", ":stack_no"),
                            (neq, ":stack_troop", "trp_player"),

                            (party_stack_get_size, ":stack_size", "p_main_party", ":stack_no"),
                            (party_stack_get_num_wounded, ":num_wounded", "p_main_party", ":stack_no"),
                            (troop_get_slot, ":num_routed", "p_main_party", slot_troop_player_routed_agents),

                            (assign, ":continue", 0),
                            (try_begin),
                                (neg|troop_is_hero, ":stack_troop"),
                                (store_add, ":agents_which_cannot_speak", ":num_wounded", ":num_routed"),
                                (gt, ":stack_size", ":agents_which_cannot_speak"),
                                (assign, ":continue", 1),
                            (else_try),
                                (troop_is_hero, ":stack_troop"),
                                (neg|troop_is_wounded, ":stack_troop"),
                                (assign, ":continue", 1),
                            (try_end),
                            (eq, ":continue", 1),
                            (try_begin),
                                (troop_is_hero, ":stack_troop"),
                                (troop_get_slot, ":troop_renown", ":stack_troop", slot_troop_renown),
                                (store_mul, ":troop_score", ":troop_renown", 100),
                                (val_add, ":troop_score", 1000),
                            (else_try),
                                (store_character_level, ":troop_level", ":stack_troop"),
                                (assign, ":troop_score", ":troop_level"),
                            (try_end),
                            (try_begin),
                                (gt, ":troop_score", ":maximum_troop_score"),
                                (assign, ":maximum_troop_score", ":troop_score"),
                                (assign, ":best_troop", ":stack_troop"),
                                (party_stack_get_troop_dna, ":best_troop_dna", "p_main_party", ":stack_no"),
                            (try_end),
                        (try_end),
                        (assign, "$g_loot_decide", 1),#let player decide how to loot it
                        (call_script, "script_start_court_conversation", ":best_troop", "$current_town", ":best_troop_dna"),
                        # (start_map_conversation, ":best_troop", ":best_troop_dna"),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),##freelancer event battle
  ],[
    ("continue",[],"Continue...",[]),
]),

("enemy_slipped_away",0,
  "{s17}",
  "none",
  [],
    [
      ("continue",[],"Continue...",[(jump_to_menu,"mnu_total_victory")]),
]),

("total_defeat",0,
  "{!}You shouldn't be reading this...",
  "none",[
    # lost main battle of main quest
    (try_begin),
        (check_quest_active, "qst_four_emperors"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 15),
        (this_or_next|quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_senator_2"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_statthalter_9"),
        (assign, "$talk_context", tc_hero_defeated),
        (quest_set_slot, "qst_four_emperors", slot_quest_current_state, -100),
        (try_begin),
            (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_senator_2"),
            (assign, ":enemy_goy", "trp_statthalter_9"),
        (else_try),
            (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_statthalter_9"),
            (assign, ":enemy_goy", "trp_senator_2"),
        (try_end),
        (call_script, "script_setup_troop_meeting", ":enemy_goy", -1, -1),
    (else_try), # normal defeat
        (check_quest_active, "qst_four_emperors"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 11),
        (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_legatus_11"),
        (assign, "$talk_context", tc_hero_defeated),
        (quest_set_slot, "qst_four_emperors", slot_quest_current_state, -100),
        (call_script, "script_setup_troop_meeting", "trp_senator_2", -1, -1),
    (else_try), # normal defeat
        (play_track, "track_captured", 1),
        # Free prisoners of player
        (party_get_num_prisoner_stacks, ":num_prisoner_stacks","p_main_party"),
        (try_for_range, ":stack_no", 0, ":num_prisoner_stacks"),
            (party_prisoner_stack_get_troop_id, ":stack_troop","p_main_party",":stack_no"),
            (troop_is_hero, ":stack_troop"),
            (call_script, "script_remove_troop_from_prison", ":stack_troop"),
        (try_end),
        #bandit quest
        (try_begin),
            (check_quest_active, "qst_elusive_bandits"),
            (neg|check_quest_succeeded, "qst_elusive_bandits"),
            (neg|check_quest_failed, "qst_elusive_bandits"),

            (quest_get_slot, ":quest_party", "qst_elusive_bandits", slot_quest_target_party),
            (party_is_active, ":quest_party"),
            (party_get_attached_to, ":quest_party_attached"),
            (this_or_next|eq, ":quest_party", "$g_enemy_party"),
            (eq, ":quest_party_attached", "$g_enemy_party"),
            (call_script, "script_fail_quest", "qst_elusive_bandits"),
        (try_end),
        #if player has lords attached to his party
        (try_begin),
            (party_get_num_attached_parties, ":num_attached_parties",  "p_main_party"),
            (ge, ":num_attached_parties", 1),
            (try_for_range_backwards, ":attached_party_rank", 0, ":num_attached_parties"),
                (party_get_attached_party_with_rank, ":attached_party", "p_main_party", ":attached_party_rank"),
                (party_detach, ":attached_party"),
                (party_relocate_near_party, ":attached_party", "p_main_party", 3),
                (party_set_slot,":attached_party",slot_party_time_service, -1),
                (str_store_party_name, s22, ":attached_party"),
                (display_message, "@After your defeat {s22} has left your force and runs for his life."),
            (try_end),
        (try_end),
        ##political consequences
        (try_begin),
            (party_is_active, "$g_ally_party"),
            (call_script, "script_battle_political_consequences", "$g_ally_party", "$g_enemy_party"),
        (try_end),
        (call_script, "script_battle_political_consequences", "p_main_party", "$g_enemy_party"),

        (call_script, "script_loot_player_items", "$g_enemy_party"),

        (assign, "$g_move_heroes", 0),
        (party_clear, "p_temp_party"),
        (call_script, "script_party_prisoners_add_party_prisoners", "p_temp_party", "p_main_party"),
        (call_script, "script_party_prisoners_add_party_companions", "p_temp_party", "p_main_party"),
        (distribute_party_among_party_group, "p_temp_party", "$g_enemy_party"),

        (assign, "$g_prison_heroes", 1),
        (call_script, "script_party_remove_all_companions", "p_main_party"),
        (assign, "$g_prison_heroes", 0),
        (assign, "$g_move_heroes", 1),
        (call_script, "script_party_remove_all_prisoners", "p_main_party"),

        (val_add, "$g_total_defeats", 1),

        (try_begin),
            (neq, "$g_player_surrenders", 1),
            (store_random_in_range, ":random_no", 0, 100),
            (ge, ":random_no", "$g_player_luck"),
            (jump_to_menu, "mnu_permanent_damage"),
        (else_try),
            (try_begin),
                (eq, "$g_next_menu", -1),
                (leave_encounter),
                (change_screen_return),
            (else_try),
                (jump_to_menu, "$g_next_menu"),
            (try_end),
        (try_end),
        (try_begin),
            (gt, "$g_ally_party", 0),
            (call_script, "script_party_wound_all_members", "$g_ally_party"),
        (try_end),
        # Troop commentary changes begin
        (party_get_num_companion_stacks, ":num_stacks", "p_encountered_party_backup"),
        (try_for_range, ":stack_no", 0, ":num_stacks"),
            (party_stack_get_troop_id,   ":stack_troop","p_encountered_party_backup",":stack_no"),
            (is_between, ":stack_troop", active_npcs_begin, active_npcs_end),
            (troop_slot_eq, ":stack_troop", slot_troop_occupation, slto_kingdom_hero),
            (store_troop_faction, ":victorious_faction", ":stack_troop"),
            (call_script, "script_add_log_entry", logent_player_defeated_by_lord, "trp_player",  -1, ":stack_troop", ":victorious_faction"),
        (try_end),
        #Troop commentary changes end
    (try_end),
  ],[
]),

("permanent_damage",mnf_disable_all_keys,
  "{s0}",
  "none",[
    (assign, ":end_cond", 1),
    (try_for_range, ":unused", 0, ":end_cond"),
      (store_random_in_range, ":random_attribute", 0, 4),
      (store_attribute_level, ":attr_level", "trp_player", ":random_attribute"),
      (try_begin),
        (gt, ":attr_level", 3),
        (try_begin),
          (eq, ":random_attribute", ca_strength),
          (str_store_string, s0, "@Some of your tendons have been damaged in the battle. You lose 1 strength."),
        (else_try),
          (eq, ":random_attribute", ca_agility),
          (str_store_string, s0, "@You took a nasty wound which will cause you to limp slightly even after it heals. You lose 1 agility."),
        (else_try),
          (eq, ":random_attribute", ca_charisma),
          (str_store_string, s0, "@After the battle you are aghast to find that one of the terrible blows you suffered has left a deep, disfiguring scar on your face, horrifying those around you. Your charisma is reduced by 1."),
        (else_try),
          (eq, ":random_attribute", ca_intelligence),
          (str_store_string, s0, "@You have trouble thinking straight after the battle, perhaps from a particularly hard hit to your head, and frequent headaches now plague your existence. Your intelligence is reduced by 1."),
        (try_end),
      (else_try),
        (lt, ":end_cond", 200),
        (val_add, ":end_cond", 1),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":end_cond", 200),
      (try_begin),
        (eq, "$g_next_menu", -1),
        (leave_encounter),
        (change_screen_return),
      (else_try),
        (jump_to_menu, "$g_next_menu"),
      (try_end),
    (else_try),
      (troop_raise_attribute, "trp_player", ":random_attribute", -1),
    (try_end),
  ],[
    ("s0",[
      (store_random_in_range, ":random_no", 0, 4),
      (try_begin),
        (eq, ":random_no", 0),
        (str_store_string, s0, "@Perhaps I'm getting unlucky..."),
      (else_try),
        (eq, ":random_no", 1),
        (str_store_string, s0, "@Retirement is starting to sound better and better."),
      (else_try),
        (eq, ":random_no", 2),
        (str_store_string, s0, "@No matter! I will persevere!"),
      (else_try),
        (eq, ":random_no", 3),
      ##diplomacy start+ Don't use troop_get_type for gender
      #(troop_get_type, ":is_female", "trp_player"),#<- replaced
        (try_begin),
          #(eq, ":is_female", 1),#<- replaced
          (eq, "$character_gender", tf_female),#<- added
          (str_store_string, s0, "@What did I do to deserve this?"),
        (else_try),
          (str_store_string, s0, "@I suppose it'll make for a good story, at least..."),
        (try_end),
      ##diplomacy end+
      (try_end),
    ],"{s0}",[
      (call_script, "script_change_troop_health", "trp_player", 25),
      (try_begin),
        (eq, "$g_next_menu", -1),
        (leave_encounter),
        (change_screen_return),
      (else_try),
        (jump_to_menu, "$g_next_menu"),
      (try_end),
    ]),
]),

("pre_join",0,
  "You come across a battle between {s2} and {s1}. You decide to...",
  "none",[
    (str_store_party_name, 1,"$g_encountered_party"),
    (str_store_party_name, 2,"$g_encountered_party_2"),
    (store_faction_of_party, ":attacker_faction", "$g_encountered_party_2"),
    (store_relation, ":attacker_relation", ":attacker_faction", "fac_player_supporters_faction"),
    (store_faction_of_party, ":defender_faction", "$g_encountered_party"),
    (store_relation, ":defender_relation", ":defender_faction", "fac_player_supporters_faction"),
    (assign, reg35, ":attacker_relation"),
    (assign, reg36, ":defender_relation"),
  ],[
    ##freelancer attack
    ("pre_join_help_attackers_freelancer",[
      (ge, "$enlisted_party", 1),
    ],"Follow your commander into battle.",[
      (store_faction_of_party, ":lord_faction", "$enlisted_party"),##use enlisted party faction instead of player faction to prevent issues
      (store_faction_of_party, ":attacker_faction", "$g_encountered_party_2"),
      (store_relation, ":attacker_relation", ":attacker_faction", ":lord_faction"),
      (store_faction_of_party, ":defender_faction", "$g_encountered_party"),
      (store_relation, ":defender_relation", ":defender_faction", ":lord_faction"),
      (try_begin),
        (ge, ":attacker_relation", 0),
        (lt, ":defender_relation", 0),
        (select_enemy,0),
        (assign,"$g_enemy_party","$g_encountered_party"),
        (assign,"$g_ally_party","$g_encountered_party_2"),
        (jump_to_menu,"mnu_join_battle"),
      (else_try),
        (ge, ":defender_relation", 0),
        (lt, ":attacker_relation", 0),
        (select_enemy,1),
        (assign,"$g_enemy_party","$g_encountered_party_2"),
        (assign,"$g_ally_party","$g_encountered_party"),
        (jump_to_menu,"mnu_join_battle"),
      (else_try),
        (select_enemy,1),
        (assign,"$g_enemy_party","$g_encountered_party_2"),
        (assign,"$g_ally_party","$g_encountered_party"),
        (jump_to_menu,"mnu_join_battle"),
      (try_end),
    ]),
    ("pre_join_help_attackers",[
      (store_faction_of_party, ":defender_faction", "$g_encountered_party"),
      (neq, ":defender_faction", "$players_kingdom"),
      (eq, "$enlisted_party", -1),
    ],"Move in to help the {s2} (relation: {reg35}).",[
      (select_enemy,0),
      (assign,"$g_enemy_party","$g_encountered_party"),
      (assign,"$g_ally_party","$g_encountered_party_2"),
      ## WINDYPLAINS+ ## - Join any side - relation changes
      (try_begin),
        (store_faction_of_party, ":faction_no", "$g_enemy_party"),
        (store_relation, ":relation", ":faction_no", "fac_player_supporters_faction"),
        (ge, ":relation", -10),
        (party_get_num_companion_stacks, ":stack_count", "$g_ally_party"),
        (try_for_range, ":stack_no", 0, ":stack_count"),
          (party_stack_get_troop_id, ":troop_no", "$g_ally_party", ":stack_no"),
          (troop_is_hero, ":troop_no"),
          (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
          (call_script,"script_change_player_relation_with_troop", ":troop_no", 1),
        (try_end),
        # Reduce relation with enemy lords.
        (party_get_num_companion_stacks, ":stack_count", "$g_enemy_party"),
        (try_for_range, ":stack_no", 0, ":stack_count"),
          (party_stack_get_troop_id, ":troop_no", "$g_enemy_party", ":stack_no"),
          (troop_is_hero, ":troop_no"),
          (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
          (call_script,"script_change_player_relation_with_troop", ":troop_no", -1),
        (try_end),
        # Improve relation with ally faction.
        (store_faction_of_party, ":faction_no", "$g_ally_party"),
        (call_script, "script_change_player_relation_with_faction", ":faction_no", 2),
        # Reduce relation with enemy faction.
        (store_faction_of_party, ":faction_no", "$g_enemy_party"),
        (call_script, "script_change_player_relation_with_faction", ":faction_no", -2),
      (try_end),
      ## WINDYPLAINS- ##
      (jump_to_menu,"mnu_join_battle")
    ]),
    ("pre_join_help_defenders",[
      (eq, "$enlisted_party", -1),
      (store_faction_of_party, ":attacker_faction", "$g_encountered_party_2"),
      (neq, ":attacker_faction", "$players_kingdom"),
    ],"Rush to the aid of the {s1} (relation: {reg36}).",[
      (select_enemy,1),
      (assign,"$g_enemy_party","$g_encountered_party_2"),
      (assign,"$g_ally_party","$g_encountered_party"),

      ## WINDYPLAINS+ ## - Join any side - relation changes
      (try_begin),
        (store_faction_of_party, ":faction_no", "$g_enemy_party"),
        (store_relation, ":relation", ":faction_no", "fac_player_supporters_faction"),
        (ge, ":relation", -10),
        (party_get_num_companion_stacks, ":stack_count", "$g_ally_party"),
        (try_for_range, ":stack_no", 0, ":stack_count"),
          (party_stack_get_troop_id, ":troop_no", "$g_ally_party", ":stack_no"),
          (troop_is_hero, ":troop_no"),
          (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
          (call_script,"script_change_player_relation_with_troop", ":troop_no", 1),
        (try_end),
        # Reduce relation with enemy lords.
        (party_get_num_companion_stacks, ":stack_count", "$g_enemy_party"),
        (try_for_range, ":stack_no", 0, ":stack_count"),
          (party_stack_get_troop_id, ":troop_no", "$g_enemy_party", ":stack_no"),
          (troop_is_hero, ":troop_no"),
          (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
          (call_script,"script_change_player_relation_with_troop", ":troop_no", -1),
        (try_end),
        # Improve relation with ally faction.
        (store_faction_of_party, ":faction_no", "$g_ally_party"),
        (call_script, "script_change_player_relation_with_faction", ":faction_no", 2),
        # Reduce relation with enemy faction.
        (store_faction_of_party, ":faction_no", "$g_enemy_party"),
        (call_script, "script_change_player_relation_with_faction", ":faction_no", -2),
      (try_end),
      ## WINDYPLAINS- ##
      (jump_to_menu,"mnu_join_battle"),
    ]),
    ("pre_join_leave",[
      (eq, "$enlisted_party", -1),
    ],"Don't get involved.",[
      (leave_encounter),
      (change_screen_return)
    ]),
]),

("join_battle",mnf_enable_hot_keys,
  "You are helping the {s51} against the {s50}. You have {reg10} troops fit for battle against the enemy's {reg11}.",
  "none",[
    (str_store_party_name, s50,"$g_enemy_party"),
    (str_store_party_name, s51,"$g_ally_party"),

    (try_begin),#let nearby parties join
      (eq, "$new_encounter", 1),
      (call_script, "script_let_nearby_parties_join_current_battle", 0, 0),
    (try_end),

    (try_begin),
      (party_slot_eq, "p_main_party", slot_party_on_water, 1),
      (party_get_current_terrain, ":terrain_type", "p_main_party"),
      (this_or_next|eq,":terrain_type",0),
      (this_or_next|eq,":terrain_type",7),
      (this_or_next|eq,":terrain_type",8),
      (eq,":terrain_type",6),
      (set_background_mesh, "mesh_pic_seabattle"),
    (try_end),

    (call_script, "script_encounter_calculate_fit"),

    (try_begin),
      (eq, "$new_encounter", 1),
      (assign, "$new_encounter", 0),
      (call_script, "script_encounter_init_variables"),
    (else_try), #second or more turn
      (eq, "$g_leave_encounter",1),
      (change_screen_return),
    (try_end),

    (try_begin),
        (ge, "$num_routed_enemies", 15),
    (try_end),

    (try_begin),
      (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
      (assign, ":num_enemy_regulars_remaining", reg0),
      (assign, ":enemy_finished",0),
      (try_begin),
        (eq, "$g_battle_result", 1),

        (this_or_next|le, ":num_enemy_regulars_remaining", 0), #battle won
        (le, ":num_enemy_regulars_remaining", "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

        (assign, ":enemy_finished",1),
      (else_try),
        (eq, "$g_engaged_enemy", 1),
        (le, "$g_enemy_fit_for_battle",0),
        (ge, "$g_friend_fit_for_battle",1),
        (assign, ":enemy_finished",1),
      (try_end),

      (this_or_next|eq, ":enemy_finished",1),
      (eq,"$g_enemy_surrenders",1),
      (assign, "$g_next_menu", -1),
      (jump_to_menu, "mnu_total_victory"),
    (else_try),
      (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
      (assign, ":num_ally_regulars_remaining", reg0),
      (assign, ":battle_lost", 0),
      (try_begin),
        (eq, "$g_battle_result", -1),

        #(eq, ":num_ally_regulars_remaining", 0), #battle lost
        (le, ":num_ally_regulars_remaining",  "$num_routed_allies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

        (assign, ":battle_lost",1),
      (try_end),

      (this_or_next|eq, ":battle_lost",1),
      (eq,"$g_player_surrenders",1),
      (leave_encounter),
      (change_screen_return),
    (try_end),
  ],[
    ("join_attack",[
      (neg|troop_is_wounded, "trp_player"),
      (try_begin),
          (check_quest_active, "qst_freelancing"),
          (assign, ":party_selected", "$enlisted_party"),
      (else_try),
          (assign, ":party_selected", "p_main_party"),
      (try_end),
      (party_slot_eq, ":party_selected", slot_party_on_water, 1),
      (party_get_current_terrain, ":terrain_type", ":party_selected"),
      (this_or_next|eq,":terrain_type",0),
      (this_or_next|eq,":terrain_type",7),
      (this_or_next|eq,":terrain_type",8),
      (eq,":terrain_type",6),
        ],   "Close in and board the enemy.",[
    (assign, "$g_battle_result", 0),
    (assign, "$g_engaged_enemy", 1),
    (call_script, "script_calculate_renown_value"),
    (call_script, "script_calculate_battle_advantage"),
    (set_battle_advantage, reg0),
    (set_party_battle_mode),
    (try_begin),
      (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
      (set_jump_mission,"mt_village_raid"),
      (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
      (jump_to_scene, ":scene_to_use"),
    (else_try),
      (eq, "$g_encounter_type", enctype_catched_during_village_raid),
      (set_jump_mission,"mt_village_raid"),
      (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
      (jump_to_scene, ":scene_to_use"),
    (else_try),
    #Wulf
      (set_jump_mission,"mt_ship_battle"),
      # (try_begin),
      # (store_faction_of_party, ":fac","$g_enemy_party"),
      # (faction_slot_eq, ":fac", slot_faction_culture, "fac_culture_7"),
      (jump_to_scene, "scn_sea_roman"),
      # (else_try),
      # (jump_to_scene, "scn_sea_barbarian"),
      # (try_end),
    (try_end),
    (assign, "$g_next_menu", "mnu_join_battle"),
    (jump_to_menu, "mnu_battle_debrief"),
    (change_screen_mission),
  ]),

    ("encounter_attack",[
      (party_get_current_terrain, ":terrain_type", "p_main_party"),
      (neq,":terrain_type",0),
      (neq,":terrain_type",7),
      (neq,":terrain_type",8),
      (neq,":terrain_type",6),
      (neg|troop_is_wounded, "trp_player"),
    ],"Charge the enemy.",[
      (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
      (assign, "$g_battle_result", 0),

      (assign, "$player_deploy_troops", 1),
      # (party_get_template_id, ":encountered_party_template", "$g_encountered_party"),

      (call_script, "script_calculate_renown_value"),
      ##diplomacy start+
      (try_begin),
        #Call this to properly set cached values for strength
        (eq, "$g_dplmc_terrain_advantage", DPLMC_TERRAIN_ADVANTAGE_ENABLE),
        (assign, ":terrain_code", dplmc_terrain_code_none),#defined in header_terrain_types.py
        (try_begin),
          (this_or_next|eq, "$g_encounter_type", enctype_fighting_against_village_raid),
            (eq, "$g_encounter_type", enctype_catched_during_village_raid),
          (assign, ":terrain_code", dplmc_terrain_code_village),#defined in header_terrain_types.py
        (else_try),
          (encountered_party_is_attacker),
          (call_script, "script_dplmc_get_terrain_code_for_battle", "$g_encountered_party", "p_main_party"),
          (assign, ":terrain_code", reg0),
        (else_try),
          (call_script, "script_dplmc_get_terrain_code_for_battle", "p_main_party", "$g_encountered_party"),
          (assign, ":terrain_code", reg0),
        (try_end),
        (neq, ":terrain_code", dplmc_terrain_code_none),
        (call_script, "script_dplmc_party_calculate_strength_in_terrain", "p_main_party", ":terrain_code", 0, 1),
        (call_script, "script_dplmc_party_calculate_strength_in_terrain", "$g_encountered_party", ":terrain_code", 0, 1),
      (try_end),
      ##diplomacy end+
      (call_script, "script_calculate_battle_advantage"),
      (set_battle_advantage, reg0),
      (set_party_battle_mode),
      # (party_get_current_terrain, ":terrain_type", "p_main_party"),
      (try_begin),
        (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
        (set_jump_mission,"mt_village_raid"),
        (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
        (jump_to_scene, ":scene_to_use"),
      (else_try),
        (eq, "$g_encounter_type", enctype_catched_during_village_raid),
        (set_jump_mission,"mt_village_raid"),
        (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
        (jump_to_scene, ":scene_to_use"),
      # (else_try),
        # (this_or_next|eq, ":terrain_type", rt_desert),
        # (eq, ":terrain_type", rt_desert_forest),
        # (eq, ":encountered_party_template", "pt_kingdom_caravan_party"),
        # (assign, ":scene_to_use", "scn_caravan_ambush_desert"),
        # (jump_to_scene, ":scene_to_use"),
        # (set_jump_mission,"mt_lead_charge"),
      # (else_try),
        # (this_or_next|eq, ":terrain_type", rt_snow),
        # (eq, ":terrain_type", rt_snow_forest),
        # (eq, ":encountered_party_template", "pt_kingdom_caravan_party"),
        # (assign, ":scene_to_use", "scn_caravan_ambush_med"),
        # (jump_to_scene, ":scene_to_use"),
        # (set_jump_mission,"mt_lead_charge"),
      # (else_try),
        # (eq, ":encountered_party_template", "pt_kingdom_caravan_party"),
        # (assign, ":scene_to_use", "scn_caravan_ambush"),
        # (jump_to_scene, ":scene_to_use"),
        # (set_jump_mission,"mt_lead_charge"),
      (else_try),
        # (call_script, "script_encounter_calculate_fit"),
        # (try_begin),
          # (this_or_next|ge, reg10, 100),
          # (ge, reg11, 100),
          # (set_jump_mission,"mt_lead_charge_large"),
          # (call_script, "script_setup_random_scene"),
        # (else_try),
          (set_jump_mission,"mt_lead_charge"),
          (call_script, "script_setup_random_scene"),
        # (try_end),
      (try_end),
      (assign, "$g_next_menu", "mnu_join_battle"),
      (jump_to_menu, "mnu_battle_debrief"),
      (change_screen_mission),
    ]),

    ("join_order_attack",[
      (eq, "$enlisted_party", -1),
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (ge, reg0, 3),
    ],"Order your troops to attack with your allies while you stay back.",[
      (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
      (jump_to_menu,"mnu_join_order_attack"),
    ]),

    ("join_skipp_freelancer",[
      (gt, "$enlisted_party", 0),
    ],"Stay back and let the others fight.",[
      (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
      (jump_to_menu,"mnu_join_order_attack_freelancer"),
    ]),

    ("join_leave",[
      (eq, "$enlisted_party",-1),
    ],"Leave.",[
      (try_begin),
          (neg|troop_is_wounded, "trp_player"),
          (call_script, "script_objectionable_action", tmt_aristocratic, "str_flee_battle"),
          (party_stack_get_troop_id, ":enemy_leader","$g_enemy_party",0),
          (is_between, ":enemy_leader", active_npcs_begin, active_npcs_end),
          (call_script, "script_add_log_entry", logent_player_retreated_from_lord, "trp_player",  -1, ":enemy_leader", -1),
      (try_end),
      (leave_encounter),
      (change_screen_return),
    ]),
    ("encounter_leave",[
      (neq, "$player_ambushed",1),
      (gt, "$enlisted_party",-1),
      (call_script, "script_party_count_fit_for_battle", "$g_enemy_party"),
      (gt, reg0, 0),
    ],"Leave. [Try to end current battle.]",[
      (leave_encounter),
      (change_screen_return),
      (party_leave_cur_battle, "$enlisted_party"),
      (party_relocate_near_party, "$enlisted_party", "$g_enemy_party", 3),
    ]),
    ("encounter_leave",[
      (neq, "$player_ambushed",1),
      (gt, "$enlisted_party",-1),
      (call_script, "script_party_count_fit_for_battle", "$g_enemy_party"),
      (le, reg0, 0),
    ],"Leave.",[
      (leave_encounter),
      (change_screen_return),
    ]),
]),

  (
    "join_order_attack",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
      (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
      (assign, ":player_party_strength", reg0),
      (val_div, ":player_party_strength", 5),
      (call_script, "script_party_calculate_strength", "p_collective_friends", 0),
      (assign, ":friend_party_strength", reg0),
      (val_div, ":friend_party_strength", 5),

      (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
      (assign, ":enemy_party_strength", reg0),
      (val_div, ":enemy_party_strength", 5),

      (try_begin),
        (eq, ":friend_party_strength", 0),
        (store_div, ":enemy_party_strength_for_p", ":enemy_party_strength", 2),
      (else_try),
        (assign, ":enemy_party_strength_for_p", ":enemy_party_strength"),
        (val_mul, ":enemy_party_strength_for_p", ":player_party_strength"),
        (val_div, ":enemy_party_strength_for_p", ":friend_party_strength"),
      (try_end),

      (val_sub, ":enemy_party_strength", ":enemy_party_strength_for_p"),
      (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength_for_p", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),

      (inflict_casualties_to_party_group, "$g_enemy_party", ":friend_party_strength", "p_temp_casualties"),

      #ozan begin
      (party_get_num_companion_stacks, ":num_stacks", "p_temp_casualties"),
      (try_for_range, ":stack_no", 0, ":num_stacks"),
        (party_stack_get_troop_id, ":stack_troop", "p_temp_casualties", ":stack_no"),
        (try_begin),
          (party_stack_get_size, ":stack_size", "p_temp_casualties", ":stack_no"),
          (gt, ":stack_size", 0),
          (party_add_members, "p_total_enemy_casualties", ":stack_troop", ":stack_size"), #addition_to_p_total_enemy_casualties
          (party_stack_get_num_wounded, ":stack_wounded_size", "p_temp_casualties", ":stack_no"),
          (gt, ":stack_wounded_size", 0),
          (party_wound_members, "p_total_enemy_casualties", ":stack_troop", ":stack_wounded_size"),
        (try_end),
      (try_end),
      #ozan end

      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s10, s0),

      (call_script, "script_collect_friendly_parties"),
      #(party_collect_attachments_to_party, "$g_ally_party", "p_collective_ally"),

      (inflict_casualties_to_party_group, "$g_ally_party", ":enemy_party_strength", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),

       #(assign, "$cant_leave_encounter", 0),
       (assign, "$no_soldiers_left", 0),
       (try_begin),
         (call_script, "script_party_count_members_with_full_health","p_main_party"),
         (assign, ":num_our_regulars_remaining", reg0),

         #(le, ":num_our_regulars_remaining", 0),
         (le, ":num_our_regulars_remaining", "$num_routed_us"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

         (assign, "$no_soldiers_left", 1),
         (str_store_string, s4, "str_join_order_attack_failure"),
       (else_try),
         (call_script, "script_party_count_members_with_full_health","p_collective_enemy"),
         (assign, ":num_enemy_regulars_remaining", reg0),

         (this_or_next|le, ":num_enemy_regulars_remaining", 0),
         (le, ":num_enemy_regulars_remaining", "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

         (assign, "$g_battle_result", 1),
         (assign, "$no_soldiers_left", 1),
         (str_store_string, s4, "str_join_order_attack_success"),
       (else_try),
         (str_store_string, s4, "str_join_order_attack_continue"),
       (try_end),
    ],
    [
      ("continue",[],"Continue...",
      [
        (jump_to_menu,"mnu_join_battle"),
      ]),
    ]
  ),
  (
    "join_order_attack_freelancer",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
      (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
      (assign, ":player_party_strength", reg0),
      (val_div, ":player_party_strength", 5),
      (call_script, "script_party_calculate_strength", "p_collective_friends", 0),
      (assign, ":friend_party_strength", reg0),
      (val_div, ":friend_party_strength", 5),

      (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
      (assign, ":enemy_party_strength", reg0),
      (val_div, ":enemy_party_strength", 5),

      (try_begin),
        (eq, ":friend_party_strength", 0),
        (store_div, ":enemy_party_strength_for_p", ":enemy_party_strength", 2),
      (else_try),
        (assign, ":enemy_party_strength_for_p", ":enemy_party_strength"),
        (val_mul, ":enemy_party_strength_for_p", ":player_party_strength"),
        (val_div, ":enemy_party_strength_for_p", ":friend_party_strength"),
      (try_end),

      (val_sub, ":enemy_party_strength", ":enemy_party_strength_for_p"),
      (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength_for_p", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),

      (inflict_casualties_to_party_group, "$g_enemy_party", ":friend_party_strength", "p_temp_casualties"),

      #ozan begin
      (party_get_num_companion_stacks, ":num_stacks", "p_temp_casualties"),
      (try_for_range, ":stack_no", 0, ":num_stacks"),
        (party_stack_get_troop_id, ":stack_troop", "p_temp_casualties", ":stack_no"),
        (try_begin),
          (party_stack_get_size, ":stack_size", "p_temp_casualties", ":stack_no"),
          (gt, ":stack_size", 0),
          (party_add_members, "p_total_enemy_casualties", ":stack_troop", ":stack_size"), #addition_to_p_total_enemy_casualties
          (party_stack_get_num_wounded, ":stack_wounded_size", "p_temp_casualties", ":stack_no"),
          (gt, ":stack_wounded_size", 0),
          (party_wound_members, "p_total_enemy_casualties", ":stack_troop", ":stack_wounded_size"),
        (try_end),
      (try_end),
      #ozan end

      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s10, s0),

      (call_script, "script_collect_friendly_parties"),
      #(party_collect_attachments_to_party, "$g_ally_party", "p_collective_ally"),

      (inflict_casualties_to_party_group, "$g_ally_party", ":enemy_party_strength", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),

       #(assign, "$cant_leave_encounter", 0),
       (assign, "$no_soldiers_left", 0),
       (try_begin),
         (call_script, "script_party_count_members_with_full_health","$enlisted_party"),
         (assign, ":num_our_regulars_remaining", reg0),

         #(le, ":num_our_regulars_remaining", 0),
         (le, ":num_our_regulars_remaining", "$num_routed_us"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

         (assign, "$no_soldiers_left", 1),
         (str_store_string, s4, "str_join_order_attack_failure"),
       (else_try),
         (call_script, "script_party_count_members_with_full_health","p_collective_enemy"),
         (assign, ":num_enemy_regulars_remaining", reg0),

         (this_or_next|le, ":num_enemy_regulars_remaining", 0),
         (le, ":num_enemy_regulars_remaining", "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

         (assign, "$g_battle_result", 1),
         (assign, "$no_soldiers_left", 1),
         (str_store_string, s4, "str_join_order_attack_success"),
       (else_try),
         (str_store_string, s4, "str_join_order_attack_continue"),
       (try_end),
    ],
    [
      ("continue",[],"Continue...",
      [
        (jump_to_menu,"mnu_join_battle"),
      ]),
    ]
  ),

  (
    "test_scene",0,
    "You enter the test scene.",
    "none",
    [],
    [
      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
    ]
  ),
  (
    "battlefields",0,
    "{!}Select a field...",
    "none",
    [],
    [
      ("enter_f1",[],"{!}Field 1",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_field_1"],[change_screen_mission]]),
      ("enter_f2",[],"{!}Field 2",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_field_2"],[change_screen_mission]]),
      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
    ]
  ),

(#SB : pic hotkeys
  "join_siege_outside",mnf_scale_picture|mnf_enable_hot_keys,
  "{s1} has come under siege by {s2}.",
  "none",[
    (str_store_party_name, s1, "$g_encountered_party"),
    (str_store_party_name, s2, "$g_encountered_party_2"),
    (set_background_mesh, "mesh_pic_siege_sighted"),
  ],[
    ("approach_besiegers",[
      (store_faction_of_party, ":faction_no", "$g_encountered_party_2"),
      (store_relation, ":relation", ":faction_no", "fac_player_supporters_faction"),
      (ge, ":relation", 0),
      (store_faction_of_party, ":faction_no", "$g_encountered_party"),
      (store_relation, ":relation", ":faction_no", "fac_player_supporters_faction"),
      (lt, ":relation", 0),
    ],"Approach the siege camp.",[
      (jump_to_menu, "mnu_besiegers_camp_with_allies"),
    ]),
    ("pass_through_siege",[
      (store_faction_of_party, ":faction_no", "$g_encountered_party"),
      (store_relation, ":relation", ":faction_no", "fac_player_supporters_faction"),
      (ge, ":relation", 0),
    ],"Pass through the siege lines and enter {s1}.",[
      (jump_to_menu,"mnu_cut_siege_without_fight"),
    ]),
    ("leave",[],"Leave.",[
      (leave_encounter),
      (change_screen_return),
    ]),
]),

("cut_siege_without_fight",0,
  "The besiegers let you approach the gates without challenge.",
  "none",
  [],[
    ("continue",[],"Continue...",[
      (try_begin),
          (this_or_next|eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
          (eq, "$g_encountered_party_faction", "$players_kingdom"),
          (jump_to_menu, "mnu_town"),
      (else_try),
          (jump_to_menu, "mnu_castle_outside"),
      (try_end),
    ]),
]),

("besiegers_camp_with_allies",mnf_enable_hot_keys,
  "{s1} remains under siege. {s2} is the commander of the siege assault.^{s33}^^Your side has {reg10} troops ready against their {reg11}",
  "none",[
    (try_begin),##freelancer
      (eq, "$enlisted_party", -1),
      (str_store_string, s33, "@You and your men are welcomed."),
    (else_try),
      (str_store_string, s33, "@You have the order to asault the walls."),
    (try_end),

    (assign, "$g_enemy_party", "$g_encountered_party"),#need definiion in party join code
    (assign, "$g_ally_party", "$g_encountered_party_2"),

    (try_begin),#let nearby parties join
      (eq, "$new_encounter", 1),
      (call_script, "script_let_nearby_parties_join_current_battle", 0, 0),
    (try_end),

    (str_store_party_name, s1, "$g_encountered_party"),
    (party_stack_get_troop_id, ":siege_leader_id","$g_encountered_party_2",0),
    (str_store_troop_name, s2, ":siege_leader_id"),

    (select_enemy, 0),
    (call_script, "script_encounter_calculate_fit"),
    (try_begin),
      (eq, "$new_encounter", 1),
  ###diplomacy start+
  ##If terrain advantage is on, use siege settings
      #(assign, ":save_dplmc_terrain_advantage", "$g_dplmc_terrain_advantage"),
  ##(assign, "$g_dplmc_terrain_advantage", ":save_dplmc_terrain_advantage"),
  #(try_begin),
  #   (eq, "$g_dplmc_terrain_advantage", TERRAIN_ADVANTAGE_ENABLE),
  #   (assign, "$g_dplmc_terrain_advantage", TERRAIN_ADVANTAGE_FORCE_SIEGE),
  #(try_end),
  ###diplomacy end+
      (call_script, "script_encounter_init_variables"),
  ###diplomacy start+
  ##Revert terrain advantage setting
  #(assign, "$g_dplmc_terrain_advantage", ":save_dplmc_terrain_advantage"),
  ###diplomacy end+
    (try_end),

    (try_begin),#check to break the siege
        (eq, "$new_encounter", 0),
        (store_div, ":min_ally_str", "$g_friend_fit_for_battle", 5),
        (val_mul, ":min_ally_str", 2),
        (lt, ":min_ally_str", "$g_enemy_fit_for_battle"),

        (party_get_slot, ":siege_hardness", "$g_encountered_party", slot_center_siege_hardness),
        (val_add, ":siege_hardness", 100),
        (party_set_slot, "$g_encountered_party", slot_center_siege_hardness, ":siege_hardness"),
        (party_set_slot, "$g_enemy_party", slot_party_retreat_flag, 1),

        (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
            (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
            #(troop_slot_eq, ":troop_no", slot_troop_is_prisoner, 0),
            (neg|troop_slot_ge, ":troop_no", slot_troop_prisoner_of_party, 0),
            (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
            (gt, ":party_no", 0),
            (party_slot_eq, ":party_no", slot_party_ai_state, spai_besieging_center),
            (party_slot_eq, ":party_no", slot_party_ai_object, "$g_encountered_party"),
            (party_slot_eq, ":party_no", slot_party_ai_substate, 1),
            (call_script, "script_party_set_ai_state", ":party_no", spai_undefined, -1),
            (call_script, "script_party_set_ai_state", ":party_no", spai_besieging_center, "$g_encountered_party"),
        (try_end),
        (display_message, "@The attackers retreat. The assault is over, but the siege continues."),
        (assign, "$g_battle_simulation_cancel_for_party", "$g_encountered_party"),
        (leave_encounter),
        (change_screen_return),
        (assign, "$g_battle_simulation_auto_enter_town_after_battle", "$g_encountered_party"),
    (try_end),

    (try_begin),
      (eq, "$new_encounter", 1),
      (assign, "$new_encounter", 0),
    (try_end),

    (try_begin),
      (eq, "$g_leave_encounter",1),
      (change_screen_return),
    (else_try),
      (assign, ":enemy_finished", 0),
      (try_begin),
        (eq, "$g_battle_result", 1),
        (assign, ":enemy_finished", 1),
      (else_try),
        (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
        (ge, "$g_friend_fit_for_battle", 1),
        (assign, ":enemy_finished", 1),
      (try_end),
      (this_or_next|eq, ":enemy_finished", 1),
      (eq, "$g_enemy_surrenders", 1),
##          (assign, "$g_next_menu", -1),#"mnu_castle_taken_by_friends"),
##          (jump_to_menu, "mnu_total_victory"),
      (try_begin),#special battle event 1
        (troop_slot_eq, "trp_player", slot_player_battle_event, 0),
        (get_player_agent_kill_count, ":wounded", 1),
        (get_player_agent_kill_count, ":kill"),
        (val_add, ":kill", ":wounded"),
        (ge, ":kill", 5),
        (troop_set_slot, "trp_player", slot_player_battle_event, 1),
        (jump_to_menu, "mnu_matters_of_life"),
        (assign, "$temp4_1", "mnu_besiegers_camp_with_allies"),
      (else_try),#special battle event 2
        (troop_slot_eq, "trp_player", slot_player_battle_event, 1),
        (get_player_agent_kill_count, ":wounded", 1),
        (get_player_agent_kill_count, ":kill"),
        (val_add, ":kill", ":wounded"),
        (ge, ":kill", 50),
        (troop_set_slot, "trp_player", slot_player_battle_event, 2),
        (jump_to_menu, "mnu_matters_of_life"),
        (assign, "$temp4_1", "mnu_besiegers_camp_with_allies"),
      (else_try), #freelancer, special battle events
        (ge, "$enlisted_party", 1),
        (check_quest_active, "qst_freelancing"),
        (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_event_2, 0),
        (quest_set_slot, "qst_freelancing", slot_quest_freelancer_event_2, 1),
        (jump_to_menu, "mnu_freelancing_battle_event"),
        (assign, "$temp4_1", "mnu_besiegers_camp_with_allies"),
      (else_try),#freelancer battle
        #SB : TODO : add prisoner train of unclaimed prisoners and such, succeed quests by proxy
        (party_get_num_prisoner_stacks, ":num_prisoner_stacks", "$g_enemy_party"),
        (try_for_range, ":stack_no", 0, ":num_prisoner_stacks"),
          # (eq, ":break", 0),
          (party_prisoner_stack_get_troop_id, ":stack_troop", "p_collective_enemy", ":stack_no"),
          (troop_is_hero, ":stack_troop"),
          (try_begin),
            (check_quest_active, "qst_rescue_prisoner"),
            (quest_slot_eq, "qst_rescue_prisoner", slot_quest_target_troop, ":stack_troop"),
            (call_script, "script_succeed_quest", "qst_rescue_prisoner"),
          (else_try),
            (check_quest_active, "qst_deliver_message_to_prisoner_lord"),
            (quest_slot_eq, "qst_deliver_message_to_prisoner_lord", slot_quest_target_troop, ":stack_troop"),
            (call_script, "script_end_quest", "qst_deliver_message_to_prisoner_lord"),
          (try_end),
        (try_end),
        (try_begin), #check if player gets a share of party prisoners, freed prisoners doesn't count
          (store_faction_of_party, ":faction_no", "$g_ally_party"),
          (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", ":faction_no"),
          (ge, reg0, DPLMC_FACTION_STANDING_MEMBER),
          #check relation with siege leader as well
          (party_stack_get_troop_id, ":leader","$g_encountered_party_2",0),
          (call_script, "script_troop_get_player_relation", ":leader"),
          (this_or_next|troop_slot_eq, ":leader", slot_lord_reputation_type, lrep_martial),
          (ge, reg0, -10),
          (eq, "$capture_screen_shown", 0),
          (assign, "$capture_screen_shown", 1),

          (party_clear, "p_temp_party"),
          (assign, "$g_move_heroes", 0),
          (eq, "$enlisted_party", -1),#freelancer
          (change_screen_exchange_with_party, "p_temp_party"),
        (else_try), #check if player has seen the loot
          (eq, "$loot_screen_shown", 0),
          (assign, "$loot_screen_shown", 1),
          (troop_clear_inventory, "trp_temp_troop"),
          (call_script, "script_party_calculate_loot", "p_total_enemy_casualties"), #p_encountered_party_backup changed to total_enemy_casualties
          (gt, reg0, 0),
          (troop_sort_inventory, "trp_temp_troop"),
          (eq, "$enlisted_party", -1),#freelancer
          (try_begin),
            (call_script, "script_cf_dplmc_player_party_meets_autoloot_conditions"),###2
            (assign, "$dplmc_return_menu", "mnu_besiegers_camp_with_allies"),
            (assign, "$lord_selected", "trp_player"),
            (jump_to_menu, "mnu_dplmc_manage_loot_pool"),
          (else_try),
            #Old behavior:
            (change_screen_loot, "trp_temp_troop"),
          (try_end),
        (else_try), #SB : increment globals, add exp
          (call_script, "script_party_give_xp_and_gold", "p_total_enemy_casualties"),
          (val_add, "$g_total_victories", 1),
          (call_script, "script_party_wound_all_members", "$g_enemy_party"),
          (leave_encounter),
          (change_screen_return),
        (try_end),
      (try_end),###freelancer
    (else_try),
      (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
      (assign, ":ally_num_soldiers", reg0),
      (eq, "$g_battle_result", -1),
      #(eq, ":ally_num_soldiers", 0), #battle lost (TODO : also compare this with routed allies too like in other parts)
      (le, ":ally_num_soldiers",  "$num_routed_allies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
      (leave_encounter),
      (change_screen_return),
    (try_end),
  ],[
    ("talk_to_siege_commander",[
    ]," Request a meeting with the commander.",[
      (call_script, "script_get_meeting_scene"), (assign, ":meeting_scene", reg0),
      (modify_visitors_at_site,":meeting_scene"),(reset_visitors),
      (set_visitor,0,"trp_player"),
      (party_stack_get_troop_id, ":siege_leader_id","$g_encountered_party_2",0),
      (party_stack_get_troop_dna,":siege_leader_dna","$g_encountered_party_2",0),
      (set_visitor,17,":siege_leader_id",":siege_leader_dna"),
      (set_jump_mission,"mt_conversation_encounter"),
      (jump_to_scene,":meeting_scene"),
      (assign, "$talk_context", tc_siege_commander),
      (change_screen_map_conversation, ":siege_leader_id"),
    ]),
    ("join_siege_with_allies",[
      (neg|troop_is_wounded, "trp_player"),
    ], "Join the next assault.",[
      (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
      (try_begin),
        (check_quest_active, "qst_join_siege_with_army"),
        (quest_slot_eq, "qst_join_siege_with_army", slot_quest_target_center, "$g_encountered_party"),
        (add_xp_as_reward, 500),
        (call_script, "script_end_quest", "qst_join_siege_with_army"),
        #Reactivating follow army quest
        (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
        (str_store_troop_name_link, s9, ":faction_marshall"),
        (setup_quest_text, "qst_follow_army"),
        ##diplomacy start+ fix pronoun
        (call_script, "script_dplmc_store_troop_is_female", ":faction_marshall"),
        (str_store_string, s2, "@{s9} wants you to follow {reg0?her:his} army until further notice."),
        ##diplomacy end+
        (call_script, "script_start_quest", "qst_follow_army", ":faction_marshall"),
        (assign, "$g_player_follow_army_warnings", 0),
      (try_end),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
      (else_try),
        (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
      (try_end),
      (call_script, "script_calculate_battle_advantage"),
      (val_mul, reg0, 2),
      (val_div, reg0, 3), #scale down the advantage a bit in sieges.
      (set_battle_advantage, reg0),
      (set_party_battle_mode),
      (assign, "$temp4", 0),
      (set_jump_mission,"mt_castle_attack_walls_ladder"),
      (jump_to_scene,":battle_scene"),
      (assign, "$g_siege_final_menu", "mnu_besiegers_camp_with_allies"),
      (assign, "$g_siege_battle_state", 1),
      (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
      (jump_to_menu, "mnu_battle_debrief"),
      (change_screen_mission),
    ]),
    ("join_siege_stay_back",[
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (ge, reg0, 3),
    ],"Order your soldiers to join the next assault without you.",[
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (try_begin),
          (check_quest_active, "qst_join_siege_with_army"),
          (quest_slot_eq, "qst_join_siege_with_army", slot_quest_target_center, "$g_encountered_party"),
          (add_xp_as_reward, 100),
          (call_script, "script_end_quest", "qst_join_siege_with_army"),
          #Reactivating follow army quest
          (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
          (str_store_troop_name_link, s9, ":faction_marshall"),
          (setup_quest_text, "qst_follow_army"),
          ##diplomacy start+ fix pronoun
          (call_script, "script_dplmc_store_troop_is_female", ":faction_marshall"),
          (str_store_string, s2, "@{s9} wants you to follow {reg0?her:his} army until further notice."),
          ##diplomacy end+
          (call_script, "script_start_quest", "qst_follow_army", ":faction_marshall"),
          (assign, "$g_player_follow_army_warnings", 0),
        (try_end),
        (assign, "$g_siege_final_menu", "mnu_besiegers_camp_with_allies"),
        (jump_to_menu,"mnu_castle_attack_walls_with_allies_simulate"),
    ]),

    ("join_siege_skipp_freelancer", [
      (gt, "$enlisted_party", 0),#is freelancing
    ],"Stay back and let the others fight.",[
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (try_begin),
          (check_quest_active, "qst_join_siege_with_army"),
          (quest_slot_eq, "qst_join_siege_with_army", slot_quest_target_center, "$g_encountered_party"),
          (add_xp_as_reward, 100),
          (call_script, "script_end_quest", "qst_join_siege_with_army"),
          #Reactivating follow army quest
          (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
          (str_store_troop_name_link, s9, ":faction_marshall"),
          (setup_quest_text, "qst_follow_army"),
          ##diplomacy start+ fix pronoun
          (call_script, "script_dplmc_store_troop_is_female", ":faction_marshall"),
          (str_store_string, s2, "@{s9} wants you to follow {reg0?her:his} army until further notice."),
          ##diplomacy end+
          (call_script, "script_start_quest", "qst_follow_army", ":faction_marshall"),
          (assign, "$g_player_follow_army_warnings", 0),
        (try_end),
        (jump_to_menu,"mnu_castle_attack_walls_with_allies_simulate_freelancer"),
    ]),
    ("commander",[
      (gt, "$enlisted_party", 0),#is freelancing
      (store_party_size, ":size", "$enlisted_party"),
      (ge, ":size", 1),
      (neg|troop_is_wounded, "trp_player"),
    ],"Talk with the Immune responsible for treating wounds.",[
      (assign, "$talk_context", 0),#fix a possible bug
      (call_script, "script_get_meeting_scene"),
      (assign, ":meeting_scene", reg0),
      (set_jump_mission,"mt_conversation_encounter"),
      (modify_visitors_at_site,":meeting_scene"),
      (reset_visitors),
      (set_visitor,17,"trp_player"),
      (mission_tpl_entry_set_override_flags, "mt_conversation_encounter",0, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_conversation_encounter", 0),
      (mission_tpl_entry_add_override_item, "mt_conversation_encounter", 0, "itm_legion_segmentata_1"),
      (set_visitor,0,"trp_healer_2"),
      (jump_to_scene,":meeting_scene"),
      #(assign, "$talk_context", tc_siege_commander),
      (change_screen_map_conversation, "trp_healer_2")
    ]),
    ("leave",[],"Leave.",[
      (leave_encounter),
      (change_screen_return),
    ]),
]),

("castle_outside",mnf_scale_picture,
  "You are outside {s2}.{s11} {s3} {s4}",
  "none",[
    (assign, "$g_enemy_party", "$g_encountered_party"),
    (assign, "$g_ally_party", -1),
    (str_store_party_name, s2,"$g_encountered_party"),
    (call_script, "script_encounter_calculate_fit"),
    (assign,"$all_doors_locked",1),
    (assign, "$current_town","$g_encountered_party"),

    (try_begin),
        (eq, "$new_encounter", 1),
        (assign, "$new_encounter", 0),
        (call_script, "script_let_nearby_parties_join_current_battle", 1, 0),
    ###diplomacy start+
    ##If terrain advantage is on, use siege settings for estimating strength
        #(assign, ":save_dplmc_terrain_advantage", "$g_dplmc_terrain_advantage"),
    #(try_begin),
    #   (eq, "$g_dplmc_terrain_advantage", TERRAIN_ADVANTAGE_ENABLE),
    #   (assign, "$g_dplmc_terrain_advantage", TERRAIN_ADVANTAGE_FORCE_SIEGE),
    #(try_end),
    ###diplomacy end+
        (call_script, "script_encounter_init_variables"),
    ###diplomacy start+
    ##Revert terrain advantage settings
    #(assign, "$g_dplmc_terrain_advantage", ":save_dplmc_terrain_advantage"),
    ###diplomacy end+
        (assign, "$entry_to_town_forbidden",0),

        (call_script, "script_dplmc_remove_disguise"),

        (assign, "$sneaked_into_town", disguise_none),
        (assign, "$town_entered", 0),
        #          (assign, "$waiting_for_arena_fight_result", 0),
        (assign, "$encountered_party_hostile", 0),
        (assign, "$encountered_party_friendly", 0),
        (try_begin),
            (gt, "$g_player_besiege_town", 0),
            (neq,"$g_player_besiege_town","$g_encountered_party"),
            (party_slot_eq, "$g_player_besiege_town", slot_center_is_besieged_by, "p_main_party"),
            (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
            (assign,"$g_player_besiege_town",-1),
        (try_end),
        (try_begin),
            (lt, "$g_encountered_party_relation", 0),
            (assign, "$encountered_party_hostile", 1),
            (assign,"$entry_to_town_forbidden",1),
        (try_end),

        ##diplomacy begin
        (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
            (assign, "$encountered_party_hostile", 1),
            (assign,"$entry_to_town_forbidden",1),
        (try_end),
        ##diplomacy end

        (assign,"$cant_sneak_into_town",0),
        (try_begin),
            (eq,"$current_town","$last_sneak_attempt_town"),
            (store_current_hours,reg(2)),
            (val_sub,reg(2),"$last_sneak_attempt_time"),
            (lt,reg(2),12),
            (assign,"$cant_sneak_into_town",1),
        (try_end),
    (else_try), #second or more turn
        (eq, "$g_leave_encounter",1),
        (change_screen_return),
    (try_end),

    (str_clear,s4),
    (try_begin),
        (eq,"$entry_to_town_forbidden",1),
        (try_begin),
            (eq,"$cant_sneak_into_town",1),
            (str_store_string,s4,"str_sneaking_to_town_impossible"),
        (else_try),
            (str_store_string,s4,"str_entrance_to_town_forbidden"),
        (try_end),
    (try_end),

    (party_get_slot, ":center_lord", "$current_town", slot_town_lord),
    (store_faction_of_party, ":center_faction", "$current_town"),
    (str_store_faction_name,s9,":center_faction"),
    (try_begin),
        (ge, ":center_lord", 0),
        (str_store_troop_name,s8,":center_lord"),
        (str_store_string,s7,"@{s8} of {s9}"),
    (try_end),
    ##diplomacy start+

    #SB : move coruler variable up here
    (assign, ":is_coruler", 0),
    (try_begin),
        (eq, "$g_encountered_party_faction", "$players_kingdom"),
        (is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
        (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", "$players_kingdom"),
        (ge, reg0, DPLMC_FACTION_STANDING_LEADER_SPOUSE),
        (assign, ":is_coruler", 1),
    (try_end),
    (assign, ":save_reg0", reg0),#save variables
    (assign, ":save_reg4", reg4),
    (assign, ":relation", 0),
    (assign, reg4, 0),
    (try_begin),#If there's a relation of some kind, write it to s11 (which we'll overwrite below)
        (lt, ":center_lord", 1),
    (else_try),
        #your relative
        (call_script, "script_troop_get_family_relation_to_troop", ":center_lord", "trp_player"),#outputs to s11, ":relation", and reg4
        (ge, ":relation", 1),#Fall through if this not a relative
    (else_try),
        #your current liege
        (eq, ":center_faction", "$players_kingdom"),
        (is_between, ":center_faction", kingdoms_begin, kingdoms_end),#include fac_player_supporters_faction for claimant quest
        (faction_slot_eq, ":center_faction", slot_faction_leader, ":center_lord"),
        (str_store_string, s11, "@liege"),
        (assign, ":relation", 1),
    (else_try),
        #your former liege if you renounced a kingdom
        (eq, ":center_faction", "$players_oath_renounced_against_kingdom"),
        (is_between, ":center_faction", npc_kingdoms_begin, npc_kingdoms_end),
        (faction_slot_eq, ":center_faction", slot_faction_leader, ":center_lord"),
        (str_store_string, s11, "@former liege"),
        (assign, ":relation", 1),
    (else_try),
        #stop here for lords you haven't met, or non-hero troops
        (this_or_next|neg|troop_is_hero, ":center_lord"),
        (troop_slot_eq, ":center_lord", slot_troop_met, 0),
    (else_try),
        #check for affiliates
        (call_script, "script_dplmc_is_affiliated_family_member", ":center_lord"),
        (ge, reg0, 1), #SB : substitute register
        (assign, ":relation", 1),
        (try_begin),
            (ge, "$g_encountered_party_relation", 0),#don't say "ally" when you might fight them, as that's confusing
            (str_store_string, s11, "str_dplmc_ally"),
        (else_try),
            (str_store_string, s11, "@affiliate"),
        (try_end),
    (else_try),
        #check for friends (former companions)
        (call_script, "script_troop_get_player_relation", ":center_lord"),
        (assign, ":relation", reg0),
        (is_between, ":center_lord", companions_begin, companions_end),
        (neg|troop_slot_eq, ":center_lord", slot_troop_playerparty_history, dplmc_pp_history_nonplayer_entry),
        (try_begin),
           (ge, "$g_encountered_party_relation", 0),#don't say "ally" when you might fight them, as that's confusing
           (ge, ":relation", 50),
           (str_store_string, s11, "str_dplmc_ally"),
        (else_try),
            (ge, "$g_encountered_party_relation", 0),
            (ge, ":relation", 20),
            (str_store_string, s11, "str_dplmc_friend"),
        (else_try),
            (str_store_string, s11, "@former companion"),
        (try_end),
        (assign, ":relation", 1),
    (else_try),
        #don't print "friend" if you might fight them
        (lt, "$g_encountered_party_relation", 0),
        (assign, ":relation", 0),
    (else_try),
        #check for friends
        # (val_div, ":relation", 50),#right now ":relation" holds the relation with the player
        (ge, ":relation", 50),
        (str_store_string, s11, "str_dplmc_friend"),
    (else_try),
        #check for marshall
        (eq, ":center_faction", "$players_kingdom"),
        (faction_slot_eq, ":center_faction", slot_faction_marshall, ":center_lord"),
        (str_store_string, s11, "@marshall"),
    (else_try), #SB : coruler check above
        # #check for vassal of player if nothing else to say
        # (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", ":center_faction"),
        # (val_add, ":relation", 1),
        # (val_sub, ":relation", DPLMC_FACTION_STANDING_LEADER_SPOUSE),
        (ge, ":is_coruler", 1),
        (str_store_string, s11, "@vassal"),
        (assign, ":relation", 1),
    (else_try),
        (assign, ":relation", 0),
    (try_end),
    ##diplomacy end+
    (try_begin), # same mnu_town
        (party_slot_eq,"$current_town",slot_party_type, spt_castle),
        (try_begin),
            (eq, ":center_lord", "trp_player"),
            (str_store_string,s11,"@ Your own banner flies over the gates."),
        ##diplomacy start+ If ":relation" > 0, a relation string was written to {s11} above
        (else_try),
            (ge, ":relation", 1),
            (str_store_string, s11, "@ You see the banner of your {s11} {s7} over the gates."),
        ##diplomacy end+
        (else_try),
            (ge, ":center_lord", 0),
            (str_store_string, s11,"@ You see the banner of {s7} over the gates."),
        (else_try),
            (is_between, ":center_faction", kingdoms_begin, kingdoms_end),
            (str_store_string, s11,"str__this_castle_is_temporarily_under_royal_control"),
        (else_try),
            (str_store_string, s11,"str__this_castle_does_not_seem_to_be_under_anyones_control"),
        (try_end),
    (else_try),
        (try_begin),
            (eq, ":center_lord", "trp_player"),
            (str_store_string, s11,"@ Your own banner flies over the town gates."),
        ##diplomacy start+ If ":relation" > 0, a relation string was written to {s11} above
        (else_try),
            (ge, ":relation", 1),
            (str_store_string, s11, "@ You see the banner of your {s11} {s7} over the town gates."),
        ##diplomacy end+
        (else_try),
            (ge, ":center_lord", 0),
            (str_store_string, s11,"@ You see the banner of {s7} over the town gates."),
        (else_try),
            (is_between, ":center_faction", kingdoms_begin, kingdoms_end),
            (str_store_string, s11,"str__this_town_is_temporarily_under_royal_control"),
        (else_try),
            (str_store_string, s11,"str__the_townspeople_seem_to_have_declared_their_independence"),
        (try_end),
    (try_end),

    #SB : get rid of register usage
    (party_get_num_companions, ":num_enemies", "p_collective_enemy"),
    (assign,"$castle_undefended",0),
    (str_clear, s3),
    (try_begin),
        (eq, ":num_enemies", 0),
        (assign,"$castle_undefended",1),
        #(party_set_faction,"$g_encountered_party","fac_neutral"),
        #(party_set_slot, "$g_encountered_party", slot_town_lord, stl_unassigned),
        (str_store_string, s3, "str_castle_is_abondened"),
    (else_try),
    ##diplomacy begin
        (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
        (str_store_string, s3, "str_dplmc_place_is_occupied_by_insurgents"),
    #SB : assign globals, doesn't make senes
    (else_try),
    ##diplomacy end
    ##diplomacy start+ Handle player is co-ruler of kingdom
        (this_or_next|eq, ":is_coruler", 1),
    ##diplomacy end+
        (eq,"$g_encountered_party_faction","fac_player_supporters_faction"),
        (str_store_string, s3, "str_place_is_occupied_by_player"),
    (else_try),
        (lt, "$g_encountered_party_relation", 0),
        (str_store_string, s3, "str_place_is_occupied_by_enemy"),
    (else_try),
#          (str_store_string, s3, "str_place_is_occupied_by_friendly"),
    (try_end),
    ##diplomacy start+
    (assign, reg0, ":save_reg0"),#revert variables
    (assign, reg4, ":save_reg4"),
    ##diplomacy end+

    (try_begin),
        (eq, "$g_leave_town_outside",1),
        (assign, "$g_leave_town_outside",0),
        (assign, "$g_permitted_to_center", 0),
        (change_screen_return),
    (else_try),
        (check_quest_active, "qst_escort_lady"),
        (quest_slot_eq, "qst_escort_lady", slot_quest_target_center, "$g_encountered_party"),
        (quest_get_slot, ":quest_object_troop", "qst_escort_lady", slot_quest_object_troop),
        # (call_script, "script_get_meeting_scene"), (assign, ":meeting_scene", reg0),
        # (modify_visitors_at_site,":meeting_scene"),
        # (reset_visitors),
        # (set_visitor,0, "trp_player"),
        # (set_visitor,17, ":quest_object_troop"),
        # (set_jump_mission, "mt_conversation_encounter"),
        # (jump_to_scene, ":meeting_scene"),
        (assign, "$talk_context", tc_entering_center_quest_talk),
        # (change_screen_map_conversation, ":quest_object_troop"),
        (call_script, "script_setup_troop_meeting", ":quest_object_troop", -1, -1),
    (else_try),
        (check_quest_active, "qst_kidnapped_girl"),
        (quest_slot_eq, "qst_kidnapped_girl", slot_quest_giver_center, "$g_encountered_party"),
        (quest_slot_eq, "qst_kidnapped_girl", slot_quest_current_state, 3),
        # (call_script, "script_get_meeting_scene"), (assign, ":meeting_scene", reg0),
        # (modify_visitors_at_site,":meeting_scene"),
        # (reset_visitors),
        # (set_visitor,0, "trp_player"),
        # (set_visitor,17, "trp_kidnapped_girl"),
        # (set_jump_mission, "mt_conversation_encounter"),
        # (jump_to_scene, ":meeting_scene"),
        (assign, "$talk_context", tc_entering_center_quest_talk),
        # (change_screen_map_conversation, "trp_kidnapped_girl"),
        (call_script, "script_setup_troop_meeting", "trp_kidnapped_girl", -1, -1),
    (else_try), #SB : automatically talk to caravans
        (check_quest_active, "qst_escort_merchant_caravan"),
        (quest_get_slot, ":quest_target_party", "qst_escort_merchant_caravan", slot_quest_target_party),
        (party_is_active, ":quest_target_party"),
        (quest_get_slot, ":quest_target_center", "qst_escort_merchant_caravan", slot_quest_target_center),
        (eq,"$current_town",":quest_target_center"),
        (quest_slot_eq, "qst_escort_merchant_caravan", slot_quest_current_state, 1),
        (store_distance_to_party_from_party, ":dist", ":quest_target_center",":quest_target_party"),
        (lt,":dist",4),
        # (start_encounter, ":quest_target_party"),
        (assign, "$talk_context", tc_party_encounter),
        (assign, "$g_encountered_party", ":quest_target_party"),
        (party_stack_get_troop_id, ":caravan_leader", ":quest_target_party", 0),
        (party_stack_get_troop_dna, ":caravan_leader_dna", ":quest_target_party", 0),
        (call_script, "script_setup_troop_meeting", ":caravan_leader", ":caravan_leader_dna", -1),
    (else_try), #SB : should really merge these quests, this is for older savegames
        (eq, "$caravan_escort_state",1),
        (party_is_active, "$caravan_escort_party_id"),
        (eq,"$current_town","$caravan_escort_destination_town"),
        (store_distance_to_party_from_party, ":dist", "$caravan_escort_destination_town", "$caravan_escort_party_id"),
        (lt,":dist", 5),
        # (store_distance_to_party_from_party, ":caravan_distance_to_player","p_main_party","$caravan_escort_party_id"),
        # (lt, ":caravan_distance_to_player", 5),
        # (start_encounter, "$caravan_escorted_party_id"),

        (assign, "$talk_context", tc_party_encounter),
        (assign, "$g_encountered_party", "$caravan_escort_party_id"),
        (party_stack_get_troop_id, ":caravan_leader", "$caravan_escort_party_id", 0),
        (party_stack_get_troop_dna, ":caravan_leader_dna", "$caravan_escort_party_id", 0),
        (call_script, "script_setup_troop_meeting", ":caravan_leader", ":caravan_leader_dna", -1),
        # (start_map_conversation, ":caravan_leader", ":caravan_leader_dna"),

    (else_try),
        (eq, "$g_town_visit_after_rest", 1),
        (assign, "$g_town_visit_after_rest", 0),
        (jump_to_menu,"mnu_town"),
    ##diplomacy begin
    (else_try),
        (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
        (try_begin),
            (eq, "$g_player_besiege_town", "$g_encountered_party"),
            (jump_to_menu, "mnu_castle_besiege"),
        (try_end),
    ##diplomacy end
    (else_try),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_castle),
        ##diplomacy start+ Handle player is co-ruler of kingdom
        (assign, ":is_coruler",0),
        (try_begin),
            (eq, "$g_encountered_party_faction", "$players_kingdom"),
            (is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
            (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", "$players_kingdom"),
            (ge, reg0, DPLMC_FACTION_STANDING_LEADER_SPOUSE),
            (assign, ":is_coruler", 1),
        (try_end),
        (this_or_next|eq, ":is_coruler", 1),
        ##diplomacy end+
        (this_or_next|party_slot_eq, "$g_encountered_party", slot_town_lord, "trp_player"),
        (faction_slot_eq, "$g_encountered_party_faction", slot_faction_leader, "trp_player"),
        (jump_to_menu, "mnu_enter_your_own_castle"),
    (else_try),
        (party_slot_eq,"$g_encountered_party", slot_party_type,spt_castle),
        (ge, "$g_encountered_party_relation", 0),
        (this_or_next|eq,"$castle_undefended", 1),
        (this_or_next|eq, "$g_permitted_to_center", 1),
        (eq, "$g_encountered_party_faction", "$players_kingdom"),
        (jump_to_menu, "mnu_town"),
    (else_try),
        (party_slot_eq,"$g_encountered_party", slot_party_type,spt_town),
        (ge, "$g_encountered_party_relation", 0),
        (jump_to_menu, "mnu_town"),
    (else_try),
        (eq, "$g_player_besiege_town", "$g_encountered_party"),
        (jump_to_menu, "mnu_castle_besiege"),
    (try_end),

    ##diplomacy begin
    (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
        (set_background_mesh, "mesh_pic_townriot"),
    (else_try),
        ##diplomacy end
        (call_script, "script_set_town_picture"),
        ##diplomacy begin
    (try_end),
    ##diplomacy end
  ],[
    ("approach_gates",[
      (this_or_next|eq,"$entry_to_town_forbidden",1),
      (party_slot_eq,"$g_encountered_party", slot_party_type,spt_castle),
      #SB : not infested by peasants, they'd just kick you out
      (neg|party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
    ],"Approach the gates and hail the guard.",[
      (jump_to_menu, "mnu_castle_guard"),
    ]),

    ("town_sneak",[
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type,spt_town),
        (str_store_string, s7, "str_town"),
      (else_try),
        (str_store_string, s7, "str_castle"),
      (try_end),

      (eq, "$entry_to_town_forbidden", 1),
      (eq, "$cant_sneak_into_town", 0),
      #SB : do not let player in at all, because the garrison can be managed
      (neg|party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
    ],"Disguise yourself and try to sneak into the {s7}",[
      #SB : apply different disguises in new system, with outcomes
      (try_begin),
        (eq, "$g_dplmc_player_disguise", 1),
        (troop_get_slot, ":player_disguise", "trp_player", slot_troop_player_disguise_sets),
        (val_max, ":player_disguise", disguise_pilgrim),
        (troop_set_slot, "trp_player", slot_troop_player_disguise_sets, ":player_disguise"),
        # (assign, "$sneaked_into_town", disguise_none), #set no disguise
        (troop_clear_inventory, "trp_random_town_sequence"), # clear items to bring

        (try_for_range, ":i_slot", 0, ek_food + 1), #dckplmc: bugfix - clear equipped items
          (troop_set_inventory_slot, "trp_random_town_sequence", ":i_slot", -1),
        (try_end),

        (store_troop_gold, ":cur_amount", "trp_random_town_sequence"),
        (troop_remove_gold, "trp_random_town_sequence", ":cur_amount"),#clear gold
        (assign, "$temp", 0),
        (assign, "$temp4_1", "mnu_castle_outside"),
        (jump_to_menu, "mnu_dplmc_choose_disguise"),
      (else_try),
        (faction_get_slot, ":player_alarm", "$g_encountered_party_faction", slot_faction_player_alarm),
        (party_get_num_companions, ":num_men", "p_main_party"),
        (party_get_num_prisoners, ":num_prisoners", "p_main_party"),
        (val_add, ":num_men", ":num_prisoners"),
        (val_mul, ":num_men", 2),
        (val_div, ":num_men", 3),
        (store_add, ":get_caught_chance", ":player_alarm", ":num_men"),
        (store_random_in_range, ":random_chance", 0, 100),
        (try_begin),
          (this_or_next|ge, "$cheat_mode", 1),
          (this_or_next|ge, ":random_chance", ":get_caught_chance"),
          (eq, "$g_last_defeated_bandits_town", "$g_encountered_party"),
          (assign, "$g_last_defeated_bandits_town", 0),
          (assign, "$sneaked_into_town", disguise_pilgrim),
          (assign, "$town_entered", 1),
          (jump_to_menu,"mnu_sneak_into_town_suceeded"),
          (assign, "$g_mt_mode", tcm_disguised),
        (else_try),
          (jump_to_menu,"mnu_sneak_into_town_caught"),
        (try_end),
      (try_end),
    ]),
    ##diplomacy begin
    ("dplmc_riot_start_siege",[
      (party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
      (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
      (lt, "$g_encountered_party_2", 1),
      (call_script, "script_party_count_fit_for_battle","p_main_party"),
      (gt, reg0, 5),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (assign, reg6, 1),
      (else_try),
        (assign, reg6, 0),
      (try_end),
    ],"Besiege the {reg6?town:fortress} to counter the insurgency.",[
      #siege warfare chief We repit this here for advoid issues.
      (assign, "$g_empieza_asedio", 1), #variable to begin siege
      (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
      (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
      (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
      (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
      (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
      (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
      (assign, "$g_siege_saneamiento", 0),
      (assign, "$g_traicion_interna", 0),
      (assign, "$g_infiltracion_interna", 0),
      (assign, "$g_campos_cercanos", 0),
      (assign, "$g_listos_para_asalto", 0),
      (assign, "$g_mantlets_1", 0),
      (assign, "$g_cabezas_dentro", 0), #event
      (assign, "$g_siege_method", 0),
      (assign, "$g_siege_sallied_out_once", 0),
      (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
      (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
      #siege warfare acaba
      (assign,"$g_player_besiege_town","$g_encountered_party"),
      (jump_to_menu, "mnu_castle_besiege"),
    ]),
    ("dplmc_riot_negotiate",[
      (party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
      (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
      (lt, "$g_encountered_party_2", 1),
      (call_script, "script_party_count_fit_for_battle","p_main_party"),
      (gt, reg0, 5),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (assign, reg6, 1),
      (else_try),
        (assign, reg6, 0),
      (try_end),
    ],"Begin negotiations.",[
      (jump_to_menu, "mnu_dplmc_riot_negotiate"),
    ]),

    ##diplomacy end
    ("castle_start_siege",[
      ##diplomacy begin
      (neg|party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
      ##diplomacy end
      (this_or_next|party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
      (             party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, "p_main_party"),
      (store_relation, ":reln", "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (lt, ":reln", 0),
      (lt, "$g_encountered_party_2", 1),
      (call_script, "script_party_count_fit_for_battle","p_main_party"),
      (gt, reg(0), 5),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (assign, reg6, 1),
      (else_try),
        (assign, reg6, 0),
      (try_end),
      (call_script, "script_can_besiege_castle", "$players_kingdom", "$g_encountered_party_faction", 1),
      (eq, reg0, 0),
    ],"Besiege the {reg6?town:fortress}.",[
      #siege warfare chief We repit this here for advoid issues.
      (assign, "$g_empieza_asedio", 1), #variable to begin siege
      (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
      (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
      (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
      (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
      (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
      (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
      (assign, "$g_siege_saneamiento", 0),
      (assign, "$g_traicion_interna", 0),
      (assign, "$g_infiltracion_interna", 0),
      (assign, "$g_campos_cercanos", 0),
      (assign, "$g_listos_para_asalto", 0),
      (assign, "$g_mantlets_1", 0),
      (assign, "$g_cabezas_dentro", 0), #event
      (assign, "$g_siege_method", 0),
      (assign, "$g_siege_sallied_out_once", 0),
      (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
      (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
      #siege warfare acaba

      (assign,"$g_player_besiege_town","$g_encountered_party"),
      (store_relation, ":relation", "fac_player_supporters_faction", "$g_encountered_party_faction"),
      (val_min, ":relation", -40),
      (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":relation"),
      (call_script, "script_update_all_notes"),
      (jump_to_menu, "mnu_castle_besiege"),
    ]),
    ("cheat_castle_start_siege",[
      (eq, "$cheat_mode", 1),
      (this_or_next|party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
      (party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, "p_main_party"),
      (store_relation, ":reln", "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (ge, ":reln", 0),
      (lt, "$g_encountered_party_2", 1),
      (call_script, "script_party_count_fit_for_battle","p_main_party"),
      (gt, reg(0), 1),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (assign, reg6, 1),
      (else_try),
        (assign, reg6, 0),
      (try_end),
    ],"{!}CHEAT: Besiege the {reg6?town:fortress}...",[
      #siege warfare chief We repit this here for advoid issues.
      (assign, "$g_empieza_asedio", 1), #variable to begin siege
      (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
      (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
      (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
      (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
      (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
      (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
      (assign, "$g_siege_saneamiento", 0),
      (assign, "$g_traicion_interna", 0),
      (assign, "$g_infiltracion_interna", 0),
      (assign, "$g_campos_cercanos", 0),
      (assign, "$g_listos_para_asalto", 0),
      (assign, "$g_mantlets_1", 0),
      (assign, "$g_cabezas_dentro", 0), #event
      (assign, "$g_siege_method", 0),
      (assign, "$g_siege_sallied_out_once", 0),
      (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
      (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
      #siege warfare acaba
      (assign,"$g_player_besiege_town","$g_encountered_party"),
      (jump_to_menu, "mnu_castle_besiege"),
    ]),
    ("castle_leave",[
    ],"Leave.",[
      (change_screen_return,0)
    ]),
    ("castle_cheat", [
      (ge, "$cheat_mode", 1)
    ], "{!}Use Cheats", [
      # (assign, "$sneaked_into_town", disguise_pilgrim),
      (assign, "$town_entered", 1),
      # (assign, "$g_mt_mode", tcm_disguised),
      (jump_to_menu, "mnu_town_cheats"),
    ]),
]),
("castle_guard",mnf_scale_picture,
  "You approach the gate. The men on the walls watch you closely.^^{s10}",
  "none",[
    (str_clear, s10),
    ##prisoner lord chief Siege Warfare
    (try_begin),
      (party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
      (gt, ":town_lord", 0),
      (is_between, ":town_lord", heroes_begin, active_npcs_end),
      (str_store_troop_name, s11, ":town_lord"),
      (try_begin),
        (party_count_prisoners_of_type, ":party_has_prisoner", "p_main_party", ":town_lord"),
        (gt, ":party_has_prisoner", 0),
        (str_store_string, s10, "@You make sure they see that their lord, {s11}, is held prisoner by your army."),
      (try_end),
    (try_end),
    ###chief acaba
    (call_script, "script_set_town_picture"),
  ],[
    ("request_shelter",[
      (party_slot_eq, "$g_encountered_party",slot_party_type, spt_castle),
      (ge, "$g_encountered_party_relation", 0),
    ],"Request entry to the fortress.",[
      (party_get_slot, ":castle_lord", "$g_encountered_party", slot_town_lord),
      (try_begin),
        (lt, ":castle_lord", 0),
        (jump_to_menu, "mnu_castle_entry_granted"),
      (else_try),
        (call_script, "script_troop_get_player_relation", ":castle_lord"),
        (assign, ":castle_lord_relation", reg0),
        #(troop_get_slot, ":castle_lord_relation", ":castle_lord", slot_troop_player_relation),
        (try_begin),
          (gt, ":castle_lord_relation", -15),
          (jump_to_menu, "mnu_castle_entry_granted"),
        (else_try),
          (jump_to_menu, "mnu_castle_entry_denied"),
        (try_end),
      (try_end),
    ]),
    ("request_meeting_commander",[],"Request a meeting with someone.",[
      (jump_to_menu, "mnu_castle_meeting"),
    ]),
    ("guard_leave",[],"Leave.",[
      (change_screen_return,0),
    ]),
]),
("castle_entry_granted",mnf_scale_picture,
  "After a brief wait, the guards open the gates for you and allow your party inside.",
  "none",[
    (call_script, "script_set_town_picture"),
  ],[
    ("continue",[],"Continue...",[(jump_to_menu,"mnu_town")]),
]),
("castle_entry_denied",mnf_scale_picture,
  "The lord of this fortress has forbidden you from coming inside these walls,"
  +" and the guard sergeant informs you that his men will fire if you attempt to come any closer.",
  "none",[
    (call_script, "script_set_town_picture"),
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu,"mnu_castle_guard"),
    ]),
]),
("castle_meeting",mnf_scale_picture,
  "With whom do you want to meet?",
  "none",[
    (party_clear, "p_temp_party"),
    (call_script, "script_set_town_picture"),
    (call_script, "script_get_heroes_attached_to_center_aux", "$g_encountered_party", "p_temp_party"),#recursive call
    (party_get_num_companion_stacks, "$num_castle_meeting_troops", "p_temp_party"),
    (assign, "$talk_context", tc_castle_gate), #SB : move this up here
  ],[
    ("guard_meet_"+str(x),[
      (gt, "$num_castle_meeting_troops", x),#test this out
      (party_stack_get_troop_id, ":troop_no", "p_temp_party", x),
      (is_between, ":troop_no", active_npcs_begin, active_npcs_end),
      (str_store_troop_name, s5, ":troop_no")],
      "{s5}.",[(party_stack_get_troop_id, "$castle_meeting_selected_troop", "p_temp_party", x),
      # (party_stack_get_troop_dna, "$temp_2", "p_temp_party", x),
      (jump_to_menu,"mnu_castle_meeting_selected")])
      for x in range(0, 8)
    ]
    +[("forget_it",[], "Forget it.", [(jump_to_menu,"mnu_castle_guard")]),
]),
("talk_with_commanders",mnf_scale_picture,
  "With whom do you want to talk?",
  "none",[
    (party_clear, "p_temp_party"),
    (call_script, "script_get_heroes_attached_to_party_aux", "p_main_party", "p_temp_party"),#recursive call
    (party_get_num_companion_stacks, "$num_castle_meeting_troops", "p_temp_party"),
  ],[
    ("guard_meet_"+str(x),[
      (gt, "$num_castle_meeting_troops", x),#test this out
      (party_stack_get_troop_id, ":troop_no", "p_temp_party", x),
      (is_between, ":troop_no", active_npcs_begin, active_npcs_end),
      (str_store_troop_name, s5, ":troop_no")],
      "{s5}.",[(party_stack_get_troop_id, "$castle_meeting_selected_troop", "p_temp_party", x),
      # (party_stack_get_troop_dna, "$temp_2", "p_temp_party", x),
      (jump_to_menu,"mnu_talk_with_commanders_selected")])
      for x in range(0, 8)
    ]+[
    ("forget_it",[], "Forget it.", [
      (jump_to_menu,"mnu_camp")
    ]),
]),
("talk_with_commanders_selected",0,
  "You dispatch a runner. After some time {s6} appears to speak with you.",
  "none",[
    (try_begin),
      (eq, "$g_leave_encounter", 1),
      (change_screen_return),
    (try_end),
    (str_store_troop_name, s6, "$castle_meeting_selected_troop")
  ],[
    ("continue",[],"Continue...",[
    (troop_get_slot, "$g_encountered_party", "$castle_meeting_selected_troop", slot_troop_leaded_party),
    (store_faction_of_party, "$g_encountered_party_faction","$g_encountered_party"),
    (store_relation, "$g_encountered_party_relation", "$g_encountered_party_faction", "fac_player_faction"),

    (party_get_slot, "$g_encountered_party_type", "$g_encountered_party", slot_party_type),
    (party_get_template_id,"$g_encountered_party_template","$g_encountered_party"),

    (jump_to_menu, "mnu_camp"),
    (call_script, "script_get_meeting_scene"),
		(assign, ":meeting_scene", reg0),
		(modify_visitors_at_site,":meeting_scene"),
		(reset_visitors),
		(set_visitor,0,"trp_player"),
		(set_visitor,17,"$castle_meeting_selected_troop"),
		(set_jump_mission,"mt_conversation_encounter"),
		(jump_to_scene,":meeting_scene"),
		(assign, "$talk_context", tc_town_talk), #SB : move this up here
		(change_screen_map_conversation, "$castle_meeting_selected_troop"),
	]),
]),

("castle_meeting_selected",0,
  "Your request for a meeting is relayed inside, and finally {s6} appears in the courtyard to speak with you.",
  "none",[
    (try_begin),
      (eq, "$g_leave_encounter", 1),
      (change_screen_return),
    (try_end),
    (str_store_troop_name, s6, "$castle_meeting_selected_troop")
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_castle_outside"),
      #do not set context here in case we need to use another one, set tc_castle_gate from parent menu
      (call_script, "script_start_courtyard_conversation", "$castle_meeting_selected_troop", "$current_town"),
    ]),
]),

  (
    "castle_besiege",mnf_enable_hot_keys,
    "You are laying siege to {s4}. {s2} " +
    "^^{s15} {s16} {s17} {s18} {s19} {s20} {s21} {s22}",
    "none",
    [
      (str_clear, s1),
      (str_clear, s2),
      (str_clear, s4),
      (str_clear, s15),
      (str_clear, s16),
      (str_clear, s17),
      (str_clear, s18),
      (str_clear, s19),
      (str_clear, s20),
      (str_clear, s21),
      (str_clear, s22),

      (str_store_party_name,s4,"$current_town"),

      (set_background_mesh, "mesh_pic_siege_sighted"),
      (assign, "$g_siege_force_wait", 0),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
        (party_set_slot, "$g_encountered_party", slot_center_is_besieged_by, "p_main_party"),
        (store_current_hours, ":cur_hours"),
        (party_set_slot, "$g_encountered_party", slot_center_siege_begin_hours, ":cur_hours"),
        (assign, "$g_siege_method", 0),
        (assign, "$g_siege_sallied_out_once", 0),
        # Chief siege camp around town Siege warfare icono de asedio
        #phaiak begin
        (try_begin),
          (party_set_extra_icon, "$g_encountered_party", "icon_camp_siege", 0, 0, 0, 0),
        (try_end),
        #phaiak end
        # chief siege camp acaba
        (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
        (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
      (try_end),

      (party_get_slot, ":town_food_store", "$g_encountered_party", slot_party_food_store),
      (call_script, "script_center_get_food_consumption", "$g_encountered_party"),
      (assign, ":food_consumption", reg0),
      (assign, reg7, ":food_consumption"),
      (assign, reg8, ":town_food_store"),
      (store_div, reg3, ":town_food_store", ":food_consumption"),

      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (assign, reg6, 1),
      (else_try),
        (assign, reg6, 0),
      (try_end),

      (try_begin),
        (gt, reg3, 0),
        (str_store_string, s2, "@The {reg6?town's:fort's} food stores should last for {reg3} more days."),
      (else_try),
        (str_store_string, s2, "@The {reg6?town's:fort's} food stores have run out and the defenders are starving."),

        #siege warfare chief##############
        (try_begin),
          (gt, "$g_days_spent_starving", 6), #6 days left, deffenders tired siege.
          (jump_to_menu, "mnu_surrender_siege_defenders_starved"),
        (else_try), #defenders desesperate = sally out to break the siege
          (gt, "$g_days_spent_starving", 1), #6 days left, deffenders tired siege

          ###add days each 24 h
          (try_begin),
            (party_get_slot, ":last_starving_time", "$g_encountered_party", slot_center_starvation_time),
            (store_current_hours, ":cur_hours"),
            (store_add, ":add_starving", ":last_starving_time", 24), #x min hours enter sallys
            (ge, ":cur_hours", ":add_starving"),
            (val_add, "$g_days_spent_starving", 1), #8 days left, deffenders tired siege
            (party_set_slot, "$g_encountered_party", slot_center_starvation_time, ":cur_hours"),
            #(display_message, "@added 1 day to sally2"),
          (try_end),
          #
          # (try_begin),
            # (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
            # (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
          # (else_try),
            # (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
          # (try_end),
          (call_script, "script_calculate_battle_advantage"),
          (assign, ":battle_advantage", reg0),
          (val_mul, ":battle_advantage", 2),
          (val_div, ":battle_advantage", 3), #scale down the advantage a bit in sieges.
          (set_battle_advantage, ":battle_advantage"),

          (try_begin),
            (store_current_hours, "$g_sally_timer"),
            (ge, "$g_sally_timer", "$g_next_sally_at"),
            (store_random_in_range, ":hours", 22,44),
            (store_add, "$g_next_sally_at", "$g_sally_timer", ":hours"), #x min hours enter sallys
            (ge, ":hours", 28), #60% chance to deffenders sally out

            (set_party_battle_mode),
            (assign, "$g_siege_battle_state", 1),
            (try_begin),
              (set_jump_mission,"mt_castle_attack_walls_defenders_sally"),
              (assign, "$g_siege_battle_state", 0),
            (try_end),
            (assign, "$cant_talk_to_enemy", 0),
            (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
            (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
            (assign, "$g_siege_method", 0), #reset siege timer
            (call_script, "script_setup_random_scene"),
            (jump_to_menu, "mnu_nofood_siege_defenders_sally"),
          (try_end),
        (else_try), #defenders desesperate = sally out to break the siege
          ###add days each 24 h
          (try_begin),
            (party_get_slot, ":last_starving_time", "$g_encountered_party", slot_center_starvation_time),
            (store_current_hours, ":cur_hours"),
            (store_add, ":add_starving", ":last_starving_time", 24), #x min hours enter sallys
            (ge, ":cur_hours", ":add_starving"),
            (val_add, "$g_days_spent_starving", 1), #8 days left, deffenders tired siege
            (party_set_slot, "$g_encountered_party", slot_center_starvation_time, ":cur_hours"),
            #(display_message, "@added 1 day to sally"),
          (else_try),
            (val_add, "$g_days_spent_starving", 0), #8 days left, deffenders tired siege
          (try_end),
          #
        (try_end),
        ###siege warfare end
      (try_end),

      ##        (str_store_string, s3, "str_empty_string"),
      ##        (try_begin),
      ##          (ge, "$g_siege_method", 1),
      ##          (store_current_hours, ":cur_hours"),
      ##          (try_begin),
      ##            (lt, ":cur_hours",  "$g_siege_method_finish_hours"),
      ##            (store_sub, reg9, "$g_siege_method_finish_hours", ":cur_hours"),
      ##            (try_begin),
      ##              (eq, "$g_siege_method", 1),
      ##              (str_store_string, s3, "@You're preparing to attack the walls, the work should finish in {reg9} hours."),
      ##            (else_try),
      ##              (eq, "$g_siege_method", 2),
      ##              (str_store_string, s3, "@Your forces are building a siege tower and preparing to attack the walls. They estimate another {reg9} hours to complete the build."),
      ##            (try_end),
      ##          (else_try),
      ##            (try_begin),
      ##              (eq, "$g_siege_method", 1),
      ##              (str_store_string, s3, "@You are ready to attack the walls at any time."),
      ##            (else_try),
      ##              (eq, "$g_siege_method", 2),
      ##              (str_store_string, s3, "@The siege tower is built and ready to make an assault."),
      ##            (try_end),
      ##          (try_end),
      ##        (try_end),

      ####siege warfare chief

      #string para circunvalacion
      (str_store_string,s15,"str_circunvalation_none"),
      (try_begin),
        (party_slot_eq,"$g_encountered_party",slot_center_blockaded,1),
        (str_store_string, s15, "@>>Your men are building checkpoints and small camps around {s4} to prevent anyone from going in or out. "+
        "As long as the blockade is unfinished the town can refill its food supplies.^^"),
      (else_try),
        (party_slot_eq,"$g_encountered_party",slot_center_blockaded,2), #final
        (str_store_string, s15, "@>>Your perimeter control is ready. You have set a perimeter for surveillance around {s4}. No one can enter or leave without the knowledge of your men.^" +
        "The settlement can no longer refill its food supplies from outside.^^"),
      (try_end),

      (str_store_string,s16,"str_empty_string"),
      (try_begin),
        (ge, "$g_listos_para_asalto", 1),
        (str_store_string,s16,"@>>Your men are ready for assault.^^"),
      (try_end),

      ####saneamiento chief
      (str_store_string,s17,"str_empty_string"),
      (try_begin),
        (eq, "$g_siege_saneamiento", 2),
        (str_store_string,s17,"@>>As a disciplined army, your men have made latrines, pipelines, and a pond for their weekly bath. A healthy camp prevents disease.^^"),
      (try_end),

      (str_store_string,s18,"str_empty_string"),
      (try_begin),
        (eq, "$g_mantlets_1", 2),
        (str_store_string,s18,"@>>Your men have finished building mantlets. Now you can use them to protect your soldiers in the vanguard attack, and your main force for the final charge.^^"),
      (try_end),

      (str_store_string,s19,"str_empty_string"),
      (try_begin),
        (ge, "$g_siege_method", 2),
        (str_store_string,s19,"@>>Your men have finished making scaling equipment.^^"),
      (try_end),

      (str_store_string,s20,"str_empty_string"),
      (try_begin),
        (eq, "$g_traicion_interna", 3),
        (str_store_string,s20,"@>>Your attempt to find a traitor in the settlement has failed.^^"),
      (else_try),
        (eq, "$g_traicion_interna", 4),
        (str_store_string,s20,"@>>You have found a traitor within {s7} that has supported your efforts to conquer it. This will make it more receptive to surrendering.^^"),
      (try_end),

      ####strings infiltrado
      (str_store_string,s21,"str_empty_string"),
      (try_begin),
        (eq, "$g_infiltracion_interna", 3),
        (str_store_string,s21,"@>>Your attempt to have your men infiltrate {s4} has failed.^^"),
      (else_try),
        (eq, "$g_infiltracion_interna", 4),
        (str_store_string,s21,"@>>Your men have succeeded in infiltrating {s4} and damaging the enemy.^^"),
      (try_end),

      #####strings quemar campos cercanos
      (str_store_string,s22,"str_empty_string"),
      (try_begin),
        (eq, "$g_campos_cercanos", 3),
        (str_store_string,s22,"@>>You've managed to pillage the crops and farms nearby.^^"),
      (try_end),
      #siege warfare chief

      #Check if enemy leaves the castle to us...
      (try_begin),
        (eq, "$g_castle_left_to_player",1), #we come here after dialog. Empty the castle and send parties away.
        (assign, "$g_castle_left_to_player",0),
        (store_faction_of_party, ":castle_faction", "$g_encountered_party"),
        (party_set_faction,"$g_encountered_party","fac_neutral"), #temporarily erase faction so that it is not the closest town
        (party_get_num_attached_parties, ":num_attached_parties_to_castle","$g_encountered_party"),
        (try_for_range_backwards, ":iap", 0, ":num_attached_parties_to_castle"),
          (party_get_attached_party_with_rank, ":attached_party", "$g_encountered_party", ":iap"),
          (party_detach, ":attached_party"),
          (party_get_slot, ":attached_party_type", ":attached_party", slot_party_type),
          (eq, ":attached_party_type", spt_kingdom_hero_party),
          (store_faction_of_party, ":attached_party_faction", ":attached_party"),
          (call_script, "script_get_closest_walled_center_of_faction", ":attached_party", ":attached_party_faction"),
          (try_begin),
            (gt, reg0, 0),
            (call_script, "script_party_set_ai_state", ":attached_party", spai_holding_center, reg0),
          (else_try),
            (call_script, "script_party_set_ai_state", ":attached_party", spai_patrolling_around_center, "$g_encountered_party"),
          (try_end),
        (try_end),
        (call_script, "script_party_remove_all_companions", "$g_encountered_party"),
        (change_screen_return),
        (party_collect_attachments_to_party, "$g_encountered_party", "p_collective_enemy"), #recalculate so that
        (call_script, "script_party_copy", "p_encountered_party_backup", "p_collective_enemy"), #leaving troops will not be considered as captured
        (party_set_faction,"$g_encountered_party",":castle_faction"),
      (try_end),

      #Check for victory or defeat....
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (str_store_party_name, 1,"$g_encountered_party"),
      (call_script, "script_encounter_calculate_fit"),

      (assign, reg11, "$g_enemy_fit_for_battle"),
      (assign, reg10, "$g_friend_fit_for_battle"),

      (try_begin),
        (eq, "$g_leave_encounter",1),
        (change_screen_return),
      (else_try),
        (call_script, "script_party_count_fit_regulars","p_collective_enemy"),
        (assign, ":enemy_finished", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (assign, ":enemy_finished", 1),
        (else_try),
          (this_or_next|le, "$g_enemy_fit_for_battle",0),
          (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":enemy_finished", 1),
        (try_end),

        (this_or_next|eq, ":enemy_finished", 1),
        (eq, "$g_enemy_surrenders", 1),
        #siege warfare chief
        (assign, "$g_empieza_asedio", 0),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
        (try_begin),
            (troop_slot_ge, "trp_global_variables", g_player_trench, 1),
            (troop_set_slot, "trp_global_variables", g_player_trench, 0),
            (display_message, "@Fortifications are destroyed.", message_alert), #SB : colorize
        (try_end),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
        (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
        (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
        (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
        (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),

        (assign, "$g_siege_saneamiento", 0),
        (assign, "$g_traicion_interna", 0),
        (assign, "$g_infiltracion_interna", 0),
        (assign, "$g_campos_cercanos", 0),
        (assign, "$g_listos_para_asalto", 0),
        (assign, "$g_mantlets_1", 0),
        (assign, "$g_cabezas_dentro", 0), #event
        (assign, "$g_siege_method", 0),
        (assign, "$g_siege_sallied_out_once", 0),
        (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
        (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
        #siege warfare acaba

        (assign, "$g_next_menu", "mnu_castle_taken"),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":main_party_fit_regulars", reg0),
        (eq, "$g_battle_result", -1),
        (this_or_next|eq, ":main_party_fit_regulars", 0), #all lost (TODO : )
        (le, ":main_party_fit_regulars",  "$num_routed_allies"), #we do not want routed agents to spawn again in next turn of battle.
        (assign, "$g_next_menu", "mnu_captivity_start_castle_defeat"),
        #siege warfare chief
        (assign, "$g_empieza_asedio", 0),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
        (try_begin),
            (troop_slot_ge, "trp_global_variables", g_player_trench, 1),
            (troop_set_slot, "trp_global_variables", g_player_trench, 0),
            (display_message, "@Fortifications are destroyed.", message_alert), #SB : colorize
        (try_end),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
        (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
        (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
        (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
        (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),

        (assign, "$g_siege_saneamiento", 0),
        (assign, "$g_traicion_interna", 0),
        (assign, "$g_infiltracion_interna", 0),
        (assign, "$g_campos_cercanos", 0),
        (assign, "$g_listos_para_asalto", 0),
        (assign, "$g_mantlets_1", 0),
        (assign, "$g_cabezas_dentro", 0), #event
        (assign, "$g_siege_method", 0),
        (assign, "$g_siege_sallied_out_once", 0),
        (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
        (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
        #siege warfare acaba
        (jump_to_menu, "mnu_total_defeat"),
      (try_end),
    ],
    [
      ("siege_request_meeting",[(eq, "$cant_talk_to_enemy", 0)],"Call for a meeting with the enemy commander.", [
          (assign, "$cant_talk_to_enemy", 1),
          (assign, "$g_enemy_surrenders",0),
          (assign, "$g_castle_left_to_player",0),
          (assign, "$talk_context", tc_castle_commander),
          (party_get_num_attached_parties, ":num_attached_parties_to_castle","$g_encountered_party"),
          (try_begin),
            (gt, ":num_attached_parties_to_castle", 0),
            (party_get_attached_party_with_rank, ":leader_attached_party", "$g_encountered_party", 0),
            (call_script, "script_setup_party_meeting", ":leader_attached_party"),
          (else_try),
            (call_script, "script_setup_party_meeting", "$g_encountered_party"),
          (try_end),
      ]),

      #########Siege Warfare chief
      ("siege_warfare_p",[],"Siege Warfare (Planning Siege).", [
        (jump_to_menu,"mnu_siege_plan"),
      ]),
      ("siege_assault_p",[],
        "Siege Warfare (Preparing Assault).", [(jump_to_menu,"mnu_siege_assault")]),
      ("siege_assault_camp",[(troop_slot_eq, "trp_global_variables", g_player_trench, 0),],
        "Fortify your siege camp.", [
      (jump_to_menu, "mnu_fortify_siege_camp"),
      ]),
      ("siege_assault_camp",[(troop_slot_eq, "trp_global_variables", g_player_trench, 1),],
        "Destroy your fortifications.", [
        (troop_set_slot, "trp_global_variables", g_player_trench, 0),
        (display_message, "@Fortifications are destroyed.", message_alert), #SB : colorize
      ]),

      ("siege_assault_camp",[],
        "Your siege Camp.", [
        (set_jump_mission,"mt_camp"),
        (call_script, "script_setup_camp_scene"),
        (change_screen_mission),
      ]),
      #########Siege warfare acaba

      ("wait_24_hours",[],"Wait until tomorrow.", [
          (assign,"$auto_besiege_town","$g_encountered_party"),
          (assign, "$g_siege_force_wait", 1),
          (store_time_of_day,":cur_time_of_day"),
          (val_add, ":cur_time_of_day", 1),
          (assign, ":time_to_wait", 31),
          (val_sub,":time_to_wait",":cur_time_of_day"),
          (val_mod,":time_to_wait",24),
          (val_add, ":time_to_wait", 1),
          (rest_for_hours_interactive, ":time_to_wait", 10, 1), #rest while attackable x10 speed should save time to player.
          (assign, "$cant_talk_to_enemy", 0),
          (change_screen_return),
      ]),

      ("cheat_castle_lead_attack",[(eq, "$cheat_mode", 1),
          (eq, "$g_siege_method", 0),
          (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
          ],
        "{!}CHEAT: Instant build equipment.",
        [
       (assign, "$g_mantlets_1", 2),
          (assign, "$g_siege_method", 1),
          (assign, "$g_siege_method_finish_hours", 0),
          (jump_to_menu, "mnu_castle_besiege"),
      ]),

      ("cheat_conquer_castle",[(eq, "$cheat_mode", 1),
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
        ],
        "{!}CHEAT: Instant conquer fortress.",
        [
          (assign, "$g_next_menu", "mnu_castle_taken"),
          (jump_to_menu, "mnu_total_victory"),
      ]),

      ("lift_siege",[],"Abandon the siege.",
        [
        (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
        (assign,"$g_player_besiege_town", -1),
        #siege warfare chief
        (assign, "$g_empieza_asedio", 0),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
        (try_begin),
            (troop_slot_ge, "trp_global_variables", g_player_trench, 1),
            (troop_set_slot, "trp_global_variables", g_player_trench, 0),
            (display_message, "@Fortifications are destroyed.", message_alert), #SB : colorize
        (try_end),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
        (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
        (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
        (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
        (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),

        (assign, "$g_siege_saneamiento", 0),
        (assign, "$g_traicion_interna", 0),
        (assign, "$g_infiltracion_interna", 0),
        (assign, "$g_campos_cercanos", 0),
        (assign, "$g_listos_para_asalto", 0),
        (assign, "$g_mantlets_1", 0),
        (assign, "$g_cabezas_dentro", 0), #event
        (assign, "$g_siege_method", 0),
        (assign, "$g_siege_sallied_out_once", 0),
        (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
        (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
        #siege warfare acaba
        (change_screen_return)]),

    ]
  ),

  ######Siege warfare Chief
  (
    "siege_plan",0,
    "You meet with your advisers to plan the siege and try to conquer {s4} with the least possible casualties. Your strategy could be to reduce the place by famine and demoralization.^^{s15} {s17} {s18} {s19} {s20}",
    "none",
    [

      (str_store_party_name,s4,"$current_town"),

      (str_clear, s7),
      (str_clear, s15),
      (str_clear, s16),
      (str_clear, s17),
      (str_clear, s18),
      (str_clear, s19),
      (str_clear, s20),

      #string para circunvalacion
      (str_store_string,s15,"str_circunvalation_none"),
      (try_begin),
        (party_slot_eq,"$g_encountered_party",slot_center_blockaded,1),
        (str_store_string, s15, "@>>Your men are building checkpoints and small camps around {s4} to prevent anyone from going in or out.^^"),
      (else_try),
        (party_slot_eq,"$g_encountered_party",slot_center_blockaded,2), #final
        (str_store_string, s15, "@>>Your perimeter control is ready. You have set a perimeter for surveillance around {s4}. No one can enter or leave without the knowledge of your men.^" +
        "This will be beneficial especially when you have to negotiate the surrender of the fortress with its commander.^^"),
      (try_end),
      #
      ####strings traicion
      (str_store_string,s17,"str_empty_string"),
      (try_begin),
        (ge, "$g_traicion_interna", 1),
        (le, "$g_traicion_interna", 2),
        (str_store_string,s17,"@>>You have sent men to find a traitor in {s4}.^^"),
      (else_try),
        (eq, "$g_traicion_interna", 3),
        (str_store_string,s17,"@>>Your attempt to find a traitor in the settlement has failed.^^"),
      (else_try),
        (eq, "$g_traicion_interna", 4),
        (str_store_string,s17,"@>>You have found a traitor within {s4} that has supported your efforts to conquer it. This will render it more receptive to surrendering.^^"),
      (try_end),

      #####strings quemar campos cercanos
      (str_store_string,s18,"str_empty_string"),
      (try_begin),
        (eq, "$g_campos_cercanos", 3),
        (str_store_string,s18,"@>>You've managed to pillage the crops and farms nearby.^^"),
      (else_try),
        (ge, "$g_campos_cercanos", 1),
        (str_store_string,s18,"@>>Your men are taking crops and ransacking farms close to {s4} on your orders. This will render it more receptive to surrendering.^^"),
      (try_end),
      ####strings infiltrado
      (str_store_string,s19,"str_empty_string"),
      (try_begin),
        (ge, "$g_infiltracion_interna", 1),
        (le, "$g_infiltracion_interna", 2),
        (str_store_string,s19,"@>>You have sent men to infiltrate {s4}.^^"),
      (else_try),
        (eq, "$g_infiltracion_interna", 3),
        (str_store_string,s19,"@>>Your attempt to have your men infiltrate {s4} has failed.^^"),
      (else_try),
        (eq, "$g_infiltracion_interna", 4),
        (str_store_string,s19,"@>>Your men have succeeded in infiltrating {s4} and damaging the enemy.^^"),
      (try_end),
      ####saneamiento chief
      (str_store_string,s20,"str_empty_string"),
      (try_begin),
        (eq, "$g_siege_saneamiento", 0),
        (str_store_string,s20,"@>>Your camp smells horrible. The ground is muddy, your men defecate between tents, and you see rats running here and there.^^"),
      (else_try),
        (ge, "$g_siege_saneamiento", 1),
        (party_get_slot, ":last_saneamiento_time", "$g_encountered_party", slot_center_latrines),
        (store_current_hours, ":cur_hours"),
        (store_add, ":ok_time", ":last_saneamiento_time", 4),
        (gt, ":cur_hours", ":ok_time"),
        (str_store_string,s20,"@>>As a disciplined army, your men have made latrines, pipelines and a pond for their weekly bath. A healthy camp prevents disease.^^"),
        (assign, "$g_siege_saneamiento", 2), #final
      (else_try),
        (eq, "$g_siege_saneamiento", 1),
        (str_store_string,s20,"@>>Your men are digging holes for latrines and taking other measures to prevent disease.^^"),
      (try_end),

      (call_script, "script_set_town_picture"),

    ],
    [

      ###siege perimeter control(party_set_slot,"p_main_party",slot_center_blockaded,0),
      ("build_circunvalation",[
          (party_slot_eq,"$g_encountered_party",slot_center_blockaded,0),],
        "Blockade: build checkpoints around {s4}.", [

          (store_party_size_wo_prisoners, ":num_men", "p_main_party"),
          (assign, reg1, ":num_men"),
          (display_message, "@Main party size: {reg1} men"),
          (party_get_num_attached_parties, ":num_attached_parties", "p_main_party"),
          (try_begin),
            (ge, ":num_attached_parties", 1),
            (try_for_range, ":attached_party_rank", 0, ":num_attached_parties"),
              (party_get_attached_party_with_rank, ":attached_party", "p_main_party", ":attached_party_rank"),
              (store_party_size_wo_prisoners, ":size", ":attached_party"),
              (val_add, ":num_men", ":size"),
              (str_store_party_name, s1, ":attached_party"),
              (assign, reg1, ":size"),
              (display_message, "@{s1}: {reg1} men"),
            (try_end),
          (try_end),

          (try_begin),
            (gt, ":num_men", 250), # se muestra si el player tiene por lo menos 250 hombres
            (jump_to_menu,"mnu_construct_circunvalation"),
          (else_try),
            (display_message,"@You need to have more than 250 men for this job."),
          (try_end),
      ]),

      ("close_circunvalation",[
          (party_slot_eq,"$g_encountered_party",slot_center_blockaded,1),
          (party_get_slot, ":last_blockplace_time", "$g_encountered_party", slot_center_blockaded_time),
          (store_current_hours, ":cur_hours"),

          (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
          (assign, ":max_skill", reg0),
          (store_sub, reg4, 16, ":max_skill"),
          (val_mul, reg4, 4),#between 24 and 64 hours

          #      (store_random_in_range,":random_check",80,100),
          (store_add, ":ok_time", ":last_blockplace_time", reg4), #between 60 and 160 hours
          (gt, ":cur_hours", ":ok_time"),
        ],
        "Checkpoints are finished. Now order active watching.", [
          #Reduce prosperity of the center by 10
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -10),
          (party_get_slot, ":food_stores", "$g_encountered_party", slot_party_food_store),
          (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
          (val_min, ":food_stores", reg0),
          (party_set_slot, "$g_encountered_party", slot_party_food_store, ":food_stores"),
          (party_set_slot,"$g_encountered_party",slot_center_blockaded, 2),
          (jump_to_menu,"mnu_siege_plan"),]),
      #####circunvalacion acaba
      #####disfrazarte para entrar en la ciudad e investigar sus defensas
      ("town_investigar",
        [
        ],
        "Investigate the defenses: try to sneak inside. (Tracking)",
        [

         #SB : apply different disguises in new system, with outcomes
        (try_begin),
          (eq, "$g_dplmc_player_disguise", 1),
          (troop_get_slot, ":player_disguise", "trp_player", slot_troop_player_disguise_sets),
          (val_max, ":player_disguise", disguise_pilgrim),
          (troop_set_slot, "trp_player", slot_troop_player_disguise_sets, ":player_disguise"),
          # (assign, "$sneaked_into_town", disguise_none), #set no disguise
          (troop_clear_inventory, "trp_random_town_sequence"), # clear items to bring

          (try_for_range, ":i_slot", 0, ek_food + 1), #dckplmc: bugfix - clear equipped items
            (troop_set_inventory_slot, "trp_random_town_sequence", ":i_slot", -1),
          (try_end),

          (store_troop_gold, ":cur_amount", "trp_random_town_sequence"),
          (troop_remove_gold, "trp_random_town_sequence", ":cur_amount"),#clear gold
          (assign, "$temp", 0),
          (assign, "$temp4_1", "mnu_siege_plan"),
          (jump_to_menu, "mnu_dplmc_choose_disguise"),
        (else_try),
          (faction_get_slot, ":player_alarm", "$g_encountered_party_faction", slot_faction_player_alarm),
          (party_get_num_companions, ":num_men", "p_main_party"),
          (party_get_num_prisoners, ":num_prisoners", "p_main_party"),
          (val_add, ":num_men", ":num_prisoners"),
          (val_mul, ":num_men", 2),
          (val_div, ":num_men", 3),
          (store_add, ":get_caught_chance", ":player_alarm", ":num_men"),
          (store_random_in_range, ":random_chance", 0, 100),
          (try_begin),
            (this_or_next|ge, "$cheat_mode", 1),
            (this_or_next|ge, ":random_chance", ":get_caught_chance"),
            (eq, "$g_last_defeated_bandits_town", "$g_encountered_party"),
            (assign, "$g_last_defeated_bandits_town", 0),
            (assign, "$sneaked_into_town", disguise_pilgrim),
            (assign, "$town_entered", 1),
            (jump_to_menu,"mnu_sneak_into_town_suceeded"),
            (assign, "$g_mt_mode", tcm_disguised),
          (else_try),
            (jump_to_menu,"mnu_sneak_into_town_caught"),
          (try_end),
        (try_end),

      ]),

      #traicion interna
      ("traicion_interna",
        [
          (party_get_slot, ":blockplace_place", "$g_encountered_party", slot_center_blockaded),
          (ge, ":blockplace_place", 1),
          (eq, "$g_traicion_interna", 0),
          (neq, "$g_infiltracion_interna", 1),
        ],
        "Find a traitor within the defenses of {s4}.",
        [
          (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
          (assign, ":num_men", 0),
          (try_for_range, ":i_stack", 0, ":num_stacks"),
            (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
            (val_add, ":num_men", ":stack_size"),
          (try_end),
          (try_begin),
            (gt, ":num_men", 40), # se muestra si el player tiene por lo menos 40 hombres
            (jump_to_menu,"mnu_traicion_interna2"),
          (else_try),
            (display_message,"@You need to have at least 40 men in order to assign some of them to finding a traitor."),
          (try_end),
      ]),

      ("traicion_interna3",[           (eq, "$g_traicion_interna", 2),
        ],
        "Any news from the men sent in search of a traitor?", [
          (store_random_in_range, ":rand", 0, 6),
          (try_begin),
            (eq, ":rand", 0),
            (jump_to_menu,"mnu_traicion_resultado5"),
          (else_try),
            (eq, ":rand", 1),
            (jump_to_menu,"mnu_traicion_resultado2"),
          (else_try),
            (eq, ":rand", 2),
            (jump_to_menu,"mnu_traicion_resultado3"),
          (else_try),
            (eq, ":rand", 3),
            (jump_to_menu,"mnu_traicion_resultado4"),
          (else_try),
            (jump_to_menu,"mnu_traicion_resultado1"),
          (try_end),
      ]),

      ####maniobras de infiltracion chief
      ("infiltracion_interna",
        [
          (party_get_slot, ":blockplace_place", "$g_encountered_party", slot_center_blockaded),
          (ge, ":blockplace_place", 1),
          (eq, "$g_infiltracion_interna", 0),
          (neq, "$g_traicion_interna", 1),
        ],
        "Send some men to infiltrate the place.",
        [
          (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
          (assign, ":num_men", 0),
          (try_for_range, ":i_stack", 0, ":num_stacks"),
            (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
            (val_add, ":num_men", ":stack_size"),
          (try_end),
          (try_begin),
            (gt, ":num_men", 30), # se muestra si el player tiene por lo menos 30 hombres
            (start_presentation,"prsnt_infiltrationandsabotage"),
            # (jump_to_menu,"mnu_infiltracion_interna2"),
          (else_try),
            (display_message,"@You need more than 30 men, or sending some will leave your camp somewhat unprotected."),
          (try_end),
      ]),

      ("infiltracion_interna3",[           (eq, "$g_infiltracion_interna", 2),
        ],
        "Any news from the men sent to infiltrate?", [
          (store_random_in_range, ":rand", 0, 4),
          (try_begin),
            (le, ":rand", 1),
            (try_begin),
              (party_slot_eq,"$g_encountered_party",slot_center_infiltration_type,1), #water
              (jump_to_menu,"mnu_infiltracion_resultado4_c"),
            (else_try),
              (party_slot_eq,"$g_encountered_party",slot_center_infiltration_type,2), #cattle
              (jump_to_menu,"mnu_infiltracion_resultado3_c"),
            (else_try),
              (party_slot_eq,"$g_encountered_party",slot_center_infiltration_type,3), #food
              (jump_to_menu,"mnu_infiltracion_resultado3"),
            (else_try),
              (party_slot_eq,"$g_encountered_party",slot_center_infiltration_type,4), #morale
              (jump_to_menu,"mnu_infiltracion_resultado4"),
            (else_try),
              (jump_to_menu,"mnu_infiltracion_resultado1"),
            (try_end),
          (else_try),
            (eq, ":rand", 2),
            (jump_to_menu,"mnu_infiltracion_resultado2"),
          (else_try),
            (eq, ":rand", 3),
            (jump_to_menu,"mnu_infiltracion_resultado5"),
          (else_try),
            (jump_to_menu,"mnu_infiltracion_resultado1"),
          (try_end),
      ]),
      ####maniobras de infiltracion chief acaba

      #####construir letrinas, canalizaciones para evitar acumulacion de barro con la lluvia, cavar pozos para suministro de agua
      ("build_varios",[
          #obtiene numero de hombres de el ejercito del player
          (eq, "$g_siege_saneamiento", 0),],
        "Order the construction of sanitation to prevent disease.", [
          (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
          (assign, ":num_men", 0),
          (try_for_range, ":i_stack", 0, ":num_stacks"),
            (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
            (val_add, ":num_men", ":stack_size"),
          (try_end),
          (try_begin),
            (gt, ":num_men", 10), # se muestra si el player tiene por lo menos 10 hombres
            ##                (store_current_hours, ":cur_hours"),
            ##                (party_set_slot, "$g_encountered_party", slot_center_latrines, ":cur_hours"),
            (jump_to_menu,"mnu_construct_saneamiento"),
          (else_try),
            (display_message,"@You need to have more than 10 men in order to do this job."),
          (try_end),
      ]),
      ####construir chief letrinas, canalizaciones y pozos acaba
      #destruir campos cercanos para obtener comida y empobrecer a la ciudad
      ("destruir_campos_a",[
          (eq, "$g_campos_cercanos", 0),],
        "Pillage farms to replenish your stocks and harm the enemy.", [
          (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
          (assign, ":num_men", 0),
          (try_for_range, ":i_stack", 0, ":num_stacks"),
            (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
            (val_add, ":num_men", ":stack_size"),
          (try_end),
          (try_begin),
            (gt, ":num_men", 80), # se muestra si el player tiene por lo menos 80 hombres
            (assign, "$g_campos_cercanos", 1),
          (else_try),
            (display_message,"@You need to have more than 80 men in order to do this."),
          (try_end),
      ]),

      ("destruir_campos_b",[
          (eq, "$g_campos_cercanos", 2),],
        "Any news from the men I sent to pillage farms?", [
          #          (store_current_month, ":cur_month"),
          (store_random_in_range, ":rand", 0, 3),
          (try_begin),
            (le, ":rand", 2),
            (try_begin),
              (this_or_next|eq, "$g_cur_month", 3),
              (this_or_next|eq, "$g_cur_month", 4),
              (eq, "$g_cur_month", 5),
              (jump_to_menu,"mnu_campos_cercanos1"),
            (else_try),
              (this_or_next|eq, "$g_cur_month", 9),
              (this_or_next|eq, "$g_cur_month", 10),
              (eq, "$g_cur_month", 11),
              (jump_to_menu,"mnu_campos_cercanos2"),
            (else_try),
              (this_or_next|eq, "$g_cur_month", 12),
              (this_or_next|eq, "$g_cur_month", 1),
              (eq, "$g_cur_month", 2),
              (jump_to_menu,"mnu_campos_cercanos3"),
            (else_try),
              (this_or_next|eq, "$g_cur_month", 6),
              (this_or_next|eq, "$g_cur_month", 7),
              (eq, "$g_cur_month", 8),
              (jump_to_menu,"mnu_campos_cercanos2_c"),
            (else_try),
              (jump_to_menu,"mnu_campos_cercanos4"),
            (try_end),
          (else_try),
            (jump_to_menu,"mnu_campos_cercanos4"),
          (try_end),
      ]),

      ("go_back",[],
        "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),

      ("testing",[(ge, "$cheat_mode", 1),],
        "Test siege event.", [(jump_to_menu,"mnu_siege_event_test")]),
    ]
  ),

  ###############assault
  (
    "siege_assault",0,
    "Time is of essence, and you fear the arrival of support force for the place. Assaulting will mean heavy casualties, but you have made up your mind.^^{s17} {s18} {s19}",
    "none",
    [

      (str_store_party_name,s4,"$current_town"),

      (str_clear, s17),
      (str_clear, s18),
      (str_clear, s19),
      ####listos para asalto
      (str_store_string,s17,"str_empty_string"),
      (try_begin),
        (neq, "$g_listos_para_asalto", 1),
        (eq, "$g_siege_method", 2),
        (str_store_string,s17,"@>>The assault equipment is ready. The troops await your orders.^^"),
      (else_try),
        (eq, "$g_listos_para_asalto", 1),
        (this_or_next|eq, "$g_cur_month", 3),
        (this_or_next|eq, "$g_cur_month", 4),
        (eq, "$g_cur_month", 5),
        (str_store_string,s17,"@>>You look at {s4}. Your men are silent while they await your order to attack. Your muscles are tense, hot for battle, but your mind is cold and adrenaline fills your veins^" +
        "A man breathes deeply. 'Do you smell that?' he asks, 'That is the scent of glory.' 'Are you ready to seize it?'^^"),
      (else_try),
        (ge, "$g_listos_para_asalto", 1),
        (this_or_next|eq, "$g_cur_month", 9),
        (this_or_next|eq, "$g_cur_month", 10),
        (eq, "$g_cur_month", 11),
        (str_store_string,s17,"@>>The steel of the weapons glitters, banners sway in the wind and horns sound. The men whisper, many pray, ingratiate themselves with their god before facing the end of their lives. Up ahead there are only two things: victory or death.^" +
        "War ... war never changes.^^"),
      (else_try),
        (ge, "$g_listos_para_asalto", 1),
        (this_or_next|eq, "$g_cur_month", 12),
        (this_or_next|eq, "$g_cur_month", 1),
        (eq, "$g_cur_month", 2),
        (str_store_string,s17,"@>>Winter is the worst time to fight, but there you are in the cold months, ready to undertake the conquest of {s4}. Many people think you're a daredevil, others a madman. But this place will be yours, soon.^^"),
      (else_try),
        (ge, "$g_listos_para_asalto", 1),
        (this_or_next|eq, "$g_cur_month", 6),
        (this_or_next|eq, "$g_cur_month", 7),
        (eq, "$g_cur_month", 8),
        (str_store_string,s17,"@>>It's summer and hot -- maybe too hot -- but, at that moment, you do not feel anything. As always before a battle, you set aside time for a few inevitable memories of the past... Then you close your mind and ready it for battle, preparing for even the worst case -- death.^^"),
      (else_try),
        (ge, "$g_listos_para_asalto", 1),
        (str_store_string,s17,"@>>You look at {s4}. Your men are silent while waiting for your order to charge towards death. Your muscles are tense, hot for battle, your mind cold and adrenaline fills your veins^" +
        "A man breathes deeply. 'Do you smell that?' he asks, 'That is the scent of glory.' 'Are you ready to seize it?'^^"),
      (try_end),

      (str_store_string,s18,"str_empty_string"),
      (try_begin),
        (ge, "$g_mantlets_1", 1),
        (party_get_slot, ":last_mantles_time", "$g_encountered_party", slot_center_mantlets_placed),
        (store_current_hours, ":cur_hours"),
        (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
        (assign, ":max_skill", reg0),
        (store_sub, reg4, 16, ":max_skill"),
        (val_mul, reg4, 2),
        (store_add, ":ok_time", ":last_mantles_time", reg4),#between 12 and 32 hours
        (gt, ":cur_hours", ":ok_time"),
        (str_store_string,s18,"@>>Your men have finished building the mantlets. Now you can use them to protect your soldiers in the vanguard attack, and your main force for the final charge.^^"),
        (assign, "$g_mantlets_1", 2), #final
      (else_try),
        (eq, "$g_mantlets_1", 1),
        (str_store_string,s18,"@>>Your men are building mantlets.^^"),
      (try_end),

      (str_store_string,s19,"str_empty_string"),
      (try_begin),
        (ge, "$g_siege_method", 1),

        (party_get_slot, ":last_ladders_time", "$g_encountered_party", slot_center_ladder_time),
        (store_current_hours, ":cur_hours"),
        (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
        (assign, ":max_skill", reg0),
        (store_sub, reg4, 16, ":max_skill"),
        (val_mul, reg4, 2),

        (store_add, ":ok_time", ":last_ladders_time", reg4), #between 24 and 64 hours
        (gt, ":cur_hours", ":ok_time"),
        (str_store_string,s19,"@>>Your men have finished building the ladders.^^"),
        (assign, "$g_siege_method", 2), #final
      (else_try),
        (eq, "$g_siege_method", 1),
        (str_store_string,s19,"@>>Your men are building assault ladders.^^"),
      (try_end),

      (call_script, "script_set_town_picture"),

      #Check for victory or defeat....
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (str_store_party_name, 1,"$g_encountered_party"),
      (call_script, "script_encounter_calculate_fit"),

      (assign, reg11, "$g_enemy_fit_for_battle"),
      (assign, reg10, "$g_friend_fit_for_battle"),

      (try_begin),
        (eq, "$g_leave_encounter",1),
        (change_screen_return),
      (else_try),
        (call_script, "script_party_count_fit_regulars","p_collective_enemy"),
        (assign, ":enemy_finished", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (assign, ":enemy_finished", 1),
        (else_try),
          (this_or_next|le, "$g_enemy_fit_for_battle",0),
          (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #we do not want routed agents to spawn again in next turn of battle.
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":enemy_finished", 1),
        (try_end),

        (this_or_next|eq, ":enemy_finished", 1),
        (eq, "$g_enemy_surrenders", 1),
        #siege warfare chief
        (assign, "$g_empieza_asedio", 0),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
        (try_begin),
            (troop_slot_ge, "trp_global_variables", g_player_trench, 1),
            (troop_set_slot, "trp_global_variables", g_player_trench, 0),
            (display_message, "@Fortifications are destroyed.", message_alert), #SB : colorize
        (try_end),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
        (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
        (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
        (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
        (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),

        (assign, "$g_siege_saneamiento", 0),
        (assign, "$g_traicion_interna", 0),
        (assign, "$g_infiltracion_interna", 0),
        (assign, "$g_campos_cercanos", 0),
        (assign, "$g_listos_para_asalto", 0),
        (assign, "$g_mantlets_1", 0),
        (assign, "$g_cabezas_dentro", 0), #event
        (assign, "$g_siege_method", 0),
        (assign, "$g_siege_sallied_out_once", 0),
        (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
        (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
        #siege warfare acaba

        (assign, "$g_next_menu", "mnu_castle_taken"),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":main_party_fit_regulars", reg0),
        (eq, "$g_battle_result", -1),
        (this_or_next|eq, ":main_party_fit_regulars", 0), #all lost (TODO : )
        (le, ":main_party_fit_regulars",  "$num_routed_allies"), #we do not want routed agents to spawn again in next turn of battle.
        (assign, "$g_next_menu", "mnu_captivity_start_castle_defeat"),
        #siege warfare chief
        (assign, "$g_empieza_asedio", 0),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
        (try_begin),
            (troop_slot_ge, "trp_global_variables", g_player_trench, 1),
            (troop_set_slot, "trp_global_variables", g_player_trench, 0),
            (display_message, "@Fortifications are destroyed.", message_alert), #SB : colorize
        (try_end),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
        (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
        (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
        (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
        (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),

        (assign, "$g_siege_saneamiento", 0),
        (assign, "$g_traicion_interna", 0),
        (assign, "$g_infiltracion_interna", 0),
        (assign, "$g_campos_cercanos", 0),
        (assign, "$g_listos_para_asalto", 0),
        (assign, "$g_mantlets_1", 0),
        (assign, "$g_cabezas_dentro", 0), #event
        (assign, "$g_siege_method", 0),
        (assign, "$g_siege_sallied_out_once", 0),
        (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
        (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
        #siege warfare acaba
        (jump_to_menu, "mnu_total_defeat"),
      (try_end),
    ],
    [
      #####scout da pinceladas
      ("scout_investigar",
        [
        ],
        "Call the scouts for a report on {s4}.",
        [
          (jump_to_menu,"mnu_informacion_ciudad"),
      ]),

      ("poniendo_elementos_mantles",
        [(eq, "$g_mantlets_1", 2),
          (neq, "$g_listos_para_asalto", 1),
          (ge, "$g_siege_method", 2),
          (gt, "$g_friend_fit_for_battle", 3),
          ##         (store_current_hours, ":cur_hours"),
          ##         (ge, ":cur_hours",  "$g_siege_method_finish_hours"),
        ],
        "Order the vanguard to place the mantlets.", [(assign, "$cant_talk_to_enemy", 0),(jump_to_menu,"mnu_poner_escaleras_mantlets")]),

      ("poniendo_elementos",
        [(neq, "$g_mantlets_1", 2),
          (neq, "$g_listos_para_asalto", 1),
          (ge, "$g_siege_method", 2),
          (gt, "$g_friend_fit_for_battle", 3),
          ##         (store_current_hours, ":cur_hours"),
          ##         (ge, ":cur_hours",  "$g_siege_method_finish_hours"),
        ],
        "Order the vanguard to prepare the assault.", [(assign, "$cant_talk_to_enemy", 0),(jump_to_menu,"mnu_poner_escaleras")]),

      ("castle_lead_attack",
        [
          (neg|troop_is_wounded, "trp_player"),
          (eq, "$g_listos_para_asalto", 1),
          (ge, "$g_siege_method", 2),
          (gt, "$g_friend_fit_for_battle", 3),
        ],
        "The hour has arrived. Lead your soldiers in assault!",
        [
          (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
            (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
          (else_try),
            (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
          (try_end),

          (call_script, "script_calculate_renown_value"),
          (call_script, "script_calculate_battle_advantage"),
          (assign, ":battle_advantage", reg0),
          (val_mul, ":battle_advantage", 2),
          (val_div, ":battle_advantage", 3), #scale down the advantage a bit in sieges.
          (set_battle_advantage, ":battle_advantage"),
          (set_party_battle_mode),
          (assign, "$g_siege_battle_state", 1),
          (assign, ":siege_sally", 0),
          (try_begin),
            (le, ":battle_advantage", -6), #we are outnumbered, defenders sally out
            (eq, "$g_siege_sallied_out_once", 0),
            (set_jump_mission,"mt_castle_attack_walls_defenders_sally"),
            (assign, "$g_siege_battle_state", 0),
            (assign, ":siege_sally", 1),
          (else_try),
            (assign, "$temp4", 0),
            (set_jump_mission,"mt_castle_attack_walls_ladder"),
          (try_end),
          (assign, "$cant_talk_to_enemy", 0),
          (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
          (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
          (assign, "$g_siege_method", 0), #reset siege timer
          (try_begin),
            (eq, ":siege_sally", 1),
            (call_script, "script_setup_random_scene"),
            (jump_to_menu, "mnu_siege_attack_meets_sally"),
          (else_try),
            (jump_to_scene,":battle_scene"),
            (jump_to_menu, "mnu_battle_debrief"),
            (change_screen_mission),
          (try_end),
      ]),
      ("attack_stay_back",
        [
          (eq, "$g_listos_para_asalto", 1),
          (ge, "$g_siege_method", 2),
          (gt, "$g_friend_fit_for_battle", 3),
        ],
        "Order your soldiers to assault while you stay back...", [(assign, "$cant_talk_to_enemy", 0),(jump_to_menu,"mnu_castle_attack_walls_simulate2")]),

      ("build_mantlet",
        [           (eq, "$g_mantlets_1", 0),
          (neq, "$g_siege_method", 1),
        ],
        "Build mantlets.",
        [
          (jump_to_menu,"mnu_build_mantles2"),
          ##                        (assign, "$g_mantlets_1", 1),
          ##                (store_current_hours, ":cur_hours"),
          ##                (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, ":cur_hours"),
      ]),
      #siege warfare ram
      ("build_ladders",[
          (eq, "$g_siege_method", 0),
          (neq, "$g_mantlets_1", 1),],
        "Build equipment and clear the ground for assault.", [(jump_to_menu,"mnu_construct_ladders")]),

      ##no siege towers in dark ages
      # ("build_siege_tower",[(party_slot_eq, "$current_town", slot_center_siege_with_belfry, 1),(eq, "$g_siege_method", 0)],
        # "Build a siege tower and other equipment to assault the fortress. Assaults may result in many casualties.", [(jump_to_menu,"mnu_construct_siege_tower")]),
      ###siege warfare ram chief
      ##                   ("build_battering_ram", [(party_slot_eq, "$current_town", slot_center_siege_with_ram, 1),
      ##	                           (eq, "$g_siege_method", 0)],
      ##       "Build a battering ram and equipment to prepare the assault on the fortress . Assaults are unpredictable, and may result in many casualties.", [(jump_to_menu,"mnu_battering_ram")]),
      ###siege warfare ram acaba
      ("cheat_castle_lead_attack",[(eq, "$cheat_mode", 1),
          (eq, "$g_siege_method", 0)],
        "{!}CHEAT: Instant build equipments.",
        [
          (assign, "$g_mantlets_1", 2),
          (assign, "$g_siege_method", 1),
          (assign, "$g_siege_method_finish_hours", 0),
          (jump_to_menu, "mnu_castle_besiege"),
      ]),

      ("cheat_conquer_castle",[(eq, "$cheat_mode", 1),
        ],
        "{!}CHEAT: Instant conquer fortress.",
        [
          (assign, "$g_next_menu", "mnu_castle_taken"),
          (jump_to_menu, "mnu_total_victory"),
      ]),

      ("go_back",[],
        "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),
    ]
  ),

  #####Siege warfare acaba

  #########

  (
    "siege_attack_meets_sally",0,
    "The defenders sally out to meet your assault.",
    "none",
    [
      (set_background_mesh, "mesh_pic_sally_out"),
    ],
    [
      ("continue",[],
        "Continue...",
        [
          (jump_to_menu, "mnu_battle_debrief"),
          (change_screen_mission),
      ]),
    ]
  ),

  #######siege warfare
  #Low food = sally out
  (
    "nofood_siege_defenders_sally",0,
    "The lack of food forces the desperate defenders of {s4} to sally out in an attempt to break the siege.",
    "none",
    [
      (set_background_mesh, "mesh_pic_sally_out"),
      (str_store_party_name,s4,"$current_town"),
    ],
    [
      ("continue",[],
        "Continue...",
        [
          (jump_to_menu, "mnu_battle_debrief"),
          (change_screen_mission),
      ]),
    ]
  ),

  #surrender for hunger
  (
    "surrender_siege_defenders_starved",0,
    "The defenders of {s4} can hold out no longer. Lack of food has debilitated them. Already the weakest have died of starvation, and in some cases, the need has led to cannibalism.^" +
    "{s4} is ready to surrender...",
    "none",
    [
      (set_background_mesh, "mesh_pic_victory"),
      (str_store_party_name,s4,"$current_town"),
    ],
    [
      ("continue",[],
        "Continue...",
        [
          (assign, "$g_enemy_surrenders",1),
          (jump_to_menu, "mnu_castle_besiege"), #
      ]),
    ]
  ),
  ############
  ####SIEGE WARFARE CHIEF menus extras
  (
    "castle_attack_walls_simulate2",mnf_disable_all_keys, #vanguardia
    "{s4}^^Your casualties: {s8}^^Enemy casualties: {s10}",
    "none",
    [
      (set_background_mesh, "mesh_pic_siege_sighted"),

      (try_begin), ###siege warfare
        (eq, "$g_mantlets_1", 2),
        (call_script, "script_simulate_battle_with_parties", 1, "$g_enemy_party", 5, 0, 0), ###less difficult
      (else_try),
        (call_script, "script_simulate_battle_with_parties", 2, "$g_enemy_party", 7, 0, 0),
      (try_end),

      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0), #(TODO : compare with num_routed_us)
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_attack_walls_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (le, reg0, 0), #(TODO : compare with num_routed_enemies)
        (assign, "$no_soldiers_left", 1),
        (assign, "$g_battle_result", 1),
        (str_store_string, s4, "str_attack_walls_success"),
      (else_try),
        (str_store_string, s4, "str_attack_walls_continue"),
      (try_end),
    ],
    [
      ("continue",[],"Continue...",[(jump_to_menu,"mnu_siege_assault")]),
    ]
  ),

  (
    "sneak_into_town_suceeded2",0,
    "Disguised and under the cover of darkness, you infiltrate {s4}. It's time to scout out their defenses.",
    "none",
    [
      (str_store_party_name,s4,"$current_town"),
    ],
    [
      ("continue",[],"Continue...",
        [
          (assign, "$sneaked_into_town",1),
          (jump_to_menu,"mnu_town"),
      ]),
    ]
  ),

  #labores de saneamiento chief
  (
    "construct_saneamiento",0,
    "Sanitation is important for preventing rats and disease. It is possible to construct latrines and pipelines to prevent the accumulation of mud and filth from the rain, and dig a reservoir to have an available water supply. Do you want to do it?^" +
    "It will take 4 hours.",
    "none",
    [

    ],
    [
      ("build_saneamiento",[],
        "Do it.", [
          (assign, "$g_siege_saneamiento", 1),
          (store_current_hours, ":cur_hours"),
          (party_set_slot, "$g_encountered_party", slot_center_latrines, ":cur_hours"),
          (call_script, "script_change_player_party_morale", -3),
          (assign, "$g_siege_saneamiento", 2), #fix problem with saneamiento.
          (jump_to_menu,"mnu_siege_plan")
      ]),
      ("go_back",[],
        "Go back.", [(jump_to_menu,"mnu_siege_plan")]),
    ],
  ),
  #saneamiento acaba
  ###block place
  (
    "construct_circunvalation",0,
    "Blockading a place protects your troops during the siege, helps to avoid some enemy skirmishers, and prevents the entry of food and reinforcements. " +
    "It also lowers enemy's morale and helps you negotiate the surrender of the place.^^" +
    "As the party member with the highest Engineer skill, ({reg2}), {reg3?you estimate:{s3} estimates} that building the blockade around the place will take {reg4} hours.",
    "none",
    [
      (set_background_mesh, "mesh_pic_siege_sighted"),

      (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
      (assign, ":max_skill", reg0),
      (assign, ":max_skill_owner", reg1),
      (assign, reg2, ":max_skill"),

      (store_sub, reg4, 16, ":max_skill"),
      (val_mul, reg4, 4),#between 24 and 64 hours

      (try_begin),
        (eq, ":max_skill_owner", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":max_skill_owner"),
      (try_end),
    ],
    [
      ("build_circun_cont",[],
        "Do it.", [
          (party_set_slot,"$g_encountered_party",slot_center_blockaded,1),
          (store_current_hours, ":cur_hours"),
          (party_set_slot, "$g_encountered_party", slot_center_blockaded_time, ":cur_hours"),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
      ("go_back",[],
        "Go back.", [(jump_to_menu,"mnu_siege_plan")]),
    ],
  ),

  ##########
  ("traicion_interna2",0,
    "Your siege works begin to demoralize the defenders. Some of your soldiers are willing to contact the garrison or the inhabitants at {s4} and probe if someone would be willing to commit treason and facilitate the conquest. They need 500 denars for the job.",
    "none",
    [
      (str_store_party_name,s4,"$current_town"),
    ],
    [
      ("intentar_traicion",[],
        "Allow these men to seek out a traitor.", [
          (store_troop_gold,":money","trp_player"),
          (try_begin),
            (gt,":money",499),
            (troop_remove_gold, "trp_player", 500),
            (assign, "$g_traicion_interna", 1),
            (jump_to_menu,"mnu_siege_plan"),
          (else_try),
            (display_message,"str_no_money"),
          (try_end),
      ]),
      ("go_back",[],
        "Go back.", [(jump_to_menu,"mnu_siege_plan")]),
    ],
  ),

  ####traicion interna
  ("traicion_resultado1",0,
    "They returned without news. No one is willing to become a traitor.",
    "none", [
    ],
    [
      ("back_behind",[],"Well, bad luck.",
        [
          (assign, "$g_traicion_interna", 3),#failed
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

  ("traicion_resultado2",0,
    "Sir! Our men have been discovered near the wall. They are fighting their way out of {s4}. Look over there at the sally port. They are trying to flee, but are surrounded...",
    "none",
    [

      (str_store_party_name,s4,"$current_town"),
    ],
    [
      ("ayudar_infiltrados",[],"Order: send an additional group of men to their aid.",
        [
          (jump_to_menu,"mnu_traicion_lucha"),
      ]),
      ("leave_men",[],"Leave the men to their fate. They knew what was coming.",
        [
          (call_script, "script_change_player_honor", -5),
          (call_script, "script_change_player_party_morale", -6),
          (assign, "$g_traicion_interna", 3), #failed
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

  ("traicion_resultado3",0,
    "Your men have returned. A traitor within the place has set barns ablaze and will soon flee {s4} and join your army. The enemy will lose much of their food stock because of that.",
    "none", [
      (str_store_party_name,s4,"$current_town"),
    ],
    [("back_to_siege",[],"Well done.",
        [
          (party_get_slot,":cur_food","$g_encountered_party",slot_party_food_store),
          (try_begin),
            (ge,":cur_food",4),
            (store_random_in_range,":burned",40,50),
            (val_mul,":cur_food",100),
            (val_add,":burned",100),
            (val_div,":cur_food",":burned"),
            (party_set_slot,"$g_encountered_party",slot_party_food_store,":cur_food"),
            (str_store_party_name,s4,"$g_encountered_party"),
            (display_message, "@{s4} lost between 40 and 50% of its food reserves.", 0xFF0000),
          (try_end),
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -5),
          (party_add_members, "p_main_party", "trp_watchman", 1),
          (assign, "$g_traicion_interna", 4), #success
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

  ("traicion_resultado4",0,
    "Your men have returned. They report there is a traitor who knows the routines of the garrison, and he is willing to lead a small force to ambush the enemy when they come to the water supplies, a nearby stream outside the walls...",
    "none", [ ],
    [
      ("atacar_emboscada_player",[],"Go yourself with your closest companions.",
        [
          (try_begin),
            (store_troop_health, ":health", "trp_player", 0), #get relative health in 1-100 range and put it into the ":health" variable
            (lt, ":health", 30),
            (val_add, ":health", 35),               #add to it the 5%
            (troop_set_health,   "trp_player", ":health"),   #set it
          (try_end),

          (store_random_in_range, ":scene_a_usar", 0,3),
          (try_begin),
            (eq, ":scene_a_usar", 1),
            (assign, ":scene_to_use", "scn_river_ambush_1"),
          (else_try),
            (eq, ":scene_a_usar", 2),
            (assign, ":scene_to_use", "scn_river_ambush_2"),
          (else_try),
            (assign, ":scene_to_use", "scn_river_ambush_3"),
          (try_end),

          (set_jump_mission,"mt_ambush_riversw"),
          (modify_visitors_at_site,":scene_to_use"),
          #### tropas cambiar por las del asentamiento
          (assign, "$g_traicion_interna", 4), #success
          (reset_visitors, 0),
          (set_visitor,0,"trp_player"), #player
          (assign, ":cur_entry", 1),
          (try_for_range, ":companion", companions_begin, companions_end),
            (lt, ":cur_entry", 16),
            (main_party_has_troop,":companion"),
            (set_visitor, ":cur_entry", ":companion"),
            (val_add, ":cur_entry", 1),
          (try_end),

          (assign, ":num_troops", 8),
          (try_for_range, ":unused", 0, ":num_troops"),
            (call_script, "script_cf_party_remove_random_regular_troop", "$g_encountered_party"),
            (assign, ":lost_troop", reg0),
            #(try_for_range, ":visiterator", 17, 18), #possible 17 and 31, but this add 8 enemies each 1 entry point
            (assign, ":visiterator", 17),
            (set_visitor, ":visiterator", ":lost_troop"),
            #  (try_end),
          (try_end),
          (jump_to_scene,":scene_to_use"),
          (change_screen_mission),
      ]),

      ("atacar_emboscada",[],"Order: send a group of men with the traitor to carry out the ambush.",
        [
          (store_random_in_range, ":rand", 0, 3),
          (try_begin),
            (eq, ":rand", 0),
            (jump_to_menu,"mnu_emboscada_victory"),
          (else_try),
            (eq, ":rand", 1),
            (jump_to_menu,"mnu_emboscada_lose"),
          (else_try),
            (jump_to_menu,"mnu_emboscada_nada"),
          (try_end),
      ]),
      ("leave_men",[],"It makes me uneasy. Forget about it.",
        [
          # (assign, "$g_traicion_interna", 0),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),
  #resultado
  ("emboscada_player",0,
    "Moving through the vegetation, you have taken your enemies by surprise and have given a good account of yourselves. Now the garrison will think twice before sending men out.",
    "none", [ (set_background_mesh, "mesh_pic_mb_warrior_3"),
    ],
    [
      ("emboscada_playerok",[],"Victory!",
        [
        (leave_encounter),
        (jump_to_menu, "mnu_auto_return_map"),
      ]),
    ],
  ),
  #
  ("emboscada_nada",0,
    "Your men move under the cover of the vegetation, away from the watchful eyes on the wall, but when they come to the meeting point, there is nobody. The alleged traitor has been discovered or has repented. Your men return disappointed.",
    "none", [ (set_background_mesh, "mesh_pic_mb_warrior_3"),
    ],
    [
      ("emboscada_nanai",[],"Do not worry. There will be another chance.",
        [
          (assign, "$g_traicion_interna", 3), #failed
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),
  #
  ("emboscada_lose",0,
    "Alarm! Treason! The alleged traitor led your men into an ambush. They are fighting desperately, leaving many men on the field.",
    "none", [ (set_background_mesh, "mesh_pic_mb_warrior_3"),
      (store_random_in_range, ":p_leave", 8, 12),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
      (try_end),
    ],
    [("regreso_lucha",[],"Your worst fears have come true.",
        [
          (assign, "$g_traicion_interna", 3), #failed
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

  ("emboscada_victory",0,
    "The traitor leads your men through the night to a hill that controls the path to a well. Your men take up positions in the vegetation, in silence, their faces stained black. At daybreak, your men spot a large group of enemies by the water.^^A battle cry fills the valley as your soldiers fall like a tide of death on the enemy... killing many.",
    "none", [ (set_background_mesh, "mesh_pic_mb_warrior_3"),

      (store_random_in_range, ":p_leave", 8, 12),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "$g_encountered_party"),
      (try_end),
    ],

    [("regreso_lucha",[],"Victory!",
        [
          (call_script, "script_change_player_party_morale", 3),
          (assign, "$g_traicion_interna", 4), #success
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),
  #
  ("traicion_resultado5",0,
    "When your men come back, they tell you they have contacted a man who is in control of rations, and he has promised to raise the price of food to his fellow citizens to sow discontent, making them more likely to abandon the fortress.",
    "none", [
    ],

    [("traicion_moral",[],"Perfect!",
        [
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -5),

          (store_random_in_range, ":p_leave", 8, 22),
          (assign, ":num_troops", ":p_leave"),
          (try_for_range, ":unused", 0, ":num_troops"),
            (call_script, "script_cf_party_remove_random_regular_troop", "$g_encountered_party"),
          (try_end),
          (assign, "$g_traicion_interna", 4), #success
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

  #traicion interna
  ("traicion_lucha",0,
    "Your men and the enemy fight to the death at the foot of the wall, where everything is unfavorable to your troops. You watch them fighting and retreating towards you. Many bodies are left behind. " +
    "^^Your casualties: {s8}^^Enemy casualties: {s10}",
    "none", [
      (call_script, "script_simulate_battle_with_parties", 11, "$g_enemy_party", 56, 0, 0),
    ],

    [("regreso_luchar",[],"Well, no one gets left behind.",
        [
          (call_script, "script_change_player_honor", 5),
          (call_script, "script_change_player_party_morale", 5),
          (assign, "$g_traicion_interna", 3), #failed
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),
  ####infiltracion interna chief
  ("infiltracion_resultado1",0,
    "They returned without news. They were unable to enter the settlement.",
    "none", [
    ],
    [
      ("back_behindi",[],"Just bad luck, I guess.",
        [
          (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
          (assign, "$g_infiltracion_interna", 3),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

  ("infiltracion_resultado2",0,
    "Sir! Our men have been discovered in {s4}. Unfortunately, none have returned. They were all killed or captured.",
    "none",
    [

      (str_store_party_name,s4,"$current_town"),
    ],
    [
      ("muertos_infiltrado",[],"Terrible news.",
        [
          (call_script, "script_change_player_party_morale", -5),

          (store_random_in_range, ":p_leave", 18, 22),
          (assign, ":num_troops", ":p_leave"),
          (try_for_range, ":unused", 0, ":num_troops"),
            (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
            (assign, ":lost_troop", reg0),
            (store_random_in_range, ":random_no", 0, 100),
            (ge, ":random_no", 50),
            (party_add_prisoners, "$g_encountered_party", ":lost_troop", 1),
          (try_end),

          (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
          (assign, "$g_infiltracion_interna", 3),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

  ("infiltracion_resultado3",0,
    "Victory! They have managed to burn several food stores. The enemy is demoralized. Perhaps it is time to request their surrender.",
    "none", [ ],

    [("back_to_siegei",[],"Well, give them a barrel of mead.",
        [
          (party_get_slot,":cur_food","$g_encountered_party",slot_party_food_store),
          (try_begin),
            (ge,":cur_food",4),
            (store_random_in_range,":burned",50,60),
            (val_mul,":cur_food",100),
            (val_add,":burned",100),
            (val_div,":cur_food",":burned"),
            (party_set_slot,"$g_encountered_party",slot_party_food_store,":cur_food"),
            (str_store_party_name,s4,"$g_encountered_party"),
            (display_message, "@{s4} lost between 50 and 60% of its food reserves.", 0xFF0000),
          (try_end),
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -5),
          (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
          (assign, "$g_infiltracion_interna", 4),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

  ("infiltracion_resultado3_c",0,
    "Victory! They killed many cattle and contaminated the water reserves. The enemy is demoralized and their lord has lost some renown. Perhaps it is time to request their surrender.",
    "none", [ ],

    [("back_to_siegein",[],"Well, give them a barrel of mead.",
        [
          (party_get_slot,":cur_food","$g_encountered_party",slot_party_food_store),
          (try_begin),
            (ge,":cur_food",4),
            (store_random_in_range,":burned",30,40),
            (val_mul,":cur_food",100),
            (val_add,":burned",100),
            (val_div,":cur_food",":burned"),
            (party_set_slot,"$g_encountered_party",slot_party_food_store,":cur_food"),
            (str_store_party_name,s4,"$g_encountered_party"),
            (display_message, "@{s4} lost between 30 and 40% of its food reserves.", 0xFF0000),
          (try_end),
          (party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
          (call_script, "script_change_troop_renown", ":town_lord", -15),
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -10),
          (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
          (assign, "$g_infiltracion_interna", 4),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

("infiltracion_resultado4",0,
  "Your men have returned. They said that some warriors are dissatisfied, and some were persuaded to switch to your side. If you agree, they will leave the city at night and join your army. Before they leave, they promise to cause unrest to facilitate the surrender of the place.",
  "none", [
  ],[
    ("aceptar_si",[],"They are welcome.",[
      (store_random_in_range, ":p_leave", 4, 12),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "$g_encountered_party"),
        (assign, ":lost_troop", reg0),
        (party_add_members, "p_main_party", ":lost_troop", 1),
      (try_end),

      (party_get_slot,":cur_food","$g_encountered_party",slot_party_food_store),
      (try_begin),
        (ge,":cur_food",4),
        (store_random_in_range,":burned",10,20),
        (val_mul,":cur_food",100),
        (val_add,":burned",100),
        (val_div,":cur_food",":burned"),
        (party_set_slot,"$g_encountered_party",slot_party_food_store,":cur_food"),
        (str_store_party_name,s4,"$g_encountered_party"),
        (display_message, "@{s4} lost between 10 and 20% of its food reserves.", 0xFF0000),
      (try_end),
      (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
      (assign, "$g_infiltracion_interna", 4),
      (jump_to_menu,"mnu_siege_plan"),
    ]),
    ("leave_men1",[],"It makes me uneasy. Forget about it.",[
      (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
      (assign, "$g_infiltracion_interna", 0),
      (jump_to_menu,"mnu_siege_plan"),
    ]),
  ]),

("infiltracion_resultado4_c",0,
  "Your men have returned. They said that they poisoned the water of some wells and nearby streams. This should sicken many in the garrison.",
  "none", [
    (set_background_mesh, "mesh_pic_siege_sighted"),
  ],[
    ("aceptar_oki",[],"That's good news. It will leave fewer men to defend the wall.",[
      (assign,":party_no","$g_encountered_party"),
      (party_get_num_companion_stacks, ":num_stacks",":party_no"),
      (party_get_slot,":party_type",":party_no",slot_party_type),
      # (assign,":max_no",60),
      (assign,":start_troop",0),
      (try_begin),
        (eq,":party_type",3), #town
        (assign,":max_no",300), #30%
        (call_script, "script_change_center_prosperity", ":party_no", -5),
      (else_try),
        #(eq,":party_type",2), #fort
        (assign,":max_no",200), #20%
        (call_script, "script_change_center_prosperity", ":party_no", -3),
      (try_end),
      (party_get_slot, ":food_stores", ":party_no", slot_party_food_store),
      (call_script, "script_center_get_food_store_limit", ":party_no"),
      (val_min, ":food_stores", reg0),
      (party_set_slot, ":party_no", slot_party_food_store, ":food_stores"),
      (try_for_range, ":stack_no", ":start_troop", ":num_stacks"),
        (party_stack_get_troop_id,":cur_troop_id",":party_no",":stack_no"),
        (party_stack_get_size,":num_troops",":party_no",":stack_no"),
        (store_random_in_range,":percentage_wounded",100,":max_no"), #10% wounds - 10 to 20 0 30 depend on center type
        (store_mul,":damage",":num_troops",":percentage_wounded"),
        (val_div, ":damage", 1000),
        (party_wound_members,":party_no",":cur_troop_id",":damage"),
      (try_end),
      (str_store_party_name,s4,"$g_encountered_party"),
      (display_message, "@{s4} have between 10 and 30% of its garrison sick for a few days.", 0xFF0000),
      (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
      (assign, "$g_infiltracion_interna", 4),
      (jump_to_menu,"mnu_siege_plan"),
    ]),
]),

  ("infiltracion_resultado5",0,
    "Oh, sir. The enemy has sent a bag with the heads of your men. Some of our soldiers have seen it, and fear runs through the camp.",
    "none", [
    ],

    [
      ("infiltracion_morali",[],"Cowards! How can a couple of heads sink the morale of an army? Are they cattle or men?",
        [
          (call_script, "script_change_player_party_morale", -10),

          (store_random_in_range, ":p_leave", 18, 22),
          (assign, ":num_troops", ":p_leave"),
          (try_for_range, ":unused", 0, ":num_troops"),
            (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
          (try_end),

          (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
          (assign, "$g_infiltracion_interna", 0),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
      ("infiltracion_morali",[],"Avenge the insult to us!",
        [
          (call_script, "script_change_player_party_morale", -5),
          (call_script, "script_change_troop_renown", "trp_player", -10),

          (store_random_in_range, ":p_leave", 18, 22),
          (assign, ":num_troops", ":p_leave"),
          (try_for_range, ":unused", 0, ":num_troops"),
            (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
          (try_end),

          (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
          (assign, "$g_infiltracion_interna", 3),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),
  ###infiltracion interna acaba

  ###recogida y siembra de cosechas
  ("campos_cercanos1",0,
    "Commander, crops and farms were burned, but since this is not the harvest season, it wasn't possible to get food.",
    "none", [ (set_background_mesh, "mesh_pic_messenger"),
    ],
    [
      ("back_behind_d",[],"Well done, do not worry.",
        [
          (assign, "$g_campos_cercanos", 3),
          (call_script, "script_change_player_honor", -5),
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -3),
          (call_script, "script_change_player_relation_with_center", "$current_town", -5),
          (party_get_slot, ":food_stores", "$g_encountered_party", slot_party_food_store),
          (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
          (val_min, ":food_stores", reg0),
          (party_set_slot, "$g_encountered_party", slot_party_food_store, ":food_stores"),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),
  ("campos_cercanos2",0,
    "Commander, crops and farms were burned, and as it is the harvest season, we found an abundance of food.",
    "none", [ (set_background_mesh, "mesh_pic_messenger"),
    ],
    [
      ("back_behind_c",[],"Well done, food is always welcome.",
        [
          (assign, "$g_campos_cercanos", 3),
          (call_script, "script_change_player_honor", -5),
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -20),
          (call_script, "script_change_player_relation_with_center", "$current_town", -10),
          (troop_add_item, "trp_player","itm_grain",0),
          (troop_add_item, "trp_player","itm_grain",0),
          (troop_add_item, "trp_player","itm_grain",0),
          (troop_add_item, "trp_player","itm_grain",0),
          (troop_add_item, "trp_player","itm_grain",0),
          (troop_add_item, "trp_player","itm_cattle_meat",0),
          (party_get_slot, ":food_stores", "$g_encountered_party", slot_party_food_store),
          (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
          (val_min, ":food_stores", reg0),
          (party_set_slot, "$g_encountered_party", slot_party_food_store, ":food_stores"),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),
  ("campos_cercanos2_c",0,
    "Commander, crops and farms were burned. The grain is still green, but edible. We found an abundance of food.",
    "none", [ (set_background_mesh, "mesh_pic_messenger"),
    ],
    [
      ("back_behind_cc",[],"Well done, food always is welcome.",
        [
          (assign, "$g_campos_cercanos", 3),
          (call_script, "script_change_player_honor", -5),
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -10),
          (call_script, "script_change_player_relation_with_center", "$current_town", -10),
          (troop_add_item, "trp_player","itm_grain",0),
          (troop_add_item, "trp_player","itm_grain",0),
          (troop_add_item, "trp_player","itm_grain",0),
          (party_get_slot, ":food_stores", "$g_encountered_party", slot_party_food_store),
          (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
          (val_min, ":food_stores", reg0),
          (party_set_slot, "$g_encountered_party", slot_party_food_store, ":food_stores"),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),
  ("campos_cercanos3",0,
    "Commander, we burned the fields, but as it is after the harvest time, there was no grain left. However, the farmers have left some of their cattle behind.",
    "none", [ (set_background_mesh, "mesh_pic_messenger"),
    ],
    [
      ("back_behind_bc",[],"Food is always welcome.",
        [
          (assign, "$g_campos_cercanos", 3),
          (call_script, "script_change_player_honor", -5),
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -10),
          (call_script, "script_change_player_relation_with_center", "$current_town", -10),
          (troop_add_item, "trp_player","itm_pork",0),
          (troop_add_item, "trp_player","itm_pork",0),
          (troop_add_item, "trp_player","itm_pork",0),
          (troop_add_item, "trp_player","itm_cattle_meat",0),
          (troop_add_item, "trp_player","itm_chicken",0),
          (troop_add_item, "trp_player","itm_cattle_meat",0),
          (party_get_slot, ":food_stores", "$g_encountered_party", slot_party_food_store),
          (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
          (val_min, ":food_stores", reg0),
          (party_set_slot, "$g_encountered_party", slot_party_food_store, ":food_stores"),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

  ("campos_cercanos4",0,
    "We have encountered problems. The fields were burned, but the farmers struck back with support from some members of the garrison.^^Your casualties: {s8}^^Enemy casualties: {s10}",
    "none", [
      (set_background_mesh, "mesh_pic_messenger"),
      (call_script, "script_simulate_battle_with_parties", 23, "$g_enemy_party", 68, 0, 0),
    ],
    [
      ("back_behind_ac",[],"Terrible news!",
        [
          (assign, "$g_campos_cercanos", 3),
          (call_script, "script_change_player_party_morale", -5),
          (call_script, "script_change_player_honor", -5),
          (call_script, "script_change_player_relation_with_center", "$current_town", -5),
          (jump_to_menu,"mnu_siege_plan"),
      ]),
    ],
  ),

  ("poner_escaleras",0, #no mantles
    "Your vanguard advances, bringing ladders, shovels and other useful siege equipment... A display of men armed with ranged weapons goes forth, attracting the enemy's missiles. Your heart races in its bony cage. Somehow, all battles seem to be the first.^" +
    "The thrill, terror and sweat are there, always. Your men make a shield formation to protect themselves...^^Your casualties: {s8}^^Enemy casualties: {s10}",
    "none", [ (set_background_mesh, "mesh_pic_siege_sighted"),
      (call_script, "script_simulate_battle_with_parties", 25, "$g_enemy_party", 90, 0, 0),
      #
    ],
    [
      ("back_behind_esc1",[],"Your men have met the enemy. It is your turn...",
        [
          (assign, "$g_listos_para_asalto", 1),
          (jump_to_menu,"mnu_siege_assault"),
      ]),
    ],
  ),

  ("poner_escaleras_mantlets",0, #mantles
    "Your vanguard advances, bringing ladders, mantlets, shovels and other useful siege equipment... A display of men armed with ranged weapons goes forth, guarded by mantlets, attracting the enemy's missiles. Your heart races in its bony cage. Somehow, all battles seem to be the first.^" +
    "The thrill, terror and sweat are there, always. Your men make a shield formation to protect themselves, and using the mantlets saves still more lives. " +
    "^^Your casualties: {s8}^^Enemy casualties: {s10}",
    "none", [ (set_background_mesh, "mesh_pic_siege_sighted"),
      (call_script, "script_simulate_battle_with_parties", 41, "$g_enemy_party", 90, 0, 0),
    ],
    [
      ("back_behind_esc2",[],"Your men have met the enemy. It is your time...",
        [
          (assign, "$g_listos_para_asalto", 1),
          (jump_to_menu,"mnu_siege_assault"),
      ]),
    ],
  ),

  ####
  #####scout reporta datos de ciudad
("informacion_ciudad",0,#{s10} belongs to {s21}
  "A scout appears before you: '{s11}^{s12}{s1}{s5}{s17}'",
  "none",
  [
    (str_clear, s10),
    (str_clear, s21),
    (str_clear, s11),
    (str_clear, s12),
    (str_clear, s3),
    (str_clear, s16),
    (set_background_mesh, "mesh_pic_messenger"),
    #string description
    ##	 (party_get_slot,":town_lord","$current_town",slot_town_lord),
    ##	 (str_store_troop_name,s21,":town_lord"),
    ##        #
    ##        (str_store_party_name, s10, "$current_town"),

    (call_script, "script_game_get_center_note", "$current_town", 0),
    (str_store_string, s11, "@{!}{s0}"),
    ##    (try_begin),
    ##      (this_or_next|is_between, "$current_town", towns_begin, towns_end),
    ##      (is_between, "$current_town", castles_begin, castles_end),
    ##    (try_end),

    (party_get_slot, ":center_food_store", "$current_town", slot_party_food_store),
    (call_script, "script_center_get_food_consumption", "$current_town"),
    (assign, ":food_consumption", reg0),
    (store_div, reg6, ":center_food_store", ":food_consumption"),
    (store_party_size_wo_prisoners,reg5, "$current_town"),
    #(store_party_size, reg5, "$current_town"),
    (str_store_string, s12, "@It should have food stocks for {reg6} days.^The garrison has {reg5} men."),

    (party_get_num_attached_parties, ":num_attached_parties", "$current_town"),
    (try_begin),
      (eq, ":num_attached_parties", 0),
      (str_clear, s1),
      (str_clear, s5),

    (else_try),
        (str_store_string, s1, "@^^The following armies are currently inside:"),
        (try_for_range, ":attached_party_rank", 0, ":num_attached_parties"),
            (party_get_attached_party_with_rank, ":attached_party", "$current_town", ":attached_party_rank"),
            (str_store_party_name, s3, ":attached_party"),
            (store_party_size, reg1, ":attached_party"),
            (str_store_string, s5, "@^{s3} with {reg1} troops."),
        (try_end),
    (try_end),

      ##     (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
      ##     (val_div, ":prosperity", 20),
      ##    (try_begin),
      ##     (eq, ":prosperity", 0),
      ##       (str_store_string, s16, "@{s10} is a very poor place that"),
      ##     (else_try),
      ##       (eq, ":prosperity", 1),
      ##       (str_store_string, s16, "@{s10} is poor place that"),
      ##     (else_try),
      ##       (eq, ":prosperity", 2),
      ##       (str_store_string, s16, "@{s10} is good place that"),
      ##     (else_try),
      ##       (eq, ":prosperity", 3),
      ##       (str_store_string, s16, "@{s10} is rich place that"),
      ##     (else_try),
      ##       (str_store_string, s16, "@{s10} is very rich place that"),
      ##     (try_end),
      ##
      ##    (call_script, "script_update_center_recon_notes", "$current_town"),

      #informacion asedio
    (str_store_string,s17,"str_empty_string"),
    (try_begin),
        (eq, "$current_town", "p_town_27"),
        (str_store_string,s17,"@^^Next to the Tigris lies the beautiful city of Ktesiphon. The mighty residence of Parthian kings."),
    (else_try),
        (eq, "$current_town", "p_town_6"),
        (str_store_string,s17,"@^^Rome! The city which shall conquer the known world. Can you conquer it?"),
    (else_try),
        (eq, "$current_town", "p_town_28"),
        (str_store_string,s17,"@^^Long time ago Carthage was as mighty as Rome and the center of mediterranean trade. But the Romans do not like rivals. They burned it to the ground and built a new Roman Carthage next to it."),
    (else_try),
        (eq, "$current_town", "p_town_20"),
        (str_store_string,s17,"@^^Alexandria was found by Megas Alexandros and became the pearl of Aegypt."),
    (else_try),
        (eq, "$current_town", "p_town_19"),
        (str_store_string,s17,"@^^Hierosolyma! It is the center of the jewish faith. You feel that great trouble lies here."),
    (else_try),
        (str_store_string,s17,"@^^This place is just waiting for you to conquer it."),
    (try_end),
      #
  ],[
    ("regreso_luchain",[],"Thank you. Your information is important!",[
      (jump_to_menu,"mnu_siege_assault"),
    ]),
]),

#################menus extras acaba chief Siege Warfare
("castle_besiege_inner_battle",0,
  "{s1}",
  "none",
  [
    (set_background_mesh, "mesh_pic_siege_sighted"),
    (assign, ":result", "$g_battle_result"),#will be reset at script_encounter_calculate_fit
    (call_script, "script_encounter_calculate_fit"),
    (str_store_string, s1, "@As a last defensive effort, you retreat to the main hall of the keep. " +
    "You and your remaining soldiers will put up a desperate fight here. If you are defeated, there's no other place to fall back to."),
    (str_store_string, s1, "@You've been driven away from the walls. " +
    "Now the attackers are pouring into the streets. If you can defeat them, you can perhaps turn the tide and save the day."),
    (try_begin),
      (this_or_next|neq, ":result", 1),
      (this_or_next|le, "$g_friend_fit_for_battle", 0),
      (le, "$g_enemy_fit_for_battle", 0),
      (jump_to_menu, "$g_siege_final_menu"),
    (else_try),
      (call_script, "script_encounter_calculate_fit"),
      (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
      (try_begin),
        (eq, "$g_siege_battle_state", 0),
        (eq, ":result", 1),
        (assign, "$g_battle_result", 0),
        (jump_to_menu, "$g_siege_final_menu"),
      (else_try),
        (eq, "$g_siege_battle_state", 1),
        (eq, ":result", 1),
        (str_store_string, s1, "@You've breached the town walls, " +
          "but the stubborn defenders continue to resist you in the streets! " +
        "You'll have to deal with them before you can attack the keep at the heart of the town."),
      (else_try),
        (eq, "$g_siege_battle_state", 2),
        (eq, ":result", 1),
        (str_store_string, s1, "@The town centre is yours, " +
          "but the remaining defenders have retreated to the hall. " +
        "It must fall before you can complete your victory."),
      (else_try),
        (jump_to_menu, "$g_siege_final_menu"),
      (try_end),
    (else_try),
      (try_begin),
        (eq, "$g_siege_battle_state", 0),
        (eq, ":result", 1),
        (assign, "$g_battle_result", 0),
        (jump_to_menu, "$g_siege_final_menu"),
      (else_try),
        (eq, "$g_siege_battle_state", 1),
        (eq, ":result", 1),
        (str_store_string, s1, "@The remaining defenders have retreated to the hall as a last defense. You must go in and crush any remaining resistance."),
      (else_try),
        (jump_to_menu, "$g_siege_final_menu"),
      (try_end),
    (try_end),
  ],[
    ("continue",[
    ],"Continue...",[
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (try_begin),
          (eq, "$g_siege_battle_state", 1),
          (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_center),
          (set_jump_mission, "mt_besiege_inner_battle_town_center"),
        (else_try),
          (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_castle),
          (set_jump_mission, "mt_besiege_inner_battle_castle"),
        (try_end),
      (else_try),
        (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_castle),
        (set_jump_mission, "mt_besiege_inner_battle_castle"),
      (try_end),
      ##           (call_script, "script_calculate_battle_advantage"),
      ##           (set_battle_advantage, reg0),
      (set_party_battle_mode),
      (jump_to_scene, ":battle_scene"),
      (val_add, "$g_siege_battle_state", 1),
      (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
      (jump_to_menu, "mnu_battle_debrief"),
      (change_screen_mission),
    ]),
]),

  ####siege warfare
  (
    "build_mantles2",0,
    "The mantlets help protect your men when they have to use assault equipment. They save many lives. " +
    "As the party member with the highest Engineer skill, ({reg2}), {reg3?you estimate:{s3} estimates} that it will take " +
    "{reg4} hours to build mantlets.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
      (assign, ":max_skill", reg0),
      (assign, ":max_skill_owner", reg1),
      (assign, reg2, ":max_skill"),

      (store_sub, reg4, 16, ":max_skill"),
      (val_mul, reg4, 2),#between 12 and 32 hours

      (try_begin),
        (eq, ":max_skill_owner", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":max_skill_owner"),
      (try_end),
      (call_script, "script_set_town_picture"),
    ],
    [
      ("build_mantles",[],
        "Do it.", [
          #(assign, "$g_siege_method", 1),
          (assign, "$g_mantlets_1", 1),
          (store_current_hours, ":cur_hours"),
          (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, ":cur_hours"),
          (jump_to_menu,"mnu_siege_assault"),
      ]),
      ("go_back",[],
        "Go back.", [(jump_to_menu,"mnu_siege_assault")]),
    ],
  ),

  (
    "construct_ladders",0,
    "As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that it will take " +
    "{reg4} hours to build enough equipment for the assault.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
      (assign, ":max_skill", reg0),
      (assign, ":max_skill_owner", reg1),
      (assign, reg2, ":max_skill"),

      (store_sub, reg4, 16, ":max_skill"),
      (val_mul, reg4, 2),#between 12 and 32 hours

      (try_begin),
        (eq, ":max_skill_owner", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":max_skill_owner"),
      (try_end),
      (call_script, "script_set_town_picture"),
    ],
    [
      ("build_ladders_cont",[],
        "Do it.", [
          (assign, "$g_siege_method", 1),
          (store_current_hours, ":cur_hours"),
          (party_set_slot, "$g_encountered_party", slot_center_ladder_time, ":cur_hours"),
          (jump_to_menu,"mnu_siege_assault"),
          ##           (store_current_hours, ":cur_hours"),
          ##           (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
          ##           (store_sub, ":hours_takes", 14, reg0),
          ##           (val_mul, ":hours_takes", 2),
          ##           (val_div, ":hours_takes", 3),
          ##           (store_add, "$g_siege_method_finish_hours",":cur_hours", ":hours_takes"),
          ##           (assign,"$auto_besiege_town","$current_town"),
          ##           (rest_for_hours_interactive, 96, 5, 1), #rest while attackable. A trigger will divert control when attack is ready.
          ##           (change_screen_return),
      ]),
      ("go_back",[],
        "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),
    ],
  ),

  (
    "construct_siege_tower",0,
    "As the party member with the highest Engineer skill, ({reg2}), {reg3?you estimate:{s3} estimates} that building a siege tower and other equipment for assault will take " +
    "{reg4} hours.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
      (assign, ":max_skill", reg0),
      (assign, ":max_skill_owner", reg1),
      (assign, reg2, ":max_skill"),

      (store_sub, reg4, 15, ":max_skill"),
      (val_mul, reg4, 6),

      (try_begin),
        (eq, ":max_skill_owner", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":max_skill_owner"),
      (try_end),
      (call_script, "script_set_town_picture"),
    ],
    [
      ("build_siege_tower_cont",[],
        "Start building.", [
          (assign, "$g_siege_method", 2),
          (store_current_hours, ":cur_hours"),
          (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
          (store_sub, ":hours_takes", 15, reg0),
          (val_mul, ":hours_takes", 6),
          (store_add, "$g_siege_method_finish_hours",":cur_hours", ":hours_takes"),
          (assign,"$auto_besiege_town","$current_town"),
          (rest_for_hours_interactive, 240, 5, 1), #rest while attackable. A trigger will divert control when attack is ready.
          (change_screen_return),
      ]),
      ("go_back",[],
        "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),
    ],
  ),

  (
    "castle_attack_walls_simulate",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Enemy casualties: {s10}",
    "none",
    [
      (try_begin),
        (set_background_mesh, "mesh_pic_siege_attack"),
      (try_end),

      (call_script, "script_simulate_battle_with_parties", 2, "$g_enemy_party", 5, 0, 0),

      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0), #(TODO : compare with num_routed_us)
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_attack_walls_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (le, reg0, 0), #(TODO : compare with num_routed_enemies)
        (assign, "$no_soldiers_left", 1),
        (assign, "$g_battle_result", 1),
        (str_store_string, s4, "str_attack_walls_success"),
      (else_try),
        (str_store_string, s4, "str_attack_walls_continue"),
      (try_end),
    ],
    [
      ##      ("lead_next_wave",[(eq, "$no_soldiers_left", 0)],"Lead the next wave of attack personally.", [
      ##           (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
      ##           (set_party_battle_mode),
      ##           (set_jump_mission,"mt_castle_attack_walls"),
      ##           (jump_to_scene,":battle_scene"),
      ##           (jump_to_menu,"mnu_castle_outside"),
      ##           (change_screen_mission),
      ##       ]),
      ##      ("continue_attacking",[(eq, "$no_soldiers_left", 0)],"Order your soldiers to keep attacking...", [
      ##                                    (jump_to_menu,"mnu_castle_attack_walls_3"),
      ##                                    ]),
      ##      ("call_soldiers_back",[(eq, "$no_soldiers_left", 0)],"Call your soldiers back.",[(jump_to_menu,"mnu_castle_outside")]),
      ("continue",[],"Continue...",[(jump_to_menu,"mnu_castle_besiege")]),
    ]
  ),

  (
    "castle_attack_walls_with_allies_simulate_freelancer",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
      (try_begin),
        (set_background_mesh, "mesh_pic_siege_attack"),
      (try_end),

      (call_script, "script_simulate_battle_with_parties", 2, "$g_enemy_party", 5, "$g_ally_party", 0),

      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "$enlisted_party"),
        (le, reg0, 0), #(TODO : compare with num_routed_us)
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_attack_walls_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (le, reg0, 0), #(TODO : compare with num_routed_enemies)
        (assign, "$no_soldiers_left", 1),
        (assign, "$g_battle_result", 1),
        (str_store_string, s4, "str_attack_walls_success"),
      (else_try),
        (str_store_string, s4, "str_attack_walls_continue"),
      (try_end),
    ],
    [
      ("continue",[],"Continue...",[(jump_to_menu,"mnu_besiegers_camp_with_allies")]),
    ]
  ),

  (
    "castle_attack_walls_with_allies_simulate",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
      (try_begin),
        (set_background_mesh, "mesh_pic_siege_attack"),
      (try_end),

      (call_script, "script_simulate_battle_with_parties", 2, "$g_enemy_party", 5, "$g_ally_party", 0),

      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0), #(TODO : compare with num_routed_us)
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_attack_walls_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (le, reg0, 0), #(TODO : compare with num_routed_enemies)
        (assign, "$no_soldiers_left", 1),
        (assign, "$g_battle_result", 1),
        (str_store_string, s4, "str_attack_walls_success"),
      (else_try),
        (str_store_string, s4, "str_attack_walls_continue"),
      (try_end),
    ],
    [
      ("continue",[],"Continue...",[(jump_to_menu,"mnu_besiegers_camp_with_allies")]),
    ]
  ),

  (
    "castle_taken_by_friends",0,
    "Nothing to see here.",
    "none",
    [
      (party_clear, "$g_encountered_party"),
      (party_stack_get_troop_id, ":leader", "$g_encountered_party_2", 0),
      (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, ":leader"),
      (store_troop_faction, ":faction_no", ":leader"),
      #Reduce prosperity of the center by 5
      (call_script, "script_change_center_prosperity", "$g_encountered_party", -5),
      (party_get_slot, ":food_stores", "$g_encountered_party", slot_party_food_store),
      (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
      (val_min, ":food_stores", reg0),
      (party_set_slot, "$g_encountered_party", slot_party_food_store, ":food_stores"),
      (try_begin),
        (assign, ":damage", 20),
        (is_between, "$g_encountered_party", towns_begin, towns_end),
        (assign, ":damage", 40),
      (try_end),
      (try_begin),
        (neq, ":faction_no", "$g_encountered_party_faction"),
        (call_script, "script_faction_inflict_war_damage_on_faction", ":faction_no", "$g_encountered_party_faction", ":damage"),
      (try_end),

      (call_script, "script_give_center_to_faction", "$g_encountered_party", ":faction_no"),
      (call_script, "script_add_log_entry", logent_player_participated_in_siege, "trp_player",  "$g_encountered_party", 0, "$g_encountered_party_faction"),
      ##        (call_script, "script_change_troop_renown", "trp_player", 1),
      (change_screen_return),
    ],
    [
    ],
  ),

  ###siege warfare chief cambia
("castle_taken",mnf_disable_all_keys,
  "The battle for {s60} is almost over. Your troops are eager to start plundering the {reg2?town:fort}. {s10}^" +
  "You may decide to forbid your troops to harm the {reg2?town:fort} if you want to conquer it for your faction, but your troops may lose morale. " +
  "You can allow some plundering and keep the {reg2?town:fort}, or you may want to just fill your purse a bit and leave the plundered place for the enemy. " +
  "Finally, you could also decide to devastate the place completely in order to gain as much loot as possible, " +
  "enslave the inhabitants, and make it worthless for its owner.",
  "none",[
    (play_sound, "snd_cow_moo"), #ambient sound chief
    (set_background_mesh, "mesh_pic_victory"),
    (str_store_party_name, s60, "$g_encountered_party"),
    (party_get_slot, ":prosperity", "$g_encountered_party", slot_town_prosperity),
    (store_div, ":str_id", ":prosperity", 10),
    (val_min, ":str_id", 9),
    (try_begin),
        (is_between, "$g_encountered_party", towns_begin, towns_end),
        (assign, reg2, 1),
        (val_add, ":str_id", "str_town_prosperity_0"),
        (str_store_string, s10, ":str_id"),
    (else_try),
        (assign, reg2, 0),
        (val_add, ":str_id", "str_fort_prosperity_0"),
        (str_store_string, s10, ":str_id"),
    (try_end),

        #siege warfare chief
    (try_begin),
        (eq, "$g_loot_decide", 1),
        (assign, "$g_empieza_asedio", 0),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
        (try_begin),
            (troop_slot_ge, "trp_global_variables", g_player_trench, 1),
            (troop_set_slot, "trp_global_variables", g_player_trench, 0),
            (display_message, "@Fortifications are destroyed.", message_alert), #SB : colorize
        (try_end),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
        (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
        (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
        (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
        (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),

        (assign, "$g_siege_saneamiento", 0),
        (assign, "$g_traicion_interna", 0),
        (assign, "$g_infiltracion_interna", 0),
        (assign, "$g_campos_cercanos", 0),
        (assign, "$g_listos_para_asalto", 0),
        (assign, "$g_mantlets_1", 0),
        (assign, "$g_cabezas_dentro", 0), #event
        (assign, "$g_siege_method", 0),
        (assign, "$g_siege_sallied_out_once", 0),
        (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
        (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
        #siege warfare acaba

        #new:
        (assign, "$plunder_battle_shown", 0),
        (assign, "$capture_screen_shown", 0),
        (assign, "$loot_screen_shown", 0),
        # SETUP MORALE IMPACT
        # JuJu70
        (try_begin),
          (assign, ":num_bmen", 0),
          (assign, ":num_cmen", 0),
          (assign, ":num_pmen", 0),
          (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
          (try_for_range, ":i_stack", 0, ":num_stacks"),
            (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
            (party_stack_get_troop_id, ":stack_troop","p_main_party",":i_stack"),
            (try_begin),#peasants not
              (this_or_next|is_between, ":stack_troop", "trp_sarmatian_peasant", "trp_watchman"),
              (is_between, ":stack_troop", "trp_follower_woman", "trp_kidnapped_girl"),
              (val_add, ":num_cmen", ":stack_size"),
            (else_try),##soldiers like looting
              (this_or_next|is_between, ":stack_troop", "trp_mercenaries_end", "trp_sarranid_horseman"),
              (is_between, ":stack_troop", "trp_watchman", "trp_mercenaries_end"),
              (val_add, ":num_pmen", ":stack_size"),
            (else_try),#bandits too
              (is_between, ":stack_troop", bandits_begin, bandits_end),
              (val_add, ":num_bmen", ":stack_size"),
            (try_end),
          (try_end),
          (store_party_size_wo_prisoners, ":num_men", "p_main_party"),
          # depending on the situation the player come to this menu with loot_option = -1 or he has already decided in a dialogue
          (try_begin),
            (eq, "$loot_option", 0),
            (val_mul, ":num_bmen", 4),
            (val_mul, ":num_pmen", 3),
            (val_mul, ":num_cmen", -1),
            (store_add, ":weighted", ":num_bmen", ":num_pmen"),
            (val_add, ":weighted", ":num_cmen"),
            (val_mul, ":weighted", -10),
            (val_div, ":weighted", ":num_men"),
            (call_script, "script_change_player_honor", 5),
            (call_script, "script_change_player_party_morale", ":weighted"),
            (jump_to_menu, "mnu_castle_taken_native"),
          (else_try),
            (eq, "$loot_option", 1),
            (val_mul, ":num_bmen", 3),
            (val_mul, ":num_pmen", 3),
            (val_mul, ":num_cmen", -2),
            (store_add, ":weighted", ":num_bmen", ":num_cmen"),
            (val_add, ":weighted", ":num_pmen"),
            (val_mul, ":weighted", 5),
            (val_div, ":weighted", ":num_men"),
            (call_script, "script_change_player_honor", -5),
            (call_script, "script_change_player_party_morale", ":weighted"),
            (call_script, "script_change_troop_renown", "trp_player", 2),
            #(call_script, "script_destroy_center", "$g_encountered_party"),
            (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -30), #center hate to player
            (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"), # companion comment
            (jump_to_menu, "mnu_castle_taken_plunder"),
          (else_try),
            (eq, "$loot_option", 2),	#(Scorched earth policy)
            (val_mul, ":num_bmen", 5),
            (val_mul, ":num_pmen", 4),
            (val_mul, ":num_cmen", -4),
            (store_add, ":weighted", ":num_bmen", ":num_cmen"),
            (val_add, ":weighted", ":num_pmen"),
            (val_mul, ":weighted", 5),
            (val_div, ":weighted", ":num_men"),
            (call_script, "script_change_player_honor", -15),
            (call_script, "script_change_player_party_morale", ":weighted"),
            (call_script, "script_change_troop_renown", "trp_player", 7),
            (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -60), #center hate to player
            # (call_script, "script_destroy_center", "$g_encountered_party"), #destroy the center
            (call_script, "script_objectionable_action", tmt_humanitarian, "str_sell_slavery"), # companion comment
            (jump_to_menu, "mnu_castle_taken_plunder"),
          (else_try),
            (eq, "$loot_option", 3),
            (val_mul, ":num_bmen", 3),
            (val_mul, ":num_pmen", 3),
            (val_mul, ":num_cmen", -1),
            (store_add, ":weighted", ":num_bmen", ":num_cmen"),
            (val_add, ":weighted", ":num_pmen"),
            (val_mul, ":weighted", 5),
            (val_div, ":weighted", ":num_men"),
            (call_script, "script_change_player_honor", -3),
            (call_script, "script_change_player_party_morale", ":weighted"),
            (call_script, "script_change_troop_renown", "trp_player", 5),

            (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -20), #center hate to player
            # (call_script, "script_destroy_center", "$g_encountered_party"),
            (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"), # companion comment
            (jump_to_menu, "mnu_castle_taken_keepplunder"),
          (try_end),
        (try_end),
    (try_end),
  ],[
  ("saqueo_noallowed",[],"Conquer the {reg2?town:fort}, but forbid plundering.",[
    (assign, "$loot_option", 0),
    (assign, "$g_loot_decide", 1),
    (jump_to_menu, "mnu_castle_taken"),
  ]),
  ("keep_plunder",[],"Conquer and plunder the {reg2?town:fort}.",[
    (assign, "$loot_option", 3),
    (assign, "$g_loot_decide", 1),
    (jump_to_menu, "mnu_castle_taken"),
  ]),
  ("saqueo_normal",[],"Plunder the {reg2?town:fort} and leave.",[
    (assign, "$g_loot_decide", 1),
    (assign, "$loot_option", 1),
    (jump_to_menu, "mnu_castle_taken"),
  ]),
  ("saqueo_total",[],"Devastate the place and leave.",[
    (assign, "$g_loot_decide", 1),
    (assign, "$loot_option", 2),
    (jump_to_menu, "mnu_castle_taken"),
  ]),
]),

  (
    "castle_taken_plunder",mnf_disable_all_keys,
    "The {reg2?town:fort} is plundered. You have collected {reg7} denars.",
    "none",
    [
      (set_background_mesh, "mesh_pic_victory"),
      (troop_clear_inventory, "trp_temp_troop"),
      (try_begin),
        (eq, "$plunder_battle_shown", 0),
        (assign, "$plunder_battle_shown", 1),
        (party_clear, "$g_encountered_party"),
        (party_get_slot, ":exterior_scene", "$g_encountered_party", slot_castle_exterior),
        (modify_visitors_at_site, ":exterior_scene"),
        (reset_visitors),
		    (party_get_slot, ":wealthy_pop", "$g_encountered_party", slot_town_prosperity),#
        (val_add, ":wealthy_pop", 20),
        (assign, ":num_townsman", 40),
		    (val_mul, ":num_townsman", ":wealthy_pop"),
	    	(val_div, ":num_townsman", 100),
        (store_div, ":num_of_spawns",":num_townsman",10),
        (val_clamp, ":num_of_spawns", 1, 5),
        (party_get_slot, ":culture", "$g_encountered_party", slot_center_culture),
        (try_begin),
          (eq, ":culture", "fac_culture_1"),
          (assign, ":troop_1", "trp_dacian_village_walker"),
          (assign, ":troop_2", "trp_dacian_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_2"),
          (assign, ":troop_1", "trp_celtic_village_walker"),
          (assign, ":troop_2", "trp_celtic_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_2_1"),
          (assign, ":troop_1", "trp_celtic_village_walker"),
          (assign, ":troop_2", "trp_celtic_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_3"),
          (assign, ":troop_1", "trp_sarmatian_village_walker"),
          (assign, ":troop_2", "trp_sarmatian_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_4"),
          (assign, ":troop_1", "trp_germanic_village_walker"),
          (assign, ":troop_2", "trp_germanic_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_6"),
          (assign, ":troop_1", "trp_parthian_village_walker"),
          (assign, ":troop_2", "trp_parthian_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_8"),
          (assign, ":troop_1", "trp_judean_village_walker"),
          (assign, ":troop_2", "trp_judean_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_9"),
          (assign, ":troop_1", "trp_bosporan_village_walker"),
          (assign, ":troop_2", "trp_bosporan_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_5"),
          (assign, ":troop_1", "trp_armenian_village_walker"),
          (assign, ":troop_2", "trp_armenian_village_walker_female"),
        (else_try),
          (assign, ":troop_1", "trp_roman_town_walker"),
          (assign, ":troop_2", "trp_roman_town_walker_female"),
        (try_end),
        (try_for_range, ":entry", 1, 11),	#thats entry 30-39
          (store_random_in_range, ":r", 0, 10),
          (try_begin),
            (le, ":r", 4),
            (set_visitors, ":entry", ":troop_1", ":num_of_spawns"),
          (else_try),
            (set_visitors, ":entry", ":troop_2", ":num_of_spawns"),
          (try_end),
          (set_visitors, ":entry", "trp_boy", 1),
          (set_visitors, ":entry", "trp_girl", 1),
        (try_end),
        (set_jump_mission,"mt_center_plunder"),
        (jump_to_scene, ":exterior_scene"),
        (change_screen_mission),
      (else_try),
        (eq, "$capture_screen_shown", 0),
        (assign, "$capture_screen_shown", 1),
        (eq, "$loot_option", 2),	#new: capturing slaves only for loot option 2
        (party_clear, "p_temp_party"),
        (assign, "$g_move_heroes", 0),
        (call_script, "script_party_add_wounded_members_as_prisoners", "p_temp_party", "p_total_enemy_casualties"),
        (party_get_num_prisoners,  ":num_captured_enemies", "p_temp_party"),
        (party_get_slot, ":random_addition", "$g_encountered_party", slot_town_prosperity),
        (val_add, ":random_addition", 25),
        (val_div, ":random_addition", 10),
        (val_add, ":num_captured_enemies", ":random_addition"),
        (val_add, ":num_captured_enemies", ":random_addition"),

        (try_begin),
            (lt, "$player_honor", -90),
            (val_add, ":random_addition", 20),
        (else_try),
            (lt, "$player_honor", -70),
            (val_add, ":random_addition", 15),
        (else_try),
            (lt, "$player_honor", -40),
            (val_add, ":random_addition", 10),
        (else_try),
            (lt, "$player_honor", -20),
            (val_add, ":random_addition", 5),
        (try_end),

        (party_add_prisoners, "p_temp_party", "trp_slave", ":random_addition"),
        (party_add_prisoners, "p_temp_party", "trp_slave_female", ":random_addition"),
        (gt, ":num_captured_enemies", 0),
        (change_screen_exchange_with_party, "p_temp_party"),
      (else_try),
        (eq, "$loot_screen_shown", 0),
        (assign, "$loot_screen_shown", 1),
        (assign, ":merchant_troop", 0),
        (try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
          (party_get_slot, ":merchant_troop", "$g_encountered_party", slot_town_merchant),
        (else_try),
          # new begin (copy of mnu_village_loot_complete)
          (assign, ":bound_town", "$g_encountered_party"),
          (store_sub, ":item_to_price_slot", slot_town_trade_good_prices_begin, trade_goods_begin),
          (reset_item_probabilities,0),
          (assign, ":total_probability", 0),
          (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
            (store_add, ":cur_price_slot", ":cur_goods", ":item_to_price_slot"),
            (party_get_slot, ":cur_price", ":bound_town", ":cur_price_slot"),
            (gt, ":cur_price", 0),
            (call_script, "script_center_get_production", ":bound_town", ":cur_goods"),
            (assign, ":cur_probability", reg0),
            (call_script, "script_center_get_consumption", ":bound_town", ":cur_goods"),
            (val_div, reg0, 3),
            (val_sub, ":cur_probability", reg0),
            (val_mul, ":cur_probability", 4),
            (val_mul, ":cur_probability", average_price_factor),
            (val_div, ":cur_probability", ":cur_price"),
            (val_max,":cur_probability",0),
            #first only simulation
            #(set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
            (val_add, ":total_probability", ":cur_probability"),
          (try_end),
          (reset_item_probabilities,0),
          (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
            (store_add, ":cur_price_slot", ":cur_goods", ":item_to_price_slot"),
            (party_get_slot, ":cur_price", ":bound_town", ":cur_price_slot"),
            (gt, ":cur_price", 0),
            (call_script, "script_center_get_production", ":bound_town", ":cur_goods"),
            (assign, ":cur_probability", reg0),
            (gt, ":cur_probability", 0),
            (call_script, "script_center_get_consumption", ":bound_town", ":cur_goods"),
            (val_div, reg0, 3),
            (val_sub, ":cur_probability", reg0),
            (val_mul, ":cur_probability", 4),
            (val_mul, ":cur_probability", average_price_factor),
            (val_div, ":cur_probability", ":cur_price"),
            (val_max, ":cur_probability", 0),
            (val_mul, ":cur_probability", num_merchandise_goods),
            (val_mul, ":cur_probability", 100),
            (val_div, ":cur_probability", ":total_probability"),
            (val_max, ":cur_probability", 5),
            # (try_begin),
              # (eq, ":cur_goods", "itm_temple_gold"),
              # (assign, ":cur_probability", 100),
            # (try_end),
            (set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
          (try_end),

          (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
          (val_min, ":prosperity", 40),
          (val_div, ":prosperity", 2),
          (val_max, ":prosperity", 3),
          (party_get_skill_level, ":looting_skill", "p_main_party", "skl_looting"),
          (val_add, ":prosperity", ":looting_skill"),

          (troop_add_merchandise,"trp_temp_troop",itp_type_goods,":prosperity"),
          (assign, ":merchant_troop", "trp_temp_troop"),

          #new end
        (try_end),
        (gt, ":merchant_troop", 0),
        (try_begin),
          (eq, "$loot_option", 2),
          (troop_add_item, ":merchant_troop", "itm_temple_gold"),#this seems to work
          (troop_add_item, ":merchant_troop", "itm_temple_gold"),#this seems to work
          (troop_add_item, ":merchant_troop", "itm_jewelry"),#this seems to work
          (troop_add_item, ":merchant_troop", "itm_jewelry"),#this seems to work
        (else_try),
          (troop_add_item, ":merchant_troop", "itm_temple_gold"),#this seems to work
          (troop_add_item, ":merchant_troop", "itm_jewelry"),#this seems to work
        (try_end),
        (troop_sort_inventory, ":merchant_troop"),
        (change_screen_loot, ":merchant_troop"),
      (else_try),
        # All shown
        #get skill
        (party_get_skill_level, ":looting_skill", "p_main_party", "skl_looting"),
        (val_mul, ":looting_skill", 2),##max of 20
        (store_add, ":modifer", ":looting_skill", 80),#max of 100
        # 1.PLUNDER MONEY
        ##from wealth
        (party_get_slot, ":wealth", "$g_encountered_party", slot_town_wealth),
        (val_max, ":wealth", 0),
        (store_mul, ":loot", ":wealth", ":modifer"),
        (val_div, ":loot", 100),
        (val_sub, ":wealth", ":loot"),
        (party_set_slot, "$g_encountered_party", slot_town_wealth, ":wealth"),

       ##taxes
        (party_get_slot, ":tax", "$g_encountered_party", slot_center_accumulated_rents),
        (party_get_slot, ":tax2", "$g_encountered_party", slot_center_accumulated_tariffs),
        (val_add, ":tax", ":tax2"),

        ##from town capital
        (party_get_slot, ":wealth2", "$g_encountered_party", slot_center_capital),
        (store_mul, ":loot2", ":wealth2", ":modifer"),
        (val_div, ":loot2", 100),
        (val_sub, ":wealth2", ":loot2"),
        (party_set_slot, "$g_encountered_party", slot_center_capital, ":wealth2"),
        (assign, reg51, ":loot"),
        (assign, reg50, ":loot2"),
        (assign, reg52, ":tax"),
        (display_message, "@You gained {reg50} denars from looting the population and {reg51} denars from looting the town administration and {reg52} from looting the accumulated taxes."),
        (val_add, ":loot", ":loot2"),
        (val_add, ":loot", ":tax"),

        ##loot it!!! done in destroy center
        # (party_set_slot, "$g_encountered_party", slot_center_capital, 100),
        # (party_set_slot, "$g_encountered_party", slot_center_accumulated_rents, 0),
        # (party_set_slot, "$g_encountered_party", slot_center_accumulated_tariffs, 0),
        (try_begin),
          (eq, "$loot_option", 1),
          (store_random_in_range, ":random_money", 2000, 4000),
          (assign, ":prosperity_impact", -5),
        (else_try),
          (this_or_next|eq, "$loot_option", 2),
          (eq, "$loot_option", 3),
          (store_random_in_range, ":random_money", 4000, 6000),
          (assign, ":prosperity_impact", -20),
        (else_try),
          (display_message, "@{!}Error in mnu_castle_taken_plunder"),
        (try_end),
        (try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
          (assign, reg2, 1),	# is town
        (else_try),
          (assign, reg2, 0),	# is fort
        (try_end),
        (call_script, "script_change_center_prosperity", "$g_encountered_party", ":prosperity_impact"),
        (val_add, ":loot", ":random_money"),

        (try_begin),
            (lt, "$player_honor", -90),
            (val_mul, ":loot", 15),
            (val_div, ":loot", 10),
        (else_try),
            (lt, "$player_honor", -70),
            (val_mul, ":loot", 14),
            (val_div, ":loot", 10),
        (else_try),
            (lt, "$player_honor", -40),
            (val_mul, ":loot", 13),
            (val_div, ":loot", 10),
        (else_try),
            (lt, "$player_honor", -20),
            (val_mul, ":loot", 12),
            (val_div, ":loot", 10),
        (try_end),

        (troop_add_gold, "trp_player", ":loot"),
        (assign, reg7, ":loot"),

        # 2.ICON
      #  (call_script, "script_change_party_icon_loot_state", "$g_encountered_party", 1),
        # (party_add_particle_system, "$g_encountered_party", "psys_map_village_fire"),
        # (party_add_particle_system, "$g_encountered_party", "psys_map_village_fire_smoke"),

        # 3.DEVASTATED TIME
        # (party_set_slot, "$g_encountered_party", slot_party_looted_left_days, 5),
        # (party_set_slot, "$g_encountered_party", slot_center_accumulated_rents, 0),
        # (try_begin),
          # (eq, "$loot_option", 2),
          # (party_set_slot, "$g_encountered_party", slot_party_looted_left_days, 10),
        # (try_end),

        # # 4.PUSH PLAYER ON SEA IF HE HAS SHIPS
        # (try_begin),
          # (party_slot_ge, "$current_town", slot_party_1_ship_type, 1),
          # (call_script, "script_give_player_ships_from_party_to_party", "$current_town", "p_main_party"),
          # (party_get_slot, ":curr_port", "$current_town", slot_party_port_party),
          # (party_get_position, pos2, ":curr_port"),
          # (party_set_position, "p_main_party", pos2),
          # (call_script, "script_switch_to_water_consequences"),
        # (try_end),

        # 5. NATIVE CODE WE STILL NEED
        (try_for_range, ":party_template_slot", slot_cohort_town_begin, slot_cohort_town_3),
            (party_get_slot, ":party_template", "$g_encountered_party", ":party_template_slot"),
            (ge, ":party_template", 1),
            (call_script, "script_cohort_refil_garrison", "$g_encountered_party", ":party_template", ":party_template_slot",0),
        (try_end),

        (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
        (val_div, reg0, 3),
        (party_set_slot, "$g_encountered_party", slot_party_food_store, reg0),
        (call_script, "script_lift_siege", "$g_encountered_party", 0),
        (assign, "$g_player_besiege_town", -1),
        (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, "trp_player"),

        (call_script, "script_change_troop_renown", "trp_player", 10),

        (assign, ":damage", 20),		#native: 20
        (try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
          (assign, ":damage", 40),	#native: 40
        (try_end),
        (call_script, "script_destroy_center", "$g_encountered_party"),
        (call_script, "script_faction_inflict_war_damage_on_faction", "$players_kingdom", "$g_encountered_party_faction", ":damage"),
      (try_end),
    ],
    [

      ("continue",[],"Continue...",
        [
          # (assign, "$auto_enter_town", "$g_encountered_party"),
          # (change_screen_return),
          (change_screen_map),
          #(jump_to_menu, "mnu_auto_return_map"),
      ]),
    ],
  ),

("castle_taken_native",mnf_disable_all_keys,
  "{s3} has fallen to your troops, and you now have full control of the {reg2?town:fort}. " +
  "{reg1? You may station troops here to defend it against enemies who may try to recapture it. Also, you should select now whether you will hold the {reg2?town:fortress} yourself or give it to a faithful vassal...:}",# Only visible when castle is taken without being a vassal of a kingdom.
  "none",[
    (set_background_mesh, "mesh_pic_victory"),
    (party_clear, "$g_encountered_party"),

    (try_begin),
        (eq, "$players_kingdom", "fac_player_supporters_faction"),
        (party_get_slot, ":new_owner", "$g_encountered_party", slot_town_lord),
        (neq, ":new_owner", "trp_player"),

        (try_for_range, ":party_template_slot", slot_cohort_town_begin, slot_cohort_town_5),
            (party_get_slot, ":party_template", "$g_encountered_party", ":party_template_slot"),
            (ge, ":party_template", 1),
            (call_script, "script_cohort_refil_garrison", "$g_encountered_party", ":party_template", ":party_template_slot",0),
        (try_end),
    (try_end),
    (call_script, "script_lift_siege", "$g_encountered_party", 0),
    (assign, "$g_player_besiege_town", -1),

    (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, "trp_player"),
    #Reduce prosperity of the center by 5
    (call_script, "script_change_center_prosperity", "$g_encountered_party", -3),	#native= -5 #reduced because raid is avoided
    (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
    (val_min, reg0, 2),
    (party_set_slot, "$g_encountered_party", slot_party_food_store, reg0),
    (call_script, "script_change_troop_renown", "trp_player", 10),

    (assign, ":damage", 20),		#native: 20
    (try_begin),
        (is_between, "$g_encountered_party", towns_begin, towns_end),
        (assign, ":damage", 40),	#native: 40
    (try_end),
    (call_script, "script_faction_inflict_war_damage_on_faction", "$players_kingdom", "$g_encountered_party_faction", ":damage"),

    (try_begin),
        (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
        (neq, "$players_kingdom", "fac_player_supporters_faction"),
        (call_script, "script_give_center_to_faction", "$g_encountered_party", "$players_kingdom"),
        (call_script, "script_order_best_besieger_party_to_guard_center", "$g_encountered_party", "$players_kingdom"),
        (jump_to_menu, "mnu_castle_taken_2"),
    (else_try),
        (call_script, "script_give_center_to_faction", "$g_encountered_party", "fac_player_supporters_faction"),
        (call_script, "script_order_best_besieger_party_to_guard_center", "$g_encountered_party", "fac_player_supporters_faction"),
        (str_store_party_name, s3, "$g_encountered_party"),
        (assign, reg1, 0),
        (try_begin),
            (faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
            (assign, reg1, 1),
        (try_end),
        #(party_set_slot, "$g_encountered_party", slot_town_lord, stl_unassigned),
    (try_end),
    (assign, reg2, 0),
    (try_begin),
        (is_between, "$g_encountered_party", towns_begin, towns_end),
        (assign, reg2, 1),
    (try_end),
  ],[
  ("continue",[],"Continue...",[
    (assign, "$auto_enter_town", "$g_encountered_party"),
    #(change_screen_return),
    (change_screen_map),
  ]),
]),

####
("castle_taken_keepplunder",mnf_disable_all_keys,
  "{s3} has fallen to your troops, and you now have full control of the {reg2?town:fort}. Your troops run through the streets getting as much stuff as they can carry. The {reg2?town:fort} is plundered. You have collected {reg7} denars. " +
  "{reg1? You may station troops here to defend it against enemies who may try to recapture it. Also, you should select now whether you will hold the {reg2?town:fortress} yourself or give it to a faithful vassal...:}",# Only visible when castle is taken without being a vassal of a kingdom.
  "none",[
    (set_background_mesh, "mesh_pic_victory"),
    (troop_clear_inventory, "trp_temp_troop"),
    (try_begin),
        (eq, "$plunder_battle_shown", 0),
        (assign, "$plunder_battle_shown", 1),
        (party_clear, "$g_encountered_party"),
        (party_get_slot, ":exterior_scene", "$g_encountered_party", slot_castle_exterior),
        (modify_visitors_at_site, ":exterior_scene"),
        (reset_visitors),
        (party_get_slot, ":wealthy_pop", "$g_encountered_party", slot_town_prosperity),#
        (val_add, ":wealthy_pop", 20),
        (assign, ":num_townsman", 40),
        (val_mul, ":num_townsman", ":wealthy_pop"),
        (val_div, ":num_townsman", 100),
        (store_div, ":num_of_spawns",":num_townsman",10),
        (val_clamp, ":num_of_spawns", 1, 5),
        (party_get_slot, ":culture", "$g_encountered_party", slot_center_culture),
        (try_begin),
          (eq, ":culture", "fac_culture_1"),
          (assign, ":troop_1", "trp_dacian_village_walker"),
          (assign, ":troop_2", "trp_dacian_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_2"),
          (assign, ":troop_1", "trp_celtic_village_walker"),
          (assign, ":troop_2", "trp_celtic_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_2_1"),
          (assign, ":troop_1", "trp_celtic_village_walker"),
          (assign, ":troop_2", "trp_celtic_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_3"),
          (assign, ":troop_1", "trp_sarmatian_village_walker"),
          (assign, ":troop_2", "trp_sarmatian_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_4"),
          (assign, ":troop_1", "trp_germanic_village_walker"),
          (assign, ":troop_2", "trp_germanic_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_6"),
          (assign, ":troop_1", "trp_parthian_village_walker"),
          (assign, ":troop_2", "trp_parthian_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_8"),
          (assign, ":troop_1", "trp_judean_village_walker"),
          (assign, ":troop_2", "trp_judean_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_9"),
          (assign, ":troop_1", "trp_bosporan_village_walker"),
          (assign, ":troop_2", "trp_bosporan_village_walker_female"),
        (else_try),
          (eq, ":culture", "fac_culture_5"),
          (assign, ":troop_1", "trp_armenian_village_walker"),
          (assign, ":troop_2", "trp_armenian_village_walker_female"),
        (else_try),
          (assign, ":troop_1", "trp_roman_town_walker"),
          (assign, ":troop_2", "trp_roman_town_walker_female"),
        (try_end),
        (try_for_range, ":entry", 1, 11),	#thats entry 30-39
          (store_random_in_range, ":r", 0, 10),
          (try_begin),
            (le, ":r", 4),
            (set_visitors, ":entry", ":troop_1", ":num_of_spawns"),
          (else_try),
            (set_visitors, ":entry", ":troop_2", ":num_of_spawns"),
          (try_end),
          (set_visitors, ":entry", "trp_boy", 1),
          (set_visitors, ":entry", "trp_girl", 1),
        (try_end),
        (set_jump_mission,"mt_center_plunder"),
        (jump_to_scene, ":exterior_scene"),
        (change_screen_mission),
    (else_try),
        (eq, "$loot_screen_shown", 0),
        (assign, "$loot_screen_shown", 1),
        (assign, ":merchant_troop", 0),

        (try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
          (party_get_slot, ":merchant_troop", "$g_encountered_party", slot_town_merchant),
        (else_try),
          # new begin (copy of mnu_village_loot_complete)
          (assign, ":bound_town", "$g_encountered_party"),
          (store_sub, ":item_to_price_slot", slot_town_trade_good_prices_begin, trade_goods_begin),
          (reset_item_probabilities,0),
          (assign, ":total_probability", 0),

          (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
            (store_add, ":cur_price_slot", ":cur_goods", ":item_to_price_slot"),
            (party_get_slot, ":cur_price", ":bound_town", ":cur_price_slot"),
            (gt, ":cur_price", 0),
            (call_script, "script_center_get_production", ":bound_town", ":cur_goods"),
            (assign, ":cur_probability", reg0),
            (call_script, "script_center_get_consumption", ":bound_town", ":cur_goods"),
            (val_div, reg0, 3),
            (val_sub, ":cur_probability", reg0),
            (val_mul, ":cur_probability", 4),
            (val_mul, ":cur_probability", average_price_factor),
            (val_div, ":cur_probability", ":cur_price"),
            (val_max,":cur_probability",0),
            #first only simulation
            #(set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
            (val_add, ":total_probability", ":cur_probability"),
          (try_end),

          (reset_item_probabilities,0),

          (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
            (store_add, ":cur_price_slot", ":cur_goods", ":item_to_price_slot"),
            (party_get_slot, ":cur_price", ":bound_town", ":cur_price_slot"),
            (gt, ":cur_price", 0),
            (call_script, "script_center_get_production", ":bound_town", ":cur_goods"),
            (assign, ":cur_probability", reg0),
            (gt, ":cur_probability", 0),
            (call_script, "script_center_get_consumption", ":bound_town", ":cur_goods"),
            (val_div, reg0, 3),
            (val_sub, ":cur_probability", reg0),
            (val_mul, ":cur_probability", 4),
            (val_mul, ":cur_probability", average_price_factor),
            (val_div, ":cur_probability", ":cur_price"),
            (val_max, ":cur_probability", 0),
            (val_mul, ":cur_probability", num_merchandise_goods),
            (val_mul, ":cur_probability", 100),
            (val_div, ":cur_probability", ":total_probability"),
            (val_max, ":cur_probability", 5),
            (set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
          (try_end),

          (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
          (val_min, ":prosperity", 30),
          (val_div, ":prosperity", 2),
          (val_max, ":prosperity", 3),
          (party_get_skill_level, ":looting_skill", "p_main_party", "skl_looting"),
          (val_add, ":prosperity", ":looting_skill"),
          (troop_add_merchandise,"trp_temp_troop",itp_type_goods,":prosperity"),
          (assign, ":merchant_troop", "trp_temp_troop"),
          #new end
        (try_end),

        (gt, ":merchant_troop", 0),
        (troop_add_item, ":merchant_troop", "itm_temple_gold"),#this seems to work
        (troop_add_item, ":merchant_troop", "itm_jewelry"),#this seems to work
        (troop_sort_inventory, ":merchant_troop"),
        (change_screen_loot, ":merchant_troop"),

    (else_try),
        # All shown

        # OLD
        # (party_get_slot, ":prosperity_money", "$g_encountered_party", slot_town_prosperity),
        # (store_random_in_range, ":random_money", 3, 10),
        # (val_mul, ":random_money", 8),

        # (try_begin),
          # (eq, "$loot_option", 3),
          # (val_mul, ":random_money", 8),		# 500 - 1000 denars
          # (val_mul, ":prosperity_money", 60),		# 0 - 10000 denars		# 100 - 6000
          # (assign, ":prosperity_impact", -12),
          # #(call_script, "script_change_center_prosperity", "$g_encountered_party", -12),
        # (else_try),
          # (display_message, "@{!}Error in mnu_castle_taken_plunder"),
        # (try_end),
        #get skill
        (party_get_skill_level, ":looting_skill", "p_main_party", "skl_looting"),
        (val_mul, ":looting_skill", 2),##max of 20
        (store_add, ":modifer", ":looting_skill", 80),#max of 100
        # 1.PLUNDER MONEY
        ##from wealth
        (party_get_slot, ":wealth", "$g_encountered_party", slot_town_wealth),
        (val_max, ":wealth", 0),
        (store_mul, ":loot", ":wealth", ":modifer"),
        (val_div, ":loot", 100),
        (val_sub, ":wealth", ":loot"),
        (party_set_slot, "$g_encountered_party", slot_town_wealth, ":wealth"),
        ##from town capital
		    (party_get_slot, ":wealth2", "$g_encountered_party", slot_center_capital),
        (store_mul, ":loot2", ":wealth2", ":modifer"),
        (val_div, ":loot2", 100),
        (val_sub, ":wealth2", ":loot2"),
        (party_set_slot, "$g_encountered_party", slot_center_capital, ":wealth2"),
        (assign, reg51, ":loot"),
        (assign, reg50, ":loot2"),
        (display_message, "@You gained {reg50} denars from looting the population and {reg51} denars from looting the town administration"),
        (val_add, ":loot", ":loot2"),

        (store_random_in_range, ":random_money", 2000, 4000),
        (assign, ":prosperity_impact", -10),
        (call_script, "script_change_center_prosperity", "$g_encountered_party", ":prosperity_impact"),
        (val_add, ":loot", ":random_money"),
        (troop_add_gold, "trp_player", ":loot"),
        (assign, reg7, ":loot"),

        (try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
          (assign, reg2, 1),	# is town
        (else_try),
          (assign, reg2, 0),	# is fort
        (try_end),

        # (party_get_skill_level, ":looting_skill", "p_main_party", "skl_looting"),
        # #		(val_mul, ":looting_skill", 3),	#3% more money for each skill point
        # (store_mul, ":skill_money", ":plunder_money", ":looting_skill"),
        # (val_div, ":skill_money", 100),
        # (val_add, ":plunder_money", ":skill_money"),
        # (troop_add_gold, "trp_player", ":plunder_money"),
        # (assign, reg7, ":plunder_money"),

        # 2.ICON
        #(call_script, "script_change_party_icon_loot_state", "$g_encountered_party", 1),
        # (party_add_particle_system, "$g_encountered_party", "psys_map_village_fire"),
        # (party_add_particle_system, "$g_encountered_party", "psys_map_village_fire_smoke"),

        # 3.DEVASTATED TIME
        (party_set_slot, "$g_encountered_party", slot_party_looted_left_days, 7),
        (party_set_slot, "$g_encountered_party", slot_center_accumulated_rents, 0),
        (party_set_slot, "$g_encountered_party", slot_center_accumulated_tariffs, 0),

        # 4 Native part
        # 4.PUSH PLAYER ON SEA IF HE HAS SHIPS
        # (try_begin),
          # (party_slot_ge, "$current_town", slot_party_1_ship_type, 1),
          # (call_script, "script_give_player_ships_from_party_to_party", "$current_town", "p_main_party"),
          # (party_get_slot, ":curr_port", "$current_town", slot_party_port_party),
          # (party_get_position, pos2, ":curr_port"),
          # (party_set_position, "p_main_party", pos2),
          # (call_script, "script_switch_to_water_consequences"),
        # (try_end),
        # (try_begin),
          # (eq, "$players_kingdom", "fac_player_supporters_faction"),
          # (party_get_slot, ":new_owner", "$g_encountered_party", slot_town_lord),
          # (neq, ":new_owner", "trp_player"),

        (try_for_range, ":party_template_slot", slot_cohort_town_begin, slot_cohort_town_3),
            (party_get_slot, ":party_template", "$g_encountered_party", ":party_template_slot"),
            (ge, ":party_template", 1),
            (call_script, "script_cohort_refil_garrison", "$g_encountered_party", ":party_template", ":party_template_slot",0),
        (try_end),

          (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
          (val_div, reg0, 4),
          (party_set_slot, "$g_encountered_party", slot_party_food_store, reg0),

        (call_script, "script_lift_siege", "$g_encountered_party", 0),
        (assign, "$g_player_besiege_town", -1),

        (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, "trp_player"),
        #Reduce prosperity of the center by 5
        (call_script, "script_change_center_prosperity", "$g_encountered_party", -3),	#native= -5 #reduced because raid is avoided

        (call_script, "script_change_troop_renown", "trp_player", 10),
        (assign, ":damage", 20),
		#native: 20
        (try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
          (assign, ":damage", 40),	#native: 40
        (try_end),

        (call_script, "script_faction_inflict_war_damage_on_faction", "$players_kingdom", "$g_encountered_party_faction", ":damage"),

        (try_begin),
          (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
          (neq, "$players_kingdom", "fac_player_supporters_faction"),
          (call_script, "script_give_center_to_faction", "$g_encountered_party", "$players_kingdom"),
          (call_script, "script_order_best_besieger_party_to_guard_center", "$g_encountered_party", "$players_kingdom"),
          (jump_to_menu, "mnu_castle_taken_2"),
        (else_try),
          (call_script, "script_give_center_to_faction", "$g_encountered_party", "fac_player_supporters_faction"),
          (call_script, "script_order_best_besieger_party_to_guard_center", "$g_encountered_party", "fac_player_supporters_faction"),
          (str_store_party_name, s3, "$g_encountered_party"),
          (assign, reg1, 0),
          (try_begin),
            (faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
            (assign, reg1, 1),
          (try_end),
          #(party_set_slot, "$g_encountered_party", slot_town_lord, stl_unassigned),
        (try_end),
        (assign, reg2, 0),
        (try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
          (assign, reg2, 1),
        (try_end),
    (try_end),
  ],[
  ("continue",[],"Continue...",[
    (assign, "$auto_enter_town", "$g_encountered_party"),
    #       (change_screen_return),
    (change_screen_map),
  ]),
]),

  (
    "castle_taken_2",mnf_disable_all_keys,
    "{s3} has fallen to your troops, and you now have full control of the place. " +
    "It is time to send word to {s9} about your victory. {s5}",
    "none",
    [
      (set_background_mesh, "mesh_pic_victory"),
      #siege warfare chief
      (assign, "$g_empieza_asedio", 0),
      (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
        (try_begin),
            (troop_slot_ge, "trp_global_variables", g_player_trench, 1),
            (troop_set_slot, "trp_global_variables", g_player_trench, 0),
            (display_message, "@Fortifications are destroyed.", message_alert), #SB : colorize
        (try_end),
      (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
      (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
      (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
      (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
      (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),

      (assign, "$g_siege_saneamiento", 0),
      (assign, "$g_traicion_interna", 0),
      (assign, "$g_infiltracion_interna", 0),
      (assign, "$g_campos_cercanos", 0),
      (assign, "$g_listos_para_asalto", 0),
      (assign, "$g_mantlets_1", 0),
      (assign, "$g_cabezas_dentro", 0), #event
      (assign, "$g_siege_method", 0),
      (assign, "$g_siege_sallied_out_once", 0),
      (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
      (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
      #siege warfare acaba

      (str_store_party_name, s3, "$g_encountered_party"),
      (str_clear, s5),
      (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
      (str_store_troop_name, s9, ":faction_leader"),
      (try_begin),
        (eq, "$player_has_homage", 0),
        (assign, reg8, 0),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
          (assign, reg8, 1),
        (try_end),
        (str_store_string, s5, "@However, since you are not a sworn follower of {s9}, there is no chance he would recognize you as the ruler of this {reg8?town:fort}."),
      (try_end),
    ],
    [
      ("castle_taken_claim",[
      (faction_slot_eq, "$players_kingdom", slot_faction_government_type, gov_feudal),
      (eq, "$player_has_homage", 1)],
        "Request that {s3} be awarded to you.",
        [
          (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, "trp_player"),
          (assign, "$g_castle_requested_by_player", "$current_town"),
          (assign, "$g_castle_requested_for_troop", "trp_player"),
          (assign, "$auto_enter_town", "$g_encountered_party"),
          #(change_screen_return),
          (change_screen_map),
      ]),
      ("castle_taken_claim_2",[
        (faction_slot_eq, "$players_kingdom", slot_faction_government_type, gov_feudal),
          (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
          (is_between, ":spouse", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":spouse", slot_troop_occupation, slto_kingdom_hero),
          (store_faction_of_troop, ":spouse_faction", ":spouse"),
          (eq, ":spouse_faction", "$players_kingdom"),
        ],
        "Request that {s3} be awarded to your husband.",
        [
          (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, "trp_player"),
          (assign, "$g_castle_requested_by_player", "$current_town"),
          (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
          (assign, "$g_castle_requested_for_troop", ":spouse"),
          (assign, "$auto_enter_town", "$g_encountered_party"),

            (try_for_range, ":party_template_slot", slot_cohort_town_begin, slot_cohort_town_3),
                (party_get_slot, ":party_template", "$g_encountered_party", ":party_template_slot"),
                (ge, ":party_template", 1),
                (call_script, "script_cohort_refil_garrison", "$g_encountered_party", ":party_template", ":party_template_slot",0),
            (try_end),

          (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
          (val_div, reg0, 2),
          (party_set_slot, "$g_encountered_party", slot_party_food_store, reg0),
         # (change_screen_return),
          (change_screen_map),
      ]),
      ("castle_taken_no_claim",[(faction_slot_eq, "$players_kingdom", slot_faction_government_type, gov_imperial),],
      "Send news about your victory to Rome!",
        [
            (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, -1),
            (assign, "$auto_enter_town", "$g_encountered_party"),

            (assign, "$g_castle_requested_by_player", "$current_town"),

            (try_for_range, ":party_template_slot", slot_cohort_town_begin, slot_cohort_town_4),
                (party_get_slot, ":party_template", "$g_encountered_party", ":party_template_slot"),
                (ge, ":party_template", 1),
                (call_script, "script_cohort_refil_garrison", "$g_encountered_party", ":party_template", ":party_template_slot",0),
            (try_end),

            (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
            (val_div, reg0, 2),
            (party_set_slot, "$g_encountered_party", slot_party_food_store, reg0),
            # (change_screen_return),
            (change_screen_map),
      ]),

      ("castle_taken_no_claim",[],"Ask for no rewards.",
        [
          (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, -1),
          (assign, "$auto_enter_town", "$g_encountered_party"),

            (try_for_range, ":party_template_slot", slot_cohort_town_begin, slot_cohort_town_4),
                (party_get_slot, ":party_template", "$g_encountered_party", ":party_template_slot"),
                (ge, ":party_template", 1),
                (call_script, "script_cohort_refil_garrison", "$g_encountered_party", ":party_template", ":party_template_slot",0),
            (try_end),

          (call_script, "script_center_get_food_store_limit", "$g_encountered_party"),
          (val_div, reg0, 2),
          (party_set_slot, "$g_encountered_party", slot_party_food_store, reg0),
          # (change_screen_return),
          (change_screen_map),
      ]),
    ],
  ),

(
    "requested_castle_granted_to_player",mnf_scale_picture,
    "You receive a message from {s40}, {s3}.^^\
 {reg4?She:He} has decided to grant {s2}{reg3? and the nearby village of {s4}:} to you to govern it well.",
    "none",
    [
	(try_begin),
		(eq, "$players_kingdom", "fac_kingdom_7"),
		(str_store_string, s40, "@Caesar Augustus"),
	(else_try),
		(str_store_string, s40, "@your liege"),
	(try_end),
	(set_background_mesh, "mesh_pic_messenger"),
		(faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
		(str_store_troop_name, s3, ":faction_leader"),
		(str_store_party_name, s2, "$g_center_to_give_to_player"),
		(try_begin),
			(party_slot_eq, "$g_center_to_give_to_player", slot_party_type, spt_castle),
			(assign, reg3, 1),
			(try_for_range, ":cur_village", villages_begin, villages_end),
				(party_slot_eq, ":cur_village", slot_village_bound_center, "$g_center_to_give_to_player"),
				(str_store_party_name, s4, ":cur_village"),
			(try_end),
		(else_try),
			(assign, reg3, 0),
		(try_end),
		##diplomacy start+ use script for gender
		#(troop_get_type, reg4, ":faction_leader"),#<- OLD
		(call_script, "script_dplmc_store_troop_is_female_reg", ":faction_leader", 4),
		##diplomacy end+
   ],
    [
		("continue",[],"Continue.",
			[
			(call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0),
			(jump_to_menu, "mnu_give_center_to_player_2"),
			],
		),
	]
),

(
    "requested_castle_granted_to_player_husband", mnf_scale_picture,
    "You receive a message from your liege, {s3}.^^\
 {reg4?She:He} has decided to grant {s2}{reg3? and the nearby village of {s4}:} to your husband, {s7}.",
    "none",
    [
		(set_background_mesh, "mesh_pic_messenger"),
		(faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
		(str_store_troop_name, s3, ":faction_leader"),
		(str_store_party_name, s2, "$g_center_to_give_to_player"),
		(try_begin),
			(party_slot_eq, "$g_center_to_give_to_player", slot_party_type, spt_castle),
			(assign, reg3, 1),
			(try_for_range, ":cur_village", villages_begin, villages_end),
				(party_slot_eq, ":cur_village", slot_village_bound_center, "$g_center_to_give_to_player"),
				(str_store_party_name, s4, ":cur_village"),
			(try_end),
		(else_try),
			(assign, reg3, 0),
		(try_end),
		##diplomacy start+ use script for gender
		#(troop_get_type, reg4, ":faction_leader"),#<- OLD
		(call_script, "script_dplmc_store_troop_is_female_reg", ":faction_leader", 4),
		##diplomacy end+

		(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
		(str_store_troop_name, s11, ":spouse"),
		(str_store_string, s7, "str_to_your_husband_s11"),
    ],
    [
		("continue",[],"Continue.",
			[
			(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
			(call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", ":spouse", 0),
			],
		),
	]
),
(
    "requested_castle_granted_to_another",mnf_scale_picture,
    "You receive a message from {s40}, {s3}.^^\
 'I was most pleased to hear of your valiant efforts in the capture of {s2}. Your victory has gladdened all our hearts.\
 You also requested me to give you ownership of the fortress, but that is a favor which I fear I cannot grant,\
 as you already hold significant estates.\
 Instead I have sent you {reg6} denars to cover the expenses of your campaign, but {s2} I give to {s5}.'\
 ",
    "none",
    [
	(try_begin),
		(eq, "$players_kingdom", "fac_kingdom_7"),
		(str_store_string, s40, "@Caesar Augustus"),
	(else_try),
		(str_store_string, s40, "@your liege"),
	(try_end),
	(set_background_mesh, "mesh_pic_messenger"),
     (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
     (str_store_troop_name, s3, ":faction_leader"),
     (str_store_party_name, s2, "$g_center_to_give_to_player"),
     (party_get_slot, ":new_owner", "$g_center_to_give_to_player", slot_town_lord),
     (str_store_troop_name, s5, ":new_owner"),
     (assign, reg6, 5000),
	   (call_script, "script_add_to_troop_wealth",":faction_leader", -5000),
	 (assign, "$g_castle_requested_by_player", -1),
	 (assign, "$g_castle_requested_for_troop", -1),

    ],
    [
      ("accept_decision",[],"Accept the decision.",
       [
       (call_script, "script_troop_add_gold", "trp_player", reg6),
        ##diplomacy start+ Remove gold spent by liege
        (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
        (try_begin),
            (gt, ":faction_leader", 0),
            (neq, ":faction_leader", "trp_kingdom_heroes_including_player_begin"),
            (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", reg6, ":faction_leader"),
        (try_end),
        ##diplomacy end+
       (change_screen_return),
       ]),

       ("leave_faction",[],"You have been wronged!",
       [
         ##diplomacy start+ Remove gold spent by liege
         (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
         (try_begin),
            (gt, ":faction_leader", 0),
            (neq, ":faction_leader", "trp_kingdom_heroes_including_player_begin"),
            (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", reg6, ":faction_leader"),
         (try_end),
         ##diplomacy end+
         (jump_to_menu, "mnu_leave_faction"),
         (call_script, "script_troop_add_gold", "trp_player", reg6),
        ]),
     ],
  ),

(
    "requested_castle_granted_to_another_female",mnf_scale_picture,
##diplomacy start+ make gender correct
    "You receive a message from {s3}.^^\
 'I was most pleased to hear of your valiant efforts in the capture of {s2}. Your victory has gladdened all our hearts.\
 You also requested me to give ownership of the fortress to your {wife/husband}, but that is a favor which I fear I cannot grant,\
 as {she/he} already holds significant estates in my realm.\
 Instead I have sent you {reg6} denars to cover the expenses of your campaign, but {s2} I give to {s5}.'\
 ",
##diplomacy end+
    "none",
    [(set_background_mesh, "mesh_pic_messenger"),
     (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
     (str_store_troop_name, s3, ":faction_leader"),
     (str_store_party_name, s2, "$g_center_to_give_to_player"),
     (party_get_slot, ":new_owner", "$g_center_to_give_to_player", slot_town_lord),
     (str_store_troop_name, s5, ":new_owner"),
     (assign, reg6, 1500),

	 (assign, "$g_castle_requested_by_player", -1),
	 (assign, "$g_castle_requested_for_troop", -1),
    ],

    [
		("accept_decision",[],"Accept the decision.",
        [
        (call_script, "script_troop_add_gold", "trp_player", reg6),
        (change_screen_return),
        ]),
    ],
),

  (
    "leave_faction",0,
    "Renouncing your oath is a grave act. Your lord may condemn you and confiscate your lands and holdings.\
 However, if you return them of your own free will, he may let the betrayal go without a fight.",
    "none",
    [
    ],
    [
      ("leave_faction_give_back", [], "Renounce your oath and give up your holdings.",
       [
#Troop commentary changes begin
#        (call_script, "script_add_log_entry", logent_renounced_allegiance,   "trp_player",  -1, "$g_talk_troop", "$g_talk_troop_faction"),
#Troop commentary changes end
        (call_script, "script_player_leave_faction", 1), #1 means give back fiefs
        (change_screen_return),
        ]),
      ("leave_faction_hold", [
          (str_store_party_name, s2, "$g_center_to_give_to_player"),
          ], "Renounce your oath and rule your lands, including {s2}, in your own name.",
       [
        (call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0), #this should activate the player faction (it does not)
        (call_script, "script_player_leave_faction", 0), #"1" would mean give back fiefs
        (call_script, "script_activate_player_faction", "trp_player"), #Activating player faction should now work
        (change_screen_return),
        ]),
      ("leave_faction_cancel", [], "Remain loyal and accept the decision.",
       [
        (change_screen_return),
        ]),
    ],
  ),

  (
    "give_center_to_player",mnf_scale_picture,
##diplomacy start+ fix gender of pronoun
    "{s40}\
 {s1} sends word that {reg4?she:he} is willing to grant {s2} to you in payment for your loyal service,\
 adding it to your holdings. What is your answer?",
##diplomacy end+
    "none",
    [
	(try_begin),
		(eq, "$players_kingdom", "fac_kingdom_7"),
		(str_store_string, s40, "@Caesar Augustus wants you to govern land."),
	(else_try),
		(str_store_string, s40, "@Your liege offers to extend your fiefs!"),
	(try_end),
	(set_background_mesh, "mesh_pic_messenger"),
     (store_faction_of_party, ":center_faction", "$g_center_to_give_to_player"),
     (faction_get_slot, ":faction_leader", ":center_faction", slot_faction_leader),
     ##diplomacy start+ put king's gender in reg4
     (call_script, "script_dplmc_store_troop_is_female_reg", ":faction_leader", 4),
     ##diplomacy end+
     (str_store_troop_name, s1, ":faction_leader"),
     (str_store_party_name, s2, "$g_center_to_give_to_player"),
    ],
    [
      ("give_center_to_player_accept",[],"Accept the offer.",
       [(call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0),
        (jump_to_menu, "mnu_give_center_to_player_2"),
        ]),
      ("give_center_to_player_reject",[],"Reject. You have no interest in holding {s2}.",
       [(party_set_slot, "$g_center_to_give_to_player", slot_town_lord, stl_rejected_by_player),
        (change_screen_return),
        ]),
    ],
  ),

  (
    "give_center_to_player_2",0,
    "With a brief ceremony, you are officially confirmed as the new {s40} of {s2}{reg3? and its bound village {s4}:}.\
 {reg3?They:It} will make a fine part of your domain.\
 You can now claim the rents and revenues from your personal estates there, draft soldiers from the populace,\
 and manage the lands as you see fit.\
 However, you are also expected to defend your lands and your people from harm,\
 as well as maintaining the rule of law and order.",
    "none",
    [
	(try_begin),
		(eq, "$players_kingdom", "fac_kingdom_7"),
		(str_store_string, s40, "@ Governor."),
	(else_try),
		(str_store_string, s40, "@ Lord"),
	(try_end),
	(set_background_mesh, "mesh_pic_messenger"),
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
      (assign, reg3, 0),
      (try_begin),
        (party_slot_eq, "$g_center_to_give_to_player", slot_party_type, spt_castle),
        (try_for_range, ":cur_village", villages_begin, villages_end),
          (party_slot_eq, ":cur_village", slot_village_bound_center, "$g_center_to_give_to_player"),
          (str_store_party_name, s4, ":cur_village"),
          (assign, reg3, 1),
        (try_end),
      (try_end),
    ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
    ],
  ),

  (
    "oath_fulfilled",0,
##diplomacy start+ fix gender of pronoun
    "You had a contract with {s1} to serve {reg4?her:him} for a certain duration.\
 Your contract has now expired. What will you do?",
##diplomacy end+
    "none",
    [
      (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
      ##diplomacy start+ load king's gender into reg4
      (call_script, "script_dplmc_store_troop_is_female", ":faction_leader"),
      (assign, reg4, reg0),
      ##diplomacy end+
      (str_store_troop_name, s1, ":faction_leader"),
     ],
    [
      ("renew_oath",[(faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
                     (str_store_troop_name, s1, ":faction_leader")], "Renew your contract with {s1} for another month.",
       [
         (store_current_day, ":cur_day"),
         (store_add, "$mercenary_service_next_renew_day", ":cur_day", 30),
         (change_screen_return),
         ]),
      ("dont_renew_oath",[],"Become free of your bond.",
       [
         (call_script, "script_player_leave_faction", 1), #1 means give back fiefs
         (change_screen_return),
         ]),
    ]
  ),

("siege_started_defender",mnf_enable_hot_keys,
  "{s1} is launching an assault against the walls of {s2}."
  +" You have {reg10} troops fit for battle against the enemy's {reg11}.^^{s31}^^You decide to...",
  "none",[
    (select_enemy,1),
    (assign, "$g_enemy_party", "$g_encountered_party_2"),
    (assign, "$g_ally_party", "$g_encountered_party"),
    (str_store_party_name, s1, "$g_enemy_party"),
    (str_store_party_name, s2, "$g_ally_party"),
    (call_script, "script_encounter_calculate_fit"),
    (try_begin),
      (eq, "$g_siege_first_encounter", 1),
      (call_script, "script_let_nearby_parties_join_current_battle", 0, 1),
      ###diplomacy start+
      ##If terrain advantage is on, use siege settings
          #(assign, ":save_dplmc_terrain_advantage", "$g_dplmc_terrain_advantage"),
      #(try_begin),
      #   (eq, "$g_dplmc_terrain_advantage", TERRAIN_ADVANTAGE_ENABLE),
      #   (assign, "$g_dplmc_terrain_advantage", TERRAIN_ADVANTAGE_FORCE_SIEGE),
      #(try_end),
      ###diplomacy end+
      (call_script, "script_encounter_init_variables"),
      ###diplomacy start+
      ##Revert terrain advantage settings
      #(assign, "$g_dplmc_terrain_advantage", ":save_dplmc_terrain_advantage"),
      ###diplmacy end+
    (try_end),

    (try_begin),
      (eq, "$g_siege_first_encounter", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":num_enemy_regulars_remaining", reg0),
        (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
        (assign, ":num_ally_regulars_remaining", reg0),
        (assign, ":enemy_finished", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (eq, ":num_enemy_regulars_remaining", 0), #battle won (TODO : compare with num_routed_us)
          (assign, ":enemy_finished",1),
        (else_try),
          (eq, "$g_engaged_enemy", 1),
          (le, "$g_enemy_fit_for_battle",0),
          (ge, "$g_friend_fit_for_battle",1),
          (assign, ":enemy_finished",1),
        (try_end),
        (this_or_next|eq, ":enemy_finished",1),
        (eq,"$g_enemy_surrenders",1),
        (assign, "$g_next_menu", -1),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (assign, ":battle_lost", 0),
        (try_begin),
          (this_or_next|eq, "$g_battle_result", -1),
          (troop_is_wounded,  "trp_player"),
          (eq, ":num_ally_regulars_remaining", 0), #(TODO : compare with num_routed_allies)
          (assign, ":battle_lost",1),
        (try_end),
        (this_or_next|eq, ":battle_lost",1),
        (eq,"$g_player_surrenders",1),
        (assign, "$g_next_menu", "mnu_captivity_start_under_siege_defeat"),
        (jump_to_menu, "mnu_total_defeat"),
      (else_try),
        # Ordinary victory/defeat.
        (assign, ":attackers_retreat", 0),
        (try_begin),
        #check whether enemy retreats
          (eq, "$g_battle_result", 1),
          (assign, ":attackers_retreat", 1),
        (else_try), #fix this
          (eq, "$g_battle_result", 0),
          (store_div, ":min_enemy_str", "$g_enemy_fit_for_battle", 3),
          (lt, ":min_enemy_str", "$g_friend_fit_for_battle"),
          (assign, ":attackers_retreat", 1),
        (else_try),
          (store_random_in_range, ":random_no", 0, 100),
          (store_mul, ":num_ally_regulars_remaining_multiplied", ":num_ally_regulars_remaining", 13),
          (val_div, ":num_ally_regulars_remaining_multiplied", 10),
          (ge, ":num_ally_regulars_remaining_multiplied", ":num_enemy_regulars_remaining"),
          (lt, ":random_no", 10),
          (neq, "$new_encounter", 1),
          (assign, ":attackers_retreat", 1),
        (try_end),
        (try_begin),
          (eq, ":attackers_retreat", 1),
          (party_get_slot, ":siege_hardness", "$g_encountered_party", slot_center_siege_hardness),
          (val_add, ":siege_hardness", 100),
          (party_set_slot, "$g_encountered_party", slot_center_siege_hardness, ":siege_hardness"),
          (party_set_slot, "$g_enemy_party", slot_party_retreat_flag, 1),

          (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
            (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
            #(troop_slot_eq, ":troop_no", slot_troop_is_prisoner, 0),
            (neg|troop_slot_ge, ":troop_no", slot_troop_prisoner_of_party, 0),
            (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
            (gt, ":party_no", 0),
            (party_slot_eq, ":party_no", slot_party_ai_state, spai_besieging_center),
            (party_slot_eq, ":party_no", slot_party_ai_object, "$g_encountered_party"),
            (party_slot_eq, ":party_no", slot_party_ai_substate, 1),
            (call_script, "script_party_set_ai_state", ":party_no", spai_undefined, -1),
            (call_script, "script_party_set_ai_state", ":party_no", spai_besieging_center, "$g_encountered_party"),
          (try_end),
          (display_message, "@The enemy has been forced to retreat. The assault is over, but the siege continues."),
          (assign, "$g_battle_simulation_cancel_for_party", "$g_encountered_party"),
          (leave_encounter),
          (change_screen_return),
          (assign, "$g_battle_simulation_auto_enter_town_after_battle", "$g_encountered_party"),
        (try_end),
      (try_end),
    (try_end),

    (party_get_slot, ":town_food_store", "$g_encountered_party", slot_party_food_store),
    (call_script, "script_center_get_food_consumption", "$g_encountered_party"),
    (assign, ":food_consumption", reg0),
    (assign, reg7, ":food_consumption"),
    (assign, reg8, ":town_food_store"),
    (store_div, reg3, ":town_food_store", ":food_consumption"),

    (try_begin),
      (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
      (assign, reg6, 1),
    (else_try),
      (assign, reg6, 0),
    (try_end),

    (try_begin),
      (gt, reg3, 0),
      (str_store_string, s31, "@The {reg6?town's:fort's} food stores should last for {reg3} more days."),
    (else_try),
      (str_store_string, s31, "@The {reg6?town's:fort's} food stores have run out and the defenders are starving."),
    (try_end),
  ],[
    ("siege_defender_castle",[
      #SB : some gender string tweaks
      (try_begin),
        (party_get_slot, ":town_lord", "$current_town", slot_town_lord),
        (lt, ":town_lord", 0),
        (assign, reg4, 0), #default to lord
      (else_try),
        (call_script, "script_dplmc_store_troop_is_female_reg", ":town_lord", 4),
      (try_end),
      #possibly replace "the" with "your"
    ],"Go to the {reg4?Lady:Lord}'s hall.",[
      (call_script, "script_enter_court", "$current_town", -1),
    ], "Door to the hall."),

    ("dplmc_negotiate_with_besieger",
    [
      (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
      (party_slot_ge, "$current_town", slot_center_is_besieged_by, 1),
    ],"Negotiate with the besieger.",[
      (jump_to_menu, "mnu_dplmc_negotiate_besieger"),
    ]),

    ("siege_defender_join_battle",[
      (neg|troop_is_wounded, "trp_player"),
    ], "Join the battle.",[
      (try_begin),
          (troop_is_wounded, "trp_player"),
          (display_message,"@Your wounds are too severe to fight.",message_locked),
      (else_try),
          (assign, "$g_siege_first_encounter", 0), #dckplmc - moved from main menu conditions
          (assign, "$new_encounter", 0),

          (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
          (assign, "$g_battle_result", 0),
          (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
            (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
          (else_try),
            (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
          (try_end),
          (call_script, "script_calculate_battle_advantage"),
          (val_mul, reg0, 2),
          (val_div, reg0, 3), #scale down the advantage a bit.
          (set_battle_advantage, reg0),
          (set_party_battle_mode),
          (assign, "$temp4", 2),
          (set_jump_mission,"mt_castle_attack_walls_ladder"),
          (jump_to_scene,":battle_scene"),
          (assign, "$g_next_menu", "mnu_siege_started_defender"),
          (jump_to_menu, "mnu_battle_debrief"),
          (change_screen_mission),
      (try_end),
    ], "Join the defense."),

    ("siege_defender_join_battle",[
      (neg|troop_is_wounded, "trp_player"),
    ], "Sally out.",[
      (assign, "$g_siege_first_encounter", 0), #dckplmc - moved from main menu conditions
      (assign, "$new_encounter", 0),

      (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
      (assign, "$g_battle_result", 0),
      # (try_begin),
        # (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        # (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
      # (else_try),
        # (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
      # (try_end),
      (call_script, "script_calculate_battle_advantage"),
      (val_mul, reg0, 2),
      (val_div, reg0, 3), #scale down the advantage a bit.
      (set_battle_advantage, reg0),
      (set_party_battle_mode),
      (set_jump_mission,"mt_castle_attack_walls_defenders_sally"),
      #(jump_to_scene,":battle_scene"),
      (call_script, "script_setup_random_scene"),
      (assign, "$g_next_menu", "mnu_siege_started_defender"),
      (jump_to_menu, "mnu_battle_debrief"),
      (change_screen_mission),
    ]),

    ("siege_defender_troops_join_battle",[
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (this_or_next|troop_is_wounded,  "trp_player"),
      (ge, reg0, 3),
      (eq, "$enlisted_party", -1),
    ],"Order your men to join the battle without you.",[
      (assign, "$g_siege_first_encounter", 0), #dckplmc - moved from main menu conditions
      (assign, "$new_encounter", 0),

      (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
      (select_enemy,1),
      (assign,"$g_enemy_party","$g_encountered_party_2"),
      (assign,"$g_ally_party","$g_encountered_party"),
      (assign,"$g_siege_join", 1),
      (jump_to_menu,"mnu_siege_join_defense")
    ]),
    ("siege_defender_troops_join_battle",[
      (gt, "$enlisted_party", -1),
    ],"Stay back and let the others fight.",[
      (assign, "$g_siege_first_encounter", 0), #dckplmc - moved from main menu conditions
      (assign, "$new_encounter", 0),
      (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
      (select_enemy,1),
      (assign,"$g_enemy_party","$g_encountered_party_2"),
      (assign,"$g_ally_party","$g_encountered_party"),
      (assign,"$g_siege_join", 1),
      (jump_to_menu,"mnu_siege_join_defense_freelancer")
    ]),
]),

("siege_join_defense",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
	    ###diplomacy start+
		##If terrain advantage is on, use siege settings
        #(assign, ":save_dplmc_terrain_advantage", "$g_dplmc_terrain_advantage"),
		##(assign, "$g_dplmc_terrain_advantage", ":save_dplmc_terrain_advantage"),
		#(try_begin),
		#   (eq, "$g_dplmc_terrain_advantage", TERRAIN_ADVANTAGE_ENABLE),
		#   (assign, "$g_dplmc_terrain_advantage", TERRAIN_ADVANTAGE_FORCE_SIEGE),
		#(try_end),
		###diplomacy end+
        (try_begin),
          (eq, "$g_siege_join", 1),
          (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
          (assign, ":player_party_strength", reg0),
          (val_div, ":player_party_strength", 5),
        (else_try),
          (assign, ":player_party_strength", 0),
        (try_end),

        (call_script, "script_party_calculate_strength", "p_collective_ally", 0),
        (assign, ":ally_party_strength", reg0),
        (val_div, ":ally_party_strength", 5),
        (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 10),

        (store_add, ":friend_party_strength", ":player_party_strength", ":ally_party_strength"),
        (try_begin),
          (eq, ":friend_party_strength", 0),
          (store_div, ":enemy_party_strength_for_p", ":enemy_party_strength", 2),
        (else_try),
          (assign, ":enemy_party_strength_for_p", ":enemy_party_strength"),
          (val_mul, ":enemy_party_strength_for_p", ":player_party_strength"),
          (val_div, ":enemy_party_strength_for_p", ":friend_party_strength"),
        (try_end),

        (val_sub, ":enemy_party_strength", ":enemy_party_strength_for_p"),
        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength_for_p", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_ally_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
        (party_collect_attachments_to_party, "$g_ally_party", "p_collective_ally"),

        (inflict_casualties_to_party_group, "$g_enemy_party", ":friend_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s10, s0),
        (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),

        (try_begin),
          (call_script, "script_party_count_members_with_full_health","p_main_party"),
          (le, reg0, 0),
          (str_store_string, s4, "str_siege_defender_order_attack_failure"),
        (else_try),
          (call_script, "script_party_count_members_with_full_health","p_collective_enemy"),
          (le, reg0, 0),
          (assign, "$g_battle_result", 1),
          (str_store_string, s4, "str_siege_defender_order_attack_success"),
        (else_try),
          (str_store_string, s4, "str_siege_defender_order_attack_continue"),
        (try_end),
		###diplomacy start+
		##Revert terrain advantage settings
		#(assign, "$g_dplmc_terrain_advantage", ":save_dplmc_terrain_advantage"),
		###diplomacy end+
    ],
    [
      ("continue",[],"Continue...",[
        (jump_to_menu,"mnu_siege_started_defender"),
      ]),
]),

  (
    "siege_join_defense_freelancer",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
	    ###diplomacy start+
		##If terrain advantage is on, use siege settings
        #(assign, ":save_dplmc_terrain_advantage", "$g_dplmc_terrain_advantage"),
		##(assign, "$g_dplmc_terrain_advantage", ":save_dplmc_terrain_advantage"),
		#(try_begin),
		#   (eq, "$g_dplmc_terrain_advantage", TERRAIN_ADVANTAGE_ENABLE),
		#   (assign, "$g_dplmc_terrain_advantage", TERRAIN_ADVANTAGE_FORCE_SIEGE),
		#(try_end),
		###diplomacy end+
        (try_begin),
          (eq, "$g_siege_join", 1),
          (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
          (assign, ":player_party_strength", reg0),
          (val_div, ":player_party_strength", 5),
        (else_try),
          (assign, ":player_party_strength", 0),
        (try_end),

        (call_script, "script_party_calculate_strength", "p_collective_ally", 0),
        (assign, ":ally_party_strength", reg0),
        (val_div, ":ally_party_strength", 5),
        (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 10),

        (store_add, ":friend_party_strength", ":player_party_strength", ":ally_party_strength"),
        (try_begin),
          (eq, ":friend_party_strength", 0),
          (store_div, ":enemy_party_strength_for_p", ":enemy_party_strength", 2),
        (else_try),
          (assign, ":enemy_party_strength_for_p", ":enemy_party_strength"),
          (val_mul, ":enemy_party_strength_for_p", ":player_party_strength"),
          (val_div, ":enemy_party_strength_for_p", ":friend_party_strength"),
        (try_end),

        (val_sub, ":enemy_party_strength", ":enemy_party_strength_for_p"),
        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength_for_p", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_ally_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
        (party_collect_attachments_to_party, "$g_ally_party", "p_collective_ally"),

        (inflict_casualties_to_party_group, "$g_enemy_party", ":friend_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s10, s0),
        (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),

        (try_begin),
          (call_script, "script_party_count_members_with_full_health","$enlisted_party"),
          (le, reg0, 0),
          (str_store_string, s4, "str_siege_defender_order_attack_failure"),
        (else_try),
          (call_script, "script_party_count_members_with_full_health","p_collective_enemy"),
          (le, reg0, 0),
          (assign, "$g_battle_result", 1),
          (str_store_string, s4, "str_siege_defender_order_attack_success"),
        (else_try),
          (str_store_string, s4, "str_siege_defender_order_attack_continue"),
        (try_end),
		###diplomacy start+
		##Revert terrain advantage settings
		#(assign, "$g_dplmc_terrain_advantage", ":save_dplmc_terrain_advantage"),
		###diplomacy end+
    ],
    [
      ("continue",[],"Continue...",[
          (jump_to_menu,"mnu_siege_started_defender"),
          ]),
    ]
  ),

  (
    "enter_your_own_castle",0,
    "{s10}",
    "none",
    [
    (try_begin),
	  ##diplomacy start+ Add support for the player as co-ruler of an NPC faction
	    (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
      #(neg|is_between, "$supported_pretender", pretenders_begin, pretenders_end), #SB : exception for honorific
      (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", "$players_kingdom"),
      (ge, reg0, DPLMC_FACTION_STANDING_LEADER_SPOUSE),
      (try_begin),
        (eq, "$character_gender", tf_female),
        (call_script, "script_dplmc_print_cultural_word_to_sreg", "trp_player", DPLMC_CULTURAL_TERM_KING_FEMALE, s10),
      (else_try),
        (call_script, "script_dplmc_print_cultural_word_to_sreg", "trp_player", DPLMC_CULTURAL_TERM_KING, s10),
      (try_end),
      (str_store_string, s10, "@As you approach, you are spotted by the guards, who welcome you and open the gates for their {s10}."),
	  (else_try),
	  ##diplomacy end+
        (neg|is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
        (faction_get_slot, ":faction_leader", "fac_player_supporters_faction", slot_faction_leader),
        (eq, ":faction_leader", "trp_player"),
        (str_store_string, s10, "@As you approach, you are spotted by the guards, who welcome you and open the gates for their {king/queen}."),
      (else_try),
        (str_store_string, s10, "@As you approach, you are spotted by the guards, who welcome you and open the gates for their {lord/lady}."),
      (try_end),

      (str_store_party_name, s2, "$current_town"),
    ],
    [
      ("continue",[],"Continue...",
       [ (jump_to_menu,"mnu_town"),
        ]),
    ],
  ),

("village",mnf_enable_hot_keys,
  "{s10} {s12}^{s11}^{s6}{s7}^^{s44}",
  "none",[
    (str_clear, s10),
    (str_clear, s11),
    (str_clear, s12),
    (str_clear, s6),
    (str_clear, s7),
    (str_clear, s44),

    (assign, "$current_town", "$g_encountered_party"),
    (call_script, "script_update_center_recon_notes", "$current_town"),

    (party_get_slot, ":disease", "$current_town", slot_center_disease),
    (try_begin),
        (ge, ":disease", 1),
        (call_script, "script_get_event_details", ":disease"),
        (str_store_string, s44, "@The village is haunted by an outbreak of {s0}."),
    (try_end),
    (party_get_slot, ":event", "$current_town", slot_center_event),
    (try_begin),
        (ge, ":event", 1),
        (call_script, "script_get_event_details", ":event"),
        (try_begin),
            (lt, reg1, 0),
            (str_store_string, s44, "@The village has recently suffered from {s0}.^^{s44}"),
        (else_try),
            (str_store_string, s44, "@The village has recently been blessed by a {s0}.^^{s44}"),
        (try_end),
    (try_end),

    (assign, "$g_defending_against_siege", 0), #required for bandit check
    (assign, "$g_battle_result", 0),
    (assign, "$qst_collect_taxes_currently_collecting", 0),
    (assign, "$qst_train_peasants_against_bandits_currently_training", 0),

    (try_begin),
        (gt, "$auto_enter_menu_in_center", 0),
        (jump_to_menu, "$auto_enter_menu_in_center"),
        (assign, "$auto_enter_menu_in_center", 0),
    (try_end),

    (try_begin),
        (neq, "$g_player_raiding_village",  "$current_town"),
        (assign, "$g_player_raiding_village", 0),
    (else_try),
        (jump_to_menu, "mnu_village_loot_continue"),
    (try_end),

    (try_begin),#Fix for collecting taxes
        (eq, "$g_town_visit_after_rest", 1),
        (assign, "$g_town_visit_after_rest", 0),
    (try_end),

    (str_store_party_name,s2, "$current_town"),
    (party_get_slot, ":center_lord", "$current_town", slot_town_lord),
    (store_faction_of_party, ":center_faction", "$current_town"),
    (str_store_faction_name,s9,":center_faction"),
    (try_begin),
        (ge, ":center_lord", 0),
        (str_store_troop_name,s8,":center_lord"),
        (str_store_string,s7,"@{s8} of {s9}"),
    (try_end),

    (try_begin),
        (neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
        (str_store_string, s60, s2),

        (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
        (try_begin),
            (eq, "$cheat_mode", 1),
            (assign, reg4, ":prosperity",),
            (display_message, "@{!}Prosperity: {reg4}"),
        (try_end),
		  #(val_add, ":prosperity", 5),
        (store_div, ":str_id", ":prosperity", 10),
        (val_min, ":str_id", 9),
        (val_add, ":str_id", "str_village_prosperity_0"),
        (str_store_string, s10, ":str_id"),
        (store_div, ":str_id", ":prosperity", 20),
        (val_min, ":str_id", 4),
        (party_get_current_terrain, ":terrain", "$current_town"),
        # (party_get_slot, ":culture", "$current_town", slot_center_culture),
        (try_begin),
            #(is_between, "$current_town", "p_village_91", villages_end),
            (this_or_next|eq, ":terrain", rt_desert),
            (eq, ":terrain", rt_desert_forest),
            (val_add, ":str_id", "str_oasis_village_alt_prosperity_0"),
        (else_try),
            (val_add, ":str_id", "str_village_alt_prosperity_0"),
        (try_end),
        (str_store_string, s12, ":str_id"),
    (try_end),

    ##diplomacy start+
    (assign, ":save_reg0", reg0),#save variables
		(assign, ":save_reg4", reg4),
		(assign, reg0, 0),
		(assign, reg4, 0),
		(try_begin),#If there's a relation of some kind, write it to s11 (which we'll overwrite below)
			  (lt, ":center_lord", 1),
		(else_try),
        #your relative
        (call_script, "script_troop_get_family_relation_to_troop", ":center_lord", "trp_player"),#outputs to s11, reg0, and reg4
        (ge, reg0, 1),#Fall through if this not a relative
		(else_try),
        #your current liege
        (eq, ":center_faction", "$players_kingdom"),
        (is_between, ":center_faction", kingdoms_begin, kingdoms_end),#include fac_player_supporters_faction for claimant quest
        (faction_slot_eq, ":center_faction", slot_faction_leader, ":center_lord"),
        (try_begin),
            (faction_slot_eq, ":center_faction", slot_faction_culture, "fac_culture_7"),
            (str_store_string, s11, "@Princeps"),
        (else_try),
            (str_store_string, s11, "@liege"),
        (try_end),
        (assign, reg0, 1),
		(else_try),
        #your former liege if you renounced a kingdom
        (eq, ":center_faction", "$players_oath_renounced_against_kingdom"),
        (is_between, ":center_faction", npc_kingdoms_begin, npc_kingdoms_end),
        (neg|faction_slot_eq, ":center_faction", slot_faction_culture, "fac_culture_7"),
        (faction_slot_eq, ":center_faction", slot_faction_leader, ":center_lord"),
        (str_store_string, s11, "@former liege"),
        (assign, reg0, 1),
		(else_try),
			  #stop here for lords you haven't met, or non-hero troops
			  (this_or_next|neg|troop_is_hero, ":center_lord"),
			  (troop_slot_eq, ":center_lord", slot_troop_met, 0),
		(else_try),
        #check for affiliates
        (call_script, "script_dplmc_is_affiliated_family_member", ":center_lord"),
        (ge, reg0, 1),
        (try_begin),
				    (ge, "$g_encountered_party_relation", 0),#don't say "ally" when you might fight them, as that's confusing
				    (str_store_string, s11, "str_dplmc_ally"),
			  (else_try),
				    (str_store_string, s11, "@affiliate"),
			  (try_end),
		(else_try),
        #check for former companions
        (call_script, "script_troop_get_player_relation", ":center_lord"),
        (is_between, ":center_lord", companions_begin, companions_end),
        (neg|troop_slot_eq, ":center_lord", slot_troop_playerparty_history, dplmc_pp_history_nonplayer_entry),
        (try_begin),
            (ge, "$g_encountered_party_relation", 0),#don't say "ally" when you might fight them, as that's confusing
            (ge, reg0, 50),
            (str_store_string, s11, "str_dplmc_ally"),
			  (else_try),
            (ge, "$g_encountered_party_relation", 0),
            (ge, reg0, 20),
            (str_store_string, s11, "str_dplmc_friend"),
			  (else_try),
			  	  (str_store_string, s11, "@former companion"),
        (try_end),
        (assign, reg0, 1),
		(else_try),
        #don't print "friend" if you might fight them
        (lt, "$g_encountered_party_relation", 0),
        (assign, reg0, 0),
		(else_try), #SB : local instead of reg
			  #check for friends
        (call_script, "script_troop_get_player_relation", ":center_lord"),
			  (store_div, ":relation", reg0, 50),#right now reg0 holds the relation with the player
			  (gt, ":relation", 1),
			  (str_store_string, s11, "str_dplmc_friend"),
        (assign, reg0, 1),
		(else_try),
        #check for marshall
        (eq, ":center_faction", "$players_kingdom"),
        (faction_slot_eq, ":center_faction", slot_faction_marshall, ":center_lord"),
        (str_store_string, s11, "@marshall"),
		(else_try),
        #check for vassal of player if nothing else to say
        (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", ":center_faction"),
        (val_add, reg0, 1),
        (val_sub, reg0, DPLMC_FACTION_STANDING_LEADER_SPOUSE),
        (ge, reg0, 1),
        (str_store_string, s11, "@vassal"),
		(else_try),
			  (assign, reg0, 0),
		(try_end),
		##diplomacy end+
    (try_begin),
        # (party_slot_eq, "$current_town", slot_village_state, svs_looted),
        # #SB : cancel string clear
        # (str_clear, s11),
      # (else_try),
        (eq, ":center_lord", "trp_player"),
        (str_store_string,s11,"@ This village and the surrounding lands belong to you."),
		##diplomacy start+ If reg0 > 0, a relation string has been written into s11
		(else_try),
        (ge, reg0, 1),
        (str_store_string,s11,"@ You remember that this village and the surrounding lands belong to your {s11} {s7}."),
    ##diplomacy end+
    (else_try),
        (ge, ":center_lord", 0),
        (str_store_string,s11,"@ You remember that this village and the surrounding lands belong to {s7}."),
    (else_try),
        (str_store_string,s11,"@ These lands belong to no one."),
    (try_end),
    ##diplomacy start+
		(assign, reg0, ":save_reg0"),#revert registers
		(assign, reg4, ":save_reg4"),
		##diplomacy end+

    (try_begin),
        (neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
        (party_get_slot, ":center_relation", "$current_town", slot_center_player_relation),
        (call_script, "script_describe_center_relation_to_s3", ":center_relation"),
        (assign, reg9, ":center_relation"),
        (str_store_string, s7, "@{!} {s3} ({reg9})."),
    (try_end),
    (try_begin),
        (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
        (party_get_slot, ":bandit_troop", "$current_town", slot_village_infested_by_bandits),
        (store_character_level, ":player_level", "trp_player"),
        (val_min, ":player_level", 63),
        (val_div, ":player_level", 2),
        (faction_get_slot, ":slave_law", ":center_faction", dplmc_slot_faction_serfdom),
        (val_mul, ":slave_law", 2),
        (val_add, ":slave_law", 100),
        (store_mul, "$qst_eliminate_bandits_infesting_village_num_bandits", ":player_level", ":slave_law"),
        (val_div, "$qst_eliminate_bandits_infesting_village_num_bandits", 100),

        (val_max, "$qst_eliminate_bandits_infesting_village_num_bandits", 65), #dckplmc - no less than 45 bandits

        # (party_get_num_companions, ":party_size", "$current_town"), #ideal size is 50
        (call_script, "script_party_count_fit_regulars", "$current_town"),
        (assign, ":party_size", reg0),
        (store_div, ":lower_size", ":party_size", 3), #about 2/3rd stay back
        (store_div, ":limit", ":center_relation", 5),
        (val_add, ":limit", 60),
        (store_random_in_range, "$qst_eliminate_bandits_infesting_village_num_villagers", ":lower_size", ":limit"),
        (val_min, "$qst_eliminate_bandits_infesting_village_num_villagers", ":party_size"),
        (assign, reg8, "$qst_eliminate_bandits_infesting_village_num_bandits"),
        (str_store_troop_name_by_count, s35, ":bandit_troop", "$qst_eliminate_bandits_infesting_village_num_bandits"),
        (str_store_string, s6, "@ The village is infested by {reg8} {s35}."),

        (assign, "$g_enemy_party", -1), #new, no known enemy party while saving village from bandits
        (assign, "$g_ally_party", -1), #new, no known enemy party while saving village from bandits

        ## SB : adjust meshes as well
        (try_begin),
            (eq, ":bandit_troop", "trp_forest_bandit"),
            (set_background_mesh, "mesh_pic_forest_bandits"),
        (else_try),
            (this_or_next|eq, ":bandit_troop", "trp_steppe_bandit"),
            (eq, ":bandit_troop", "trp_desert_bandit"),
            (set_background_mesh, "mesh_pic_steppe_bandits"),
        (else_try),
            (this_or_next|eq, ":bandit_troop", "trp_steppe_bandit"),
            (eq, ":bandit_troop", "trp_taiga_bandit"),
            (set_background_mesh, "mesh_pic_mountain_bandits"),
        (else_try),
            (eq, ":bandit_troop", "trp_sarranid_horseman"),
            (set_background_mesh, "mesh_pic_numider"),
        (else_try),
            (eq, ":bandit_troop", "trp_meroe_archers"),
            (set_background_mesh, "mesh_pic_nubian"),
        (else_try),
            (this_or_next|eq, ":bandit_troop", "trp_black_sea_priate"),
            (eq, ":bandit_troop", "trp_sea_raider"),
            (set_background_mesh, "mesh_pic_sea_raiders"),
        (else_try),
            (store_faction_of_troop, ":faction_no", ":bandit_troop"),
            (this_or_next|is_between, ":faction_no", kingdoms_begin, kingdoms_end),
            (eq, ":faction_no", "fac_deserters"),
            (set_background_mesh, "mesh_pic_deserters"),
        (else_try),
           ##diplmacy begin
            (eq, ":bandit_troop", "trp_peasant_woman"),
            #SB : preview actual amount of mercs
            # (party_get_num_companions, reg8, "$current_town"),
            # (party_count_members_of_type, ":amount", "$current_town", "trp_farmer"),
            # (val_sub, reg8, ":amount"),
            # (party_count_members_of_type, ":amount", "$current_town", "trp_peasant_woman"),
            # (val_sub, reg8, ":amount"),
            (str_store_string, s6, "@ The peasants are rebelling against you."),
            (set_background_mesh, "mesh_pic_villageriot"),
        (else_try),
           ##diplomacy end
            (set_background_mesh, "mesh_pic_bandits"),
        (try_end),
    (else_try),
        (this_or_next|party_slot_eq, "$current_town", slot_village_state, svs_looted),
        (party_slot_eq, "$current_town", slot_village_state, svs_deserted),
        (str_store_string, s6, "@ The village has been looted. A handful of souls scatter as you pass through the burnt out houses."),
        (try_begin),
            (neq, "$g_player_raid_complete", 1),
            (play_track, "track_empty_village", 1),
        (try_end),
        (set_background_mesh, "mesh_pic_looted_village"),
    (else_try),
        (party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
        (str_store_string, s6, "@ The village is being raided."),
    (else_try), #SB : script call
        (call_script, "script_set_town_picture"),
    (try_end),

    (try_begin),
        (eq, "$g_player_raid_complete", 1),
        (try_begin), #SB : branching menu
            (party_slot_eq, "$current_town", slot_village_state, svs_looted),
            (jump_to_menu, "mnu_village_loot_complete"),
        (else_try), #stay on this menu
            (party_slot_eq, "$current_town", slot_village_state, svs_deserted),
            (jump_to_menu, "mnu_village_enslave_complete"),
        (try_end),
        (assign, "$g_player_raid_complete", 0),
        #SB : reinforce quest state
        (try_begin),
            (check_quest_active, "qst_hunt_down_fugitive"),
            (quest_slot_eq, "qst_hunt_down_fugitive", slot_quest_target_center, "$current_town"),
            (quest_set_slot, "qst_hunt_down_fugitive", slot_quest_current_state, 3),
        (try_end),
    (else_try),
        (party_get_slot, ":raider_party", "$current_town", slot_village_raided_by),
        (gt, ":raider_party", 0),
      # Process here...
    (try_end),

    (try_begin),
        (eq,"$g_leave_town",1),
        (assign,"$g_leave_town",0),
        (change_screen_return),
    (try_end),

    (try_begin),
        (store_time_of_day, ":cur_hour"),
        (ge, ":cur_hour", 5),
        (lt, ":cur_hour", 21),
        (assign, "$town_nighttime", 0),
    (else_try),
        (assign, "$town_nighttime", 1),
    (try_end),
  ],[
    ("visit_mine",[
      (this_or_next|party_slot_ge, "$current_town", slot_center_iron_deposits, 1),
      (party_slot_ge, "$current_town", slot_center_silver_deposits, 1),
      (call_script, "script_cf_village_normal_cond", "$current_town"), #SB : script condition
    ],"Visit the local mine.",[
      (jump_to_menu, "mnu_mine"),
    ]),
    ("village_manage",[
      (call_script, "script_cf_village_normal_cond", "$current_town"), #SB : script condition
      (assign, reg0, 0),
      (try_begin),
        (store_faction_of_party, ":fac", "$current_town"),
        (faction_slot_eq, ":fac", slot_faction_leader, "trp_player"),
        (faction_slot_ge, ":fac", dplmc_slot_faction_centralization, 1),
        (assign, reg0, 1),
      (else_try),
        (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
        (assign, reg0, 1),
      (try_end),
      (eq, reg0, 1),
    ],"Manage this village.",[
      (assign, "$g_next_menu", "mnu_village"),
      (assign, reg63, 1),
      (jump_to_menu, "mnu_center_manage_2"),
    ]),
    ("recruit_volunteers",[
      (call_script, "script_cf_village_recruit_volunteers_cond"),
    ],"Recruit Volunteers.",[
      (try_begin),
        (call_script, "script_cf_enter_center_location_bandit_check"),
      (else_try),
        (jump_to_menu, "mnu_recruit_volunteers"),
      (try_end),
    ]),

    ("recruit_volunteers",[
      (check_quest_active, "qst_amor_quest"),
      (quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 11),
      (eq, "$current_town", "p_village_162"),
    ],"Raid some houses and kill Tristitias husband.",[
      (store_party_size_wo_prisoners, ":size", "p_main_party"),
      (try_begin),
        (ge, ":size", 15),
        (jump_to_menu, "mnu_tristitia_kill"),
      (else_try),
        (display_message, "@You need at least 15 men."),
      (try_end),
    ]),

    ("village_center",[
      (call_script, "script_cf_village_normal_cond", "$current_town"), #SB : script condition
    ],"Go to the village center.",[
      (try_begin),
        (call_script, "script_cf_enter_center_location_bandit_check"),
      (else_try),
        (party_get_slot, ":village_scene", "$current_town", slot_castle_exterior),
        (modify_visitors_at_site,":village_scene"),
        (reset_visitors),
        (party_get_slot, ":village_elder_troop", "$current_town",slot_town_elder),
        (set_visitor, 11, ":village_elder_troop"),

        (try_begin),
            (check_quest_active, "qst_amor_quest"),
            (eq, "$current_town", "p_village_162"),
            (this_or_next|quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 8),
            (this_or_next|quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 11),
            (quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 10),
            (set_visitor, 25, "trp_tristitia"),
        (try_end),
        ##diplomacy begin
        (try_begin),
          (gt, "$g_player_chamberlain", 0),
          (call_script, "script_dplmc_appoint_chamberlain"),  #fix for wrong troops after update
          (party_get_slot, ":town_lord", "$current_town", slot_town_lord),
          (eq, ":town_lord", "trp_player"),
          (set_visitor, 9, "$g_player_chamberlain"),
        (try_end),
        ##diplomacy end

        (call_script, "script_init_town_walkers"),
        (try_begin),
          (check_quest_active, "qst_blank_quest_10"),
          (neg | is_currently_night),
          (quest_slot_eq, "qst_blank_quest_10", slot_quest_target_center, "$current_town"),
          #			 (store_faction_of_party, ":faction_no","$current_town"),
          (neg | check_quest_succeeded, "qst_blank_quest_10"),
          (neg | check_quest_failed, "qst_blank_quest_10"),
          (quest_get_slot, ":target_troop", "qst_blank_quest_10", slot_quest_target_troop),
          #			 (faction_get_slot, ":target_troop", ":faction_no",
          #			 slot_faction_deserter_troop),
          (store_random_in_range, ":rand", 1,4),
          (try_begin),
            (eq, ":rand", 1),
            (assign, ":pos",32),
          (else_try),
            (eq, ":rand", 2),
            (assign, ":pos", 34),
          (else_try),
            (eq, ":rand", 3),
            (assign, ":pos", 33),
          (try_end),
          #			  (shuffle_range, 1, 4),
          (set_visitor, ":pos", ":target_troop"),
        (try_end),
        (try_begin),
          (check_quest_active, "qst_hunt_down_fugitive"),
          (neg|is_currently_night),
          (quest_slot_eq, "qst_hunt_down_fugitive", slot_quest_target_center, "$current_town"),
          (neg|check_quest_concluded, "qst_hunt_down_fugitive"), #SB : other condition
          (neg|check_quest_succeeded, "qst_hunt_down_fugitive"),
          (neg|check_quest_failed, "qst_hunt_down_fugitive"),
          (set_visitor, 45, "trp_fugitive"),
        (try_end),
        (set_jump_mission,"mt_village_center"),
        #VC-2404
        (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (try_for_range, ":entry", 0, 2),
            (call_script, "script_init_second_outfit", "mt_village_center", ":entry", 1),
          (try_end),
          (mission_tpl_entry_set_override_flags, "mt_village_center", 0, af_override_outfit_1),
          (mission_tpl_entry_set_override_flags, "mt_village_center", 1, af_override_outfit_1 | af_override_horse),
        (try_end),
        (jump_to_scene,":village_scene"),
        (change_screen_mission),
      (try_end),
    ],"Door to the village center."),

      ##diplomacy begin
    ("dplmc_village_elder_meeting",[
      (call_script, "script_cf_village_normal_cond", "$current_town"), #SB : conditional check
      ##diplomacy start+
      #rubik had a good idea: only enable this after having met the village elder
      (party_get_slot, ":village_elder_troop", "$current_town",slot_town_elder),
      (gt, ":village_elder_troop", 0),
      (this_or_next|eq, "$cheat_mode", 1),#Always can jump to village elder in cheat mode
      (this_or_next|eq, "$players_kingdom", "$g_encountered_party_faction"), #allow when member
      (troop_slot_ge,":village_elder_troop", slot_troop_met, 1),
      ##diplomacy end+
      (str_store_troop_name, s50, ":village_elder_troop"),
    ],"Meet the {s50}.",[
      (try_begin),
        (call_script, "script_cf_enter_center_location_bandit_check"),
      (else_try),
        (party_get_slot, ":village_scene", "$current_town", slot_castle_exterior),
        (modify_visitors_at_site,":village_scene"),
        (reset_visitors),
        (party_get_slot, ":village_elder_troop", "$current_town",slot_town_elder),
        (set_visitor, 11, ":village_elder_troop"),
        (try_begin), #SB : supporting village_elder_found_chamberlain dialog option
            (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
            (eq, "$g_player_chamberlain", "trp_dplmc_chamberlain"),
            (set_visitor, 9, "$g_player_chamberlain"),
        (try_end),

        (set_jump_mission,"mt_village_center"),
        (jump_to_scene,":village_scene"),
        (change_screen_map_conversation, ":village_elder_troop"),
      (try_end),
    ]),

    ("dplmc_village_elder_meeting_denied",[
    #Only show this when the player would get the rest of the village menus
      (call_script, "script_cf_village_normal_cond", "$current_town"), #SB : script condition
      #There is a valid village elder, and you haven't met him,
      #and there isn't another condition that enables the jump.
      (party_get_slot, ":village_elder_troop", "$current_town",slot_town_elder),
      (gt, ":village_elder_troop", 0),
      (eq, "$cheat_mode", 0),
      (troop_slot_eq, ":village_elder_troop", slot_troop_met, 0),
      (str_store_troop_name, s50, ":village_elder_troop"),
      (disable_menu_option),
    ],"You have not met the {s50} yet.",[
    ]),

    ("village_buy_food",[
      (party_slot_eq, "$current_town", slot_village_state, svs_normal),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
    ],"Buy supplies from the peasants.",[
      (try_begin),
        (call_script, "script_cf_enter_center_location_bandit_check"),
      (else_try),
        (this_or_next|key_is_down, key_left_control),
        (key_is_down, key_right_control),
        (display_message, "@You buy food automatically."),
        (try_begin),# use follower party to buy food if player has one
          (store_party_size_wo_prisoners,":size", "p_follower_party"),
          (gt, ":size", 0),
          (assign, reg48, "trp_follower_party_mules"),
        (else_try),
          (assign, reg48, "trp_player"),
        (try_end),
        (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
        (call_script, "script_dplmc_auto_buy_food", reg48, ":merchant_troop", 1, "trp_player"),
      (else_try),
        (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
        (change_screen_trade, ":merchant_troop"),
      (try_end),
    ]),
    ("dplmc_village_auto_sell",[
      (party_slot_eq, "$current_town", slot_village_state, svs_normal),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (party_get_slot, ":village_elder_troop", "$current_town", slot_town_elder),
      (ge, ":village_elder_troop", 0),
    ],"Sell items automatically.",[
      (assign, "$g_next_menu", "mnu_village"),
      (jump_to_menu,"mnu_dplmc_trade_auto_sell_begin"),
    ]),

    ("dplmc_village_auto_buy_food",[
      (party_slot_eq, "$current_town", slot_village_state, svs_normal),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (party_get_slot, ":village_elder_troop", "$current_town", slot_town_elder),
      (ge, ":village_elder_troop", 0),
    ],"Buy food automatically.",[
      (assign, "$g_next_menu", "mnu_village"),
      (jump_to_menu,"mnu_dplmc_trade_auto_buy_food_begin"),
    ]),
    ("village_attack_bandits",[
      (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (neg|party_slot_eq, "$current_town", slot_village_infested_by_bandits, "trp_peasant_woman"),
    ],"Attack the bandits.",[
      (party_get_slot, ":bandit_troop", "$current_town", slot_village_infested_by_bandits),
      (party_get_slot, ":scene_to_use", "$current_town", slot_castle_exterior),
      (modify_visitors_at_site,":scene_to_use"),
      (reset_visitors),
      (set_visitors, 0, ":bandit_troop", "$qst_eliminate_bandits_infesting_village_num_bandits"),

      (try_begin),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_1"),
        (assign, ":rebel_troop", "trp_dacian_village_walker"),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2"),
        (assign, ":rebel_troop", "trp_celtic_village_walker"),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2_1"),
        (assign, ":rebel_troop", "trp_celtic_village_walker"),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_3"),
        (assign, ":rebel_troop", "trp_sarmatian_village_walker"),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_4"),
        (assign, ":rebel_troop", "trp_germanic_village_walker"),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_5"),
        (assign, ":rebel_troop", "trp_armenian_village_walker"),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_6"),
        (assign, ":rebel_troop", "trp_parthian_village_walker"),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
        (assign, ":rebel_troop", "trp_roman_village_walker"),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_9"),
        (assign, ":rebel_troop", "trp_bosporan_village_walker"),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_8"),
        (assign, ":rebel_troop", "trp_judean_village_walker"),
      (try_end),

      (set_visitors, 2, ":rebel_troop", "$qst_eliminate_bandits_infesting_village_num_villagers"),

      (set_party_battle_mode),
      (set_battle_advantage, 0),
      (assign, "$g_battle_result", 0),
      (set_jump_mission,"mt_village_attack_bandits"),
      (jump_to_scene, ":scene_to_use"),
      (assign, "$g_next_menu", "mnu_village_infest_bandits_result"),
      (jump_to_menu, "mnu_battle_debrief"),
      (assign, "$g_mt_mode", vba_normal),
      (change_screen_mission),
    ]),

    ("village_guest_wait",[
      (neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
      (neg|party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (assign,":continue",0),
			(try_begin),
				(party_get_slot, ":center_relation", "$current_town", slot_center_player_relation),
				(ge, ":center_relation", 50),
				(assign,":continue",1),
			(try_end),
			(try_begin),
				(party_slot_ge, "$current_town", slot_center_has_manor, 1),
				(party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
				(assign,":continue",0),
			(try_end),
			(eq,":continue",1),
    ],"The villagers invite you to rest here as their honored guest.",[
      (assign,"$auto_enter_town","$current_town"),
      (assign, "$g_last_rest_center", "$current_town"),
      (rest_for_hours_interactive, 24 * 86, 12, 0), #rest while not attackable
      (change_screen_return),
    ]),

    ("village_perform_basic_work",[
      (call_script, "script_cf_village_normal_cond", "$current_town"), #SB : script condition
    ],"Perform some very basic work for the village (be farmer).",[
      (try_begin),
        (display_message,"@ You start performing these hard peasantry basic work.",0xFF0000),
        (try_begin),
          (troop_slot_ge, "trp_player", slot_troop_renown, 50),
          (display_message,"@ Like farmer, you lose renown",0xFF0000),
          (call_script, "script_change_troop_renown", "trp_player", -2),
        (try_end),
        (rest_for_hours_interactive, 2, 12, 1),
        (change_screen_map),
        (assign,"$g_work_for_village_ongoing",24),
      (try_end),#rigale
    ]),

    ("village_wait",[
      (party_slot_ge, "$current_town", slot_center_has_manor, 1),
      (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
    ],"Wait here for some time.",[
      (assign,"$auto_enter_town","$current_town"),
      (assign, "$g_last_rest_center", "$current_town"),
      (rest_for_hours_interactive, 24 * 7, 5, 1),
      (change_screen_return),
    ]),

    ("dplmc_village_counter_insurgency",[
      (party_slot_eq, "$current_town", slot_village_infested_by_bandits, "trp_peasant_woman"),
    ],"Counter the insurgency.",[
      (store_random_in_range, ":enmity", -10, -5),
      (call_script, "script_change_player_relation_with_center", "$current_town", ":enmity"),
      (call_script, "script_calculate_battle_advantage"),
      (set_battle_advantage, reg0),
      (set_party_battle_mode),
      (assign, "$g_battle_result", 0),
      (set_jump_mission,"mt_village_raid"),
      (party_get_slot, ":scene_to_use", "$current_town", slot_castle_exterior),
      (jump_to_scene, ":scene_to_use"),
      (assign, "$g_next_menu", "mnu_dplmc_village_riot_result"),

      # (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"),
      #SB : more appropriate message for tax rebels
      (call_script, "script_objectionable_action", tmt_humanitarian, "str_repress_farmers"),
      (jump_to_menu, "mnu_battle_debrief"),
      (change_screen_mission),
    ]),

    ("dplmc_village_negotiate",[
      (party_slot_eq, "$current_town", slot_village_infested_by_bandits, "trp_peasant_woman"),
    ],"Begin negotiations.",[
      (jump_to_menu, "mnu_dplmc_riot_negotiate"),
    ]),

    ("collect_taxes_qst",[
      (party_slot_eq, "$current_town", slot_village_state, svs_normal),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (check_quest_active, "qst_collect_taxes"),
      (quest_get_slot, ":quest_giver_troop", "qst_collect_taxes", slot_quest_giver_troop),
      (quest_slot_eq, "qst_collect_taxes", slot_quest_target_center, "$current_town"),
      (neg|quest_slot_eq, "qst_collect_taxes", slot_quest_current_state, 4),
      (str_store_troop_name, s1, ":quest_giver_troop"),
      (quest_get_slot, reg5, "qst_collect_taxes", slot_quest_current_state),
    ], "{reg5?Continue collecting taxes:Collect taxes} due to {s1}.",[
      (jump_to_menu, "mnu_collect_taxes"),
    ]),

    ("train_peasants_against_bandits_qst",[
      (party_slot_eq, "$current_town", slot_village_state, svs_normal),
      (check_quest_active, "qst_train_peasants_against_bandits"),
      (neg|check_quest_concluded, "qst_train_peasants_against_bandits"),
      (quest_slot_eq, "qst_train_peasants_against_bandits", slot_quest_target_center, "$current_town"),
    ], "Train the peasants.",[
      (jump_to_menu, "mnu_train_peasants_against_bandits"),
    ]),

    ("village_hostile_action",[
      (party_slot_eq, "$current_town", slot_village_state, svs_normal),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (party_slot_ge, "$current_town", slot_center_player_relation, -1), #relationship check, non-negative
      (check_quest_active, "qst_hunt_down_fugitive"),
      (quest_slot_eq, "qst_hunt_down_fugitive", slot_quest_target_center, "$current_town"),
      (neg|check_quest_concluded, "qst_hunt_down_fugitive"), #SB : other condition
      (neg|check_quest_succeeded, "qst_hunt_down_fugitive"),
      (neg|check_quest_failed, "qst_hunt_down_fugitive"),
      (quest_get_slot, ":quest_target_dna", "qst_hunt_down_fugitive", slot_quest_target_dna),
      (call_script, "script_get_name_from_dna_to_s50", ":quest_target_dna"),
    ],"Demand to meet the family of {s50}.",[
      (call_script, "script_get_max_skill_of_player_party", "skl_persuasion"),
      (store_random_in_range, ":random_no", reg0, 100),
      #persuasion instead of straight out murdering everyone
      (call_script, "script_party_count_members_with_full_health","p_main_party"),
      (assign, ":player_party_size", reg0),
      (call_script, "script_party_count_members_with_full_health","$current_town"),
      (store_mul, ":villagers_party_size", reg0, 2), #twice the effective size
      (try_begin),
        (this_or_next|gt, ":random_no", 40),
        (gt, ":player_party_size", ":villagers_party_size"),
        (jump_to_menu, "mnu_village_hunt_down_fugitive_persuaded"),
      (else_try),
        (jump_to_menu,"mnu_village_start_attack"),
      (try_end),
    ]),

    ("village_hostile_action",[
      (party_slot_eq, "$current_town", slot_village_state, svs_normal),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (neq, "$players_kingdom", "$g_encountered_party_faction"),
    ], "Take a hostile action.",[
      (jump_to_menu,"mnu_village_hostile_action"),
    ]),

    ("village_donation",[
      (troop_slot_ge, "trp_player", slot_troop_renown, 200), #beggars do not donate money
      (party_slot_eq, "$current_town", slot_village_state, 0),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (neg|party_slot_eq, "$current_town", slot_donate_party, 1),
    ],"Make a donation of 2,500 denars.",[
      (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (neg|party_slot_eq, "$current_town", slot_donate_party, 1),
        (try_begin),
          (ge, ":gold", 2500), ## donation is 2500 Thaler, you can easily change this.
          (troop_remove_gold, "trp_player", 2500),
          (display_message,"@You donated 2000 denars.",color_good_news),
          (try_begin),
            (is_between, ":prosperity", 0, 20),
            (call_script, "script_change_player_relation_with_center", "$current_town", 15),
            (call_script, "script_change_center_prosperity", "$current_town", 8),
            (display_message,"@Due to the low prosperity of the village, the people are very happy."),
          (else_try),
            (is_between, ":prosperity", 20, 40),
            (call_script, "script_change_player_relation_with_center", "$current_town", 8),
            (call_script, "script_change_center_prosperity", "$current_town", 6),
            (display_message,"@Due to the low prosperity of the village, the people are very happy."),
          (else_try),
            (is_between, ":prosperity", 40, 60),
            (call_script, "script_change_player_relation_with_center", "$current_town", 4),
            (call_script, "script_change_center_prosperity", "$current_town", 3),
          (else_try),
            (is_between, ":prosperity", 60, 80),
            (call_script, "script_change_player_relation_with_center", "$current_town", 2),
            (call_script, "script_change_center_prosperity", "$current_town", 2),
            (display_message,"@Due to the high prosperity of the village, your relation improves only small."),
          (else_try),
            (call_script, "script_change_player_relation_with_center", "$current_town", 1),
            (display_message,"@Due to the high prosperity of the village, your relation improves only small."),
          (try_end),
          (party_set_slot, "$current_town", slot_donate_party, 1),
          (call_script, "script_change_troop_renown", "trp_player", 5),
        (else_try),
          (display_message,"str_not_enough_gold",0x888888),#grey
          (call_script, "script_change_troop_renown", "trp_player", -20),
        (try_end),
      (else_try),
        (display_message,"@They didn't accept your donation. You can ask them after some days again.",0xAA0000), #I said "one week". This is controlling by a simple trigger. You must match words with digits. Simple trigger has given at bottom of codes. # Dark red. You can change the colour what you want.
        (call_script, "script_change_troop_renown", "trp_player", -20),
      (try_end),
    ]),

    ("village_leave",[],"Leave...",[
      (try_begin),
        (party_slot_eq, "$current_town", slot_village_state, svs_normal),
        (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
        (party_get_slot, ":merchant_troop", "$current_town",slot_town_elder),
        (gt, ":merchant_troop", 0),
        (call_script, "script_dplmc_initialize_autoloot", 0),
        (try_begin),
          (eq, "$g_dplmc_buy_food_when_leaving", 1),
          (try_begin),# use follower party to buy food if player has one
              (store_party_size_wo_prisoners,":size", "p_follower_party"),
              (gt, ":size", 0),
              (assign, reg48, "trp_follower_party_mules"),
          (else_try),
              (assign, reg48, "trp_player"),
          (try_end),
          (call_script, "script_dplmc_auto_buy_food", reg48, ":merchant_troop", 0, "trp_player"),
        (try_end),
        (try_begin),
          (eq, "$g_dplmc_sell_items_when_leaving", 1),
          (call_script, "script_dplmc_auto_sell", "trp_player", ":merchant_troop", "$g_dplmc_auto_sell_price_limit", all_items_begin, all_items_end, 2),
        (try_end),
      (try_end),
      (change_screen_return,0),
	  ]),
    ("village_cheat",[
      (ge, "$cheat_mode", 1),
    ],"Use cheats.",[
      (jump_to_menu, "mnu_town_cheats"),
    ]),
]),

("village_basic_work",0,
  "{s3}",
  "none",[
		(str_clear,s1),
		(str_clear,s3),
		(try_begin),
      (eq, "$g_player_is_captive", 1), #motomataru chief repara
      (str_store_string,s3,"@ You've been carried off as prisoner. You stop your work."),
    (else_try),
      (party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
			(str_store_string,s3,"@ The village is being raided. You stop your work."),
		(else_try),
			(party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
			(str_store_string,s3,"@ The village is being infested by bandits. You stop your work."),
		(else_try),
			(store_random_in_range,reg36,100,350),
			(add_xp_to_troop, reg36, "trp_player"),
			(store_random_in_range,":item_to_give",1,11),
			(try_begin),
				(eq,":item_to_give",1),
        (assign,":item_to_give","itm_cheese",1),
      (else_try),
				(eq,":item_to_give",2),
        (assign,":item_to_give","itm_sausages",1),
      (else_try),
				(eq,":item_to_give",3),
        (assign,":item_to_give","itm_apples",1),
      (else_try),
				(eq,":item_to_give",4),
        (assign,":item_to_give","itm_pork",1),
      (else_try),
				(eq,":item_to_give",5),
        (assign,":item_to_give","itm_grain",1),
      (else_try),
				(eq,":item_to_give",6),
        (assign,":item_to_give","itm_honey",1),
      (else_try),
				(eq,":item_to_give",7),
        (assign,":item_to_give","itm_bread",1),
      (else_try),
				(eq,":item_to_give",8),
        (assign,":item_to_give","itm_oil",1),
      (else_try),
				(eq,":item_to_give",9),
        (assign,":item_to_give","itm_wine",1),
      (else_try),
				(assign,":item_to_give","itm_chicken",1),
			(try_end),
		  (call_script, "script_change_player_relation_with_center", "$current_town", 1),
			(troop_add_items,"trp_player",":item_to_give",1),
      (str_store_item_name, s22, ":item_to_give"),
			(str_store_string,s3,"@Here are the results of your hard work: You exhaust yourself, You gain {reg36} xps, you receive some {s22}. You improve your relation with this village. Peasant life is hard, but you feel good."),
		(try_end),
	],[
    ("continue",[],"Continue",[
      (try_begin),
        (this_or_next|eq, "$g_player_is_captive", 1),
        (this_or_next|party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
        (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
        (change_screen_return),
      (else_try),
        (jump_to_menu,"mnu_village"),
      (try_end),
    ]),
]),

("village_hostile_action",0,
  "What hostile action do you have in mind?",
  "none",[
    (set_background_mesh, "mesh_pic_looted_village"),
  ],[
    ("village_take_food",[
      (party_slot_eq, "$current_town", slot_village_state, svs_normal),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
      #SB : loop break
      (assign, ":town_stores_not_empty", max_inventory_items + num_equipment_kinds),
      (try_for_range, ":slot_no", num_equipment_kinds, ":town_stores_not_empty"),
        (troop_get_inventory_slot, ":slot_item", ":merchant_troop", ":slot_no"),
        (ge, ":slot_item", 0),
        (assign, ":town_stores_not_empty", -1),
      (try_end),
      (eq, ":town_stores_not_empty", -1),
    ],"Force the peasants to give you supplies.",[
      (jump_to_menu, "mnu_village_take_food_confirm")
    ]),
    ("village_steal_cattle",[
      (party_slot_eq, "$current_town", slot_village_state, svs_normal),
      (party_slot_eq, "$current_town", slot_village_player_can_not_steal_cattle, 0),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (party_get_slot, ":num_cattle", "$current_town", slot_village_number_of_cattle),
      (neg|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
      (gt, ":num_cattle", 0),
    ],"Steal cattle.",[
      (jump_to_menu, "mnu_village_steal_cattle_confirm")
    ]),
    ("village_loot",[
      (party_slot_eq, "$current_town", slot_village_state, svs_normal),
      (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      (store_faction_of_party, ":center_faction", "$current_town"),
      (store_relation, ":reln", "fac_player_supporters_faction", ":center_faction"),
      (lt, ":reln", 0),
    ],"Loot and burn this village.",[
      (jump_to_menu, "mnu_village_start_attack"),
    ]),
    ("forget_it",[],"Forget it.",[
      (jump_to_menu,"mnu_village"),
    ]),
]),

("recruit_volunteers",0,
  "{s18}",
  "none",[
    (party_get_slot, ":volunteer_troop", "$current_town", slot_center_volunteer_troop_type),
    (party_get_slot, ":volunteer_amount", "$current_town", slot_center_volunteer_troop_amount),
    (party_get_free_companions_capacity, ":free_capacity", "p_main_party"),
    (store_troop_gold, ":gold", "trp_player"),
    (store_div, ":gold_capacity", ":gold", 100),#100 denars per man
    (assign, ":party_capacity", ":free_capacity"),
    (val_min, ":party_capacity", ":gold_capacity"),
    (try_begin),
      (gt, ":party_capacity", 0),
      (val_min, ":volunteer_amount", ":party_capacity"),
    (try_end),
    (assign, reg5, ":volunteer_amount"),
    (assign, reg7, 0),
    (try_begin),
      (gt, ":volunteer_amount", ":gold_capacity"),
      (assign, reg7, 1), #not enough money
    (try_end),
    (try_begin),
      (eq, ":volunteer_amount", 0),
      (str_store_string, s18, "@No one here seems to be willing to join your party."),
    (else_try),
      (store_mul, reg6, ":volunteer_amount", 100),#100 denars per man
      (str_store_troop_name_by_count, s3, ":volunteer_troop", ":volunteer_amount"),
      (try_begin),
        (eq, reg5, 1),
        (str_store_string, s18, "@One {s3} volunteers to follow you."),
      (else_try),
        (str_store_string, s18, "@{reg5} {s3} volunteer to follow you."),
      (try_end),
      (set_background_mesh, "mesh_pic_recruits"),
    (try_end),
  ],[
    ("continue",[
      (eq, reg7, 0),
      (eq, reg5, 0),
    ],"Continue...",[
      (party_set_slot, "$current_town", slot_center_volunteer_troop_amount, -1),
      (jump_to_menu,"mnu_village"),
    ]),

    ("recruit_them",[
      (eq, reg7, 0),
      (gt, reg5, 0),
    ],"Recruit them ({reg6} denars).",[
      (call_script, "script_village_recruit_volunteers_recruit"),
      (jump_to_menu,"mnu_village"),
    ]),

    ("continue_not_enough_gold",[
      (eq, reg7, 1),
      (disable_menu_option),
    ],"I don't have enough money...",[
      (jump_to_menu,"mnu_village"),
    ]),

    ("forget_it",[
    ],"Forget it.",[
      (jump_to_menu,"mnu_village"),
    ]),
]),

("village_hunt_down_fugitive_defeated",0,
  "A heavy blow from the fugitive sends you to the ground, and your vision spins and goes dark. Time passes. When you open your eyes again you find yourself battered and bloody, but luckily none of the wounds appear to be lethal.",
  "none",[
    (call_script, "script_fail_quest", "qst_hunt_down_fugitive"),
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_village"),
      (call_script, "script_change_troop_renown", "trp_player", -2),
    ]),
]),

("village_hunt_down_fugitive_persuaded",0,
 "As the party member with the highest persuasion, {reg3?you:{s3}} managed to cajole the location of {s50} from his tight-lipped relatives. Backed with superior force of arms, your just argument seemed to take effect and the villagers grudgingly participate in the manhunt for the fugitive. {reg4?But word of you arrival has reached the fugitive and he appears to have taken his own life:Within the hour, you've secured the fugitive on behalf of {s4}}.",
  "none",[
    (call_script, "script_get_max_skill_of_player_party", "skl_persuasion"),
    (assign, ":max_skill_owner", reg1),
    (quest_get_slot, ":quest_target_dna", "qst_hunt_down_fugitive", slot_quest_target_dna),
    (call_script, "script_get_name_from_dna_to_s50", ":quest_target_dna"),

      #SB : tableau at bottom
      (try_begin),
        (eq, ":max_skill_owner", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":max_skill_owner"),
        (call_script, "script_change_troop_renown", ":max_skill_owner", dplmc_companion_skill_renown),
      (try_end),

    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 70),
    (position_set_y, pos0, 5),
    (position_set_z, pos0, 75),
    (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", ":max_skill_owner", pos0),
    (store_random_in_range, reg4, 0, 2), #TODO add some conditions, renown, time of day, etc
    (try_begin),
      (eq, reg4, 0),
      (party_force_add_prisoners, "p_main_party", "trp_fugitive", 1),
      (quest_get_slot, ":quest_giver_troop", "qst_hunt_down_fugitive", slot_quest_giver_troop),
      (str_store_troop_name, s4, ":quest_giver_troop"),
      (quest_set_slot, "qst_hunt_down_fugitive", slot_quest_current_state, 2),
    (else_try), #killed, player can claim credit
      (quest_set_slot, "qst_hunt_down_fugitive", slot_quest_current_state, 1),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (call_script, "script_succeed_quest", "qst_hunt_down_fugitive"),
      (jump_to_menu, "mnu_village"),
    ]),
]),

("village_infest_bandits_result",mnf_scale_picture,
  "{s9}",
  "none",[
    (try_begin),
      (eq, "$g_battle_result", 1),
      (jump_to_menu, "mnu_village_infestation_removed"),
    (else_try),
      (str_store_string, s9, "@Try as you might, you could not defeat the bandits. Infuriated, they raze the village to the ground to punish the peasants, and then leave the burning wasteland behind to find greener pastures to plunder."),
      (set_background_mesh, "mesh_pic_looted_village"),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
      (call_script, "script_village_set_state",  "$current_town", svs_looted),
      (party_set_slot, "$current_town", slot_village_raid_progress, 0),
      (party_set_slot, "$current_town", slot_village_recover_progress, 0),
      (try_begin),
        (check_quest_active, "qst_eliminate_bandits_infesting_village"),
        (quest_slot_eq, "qst_eliminate_bandits_infesting_village", slot_quest_target_center, "$g_encountered_party"),
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -5),
        (call_script, "script_fail_quest", "qst_eliminate_bandits_infesting_village"),
        (call_script, "script_end_quest", "qst_eliminate_bandits_infesting_village"),
      (else_try),
        (check_quest_active, "qst_deal_with_bandits_at_lords_village"),
        (quest_slot_eq, "qst_deal_with_bandits_at_lords_village", slot_quest_target_center, "$g_encountered_party"),
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -4),
        (call_script, "script_fail_quest", "qst_deal_with_bandits_at_lords_village"),
        (call_script, "script_end_quest", "qst_deal_with_bandits_at_lords_village"),
      (else_try),
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -3),
      (try_end),
      (jump_to_menu, "mnu_village"),
    ]),
]),

("village_infestation_removed",mnf_disable_all_keys,
  "In a battle worthy of song, you and your men drive the bandits out of the village, making it safe once more."
  +" The villagers have little left in the way of wealth after their ordeal, but they offer you {reg10?all they can find:a few heads of cattle}.",
    "none",[
    (party_get_slot, ":bandit_troop", "$g_encountered_party", slot_village_infested_by_bandits),
    (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
    (party_clear, "p_temp_party"),
    (party_add_members, "p_temp_party", ":bandit_troop", "$qst_eliminate_bandits_infesting_village_num_bandits"),
    #SB : tweaked player contribution by whether village is the same faction
    (try_begin),
      (eq, "$players_kingdom", "$g_encountered_party_faction"),
      (assign, "$g_strength_contribution_of_player", 65),
    (else_try),
      (assign, "$g_strength_contribution_of_player", 50),
    (try_end),
    (call_script, "script_party_give_xp_and_gold", "p_temp_party"),
    (try_begin),
      (check_quest_active, "qst_eliminate_bandits_infesting_village"),
      (quest_slot_eq, "qst_eliminate_bandits_infesting_village", slot_quest_target_center, "$g_encountered_party"),
      (call_script, "script_end_quest", "qst_eliminate_bandits_infesting_village"),
      #Add quest reward
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 5),
    (else_try),
      (check_quest_active, "qst_deal_with_bandits_at_lords_village"),
      (quest_slot_eq, "qst_deal_with_bandits_at_lords_village", slot_quest_target_center, "$g_encountered_party"),
      (call_script, "script_succeed_quest", "qst_deal_with_bandits_at_lords_village"),
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
    (else_try),
    #Add normal reward
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 4),
    (try_end),

    (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
    #SB : calculate amount of merchandise remaining
    (assign, ":num_items", 0),
    (try_for_range, ":slot_no", num_equipment_kinds, max_inventory_items + num_equipment_kinds),
      (store_random_in_range, ":rand", 0, 100),
      (lt, ":rand", 70),
      (troop_set_inventory_slot, ":merchant_troop", ":slot_no", -1),
    (else_try),
      (troop_get_inventory_slot, ":item_no", ":merchant_troop", ":slot_no"),
      (gt, ":item_no", 0),
      (item_get_type, ":itp", ":item_no"),
      (eq, ":itp", itp_type_goods),
      (val_add, ":num_items", 1),
    (try_end),
    #SB : check before we disappoint the player
      # (store_free_inventory_capacity, ":capacity", ":merchant_troop"),
      # (eq, ":capacity", max_inventory_items),
    (assign, reg10, ":num_items"),
    #SB : background mesh
    #(set_background_mesh, "mesh_pic_mb_warrior_3"), #dckplmc - obscures text
  ],[
    ("village_bandits_defeated_accept",[
    ],"Take it as your just due.",[
      (jump_to_menu, "mnu_village"),
      (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
      (troop_sort_inventory, ":merchant_troop"),
      (try_begin),
        (gt, reg10, 0),
        (change_screen_loot, ":merchant_troop"),
      (else_try), #arbitrary amount
        (store_random_in_range, reg10, 2, 5),
        (call_script, "script_create_cattle_herd", "$current_town", reg10),
      (try_end),
    ]),
    ("village_bandits_defeated_cont",[
    ],"Refuse, stating that they need these items more than you do.",[
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
      (call_script, "script_change_player_honor", 1),
      (jump_to_menu, "mnu_village")
    ]),
]),

("center_manage_2",0,
  "{s39} has a prosperity rating of {reg51} and a accumulated capital of {reg29} denars, which can be taxed. The taxrate is {s11}.^^{s44}",
  "none",[
  #set variables
  (try_for_range, ":slot",0,500),
      (troop_set_slot, "trp_zendar_chest", ":slot", 0),
  (try_end),
  (assign, "$g_improvement_type", 0),
  (assign, "$temp", 0),
  (assign, "$temp2", 0),
  (assign, "$temp3", 0),
  (assign, "$g_presentation_next_presentation", 0),
  (modify_visitors_at_site, "scn_presentation_scene"),
  (reset_visitors),
  (set_visitor, 0, "trp_player"),
  (set_jump_mission, "mt_center_management"),
  (jump_to_scene, "scn_presentation_scene"),
  (change_screen_mission),
],[]),

("repopulate",0,
  "You can order your soldiers to kill and enslave the local population. Then you would grante the acquired land to the families of your soldiers and to the veterans."
  +" This would reset your relation with the settlement and also change its culture to yours."
  +" But such an extreme act will have a large negative impact on your reputation. Most likely your men will use the turmoil to raid the settlement and all already accumulated taxes will be stolen,"
  +" the treasury of the town watch will most likely be looted and the prosperity will be reduced.",
  "none",[
	  (str_store_party_name, s39, "$g_encountered_party"),
	  (set_background_mesh, "mesh_pic_charge"),
  ],[
  ("special_tax",[],"Kill them all. They deserve it.",[
    (try_begin),
        (party_slot_eq, "$current_town", slot_party_type, spt_village),

        (party_set_slot, "$current_town", slot_center_player_relation, 5), #relation to 5
        (party_set_slot, "$current_town", slot_center_volunteer_noble_troop_amount, 0),
        (party_set_slot, "$current_town", slot_center_mercenary_troop_amount_2, 0),
        (party_set_slot, "$current_town", slot_center_volunteer_troop_amount, 0),
        (party_set_slot, "$current_town", slot_center_peasant_troop_amount, 0),
        (party_set_slot, "$current_town", slot_center_capital, 0),

        (party_get_slot, ":new_rents", "$current_town", slot_center_accumulated_rents),
        (val_div, ":new_rents", 8),
        (party_set_slot, "$current_town", slot_center_accumulated_rents, ":new_rents"),

        (party_get_slot, ":wealth", "$current_town", slot_town_wealth),
        (val_div, ":wealth", 7),
        (party_set_slot, "$current_town", slot_town_wealth, ":wealth"),

        (party_get_slot, ":capital", "$current_town", slot_center_capital),
        (val_div, ":capital", 10),
        (party_set_slot, "$current_town", slot_center_capital, ":capital"),

        (troop_get_slot, ":culture", "trp_player", slot_troop_culture),
        (party_set_slot, "$current_town", slot_center_culture, ":culture"),
        (call_script, "script_change_player_honor", -35),

        (party_get_slot, ":prosperity_change", "$current_town", slot_town_prosperity),
        (val_mul, ":prosperity_change", -9),
        (val_div, ":prosperity_change", 10),
        (call_script, "script_change_center_prosperity", "$current_town", ":prosperity_change"),

        (party_get_slot, ":food_stores", "$current_town", slot_party_food_store),
        (call_script, "script_center_get_food_store_limit", "$current_town"),
        (val_min, ":food_stores", reg0),
        (party_set_slot, "$current_town", slot_party_food_store, ":food_stores"),
        (try_for_range, ":walker_no", 0, num_town_walkers),
            (call_script, "script_center_set_walker_to_type", "$current_town", ":walker_no", walkert_default),
        (try_end),

        (str_store_party_name, s4, "$current_town"),
        #####
        (str_clear,s1),
        (str_store_string,s1,"@Mercilessly your men kill anyone that crosses their way, then enter the houses, killing or enslave all adult men. The fame of your cruelty travels as the wind. " +
        "Fear seizes all who talk about you. Now {s4} is pacified, but the cost has been very high."),
        (display_message, "@{s1}"),
        (jump_to_menu, "mnu_random_juice_events"),
        #########
    (else_try),
        (assign, "$plunder_battle_shown", 0),
        (assign, "$loot_screen_shown", 0),
        (assign, "$capture_screen_shown", 0),
        (jump_to_menu, "mnu_exterminate_population"),
    (try_end),
  ]),
  ("go_back_dot",[
  ],"Go back.",[
    (jump_to_menu, "mnu_center_manage_2")
  ]),
]),

  # (
    # "center_extort",0,
    # "You have several possibilities to extort the people of {s39}. But be aware that your actions will have a price: Your reputation will suffer and the relation and prosperity of the center will be lowered\
	# which will have a negative impact on your future taxes.^^\
	# Accummulated capital: {reg30}^\
	# Treasury of the town counsel: {reg31}",
    # "none",
    # [
	# (party_get_slot, reg30, "$current_town", slot_center_capital),
	# (party_get_slot, reg31, "$current_town", slot_town_wealth),
	# (str_store_party_name, s39, "$g_encountered_party"),
	# (set_background_mesh, "mesh_pic_payment"),
    # ],
    # [

      # ("special_tax",[],"Raise special tax.",[(jump_to_menu, "mnu_extort_commoners")]),

      # ("special_toll",[(party_slot_eq, "$current_town", slot_party_type, spt_town),],"Raise special toll.",[(jump_to_menu, "mnu_extort_merchants")]),

      # ("town_counsel_extort",[(party_slot_eq, "$current_town", slot_party_type, spt_town),],"Demand money from the town counsel.",[(jump_to_menu, "mnu_extort_counsel")]),

      # ("go_back_dot",[],"Go back.",[(jump_to_menu, "mnu_center_manage_2")]),
    # ],
  # ),
  # (
    # "extort_commoners",0,
    # "You can raise a special tax. As the party member with the highest trade skill ({reg2}), {reg3?you expect:{s1} expects} it would take {reg40} hours to collect this tax \
	# and would give you {reg30} denars: But it will upset the citizens of {s39}.",
    # "none",
    # [
	# (str_store_party_name, s39, "$g_encountered_party"),
	# (party_get_slot, ":capital", "$current_town", slot_center_capital),
	# (store_mul, "$temp", ":capital", 1),
	# (val_div, "$temp", 3),
	# (assign, reg30, "$temp"),
	# (assign, "$temp2", 0),

	 # (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
     # (assign, ":max_skill", reg0),
     # (assign, reg2, reg0),
     # (assign, ":max_skill_owner", reg1),
     # (try_begin),
       # (eq, ":max_skill_owner", "trp_player"),
       # (assign, reg3, 1),
     # (else_try),
       # (assign, reg3, 0),
       # (str_store_troop_name, s1, ":max_skill_owner"),
     # (try_end),
	 # (store_sub, "$temp3", 24, ":max_skill"),
	 # (assign, reg40, "$temp3"),
    # ],
    # [
      # ("agreed",[],"Collect the tax.",[(jump_to_menu, "mnu_center_extort_reaction")]),

      # ("go_back_dot",[],"Go back.",[(jump_to_menu, "mnu_center_extort")]),
    # ],
  # ),

 # (
    # "extort_merchants",0,
    # "You can raise a special toll on goods which are traded today. This would upset the merchants of {s39} and the villagers of the surrounding villages, who come here to sell their goods.\
	# As the party member with the highest trade skill ({reg2}), {reg3?you expect:{s1} expects} it would take {reg40} hours to collect the toll and would give you {reg30} denars.",
    # "none",
    # [(str_store_party_name, s39, "$g_encountered_party"),
	# (party_get_slot, ":capital", "$current_town", slot_center_capital),
	# (store_mul, "$temp", ":capital", 1),
	# (val_div, "$temp", 3),
	# (assign, reg30, "$temp"),
	# (assign, "$temp2", 1),

	 # (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
     # (assign, ":max_skill", reg0),
     # (assign, reg2, reg0),
     # (assign, ":max_skill_owner", reg1),
     # (try_begin),
       # (eq, ":max_skill_owner", "trp_player"),
       # (assign, reg3, 1),
     # (else_try),
       # (assign, reg3, 0),
       # (str_store_troop_name, s1, ":max_skill_owner"),
     # (try_end),
	 # (store_sub, "$temp3", 24, ":max_skill"),
	 # (assign, reg40, "$temp3"),
    # ],
    # [
      # ("go_back_dot",[],"Collect the toll.",[(jump_to_menu, "mnu_center_extort_reaction")]),
      # ("go_back_dot",[],"Go back.",[(jump_to_menu, "mnu_center_extort")]),
    # ],
  # ),
  # (
    # "extort_counsel",0,
    # "The town counsel has {reg31} in their treasury. You can force them to take over their funds. It would take you 2 hours and you would gain {reg31} denars.",
    # "none",
    # [
	# (party_get_slot, reg31, "$current_town", slot_town_wealth),
	# (assign, "$temp", reg31),
	# (assign, "$temp2", 2),
	# (assign, "$temp3", 2),
    # ],
    # [
      # ("go_back_dot",[],"Loot the counsel treasury.",[(jump_to_menu, "mnu_center_extort_reaction")]),
      # ("go_back_dot",[],"Go back.",[(jump_to_menu, "mnu_center_extort")]),
    # ],
  # ),
("center_extort_reaction",0,
  "{s10}^{s40}",
  "none",[
    (store_faction_of_party, ":fac", "$current_town"),
    (faction_get_slot, ":king", ":fac", slot_faction_leader),
    (str_store_troop_name, s11, ":king"),
    (set_background_mesh, "mesh_pic_townriot"),
    (try_begin),
      (eq, ":king", "trp_player"),
      (str_store_string, s40, "@But who cares about an angry commoner?"),
    (else_try),
      (str_store_string, s40, "@The town counsel threatens you to write to {s11} about your tyrannic behavior to try to convince him to dismiss you as governor. \
      But you know that {s11} never replays on such requests."),
    (try_end),
    (try_begin),
      (eq, "$temp", extort_tax),##tax
      (str_store_string, s10, "@Argueing that the money is needed for the good of the realm, you start to collect the tax. As expected the citizens are outraged about your greedy action."),
      (party_get_slot, ":relation", "$current_town", slot_center_player_relation),
      (try_begin),
        (ge, ":relation", 50),
        (store_random_in_range, ":r", 10, 20),
        (val_mul, ":r", -1),
      (else_try),
        (ge, ":relation", 0),
        (store_random_in_range, ":r", 5, 10),
        (val_mul, ":r", -1),
      (else_try),
        (ge, ":relation", -50),
        (store_random_in_range, ":r", 2, 6),
        (val_mul, ":r", -1),
      (else_try),
        (store_random_in_range, ":r", 1, 5),
        (val_mul, ":r", -1),
      (try_end),
      (call_script, "script_change_player_relation_with_center", "$current_town", ":r"),
      (call_script, "script_change_center_prosperity", "$current_town", -7),
      (party_get_slot, ":capital", "$current_town", slot_center_capital),
      (val_sub, ":capital", "$temp2"),
      (party_set_slot, "$current_town", slot_center_capital, ":capital"),
    (else_try),
      (eq, "$temp", extort_toll),##toll
      (str_store_string, s10, "@Argueing that the money is needed for the good of the realm, you start to collect the toll. As expected the merchants are outraged about your greedy action."),
      (party_get_slot, ":relation", "$current_town", slot_center_player_relation),
      (try_begin),
        (ge, ":relation", 50),
        (store_random_in_range, ":r", 7, 15),
        (val_mul, ":r", -1),
      (else_try),
        (ge, ":relation", 0),
        (store_random_in_range, ":r", 5, 9),
        (val_mul, ":r", -1),
      (else_try),
        (ge, ":relation", -50),
        (store_random_in_range, ":r", 1, 6),
        (val_mul, ":r", -1),
      (else_try),
        (store_random_in_range, ":r", 1, 5),
        (val_mul, ":r", -1),
      (try_end),
      (call_script, "script_change_player_relation_with_center", "$current_town", ":r"),
      (try_for_range, ":village", villages_begin, villages_end),
        (party_slot_eq, ":village", slot_village_bound_center, "$current_town"),
        (store_random_in_range, ":r", 1, 3),
        (val_mul, ":r", -1),
        (call_script, "script_change_player_relation_with_center", ":village", ":r"),
      (try_end),
      (call_script, "script_change_center_prosperity", "$current_town", -5),
      (party_get_slot, ":capital", "$current_town", slot_center_capital),
      (val_sub, ":capital", "$temp2"),
      (party_set_slot, "$current_town", slot_center_capital, ":capital"),
    (else_try),
      (eq, "$temp", extort_concile),##town counsel
      (str_store_string, s10, "@You march with your troops to the town counsel. Argueing that the counsels treasury is needed to defend the realm you order your troops to take over it. As expected the citizens are outraged about your greedy action."),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (call_script, "script_change_center_prosperity", "$current_town", -3),
      (party_set_slot, "$current_town", slot_town_wealth, 0),
    (try_end),
  ],[
  ("go_back_dot",[],"Continue...",[
    (call_script, "script_change_player_honor", -5),
    (call_script, "script_change_troop_renown", "trp_player", -15),
    (call_script, "script_troop_add_gold", "trp_player", "$temp2"),
    (rest_for_hours, "$temp3", 8, 0),
    (try_begin),
        (party_get_slot, ":lord", "$current_town", slot_town_lord),
        (neq, ":lord", "trp_player"),
        (call_script, "script_change_player_relation_with_troop", ":lord", -10),
        (str_store_troop_name, s40, ":lord"),
        (display_message, "@{s40} is not amused to hear about your tyrannical tax collection in his town!"),
    (try_end),
    (change_screen_map),
  ]),
]),

 # (
    # "center_decrees",0,
    # "As the govenor of this center you can issue decrees to react on certain matters. ^\
	# Enacting or revoking a decree will cost you {reg40} denars.",
    # "none",
    # [(assign, reg40, decree_cost),
    # ],
    # [
      # ("curfew",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_curfew, 0),
                                  # ],
       # "Issue a nightly curfew.",[
	   # (assign, "$g_improvement_type", slot_center_decree_curfew),
	   # (assign, "$temp", 1),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),
	  # ("curfew_revoke",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_curfew, 1),
                                  # ],
       # "Revoke the Nightly curfew.",[(assign, "$g_improvement_type", slot_center_decree_curfew),
						 # (assign, "$temp", 0),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),

	  # ("control",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_control, 0),
                                  # ],
       # "Issue entry controls.",[
	   # (assign, "$g_improvement_type", slot_center_decree_control),
	   # (assign, "$temp", 1),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),
	  # ("control_revoke",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_control, 1),
                                  # ],
       # "Revoke entry controls.",[(assign, "$g_improvement_type", slot_center_decree_control),
						 # (assign, "$temp", 0),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),

	  # ("garbage_collection",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_garbage_collection, 0),
                                  # ],
       # "Issue garbage collections.",[
	   # (assign, "$g_improvement_type", slot_center_decree_garbage_collection),
	   # (assign, "$temp", 1),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),
	  # ("garbage_collection_revoke",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_garbage_collection, 1),
                                  # ],
       # "Revoke garbage collections.",[(assign, "$g_improvement_type", slot_center_decree_garbage_collection),
						 # (assign, "$temp", 0),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),

	  # ("housing",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_housing, 0),
                                  # ],
       # "Issue social housing.",[
	   # (assign, "$g_improvement_type", slot_center_decree_housing),
	   # (assign, "$temp", 1),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),
	  # ("housing_revoke",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_housing, 1),
                                  # ],
       # "Revoke social housing.",[(assign, "$g_improvement_type", slot_center_decree_housing),
						 # (assign, "$temp", 0),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),

	   # ("law_enforcement",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_law_enforcement, 0),
                                  # ],
       # "Order strict law enforcement.",[
	   # (assign, "$g_improvement_type", slot_center_decree_law_enforcement),
	   # (assign, "$temp", 1),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),
	  # ("law_enforcement_revoke",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_law_enforcement, 1),
                                  # ],
       # "Revoke strict law enforcement.",[(assign, "$g_improvement_type", slot_center_decree_law_enforcement),
						 # (assign, "$temp", 0),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),

	  # ("beggingban",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_beggingban, 0),
                                  # ],
       # "Issue a begging ban.",[
	   # (assign, "$g_improvement_type", slot_center_decree_beggingban),
	   # (assign, "$temp", 1),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),
	  # ("beggingban_revoke",[
                             # (party_slot_eq, "$g_encountered_party", slot_center_decree_beggingban, 1),
                                  # ],
       # "Revoke begging ban.",[(assign, "$g_improvement_type", slot_center_decree_beggingban),
						 # (assign, "$temp", 0),
                         # (jump_to_menu, "mnu_center_assign_decree"),]),

      # ("go_back_dot",[],"Go back.",[(jump_to_menu, "mnu_center_manage_2")]),
    # ],
  # ),

  # (
    # "center_assign_decree",0,
    # "{s30}^^{s31}^^Are you sure you want to {s32} this decree.",
    # "none",
    # [
     # (call_script, "script_set_town_picture"),
     # (call_script, "script_get_decree_details", "$g_improvement_type"),
	 # (try_begin),
		# (eq, "$temp", 1),
		# (str_store_string, s32, "@enact"),
	 # (else_try),
		# (eq, "$temp", 0),
		# (str_store_string, s32, "@revoke"),
	 # (try_end),
    # ],
    # [
      # ##diplomacy begin
      # ("dplmc_improve_cont",
      # [
        # (gt, "$g_player_chamberlain", 0),
        # (store_troop_gold, ":cur_gold", "trp_household_possessions"),
        # (ge, ":cur_gold", decree_cost),
      # ], "Go on. (Pay from treasury)",
        # [
          # (call_script, "script_dplmc_withdraw_from_treasury", decree_cost),

		# (party_set_slot, "$current_town", "$g_improvement_type", "$temp"),

          # (jump_to_menu,"mnu_center_manage_2"),
         # ]
      # ),
      # ("improve_not_enough_gold",[(gt, "$g_player_chamberlain", 0),
                                  # (store_troop_gold, ":cur_gold", "trp_household_possessions"),
                                  # (lt, ":cur_gold", decree_cost),
                                  # (disable_menu_option)],
       # "Insufficient fund in the treasury.", []),
      # ##diplomacy end

      # ("improve_cont",[(store_troop_gold, ":cur_gold", "trp_player"),
                       # (ge, ":cur_gold", decree_cost)],
       # "Go on.", [
				  # (party_set_slot, "$current_town", "$g_improvement_type", "$temp"),
                  # (troop_remove_gold, "trp_player", decree_cost),

                  # (jump_to_menu,"mnu_center_manage_2"),
                  # ]),
      # ("improve_not_enough_gold",[(store_troop_gold, ":cur_gold", "trp_player"),
                                  # (lt, ":cur_gold", decree_cost),
                                  # (disable_menu_option)],
       # "I don't have enough money for that.", []),
      # ("forget_it",[], "Forget it.", [(jump_to_menu,"mnu_center_manage_2")]),

    # ],
  # ),

  # (
    # "center_improve",mnf_scale_picture,
    # "{s19} As the party member with the highest engineer skill ({reg2}), {reg3?you reckon:{s3} reckons} that building the {s4} will cost you\
 # {reg5} denars and will take {reg6} days.^^The building time and costs are modified by: Skill: {reg44}%,  slave politic of the realm: {reg45}%.\
 # Additionally, the building time is modified by the number of prisoners in the town: {reg46}%.",
    # "none",
    # [#SB : town pictures
    # #(set_background_mesh, "mesh_pic_building_project"),
    # (call_script, "script_set_town_picture"),
    # (call_script, "script_get_improvement_details", "$g_improvement_type"),
    # (assign, ":improvement_cost", reg0),
    # (assign, ":improvement_time", reg40),

    # (str_store_string, s4, s0),
    # (str_store_string, s19, s1),
    # (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
    # (assign, ":max_skill", reg0),
    # (assign, ":max_skill_owner", reg1),
    # (assign, reg2, ":max_skill"),

    # (party_get_num_prisoners, ":num_prisoners", "$current_town"), #possibly up to 100
    # (val_div, ":num_prisoners", 5), ##5 prisoners improve by 1%
    # (val_clamp, ":num_prisoners", 0, 31),
    # (store_sub, ":num_prisoners_modifier", 100, ":num_prisoners"),

# ##new code:
# ##same code applies for CAI
    # (store_faction_of_party, ":faction_no", "$current_town"),
    # (faction_get_slot, ":serfdom", ":faction_no", dplmc_slot_faction_serfdom),

    # (val_add, ":serfdom", 3),
    # (store_sub, ":modifer", 100, ":serfdom"),
    # (val_mul, ":max_skill", 2),##20 or so
    # (store_sub, ":modifer2", 160, ":max_skill"),

    # (val_mul, ":improvement_time", ":modifer"),
    # (val_div, ":improvement_time", 100),
    # (val_mul, ":improvement_cost", ":modifer"),
    # (val_div, ":improvement_cost", 100),

    # (val_mul, ":improvement_time", ":num_prisoners_modifier"),
    # (val_div, ":improvement_time", 100),

    # (val_mul, ":improvement_time", ":modifer2"),
    # (val_div, ":improvement_time", 160),
    # (val_mul, ":improvement_cost", ":modifer2"),
    # (val_div, ":improvement_cost", 160),
    # (assign, reg44, ":max_skill"),#skill
    # (assign, reg45, ":serfdom"),#politic
    # (assign, reg46, ":num_prisoners"),#prisoner

    # (assign, reg5, ":improvement_cost"),
    # (assign, reg6, ":improvement_time"),

    # #SB : tableau at bottom
    # (try_begin),
        # (eq, ":max_skill_owner", "trp_player"),
        # (assign, reg3, 1),
    # (else_try),
        # (assign, reg3, 0),
        # (str_store_troop_name, s3, ":max_skill_owner"),
    # (try_end),

    # #SB : assign globals to be safe
    # (assign, "$diplomacy_var", ":improvement_cost"),
    # (assign, "$diplomacy_var2", ":improvement_time"),
    # (assign, "$lord_selected", ":max_skill_owner"),
    # (set_fixed_point_multiplier, 100),
    # (position_set_x, pos0, 70),
    # (position_set_y, pos0, 5),
    # (position_set_z, pos0, 75),
    # (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", ":max_skill_owner", pos0),
    # ],
    # [
      # ##diplomacy begin
      # ("dplmc_improve_cont",
      # [
        # (gt, "$g_player_chamberlain", 0),
        # (store_troop_gold, ":cur_gold", "trp_household_possessions"),
        # (ge, ":cur_gold", "$diplomacy_var"),
      # ], "Go on. (Pay from treasury)",
        # [
          # (call_script, "script_dplmc_withdraw_from_treasury", "$diplomacy_var"),
          # # (call_script, "script_get_max_skill_of_player_party", "skl_engineer"), #SB : re-fetch skill
          # (call_script, "script_improve_center", "$g_encountered_party", "$lord_selected", "$diplomacy_var2"),
          # (try_begin),
            # (eq, "$g_improvement_type", slot_center_has_temple),
            # (party_set_slot, "$g_encountered_party", slot_center_has_temple_god, "$temp4_1"),
          # (try_end),
          # (jump_to_menu,"mnu_center_manage_2"),
         # ]
      # ),
      # ("improve_not_enough_gold",[(gt, "$g_player_chamberlain", 0),
                                  # (store_troop_gold, ":cur_gold", "trp_household_possessions"),
                                  # (lt, ":cur_gold", "$diplomacy_var"),
                                  # #SB : disable_menu_option
                                  # (disable_menu_option)],
       # "Insufficient fund in the treasury.", []),
      # ##diplomacy end

      # ("improve_cont",[(store_troop_gold, ":cur_gold", "trp_player"),
                       # (ge, ":cur_gold", "$diplomacy_var")],
       # "Go on.", [
          # (try_begin), #fast build
            # (ge, "$cheat_mode", 1),
            # (assign, "$diplomacy_var2", 0),
           # (else_try),
            # (troop_remove_gold, "trp_player", "$diplomacy_var"),
            # (try_end),
            # (call_script, "script_improve_center", "$g_encountered_party", "$lord_selected", "$diplomacy_var2"),
          # (try_begin),
            # (eq, "$g_improvement_type", slot_center_has_temple),
            # (party_set_slot, "$g_encountered_party", slot_center_has_temple_god, "$temp4_1"),
          # (try_end),

                  # (jump_to_menu,"mnu_center_manage_2"),
                  # ]),
      # ("improve_not_enough_gold",[(store_troop_gold, ":cur_gold", "trp_player"),
                                  # (lt, ":cur_gold", "$diplomacy_var"),
                                  # #SB : disable_menu_option
                                  # (disable_menu_option)],
       # "I don't have enough money for that.", []),
      # ("forget_it",[], "Forget it.", [(jump_to_menu,"mnu_center_manage_2")]),

    # ],
  # ),

("garrison_management",mnf_disable_all_keys,
  "You can exchange troops with the garrison. Size of the garrison: {reg31}. Number of prisoners: {reg30}^^{s22}^^You can also buy slaves from local slave traders which will be added to the prisoners of the settlement, but it is very expensive. Prisoners in the garrison will decrease construction time upon building something.",
  "none",[
    (party_set_flags, "$g_encountered_party", pf_limit_members, 0),#clear flag later on
    (assign, reg62, 0),

    (party_get_num_prisoners, reg30, "$g_encountered_party"),
    (store_party_size_wo_prisoners, reg31, "$g_encountered_party"),
    (str_clear, s22),
    (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
        (call_script,"script_cf_fix_party_size_village","$g_encountered_party",1),
        (str_store_string, s22, "@If you place prisoners in your village they will work on the fields and in the mines and generate additional rents."),
    (try_end),
  ],[
    ("exchange",[
      (this_or_next|eq, reg63, 1),
      (eq, reg63, 2),
    ],"Manage cohorts.",[
      (start_presentation, "prsnt_manage_cohorts_town"),
    ]),
    ("exchange",[
      (this_or_next|eq, reg63, 1),
      (eq, reg63, 2),
    ],"Exchange.",[
      (change_screen_exchange_members,1),
    ]),
    ("exchange",[
      (eq, reg63, 0),
    ],"Review garrison and prisoners.",[
      (call_script, "script_view_party_members","$g_encountered_party"),
    ]),
    ("add_prisoners",[
      (this_or_next|eq, reg63, 1),
      (eq, reg63, 2),
      (party_get_num_prisoners, ":prisoners", "p_main_party"),
      (ge, ":prisoners", 1),
    ],"Drop off all non-hero prisoners.",[
      (assign, "$g_move_heroes", 0),
      (call_script, "script_party_prisoners_add_party_prisoners", "$g_encountered_party", "p_main_party"),
      (call_script, "script_party_remove_all_prisoners", "p_main_party"),
    ]),
    ("add_members",[
      (this_or_next|eq, reg63, 1),
      (eq, reg63, 2),
      (store_party_size_wo_prisoners, ":men", "p_main_party"),
      (ge, ":men", 1),
    ],"Drop off all your  non-hero party members.",[
      (assign, "$g_move_heroes", 0),
      (call_script, "script_party_add_party_companions", "$g_encountered_party", "p_main_party"),
      (call_script, "script_party_remove_all_companions", "p_main_party"),
    ]),
    ("slaves_0",[
      (party_slot_eq, "$g_encountered_party", slot_town_lord, "trp_player"),
    ],"Buy 25 slaves. (25,000 denars)",[
      (try_begin),
          (store_troop_gold, ":gold", "trp_household_possessions"),
          (ge, ":gold", 25000),
          (party_add_prisoners, "$g_encountered_party", "trp_slave", 25),
          (call_script, "script_dplmc_withdraw_from_treasury", 25000),
      (else_try),
          (store_troop_gold, ":gold", "trp_player"),
          (ge, ":gold", 25000),
          (party_add_prisoners, "$g_encountered_party", "trp_slave", 25),
          (troop_remove_gold, "trp_player", 25000),
      (try_end),
    ]),
    ("slaves_1",[
      (party_slot_eq, "$g_encountered_party", slot_town_lord, "trp_player"),
    ],"Buy 50 slaves. (50,000 denars)",[
      (try_begin),
          (store_troop_gold, ":gold", "trp_household_possessions"),
          (ge, ":gold", 50000),
          (party_add_prisoners, "$g_encountered_party", "trp_slave", 50),
          (call_script, "script_dplmc_withdraw_from_treasury", 50000),
      (else_try),
          (store_troop_gold, ":gold", "trp_player"),
          (ge, ":gold", 50000),
          (party_add_prisoners, "$g_encountered_party", "trp_slave", 50),
          (troop_remove_gold, "trp_player", 50000),
      (try_end),
    ]),
    ("slaves_2",[
      (party_slot_eq, "$g_encountered_party", slot_town_lord, "trp_player"),
    ],"Buy 100 slaves. (100,000 denars)",[
      (try_begin),
          (store_troop_gold, ":gold", "trp_household_possessions"),
          (ge, ":gold", 100000),
          (party_add_prisoners, "$g_encountered_party", "trp_slave", 100),
          (call_script, "script_dplmc_withdraw_from_treasury", 100000),
      (else_try),
          (store_troop_gold, ":gold", "trp_player"),
          (ge, ":gold", 100000),
          (party_add_prisoners, "$g_encountered_party", "trp_slave", 100),
          (troop_remove_gold, "trp_player", 100000),
      (try_end),
    ]),
    ("continue",[
      (neq, reg63, 2),
    ],"Go back.",[
      (jump_to_menu, "mnu_center_manage_2"),
    ]),
    ("continue",[
      (eq, reg63, 2),
    ],"Go back.",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

 (
    "town_bandits_failed",mnf_disable_all_keys,
    "{s4} {s5}",
    "none",
    [
#      (call_script, "script_loot_player_items", 0),
      (store_troop_gold, ":total_gold", "trp_player"),
      (store_div, ":gold_loss", ":total_gold", 30),
      (store_random_in_range, ":random_loss", 40, 100),
      (val_add, ":gold_loss", ":random_loss"),
      (val_min, ":gold_loss", ":total_gold"),
      (troop_remove_gold, "trp_player",":gold_loss"),
      (party_set_slot, "$current_town", slot_center_has_bandits, 0),
      (party_get_num_companions, ":num_companions", "p_main_party"),
      (str_store_string, s4, "@The assasins beat you down and leave you for dead. ."),
      (str_store_string, s4, "@You have fallen. The bandits quickly search your body for every coin they can find,\
 then vanish into the night. They have left you alive, if only barely."),
      (try_begin),
        (gt, ":num_companions", 2),
        (str_store_string, s5, "@Luckily some of your companions come to search for you when you do not return, and find you lying by the side of the road. They hurry you to safety and dress your wounds."),
      (else_try),
        (str_store_string, s5, "@Luckily some passing townspeople find you lying by the side of the road, and recognise you as something other than a simple beggar. They carry you to the nearest inn and dress your wounds."),
      (try_end),
    ],
    [
      ("continue",[],"Continue...",[(change_screen_return),
      #SB : lose renown for easy encounters
      (call_script, "script_change_troop_renown", "trp_player", -2),
      ]),
    ],
  ),

  (
    "town_bandits_succeeded",mnf_disable_all_keys,
    "The enemies fall before you as wheat to a scythe! Soon you stand alone in the streets\
 while your attackers lie unconscious, dead or dying.\
 Searching the bodies, you find a purse which must have belonged to a previous victim of these brute.\
 Or perhaps, it was provided by someone who wanted to arrange a suitable ending to your life.",
    "none",
    [
      # (party_set_slot, "$current_town", slot_center_has_bandits, 0), #we need this
      (party_get_slot, ":bandit_troop", "$current_town", slot_center_has_bandits),
      (assign, "$g_last_defeated_bandits_town", "$g_encountered_party"),
      (try_begin),
        (check_quest_active, "qst_deal_with_night_bandits"),
        (neg|check_quest_succeeded, "qst_deal_with_night_bandits"),
        (quest_slot_eq, "qst_deal_with_night_bandits", slot_quest_target_center, "$g_encountered_party"),
        (call_script, "script_succeed_quest", "qst_deal_with_night_bandits"),
      (try_end),
      #SB : variable rewards, since we have different bandits in play
      (call_script, "script_game_get_join_cost", ":bandit_troop"),
      (store_mul, ":xp_reward", "$num_center_bandits", reg0),
      (try_begin), #reduce bonus exp, since town missions troops don't use horses
        (troop_is_mounted, ":bandit_troop"),
        (val_div, ":xp_reward", 2),
      (try_end),
      (add_xp_to_troop, ":xp_reward", "trp_player"),
      (call_script, "script_game_get_upgrade_cost", ":bandit_troop"), #20, 40, 80
      (store_mul, ":gold_reward", "$num_center_bandits", reg0),
      (call_script, "script_troop_add_gold", "trp_player", ":gold_reward"),
    ],
    [
      ("continue",[],"Continue...",[
        (party_set_slot, "$current_town", slot_center_has_bandits, 0),
        (change_screen_return),
      ]),
    ],
  ),

   (
    "village_steal_cattle_confirm",0,
    "As the party member with the highest looting skill ({reg2}), {reg3?you reckon:{s1} reckons} that you can steal as many as {reg4} heads of village's cattle.",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
      (assign, reg2, reg0),
      (assign, ":max_skill_owner", reg1),
      (try_begin),
        (eq, ":max_skill_owner", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":max_skill_owner"),
      (try_end),
      (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
      (assign, reg4, reg0),
      ],
    [
      ("village_steal_cattle_confirm",[],"Go on.",
       [
         (rest_for_hours_interactive, 3, 5, 1), #rest while attackable
         (assign, "$auto_menu", "mnu_village_steal_cattle"),
         (change_screen_return),
       ]),
      ("forget_it",[],"Forget it.",[(change_screen_return)]),
    ],
  ),

  (
    "village_steal_cattle",mnf_disable_all_keys,
    "{s1}",
    "none",
    [
      (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
      (assign, ":max_value", reg0),
      (val_add, ":max_value", 1),
      (store_random_in_range, ":random_value", 0, ":max_value"),
      (party_set_slot, "$current_town", slot_village_player_can_not_steal_cattle, 1),
      (party_get_slot, ":lord", "$current_town", slot_town_lord),
      (try_begin),
        (le, ":random_value", 0),
        (call_script, "script_change_player_relation_with_center", "$current_town", -3),
        (str_store_string, s1, "@You fail to steal any cattle."),
      (else_try),
        (assign, reg17, ":random_value"),
        (store_sub, reg12, ":random_value", 1),
        (try_begin),
          (gt, ":lord", 0),
          (call_script, "script_change_player_relation_with_troop", ":lord", -3),
          (call_script, "script_add_log_entry", logent_player_stole_cattles_from_village, "trp_player",  "$current_town", ":lord", "$g_encountered_party_faction"),
        (try_end),
        (call_script, "script_change_player_relation_with_center", "$current_town", -5),
        (str_store_string, s1, "@You drive away {reg17} {reg12?heads:head} of cattle from the village's herd."),

        (call_script, "script_create_cattle_herd", "$current_town", ":random_value"),
        (party_get_slot, ":num_cattle", "$current_town", slot_village_number_of_cattle),
        (val_sub, ":num_cattle", ":random_value"),
        (party_set_slot, "$current_town", slot_village_number_of_cattle, ":num_cattle"),

        #SB : add lesser renown bonus
        (try_begin),
          (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
          (neq, reg1, "trp_player"),
          (call_script, "script_change_troop_renown", reg1, dplmc_companion_skill_renown / 2),
        (try_end),
      (try_end),
    ],
    [
      ("continue",[],"Continue...",
       [
         (change_screen_return),
         ]),
    ],
  ),

   (
    "village_take_food_confirm",0,
    "It will be difficult to force and threaten the peasants into giving their precious supplies. You think you will need at least one hour.",
    #TODO: mention looting skill?
    "none",
    [],
    [
      ("village_take_food_confirm",[],"Go ahead.",
       [
         (rest_for_hours_interactive, 1, 5, 0), #rest while not attackable
         (assign, "$auto_enter_town", "$current_town"),
         (assign, "$g_town_visit_after_rest", 1),
         (assign, "$auto_enter_menu_in_center", "mnu_village_take_food"),
         (change_screen_return),
         ]),
      ("forget_it",[],"Forget it.",[(jump_to_menu, "mnu_village_hostile_action")]),
    ],
  ),

  (
    "village_take_food",0,
    "The villagers grudgingly bring out what they have for you.",
    "none",
    [
       (call_script, "script_party_count_members_with_full_health","p_main_party"),
       (assign, ":player_party_size", reg0),
       (call_script, "script_party_count_members_with_full_health","$current_town"),
       (assign, ":villagers_party_size", reg0),
       (try_begin),
         (lt, ":player_party_size", 6),
         (ge, ":villagers_party_size", 40),
         (neg|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
         (jump_to_menu, "mnu_village_start_attack"),
       (try_end),
    ],
    [
      ("take_supplies",[],"Take the supplies.",
       [
         (try_begin),
           (party_slot_ge, "$current_town", slot_center_player_relation, -55),
           (try_begin),
             (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
             (call_script, "script_change_player_relation_with_center", "$current_town", -1),
           (else_try),
             (call_script, "script_change_player_relation_with_center", "$current_town", -3),
           (try_end),
         (try_end),
         (party_get_slot, ":village_lord", "$current_town", slot_town_lord),
         (try_begin),
           (gt,  ":village_lord", 1),
           (call_script, "script_change_player_relation_with_troop", ":village_lord", -1),
          (try_end),
         (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
         (party_get_skill_level, ":player_party_looting", "p_main_party", "skl_looting"),
         (val_mul, ":player_party_looting", 3),
         (store_sub, ":random_chance", 70, ":player_party_looting"), #Increases the chance of looting by 3% per skill level
         (try_for_range, ":slot_no", num_equipment_kinds ,max_inventory_items + num_equipment_kinds),
           (store_random_in_range, ":rand", 0, 100),
           (lt, ":rand", ":random_chance"),
           (troop_set_inventory_slot, ":merchant_troop", ":slot_no", -1),
         (try_end),

###NPC companion changes begin
         (call_script, "script_objectionable_action", tmt_humanitarian, "str_steal_from_villagers"),
#NPC companion changes end
#Troop commentary changes begin
          (call_script, "script_add_log_entry", logent_village_extorted, "trp_player",  "$current_town", -1, -1),
          (store_faction_of_party,":village_faction",  "$current_town"),
          #SB : this war penalty should be lower for accosting farmers instead of raiding outright
          (call_script, "script_faction_inflict_war_damage_on_faction", "$players_kingdom", ":village_faction", 3),
#Troop commentary changes end

         #SB : sometimes this will actually be empty
         (jump_to_menu, "mnu_village"),
         (troop_sort_inventory, ":merchant_troop"),
         (change_screen_loot, ":merchant_troop"),
         ]),
      ("let_them_keep_it",[],"Let them keep it.",[(jump_to_menu, "mnu_village")]),
    ],
  ),

  ( #SB : added fugitive related strings
    "village_start_attack",mnf_disable_all_keys|mnf_scale_picture,
    "Some of the angry villagers grab their tools and prepare to resist you.\
 It looks like you'll have a fight on your hands if you continue.{s1}",
    "none",
    [
       (set_background_mesh, "mesh_pic_villageriot"),
       (call_script, "script_party_count_members_with_full_health","p_main_party"),
       (assign, ":player_party_size", reg0),
       (call_script, "script_party_count_members_with_full_health","$current_town"),
       (assign, ":villagers_party_size", reg0),

       (try_begin), #SB : tweak fight avoidance parameters
         #also if we lost but reduced their numbers, don't allow this condition to be true
         (neq, "$g_battle_result", -1),
         (this_or_next|le, ":villagers_party_size", 30),
         (gt, ":player_party_size", ":villagers_party_size"),
         (jump_to_menu, "mnu_village_loot_no_resist"),
       (else_try),
         (this_or_next|eq, ":villagers_party_size", 0),
         (eq, "$g_battle_result", 1),
         (try_begin),
           (eq, "$g_battle_result", 1),
           (store_random_in_range, ":enmity", -30, -15),
           (call_script, "script_change_player_relation_with_center", "$current_town", ":enmity"),
           (party_get_slot, ":town_lord", "$current_town", slot_town_lord),
           (gt, ":town_lord", 0),
           (call_script, "script_change_player_relation_with_troop", ":town_lord", -3),
         (try_end),
         (jump_to_menu, "mnu_village_loot_no_resist"),
       (else_try),
         (eq, "$g_battle_result", -1),
         (try_begin), #if we did not knock him out or kill him, he escapes
           (check_quest_active, "qst_hunt_down_fugitive"),
           (quest_slot_eq, "qst_hunt_down_fugitive", slot_quest_target_center, "$current_town"),
           (neg|check_quest_succeeded, "qst_hunt_down_fugitive"),
           (jump_to_menu, "mnu_village_hunt_down_fugitive_defeated"),
         (else_try),
           (jump_to_menu, "mnu_village_loot_defeat"),
         (try_end),
       (try_end),

       #SB : display string indicating fugitive is here
      (try_begin), #if we did not knock him out or kill him, he escapes
        (check_quest_active, "qst_hunt_down_fugitive"),
        (quest_slot_eq, "qst_hunt_down_fugitive", slot_quest_target_center, "$current_town"),
        (neg|check_quest_succeeded, "qst_hunt_down_fugitive"),
        (quest_get_slot, ":quest_target_dna", "qst_hunt_down_fugitive", slot_quest_target_dna),
        (call_script, "script_get_name_from_dna_to_s50", ":quest_target_dna"),
        (str_store_string, s1, "@ From your vantage point you see a man matching the description of {s50} arming himself with a sword during the commotion. If you do not press on the fugitive will slip away!"),
      (else_try),
        (str_clear, s1),
      (try_end),
    ],
    [
      ("village_raid_attack",[],"Charge them.",[
          (store_random_in_range, ":enmity", -10, -5),
          (call_script, "script_change_player_relation_with_center", "$current_town", ":enmity"),
          (try_begin),
            (party_get_slot, ":town_lord", "$current_town", slot_town_lord),
            (gt, ":town_lord", 0),
            (call_script, "script_change_player_relation_with_troop", ":town_lord", -3),
          (try_end),
          #SB : add fugitive as defender here
          (try_begin),
            (check_quest_active, "qst_hunt_down_fugitive"),
            (quest_slot_eq, "qst_hunt_down_fugitive", slot_quest_target_center, "$current_town"),
            (neg|check_quest_succeeded, "qst_hunt_down_fugitive"),
            (neg|check_quest_failed, "qst_hunt_down_fugitive"),
            (quest_set_slot, "qst_hunt_down_fugitive", slot_quest_current_state, 1), #normally this is activated in dialogs
            (party_add_members, "$current_town", "trp_fugitive", 1),
          (try_end),
          (call_script, "script_calculate_battle_advantage"),
          (set_battle_advantage, reg0),
          (set_party_battle_mode),
          (assign, "$g_battle_result", 0),
          (set_jump_mission,"mt_village_raid"),
          (party_get_slot, ":scene_to_use", "$current_town", slot_castle_exterior),
          (jump_to_scene, ":scene_to_use"),
          (assign, "$g_next_menu", "mnu_village_start_attack"),

          (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$g_encountered_party"),
###NPC companion changes begin
          (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"),
#NPC companion changes end

          (jump_to_menu, "mnu_battle_debrief"),
          (change_screen_mission),
          ]),
      ("village_raid_leave",[],"Leave this village alone.",[(change_screen_return),
      #SB : fail fugitive quest if player backs away from demands
      (try_begin),
        (check_quest_active, "qst_hunt_down_fugitive"),
        (quest_slot_eq, "qst_hunt_down_fugitive", slot_quest_target_center, "$current_town"),
        (neg|check_quest_concluded, "qst_hunt_down_fugitive"),
        (call_script, "script_fail_quest", "qst_hunt_down_fugitive"),
      (try_end),

      ]),
    ],
  ),

("village_loot_no_resist",0,
  "The villagers here are few and frightened, and they quickly scatter and run before you. The village is at your mercy.",
  "none",[
    (try_begin),
      (eq, "$auto_enter_menu_in_center", "mnu_village_take_food"),
      (jump_to_menu, "$auto_enter_menu_in_center"),
    (try_end),
  ],[
    ("village_loot",[], "Plunder the village, then raze it.",[
      (call_script, "script_village_set_state", "$current_town", svs_being_raided),
      (party_set_slot, "$current_town", slot_village_raided_by, "p_main_party"),
      (assign,"$g_player_raiding_village","$current_town"),

      (try_begin),
        (store_faction_of_party, ":village_faction", "$current_town"),
        (store_relation, ":relation", "$players_kingdom", ":village_faction"),
        (ge, ":relation", 0),
        (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$current_town"),
      (try_end),

      (rest_for_hours_interactive, 3, 5, 1), #rest while attackable (3 hours will be extended by the trigger)
      (party_set_slot, "$current_town", slot_town_last_nearby_fire_time, 1), #raiding mode
      (change_screen_return),
    ]),

      #SB : alternative option if that's your thing
    ("village_enslave", [
      (party_get_num_companions, ":amount", "$current_town"),
      (gt, ":amount", 0), #if we haven't killed them all in the first charge
      # (party_get_free_prisoners_capacity, ":capacity", "p_main_party"), #be slightly wary of this operation
      # (gt, ":capacity", 0), #if we have room
      (troops_can_join_as_prisoner, 1),
    ], "Chase after the remaining villagers and enslave them.",[
      (call_script, "script_village_set_state", "$current_town", svs_being_raided), #target is deserted, not looted
      (party_set_slot, "$current_town", slot_village_raided_by, "p_main_party"),
      (assign,"$g_player_raiding_village","$current_town"),

      (try_begin),
          (store_faction_of_party, ":village_faction", "$current_town"),
          (store_relation, ":relation", "$players_kingdom", ":village_faction"),
          (ge, ":relation", 0),
          (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$current_town"),
      (try_end),

    #add a party template to represent hiding villagers so we don't go empty-handed
      (party_add_template, "$current_town", "pt_women"),

      (try_begin),
          (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_asia_syr),
          (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_asia_jude),
          (party_slot_eq, "$current_town", slot_center_province, p_asia_arab),
          (store_random_in_range, ":random", 20, 120),
          (le, ":random", 60),
          (store_random_in_range, ":random", 4, 15),
          (try_begin),
              (le, ":random", 7),
              (assign, ":peasant", "trp_arab_peasant"),
          (else_try),
              (assign, ":peasant", "trp_judean_peasant"),
          (try_end),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_province, p_afrc_egyp),
          (store_random_in_range, ":random", 20, 120),
          (le, ":random", 60),
          (store_random_in_range, ":random", 5, 15),
          (try_begin),
              (le, ":random", 7),
              (assign, ":peasant", "trp_judean_peasant"),
          (else_try),
              (assign, ":peasant", "trp_african_man"),
          (try_end),
      (else_try),
          (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_asia_assy),
          (party_slot_eq, "$current_town", slot_center_province, p_asia_meso),
          (store_random_in_range, ":random", 20, 120),
          (le, ":random", 60),
          (assign, ":peasant", "trp_persian_peasant"),
      (else_try),
          (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_afrc_maur),
          (party_slot_eq, "$current_town", slot_center_province, p_afrc_afrc),
          (store_random_in_range, ":random", 20, 120),
          (le, ":random", 60),
          (assign, ":peasant", "trp_berber_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_province, p_afrc_cyre),
          (store_random_in_range, ":random", 20, 120),
          (le, ":random", 60),
          (assign, ":peasant",  "trp_garamantian_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_1"),
          (assign, ":peasant", "trp_dacian_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2"),
          (assign, ":peasant", "trp_celtic_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2_1"),
          (assign, ":peasant", "trp_celtic_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_3"),
          (assign, ":peasant", "trp_sarmatian_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_9"),
          (assign, ":peasant", "trp_germanic_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_4"),
          (assign, ":peasant", "trp_germanic_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_5"),
          (assign, ":peasant", "trp_armenian_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_6"),
          (assign, ":peasant", "trp_parthian_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_8"),
          (assign, ":peasant", "trp_judean_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_9"),
          (assign, ":peasant", "trp_bosporan_peasant"),
      (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
          (assign, ":peasant", "trp_roman_peasant"),
      (else_try),
          (assign, ":peasant", "trp_slave"),
      (try_end),

      (party_add_members, "$current_town", ":peasant", 10),
      (try_begin),
          (lt, "$player_honor", -90),
          (party_add_members, "$current_town", ":peasant", 15),
      (else_try),
          (lt, "$player_honor", -70),
          (party_add_members, "$current_town", ":peasant", 12),
      (else_try),
          (lt, "$player_honor", -40),
          (party_add_members, "$current_town", ":peasant", 9),
      (else_try),
          (lt, "$player_honor", -20),
          (party_add_members, "$current_town", ":peasant", 6),
      (try_end),
      #(party_add_template, "$current_town", "pt_village_defenders"),
      #add some smoke right away
      # (party_add_particle_system, "$current_town", "psys_map_village_fire"),

      (rest_for_hours, 3, 5, 1), #rest while attackable
      (party_set_slot, "$current_town", slot_town_last_nearby_fire_time, 2), #enslavement mode
      (assign, "$qst_eliminate_bandits_infesting_village_num_villagers", 0),
      (change_screen_return),
    ]),
    ("village_raid_leave",[],"Leave this village alone.",[(change_screen_return)]),
]),
("village_loot_complete",mnf_disable_all_keys,
  "On your orders your troops sack {s22}, pillaging everything of any value, and then put the buildings to the torch. From the coins and valuables that are found, you get your share of {reg23} denars.",
  "none",[
    (str_store_party_name, s22, "$current_town"),

    (party_get_slot, ":village_lord", "$current_town", slot_town_lord),
    (try_begin),
        (gt,  ":village_lord", 0),
        (call_script, "script_change_player_relation_with_troop", ":village_lord", -5),
    (try_end),
    (store_random_in_range, ":enmity", -35, -25),
    (call_script, "script_change_player_relation_with_center", "$current_town", ":enmity"),

    (store_faction_of_party, ":village_faction", "$current_town"),
    (store_relation, ":relation", ":village_faction", "fac_player_supporters_faction"),
    (try_begin),
        (lt, ":relation", 0),
        (call_script, "script_change_player_relation_with_faction", ":village_faction", -3),
    (try_end),

    (party_get_slot, ":village_elder", "$current_town",slot_town_elder),
    (try_begin),
        (gt, ":village_elder", 0),
        (store_troop_gold, ":money_gained", ":village_elder"),
        (troop_remove_gold, ":village_elder", ":money_gained"),
    (else_try),
        (assign, ":money_gained", 50),
    (try_end),
    (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
    # (assign, reg22, ":prosperity"),
    # (display_message, "@Prosperity: {reg22}"),#
    (val_add, ":prosperity", 60),
    (val_mul, ":prosperity", 5),
    (val_add, ":money_gained", ":prosperity"),
    (try_begin),
        (lt, "$player_honor", -120),
        (val_mul, ":money_gained", 2),
    (else_try),
        (lt, "$player_honor", -90),
        (val_mul, ":money_gained", 15),
        (val_div, ":money_gained", 10),
    (else_try),
        (lt, "$player_honor", -70),
        (val_mul, ":money_gained", 14),
        (val_div, ":money_gained", 10),
    (else_try),
        (lt, "$player_honor", -40),
        (val_mul, ":money_gained", 13),
        (val_div, ":money_gained", 10),
    (else_try),
        (lt, "$player_honor", -20),
        (val_mul, ":money_gained", 12),
        (val_div, ":money_gained", 10),
    (try_end),
    (call_script, "script_troop_add_gold", "trp_player", ":money_gained"),
    (assign, reg23, ":money_gained"),

    (assign, ":morale_increase", 3),
    (store_div, ":money_gained_div_100", ":money_gained", 100),
    (val_add, ":morale_increase", ":money_gained_div_100"),
    (call_script, "script_change_player_party_morale", ":morale_increase"),

    # (faction_get_slot, ":faction_morale", ":village_faction",  slot_faction_morale_of_player_troops),
    (store_mul, ":morale_decrease", ":morale_increase", -200),
    (call_script, "script_change_faction_troop_morale", ":village_faction", ":morale_decrease", 1), #SB : script call
    # (val_sub, ":faction_morale", ":morale_increase_mul_2"),
    # (faction_set_slot, ":village_faction",  slot_faction_morale_of_player_troops, ":faction_morale"),
    (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"),
  ],[
  ("continue",[], "Continue...",[
    #steal cattle
    (jump_to_menu, "mnu_close"),
    (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
    (assign, ":max_cattle", reg0),
    (val_mul, ":max_cattle", 3),
    (val_div, ":max_cattle", 2),
    (party_get_slot, ":num_cattle", "$current_town", slot_village_number_of_cattle),
    (val_min, ":max_cattle", ":num_cattle"),
    (val_add, ":max_cattle", 1),
    (store_random_in_range, ":random_value", 0, ":max_cattle"),
    (try_begin),
        (gt, ":random_value", 0),
        (call_script, "script_create_cattle_herd", "$current_town", ":random_value"),
        (val_sub, ":num_cattle", ":random_value"),
        (party_set_slot, "$current_town", slot_village_number_of_cattle, ":num_cattle"),
    (try_end),

    #loot items
    (troop_clear_inventory, "trp_temp_troop"),

    #begin of changes
    #the above line is the culprit for divide by zero
    # (store_sub, ":item_to_price_slot", slot_town_trade_good_prices_begin, trade_goods_begin),
    (assign, ":item_to_price_slot", slot_town_trade_good_prices_begin),
    (reset_item_probabilities,100),
    (assign, ":total_probability", 1), #SB  : possible div/0 if slots are reset

    (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
        (party_get_slot, ":cur_price", "$current_town", ":item_to_price_slot"),
        (val_add, ":item_to_price_slot", 1),
        (call_script, "script_center_get_production", "$current_town", ":cur_goods"),
        # (str_store_item_name, s22, ":cur_goods"),
        # (display_message, "@{s22}: production {reg0}"),
        (assign, ":cur_probability", reg2),#use base production
        (call_script, "script_center_get_consumption", "$current_town", ":cur_goods"),
        # (str_store_item_name, s22, ":cur_goods"),
        # (display_message, "@{s22}: consumption {reg0}"),
        (assign, ":cur_consumption", reg0),
        (val_div, ":cur_consumption", 3),
        (val_add, ":cur_probability", ":cur_consumption"),
        (val_mul, ":cur_probability", 4),
        (try_begin),
            (eq, ":cur_price", 0),
            (val_add, ":cur_price", 1),
        (try_end),

        (val_mul, ":cur_probability", average_price_factor),
        (val_div, ":cur_probability", ":cur_price"), #divide by zero error here
        #first only simulation
        #(set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
        (val_add, ":total_probability", ":cur_probability"),
        # (assign, reg1, ":total_probability"),
        # (assign, reg2, ":cur_price"),
        # (assign, reg3, ":cur_probability"),
        # (assign, reg4, ":item_to_price_slot"),
        # (str_store_item_name, s1, ":cur_goods"),
        # (display_message, "@{s1} price : {reg2} in slot {reg4}, probability: {reg3};{reg1} total"),
    (try_end),

    (assign, ":item_to_price_slot", slot_town_trade_good_prices_begin),
    (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
        (party_get_slot, ":cur_price", "$current_town", ":item_to_price_slot"),
        (val_add, ":item_to_price_slot", 1),
        (call_script, "script_center_get_production", "$current_town", ":cur_goods"),
        (assign, ":cur_probability", reg2),#use base production
        (call_script, "script_center_get_consumption", "$current_town", ":cur_goods"),
        (assign, ":cur_consumption", reg0),
        (val_div, ":cur_consumption", 3),
        (val_add, ":cur_probability", ":cur_consumption"),
        (val_mul, ":cur_probability", 4),
        (try_begin),
            (eq, ":cur_price", 0),
            (val_add, ":cur_price", 1),
        (try_end),

        (val_mul, ":cur_probability", average_price_factor),
        (val_div, ":cur_probability", ":cur_price"), #divide by zero error here

        (val_mul, ":cur_probability", num_merchandise_goods),
        (try_begin),
            (neq, ":total_probability", 0),
            (val_mul, ":cur_probability", 100),
            (val_div, ":cur_probability", ":total_probability"),
            #(else_try),
            #	(assign, ":cur_probability", 0),
        (try_end),

        (assign, reg22, ":cur_probability"),
        # (str_store_item_name, s22, ":cur_goods"),
        # (display_message, "@{s22}: {reg22}"),
        (set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
    (try_end),
    #end of changes
    (party_get_skill_level, ":looting_skill", "p_main_party", "skl_looting"),
    (val_mul, ":looting_skill", 3),
    (val_add, ":looting_skill", 5),
    (troop_add_merchandise,"trp_temp_troop", itp_type_goods, ":looting_skill"),
    (troop_sort_inventory, "trp_temp_troop"),
    (change_screen_loot, "trp_temp_troop"),
  ]),
]),

("village_enslave_complete",mnf_disable_all_keys,
  "On your orders your troops rampage through the village, dragging peasants from their hovels and stripping them of all possessions. In the span of a few hours you've rounded up {reg1} prisoners, leaving the infirm and the younglings behind. As you march the trussed-up villagers away from the cooling ember of their broken hearths, you hear a distant howl...",
  "none",[
    (set_background_mesh, "mesh_pic_prisoner_wilderness"),
    (call_script, "script_objectionable_action", tmt_humanitarian, "str_sell_slavery"),

    # (party_get_slot, ":village_lord", "$current_town", slot_town_lord),
    # (try_begin),
      # (gt,  ":village_lord", 0),
      # (call_script, "script_change_player_relation_with_troop", ":village_lord", -5),
    # (try_end),
    (store_random_in_range, ":enmity", -35, -25),
    (call_script, "script_change_player_relation_with_center", "$current_town", ":enmity"),

    (party_add_particle_system, "$current_town", "psys_map_village_looted_smoke"),
    (store_faction_of_party, ":village_faction", "$current_town"),
    (store_relation, ":relation", ":village_faction", "fac_player_supporters_faction"),
    (try_begin),
      (lt, ":relation", 0),
      (call_script, "script_change_player_relation_with_faction", ":village_faction", -2),
    (try_end),

    (store_mul, ":morale_decrease", "$qst_eliminate_bandits_infesting_village_num_villagers", -150),
    (call_script, "script_change_faction_troop_morale", ":village_faction", ":morale_decrease", 1), #SB : script call
    (assign, reg1, "$qst_eliminate_bandits_infesting_village_num_villagers"),
  ],[
    ("continue",[], "Continue...",[
      (assign, "$g_leave_town", 1),
      (jump_to_menu, "mnu_village"),
    ]),
]),

  (
    "village_loot_defeat",mnf_scale_picture,
    "Fighting with courage and determination, the villagers manage to hold together and drive off your forces.",
    "none",
    [
        (set_background_mesh, "mesh_pic_villageriot"),
    ],
    [
      ("continue",[],"Continue...",[(change_screen_return),
      #SB : renown loss
      (call_script, "script_change_troop_renown", "trp_player", -3),
      ]),
    ],
  ),

("village_loot_continue",0,
  "Do you wish to continue looting this village?",
  "none",[
    (set_background_mesh, "mesh_pic_looted_village"),
  ],[
    ("loot_yes",[],"Yes.",[
      (rest_for_hours_interactive, 3, 5, 1), #rest while attackable (3 hours will be extended by the trigger)
      #SB : resume hostilities
      (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$current_town"),
      (change_screen_return),
    ]),
    ("loot_no",[],"No.",[
      (call_script, "script_village_set_state", "$current_town", 0),
      (party_set_slot, "$current_town", slot_village_raided_by, -1),
      (assign, "$g_player_raiding_village", 0),
      (party_set_slot, "$current_town", slot_town_last_nearby_fire_time, 0),
      (change_screen_return),
    ]),
]),

("close",0,
  "Nothing.",
  "none",[
    (change_screen_return),
  ],[
]),

("control",0,
  "The governor has issued a decree that everybody who wants to enter the town must register by the guards."
  +" Therefore, travellers of all kinds have to wait in line for hours before being admitted in.",
  "none",[
    (call_script, "script_set_town_picture"),
  ],[
    ("enter_the_town",[],"Continue...",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

("paganholysites_visit",0,
"You arrive at a local sanctuary. {s14} is worshipped here. Pilgrims from far away have come to the sanctuary to offer sacrifices to the gods. Traders use the opportunity to sell their goods."
+"^This place certainly treasures wealth!^^{s13}^^{s15}",
"none",[
    (try_begin),
        (party_slot_ge, "$g_encountered_party", slot_party_looted_left_days, 1),
        (jump_to_menu, "mnu_center_looted"),
    (try_end),

    (set_background_mesh, "mesh_pic_omen_bird"),

    (try_begin),  #forbidden to enter?
        (store_time_of_day, reg12),
        (is_between, reg12, 5, 21),
        (assign, "$all_doors_locked", 0),
        (str_clear, s13),
    (else_try),
        (assign, "$all_doors_locked", 1),
        (str_store_string, s13, "@It is night, and the sanctuary seems quiet."),
    (try_end),
    (party_get_slot, ":god", "$g_encountered_party", slot_paganside_god),
    (val_add, ":god", "str_gods_begin"),
    (str_store_string, s14, ":god"),

    (str_clear, s15),
    (try_begin),
        (eq, "$g_encountered_party", "p_caucasian_holy_side_2"),
        (str_store_string, s15, "@Further towards the North one can find the holy forests of Seraca. Folklore says that silvan spirits inhabitate the forest."),
    (try_end),

    (store_encountered_party, "$current_town"),
  ],[
    ("test_scene",[
      (ge, "$cheat_mode", 1),
    ],"Test scene",[
      (party_get_slot, ":exterior_scene", "$g_encountered_party", slot_castle_exterior),
      (modify_visitors_at_site, ":exterior_scene"),
      (jump_to_scene, ":exterior_scene"),
      (change_screen_mission),
    ],"Leave."),
    ("test_scene",[
      (eq, "$g_encountered_party", "p_caucasian_holy_side_2"),
    ],"Visit the holy forest of Seraca",[
      (set_jump_mission, "mt_explore_secret_place"),
      (modify_visitors_at_site, "scn_sacred_forests_seraca"),
      (reset_visitors),
      (set_jump_entry, 0),
      (try_begin),
          (neg|troop_slot_eq, "trp_ascetic", slot_troop_age, 1),
          (set_visitor, 1, "trp_ascetic"),
      (try_end),
      (jump_to_scene, "scn_sacred_forests_seraca"),
      (change_screen_mission),
    ],"Leave."),
    ("enter_hofho",[
    ],"Visit the sanctuary.",[
      (party_get_slot, ":exterior_scene", "$g_encountered_party", slot_castle_exterior),
      (modify_visitors_at_site, ":exterior_scene"),
      (reset_visitors),
      # Setup priest walkers
      # walker entries: 1-7 priests
      # 11-12 male walkers
      # 13 guard
      # 10-18 priests
      # 19-24 guards
      # 25- 31 women
      # 33 rich merchant
      # 34 poor merchant
      # for battle:
      # 1 defender
      # 30,3 attacker
      (party_get_slot, ":priest", "$g_encountered_party", slot_priest_troop),
      (party_get_slot, ":poor_merchant", "$g_encountered_party", slot_merchant_poor),
      (party_get_slot, ":rich_merchant", "$g_encountered_party", slot_merchant_rich),
      (try_begin),
          (eq, "$all_doors_locked",0),
          (party_get_slot, ":culture", "$g_encountered_party", slot_center_culture),
          (try_for_range, ":visiterator", 1, 8),
              (set_visitor, ":visiterator", ":priest"), #
          (try_end),
          (faction_get_slot, ":troop", ":culture", slot_faction_town_walker_male_troop),
          (try_for_range, ":visiterator", 11, 13),
              (set_visitor, ":visiterator", ":troop"),
          (try_end),
          (faction_get_slot, ":troop", ":culture", slot_faction_tier_5_troop),
          (try_for_range, ":visiterator", 13, 14),
              (set_visitor, ":visiterator", ":troop"),
          (try_end),
          (try_for_range, ":visiterator", 10, 18),
              (set_visitor, ":visiterator", ":priest"),
          (try_end),
          (faction_get_slot, ":troop", ":culture", slot_faction_tier_1_troop),
          (try_for_range, ":visiterator", 19, 25),
              (set_visitor, ":visiterator", ":troop"),
          (try_end),
          (try_for_range, ":visiterator", 26, 32),
              (set_visitor, ":visiterator", "trp_refugee"),
          (try_end),
          # (call_script, "script_init_town_walkers"),
          (set_visitor, 33, ":rich_merchant"),
          (set_visitor, 34, ":poor_merchant"),
      (try_end),
      (set_jump_mission,"mt_paganholysite"),
      (jump_to_scene, ":exterior_scene"),
      (change_screen_mission),
    ],"Leave."),
    ("hof_recruitho",[
      (party_slot_eq, "$g_encountered_party", slot_center_culture, "fac_culture_4"),
      (party_slot_eq,"$g_encountered_party",slot_center_volunteer_troop_type,0),#can recruit
      (party_get_free_companions_capacity, ":free_capacity", "p_main_party"),
      (ge, ":free_capacity", 2),
    ],"Try to recruit a berserker.",[
      (store_random_in_range, ":rand", 1, 8),
      (troop_get_slot, ":player_renown", "trp_player", slot_troop_renown),
      (try_begin),
          (le, ":player_renown", 150), # you have to be someone
          (jump_to_menu,"mnu_nonberserker_renown_low"),
      (else_try),
          (ge, ":rand", 7),
          (jump_to_menu,"mnu_berserker_recruit_2troop"),
      (else_try),
          (ge, ":rand", 4),
          (jump_to_menu,"mnu_berserker_recruit_troop"),
      (else_try),
          (jump_to_menu,"mnu_nonberserker_avaiable_troop"),
      (try_end),
    ]),
    # ("donate_hofho",[
    #   (eq, "$can_sacrific", 1),
    # ],"Make a small sacrifice to the gods (1000 denars).",[
    #     (party_get_slot, ":diety", "$g_encountered_party", slot_paganside_god),
    #     (call_script, "script_make_sacrifice", 1000, ":diety"),
    #     (change_screen_return),
    # ]),
    # ("donate_hofho",[
    #   (eq, "$can_sacrific", 1),
    # ],"Make a medium sacrifice to the gods (5000 denars).",[
    #   (party_get_slot, ":diety", "$g_encountered_party", slot_paganside_god),
    #   (call_script, "script_make_sacrifice", 5000, ":diety"),
    #   (change_screen_return),
    # ]),
    # ("donate_hofho",[
    #   (eq, "$can_sacrific", 1),
    # ],
    # "Make a large sacrifice to the gods (10000 denars).",
    # [
    #   (party_get_slot, ":diety", "$g_encountered_party", slot_paganside_god),
    #   (call_script, "script_make_sacrifice", 10000, ":diety"),
    #   (change_screen_return),
    # ]),
    ("camp_wait_hereho",[],"Wait here for some time.",[
      (assign,"$g_camp_mode", 1),
      (assign, "$g_infinite_camping", 0),
      (assign, "$g_player_icon_state", pis_camping),
      (rest_for_hours_interactive, 24 * 365, 5, 0), #rest while no attackable
      (change_screen_return),
    ]),
    ("pillage_hofho",[
    ],"Raid the sanctuary.",[
      (jump_to_menu, "mnu_are_you_sure"),
    ]),
    ("leaveho",[],"Leave.",[
      (change_screen_map),
    ]),
]),

("raid_delphi",mnf_enable_hot_keys|mnf_scale_picture,
  "You assembly your troops. Everybody waits for your orders to attack.^^Keep in mind that raiding a sacred place will anger the local population and lower your relation with nearby factions."
  +"^^Keep also in mind that raiding Delphi will destroy it forever! Unlike other sacred places, Delphi will not be rebuild after raiding.",
  "none",[
    (set_background_mesh, "mesh_pic_charge"),
  ],[
    ("attack", [], "Give order to attack!", [
      (party_clear, "$g_encountered_party"),
      (modify_visitors_at_site, "scn_delphi"),
      (reset_visitors),
      (assign, ":num_priest", 5),
      (store_character_level, ":level", "trp_player"),
      (val_div, ":level", 5),
      (val_max, ":level", 1),
      (val_add, ":num_priest", ":level"),

      (set_visitors, 1, "trp_roman_peasant", ":num_priest"),
      (set_visitors, 1, "trp_roman_peasant", ":num_priest"),
      (set_visitors, 1, "trp_mercenary_swordsman", ":num_priest"),
      (set_jump_mission,"mt_paganholysites_atacado"),
      (jump_to_scene, "scn_delphi"),
      (change_screen_mission),
      (party_clear, "p_total_enemy_casualties"),
      (assign, "$capture_screen_shown", 0),
      (assign, "$loot_screen_shown", 0),
      (troop_get_slot, ":culture", "trp_player", slot_troop_culture),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_center_culture, ":culture"),
        (call_script, "script_add_piety", -50, 1),
      (else_try),
        (call_script, "script_add_piety", -25, 1),
      (try_end),
    ]),
    ("defend", [], "Forget it.", [
      (jump_to_menu, "mnu_paganholysites_visit"),
    ]),
]),

("are_you_sure",mnf_enable_hot_keys|mnf_scale_picture,
  "You assembly your troops. Everybody waits for your orders to attack.^^Keep in mind that raiding a sacred place will anger the local population and lower your relation with nearby factions.",
  "none",[
    (set_background_mesh, "mesh_pic_charge"),
  ],[
    ("attack", [], "Give order to attack!", [
      (party_clear, "$g_encountered_party"),
      (party_get_slot, ":exterior_scene", "$g_encountered_party", slot_castle_exterior),
      (modify_visitors_at_site, ":exterior_scene"),
      (reset_visitors),
      (assign, ":num_priest", 5),
      (store_character_level, ":level", "trp_player"),
      (val_div, ":level", 5),
      (val_max, ":level", 1),
      (val_add, ":num_priest", ":level"),
      (party_get_slot, ":culture", "$g_encountered_party", slot_center_culture),
      (faction_get_slot, ":troop_1", ":culture", slot_faction_tier_5_troop),
      (faction_get_slot, ":troop_2", ":culture", slot_faction_tier_4_troop),
      (faction_get_slot, ":troop_3", ":culture", slot_faction_tier_3_troop),
      (set_visitors, 1, ":troop_1", ":num_priest"),
      (set_visitors, 1, ":troop_2", ":num_priest"),
      (set_visitors, 1, ":troop_3", ":num_priest"),
      (set_jump_mission,"mt_paganholysites_atacado"),
      (jump_to_scene, ":exterior_scene"),
      (change_screen_mission),
      (party_clear, "p_total_enemy_casualties"),
      (assign, "$capture_screen_shown", 0),
      (assign, "$loot_screen_shown", 0),
      (troop_get_slot, ":culture", "trp_player", slot_troop_culture),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_center_culture, ":culture"),
        (call_script, "script_add_piety", -50, 1),
      (else_try),
        (call_script, "script_add_piety", -25, 1),
      (try_end),
    ]),
    ("defend", [], "Forget it.", [
      (jump_to_menu, "mnu_paganholysites_visit"),
    ]),
]),

("town",mnf_enable_hot_keys|mnf_scale_picture,
  "{s10} {s14}^{s11}{s12}{s13}^{s16}^^{s44}^{s43}",
  "none",[
    # initialize strings
    (str_clear, s10),
    (str_clear, s14),
    (str_clear, s11),
    (str_clear, s12),
    (str_clear, s13),
    (str_clear, s16),
    (str_clear, s44),
    (str_clear, s43),
    ##set variables
    (store_encountered_party, "$current_town"),#set variable properly
    (troop_set_slot, "trp_global_variables", start_town_conversation, 0),#this is to store if the conversation was started from the menu or the scene

    (try_begin),
        (this_or_next|is_between, "$current_town", centers_begin, centers_end),
        (is_between, "$current_town", minor_towns_begin, minor_towns_end),
    (else_try),
        (jump_to_menu, "mnu_auto_return_map"),
        (display_log_message, "@A bug occured on town menu", message_negative),
    (try_end),

    (party_get_slot, ":disease", "$current_town", slot_center_disease),
    (try_begin),
        (ge, ":disease", 1),
        (call_script, "script_get_event_details", ":disease"),
        (assign, reg0, 1),
        (try_begin),
            (party_slot_eq, "$current_town", slot_party_type, spt_castle),
            (assign, reg0, 0),
        (try_end),
        (str_store_string, s44, "@The {reg0?town:fortress} is haunted by an outbreak of {s0}."),
    (try_end),
    (party_get_slot, ":event", "$current_town", slot_center_event),
    (try_begin),
        (ge, ":event", 1),
        (call_script, "script_get_event_details", ":event"),
        (assign, reg10, 1),
        (try_begin),
            (party_slot_eq, "$current_town", slot_party_type, spt_castle),
            (assign, reg10, 0),
        (try_end),
        (try_begin),
            (lt, reg1, 0),
            (str_store_string, s44, "@The {reg10?town:fortress} has suffered from a devastating {s0}.^^{s44}"),
        (else_try),
            (str_store_string, s44, "@The {reg10?town:fortress} has been blessed by a {s0}.^^{s44}"),
        (try_end),
    (try_end),

    #moved to the top to prevent bug where s11 is overwritten
    #Who's in the hall? {s16} + Dj_FRedy
    (call_script, "script_whos_in_the_hall", "$current_town"),
    #Who's in the hall? - Dj_FRedy

    ##first do all special events in correct order
    (try_begin),
        (eq, "$current_town", "p_town_6"),
        (check_quest_active, "qst_triumph"),
        (eq, "$g_encountered_party_faction", "$players_kingdom"),
        (call_script, "script_troop_holds_triumph", "trp_player"),
    (else_try), # main story other goy battle of bedriacum
        (eq, "$current_town", "p_town_6"),
        (check_quest_active, "qst_four_emperors"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 12),
        (this_or_next|quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_senator_2"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_statthalter_9"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_timer, -1),
        (jump_to_menu, "mnu_first_battle_of_bedriacum_decide"),
    (else_try), # main story fleet in alexandria
        (eq, "$current_town", "p_town_20"),
        (check_quest_active, "qst_four_emperors"),
        (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 8),
        (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_legatus_11"),
        (jump_to_menu, "mnu_the_fleet_decide"),
    (else_try),
        (eq, "$current_town", "p_town_6"),
        (neq, "$g_is_emperor", 1),
        (neg|check_quest_active, "qst_blank_quest_5"),
        (neg|check_quest_active, "qst_blank_quest_19"),
        (eq, "$g_campaign_type", g_campaign_story_rome),
        (ge,  "$g_do_one_more_meeting_with_merchant", 1), # has done the start up merchant quests
        (jump_to_menu, "mnu_ad_mortem"),
    (else_try),
        (check_quest_active, "qst_wlodowiecus_adventure_3"),
        (quest_slot_eq, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 2),
        (eq, "$current_town", "p_castle_12"),
        (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_start_1"),
    (else_try),
        (eq, "$current_town", "p_town_6"),
        (player_has_item, "itm_holy_grail"),
        (jump_to_menu, "mnu_lose_of_the_gral"),
    (else_try),
        (troop_slot_ge, "trp_player", slot_troop_renown, 200),
        (lt, "$g_is_emperor", 1),
        (neg|troop_slot_eq, "trp_kingdom_7_lord", slot_troop_occupation, dplmc_slto_dead),
        (neg|check_quest_active, "qst_rags_to_riches"),
        (eq, "$current_town", "p_town_28"),
        (quest_slot_eq, "qst_rags_to_riches", slot_quest_current_state, 0),
        (jump_to_menu, "mnu_rags_to_riches_1"),
    (else_try),
        (check_quest_active, "qst_collect_requested_senate"),
        (quest_slot_eq, "qst_collect_requested_senate", slot_quest_target_center, "$current_town"),
        (jump_to_menu, "mnu_recieve_senate"),
    (else_try),
        (check_quest_active, "qst_collect_requested_money"),
        (quest_slot_eq, "qst_collect_requested_money", slot_quest_target_center, "$current_town"),
        (jump_to_menu, "mnu_recieve_money"),
    (else_try),
        (check_quest_active, "qst_collect_requested_influence"),
        (quest_slot_eq, "qst_collect_requested_influence", slot_quest_target_center, "$current_town"),
        (jump_to_menu, "mnu_recieve_influence"),
    (else_try),
        (eq, "$current_town", "p_town_27"),
        (check_quest_active, "qst_wlodowiecus_adventure_1"),
        (this_or_next|quest_slot_eq, "qst_wlodowiecus_adventure_1", slot_quest_current_state, 2),
        (quest_slot_eq, "qst_wlodowiecus_adventure_1", slot_quest_current_state, 3),
        (leave_encounter),
        (jump_to_menu, "mnu_auto_return_map"),
    (else_try),
        (eq, "$current_town", "p_town_27"),
        (check_quest_active, "qst_philosopher"),
        (main_party_has_troop, "trp_solus"),
        (jump_to_menu, "mnu_solus_end"),
    (else_try),##if center is looted/ destroyed
        (party_slot_ge, "$current_town", slot_party_looted_left_days, 1),
        (jump_to_menu, "mnu_center_looted"),
    # (else_try),##event caesar
    #     (eq, "$g_fire", 2),
    #     (eq, "$current_town", "p_town_6"),
    #     (eq, "$sneaked_into_town", 0),#Skip if sneaked
    #     (jump_to_menu, "mnu_assassination"),
    (else_try),##special freelancer event
        (this_or_next|troop_slot_eq, "trp_avaritia", slot_troop_spouse, 2),
        (troop_slot_eq, "trp_avaritia", slot_troop_spouse, 1),
        (eq, "$current_town", "p_town_6"),
        (store_faction_of_party, ":fac", "$current_town"),
        (eq, ":fac", "$players_kingdom"),
        (eq, "$g_civil_war", -1),
        (eq, "$g_is_emperor", 1),
        (troop_slot_eq, "trp_global_variables", g_lord_event_possible, 0),
        (troop_set_slot, "trp_global_variables", g_lord_event_possible, 1), #possible each 90 hours. Only possible once when player enter to town, no while move around menus.
        (eq, "$sneaked_into_town", 0),#Skip if sneaked
        (jump_to_menu, "mnu_emperor_event_superbus"),
    (else_try),##start event, begger
        (eq, "$g_campaign_type", g_campaign_story_rome),
        (neg|troop_slot_ge, "trp_player", slot_troop_renown, 250),
        (party_slot_eq, "$current_town", slot_town_lord, "trp_kingdom_7_lord"),
        (neg|check_quest_active, "qst_collect_men"),
        (quest_slot_eq, "qst_collect_men", slot_quest_target_dna, 0),
        (eq, "$current_town", "p_town_6"),
        (eq, "$sneaked_into_town", 0),#Skip if sneaked
        (jump_to_menu, "mnu_cutscene_1"),
        (quest_set_slot, "qst_collect_men", slot_quest_target_dna, 1),
    (else_try),##start event about fire of Rome
        (neq, "$g_fire", 0),#fire has started
        (eq, "$current_town", "p_town_6"),
        (eq, "$sneaked_into_town", 0),
        (faction_slot_eq, "$players_kingdom", slot_faction_culture, "fac_culture_7"),
        (troop_slot_eq, "trp_global_variables", g_fire_talk_girl, 0),
        (troop_slot_ge, "trp_muscullus", slot_troop_met, 1),
        (jump_to_menu, "mnu_girl_fire_talk"),
    (else_try),##for minor factions
        (is_between, "$g_encountered_party", minor_towns_begin, minor_towns_end),
        (jump_to_menu, "mnu_desert_town"),
    (else_try),###new quest
        (check_quest_active, "qst_elusive_bandits"),
        (quest_slot_eq, "qst_elusive_bandits", slot_quest_target_center, "$current_town"),
        #
        (quest_get_slot,":gold", "qst_elusive_bandits", slot_quest_target_troop),
        (quest_get_slot,":state", "qst_elusive_bandits", slot_quest_current_state),
        (lt, ":gold", 5),
        (eq, ":gold", ":state"),
        (val_add, ":gold", 1),
        (quest_set_slot, "qst_elusive_bandits", slot_quest_target_troop, ":gold"),
        (eq, "$sneaked_into_town", 0),#Skip if sneaked
        (jump_to_menu, "mnu_pick_up_gold"),
    (else_try),###if christians are killed
        (ge, "$g_encountered_party_relation", 0),
        (party_slot_eq, "$current_town", slot_center_pursue, 1),
        (jump_to_menu, "mnu_persecution"),
    (else_try),#entry controls
        (ge, "$g_encountered_party_relation", 0),
        (party_slot_eq, "$current_town", slot_center_decree_control, 1),
        (neg|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
        (neg|troop_slot_eq, "trp_global_variables", g_controlled, 1),
        (jump_to_menu, "mnu_control"),
        (troop_set_slot, "trp_global_variables", g_controlled, 1),
    (try_end),

    ### all special events end, now come more generic repetative evens:
    ##emperor events
    (party_get_slot, ":lord", "$current_town", slot_town_lord),
    (try_begin),###events for tournaments = games
        (eq, "$g_encountered_party_faction", "$players_kingdom"),
        (eq, "$g_is_emperor", 1),
        (eq, "$sneaked_into_town", 0),#Skip if sneaked
        (party_slot_eq, "$current_town", slot_center_is_besieged_by, -1),
        (party_slot_ge, "$current_town", slot_town_has_tournament, 1),
        (neg|is_currently_night),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
        (store_random_in_range, ":random", 0, 13),
        (le, ":random", 3),
        (troop_slot_eq, "trp_global_variables", g_lord_event_possible, 0),
        (troop_set_slot, "trp_global_variables", g_lord_event_possible, 1), #possible each 90 hours. Only possible once when player enter to town, no while move around menus.
        (try_begin),
            (eq, ":lord", "trp_player"),
            (jump_to_menu, "mnu_event_1_games"),
        (else_try),
            (neq, ":lord", "trp_player"),
            (jump_to_menu, "mnu_event_2_games"),
        (try_end),
    (try_end),

    (try_begin),##governor/lord events
        (eq, ":lord", "trp_player"),
        (store_current_day, ":day"),
        (ge, ":day", 10), # 10 days have passed
        ####random events when player is lord - juices chief, riots, etc...
        (neg|is_currently_night),
        (try_begin),
            (eq, "$g_defending_against_siege", 0),#Skip if the center is under siege (because of resting)
            (party_slot_eq, "$current_town", slot_center_is_besieged_by, -1),
            (store_party_size_wo_prisoners, ":num_men", "p_main_party"),
            (gt, ":num_men", 15), #20 men necesary for events.
            (troop_slot_eq, "trp_global_variables", g_lord_event_possible, 0),
            (troop_set_slot, "trp_global_variables", g_lord_event_possible, 1), #possible each 90 hours. Only possible once when player enter to town, no while move around menus.
            # (store_random_in_range, ":ratio_event", 0, 100),
            # (le, ":ratio_event", 47), #31%#was 25 before
            (eq, "$sneaked_into_town", 0),#Skip if sneaked
				    (try_begin),
                (eq, "$event_oneuse", 0),
                (assign, ":event_juice", "mnu_event_01_juicio"),
                (val_add, "$event_oneuse", 1),
				    (else_try),
                (eq, "$event_oneuse", 1),
                (assign, ":event_juice", "mnu_event_02_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 2),
                (assign, ":event_juice", "mnu_event_03_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 3),
                (assign, ":event_juice", "mnu_event_04_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 4),
                #(assign, ":event_juice", "mnu_event_05_juicio"),
                (assign, ":event_juice", "mnu_event_24_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 5),
                (assign, ":event_juice", "mnu_event_06_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 6),
                (assign, ":event_juice", "mnu_event_07_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 7),
                (assign, ":event_juice", "mnu_event_08_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 8),
                (assign, ":event_juice", "mnu_event_09_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 9),
                (assign, ":event_juice", "mnu_event_10_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 10),
                (assign, ":event_juice", "mnu_event_11_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 11),
                (assign, ":event_juice", "mnu_event_12_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 12),
                (assign, ":event_juice", "mnu_event_13_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 13),
                (assign, ":event_juice", "mnu_event_14_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 14),
                (assign, ":event_juice", "mnu_event_15_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 15),
                (assign, ":event_juice", "mnu_event_16_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 16),
                # (assign, ":event_juice", "mnu_event_17_juicio"),
                (assign, ":event_juice", "mnu_event_25_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 17),
                (assign, ":event_juice", "mnu_event_18_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 18),
                (assign, ":event_juice", "mnu_event_19_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 19),
                (assign, ":event_juice", "mnu_event_20_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 20),
                (assign, ":event_juice", "mnu_event_21_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 21),
                (assign, ":event_juice", "mnu_event_22_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 22),
                (assign, ":event_juice", "mnu_event_20_1_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 23),
                (assign, ":event_juice", "mnu_event_23_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 24),
                #(assign, ":event_juice", "mnu_event_24_juicio"),
                (assign, ":event_juice", "mnu_event_05_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 25),
                # (assign, ":event_juice", "mnu_event_25_juicio"),
                (assign, ":event_juice", "mnu_event_17_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 26),
                (assign, ":event_juice", "mnu_event_26_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 27),
                (assign, ":event_juice", "mnu_event_27_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 28),
                (assign, ":event_juice", "mnu_event_28_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 29),
                (assign, ":event_juice", "mnu_event_29_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                (eq, "$event_oneuse", 30),
                (assign, ":event_juice", "mnu_event_30_juicio"),
                (val_add, "$event_oneuse", 1),
            (else_try),
                #(ge, "$event_oneuse", 21),
                (store_random_in_range, ":event_juice", "mnu_event_01_juicio", "mnu_event_juicio_end"),
				    (try_end),
				    (jump_to_menu, ":event_juice"),
			  (try_end),

        ##if player is lord and people hate him
        (party_get_slot, ":center_relation", "$current_town", slot_center_player_relation),
        (try_begin),
            # (gt, ":num_men", 40), #40 men necesary for events.
            (lt, ":center_relation", -30), #negative relations = possible riots
            (troop_slot_eq, "trp_global_variables", g_lord_event_possible, 0),

            (store_random_in_range, ":ratio_event", 0, 100),
            (try_begin),
                (lt, ":ratio_event", 5), #5%, people fear fight againts his lord, break laws
                (jump_to_menu, "mnu_riots_01"),
                (troop_set_slot, "trp_global_variables", g_lord_event_possible, 1), #possible each 90 hours
            (else_try),
                (lt, ":ratio_event", 15), #7%, people fear fight againts his lord, break laws
                (jump_to_menu, "mnu_riots_02"),
                (troop_set_slot, "trp_global_variables", g_lord_event_possible, 1), #possible each 90 hours
            (else_try),
                (display_message,"@People aren't very happy with your presence in their home."),
            (try_end),
			  (try_end),
		(try_end),

    (try_begin),#set music
        (gt, "$sneaked_into_town", disguise_none),
        (call_script, "script_music_set_situation_with_culture", mtf_sit_town_infiltrate),
    (else_try),
        (call_script, "script_music_set_situation_with_culture", mtf_sit_travel),
    (try_end),

    #notes
    (call_script, "script_update_center_recon_notes", "$current_town"),
    #if siege
    (assign, "$g_defending_against_siege", 0),
    (str_clear, s3),
    (party_get_battle_opponent, ":besieger_party", "$current_town"),
    (store_faction_of_party, ":encountered_faction", "$g_encountered_party"),
    (store_relation, ":faction_relation", ":encountered_faction", "fac_player_supporters_faction"),
    (try_begin),
        (gt, ":besieger_party", 0),
        (ge, ":faction_relation", 0),
        (store_faction_of_party, ":besieger_party_faction", ":besieger_party"),

        (store_relation, ":besieger_party_relation", ":besieger_party_faction", "fac_player_supporters_faction"),
        (lt, ":besieger_party_relation", 0),

        (assign, "$g_defending_against_siege", 1),
        (assign, "$g_siege_first_encounter", 1),
        (jump_to_menu, "mnu_siege_started_defender"),
    (try_end),

    #Quest menus for tax quest
    (assign, "$qst_collect_taxes_currently_collecting", 0),
    (try_begin),
        (gt, "$quest_auto_menu", 0),
        (jump_to_menu, "$quest_auto_menu"),
        (assign, "$quest_auto_menu", 0),
    (try_end),

    (try_begin),
        (eq, "$g_town_assess_trade_goods_after_rest", "$current_town"), #SB : loop fix
        (assign, "$g_town_assess_trade_goods_after_rest", 0),
        (jump_to_menu,"mnu_town_trade_assessment"),
    (try_end),

    (assign, "$talk_context", 0),
    (assign,"$all_doors_locked",0),

    (try_begin),
        (eq, "$g_town_visit_after_rest", 1),
        (assign, "$g_town_visit_after_rest", 0),
        (assign, "$town_entered", 1),
    (try_end),

    (try_begin),
        (eq,"$g_leave_town",1),
        (assign,"$g_leave_town",0),
        (assign,"$g_permitted_to_center",0),
        #SB : handle disguise removal here or in trigger
        (leave_encounter),
        (change_screen_return),
    (try_end),

    (str_store_party_name, s2, "$current_town"),
    (party_get_slot, ":center_lord", "$current_town", slot_town_lord),
    # (assign, reg19, ":center_lord"),
    # (display_message, "@{reg19}"),
    (store_faction_of_party, ":center_faction", "$current_town"),
    (str_store_faction_name, s9, ":center_faction"),
    (try_begin),
        (ge, ":center_lord", 0),
        (str_store_troop_name,s8,":center_lord"),
        (str_store_string,s7,"@{s8} of {s9}"),
    (try_end),

    (try_begin),
        (party_slot_eq,"$current_town",slot_party_type, spt_town),
        (str_store_string, s60, s2),
        (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
        (try_begin),
            (ge, "$cheat_mode", 1),
            (assign, reg4, ":prosperity",),
            (display_message, "@{!}DEBUG -- Prosperity: {reg4}"),
        (try_end),
        #          (val_add, ":prosperity", 5),
        (store_div, ":str_id", ":prosperity", 10),
        (val_min, ":str_id", 9),
        (val_add, ":str_id", "str_town_prosperity_0"),
        (str_store_string, s10, ":str_id"),

        (store_div, ":str_id", ":prosperity", 20),
        (val_min, ":str_id", 4),
        (val_add, ":str_id", "str_town_alt_prosperity_0"),

        (str_store_string, s14, ":str_id"),
    (else_try),
        (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
        (str_store_string, s60, s2),
        (str_clear, s14),
        (store_div, ":str_id", ":prosperity", 10),
        (val_min, ":str_id", 9),
        (val_add, ":str_id", "str_fort_prosperity_0"),
        (str_store_string, s10, ":str_id"),
    (try_end),

    #special text for londinium
    (try_begin),
        (eq, "$current_town", "p_castle_23"),
        (str_store_string,s10,"@{s10}^^Inhabitants of the fortress say the Britannic prince Nennius is buried near one of the gates. Accompanying him in his coffin, is the Crocea Mors, the gladius of Julius Caesar.^^"),
    (else_try),
        (eq, "$current_town", "p_castle_63"),
        (str_store_string,s10,"@{s10}^^The legend goes that Thesues defeated the great Minotaur in the labyrinth near Cnossus. But beware! The local elders speak of a creature that inhabits this labyrinth. Should you visit the place, be well-armed and careful!^^"),
    (try_end),

    ##diplomacy start+
    (assign, ":save_reg0", reg0),#save variables
    (assign, ":save_reg4", reg4),
    (assign, reg0, 0),
    (assign, reg4, 0),
    (try_begin),#If there's a relation of some kind, write it to s11 (which we'll overwrite below)
        (lt, ":center_lord", 1),
    (else_try),
        #your relative
        (call_script, "script_troop_get_family_relation_to_troop", ":center_lord", "trp_player"),#outputs to s11, reg0, and reg4
        (ge, reg0, 1),#Fall through if this not a relative
    (else_try),
        #your current liege
        (eq, ":center_faction", "$players_kingdom"),
        (is_between, ":center_faction", kingdoms_begin, kingdoms_end),#include fac_player_supporters_faction for claimant quest
        (faction_slot_eq, ":center_faction", slot_faction_leader, ":center_lord"),
        (str_store_string, s11, "@liege"),
        (assign, reg0, 1),
    (else_try),
        #your former liege if you renounced a kingdom
        (eq, ":center_faction", "$players_oath_renounced_against_kingdom"),
        (is_between, ":center_faction", npc_kingdoms_begin, npc_kingdoms_end),
        (faction_slot_eq, ":center_faction", slot_faction_leader, ":center_lord"),
        (str_store_string, s11, "@former liege"),
        (assign, reg0, 1),
    (else_try),
        #stop here for lords you haven't met, or non-hero troops
        (this_or_next|neg|troop_is_hero, ":center_lord"),
        (troop_slot_eq, ":center_lord", slot_troop_met, 0),
    (else_try),
        #check for affiliates
        (call_script, "script_dplmc_is_affiliated_family_member", ":center_lord"),
        (ge, reg0, 1),
        (try_begin),
            (ge, "$g_encountered_party_relation", 0),#don't say "ally" when you might fight them, as that's confusing
            (str_store_string, s11, "str_dplmc_ally"),
        (else_try),
            (str_store_string, s11, "@affiliate"),
        (try_end),
    (else_try),
        #check for former companions
        (call_script, "script_troop_get_player_relation", ":center_lord"),
        (is_between, ":center_lord", companions_begin, companions_end),
        (neg|troop_slot_eq, ":center_lord", slot_troop_playerparty_history, dplmc_pp_history_nonplayer_entry),
        (try_begin),
            (ge, "$g_encountered_party_relation", 0),#don't say "ally" when you might fight them, as that's confusing
            (ge, reg0, 50),
            (str_store_string, s11, "str_dplmc_ally"),
        (else_try),
            (ge, "$g_encountered_party_relation", 0),
            (ge, reg0, 20),
            (str_store_string, s11, "str_dplmc_friend"),
        (else_try),
            (str_store_string, s11, "@former companion"),
        (try_end),
        (assign, reg0, 1),
    (else_try),
        #don't print "friend" if you might fight them
        (lt, "$g_encountered_party_relation", 0),
        (assign, reg0, 0),
    (else_try),
        #check for friends
        (val_div, reg0, 50),#right now reg0 holds the relation with the player
        (ge, reg0, 1),
        (str_store_string, s11, "str_dplmc_friend"),
    (else_try),
        #check for marshall
        (eq, ":center_faction", "$players_kingdom"),
        (faction_slot_eq, ":center_faction", slot_faction_marshall, ":center_lord"),
        (str_store_string, s11, "@marshall"),
    (else_try),
        #check for vassal of player if nothing else to say
        (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", ":center_faction"),
        (val_add, reg0, 1),
        (val_sub, reg0, DPLMC_FACTION_STANDING_LEADER_SPOUSE),
        (ge, reg0, 1),
        (str_store_string, s11, "@vassal"),
    (else_try),
        (assign, reg0, 0),
    (try_end),
    ##diplomacy end+
    (try_begin),
        (party_slot_eq,"$current_town",slot_party_type, spt_castle),
        (try_begin),
            (eq, ":center_lord", "trp_player"),
            (str_store_string,s11,"@ This fortress belongs to you."),
        (else_try),
            (ge, reg0, 1),
            (str_store_string, s11, "@ You remember that this fortress belongs to {s11} {s7}."),
        (else_try),
            (gt, ":center_lord", -1),
            (troop_slot_eq, ":center_lord", slot_troop_spouse, "trp_player"),
            (str_store_string,s11,"str__you_see_the_banner_of_your_wifehusband_s7_over_the_castle_gate"),
        (else_try),
            (ge, ":center_lord", 0),
            (str_store_string,s11,"@ You remember that this fortress belongs to {s7}."),
        (else_try),
            (str_store_string,s11,"@ This fortress has no garrison."),
        (try_end),
    (else_try),
        (try_begin),
            (eq, ":center_lord", "trp_player"),
            (str_store_string,s11,"@ This town belongs to you."),
        (else_try),
            (ge, reg0, 1),
            (str_store_string, s11, "@ You know that this place belongs to your {s11} {s7}."),
        (else_try),
            (gt, ":center_lord", -1),
            (troop_slot_eq, ":center_lord", slot_troop_spouse, "trp_player"),
            (str_store_string,s11,"str__the_banner_of_your_wifehusband_s7_flies_over_the_town_gates"),
        (else_try),
            (ge, ":center_lord", 0),
            (str_store_string,s11,"@ You remember that this town belongs to {s7}."),
        (else_try),
            (str_store_string,s11,"@ This town has no garrison."),
        (try_end),
    (try_end),
    (assign, reg0, ":save_reg0"),#revert variables
    (assign, reg4, ":save_reg4"),

    (str_clear, s12),
    (try_begin),
        (party_slot_eq,"$current_town",slot_party_type, spt_town),
        (party_get_slot, ":center_relation", "$current_town", slot_center_player_relation),
        (call_script, "script_describe_center_relation_to_s3", ":center_relation"),
        (assign, reg9, ":center_relation"),
        (str_store_string, s12, "@{!} {s3} ({reg9})."),
    (try_end),

    (str_clear, s13),
    (try_begin),
        (gt,"$entry_to_town_forbidden",0),
        (str_store_string, s13, "@ You have successfully sneaked in."),
    (else_try),
        (faction_slot_eq, ":center_faction", slot_faction_ai_state, sfai_feast),
        (faction_slot_eq, ":center_faction", slot_faction_ai_object, "$current_town"),

        (str_store_string, s13, "str__the_lord_is_currently_holding_a_feast_in_his_hall"),
    (else_try), #SB : we use this incidental information to reflect on the player's residence/court
        (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
        (try_begin),
            (lt, ":player_spouse", 0), #to make registers work
            (assign, ":player_spouse", 0),
        (else_try),
            (this_or_next|neg|troop_slot_eq, ":player_spouse", slot_troop_occupation, slto_kingdom_lady),
            (neg|troop_slot_eq, ":player_spouse", slot_troop_cur_center, "$current_town"),
            (assign, ":player_spouse", 0),
        (try_end),
        (try_begin),
            (eq, "$g_player_court", "$current_town"),
            (assign, reg0, ":player_spouse"),
            (store_and, reg1, "$players_kingdom_name_set", rename_center), #check if it's "court" or "capital"
            (str_store_troop_name, s0, ":player_spouse"),
            (str_store_string, s13, "@ Your {reg1?capital is:court can be found} here{reg0? with your spouse, {s0} in residence:}."),
        (else_try),
            (neq, "$g_player_court", "$current_town"),
            (gt, ":player_spouse", 0),
            (str_store_string, s13, "@ Your household can be found here."),
        (try_end),
    (try_end),
    #forbidden to enter?
    (try_begin),
        (store_time_of_day,reg(12)),
        (ge,reg(12),5),
        (lt,reg(12),21),
        (assign,"$town_nighttime",0),
    (else_try),
        (assign,"$town_nighttime",1),
        (party_slot_eq,"$current_town",slot_party_type, spt_town),
        (str_store_string, s13, "str_town_nighttime"),
    (try_end),

    (try_begin),
        (party_slot_ge, "$current_town", slot_town_has_tournament, 1),
        (neg|is_currently_night),
        (party_set_slot, "$current_town", slot_town_has_tournament, 1),
        (str_store_string, s13, "@{s13} A great game will be held here soon."),
    (try_end),

    (assign,"$castle_undefended",0),
    (party_get_num_companions, ":castle_garrison_size", "p_collective_enemy"),
    (try_begin),
        (eq,":castle_garrison_size",0),
        (assign,"$castle_undefended",1),
    (try_end),

    (call_script, "script_set_town_picture"),
    (try_begin),
        (gt, ":center_lord", 1),
        (set_fixed_point_multiplier,100),
        (position_set_x,pos0,65),			#left/right movement ( 0 = left edge of screen)
        (position_set_y,pos0,3),			#up/down movement ( 0 = bottom edge of screen)
        (position_set_z,pos0,80),			#in/out movement  (0 = no image, higher #'s make it larger)
        (set_game_menu_tableau_mesh,"tableau_troop_note_mesh",":center_lord",pos0),
    (try_end),
    #		(str_clear, s5), #alert player that there are new rumors
    #		(try_begin),
    #			(eq, 1, 0),
    #			(neg|is_currently_night),
    #			(str_store_string, s5, "@^The buzz of excited voices as you come near the gate suggests to you that news of some import is circulating among the townsfolk."),
    #			(lt, "$last_town_log_entry_checked", "$num_log_entries"),
    #			(assign, "$g_town_rumor_log_entry", 0),
    #			(try_for_range, ":log_entry", "$last_town_log_entry_checked", "$num_log_entries"),
    #				(eq, ":log_entry", 4123), #placeholder to avoid having unused variable error message
    #			(try_end),
    #			(assign, "$last_town_log_entry_checked", "$num_log_entries"),
    #		(try_end),
    (try_begin),
        (neg|check_quest_active, "qst_usurp_province"),
        (troop_slot_eq, "trp_player", slot_troop_govern, "trp_player", -1),
        (troop_slot_eq, "trp_player", slot_troop_aux, "trp_player", -1),
        (troop_slot_eq, "trp_player", slot_troop_legion, "trp_player", -1),
        (neg|party_slot_ge, "$current_town", slot_party_time_service, 1),
        (neg|party_slot_eq, "$current_town", slot_center_pursue, 1),
        (neg|party_slot_ge, "$current_town", slot_party_looted_left_days, 1),
        (neg|is_between, "$g_encountered_party", minor_towns_begin, minor_towns_end),
        (party_slot_eq, "$current_town", slot_party_type, spt_town),
        (eq, "$g_is_emperor",0),
        (party_get_slot, ":center_relation", "$current_town", slot_center_player_relation),
        (ge, ":center_relation", 25),##maybe increase it even more?
        (troop_slot_ge, "trp_player", slot_troop_renown, 300),
        (store_faction_of_party, ":fac", "$current_town"),
        (eq, ":fac", "$players_kingdom"),
        (eq, "$players_kingdom", "fac_kingdom_7"),
        (neg|faction_slot_eq, ":fac", slot_faction_leader, "trp_player"),
        (faction_get_slot, ":leader", ":fac", slot_faction_leader),
        (neq, ":leader", ":lord"),
        (ge, "$g_encountered_party_relation", 0),
        (ge, ":lord", 1),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_selfrighteous),
        #(this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_cunning),
        (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
        (try_begin),
            (party_get_slot, ":province", "$current_town", slot_center_province),
            (store_add, ":slot", slot_province_senatorial_begin, ":province"),
            (troop_slot_ge, "trp_province_array", ":slot", 1),
          ##this are all senatorial provinces
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_hisp_baetica),
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_afrc_afrc),
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_afrc_cyre),
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_asia_minor),
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_balk_mac),
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_balk_epir),
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_balk_acha),
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_ita_sici),
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_ita_magna),
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_ita_ital),
            # (this_or_next|party_slot_eq, "$current_town", slot_center_province, p_ita_cis),
            # (party_slot_eq, "$current_town", slot_center_province, p_gaul_narab),
            (jump_to_menu, "mnu_ask_for_help_senate"),
        (else_try),
            (jump_to_menu, "mnu_ask_for_help"),
        (try_end),
    (try_end),
    (try_begin),
        (eq, "$current_town", "p_town_6"),
        (troop_get_slot, reg39, "trp_senator_dummy", slot_senate_next_meeting),
        (str_clear, s51),
        (try_begin),
            (eq, reg39, 0),
            (str_store_string, s43,"@There is a senate meeting processing."),
        (else_try),
            (ge, reg39, 1),
            (str_store_string, s43,"@The next senate meeting will be in {reg39} days."),
        (else_try),
            (str_store_string, s43,"@It is unknown when the next senate meeting will be hold."),
        (try_end),
    (try_end),
    (try_begin),
        (party_get_slot, ":statue_time", "$current_town", slot_center_statues),
        (ge, ":statue_time", 1),
        (party_get_slot, ":statue_days", "$current_town", slot_center_statues_days),
        (store_current_hours, ":current_hours"),
        (val_mul, ":statue_days", 24),###
        (val_add, ":statue_time", ":statue_days"),
        (store_sub, reg0, ":statue_time", ":current_hours"),
        (val_div, reg0, 24),
        #(val_sub, ":current_hours", ":statue_time"),
        #(party_get_slot, ":statue_time", "$current_town", slot_center_statues),
        (try_begin),
            (le, reg0, 0),
            (jump_to_menu, "mnu_statue_finished"),
        (else_try),
            (str_store_string, s43, "@{s43}^Statues finished in {reg0} days"),
        (try_end),
    (try_end),
  ],[
    ("castle_castle",[
      (party_slot_eq,"$current_town",slot_party_type, spt_castle),

      (eq, "$sneaked_into_town", disguise_none),

      (str_clear, s1),
      (try_begin),
          (store_faction_of_party, ":center_faction", "$current_town"),
          (faction_slot_eq, ":center_faction", slot_faction_ai_state, sfai_feast),
          (faction_slot_eq, ":center_faction", slot_faction_ai_object, "$current_town"),
          (str_store_string, s1, "str__join_the_feast"),
      (try_end),
      #SB : some gender string tweaks
      (try_begin),
          (party_get_slot, ":town_lord", "$current_town", slot_town_lord),
          (lt, ":town_lord", 0),
          (assign, reg4, 0), #default to lord
      (else_try),
          (call_script, "script_dplmc_store_troop_is_female_reg", ":town_lord", 4),
      (try_end),

      (try_begin),
          (this_or_next|faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_5"),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_6"),
          (faction_get_slot, ":leader", "$g_encountered_party_faction", slot_faction_leader),
          (party_slot_eq, "$g_encountered_party", slot_town_lord, ":leader"),
          (str_store_string, s32, "@hall of the Shah"),
      (else_try),
          (this_or_next|faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_5"),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_6"),
          (str_store_string, s32, "@hall of the satrape"),
      (else_try),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_7"),
          (str_store_string, s32, "@praetorium"),
      (else_try),
          (str_store_string, s32, "@great hall"),
      (try_end),
    ],"Go to the {s32}{s1}.",[
      (try_begin),
          (this_or_next|eq, "$all_doors_locked", 1),
          (gt, "$sneaked_into_town", disguise_none),
          (display_message,"str_door_locked",message_locked),
      (else_try),
          (check_quest_active, "qst_player_treason"),
          (quest_get_slot, ":giver", "qst_player_treason", slot_quest_giver_troop),
          (party_slot_eq, "$current_town", slot_town_lord, ":giver"),
          (jump_to_menu, "mnu_cannot_enter_court_treason"),
      (else_try),
          (this_or_next|key_is_down, key_left_shift),
          (key_is_down, key_right_shift),
          (start_presentation, "prsnt_ask_audience"),
      (else_try),
          (this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
          (neg|troop_slot_ge, "trp_player", slot_troop_renown, 50),
          (neg|troop_slot_ge, "trp_player", slot_troop_renown, 125),
          (neq, "$g_player_eligible_feast_center_no", "$current_town"),

          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_state, sfai_feast),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_object, "$g_encountered_party"),

          (neg|check_quest_active, "qst_wed_betrothed"),
          (neg|check_quest_active, "qst_wed_betrothed_female"),

          (neg|troop_slot_ge, "trp_player", slot_troop_spouse, active_npcs_begin), #Married players always make the cut

          (jump_to_menu, "mnu_cannot_enter_court"),
      (else_try),
          (this_or_next|troop_slot_ge, "trp_player", slot_troop_renown, 200),
          (eq, "$players_kingdom", "$g_encountered_party_faction"),
          (assign, "$town_entered", 1),
          (call_script, "script_enter_court", "$current_town", -1),
      (else_try),
          (display_message,"@You need more renown or to ask the guard.",0xFFFFAAAA),
      (try_end),
    ], "Enter the Hall."),

    ("join_tournament", [
      (neg|is_currently_night),
      (party_slot_ge, "$current_town", slot_town_has_tournament, 1),
      (eq,"$entry_to_town_forbidden",0), #SB : can't participate while disguised
    ],"Join the Game.",[
      (call_script, "script_fill_tournament_participants_troop", "$current_town", 1),
      (assign, "$g_tournament_cur_tier", 0),
      (assign, "$g_tournament_player_team_won", -1),
      (assign, "$g_tournament_bet_placed", 0),
      (assign, "$g_tournament_bet_win_amount", 0),
      (assign, "$g_tournament_last_bet_tier", -1),
      (assign, "$g_tournament_next_num_teams", 0),
      (assign, "$g_tournament_next_team_size", 0),
      (try_begin),
      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
      (jump_to_menu, "mnu_decide_game"),
      (else_try),
      (jump_to_menu, "mnu_town_tournament"),
      (try_end),
    ]),
    ("town_castle",[
      (party_slot_eq,"$current_town",slot_party_type, spt_town),
      (eq,"$entry_to_town_forbidden",0),
      (str_clear, s1),
      (try_begin),
          (store_faction_of_party, ":center_faction", "$current_town"),
          (faction_slot_eq, ":center_faction", slot_faction_ai_state, sfai_feast),
          (faction_slot_eq, ":center_faction", slot_faction_ai_object, "$current_town"),
          (str_store_string, s1, "str__join_the_feast"),
      (try_end),
      (try_begin),
          (eq, "$g_encountered_party", "p_town_6"),
          (check_quest_active, "qst_nero_special_quest"),
          (quest_slot_eq, "qst_nero_special_quest", slot_quest_target_dna, 0),
          (str_store_string, s32, "@gardens of Maecenas"),
      (else_try),
          (eq, "$g_encountered_party", "p_town_6"),
          (str_store_string, s32, "@Atrium Augusti"),
      (else_try),
          (this_or_next|faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_5"),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_6"),
          (faction_get_slot, ":leader", "$g_encountered_party_faction", slot_faction_leader),
          (party_slot_eq, "$g_encountered_party", slot_town_lord, ":leader"),
          (str_store_string, s32, "@palace of the Shah"),
      (else_try),
          (this_or_next|faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_5"),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_6"),
          (str_store_string, s32, "@palace of the satrape"),
      (else_try),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_7"),
          (str_store_string, s32, "@palace of the governor"),
      (else_try),
          (str_store_string, s32, "@great hall"),
      (try_end),
    ],"Go to the {s32}{s1}.",[
      (try_begin),
          (this_or_next|eq, "$all_doors_locked", 1),
          (gt, "$sneaked_into_town", disguise_none),
          (display_message,"str_door_locked",message_locked),
      (else_try),
          (eq, "$g_encountered_party", "p_town_6"),
          (check_quest_active, "qst_nero_special_quest"),
          (quest_slot_eq, "qst_nero_special_quest", slot_quest_target_dna, 0),
          (try_begin),
              (is_currently_night),
              (jump_to_menu, "mnu_gardens_of_maecenas_1"),
          (else_try),
              (display_message, "@Wait until night falls!", message_alert),
              (display_message, "@Wait until night falls!", message_alert),
              (display_message, "@Wait until night falls!", message_alert),
              (display_message, "@Wait until night falls!", message_alert),
          (try_end),
      (else_try),
          (check_quest_active, "qst_player_treason"),
          (quest_get_slot, ":giver", "qst_player_treason", slot_quest_giver_troop),
          (party_slot_eq, "$current_town", slot_town_lord, ":giver"),
          (jump_to_menu, "mnu_cannot_enter_court_treason"),
      (else_try),
          (this_or_next|key_is_down, key_left_shift),
          (key_is_down, key_right_shift),
          (start_presentation, "prsnt_ask_audience"),
      (else_try),
          (this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
          (neg|troop_slot_ge, "trp_player", slot_troop_renown, 50),
          (neg|troop_slot_ge, "trp_player", slot_troop_renown, 125),
          (neq, "$g_player_eligible_feast_center_no", "$current_town"),

          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_state, sfai_feast),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_object, "$g_encountered_party"),

          (neg|check_quest_active, "qst_wed_betrothed"),
          (neg|check_quest_active, "qst_wed_betrothed_female"),

          (neg|troop_slot_ge, "trp_player", slot_troop_spouse, active_npcs_begin), #Married players always make the cut

          (jump_to_menu, "mnu_cannot_enter_court"),
      (else_try),
          (eq, "$g_is_emperor", 1),
          (eq, "$players_kingdom", "$g_encountered_party_faction"),
          (assign, "$temp4_1", 0),
          (call_script, "script_cf_conspiracy_check"),
      (else_try),
          (this_or_next|troop_slot_ge, "trp_player", slot_troop_renown, 200),
          (eq, "$players_kingdom", "$g_encountered_party_faction"),
          (assign, "$town_entered", 1),
          (try_begin),
              (eq, "$current_town", "p_town_6"),
              (troop_slot_eq, "trp_global_variables", g_nero_intro, 0),
              (neq, "$g_is_emperor", 1),
              (neg|faction_slot_eq, "$players_kingdom", slot_faction_leader, "trp_player"),
              (jump_to_menu, "mnu_intro_to_court"),
          (else_try),
              ##new quest with Nero
              (eq, "$current_town", "p_town_6"),
              (check_quest_active, "qst_nero_special_quest"),
              (quest_slot_eq, "qst_nero_special_quest", slot_quest_target_dna, 3),
              (quest_slot_eq, "qst_nero_special_quest", slot_quest_current_state, 0),
              (jump_to_menu, "mnu_nero_performance"),
          (else_try),
              (eq, "$current_town", "p_town_6"),
              (check_quest_active, "qst_nero_special_quest"),
              (quest_slot_eq, "qst_nero_special_quest", slot_quest_target_dna, 4),
              (quest_slot_eq, "qst_nero_special_quest", slot_quest_current_state, 0),
              (jump_to_menu, "mnu_tiggelinius_event_1"),
          (else_try),
              (eq, "$current_town", "p_town_6"),
              (check_quest_active, "qst_nero_special_quest"),
              (quest_slot_eq, "qst_nero_special_quest", slot_quest_target_dna, 6),
              (quest_slot_eq, "qst_nero_special_quest", slot_quest_current_state, 0),
              (jump_to_menu, "mnu_claudia_event"),
          (else_try),
              (eq, "$current_town", "p_town_6"),
              (eq, "$players_kingdom", "fac_kingdom_7"),
              (neg|troop_slot_eq, "trp_kingdom_7_lady_1", slot_troop_spouse, "trp_player"),
              (troop_slot_eq, "trp_kingdom_7_lord", slot_troop_occupation, slto_kingdom_hero),#Nero still alive
              (troop_slot_eq, "trp_global_variables", g_poppaea_event_chain, 0),
              (troop_slot_ge, "trp_kingdom_7_lady_1", slot_troop_met, 1),
              (troop_slot_ge, "trp_kingdom_7_lady_1", slot_troop_player_relation, 15),
              (troop_slot_ge, "trp_player", slot_troop_renown, 300),
              (jump_to_menu, "mnu_poppaea_event_chain_1"),
          (else_try),
              (eq, "$current_town", "p_town_6"),
              (eq, "$players_kingdom", "fac_kingdom_7"),
              (neg|troop_slot_eq, "trp_kingdom_7_lady_1", slot_troop_spouse, "trp_player"),
              (troop_slot_eq, "trp_kingdom_7_lord", slot_troop_occupation, slto_kingdom_hero),#Nero still alive
              (troop_slot_eq, "trp_global_variables", g_poppaea_event_chain, 2),
              (troop_slot_ge, "trp_kingdom_7_lady_1", slot_troop_met, 1),
              (troop_slot_ge, "trp_kingdom_7_lady_1", slot_troop_player_relation, 30),
              (troop_slot_ge, "trp_player", slot_troop_renown, 300),
              (check_quest_active, "qst_four_emperors"),
              (quest_slot_ge, "qst_four_emperors", slot_quest_current_state, 5),
              (jump_to_menu, "mnu_poppaea_event_chain_final"),
          (else_try),
              (call_script, "script_enter_court", "$current_town", -1),
          (try_end),
      (else_try),
          (display_message,"@You need more renown or to ask the guard.",0xFFFFAAAA),
      (try_end),
    ], "Enter the Hall."),

    ("town_center",[
      (party_slot_eq, "$current_town", slot_party_type, spt_town),
      (this_or_next|eq,"$entry_to_town_forbidden",0),
      (gt, "$sneaked_into_town", disguise_none), #SB : condition for disguise
    ],"Take a walk around the streets.",[
      (try_begin),
          (eq, "$current_town", "p_town_6"),
          (check_quest_active, "qst_wlodowiecus_adventure_3"),
          (quest_slot_eq, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 1),
          (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_visit_manc"),
      (else_try),
          (eq, "$current_town", "p_town_6"),
          (check_quest_active, "qst_wlodowiecus_adventure_2"),
          (quest_slot_eq, "qst_wlodowiecus_adventure_2", slot_quest_current_state, 1),
          (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_visit_manc"),
      (else_try),
          (this_or_next|eq,"$all_doors_locked",1),
          (eq,"$town_nighttime",1),
          (party_slot_eq, "$current_town", slot_center_decree_curfew, 1),
          (display_message,"@Due to the nightly curfew you are not allowed to walk around the streets in night time"),
      (else_try),
          #If the player is fighting his or her way out
          # (try_begin),
          (eq, "$talk_context", tc_prison_break),
          (assign, "$talk_context", tc_escape),
          (assign, "$g_mt_mode", tcm_escape),
          (store_faction_of_party, ":town_faction", "$current_town"),
          (faction_get_slot, ":tier_2_troop", ":town_faction", slot_faction_tier_3_troop),
          (faction_get_slot, ":tier_3_troop", ":town_faction", slot_faction_tier_3_troop),
          (faction_get_slot, ":tier_4_troop", ":town_faction", slot_faction_tier_4_troop),
          (party_get_slot, ":town_scene", "$current_town", slot_town_center),
          (modify_visitors_at_site, ":town_scene"),
          (reset_visitors),
          #SB : TODO : take account slot_center_has_prisoner_tower
          #ideally we could alarm troops at locations
          (try_begin),
          #if guards have not gone to some other important happening at nearby villages, then spawn 4 guards. (example : fire)
              (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
              (store_current_hours, ":cur_time"),
              (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),

              (neg|is_between, ":cur_time", ":last_nearby_fire_time", ":fire_finish_time"),
              (store_time_of_day, ":cur_day_hour"),
              (try_begin), #there are 6 guards at day time (no fire ext)
                  (ge, ":cur_day_hour", 6),
                  (lt, ":cur_day_hour", 22),
                  (set_visitors, 25, ":tier_2_troop", 2),
                  (set_visitors, 26, ":tier_2_troop", 1),
                  (set_visitors, 27, ":tier_3_troop", 2),
                  (set_visitors, 28, ":tier_4_troop", 1),
              (else_try),  #only 4 guards because of night
                  (set_visitors, 25, ":tier_2_troop", 1),
                  (set_visitors, 26, ":tier_2_troop", 1),
                  (set_visitors, 27, ":tier_3_troop", 1),
                  (set_visitors, 28, ":tier_4_troop", 1),
              (try_end),
          (else_try),
              #if guards have gone to some other important happening at nearby villages, then spawn only 1 guard. (example : fire)
              (store_time_of_day, ":cur_day_hour"),
              (try_begin), #only 2 guard because there is a fire at one owned village
                  (ge, ":cur_day_hour", 6),
                  (lt, ":cur_day_hour", 22),
                  (set_visitors, 25, ":tier_2_troop", 1),
                  (set_visitors, 26, ":tier_2_troop", 0),
                  (set_visitors, 27, ":tier_3_troop", 1),
                  (set_visitors, 28, ":tier_4_troop", 0),
              (else_try), #only 1 guard because both night and there is a fire at one owned village
                  (set_visitors, 25, ":tier_2_troop", 1),
                  (set_visitors, 26, ":tier_2_troop", 0),
                  (set_visitors, 27, ":tier_3_troop", 0),
                  (set_visitors, 28, ":tier_4_troop", 0),
              (try_end),
          (try_end),
          (set_jump_mission,"mt_town_center"),
          (try_begin),
              (gt, "$sneaked_into_town", disguise_none), #setup disguise
              (assign, ":override_state", af_override_everything),
          (try_end),
          #SB : override disguise and set flags for entries
          (try_for_range, ":entry_no", 0, 8),
              (eq, "$g_dplmc_player_disguise", 1),
              (gt, "$sneaked_into_town", disguise_none),
              (mission_tpl_entry_set_override_flags, "mt_town_center", ":entry_no", ":override_state"),
              (call_script, "script_set_disguise_override_items", "mt_town_center", ":entry_no", 1),
          (try_end),

          (jump_to_scene, ":town_scene"),
          (change_screen_mission),
          #If you're already at escape, then talk context will reset
      (else_try),
          (assign, "$talk_context", 0),
          (call_script, "script_cf_enter_center_location_bandit_check"),
          #All other circumstances...
      (else_try),
          (party_get_slot, ":town_scene", "$current_town", slot_town_center),
          (modify_visitors_at_site, ":town_scene"),
          (reset_visitors),
          (assign, "$g_mt_mode", tcm_default),
          (store_faction_of_party, ":town_faction","$current_town"),

          (call_script, "script_spawn_companion", "$current_town", location_center),
          (assign, ":companion", reg0),
          (try_begin),
              (is_between, ":companion", companions_begin, companions_end),
              (neg|main_party_has_troop, ":companion"),
              (troop_slot_eq, ":companion", slot_troop_occupation, 0),
              (set_visitor, 29, ":companion"),
          (try_end),

          (try_begin),
              (neq, ":town_faction", "fac_player_supporters_faction"),
              (faction_get_slot, ":troop_prison_guard", "$g_encountered_party_faction", slot_faction_prison_guard_troop),
              (faction_get_slot, ":troop_castle_guard", "$g_encountered_party_faction", slot_faction_castle_guard_troop),
              (faction_get_slot, ":tier_2_troop", ":town_faction", slot_faction_tier_2_troop),
              (faction_get_slot, ":tier_3_troop", ":town_faction", slot_faction_tier_3_troop),
          (else_try),
              (party_get_slot, ":town_original_faction", "$current_town", slot_center_original_faction),
              (faction_get_slot, ":troop_prison_guard", ":town_original_faction", slot_faction_prison_guard_troop),
              (faction_get_slot, ":troop_castle_guard", ":town_original_faction", slot_faction_castle_guard_troop),
              (faction_get_slot, ":tier_2_troop", ":town_original_faction", slot_faction_tier_2_troop),
              (faction_get_slot, ":tier_3_troop", ":town_original_faction", slot_faction_tier_3_troop),
          (try_end),
          (try_begin), #think about this, should castle guard have to go nearby fire too? If he do not go, killing 2 armored guard is too hard for player. For now he goes too.
              #if guards have not gone to some other important happening at nearby villages, then spawn 4 guards. (example : fire)
              (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
              (store_current_hours, ":cur_time"),
              (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),

              (neg|is_between, ":cur_time", ":last_nearby_fire_time", ":fire_finish_time"),
              (set_visitor, 23, ":troop_castle_guard"),
          (try_end),
          (set_visitor, 24, ":troop_prison_guard"),

          (try_begin),
              (gt,":tier_2_troop", 0),
              (assign,reg0,":tier_3_troop"),
              (assign,reg1,":tier_3_troop"),
              (assign,reg2,":tier_2_troop"),
              (assign,reg3,":tier_2_troop"),
          (else_try),
              (assign,reg0,"trp_mercenary_swordsman"),
              (assign,reg1,"trp_mercenary_swordsman"),
              (assign,reg2,"trp_mercenary_swordsman"),
              (assign,reg3,"trp_mercenary_swordsman"),
          (try_end),
          (shuffle_range,0,4),

          (try_begin),
              #if guards have not gone to some other important happening at nearby villages, then spawn 4 guards. (example : fire)
              (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
              (store_current_hours, ":cur_time"),
              (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),

              (neg|is_between, ":cur_time", ":last_nearby_fire_time", ":fire_finish_time"),
              (set_visitor,25,reg0),
              (set_visitor,26,reg1),
              (set_visitor,27,reg2),
              (set_visitor,28,reg3),
          (try_end),
          (try_begin),
              (eq, "$current_town", "p_town_23"),
              (check_quest_active, "qst_arminius_sword"),
              (set_visitor, 50, "trp_thusnelda"),
          (try_end),
          (try_begin),
              (neq, "$g_fire", 1),
              (eq, "$current_town", "p_town_6"),
              (set_visitors, 48, "trp_petronius", 1),
          (try_end),

          (try_begin),
              (neg|is_currently_night),
              (eq, "$current_town", "p_town_37"),
              (set_visitors, 8, "trp_pamphile", 1),
          (try_end),

          # main story: otho/vitellius choice
          (try_begin),
              (check_quest_active, "qst_four_emperors"),
              (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 7),
              (eq, "$current_town", "p_town_6"),
              (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
              (this_or_next|eq, ":goy", "trp_senator_2"),# otho
              (eq, ":goy", "trp_statthalter_9"), #vitellius
              (try_begin),
                  (troop_get_slot, ":leaded_party", ":goy", slot_troop_leaded_party),
                  (gt, ":leaded_party", -1),
                  (party_get_attached_to, ":attached_party_no", ":leaded_party"),
                  (eq, ":attached_party_no", "p_town_6"),
                  (set_visitors, 56, ":goy", 1),
              (else_try),
                  (str_store_troop_name, s10, ":goy"),
                  (display_message, "@{s10} has not reached Roma yet!", message_alert),
              (try_end),
              (set_visitors, 55, "trp_antonia", 1),
          (try_end),

          (try_begin),
              (eq, "$current_town", "p_town_6"),
              (set_visitors, 49, "trp_merchant1", 1),
              (set_visitors, 50, "trp_merchant2", 1),
              (set_visitors, 51, "trp_merchant3", 1),
              (set_visitors, 52, "trp_merchant4", 1),
          (try_end),
          (try_begin),
              (eq, "$current_town", "p_town_27"),
              (set_visitors, 49, "trp_merchant8", 1),
          (try_end),
          (try_begin),
              (neg|is_currently_night),
              (check_quest_active, "qst_werdheri"),
              (this_or_next|quest_slot_eq, "qst_werdheri", slot_quest_current_state, 1),
              (quest_slot_eq, "qst_werdheri", slot_quest_current_state, 5),
              (eq, "$current_town", "p_town_49"),
              (set_visitors, 49, "trp_werdheri", 1),
          (try_end),

          (try_begin),
              (eq, "$current_town", "p_town_19"),
              (troop_slot_eq, "trp_joesph_arimatrea", slot_troop_met, 0),
              (set_visitors, 49, "trp_joesph_arimatrea", 1),
          (try_end),

          (party_get_slot, ":spawned_troop", "$current_town", slot_town_armorer),
          (set_visitor, 9, ":spawned_troop"),
          (party_get_slot, ":spawned_troop", "$current_town", slot_town_weaponsmith),
          (set_visitor, 10, ":spawned_troop"),
          (party_get_slot, ":spawned_troop", "$current_town", slot_town_elder),
          (set_visitor, 11, ":spawned_troop"),
          (party_get_slot, ":spawned_troop", "$current_town", slot_town_horse_merchant),
          (set_visitor, 12, ":spawned_troop"),
          (call_script, "script_init_town_walkers"),
          (set_jump_mission,"mt_town_center"),
          (try_begin),
              (gt, "$sneaked_into_town", disguise_none), #setup disguise
              (try_for_range, ":entry_no", 0, 8),
                  (neq, ":entry_no", 1), #dckplmc: we want to ride our horses
                  (mission_tpl_entry_set_override_flags, "mt_town_center", ":entry_no", af_override_everything),
                  (call_script, "script_set_disguise_override_items", "mt_town_center", ":entry_no", 1),
              (try_end),
          (try_end),
          #SB : override disguise and set flags for entries
          (try_begin),
              (eq, "$town_entered", 0),
              (assign, "$town_entered", 1),
              (eq, "$town_nighttime", 0),
              (set_jump_entry, 1),
          (try_end),

          #VC-2404
          (try_begin),
              (lt, "$sneaked_into_town", 1), #not sneaked
              (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
              (try_for_range, ":entry", 0, 8),
                  (call_script, "script_init_second_outfit", "mt_town_center", ":entry", 1),
                  (mission_tpl_entry_set_override_flags, "mt_town_center", ":entry", af_override_outfit_1 | af_override_horse),
              (try_end),
          (try_end),

          (jump_to_scene, ":town_scene"),
          (change_screen_mission),
      (try_end),
    ],"Door to the town center."),

    ("town_tavern",[
      (party_slot_eq,"$current_town",slot_party_type, spt_town),
      (this_or_next|eq,"$entry_to_town_forbidden",0),
      (gt, "$sneaked_into_town", disguise_none),
    ],"Visit the tavern.",[
      (try_begin),
          (eq,"$all_doors_locked",1),
          (display_message,"str_door_locked",message_locked),
      (else_try),
          (call_script, "script_cf_enter_center_location_bandit_check"),
      (else_try),
          (check_quest_active, "qst_rags_to_riches"),
          (quest_slot_eq, "qst_rags_to_riches", slot_quest_current_state, 3),
          (display_message, "@The door to the tavern seems locked, with force you manage to upon it, but come upon a group of hired blades attacking Agrippina and Sittius Afer."),
          (set_jump_mission, "mt_rags_to_riches"),
          (party_get_slot, ":cur_scene", "$current_town", slot_town_tavern),
          (jump_to_scene, ":cur_scene"),
          (modify_visitors_at_site, ":cur_scene"),
          (reset_visitors),
          (set_visitor, 41, "trp_agrippina"),#now they are all looking the same
          (set_visitor, 42, "trp_sittius"),#now they are all looking the same
          (set_visitors, 45, "trp_hired_blade",3),#now they are all looking the same
          (change_screen_mission),
      (else_try),
          (assign, "$town_entered", 1),
          (set_jump_mission, "mt_town_default"),
          (mission_tpl_entry_set_override_flags, "mt_town_default", 0, af_override_horse),
          (try_begin), #SB : adjust sneaking overrides
              (gt, "$sneaked_into_town", disguise_none),
              (mission_tpl_entry_set_override_flags, "mt_town_default", 0, af_override_everything),
              (call_script, "script_set_disguise_override_items", "mt_town_default", 0, 1), #need weaposn for tavern fights
          (else_try),
            #VC-2404
              (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
              (call_script, "script_init_second_outfit", "mt_town_default", 0, 0),
              (mission_tpl_entry_set_override_flags, "mt_town_default", 0, af_override_outfit_1 | af_override_horse),
          (try_end),
          (party_get_slot, ":cur_scene", "$current_town", slot_town_tavern),
          (jump_to_scene, ":cur_scene"),
          (scene_set_slot, ":cur_scene", slot_scene_visited, 1),

          (assign, "$talk_context", tc_tavern_talk),
          (call_script, "script_initialize_tavern_variables"),

          (store_random_in_range, ":randomize_attacker_placement", 0, 4),

          (modify_visitors_at_site, ":cur_scene"),
          (reset_visitors),

          (assign, ":cur_entry", 17),
          #this is just a cheat right now
          #(troop_set_slot, "trp_belligerent_drunk", slot_troop_cur_center, "$g_encountered_party"),
          (try_begin),
              (eq, "$cheat_mode", 1),
              (troop_get_slot, ":drunk_location", "trp_belligerent_drunk", slot_troop_cur_center),
              (try_begin),
                  (eq, "$cheat_mode", 0),
              (else_try),
                  (is_between, ":drunk_location", centers_begin, centers_end),
                  (str_store_party_name, s4, ":drunk_location"),
                  (display_message, "str_belligerent_drunk_in_s4"),
              (else_try),
                  (display_message, "str_belligerent_drunk_not_found"),
              (try_end),
          (try_end),

              #this determines whether or not a lord who dislikes you will commission an assassin
          (try_begin),
              (store_current_hours, ":hours"),
              (store_sub, ":hours_since_last_attempt", ":hours", "$g_last_assassination_attempt_time"),
              (gt, ":hours_since_last_attempt", 168),
              ##diplomacy start+ Support ladies owning fiefs
              #(try_for_range, ":lord", active_npcs_begin, active_npcs_end),
              (try_for_range, ":lord", heroes_begin, kingdom_ladies_end),
                  (this_or_next|is_between, ":lord", active_npcs_begin, active_npcs_end),
                  (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
                  #Make sure they're not retired or dead
                  (neg|troop_slot_ge, ":lord", slot_troop_occupation, slto_retirement),
                  #add support for non-noble personalities
                  (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_ambitious),#"Lady MacBeth"
                  (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_roguish),
                  ##diplomacy end+
                  (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
                  (troop_get_slot, ":led_party", ":lord", slot_troop_leaded_party),
                  (party_is_active, ":led_party"),
                  (party_get_attached_to, ":led_party_attached", ":led_party"),
                  (eq, ":led_party_attached", "$g_encountered_party"),
                  (call_script, "script_troop_get_relation_with_troop", "trp_player", ":lord"),
                  (lt, reg0, -20),
                  (assign, "$g_last_assassination_attempt_time", ":hours"),
              #					(assign, "$g_last_assassination_attempt_location", "$g_encountered_party"),
              #					(assign, "$g_last_assassination_attempt_perpetrator", ":lord"),

                  (troop_set_slot, "trp_hired_assassin", slot_troop_cur_center, "$g_encountered_party"),
              (try_end),
              ##diplomacy start+
              #"Lady MacBeth" noblewomen will also attempt to have people killed on their husbands' behalf.
              (lt, "$g_last_assassination_attempt_time", ":hours"),
              (neg|troop_slot_eq, "trp_hired_assassin", slot_troop_cur_center, "$g_encountered_party"),
              (try_for_range, ":lady", kingdom_ladies_begin, kingdom_ladies_end),
                  (troop_slot_eq, ":lady", slot_troop_cur_center, "$g_encountered_party"),
                  (troop_slot_eq, ":lady", slot_lord_reputation_type, lrep_ambitious),#"Lady MacBeth"
                  (troop_slot_eq, ":lady", slot_troop_occupation, slto_kingdom_lady),

                  (call_script, "script_troop_get_player_relation", ":lady"),
                  (lt, reg0, 1),
                  #Will send an assassin if she doesn't like the player, and either she or her husband
                  #is at -20 or worse with the player.
                  (try_begin),
                      (ge, reg0, -20),
                      (troop_slot_ge, ":lady", slot_troop_spouse, 1),
                      (troop_get_slot, reg0, ":lady", slot_troop_spouse),
                      (call_script, "script_troop_get_player_relation", reg0),
                  (try_end),
                  (lt, reg0, -20),

                  (assign, "$g_last_assassination_attempt_time", ":hours"),
                  (troop_set_slot, "trp_hired_assassin", slot_troop_cur_center, "$g_encountered_party"),
              (try_end),
              ##diplomacy end+
          (try_end),

          (try_begin),
              (eq, ":randomize_attacker_placement", 0),
              (call_script, "script_setup_tavern_attacker", ":cur_entry"),
              (val_add, ":cur_entry", 1),
          (try_end),

          (party_get_slot, ":mercenary_troop", "$current_town", slot_center_mercenary_troop_type),
          (party_get_slot, ":mercenary_amount", "$current_town", slot_center_mercenary_troop_amount),
          (try_begin),
              (gt, ":mercenary_troop", 0),
              (gt, ":mercenary_amount", 0),
              (set_visitor, ":cur_entry", ":mercenary_troop"),
              (val_add, ":cur_entry", 1),
          (try_end),

          (call_script, "script_spawn_companion", "$current_town", location_tavern),
          (assign, ":companion", reg0),
          (try_begin),
              (is_between, ":companion", companions_begin, companions_end),
              (neg|main_party_has_troop, ":companion"),
              (troop_slot_eq, ":companion", slot_troop_occupation, 0),
              (set_visitor, ":cur_entry", ":companion"),
              (val_add, ":cur_entry", 1),
          (try_end),

          (try_begin),
              (quest_slot_eq, "qst_wlodowiecus_adventure_4", slot_quest_current_state,3),
              (eq, "$current_town", "p_town_13"),
              (set_visitor, 42, "trp_alan_guide"),
          (else_try),
              (neg|check_quest_active, "qst_elysium"),
              (quest_slot_eq, "qst_elysium", slot_quest_current_state,0),
              (this_or_next|eq, "$current_town", "p_town_37"),
              (this_or_next|eq, "$current_town", "p_town_35"),
              (eq, "$current_town", "p_town_13"),
              (neq, "$g_is_emperor", 1),
              (set_visitor, 42, "trp_drunken_sailor"),
          (else_try),
              (check_quest_active, "qst_thunder"),
              (quest_slot_eq, "qst_thunder", slot_quest_current_state,2),
              (eq, "$current_town", "p_town_20"),
              (set_visitor, 42, "trp_agent_parthian"),
          (else_try),
              (quest_slot_eq, "qst_thunder", slot_quest_current_state,4),
              (eq, "$current_town", "p_town_48"),
              (set_visitor, 42, "trp_agent_parthian"),
          (else_try),
              (quest_slot_eq, "qst_thunder", slot_quest_current_state,6),
              (eq, "$current_town", "p_town_20"),
              (set_visitor, 42, "trp_agent_parthian"),
          (else_try),
              (quest_slot_eq, "qst_thunder", slot_quest_current_state,7),
              (eq, "$current_town", "p_town_20"),
              (set_visitor, 42, "trp_agent_parthian"),
          (else_try),
              (quest_slot_eq, "qst_wlodowiecus_adventure_2", slot_quest_current_state,2),
              (eq, "$current_town", "p_town_29"),
              (set_visitor, 42, "trp_wlodowiecus"),
          (try_end),

          (try_begin),
              (check_quest_active, "qst_rags_to_riches"),
              (quest_slot_eq, "qst_rags_to_riches", slot_quest_current_state, 1),
              (eq, "$current_town", "p_town_28"),
              (set_visitor, 45, "trp_agrippina"),
          (try_end),
          (try_begin),
              (eq, ":randomize_attacker_placement", 1),
              (call_script, "script_setup_tavern_attacker", ":cur_entry"),
              (val_add, ":cur_entry", 1),
          (try_end),

          # (try_for_range, ":companion_candidate", companions_begin, companions_end),
              # (troop_slot_eq, ":companion_candidate", slot_troop_occupation, 0),
              # (troop_slot_eq, ":companion_candidate", slot_troop_cur_center, "$current_town"),
              # (neg|troop_slot_ge, ":companion_candidate", slot_troop_prisoner_of_party, centers_begin),
              # (neq, ":companion_candidate", "trp_npc31"), #only in gaetulian quest recruitable
              # (neq, ":companion_candidate", "trp_npc35"), #only together with Ligia
              # (set_visitor, ":cur_entry", ":companion_candidate"),
              # (val_add, ":cur_entry", 1),
          # (try_end),

          (try_begin),
              (eq, ":randomize_attacker_placement", 2),
              (call_script, "script_setup_tavern_attacker", ":cur_entry"),
              (val_add, ":cur_entry", 1),
          (try_end),

          (try_begin), #this doubles the incidence of ransom brokers and (below) minstrels
              (party_get_slot, ":ransom_broker", "$current_town", slot_center_ransom_broker),
              (gt, ":ransom_broker", 0),

              # (assign, reg0, ":ransom_broker"),
              # (assign, reg1, "$current_town"),

              (set_visitor, ":cur_entry", ":ransom_broker"),
              (val_add, ":cur_entry", 1),
          (else_try), #SB : move to script call
              # (is_between, "$g_talk_troop", ransom_brokers_begin, ransom_brokers_end), #wtf is this
              (call_script, "script_cf_find_alternative_town_for_taverngoers", "$current_town", 9),
              (assign, ":alternative_town", reg0),

              (party_get_slot, ":ransom_broker", ":alternative_town", slot_center_ransom_broker),
              (gt, ":ransom_broker", 0),
              (is_between, ":ransom_broker", ransom_brokers_begin, ransom_brokers_end), #prevent ramun and galeas from spawning other towns

              (set_visitor, ":cur_entry", ":ransom_broker"),
              (val_add, ":cur_entry", 1),
          (try_end),

          (try_begin),
              (party_get_slot, ":tavern_traveler", "$current_town", slot_center_tavern_traveler),
              (gt, ":tavern_traveler", 0),
              (set_visitor, ":cur_entry", ":tavern_traveler"),
              (val_add, ":cur_entry", 1),
          (try_end),

          (try_begin),
              (party_get_slot, ":tavern_minstrel", "$current_town", slot_center_tavern_minstrel),
              (gt, ":tavern_minstrel", 0),

              (set_visitor, ":cur_entry", ":tavern_minstrel"),
              (val_add, ":cur_entry", 1),
          (else_try), #SB : move to script call
              (call_script, "script_cf_find_alternative_town_for_taverngoers", "$current_town", 9),
              (assign, ":alternative_town", reg0),
              (party_get_slot, ":tavern_minstrel", ":alternative_town", slot_center_tavern_minstrel),
              (gt, ":tavern_minstrel", 0),

              (set_visitor, ":cur_entry", ":tavern_minstrel"),
              (val_add, ":cur_entry", 1),
          (try_end),

          (try_begin),
              (party_get_slot, ":tavern_bookseller", "$current_town", slot_center_tavern_bookseller),
              (gt, ":tavern_bookseller", 0),
              (set_visitor, ":cur_entry", ":tavern_bookseller"),
              (val_add, ":cur_entry", 1),
          (try_end),

          (try_begin),
              (eq, ":randomize_attacker_placement", 3),
              (call_script, "script_setup_tavern_attacker", ":cur_entry"),
              (val_add, ":cur_entry", 1),
          (try_end),

          (try_begin),
              (neg|check_quest_active, "qst_eliminate_bandits_infesting_village"),
              (neg|check_quest_active, "qst_deal_with_bandits_at_lords_village"),
              (assign, ":end_cond", villages_end),
              (try_for_range, ":cur_village", villages_begin, ":end_cond"),
                  (eq, ":end_cond", villages_end),
                  (party_slot_eq, ":cur_village", slot_village_bound_center, "$current_town"),
                  (party_slot_ge, ":cur_village", slot_village_infested_by_bandits, 1),
                  (neg|party_slot_eq, ":cur_village", slot_town_lord, "trp_player"),

                  (try_begin),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_1"),
                      (assign, ":rebel_troop", "trp_dacian_village_walker"),
                  (else_try),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2"),
                      (assign, ":rebel_troop", "trp_celtic_village_walker"),
                  (else_try),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2_1"),
                      (assign, ":rebel_troop", "trp_celtic_village_walker"),
                  (else_try),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_3"),
                      (assign, ":rebel_troop", "trp_sarmatian_village_walker"),
                  (else_try),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_4"),
                      (assign, ":rebel_troop", "trp_germanic_village_walker"),
                  (else_try),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_5"),
                      (assign, ":rebel_troop", "trp_armenian_village_walker"),
                  (else_try),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_6"),
                      (assign, ":rebel_troop", "trp_parthian_village_walker"),
                  (else_try),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
                      (assign, ":rebel_troop", "trp_roman_village_walker"),
                  (else_try),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_9"),
                      (assign, ":rebel_troop", "trp_bosporan_village_walker"),
                  (else_try),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_8"),
                      (assign, ":rebel_troop", "trp_judean_village_walker"),
                  (try_end),
                  (set_visitor, ":cur_entry", ":rebel_troop"),
                  (display_message, "@Added Peasant"),
                  (val_add, ":cur_entry", 1),
                  (assign, ":end_cond", -1),
              (try_end),
          (try_end),

          (try_begin),
              (eq, "$g_campaign_type", g_campaign_story_rome),
              (eq, "$g_starting_town", "$current_town"),
              (neq, "$g_is_emperor", 1), # not if emperor
              (this_or_next|neg|check_quest_finished, "qst_collect_men"),
              (this_or_next|neg|check_quest_finished, "qst_learn_where_merchant_brother_is"),
              (this_or_next|neg|check_quest_finished, "qst_save_relative_of_merchant"),
              (this_or_next|neg|check_quest_finished, "qst_save_town_from_bandits"),
              (eq,  "$g_do_one_more_meeting_with_merchant", 1),
              (neq,  "$g_do_one_more_meeting_with_merchant", 3),
              (set_visitor, ":cur_entry", "trp_roman_start_merchant"),
              (val_add, ":cur_entry", 1),
          (try_end),

          (party_get_slot, ":keeper", "$current_town", slot_town_tavernkeeper),
          (set_visitor, 9, ":keeper"),

          #dedal begin
          (party_get_slot, ":center_faction", "$current_town", slot_center_original_faction), #dckplmc - tavern patrons same culture as town
          (faction_get_slot, ":center_culture", ":center_faction", slot_faction_culture),

          (try_begin),
              (eq,"$town_nighttime",1),
              (party_slot_eq, "$current_town", slot_center_decree_curfew, 1),
          (else_try),
              (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
              (val_add, ":prosperity", 20),
              (try_for_range,":entry",32,41),
                  (store_random_in_range, ":noble_change", 0, 120),
                  (try_begin),
                      (le, ":noble_change", ":prosperity"),
                      (faction_get_slot, ":walker_troop_id", ":center_culture", slot_faction_town_walker_male_troop),
                  (else_try),
                      (faction_get_slot, ":walker_troop_id", ":center_culture", slot_faction_village_walker_male_troop),
                  (try_end),
                  (store_random_in_range,":rand",0,2), #dckplmc - randomly male or female
                  (store_add, ":town_walker", ":rand", ":walker_troop_id"),
                  (mission_tpl_entry_clear_override_items,"mt_town_default",":entry"),
                  (store_random_in_range,":r",0,10),
                  (try_begin),
                      (gt,":r",2),
                      (mission_tpl_entry_add_override_item,"mt_town_default",":entry","itm_dedal_kufel"),
                  (try_end),
                  (set_visitor,":entry",":town_walker"),
              (try_end),
          (try_end),
          #dedal end
          (try_begin),
              (neq, "$g_is_emperor", 1),#not if emperor
              (eq, "$current_town","p_town_2"),
              (troop_slot_eq, "trp_global_variables", g_flavor_event_1, 0),
              (set_visitor, 43, "trp_aux_inf"),
              (set_visitor, 44, "trp_vigilia"),
          (try_end),

          (try_begin),
              (eq, "$current_town","p_town_34"),
              (troop_slot_eq, "trp_random_idiot", slot_troop_met, 0),
              (set_visitor, 43, "trp_random_idiot"),
          (try_end),

          (try_begin),
              (neq, "$g_is_emperor", 1),#not if emperor
              (eq, "$current_town","p_town_19"),
              (faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_7"),
              (troop_slot_eq, "trp_global_variables", g_flavor_event_2, 0),
              (set_visitor, 43, "trp_arab_poormerchant"),
              (set_visitor, 44, "trp_arab_richmerchant"),
          (try_end),

          (try_begin),
              (eq, "$current_town","p_town_26"),
              (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_3"),
              (troop_slot_eq, "trp_global_variables", g_flavor_event_3, 0),
              (set_visitor, 43, "trp_sarmatian_light_horseman"),
              (set_visitor, 44, "trp_sarmatian_town_walker"),
          (try_end),

          (try_begin),
              (store_random_in_range, ":random", 0, 5),
              (try_begin),
                  (eq, ":random", 1),
                  (try_begin),
                      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
                      (store_random_in_range, ":rand_troop", "trp_tavern_npc1", "trp_whore"),
                  (else_try),
                      (assign, ":rand_troop", "trp_tavern_npc1"),
                  (try_end),
                  (set_visitor, ":cur_entry", ":rand_troop"),
                  (val_add, ":cur_entry", 1),
              (else_try),
                  (eq, ":random", 2),
                  (set_visitor, ":cur_entry", "trp_whore"),
                  (val_add, ":cur_entry", 1),
              (try_end),
          (try_end),
          (set_visitor, 41, "trp_healer"),#now they are all looking the same
          (change_screen_mission),
      (try_end),
    ],"Door to the tavern."),
    ("town_merchant",[
      (party_slot_eq,"$current_town",slot_party_type, spt_town),
      (eq, 1, 0),
      (eq,"$town_nighttime",0),
      (this_or_next|eq,"$entry_to_town_forbidden",0),
      (eq, "$sneaked_into_town",1),
    ],"Speak with the merchant.",[
      (try_begin),
          (this_or_next|eq,"$all_doors_locked",1),
          (eq,"$town_nighttime",1),
          (display_message,"str_door_locked",0xFFFFAAAA),
      (else_try),
          (assign, "$town_entered", 1),
          (set_jump_mission, "mt_town_default"),
          (mission_tpl_entry_set_override_flags, "mt_town_default", 0, af_override_horse),
          (try_begin),
              (eq, "$sneaked_into_town",1),
              (mission_tpl_entry_set_override_flags, "mt_town_default", 0, af_override_all),
          (else_try),
              #VC-2404
              (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
              (call_script, "script_init_second_outfit", "mt_town_default", 0, 0),
              (mission_tpl_entry_set_override_flags, "mt_town_default", 0, af_override_outfit_1 | af_override_horse),
          (try_end),
          (party_get_slot, ":cur_scene", "$current_town", slot_town_store),
          (party_get_slot, ":merchant", "$current_town", slot_town_merchant),
          (modify_visitors_at_site,":cur_scene"),
          (reset_visitors),
          (set_visitor, 9, ":merchant"),
          (set_jump_entry, 0),
          (jump_to_scene, ":cur_scene"),
          (scene_set_slot, ":cur_scene", slot_scene_visited, 1),
          (change_screen_mission),
      (try_end),
    ],"Door to the shop."),

    ("town_arena",[
      (party_slot_eq,"$current_town",slot_party_type, spt_town),
      (eq, "$sneaked_into_town", 0),
    ],"Enter the arena.",[
      (try_begin),
        (this_or_next|eq,"$all_doors_locked",1),
        (eq,"$town_nighttime",1),
        (display_message,"str_door_locked",message_locked),
      (else_try),
        (assign, "$g_mt_mode", abm_visit),
        (assign, "$town_entered", 1),
        (set_jump_mission, "mt_arena_melee_fight"),
        (party_get_slot, ":arena_scene", "$current_town", slot_town_arena),
        (modify_visitors_at_site, ":arena_scene"),
        (reset_visitors),
        (party_get_slot, ":culture", "$current_town",slot_center_culture),
        (try_begin),
          (eq, ":culture", "fac_culture_7"),
          (set_visitors, 41, "trp_guest_female", 7),
          (set_visitors, 42, "trp_guest", 7),
          (set_visitors, 45, "trp_guest", 7),
          (set_visitors, 46, "trp_guest_female", 7),
          (set_visitors, 47, "trp_guest", 7),
          (set_visitors, 48, "trp_guest", 7),
          (set_visitors, 49, "trp_guest_female", 7),
          (set_visitors, 54, "trp_guest", 7),
          (set_visitors, 55, "trp_guest_female", 7),
          (set_visitors, 56, "trp_guest", 7),
          (set_visitors, 57, "trp_guest_female", 7),
        (try_end),
        (try_begin),
          (eq, ":culture", "fac_culture_7"),
          (set_visitor, 43, "trp_veteran_fighter"),
          (set_visitor, 44, "trp_hired_blade"),
        (try_end),
        (store_sub, ":town_id", "$current_town", towns_begin),
        (store_add, ":auctor", ":town_id", arena_masters_begin),
        (set_visitor, 52, ":auctor"),
        #VC-2404
        (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_arena_melee_fight", 50, 0),
          (mission_tpl_entry_set_override_flags, "mt_arena_melee_fight", 50, af_override_outfit_1 | af_override_horse),
        (try_end),

        (set_jump_entry, 50),
        (jump_to_scene, ":arena_scene"),
        (scene_set_slot, ":arena_scene", slot_scene_visited, 1),
        (change_screen_mission),
      (try_end),
    ],"Door to the arena."),
    ("town_dungeon",[
      (party_slot_eq, "$current_town", slot_town_lord, "trp_player"), #dckplmc: add quick access to dungeon for owner
    ],"Enter the prison.",[
      (try_begin),
          (eq, "$talk_context", tc_prison_break),
          (gt, "$g_main_attacker_agent", 0),

          (neg|agent_is_alive, "$g_main_attacker_agent"),

          (agent_get_troop_id, ":agent_type", "$g_main_attacker_agent"),
          (try_begin),
              (eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
              (party_get_slot, ":prison_guard_faction", "$current_town", slot_center_original_faction),
          (else_try),
              (assign, ":prison_guard_faction", "$g_encountered_party_faction"),
          (try_end),
          (faction_slot_eq, ":prison_guard_faction", slot_faction_prison_guard_troop, ":agent_type"),

          (call_script, "script_deduct_casualties_from_garrison"),
          (call_script, "script_enter_dungeon", "$current_town"),

      (else_try),
          (eq,"$all_doors_locked",1),
          (display_message,"str_door_locked",message_locked),
      (else_try),
          (this_or_next|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
          (eq, "$g_encountered_party_faction", "$players_kingdom"),
          (assign, "$town_entered", 1),
          (call_script, "script_enter_dungeon", "$current_town"),
      (else_try),
          (display_message,"str_door_locked",message_locked),
      (try_end),
    ],"Door to the dungeon."),

    ("castle_inspect",[
      (party_slot_eq,"$current_town",slot_party_type, spt_castle),
    ],"Take a walk around the fortress.",[
      (try_begin),
          (this_or_next|eq,"$all_doors_locked",1),
          (eq,"$town_nighttime",1),
          (party_slot_eq, "$current_town", slot_center_decree_curfew, 1),
          (display_message,"@Due to the nightly curfew you are not allowed to walk around the streets in night time"),
      (else_try),
          (eq, "$talk_context", tc_prison_break),
          (assign, "$talk_context", tc_escape),

          (party_get_slot, ":cur_castle_exterior", "$current_town", slot_castle_exterior),
          (modify_visitors_at_site, ":cur_castle_exterior"),
          (reset_visitors),

          (assign, ":guard_no", 40),

          (party_get_num_companion_stacks, ":num_stacks", "$g_encountered_party"),
          (try_for_range, ":troop_iterator", 0, ":num_stacks"),
          #nearby fire condition start
              (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
              (store_current_hours, ":cur_time"),
              (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),
              (this_or_next|eq, ":guard_no", 40),
              (neg|is_between, ":cur_time", ":last_nearby_fire_time", ":fire_finish_time"),
          #nearby fire condition end

              (lt, ":guard_no", 47),
              (party_stack_get_troop_id, ":cur_troop_id", "$g_encountered_party", ":troop_iterator"),
              (neg|troop_is_hero, ":cur_troop_id"),
              (party_stack_get_size, ":stack_size","$g_encountered_party",":troop_iterator"),
              (party_stack_get_num_wounded, ":num_wounded","$g_encountered_party",":troop_iterator"),
              (val_sub, ":stack_size", ":num_wounded"),
              (gt, ":stack_size", 0),
              (party_stack_get_troop_dna,":troop_dna", "$g_encountered_party", ":troop_iterator"),
              (set_visitor, ":guard_no", ":cur_troop_id", ":troop_dna"),
              (val_add, ":guard_no", 1),
          (try_end),
          #(set_jump_entry, 1),
          (set_jump_entry, 7), #SB : g_player_troop back to trp_player

          (set_jump_mission,"mt_castle_visit"),

          (try_begin),
              (gt, "$sneaked_into_town", disguise_none), #setup disguise
              (assign, ":override_state", af_override_everything),
          (try_end),
          #SB : override disguise and set flags for entries
          (try_for_range, ":entry_no", 0, 8),
              (eq, "$g_dplmc_player_disguise", 1),
              (gt, "$sneaked_into_town", disguise_none),
              (mission_tpl_entry_set_override_flags, "mt_castle_visit", ":entry_no", ":override_state"),
              (call_script, "script_set_disguise_override_items", "mt_castle_visit", ":entry_no", 1),
          (try_end),

          #VC-2404
          (try_begin),
              (lt, "$sneaked_into_town", 1), #not sneaked
              (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
              (try_for_range, ":entry", 0, 8),
                  (call_script, "script_init_second_outfit", "mt_castle_visit", ":entry", 0),
                  (mission_tpl_entry_set_override_flags, "mt_castle_visit", ":entry", af_override_outfit_1 | af_override_horse),
              (try_end),
          (try_end),

          (jump_to_scene, ":cur_castle_exterior"),
          (change_screen_mission),
          #If you're already at escape, then talk context will reset
      (else_try),
          (assign, "$talk_context", tc_town_talk),

          (assign, "$g_mt_mode", tcm_default),

          (party_get_slot, ":cur_castle_exterior", "$current_town", slot_castle_exterior),
          (modify_visitors_at_site,":cur_castle_exterior"),
          (reset_visitors),

          (try_begin),
              (neq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
              (faction_get_slot, ":troop_prison_guard", "$g_encountered_party_faction", slot_faction_prison_guard_troop),
          (else_try),
              (party_get_slot, ":town_original_faction", "$current_town", slot_center_original_faction),
              (faction_get_slot, ":troop_prison_guard", ":town_original_faction", slot_faction_prison_guard_troop),
          (try_end),
          (set_visitor, 24, ":troop_prison_guard"),
          (call_script, "script_init_town_walkers"), #chief anadido walkers a castillos

          (assign, ":guard_no", 40),

          (party_get_num_companion_stacks, ":num_stacks", "$g_encountered_party"),
          (try_for_range, ":troop_iterator", 0, ":num_stacks"),
              #nearby fire condition start
              (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
              (store_current_hours, ":cur_time"),
              (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),
              (neg|is_between, ":cur_time", ":fire_finish_time", ":last_nearby_fire_time"),

              (lt, ":guard_no", 47),
              (party_stack_get_troop_id, ":cur_troop_id", "$g_encountered_party", ":troop_iterator"),
              (neg|troop_is_hero, ":cur_troop_id"),
              (party_stack_get_size, ":stack_size","$g_encountered_party",":troop_iterator"),
              (party_stack_get_num_wounded, ":num_wounded","$g_encountered_party",":troop_iterator"),
              (val_sub, ":stack_size", ":num_wounded"),
              (gt, ":stack_size", 0),
              (party_stack_get_troop_dna,":troop_dna","$g_encountered_party",":troop_iterator"),
              (set_visitor, ":guard_no", ":cur_troop_id", ":troop_dna"),

              (val_add, ":guard_no", 1),
          (try_end),

          (try_begin),
              (eq, "$town_entered", 0),
              (assign, "$town_entered", 1),
          (try_end),

          (call_script, "script_spawn_companion", "$current_town", location_center),
          (assign, ":companion", reg0),
          (try_begin),
              (is_between, ":companion", companions_begin, companions_end),
              (neg|main_party_has_troop, ":companion"),
              (troop_slot_eq, ":companion", slot_troop_occupation, 0),
              (set_visitor, 28, ":companion"),
          (try_end),

          (try_begin),	#VC: Fixing a native issue of castles
              (party_get_slot, ":castle_scene", "$current_town", slot_town_castle),
              (store_current_scene, ":curr_scene"),
              (eq, ":curr_scene", ":castle_scene"),
              (set_jump_entry, 2),
          (else_try),
              (party_get_slot, ":pirson_scene", "$current_town", slot_town_prison),
              (store_current_scene, ":curr_scene"),
              (eq, ":curr_scene", ":pirson_scene"),
              (set_jump_entry, 7),
          (else_try),
              (set_jump_entry, 1),
          (try_end),

          # (try_begin),
          # (eq, "$town_entered", 0),
          # (assign, "$town_entered", 1),
          # (eq, "$town_nighttime", 0),
          # (set_jump_entry, 1),
          # (try_end),

          (assign, ":override_state", 0),
          (try_begin),
              (gt, "$sneaked_into_town", disguise_none), #setup disguise
              (assign, ":override_state", af_override_everything),
          (try_end),
          (set_jump_mission, "mt_castle_visit"),

          #SB : populate disguise and set flags for entries
          (try_for_range, ":entry_no", 0, 8),
              (mission_tpl_entry_set_override_flags, "mt_castle_visit", ":entry_no", ":override_state"),
              (call_script, "script_set_disguise_override_items", "mt_castle_visit", ":entry_no", 1),
          (try_end),
          # (mission_tpl_entry_set_override_flags, "mt_castle_visit", 0, ":override_state"),
          # (mission_tpl_entry_set_override_flags, "mt_castle_visit", 1, ":override_state"),
          # (mission_tpl_entry_set_override_flags, "mt_castle_visit", 2, ":override_state"),
          # (mission_tpl_entry_set_override_flags, "mt_castle_visit", 3, ":override_state"),
          # (mission_tpl_entry_set_override_flags, "mt_castle_visit", 4, ":override_state"),
          # (mission_tpl_entry_set_override_flags, "mt_castle_visit", 5, ":override_state"),
          # (mission_tpl_entry_set_override_flags, "mt_castle_visit", 6, ":override_state"),
          # (mission_tpl_entry_set_override_flags, "mt_castle_visit", 7, ":override_state"),

          (jump_to_scene, ":cur_castle_exterior"),
          (change_screen_mission),
      (try_end),
    ], "To the courtyard."),

    ("town_enterprise",[
      (party_slot_eq,"$current_town",slot_party_type, spt_town),
      (party_get_slot, ":item_produced", "$current_town", slot_center_player_enterprise),
		  (gt, ":item_produced", 1),
      (eq,"$entry_to_town_forbidden",0),
		  (call_script, "script_get_enterprise_name", ":item_produced"),
		  (str_store_string, s3, reg0),
    ],"Visit your {s3}.",[
      (party_get_slot, ":master_craftsman", "$current_town",slot_town_mastercraftman),
      (party_get_slot, ":item_produced", "$current_town", slot_center_player_enterprise),
      (assign, ":enterprise_scene", "scn_enterprise_mill"),
      (try_begin),
          (eq, ":item_produced", "itm_bread"),
          (assign, ":enterprise_scene", "scn_enterprise_mill"),
      (else_try),
          (eq, ":item_produced", "itm_ale"),
          (assign, ":enterprise_scene", "scn_enterprise_brewery"),
      (else_try),
          (eq, ":item_produced", "itm_oil"),
          (assign, ":enterprise_scene", "scn_enterprise_oil_press"),
      (else_try),
          (eq, ":item_produced", "itm_wine"),
          (assign, ":enterprise_scene", "scn_enterprise_winery"),
      (else_try),
          (eq, ":item_produced", "itm_leatherwork"),
          (assign, ":enterprise_scene", "scn_enterprise_tannery"),
      (else_try),
          (eq, ":item_produced", "itm_wool_cloth"),
          (assign, ":enterprise_scene", "scn_enterprise_wool_weavery"),
      (else_try),
          (eq, ":item_produced", "itm_linen"),
          (assign, ":enterprise_scene", "scn_enterprise_linen_weavery"),
      (else_try),
          (eq, ":item_produced", "itm_velvet"),
          (assign, ":enterprise_scene", "scn_enterprise_dyeworks"),
      (else_try),
          (eq, ":item_produced", "itm_tools"),
          (assign, ":enterprise_scene", "scn_enterprise_smithy"),
      (try_end),
      (modify_visitors_at_site,":enterprise_scene"),
      (reset_visitors),
      (set_visitor,0,"trp_player"),
      (set_visitor,17,":master_craftsman"),
      (set_jump_mission,"mt_town_default"),
      (jump_to_scene,":enterprise_scene"),
      (change_screen_mission),
    ],"Door to your enterprise."),

    ("visit_lupanar",[
      (eq, 0, 1),
      (eq, "$current_town", "p_town_6"),
    ],"Enter the lupanar.",[
      (assign,"$talk_context", tc_tavern_talk),
      (set_jump_mission, "mt_toiletboys"),
      (modify_visitors_at_site, "scn_luparnium"),
      (reset_visitors),
      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_toiletboys", 1, 0),
        (mission_tpl_entry_set_override_flags, "mt_toiletboys", 1, af_override_outfit_1|af_override_horse),
      (else_try),
        (mission_tpl_entry_set_override_flags, "mt_toiletboys", 1, af_override_weapons|af_override_horse|af_override_head),
      (try_end),
      (set_visitor, 1, "trp_player"),
      # (try_for_range, ":entry", 2, 4),
      #   (mission_tpl_entry_set_override_flags, "mt_toiletboys", ":entry", af_override_weapons|af_override_horse|af_override_head),
      # (try_end),
      # (set_visitor, 2, "trp_aux_inf"),
      # (set_visitor, 3, "trp_vigilia"),
      (try_for_range, ":entry", 4, 10),
        (mission_tpl_entry_set_override_flags, "mt_toiletboys", ":entry", af_override_everything),
      (try_end),
      (set_visitor, 4, "trp_slave"),
      (set_visitor, 5, "trp_slave_female"),
      (set_visitor, 6, "trp_slave"),
      (set_visitor, 7, "trp_slave_female"),
      (set_visitor, 8, "trp_slave_female"),
      (set_visitor, 9, "trp_slave_female"),
      (jump_to_scene, "scn_luparnium"),
      (change_screen_mission),
    ], "Enter the lupanar."),


    ("trade_with_merchants",[
      (party_slot_eq,"$current_town",slot_party_type, spt_town)
    ],"Go to the town center.",[
      (try_begin),
          (this_or_next|eq,"$all_doors_locked",1),
          (eq,"$town_nighttime",1),
          (party_slot_eq, "$current_town", slot_center_decree_curfew, 1),
          (display_message,"@Due to the nightly curfew you are not allowed to walk around the streets in night time"),
      (else_try),
          (eq, "$g_starting_town", "$current_town"),
          (ge,  "$g_do_one_more_meeting_with_merchant", 1),
          (quest_slot_eq, "qst_town_trade", slot_quest_menu_1, 0),
          (jump_to_menu, "mnu_slave_message"),
      (else_try),
          (call_script, "script_cf_enter_center_location_bandit_check"),
      (else_try),
          (jump_to_menu,"mnu_town_trade"),
      (try_end),
    ]),

    ("trade_with_locals",[
      (party_slot_eq,"$current_town",slot_party_type, spt_castle),
    ],"Go to the Vicus",[
      (try_begin),
        (this_or_next|eq,"$all_doors_locked",1),
        (eq,"$town_nighttime",1),
        (party_slot_eq, "$current_town", slot_center_decree_curfew, 1),
        (display_message,"@Due to the nightly curfew you are not allowed to walk around the streets in night time"),
      (else_try),
        (jump_to_menu,"mnu_town_trade"),
      (try_end),
    ]),

    ("walled_center_manage",[
      (neg|party_slot_eq, "$current_town", slot_village_state, svs_under_siege),
      (assign, reg0, 0),
      (try_begin),
          (store_faction_of_party, ":fac", "$current_town"),
          (faction_slot_eq, ":fac", slot_faction_leader, "trp_player"),
          (faction_slot_ge, ":fac", dplmc_slot_faction_centralization, 1),
          (assign, reg0, 1),
      (else_try),
          (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
          (assign, reg0, 1),
      (try_end),
      (eq, reg0, 1),
      #(assign, reg0, 1),
      (try_begin),
          (party_slot_eq, "$current_town", slot_party_type, spt_castle),
          (assign, reg0, 0),
      (try_end),
    ],"Manage this {reg0?town:fortress}.",[
      (assign, "$g_next_menu", "mnu_town"),
      (assign, reg63, 1),
      (jump_to_menu, "mnu_center_manage_2"),
    ]),

    ("walled_center_move_court",[
      (neg|party_slot_eq, "$current_town", slot_village_state, svs_under_siege),
      (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
      (eq, "$g_encountered_party_faction", "$players_kingdom"),
      (neq, "$g_player_court", "$current_town"),
      ##diplomacy start+ Handle player is co-ruler of kingdom
      (assign, ":is_coruler", 0),
      (try_begin),
        (is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
        (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", "$players_kingdom"),
        (ge, reg0, DPLMC_FACTION_STANDING_LEADER_SPOUSE),
        (assign, ":is_coruler", 1),
      (else_try),
        (faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
        (eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (assign, ":is_coruler", 1),
      (try_end),
      (eq, ":is_coruler", 1),
    ],"Move your court here.",[
      (jump_to_menu, "mnu_establish_court"),
    ]),

    ("castle_station_troops",[
      (assign, ":player_can_draw_from_garrison", 0),
      (neg|party_slot_eq, "$g_encountered_party", slot_town_lord, "trp_player"),
      (try_begin),
          (call_script, "script_cf_can_donate_to_garrision", "$g_encountered_party"),
          (assign, ":player_can_draw_from_garrison", 1),
          (str_store_string, s55, "@Donate troops to the garrison (Cannot remove)"),
      (else_try),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_marshal, "trp_player"),
          (assign, ":player_can_draw_from_garrison", 1),
          (str_store_string, s55, "@Manage the garrison"),
      (else_try),
          (troop_get_slot, ":legion", "trp_player", slot_troop_legion),
          (store_add, ":legion_hq", ":legion", slot_legion_home_begin),
          (troop_slot_eq, "trp_province_array", ":legion_hq", "$g_encountered_party"),
          (assign, ":player_can_draw_from_garrison", 1),
          (str_store_string, s55, "@Manage the garrison"),
      (try_end),
      (eq, ":player_can_draw_from_garrison", 1),
    ],"{s55}",[
      (try_begin),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_marshal, "trp_player"),
          (assign, reg63, 2),
          (jump_to_menu, "mnu_garrison_management"),
      (else_try),
          (troop_get_slot, ":legion", "trp_player", slot_troop_legion),
          (store_add, ":legion_hq", ":legion", slot_legion_home_begin),
          (troop_slot_eq, "trp_province_array", ":legion_hq", "$g_encountered_party"),
          (assign, reg63, 2),
          (jump_to_menu, "mnu_garrison_management"),
      (else_try),
          (start_presentation, "prsnt_manage_cohorts_town"),
      (try_end),
    ]),

	  ##diplomacy start+
	  #Other option to add troops to garrison
    ("dplmc_castle_give_troops",[
        (eq, 0, 1),
    ],"Give troops to the garrison (cannot remove)",[
      (change_screen_give_members, "$current_town"),
    ]),

    ("castle_wait",[
      #(party_slot_eq,"$current_town",slot_party_type, spt_castle),
      (this_or_next|ge, "$g_encountered_party_relation", 0),
      (eq,"$castle_undefended",1),
      (assign, ":can_rest", 1),
      (str_clear, s1),
      (try_begin),
          (neg|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
          (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
          (neg|party_slot_eq, "$current_town", slot_town_lord, ":player_spouse"),

          (party_slot_ge, "$current_town", slot_town_lord, "trp_player"), #can rest for free in castles and towns with unassigned lords
          (store_faction_of_party, ":current_town_faction", "$current_town"),
          (neq, ":current_town_faction", "fac_player_supporters_faction"),
          (party_get_num_companions, ":num_men", "p_main_party"),
          (store_div, reg1, ":num_men", 4),
          (val_add, reg1, 1),
          (str_store_string, s1, "@ ({reg1} denars per night)"),
          (store_troop_gold, ":gold", "trp_player"),
          (lt, ":gold", reg1),
          (assign, ":can_rest", 0),
      (try_end),
      (eq, ":can_rest", 1),
        (eq, "$enlisted_party", -1),#no freelancer
    ],"Rest here for some time{s1}.",[
      (assign, "$auto_enter_town", "$current_town"),
      (assign, "$g_town_visit_after_rest", 1),
      (assign, "$g_last_rest_center", "$current_town"),
      (assign, "$g_last_rest_payment_until", -1),
      (rest_for_hours_interactive, 24 * 86, 12, 0), #rest while not attackable
      (change_screen_return),
    ]),

    ("visit_palace",[
      (eq, "$g_is_emperor", 1),
      (eq, "$current_town", "p_town_6"),
      (store_faction_of_party, ":fac", "$current_town"),
      (eq, ":fac", "$players_kingdom"),
    ],"Visit the Domus Augusti.",[
      (set_passage_menu,"mnu_town"),
      (try_begin),
          (neq, "$g_is_emperor", 1),
          (display_message, "str_door_locked"),
      (else_try),
          (assign, "$temp4_1", 1),
          (call_script, "script_cf_conspiracy_check"),
      (else_try),
          (store_current_hours, ":hours"),
          (call_script, "script_game_get_date_text", 0, ":hours"),
          (ge, reg2, 66),
          # (store_current_day, ":day"),
          # (ge, ":day", 90),
          (try_for_range, ":center", walled_centers_begin, walled_centers_end),
              (party_slot_eq, ":center", slot_center_province, p_cent_panno),
              (store_faction_of_party, ":faction", ":center"),
              (eq, ":faction", "$players_kingdom"),
          (try_end),
          (troop_slot_eq, "trp_global_variables", g_iazyges_event, 0),
          (jump_to_menu, "mnu_iazyges_delegation"),
      (else_try),
          (call_script, "script_enter_palace"),
      (try_end),
    ], "Door to the Domus Augusti"),
    ("visit_senate",[
		  (eq, 0, 1),
    ],"Visit the Curia Julia.",[
      (set_passage_menu,"mnu_town"),
      (assign, ":c", 0),
      (try_begin),
        (eq, "$players_kingdom", "$g_encountered_party_faction"),
        (assign, ":c", 1),
      (else_try),
        (store_relation, ":cur_relation", "fac_player_supporters_faction", "$g_encountered_party_faction"),
        (ge, ":cur_relation", 10),
        (assign, ":c", 1),
      (try_end),
      (try_begin),
        (this_or_next|eq, ":c", 0),
        (this_or_next|neq, "$current_town", "p_town_6"),
        (neg|party_slot_eq, "$current_town", slot_center_is_besieged_by, -1),#not during a siege
        (display_message, "str_door_locked"),
      (else_try),
        (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 10),#at least some support
        (troop_slot_eq, "trp_global_variables", g_senate_event_possible, 0),
        (store_random_in_range, ":ratio_event", 0, 100),
        (is_between, ":ratio_event", 20, 80),
        (troop_set_slot, "trp_global_variables", g_senate_event_possible, 1),
        (try_begin),
      #   (display_message, "@Check0"),
          (neg|check_quest_active, "qst_money_stinks"),
          (quest_slot_eq, "qst_money_stinks", slot_quest_object_state, 0),
      #   (display_message, "@Check1"),
          (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 35),
          (troop_slot_ge, "trp_player", slot_troop_influence, 500),
          (neq, "$g_is_emperor", 1),
          (faction_slot_eq, "$players_kingdom", slot_faction_culture, "fac_culture_7"),
          (neg|faction_slot_eq, "$players_kingdom", slot_faction_leader, "trp_player"),
          #(ge, "$g_rank", 1),
        #  (display_message, "@Check2"),
          (troop_slot_eq, "trp_kingdom_7_lord", slot_troop_occupation, slto_kingdom_hero),
          (call_script, "script_troop_get_player_relation", "trp_kingdom_7_lord"),
          (ge, reg0, 10),
        # (display_message, "@Check3"),
          (assign, ":event_juice", "mnu_puppius_meet"),
        (else_try),
          (troop_slot_eq, "trp_diggus", slot_troop_bachus, 0),
          (troop_slot_ge, "trp_diggus", slot_troop_met, 1),
          (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 40),
          (assign, ":event_juice", "mnu_event_senate_digus_reveange"),
          (troop_set_slot, "trp_diggus", slot_troop_bachus, 1),
        (else_try),
          (eq, "$senate_events", 0),
          (assign,":event_juice", "mnu_event_senate_01"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 1),
          (assign,":event_juice", "mnu_event_senate_02"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 2),
          (assign,":event_juice", "mnu_event_senate_03"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 3),
          (assign, ":event_juice", "mnu_event_senate_04"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 4),
          (assign, ":event_juice", "mnu_event_senate_05"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 6),
          (assign, ":event_juice", "mnu_event_senate_06"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 7),
          (assign, ":event_juice", "mnu_event_senate_07"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 8),
          (assign, ":event_juice", "mnu_event_senate_08"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 9),
          (assign, ":event_juice", "mnu_event_senate_09"),
          (val_add, "$senate_events", 1),
        (else_try),
          (store_random_in_range, ":event_juice", "mnu_event_senate_01", "mnu_event_senate_end"),
        (try_end),

        (jump_to_menu, ":event_juice"),
        (finish_mission),
      (else_try),
        (jump_to_menu, "mnu_senatus"),
        (finish_mission),
      (try_end),
    ], "Door to the Senate"),

    ("imperial_gardens",[
      (eq, 0, 1),
    ],"Visit imperial gardens.",[
      #entry points:
      # 1 player
      # 2 - 6 berater
      # 7 - 10 berater in sitz position
      # 11 - 13 dancers and 38
      # 14 so ein typ der sich um die hofhaltung sorgt
      # 15 - 17 die typen von diplomacy
      # 18 minister
      # 19 die eigene ehefrau, in sitzposition
      #20 - 29 guards
      #30,31 minstrels
      #32 - 34 slaves
      #35 heir, if player has one
      #45 Avaritia
      (assign, "$temp4", 0),
      (set_jump_mission,"mt_palace"),
      (modify_visitors_at_site,"scn_imperial_garden"),
      (assign, "$talk_context", tc_court_talk),
      (reset_visitors),
      (try_begin),
        (this_or_next|key_is_down, key_left_shift),
        (key_is_down, key_right_shift),
        (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_palace", 0, 0),
          (mission_tpl_entry_set_override_flags, "mt_palace", 0, af_override_outfit_1|af_override_horse),
        (try_end),
        (set_visitor,0,"trp_player"),
      (else_try),
        (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_palace", 1, 0),
          (mission_tpl_entry_set_override_flags, "mt_palace", 1, af_override_outfit_1|af_override_horse),
        (try_end),
        (set_visitor,1,"trp_player"),
      (try_end),
      (set_visitor,2,"trp_greek_scholar"),
      (set_visitor,3,"trp_roman_scholar"),
      (set_visitor,4,"trp_military_adviser"),
      (set_visitor,5,"trp_financial_adviser"),
      (set_visitor,6,"trp_diplomatic_adviser"),
      (try_begin),
        (store_relation, ":faction_relation", "fac_kingdom_6", "fac_player_supporters_faction"),
        (ge, ":faction_relation", 0),
        (set_visitor,7,"trp_diplomat_parthia"),
      (try_end),
      (try_begin),
        (store_relation, ":faction_relation", "fac_kush", "fac_player_supporters_faction"),
        (ge, ":faction_relation", 0),
        (set_visitor,8,"trp_diplomat_eastern"),
      (try_end),
      (try_begin),
        (store_relation, ":faction_relation", "fac_garamantes", "fac_player_supporters_faction"),
        (ge, ":faction_relation", 0),
        (set_visitor,9,"trp_diplomat_africa"),
      (try_end),
      (set_visitor,10,"trp_diplomat_india"),
      (try_begin),
        (ge, "$g_heir_of_rome", 1),
        (set_visitor,35,"$g_heir_of_rome"),
      (try_end),
      (set_visitor,14,"trp_housholder"),
        (try_begin),
          (gt, "$g_player_chamberlain", 0),
          (call_script, "script_dplmc_appoint_chamberlain"),  #fix for wrong troops after update
          (set_visitor, 15, "$g_player_chamberlain"),
        (try_end),

        (try_begin),
          (gt, "$g_player_constable", 0),
          (call_script, "script_dplmc_appoint_constable"),  #fix for wrong troops after update
          (set_visitor, 16, "$g_player_constable"),
        (try_end),

        (try_begin),
          (gt, "$g_player_chancellor", 0),
          (call_script, "script_dplmc_appoint_chancellor"), #fix for wrong troops after update
          (set_visitor,17, "$g_player_chancellor"),
        (try_end),
      (try_begin),
        (eq, "$g_player_court", "$current_town"),
        (gt, "$g_player_minister", 0),
        (neg|troop_slot_eq, "trp_player", slot_troop_spouse, "$g_player_minister"),
            (set_visitor, 18, "$g_player_minister"),
      (try_end),
      (try_begin),
        (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
        (gt, ":player_spouse", 0),
        (assign, ":entry", 19),
        (store_random_in_range, ":r", 0, 10),
        (try_begin),
          (troop_slot_eq, ":player_spouse", slot_troop_bachus, 3),
          (troop_slot_eq, ":player_spouse", slot_lord_reputation_type, lrep_adventurous),
          (le, ":r", 5),
          (assign, ":entry", 36),
        (try_end),
        (set_visitor,":entry",":player_spouse"),
      (try_end),
      (set_visitor,20,"trp_praetoriani_milites"),
      (set_visitor,21,"trp_praetoriani_milites"),
      (set_visitor,22,"trp_praetoriani_milites"),
      (set_visitor,23,"trp_praetoriani_milites"),
      (set_visitor,24,"trp_praetoriani_milites"),
      (set_visitor,25,"trp_praetoriani_milites"),
      (set_visitor,26,"trp_praetoriani_milites"),
      (set_visitor,27,"trp_praetoriani_milites"),
      (set_visitor,28,"trp_praetoriani_milites"),
      (set_visitor,29,"trp_praetoriani_milites"),

      (set_visitor,30,"trp_tavern_minstrel_4"),
      (set_visitor,31,"trp_tavern_minstrel_3"),
      (set_visitor,32,"trp_slave"),
      (set_visitor,33,"trp_slave"),
      (set_visitor,34,"trp_slave"),

      (set_visitor,40,"trp_plinius_elder"),

      (try_begin),
        (gt, "$praefectus_urbani", -1),
        (set_visitor, 41, "$praefectus_urbani"),
      (try_end),

      (try_begin),
        (troop_slot_eq, "trp_avaritia", slot_troop_spouse, 4),
        (set_visitor,45,"trp_avaritia"),
      (try_end),
      (jump_to_scene, "scn_imperial_garden"),
      (change_screen_mission),
    ], "Enter the garden."),
    ("imperial_gardens",[
      (eq, 0, 1),
    ],"Visit the Triclinium.",[
      (jump_to_scene, "scn_imperial_dinning_room"),
      (change_screen_mission),
    ], "Enter the Triclinium."),
    ("visit_temple_jerusalem",[
		  (eq, 0, 1),
    ],"Visit the Temple of Hierosolyma.",[
      (set_passage_menu,"mnu_town"),
      (jump_to_menu, "mnu_temple_jerusalem"),
      (finish_mission),
    ], "Door to the Temple"),
    ("visit_dungen",[
      (eq, 0, 1),
    ],"Door to the catacombs.",[
      (set_passage_menu,"mnu_town"),
      (set_jump_mission, "mt_explore_secret_place"),
      (mission_tpl_entry_set_override_flags, "mt_explore_secret_place", 0, af_override_weapons|af_override_horse),
      (mission_tpl_entry_clear_override_items, "mt_explore_secret_place", 0),
      (mission_tpl_entry_add_override_item, "mt_explore_secret_place", 0, "itm_torch"),
      (set_jump_entry, 0),
      (jump_to_scene, "scn_church"),
      (change_screen_mission),
    ], "Door to the catacombs"),
    ("visit_garden_secret",[
      (eq, 0, 1),
    ],"Door to the stream.",[
      (set_passage_menu,"mnu_town"),
      (try_begin),
          (troop_slot_eq, "trp_global_variables", g_poppaea_event, 0),
          (neq, "$g_is_emperor", 1),#not caesar
          (troop_slot_eq, "trp_kingdom_7_lady_1", slot_troop_occupation, slto_kingdom_lady),#alive
          (troop_slot_eq, "trp_kingdom_7_lady_1", slot_troop_cur_center, "p_town_6"),#in Rome
          (troop_slot_eq, "trp_kingdom_7_lady_1", slot_troop_spouse, "trp_kingdom_7_lord"),# Neros spouse
          (store_faction_of_party, ":fac", "p_town_6"),
          (eq, ":fac", "fac_kingdom_7"),#Rome is ruled by Rome
          (jump_to_menu, "mnu_poppaea_event_1"),
          (finish_mission),
      (else_try),
          (display_message, "str_door_locked"),
      (try_end),
    ], "Door"),
    ("visit_labyrinth",[
		  (eq, 0, 1),
    ],"Enter the labyrinth.",[
      (set_passage_menu,"mnu_town"),
      (modify_visitors_at_site, "scn_labyrinth"),
      (reset_visitors),
      (set_jump_mission, "mt_minotau"),
      (display_message, "@Your companions are too scared and refuse to enter the cave."),
      (try_begin),
        (this_or_next|scene_slot_eq, "scn_labyrinth", slot_scene_visited, 1),
        (scene_slot_eq, "scn_labyrinth", slot_scene_visited, 0),
        (set_visitor, 1, "trp_minotau"),
      (try_end),
      (try_begin),
        (scene_slot_ge, "scn_labyrinth", slot_scene_visited, 1),
        (set_visitor, 2, "trp_player"),
      (else_try),
        (set_visitor, 0, "trp_player"),
      (try_end),
      (jump_to_scene, "scn_labyrinth"),
      (change_screen_mission),
    ], "Enter the labyrinth."),
    ("visit_lighthouse_alexandria",[
      (eq, "$current_town", "p_town_20"),
    ],"Walk on the top of the lighthouse.",[
      (set_passage_menu,"mnu_town"),

        (party_get_slot, ":town_scene", "$current_town", slot_town_center),
        (modify_visitors_at_site, ":town_scene"),
        (reset_visitors),
        (assign, "$g_mt_mode", tcm_default),
        (store_faction_of_party, ":town_faction","$current_town"),

        (try_begin),
          (neq, ":town_faction", "fac_player_supporters_faction"),
          (faction_get_slot, ":troop_prison_guard", "$g_encountered_party_faction", slot_faction_prison_guard_troop),
          (faction_get_slot, ":troop_castle_guard", "$g_encountered_party_faction", slot_faction_castle_guard_troop),
          (faction_get_slot, ":tier_2_troop", ":town_faction", slot_faction_tier_2_troop),
          (faction_get_slot, ":tier_3_troop", ":town_faction", slot_faction_tier_3_troop),
        (else_try),
          (party_get_slot, ":town_original_faction", "$current_town", slot_center_original_faction),
          (faction_get_slot, ":troop_prison_guard", ":town_original_faction", slot_faction_prison_guard_troop),
          (faction_get_slot, ":troop_castle_guard", ":town_original_faction", slot_faction_castle_guard_troop),
          (faction_get_slot, ":tier_2_troop", ":town_original_faction", slot_faction_tier_2_troop),
          (faction_get_slot, ":tier_3_troop", ":town_original_faction", slot_faction_tier_3_troop),
        (try_end),
        (try_begin), #think about this, should castle guard have to go nearby fire too? If he do not go, killing 2 armored guard is too hard for player. For now he goes too.
          #if guards have not gone to some other important happening at nearby villages, then spawn 4 guards. (example : fire)
          (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
          (store_current_hours, ":cur_time"),
          (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),

          (neg|is_between, ":cur_time", ":last_nearby_fire_time", ":fire_finish_time"),
          (set_visitor, 23, ":troop_castle_guard"),
        (try_end),
        (set_visitor, 24, ":troop_prison_guard"),

        (try_begin),
          (gt,":tier_2_troop", 0),
          (assign,reg0,":tier_3_troop"),
          (assign,reg1,":tier_3_troop"),
          (assign,reg2,":tier_2_troop"),
          (assign,reg3,":tier_2_troop"),
        (else_try),
          (assign,reg0,"trp_mercenary_swordsman"),
          (assign,reg1,"trp_mercenary_swordsman"),
          (assign,reg2,"trp_mercenary_swordsman"),
          (assign,reg3,"trp_mercenary_swordsman"),
        (try_end),
        (shuffle_range,0,4),

        (try_begin),
          #if guards have not gone to some other important happening at nearby villages, then spawn 4 guards. (example : fire)
          (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
          (store_current_hours, ":cur_time"),
          (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),

          (neg|is_between, ":cur_time", ":last_nearby_fire_time", ":fire_finish_time"),
          (set_visitor,25,reg0),
          (set_visitor,26,reg1),
          (set_visitor,27,reg2),
          (set_visitor,28,reg3),
        (try_end),
      (try_begin),
        (eq, "$current_town", "p_town_6"),
        (set_visitors, 50, "trp_merchant2", 1),
        (set_visitors, 51, "trp_merchant3", 1),
      (try_end),
        (party_get_slot, ":spawned_troop", "$current_town", slot_town_armorer),
        (set_visitor, 9, ":spawned_troop"),
        (party_get_slot, ":spawned_troop", "$current_town", slot_town_weaponsmith),
        (set_visitor, 10, ":spawned_troop"),
        (party_get_slot, ":spawned_troop", "$current_town", slot_town_elder),
        (set_visitor, 11, ":spawned_troop"),
        (party_get_slot, ":spawned_troop", "$current_town", slot_town_horse_merchant),
        (set_visitor, 12, ":spawned_troop"),
        (call_script, "script_init_town_walkers"),
        (set_jump_mission,"mt_town_center"),
        (assign, ":override_state", af_override_horse),
        (try_begin),
          (gt, "$sneaked_into_town", disguise_none), #setup disguise
          (assign, ":override_state", af_override_everything),
        (try_end),
        #SB : override disguise and set flags for entries
        (try_for_range, ":entry_no", 0, 8),
          (neq, ":entry_no", 1), #dckplmc: we want to ride our horses
          (mission_tpl_entry_set_override_flags, "mt_town_center", ":entry_no", ":override_state"),
          (call_script, "script_set_disguise_override_items", "mt_town_center", ":entry_no", 1),
        (try_end),

      (set_jump_entry, 13),
      #VC-2404
      (try_begin),
        (lt, "$sneaked_into_town", 1), #not sneaked
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_town_center", 13, 1),
        (mission_tpl_entry_set_override_flags, "mt_town_center", 13, af_override_outfit_1 | af_override_horse),
        (mission_tpl_entry_set_override_flags, "mt_town_center", 1, af_override_outfit_1 | af_override_horse),
      (try_end),
      (jump_to_scene, ":town_scene"),
      (change_screen_mission),
    ],"Visit the light house."),
    ("rest_of_rome",[
      (eq, 0, 1),
    ],"Back street.",[
      (assign, ":scene", "scn_town_romewalls"),
      (try_begin),
          (eq, "$current_town", "p_town_6"),
          (party_get_slot, ":event", "$current_town", slot_center_event),
          (is_between, ":event", event_fire_of_rome_timer, event_fire_of_rome+1),
          (assign, ":scene", "scn_town_romewalls_destroyed"),
      (try_end),

      (set_passage_menu,"mnu_town"),
      (modify_visitors_at_site, ":scene"),
      (reset_visitors),
      (assign, "$g_mt_mode", tcm_default),
      (store_faction_of_party, ":town_faction","$current_town"),

      (call_script, "script_spawn_companion", "$current_town", location_center_backstreets),
      (assign, ":companion", reg0),
      (try_begin),
          (is_between, ":companion", companions_begin, companions_end),
          (neg|main_party_has_troop, ":companion"),
          (troop_slot_eq, ":companion", slot_troop_occupation, 0),
          (set_visitor, 29, ":companion"),
      (try_end),

      (try_begin),
          (neq, ":town_faction", "fac_player_supporters_faction"),
          (faction_get_slot, ":tier_2_troop", ":town_faction", slot_faction_tier_2_troop),
          (faction_get_slot, ":tier_3_troop", ":town_faction", slot_faction_tier_3_troop),
      (else_try),
          (party_get_slot, ":town_original_faction", "$current_town", slot_center_original_faction),
          (faction_get_slot, ":tier_2_troop", ":town_original_faction", slot_faction_tier_2_troop),
          (faction_get_slot, ":tier_3_troop", ":town_original_faction", slot_faction_tier_3_troop),
      (try_end),

      (try_begin),
          (gt,":tier_2_troop", 0),
          (assign,reg0,":tier_3_troop"),
          (assign,reg1,":tier_3_troop"),
          (assign,reg2,":tier_2_troop"),
          (assign,reg3,":tier_2_troop"),
      (else_try),
          (assign,reg0,"trp_mercenary_swordsman"),
          (assign,reg1,"trp_mercenary_swordsman"),
          (assign,reg2,"trp_mercenary_swordsman"),
          (assign,reg3,"trp_mercenary_swordsman"),
      (try_end),
      (shuffle_range,0,4),

      (set_visitor,25,reg0),
      (set_visitor,26,reg1),
      (set_visitor,27,reg2),
      (set_visitor,28,reg3),

      (set_visitor,16,"trp_olivarius"),
      (try_begin),
          (neg|check_quest_active, "qst_wlodowiecus_adventure_4"),
          (neg|check_quest_active, "qst_wlodowiecus_adventure_3"),
          (neg|check_quest_active, "qst_wlodowiecus_adventure_2"),
          (quest_slot_eq, "qst_wlodowiecus_adventure_1", slot_quest_current_state, 6),
          (set_visitor,17,"trp_wlodowiecus"),
          (set_visitor,18,"trp_hadrianus"),
          (set_visitor,19,"trp_mancinellus"),
          (try_begin),
              (quest_slot_ge, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 10),
              (set_visitor, 41, "trp_alwisus"),
          (try_end),
          (try_begin),
              (quest_slot_ge, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 13),
              (set_visitor, 42, "trp_xiao"),
              (set_visitor, 43, "trp_phamanus"),
          (try_end),
      (try_end),

      (try_begin),
          (neg|check_quest_active, "qst_wlodowiecus_adventure_2"),
          (quest_slot_ge, "qst_wlodowiecus_adventure_2", slot_quest_current_state, 6),
          (set_visitor,20,"trp_yaaba"),
          (neg|check_quest_active, "qst_wlodowiecus_adventure_4"),
          (neg|check_quest_active, "qst_wlodowiecus_adventure_3"),
          (set_visitor,21,"trp_old_mercenary"),
          (try_begin),
              (neg|quest_slot_ge, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 10),
              (set_visitor,22,"trp_varus"),
          (try_end),
      (try_end),

      (set_visitors, 50, "trp_merchant2", 1),
      (set_visitors, 51, "trp_merchant3", 1),
      (party_get_slot, ":spawned_troop", "$current_town", slot_town_armorer),
      (set_visitor, 9, ":spawned_troop"),
      (party_get_slot, ":spawned_troop", "$current_town", slot_town_weaponsmith),
      (set_visitor, 10, ":spawned_troop"),
      (party_get_slot, ":spawned_troop", "$current_town", slot_town_elder),
      (set_visitor, 11, ":spawned_troop"),
      (party_get_slot, ":spawned_troop", "$current_town", slot_town_horse_merchant),
      (set_visitor, 12, ":spawned_troop"),
      (call_script, "script_init_town_walkers"),
      (set_jump_mission,"mt_town_center"),
      (assign, ":override_state", 0),

      (try_begin),
          (gt, "$sneaked_into_town", disguise_none), #setup disguise
          (assign, ":override_state", af_override_everything),
      (try_end),
      #SB : override disguise and set flags for entries
      (try_for_range, ":entry_no", 0, 8),
          (mission_tpl_entry_set_override_flags, "mt_town_center", ":entry_no", ":override_state"),
          (call_script, "script_set_disguise_override_items", "mt_town_center", ":entry_no", 1),
      (try_end),
      (set_jump_entry, 1),
      #VC-2404
      (try_begin),
          (lt, "$sneaked_into_town", 1), #not sneaked
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_town_center", 1, 1),
          (mission_tpl_entry_set_override_flags, "mt_town_center", 1, af_override_outfit_1 | af_override_horse),
      (try_end),
      (jump_to_scene, ":scene"),
      (change_screen_mission),
    ],"Follow the street."),

    ("imperial_bedroom",[
      (eq, 0, 1),
    ],"Visit the Bedroom.",[
      (try_begin),
          (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
          (party_slot_eq, "$g_encountered_party", slot_town_lord, "trp_player"),
          (assign, "$g_belligerent_drunk_leaving", -1),
          (modify_visitors_at_site, "scn_imperial_bed_room"),
          (reset_visitors),
          (set_jump_mission, "mt_visit_bedroom"),
          (try_begin),#second outift
              (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
              (call_script, "script_init_second_outfit", "mt_visit_bedroom", 0, 0),
              (mission_tpl_entry_set_override_flags, "mt_visit_bedroom", 0, af_override_outfit_1|af_override_horse),
          (try_end),
          (set_visitor, 0, "trp_player"),
          (try_begin),
              (troop_get_slot, ":spouse","trp_player", slot_troop_spouse),
              (gt, ":spouse", -1),
              (troop_slot_ge, ":spouse", slot_troop_player_relation, 5),
              (set_visitor, 1, ":spouse"),
          (try_end),
          (set_visitor, 3, "trp_courtier_crispinilla"),
          (set_visitor, 4, "trp_courtier_locusta"),
          (jump_to_scene, "scn_imperial_bed_room"),
          (change_screen_mission),
      (else_try),
          (display_message, "str_door_locked"),
      (try_end),
    ], "Enter the Bedroom."),
    ("parthian_palace_garden",[
      (eq, 0, 1),
    ],"Visit the Garden.",[
      (try_begin),
          (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
          (modify_visitors_at_site, "scn_parthian_palace_garden"),
          (reset_visitors),
          (set_jump_mission, "mt_parthian_palace_garden"),

          (try_begin),#second outift
              (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
              (call_script, "script_init_second_outfit", "mt_parthian_palace_garden", 0, 0),
              (mission_tpl_entry_set_override_flags, "mt_parthian_palace_garden", 0, af_override_outfit_1|af_override_horse),
          (try_end),
          (set_visitor, 0, "trp_player"),

          (set_visitor, 7,"trp_tavern_minstrel_2"),
          (set_visitor, 8,"trp_tavern_minstrel_3"),
          (set_visitor, 9,"trp_tavern_minstrel_4"),

          (jump_to_scene, "scn_parthian_palace_garden"),
          (change_screen_mission),
      (else_try),
          (display_message, "str_door_locked"),
      (try_end),
    ],"Enter the Garden."),
    ("augustas_bedroom",[
      (eq, 0, 1),
    ],"Visit Augusta's bedroom.",[
      (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
      (try_begin),
          (party_slot_eq, "$g_encountered_party", slot_town_lord, "trp_player"),
          (this_or_next|eq, ":spouse", -1),
          (troop_slot_ge, ":spouse", slot_troop_player_relation, -25),
          (modify_visitors_at_site, "scn_imperial_palace_augusta_room"),
          (reset_visitors),
          (set_jump_mission, "mt_visit_bedroom_augusta"),
          (try_begin),#second outift
              (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
              (call_script, "script_init_second_outfit", "mt_visit_bedroom_augusta", 0, 0),
              (mission_tpl_entry_set_override_flags, "mt_visit_bedroom_augusta", 0, af_override_outfit_1|af_override_horse),
          (try_end),
          (set_visitor, 0, "trp_player"),
          (try_begin),
              (troop_get_slot, ":spouse","trp_player", slot_troop_spouse),
              (gt, ":spouse", -1),
              (set_visitor, 1, ":spouse"),
          (try_end),
          (jump_to_scene, "scn_imperial_palace_augusta_room"),
          (change_screen_mission),
      (else_try),
          (gt, ":spouse", -1),
          (display_message, "@Your spouse does not allow you to enter"),
          (display_message, "str_door_locked"),
      (else_try),
          (display_message, "str_door_locked"),
      (try_end),
    ], "Visit Augusta's bedroom."),
    ("gardens_of_manacea",[
      (eq, 0, 1),
    ],"Visit Gardens of Maecenas.",[
      (lt, "$sneaked_into_town", 1), #not sneaked
      (try_begin),
          (eq, "$g_encountered_party", "p_town_6"),
          (check_quest_active, "qst_nero_special_quest"),
          (quest_slot_eq, "qst_nero_special_quest", slot_quest_target_dna, 0),
          (is_currently_night),
          (jump_to_menu, "mnu_gardens_of_maecenas_1"),
          (finish_mission),
      (else_try),
          (jump_to_scene, "scn_gardens_of_manacea"),
          (change_screen_mission),
          # 0 player
          # 1 to 20 are walkers,
          # 21 to 45 are sitting low
          # 45 to 50 are sitting high

          (modify_visitors_at_site, "scn_gardens_of_manacea"),
          (reset_visitors),
          (set_jump_mission, "mt_gardens_of_maceneas"),
          (set_visitor, 0, "trp_player"),
          (try_for_range, ":entry", 1, 21),
              (store_random_in_range, ":walker", "trp_roman_town_walker", "trp_celtic_town_walker"),
              (set_visitor, ":entry", ":walker"),
          (try_end),
          (try_for_range, ":entry", 21, 51),
              (store_random_in_range, ":sitting_low", "trp_guest", "trp_roman_priest_female"),
              (set_visitor, ":entry", ":sitting_low"),
          (try_end),
          (jump_to_scene, "scn_gardens_of_manacea"),
          (change_screen_mission),
      (try_end),
    ], "Visit the gardens of Maecenas."),
    ("visit_akademia",[
      (eq, "$current_town", "p_town_37"),
      (lt, "$sneaked_into_town", 1), #not sneaked
    ],"Visit the Akademeia.",[
      (try_begin),
        (troop_slot_eq, "trp_director_akademia", slot_troop_wealth, 0),
        (jump_to_menu, "mnu_akademeia"),
      (else_try),
        #1,2 player
        #3 guy
        #4-16 sitting
        #17-20 standing
        #21 guy during lecture
        #22-27 sitting lecture
        #50-55 musicians
        #60-65 belly dancers
        #60-70 acorbats
        (modify_visitors_at_site, "scn_akademia"),
        (reset_visitors),
        (set_jump_mission, "mt_library"),
        (try_for_range, ":index", 4, 17),
          (set_visitor, ":index", "trp_guest_sitting"),
        (try_end),

        (try_for_range, ":index", 17, 20),
          (set_visitor, ":index", "trp_guest"),
        (try_end),
        (try_begin),
          (scene_slot_eq, "scn_akademia", slot_scene_visited, 0),
          (try_begin),#second outift
            (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
            (call_script, "script_init_second_outfit", "mt_library", 1, 0),
            (mission_tpl_entry_set_override_flags, "mt_library", 1, af_override_outfit_1|af_override_horse),
          (try_end),
          (set_visitor, 1, "trp_player"),
        (else_try),
          (try_begin),#second outift
            (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
            (call_script, "script_init_second_outfit", "mt_library", 2, 0),
            (mission_tpl_entry_set_override_flags, "mt_library", 2, af_override_outfit_1|af_override_horse),
          (try_end),
          (set_visitor, 2, "trp_player"),
        (try_end),
        (set_visitor, 3, "trp_director_akademia"),
        (jump_to_scene, "scn_akademia"),
        (change_screen_mission),
      (try_end),
    ]),
    ("collect_taxes_qst",[
      (eq, 0, 1),
    ],"Unused",[
    ], "Unused"),
    ("villa",[
      (eq,"$current_town","p_town_34"),
	    (troop_slot_eq, "trp_global_variables", g_player_villa, 2),
    ],"Visit the 'Domus Mare'.",[
		  (jump_to_menu, "mnu_villa")
    ]),
    ("recruit_volunteers_castle",[
      (eq, 1, 0),
    ],"Unused",[
    ],"Unused"),
    ("recruit_legions", [
      (ge, "$g_encountered_party_relation", 0),
      (eq, "$players_kingdom", "$g_encountered_party_faction"),
    ],"Recruit troops.",[
      (jump_to_menu, "mnu_barracks"),
    ]),
		("set_sail",[
      (eq, 1, 0),
    ],"Unused",[
		],"Unused"),
    ("visit_jerusalem_temple",[
      (eq, "$current_town", "p_town_19"),
      (eq, "$templelooted", 0),
    ],"Visit the great jewish temple.",[
      (try_begin),
          (check_quest_active, "qst_poking_the_lion"),
          (quest_slot_eq, "qst_poking_the_lion", slot_quest_current_state, 3),
          (jump_to_menu, "mnu_temple_jerusalem_story_decide"),
      (else_try),
          (jump_to_menu, "mnu_temple_jerusalem"),
      (try_end),
    ]),
    ("visit_gaius_villae",[
      (check_quest_active, "qst_nero_special_quest"),
      (quest_slot_eq, "qst_nero_special_quest", slot_quest_target_dna, 2),
      (quest_slot_eq, "qst_nero_special_quest", slot_quest_current_state, 1),
      (eq, "$current_town", "p_town_34"),
    ],"Visit Gaius Petronius villa.",[
      (jump_to_menu, "mnu_gaius_villa"),
    ]),
    ("visit_gaius_villae",[
      (check_quest_active, "qst_amor_quest"),
      (quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 1),
      (eq, "$current_town", "p_town_34"),
    ],"Visit 'Biggus Dickus' villa.",[
      (jump_to_menu, "mnu_biggus_dickus_villa"),
    ]),
    ("visit_gaius_villae",[
      (check_quest_active, "qst_amor_quest"),
      (this_or_next|quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 9),
      (this_or_next|quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 7),
      (this_or_next|quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 2),
      (quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 3),
      (eq, "$current_town", "p_town_3"),
    ],"Visit Desperatius villa.",[
      (try_begin),
        (this_or_next|quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 9),
        (this_or_next|quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 7),
        (quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 3),
        (call_script, "script_setup_troop_meeting", "trp_desperatius", -1, "scn_castle_1_interior"),
      (else_try),
        (jump_to_menu, "mnu_desperatius_villa"),
      (try_end),
    ]),
    ("visit_library_alexandria",[
      (lt, "$sneaked_into_town", 1), #not sneaked
      (eq, "$enlisted_party", -1),#not freelancing
      (eq, "$current_town", "p_town_20"),
    ],"Visit the Mouseion.",[
      (jump_to_menu, "mnu_library_alexandria"),
    ]),
    ("visit_golgotha",[
      (eq, "$current_town", "p_town_19"),
    ],"Visit Golgotha.",[
      (try_begin),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_christus),
          (troop_slot_eq, "trp_global_variables", g_player_visit_golgotha, 0),
          (jump_to_menu, "mnu_golgotha"),
      (else_try),
          (set_jump_mission, "mt_explore_secret_place"),
          (set_jump_entry, 0),
          (jump_to_scene, "scn_mount_golgotha"),
          (change_screen_mission),
      (try_end),
    ]),
    ("visit_alexanders_tomb",[
      (eq, "$current_town", "p_town_20"),
    ],"Visit the tomb of Megas Alexandros.",[
      (set_jump_mission, "mt_explore_secret_place"),
      (modify_visitors_at_site, "scn_alexanders_tomb"),
      (reset_visitors),
      (set_jump_entry, 0),
      (try_begin),
          (check_quest_active, "qst_four_emperors"),
          (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 6),

          (mission_tpl_entry_set_override_flags, "mt_explore_secret_place", 1, af_override_everything),
          (mission_tpl_entry_clear_override_items, "mt_explore_secret_place", 1),
          (mission_tpl_entry_add_override_item, "mt_explore_secret_place", 1, "itm_caligea"),
          (mission_tpl_entry_add_override_item, "mt_explore_secret_place", 1, "itm_roman_lupa_dress_2"),
          (mission_tpl_entry_add_override_item, "mt_explore_secret_place", 1, "itm_cloak_4"),

          (set_visitor, 1, "trp_antonia"),

          (quest_get_slot, "$temp", "qst_four_emperors", slot_quest_target_troop),
          (set_visitor, 2, "$temp"),
          (neq, "$temp", "trp_legatus_11"),
          (set_visitor, 3, "trp_legatus_12"),
      (try_end),
      (jump_to_scene, "scn_alexanders_tomb"),
      (change_screen_mission),
    ]),
    ("visit_latrina",[
      (eq, 0, 1),
      (eq, "$current_town", "p_town_6"),
    ],"Enter the Latrinae.",[
      (set_jump_mission, "mt_toiletboys"),
      (modify_visitors_at_site, "scn_roman_latrina"),
      (reset_visitors),

      (mission_tpl_entry_set_override_flags, "mt_toiletboys", 0, af_override_horse),
      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_toiletboys", 0, 0),
        (mission_tpl_entry_set_override_flags, "mt_toiletboys", 0, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 0, "trp_player"),

      (set_visitor, 1, "trp_romanian"),
      (set_visitor, 2, "trp_spaniard"),
      (set_visitor, 3, "trp_dominican"),

      (jump_to_scene, "scn_roman_latrina"),
      (change_screen_mission),
    ], "Enter the Latrinae."),
    ("visit_christian_chapel",[
      (eq, 0, 1),
    ],"Door to the chapel.",[
      (set_passage_menu,"mnu_town"),
      (try_begin),
        (neg|troop_slot_eq, "trp_player", slot_troop_religion, worships_christus),
        (display_message, "str_door_locked"),
      (else_try),
        (call_script, "script_enter_secret_christian_church", 1),
      (try_end),
    ], "Door."),
    ("visit_temples",[
      (eq, "$current_town", "p_town_6"),
    ],"Visit the sights of Rome.",[
      (jump_to_menu, "mnu_temples"),
    ]),
    ("town_action",[],"Take an action.",[
      (jump_to_menu, "mnu_town_action"),
    ]),
    ("town_leave",[],"Leave...",[
      (assign, "$g_permitted_to_center",0),
      (try_begin),
          (le, "$sneaked_into_town", disguise_none), #SB : disable while disguised
          (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
          (call_script, "script_dplmc_initialize_autoloot", 0),#argument "0" means this does nothing if deemed unnecessary
          (try_begin),
              (eq, "$g_dplmc_buy_food_when_leaving", 1),
              (party_get_slot, ":merchant_troop", "$current_town", slot_town_merchant),
              (gt, ":merchant_troop", 0),
              (try_begin),# use follower party to buy food if player has one
                  (store_party_size_wo_prisoners,":size", "p_follower_party"),
                  (gt, ":size", 0),
                  (assign, reg48, "trp_follower_party_mules"),
              (else_try),
                  (assign, reg48, "trp_player"),
              (try_end),
              (call_script, "script_dplmc_auto_buy_food", reg48, ":merchant_troop", 0, "trp_player"),
          (try_end),
          (try_begin),
              (party_slot_eq, "$current_town", slot_party_type, spt_town),#is town
              (eq, "$g_dplmc_sell_items_when_leaving", 1),
              (call_script, "script_dplmc_player_auto_sell_at_center", "$current_town"),
          (try_end),
      (try_end),
      (change_screen_map, 0),
    ],"Leave Area."),
    ("town_cheat", [
      (ge, "$cheat_mode", 1),
    ],"Use cheats.",[
      (jump_to_menu, "mnu_town_cheats"),
    ]),
]),

("cannot_enter_court_treason",0,
  "You are not allowed to enter. It is most likely due to the secret trial that is currently held against you.",
  "none",
  [
    (set_background_mesh, "mesh_pic_mb_warrior_3"),
  ],[
    ("continue", [],"Continue",
    [
      (jump_to_menu, "mnu_town"),
    ]),
]),

("cannot_enter_court",0,
  "There is a feast in progress in the lord's hall, but you are not of sufficient status to be invited inside. Perhaps increasing your renown would win you admittance -- or you might also try distinguishing yourself at the games while the feast is in progress...",
  "none",
  [
    (set_background_mesh, "mesh_pic_girls"),
  ],[
    ("continue", [],"Continue",
    [
      (jump_to_menu, "mnu_town"),
    ]),
]),

# ("lady_visit",0,
#   "Whom do you wish to visit?",
#   "none",[
#     (set_background_mesh, "mesh_pic_palast"),
#   ],[
#     ("visit_lady_1", [
#       (gt, "$love_interest_in_town", 0),
#       (str_store_troop_name, s12, "$love_interest_in_town"),
#     ],"Visit {s12}",[
#       (assign, "$love_interest_in_town", "$love_interest_in_town"),
#       (jump_to_menu, "mnu_garden"),
#     ]),
#     ("visit_lady_2", [
#       (gt, "$love_interest_in_town_2", 0),
#       (str_store_troop_name, s12, "$love_interest_in_town_2"),
#     ],"Visit {s12}",[
#       (assign, "$love_interest_in_town", "$love_interest_in_town_2"),
#       (jump_to_menu, "mnu_garden"),
#     ]),
#     ("visit_lady_3", [
#       (gt, "$love_interest_in_town_3", 0),
#       (str_store_troop_name, s12, "$love_interest_in_town_3"),
#     ],"Visit {s12}",[
#       (assign, "$love_interest_in_town", "$love_interest_in_town_3"),
#       (jump_to_menu, "mnu_garden")
#     ]),
#     ("visit_lady_4", [
#       (gt, "$love_interest_in_town_4", 0),
#       (str_store_troop_name, s12, "$love_interest_in_town_4"),
#     ],"Visit {s12}",[
#       (assign, "$love_interest_in_town", "$love_interest_in_town_4"),(jump_to_menu, "mnu_garden"),
#     ]),
#     ("visit_lady_5", [
#       (gt, "$love_interest_in_town_5", 0),(str_store_troop_name, s12, "$love_interest_in_town_5"),
#     ],"Visit {s12}",[
#       (assign, "$love_interest_in_town", "$love_interest_in_town_5"),(jump_to_menu, "mnu_garden"),
#     ]),
#     ("visit_lady_6",[
#       (gt, "$love_interest_in_town_6", 0),(str_store_troop_name, s12, "$love_interest_in_town_6"),
#     ],"Visit {s12}",[
#       (assign, "$love_interest_in_town", "$love_interest_in_town_6"),(jump_to_menu, "mnu_garden"),
#     ]),
#     ("visit_lady_7",[
#       (gt, "$love_interest_in_town_7", 0),(str_store_troop_name, s12, "$love_interest_in_town_7"),
#     ],"Visit {s12}",[
#       (assign, "$love_interest_in_town", "$love_interest_in_town_7"),(jump_to_menu, "mnu_garden"),
#     ]),
#     ("visit_lady_8",[
#       (gt, "$love_interest_in_town_8", 0),(str_store_troop_name, s12, "$love_interest_in_town_8"),
#     ],"Visit {s12}",[
#       (assign, "$love_interest_in_town", "$love_interest_in_town_8"),(jump_to_menu, "mnu_garden"),
#     ]),
#     ("leave",[], "Leave",[(
#       jump_to_menu, "mnu_town"),
#     ]),
# ]),

("town_tournament_lost",0,
  "You have been eliminated from the games.{s8}",
  "none",[
    (set_background_mesh, "mesh_pic_gladiator"),
    (str_clear, s8),
    (try_begin),
      (this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
      (neg|troop_slot_ge, "trp_player", slot_troop_renown, 50),
      (neg|troop_slot_ge, "trp_player", slot_troop_renown, 125),
      (gt, "$g_player_tournament_placement", 4),
      (faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_state, sfai_feast),
      (faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_object, "$g_encountered_party"),
      (str_store_string, s8, "str__however_you_have_sufficiently_distinguished_yourself_to_be_invited_to_attend_the_ongoing_feast_in_the_lords_castle"),
    (try_end),
  ],[
    ("continue", [], "Continue...",[
      (jump_to_menu, "mnu_town_tournament_won_by_another"),
    ]),
]),

("town_tournament_won",mnf_disable_all_keys,
  "You have won the great game of {s3}! You are filled with pride as the crowd cheers your name."
  +" In addition to honour, fame and glory, you earn a prize of {reg9} denars, as well as one mystery prize. {s8}",
  "none",[
    (str_store_party_name, s3, "$current_town"),
    (call_script, "script_change_troop_renown", "trp_player", 20),
    (call_script, "script_change_player_relation_with_center", "$current_town", 1),
    # (assign, reg9, 200),
    # (add_xp_to_troop, 250, "trp_player"),
    (assign, reg9, 1000),
    (add_xp_to_troop, 250, "trp_player"),
    (troop_add_gold, "trp_player", reg9),
    (str_clear, s8),
    (store_add, ":total_win", "$g_tournament_bet_placed", "$g_tournament_bet_win_amount"),
    (try_begin),
      (gt, "$g_tournament_bet_win_amount", 0),
      (assign, reg8, ":total_win"),
      (str_store_string, s8, "@Moreover, you earn {reg8} denars from the clever bets you placed on yourself..."),
    (try_end),
		(try_begin),
			(this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
            (neg|troop_slot_ge, "trp_player", slot_troop_renown, 70),
			(neg|troop_slot_ge, "trp_player", slot_troop_renown, 145),

			(faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_state, sfai_feast),
			(faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_object, "$g_encountered_party"),
			(str_store_string, s8, "str_s8_you_are_also_invited_to_attend_the_ongoing_feast_in_the_castle"),
		(try_end),
    (troop_add_gold, "trp_player", ":total_win"),
    (assign, ":player_odds_sub", 0),
    (store_div, ":player_odds_sub", "$g_tournament_bet_win_amount", 5),
    (party_get_slot, ":player_odds", "$current_town", slot_town_player_odds),
    (val_sub, ":player_odds", ":player_odds_sub"),
    (val_max, ":player_odds", 250),

    (party_set_slot, "$current_town", slot_town_player_odds, ":player_odds"),
    (call_script, "script_play_victorious_sound"),
    #SB : stop arena loop sound if it leaks here
    (stop_all_sounds, 1),
    #also add background
    (set_background_mesh, "mesh_pic_payment"),
    #also gives bonus faction morale
    (call_script, "script_change_faction_troop_morale", "$g_encountered_party_faction", ":player_odds", 1),
  ],[
    ("continue", [], "Collect your prize...",[
      (jump_to_menu, "mnu_town"),
      (call_script, "script_get_random_tournament_prize"),
      (change_screen_loot, "trp_temp_troop"),
    ]),
]),

("town_tournament_won_by_another",mnf_disable_all_keys,
  "As the only {reg3?fighter:man} to remain undefeated this day, {s1} wins the lists and the glory of this game.",
  "none",[
    (call_script, "script_get_num_tournament_participants"),
    (store_sub, ":needed_to_remove_randomly", reg0, 1),
    (try_begin),
      (troop_slot_eq, "trp_tournament_participants", 0, 0), #delete player from the participants
      (troop_set_slot, "trp_tournament_participants", 0, -1),
      (val_sub, ":needed_to_remove_randomly", 1),
    (try_end),
    (call_script, "script_remove_tournament_participants_randomly", ":needed_to_remove_randomly"),
    (call_script, "script_sort_tournament_participant_troops"),
    (troop_get_slot, ":winner_troop", "trp_tournament_participants", 0),
    (str_store_troop_name, s1, ":winner_troop"),
    (try_begin),
      (troop_is_hero, ":winner_troop"),
      (call_script, "script_change_troop_renown", ":winner_troop", 20),
    (try_end),
    ##diplomacy start+ use script for gender
    #(troop_get_type, reg3, ":winner_troop"),#<- OLD
		(call_script, "script_dplmc_store_troop_is_female_reg", ":winner_troop", 3),
    ##diplomacy end+
    #SB : stop arena sound if it leaks here
    (stop_all_sounds, 0),
    (set_background_mesh, "mesh_pic_girls"),
  ],[
    ("continue", [], "Continue...",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

("town_race_won_by_another",mnf_disable_all_keys,
  "As the only {reg3?fighter:man} to remain undefeated this day, {s1} wins the race.",
  "none",
    [
      # (call_script, "script_get_num_tournament_participants"),
      # (store_sub, ":needed_to_remove_randomly", reg0, 1),
      # (try_begin),
        # (troop_slot_eq, "trp_tournament_participants", 0, 0), #delete player from the participants
        # (troop_set_slot, "trp_tournament_participants", 0, -1),
        # (val_sub, ":needed_to_remove_randomly", 1),
      # (try_end),
        # (call_script, "script_remove_tournament_participants_randomly", ":needed_to_remove_randomly"),
        # (call_script, "script_sort_tournament_participant_troops"),
        # (troop_get_slot, ":winner_troop", "trp_tournament_participants", 0),
        (str_store_troop_name, s1, "$g_tournament_player_team_won"),
        (try_begin),
          (troop_is_hero, "$g_tournament_player_team_won"),
          (call_script, "script_change_troop_renown", "$g_tournament_player_team_won", 20),
        (try_end),
		  ##diplomacy start+ use script for gender
        #(troop_get_type, reg3, ":winner_troop"),#<- OLD
	    	(call_script, "script_dplmc_store_troop_is_female_reg", "$g_tournament_player_team_won", 3),
		  ##diplomacy end+
        #SB : stop arena sound if it leaks here
        (stop_all_sounds, 0),
        (set_background_mesh, "mesh_pic_girls"),
        ],
    [
      ("continue", [], "Continue...",
       [(jump_to_menu, "mnu_town"),
        ]),
    ]
  ),

("town_tournament",mnf_enable_hot_keys,
  "{s1}You are at tier {reg0} of the games, with {reg1} participants remaining. In the next round, there will be {reg2} teams with {reg3} {reg4?fighters:fighter} each.",
  "none",[
	  (set_background_mesh, "mesh_pic_gladiator"),
    (party_set_slot, "$current_town", slot_town_has_tournament, 0), #No way to return back if this menu is left
    (call_script, "script_sort_tournament_participant_troops"),#Moving trp_player to the top of the list
    (call_script, "script_get_num_tournament_participants"),
    (assign, ":num_participants", reg0),
    (try_begin),
      (neg|troop_slot_eq, "trp_tournament_participants", 0, 0),#Player is defeated

      (assign, ":player_odds_add", 0),
      (store_div, ":player_odds_add", "$g_tournament_bet_placed", 5),
      (party_get_slot, ":player_odds", "$current_town", slot_town_player_odds),
      (val_add, ":player_odds", ":player_odds_add"),
      (val_min, ":player_odds", 4000),
      (party_set_slot, "$current_town", slot_town_player_odds, ":player_odds"),

      (jump_to_menu, "mnu_town_tournament_lost"),
    (else_try),
      (eq, ":num_participants", 1),#Tournament won
      (jump_to_menu, "mnu_town_tournament_won"),
    (else_try),
      (try_begin),
        (le, "$g_tournament_next_num_teams", 0),
        (call_script, "script_get_random_tournament_team_amount_and_size"),
        (assign, "$g_tournament_next_num_teams", reg0),
        (assign, "$g_tournament_next_team_size", reg1),
      (try_end),
      (assign, reg2, "$g_tournament_next_num_teams"),
      (assign, reg3, "$g_tournament_next_team_size"),
      (store_sub, reg4, reg3, 1),
      (str_clear, s1),
      (try_begin),
        (eq, "$g_tournament_player_team_won", 1),
        (str_store_string, s1, "@Victory is yours! You have won this melee, but now you must prepare yourself for the next round. "),
      (else_try),
        (eq, "$g_tournament_player_team_won", 0),
        (str_store_string, s1, "@You have been bested in this melee, but the master of ceremonies declares a recognition of your skill and bravery, allowing you to take part in the next round. "),
      (try_end),
      (assign, reg1, ":num_participants"),
      (store_add, reg0, "$g_tournament_cur_tier", 1),
    (try_end),
  ],[
    ("host_tournament",[
        (ge, "$cheat_mode", 1),
    ],"{!}Cheat : Win games",[
      (jump_to_menu, "mnu_town_tournament_won"),
      (assign, "$g_player_eligible_feast_center_no", "$current_town"),
      (assign, "$g_player_tournament_placement", 100),
    ]),
    ("tournament_view_participants", [], "View participants.",[
      (jump_to_menu, "mnu_tournament_participants"),
    ]),
    ("tournament_bet", [
      (neq, "$g_tournament_cur_tier", "$g_tournament_last_bet_tier")
    ], "Place a bet on yourself.",[
      (jump_to_menu, "mnu_tournament_bet"),
    ]),
    ("tournament_join_next_fight", [], "Fight in the next round.",[
      (party_get_slot, ":arena_scene", "$current_town", slot_town_arena),
      (modify_visitors_at_site, ":arena_scene"),
      (reset_visitors),

      (call_script, "script_spawn_specators"),

      (try_begin),
        (eq, "$current_town", "p_town_6"),
        (assign, ":c", 0),
        (party_collect_attachments_to_party, "$current_town", "p_temp_party"),
        (party_get_num_companion_stacks, ":num_stacks", "p_temp_party"),
        (try_for_range, ":stack_no", 0, ":num_stacks"),
          (party_stack_get_troop_id, ":cur_troop", "p_temp_party", ":stack_no"),
          (eq, ":cur_troop", "trp_kingdom_7_lord"),##no, nero doesnt fight he watches the game
          (troop_is_hero, ":cur_troop"),
          (assign, ":c", 1),
        (try_end),
        (eq, ":c", 1),
        (troop_get_slot, ":spouse", "trp_kingdom_7_lord", slot_troop_spouse),
        (ge, ":spouse", 1),
        (str_store_troop_name, s40, "trp_kingdom_7_lord"),
        (str_store_troop_name, s41, ":spouse"),
        (display_message, "@{s40} and {s41} are watching the game!"),
        (set_visitor, 58, "trp_kingdom_7_lord"),
        (set_visitor, 59, ":spouse"),
      (try_end),
      #Assuming that there are enough participants for the teams
      (assign, "$g_player_tournament_placement", "$g_tournament_cur_tier"),
      (try_begin),
          (gt, "$g_player_tournament_placement", 4),
          (assign, "$g_player_eligible_feast_center_no", "$current_town"),
      (try_end),
      (val_add, "$g_tournament_cur_tier", 1),

      (store_mul, "$g_tournament_num_participants_for_fight", "$g_tournament_next_num_teams", "$g_tournament_next_team_size"),
      (troop_set_slot, "trp_tournament_participants", 0, -1),#Removing trp_player from the list
      (troop_set_slot, "trp_temp_array_a", 0, "trp_player"),
      (try_for_range, ":slot_no", 1, "$g_tournament_num_participants_for_fight"),
          (call_script, "script_get_random_tournament_participant"),
          (troop_set_slot, "trp_temp_array_a", ":slot_no", reg0),
      (try_end),
      (call_script, "script_shuffle_troop_slots", "trp_temp_array_a", 0, "$g_tournament_num_participants_for_fight"),

      (try_for_range, ":slot_no", 0, 4),#shuffle teams
          (troop_set_slot, "trp_temp_array_b", ":slot_no", ":slot_no"),
      (try_end),
      (call_script, "script_shuffle_troop_slots", "trp_temp_array_b", 0, 4),

      (assign, ":cur_slot", 0),
      (assign, ":player_slot", -1), #SB : find player's slot
      (try_for_range, ":cur_team_offset", 0, "$g_tournament_next_num_teams"),
          (troop_get_slot, ":cur_team", "trp_temp_array_b", ":cur_team_offset"),

          (try_for_range, ":slot_no", 0, 8),#shuffle entry_points
              (troop_set_slot, "trp_temp_array_c", ":slot_no", ":slot_no"),
          (try_end),
          (call_script, "script_shuffle_troop_slots", "trp_temp_array_c", 0, 8),

          (try_for_range, ":cur_index", 0, "$g_tournament_next_team_size"),
              (store_mul, ":cur_entry_point", ":cur_team", 8),
              (troop_get_slot, ":entry_offset", "trp_temp_array_c", ":cur_index"),
              (val_add, ":cur_entry_point", ":entry_offset"),
              (troop_get_slot, ":troop_no", "trp_temp_array_a", ":cur_slot"),
              (set_visitor, ":cur_entry_point", ":troop_no"),
              (try_begin), #SB : set player's slot
                  (eq, ":troop_no", "trp_player"),
                  (assign, ":player_slot", ":cur_entry_point"),
              (try_end),
              (val_add, ":cur_slot", 1),
          (try_end),
      (try_end),

      (assign, "$g_tournament_next_num_teams", 0),
      (assign, "$g_tournament_next_team_size", 0),

      (assign, "$g_mt_mode", abm_tournament),
      #SB : pass on as global
      (try_begin),
          (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", "$g_encountered_party_faction"),
          (this_or_next|ge, reg0, DPLMC_FACTION_STANDING_MEMBER),
          (party_slot_ge, "$current_town", slot_center_player_relation, 15),
          (assign, "$g_player_entry_point", ":player_slot"),
      (else_try),
          (assign, "$g_player_entry_point", -1),
      (try_end),

      ##either fight as gladiators or use the own equipment
      (try_begin),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_7"),
          (set_jump_mission, "mt_arena_melee_fight"),
          (call_script, "script_set_items_for_tournament"),
      (else_try),
          (set_jump_mission, "mt_arena_melee_fight_barbarian"),
      (try_end),
      (jump_to_scene, ":arena_scene"),
      (change_screen_mission),
    ]),
    ("leave_tournament",[
      (this_or_next|neq, "$g_is_emperor", 1),
      (neg|faction_slot_eq, "$g_encountered_party_faction", slot_faction_leader, "trp_player"),
    ],"Withdraw from the competition.",[
      (jump_to_menu, "mnu_tournament_withdraw_verify"),
    ]),
    ("watch",[
      (eq, "$g_is_emperor", 1),
      (faction_slot_eq, "$g_encountered_party_faction", slot_faction_leader, "trp_player"),
    ],"As Caesar Augustus, I watch the game.",[
      (jump_to_menu, "mnu_tournament_watch"),
    ]),
]),

  (
    "tournament_withdraw_verify",0,
    "Are you sure you want to withdraw from the games?",
    "none",
    [],
    [
      ("tournament_withdraw_yes", [], "Yes. This is a pointless affectation.",
       [(jump_to_menu, "mnu_town_tournament_won_by_another"),
        ]),
      ("tournament_withdraw_no", [], "No, not as long as there is a chance of victory!",
       [(jump_to_menu, "mnu_town_tournament"),
        ]),
    ]
  ),
  (
    "tournament_watch",0,
    "Are you sure you want to only watch the competition?",
    "none",
    [],
    [
      ("tournament_withdraw_yes", [], "Yes. I am Imperator Caesar Augustus. Not a common gladiator.",
       [(jump_to_menu, "mnu_town_tournament_won_by_another"),
	   (call_script, "script_troop_add_gold", "trp_player", "$g_tournament_bet_placed"),
		(display_message, "@Because you are Caesar Augustus, you gain back the money you have placed as bets."),
        ]),
      ("tournament_withdraw_no", [], "No, I want to fight by myself!",
       [(jump_to_menu, "mnu_town_tournament"),
        ]),
    ]
  ),
  (
    "tournament_bet",0,
    "The odds against you are {reg5} to {reg6}.{reg1? You have already bet {reg1} denars on yourself, and if you win, you will earn {reg2} denars.:} How much do you want to bet?",
    "none",
    [
      (assign, reg1, "$g_tournament_bet_placed"),
      (store_add, reg2, "$g_tournament_bet_win_amount", "$g_tournament_bet_placed"),
      (call_script, "script_get_win_amount_for_tournament_bet"),
      (assign, ":player_odds", reg0),
      (assign, ":min_dif", 100000),
      (assign, ":min_dif_divisor", 1),
      (assign, ":min_dif_multiplier", 1),
      (try_for_range, ":cur_multiplier", 1, 50),
        (try_for_range, ":cur_divisor", 1, 50),
          (store_mul, ":result", 100, ":cur_multiplier"),
          (val_div, ":result", ":cur_divisor"),
          (store_sub, ":difference", ":player_odds", ":result"),
          (val_abs, ":difference"),
          (lt, ":difference", ":min_dif"),
          (assign, ":min_dif", ":difference"),
          (assign, ":min_dif_divisor", ":cur_divisor"),
          (assign, ":min_dif_multiplier", ":cur_multiplier"),
        (try_end),
      (try_end),
      (assign, reg5, ":min_dif_multiplier"),
      (assign, reg6, ":min_dif_divisor"),
      ],
    [
      ("bet_100_denars", [(store_troop_gold, ":gold", "trp_player"),
                          (ge, ":gold", 100)
                          ],
       "100 denars.",
       [
         (assign, "$temp", 100),
         (jump_to_menu, "mnu_tournament_bet_confirm"),
        ]),
      ("bet_50_denars", [(store_troop_gold, ":gold", "trp_player"),
                         (ge, ":gold", 50)
                         ],
       "50 denars.",
       [
         (assign, "$temp", 50),
         (jump_to_menu, "mnu_tournament_bet_confirm"),
        ]),
      ("bet_20_denars", [(store_troop_gold, ":gold", "trp_player"),
                         (ge, ":gold", 20)
                         ],
       "20 denars.",
       [
         (assign, "$temp", 20),
         (jump_to_menu, "mnu_tournament_bet_confirm"),
        ]),
      ("bet_10_denars", [(store_troop_gold, ":gold", "trp_player"),
                         (ge, ":gold", 10)
                         ],
       "10 denars.",
       [
         (assign, "$temp", 10),
         (jump_to_menu, "mnu_tournament_bet_confirm"),
        ]),
      ("bet_5_denars", [(store_troop_gold, ":gold", "trp_player"),
                        (ge, ":gold", 5)
                        ],
       "5 denars.",
       [
         (assign, "$temp", 5),
         (jump_to_menu, "mnu_tournament_bet_confirm"),
        ]),
      ("go_back_dot", [], "Go back.",
       [
         (jump_to_menu, "mnu_town_tournament"),
        ]),
    ]
  ),

  (
    "tournament_bet_confirm",0,
    "If you bet {reg1} denars, you will earn {reg2} denars if you win the games. Is that all right?",
    "none",
    [
      (call_script, "script_get_win_amount_for_tournament_bet"),
      (assign, ":win_amount", reg0),
      (val_mul, ":win_amount", "$temp"),
      (val_div, ":win_amount", 100),
      (assign, reg1, "$temp"),
      (assign, reg2, ":win_amount"),
      ],
    [
      ("tournament_bet_accept", [],
       "Go ahead.",
       [
         (call_script, "script_tournament_place_bet", "$temp"),
         (jump_to_menu, "mnu_town_tournament"),
         ]),
      ("tournament_bet_cancel", [],
       "Forget it.",
       [
         (jump_to_menu, "mnu_tournament_bet"),
         ]),
    ]
  ),

  (
    "tournament_participants",0,
    "You ask one of the criers for the names of the participants. They are:^{s11}",
    "none",
    [
        (str_clear, s11),
        (call_script, "script_sort_tournament_participant_troops"),
        (call_script, "script_get_num_tournament_participants"),
        (assign, ":num_participants", reg0),
        (try_for_range, ":cur_slot", 0, ":num_participants"),
          (troop_get_slot, ":troop_no", "trp_tournament_participants", ":cur_slot"),
          (str_store_troop_name, s12, ":troop_no"),
          (str_store_string, s11, "@{!}{s11}^{s12}"),
        (try_end),
        ],
    [
      ("go_back_dot", [], "Go back.",
       [(jump_to_menu, "mnu_town_tournament"),
        ]),
    ]
  ),

  (
    "collect_taxes",mnf_disable_all_keys,
    "As the party member with the highest trade skill ({reg2}), {reg3?you expect:{s1} expects} that collecting taxes from here will take {reg4} days...",
    "none",
    [
	 (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
     (assign, ":max_skill", reg0),
     (assign, reg2, reg0),
     (assign, ":max_skill_owner", reg1),
     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s1, ":max_skill_owner"),
     (try_end),
     (assign, ":tax_quest_expected_revenue", 3000),
     (try_begin),
       (party_slot_eq, "$current_town", slot_party_type, spt_town),
       (assign, ":tax_quest_expected_revenue", 6000),
     (try_end),

     (try_begin),
       (quest_slot_eq, "qst_collect_taxes", slot_quest_current_state, 0),
       (store_add, ":max_skill_plus_thirty", ":max_skill", 30),
       (try_begin),
         (party_slot_eq, "$current_town", slot_party_type, spt_town),
         (store_div, "$qst_collect_taxes_total_hours", 24* 7 * 30, ":max_skill_plus_thirty"),
       (else_try),
         #Village
         (store_div, "$qst_collect_taxes_total_hours", 24 * 3 * 30, ":max_skill_plus_thirty"),
       (try_end),

       (call_script, "script_party_count_fit_for_battle", "p_main_party"),
       (val_add, reg0, 20),
       (val_mul, "$qst_collect_taxes_total_hours", 20),
       (val_div, "$qst_collect_taxes_total_hours", reg0),

       (quest_set_slot, "qst_collect_taxes", slot_quest_target_amount, "$qst_collect_taxes_total_hours"),
       (store_div, ":menu_begin_time", "$qst_collect_taxes_total_hours", 20),#between %5-%25
       (store_div, ":menu_end_time", "$qst_collect_taxes_total_hours", 4),
       (assign, ":unrest_begin_time", ":menu_end_time"),#between %25-%75
       (store_mul, ":unrest_end_time", "$qst_collect_taxes_total_hours", 3),
       (val_div, ":unrest_end_time", 4),

       (val_mul, ":tax_quest_expected_revenue", 2),
       (store_div, "$qst_collect_taxes_hourly_income", ":tax_quest_expected_revenue", "$qst_collect_taxes_total_hours"),

       (store_random_in_range, "$qst_collect_taxes_menu_counter", ":menu_begin_time", ":menu_end_time"),
       (store_random_in_range, "$qst_collect_taxes_unrest_counter", ":unrest_begin_time", ":unrest_end_time"),
       (assign, "$qst_collect_taxes_halve_taxes", 0),
     (try_end),
     (quest_get_slot, ":target_hours", "qst_collect_taxes", slot_quest_target_amount),
     (store_div, ":target_days", ":target_hours", 24),
     (val_mul, ":target_days", 24),
     (try_begin),
       (lt, ":target_days", ":target_hours"),
       (val_add, ":target_days", 24),
     (try_end),
     (val_div, ":target_days", 24),
     (assign, reg4, ":target_days"),
     ],
    [
      ("start_collecting", [], "Start collecting.",
       [(assign, "$qst_collect_taxes_currently_collecting", 1),
        (try_begin),
          (quest_slot_eq, "qst_collect_taxes", slot_quest_current_state, 0),
          (quest_set_slot, "qst_collect_taxes", slot_quest_current_state, 1),
        (try_end),
        (rest_for_hours_interactive, 1000, 5, 0), #rest while not attackable
        (assign,"$auto_enter_town","$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (change_screen_return),
        ]),
      ("collect_later", [], "Put it off until later.",
       [(try_begin),
          (party_slot_eq, "$current_town", slot_party_type, spt_town),
          (jump_to_menu, "mnu_town"),
        (else_try),
          (jump_to_menu, "mnu_village"),
        (try_end),
        ]),
    ]
  ),

  (
    "collect_taxes_complete",mnf_disable_all_keys,
    ##diplomacy start+
    ##Replace "him" with "{reg4?her:him}"
    "You've collected {reg3} denars in taxes from {s3}. {s19} will be expecting you to take the money to {reg4?her:him}.",
    ##diplomacy end+
    "none",
    [(str_store_party_name, s3, "$current_town"),
     (quest_get_slot, ":quest_giver", "qst_collect_taxes", slot_quest_giver_troop),
     (str_store_troop_name, s19, ":quest_giver"),
     ##diplomacy start+

     (try_begin),
       (eq, "$qst_collect_taxes_halve_taxes", 0),
       (call_script, "script_change_player_relation_with_center", "$current_town", -2),
     (try_end),
     (call_script, "script_succeed_quest", "qst_collect_taxes"),

     #SB : add renown to tax collector
     (try_begin),
       (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
       (neq, reg1, "trp_player"),
       (call_script, "script_change_troop_renown", reg1, dplmc_companion_skill_renown),
     (try_end),

     (quest_get_slot, reg3, "qst_collect_taxes", slot_quest_gold_reward),
     ##Store quest giver gender to reg4
     (call_script, "script_dplmc_store_troop_is_female_reg", ":quest_giver", 4), #SB : use other script
     ##diplomacy end+
     ],
    [
      ("continue", [], "Continue...",
       [(change_screen_return),
        ]),
    ]
  ),

  (
    "collect_taxes_rebels_killed",0,
    "Your quick action and strong arm have successfully put down the revolt.\
 Surely, anyone with a mind to rebel against you will think better of it after this.",
    "none",
    [
    ],
    [
      ("continue", [], "Continue...",
       [(change_screen_map),
        ]),
    ]
  ),

  (
    "collect_taxes_failed",mnf_disable_all_keys,
##diplomacy start+ fix gender of pronoun
    "You could collect only {reg3} denars as tax from {s3} before the revolt broke out.\
 {s1} won't be happy, but some silver will placate {reg4?her:him} better than nothing at all...",
##diplomacy end+
    "none",
    [#SB : set up picture
     (set_background_mesh, "mesh_pic_escape_1"),
     (str_store_party_name, s3, "$current_town"),
     (quest_get_slot, ":quest_giver", "qst_collect_taxes", slot_quest_giver_troop),
     ##diplomacy start+ store gender of quest giver in reg4
     (call_script, "script_dplmc_store_troop_is_female", ":quest_giver"),
     (assign, reg4, reg0),
     ##diplomacy end+
     (str_store_troop_name, s1, ":quest_giver"),
     (quest_get_slot, reg3, "qst_collect_taxes", slot_quest_gold_reward),
     (call_script, "script_fail_quest", "qst_collect_taxes"),
     (quest_set_slot, "qst_collect_taxes", slot_quest_current_state, 4),
     (rest_for_hours, 0, 0, 0), #stop resting
     ],
    [
      ("continue", [], "Continue...",
        [#SB : lose renown
          (call_script, "script_change_troop_renown", "trp_player", -2),
          (change_screen_map),
        ]),
    ]
  ),

  (
    "collect_taxes_revolt_warning",0,
    "The people of {s3} are outraged at your demands and decry it as nothing more than extortion.\
 They're getting very restless, and they may react badly if you keep pressing them.",
    "none",
    [(str_store_party_name, s3, "$current_town"),
     ],
    [
      ("continue_collecting_taxes", [], "Ignore them and continue.",
       [ #SB : objectionable action
       (call_script, "script_objectionable_action", tmt_egalitarian, "str_repress_farmers"),
       (change_screen_return),]),
      ("halve_taxes", [(quest_get_slot, ":quest_giver_troop", "qst_collect_taxes", slot_quest_giver_troop),
                       (str_store_troop_name, s1, ":quest_giver_troop"),],
       "Agree to reduce your collection by half. ({s1} may be upset)",
       [(assign, "$qst_collect_taxes_halve_taxes", 1),
        (change_screen_return),
        ]),
    ]
  ),

  (
    "collect_taxes_revolt",0,
    "You are interrupted while collecting the taxes at {s3}. A large band of angry {reg9?peasants:townsmen} is marching nearer,\
 shouting about the exorbitant taxes and waving torches and weapons. It looks like they aim to fight you!",
    "none",
    [(str_store_party_name, s3, "$current_town"),
     #SB : town pictures
     (try_begin),
       (party_slot_eq, "$current_town", slot_party_type, spt_village),
       (assign, reg9, 1),
       (set_background_mesh, "mesh_pic_villageriot"),
     (else_try),
       (set_background_mesh, "mesh_pic_townriot"),
       (assign, reg9, 0),
     (try_end),
     ],
    [
      ("continue", [], "Continue...",
       [(set_jump_mission,"mt_back_alley_revolt"),
        (quest_get_slot, ":target_center", "qst_collect_taxes", slot_quest_target_center),
        (try_begin),
          (party_slot_eq, ":target_center", slot_party_type, spt_town),
          (party_get_slot, ":town_alley", ":target_center", slot_town_center),
        (else_try),
          (party_get_slot, ":town_alley", ":target_center", slot_castle_exterior),
        (try_end),
        (modify_visitors_at_site,":town_alley"),
        (reset_visitors),
        (assign, ":num_rebels", 6),
        (store_character_level, ":level", "trp_player"),
        (val_div, ":level", 5),
        (val_add, ":num_rebels", ":level"),

        (try_begin),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_1"),
          (assign, ":rebel_troop", "trp_dacian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2"),
          (assign, ":rebel_troop", "trp_celtic_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2_1"),
          (assign, ":rebel_troop", "trp_celtic_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_3"),
          (assign, ":rebel_troop", "trp_sarmatian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_4"),
          (assign, ":rebel_troop", "trp_germanic_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_5"),
          (assign, ":rebel_troop", "trp_armenian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_6"),
          (assign, ":rebel_troop", "trp_parthian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
          (assign, ":rebel_troop", "trp_roman_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_9"),
          (assign, ":rebel_troop", "trp_bosporan_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_8"),
          (assign, ":rebel_troop", "trp_judean_village_walker"),
        (try_end),

        (set_visitors, 11, ":rebel_troop", ":num_rebels"),
        (jump_to_scene,":town_alley"),
        (change_screen_mission),
        ]),
    ]
  ),

# They must learn field discipline and the steadiness to follow orders in combat before they can be thought to use arms.",
  (
    "train_peasants_against_bandits",0,
    "As the party member with the highest training skill ({reg2}), {reg3?you expect:{s1} expects} that getting some peasants ready for practice will take {reg4} hours.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_trainer"),
     (assign, ":max_skill", reg0),
     (assign, reg2, reg0),
     (assign, ":max_skill_owner", reg1),
     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s1, ":max_skill_owner"),
     (try_end),
     (store_sub, ":needed_hours", 20, ":max_skill"),
     (val_mul, ":needed_hours", 3),
     (val_div, ":needed_hours", 5),
     (store_sub, reg4, ":needed_hours", "$qst_train_peasants_against_bandits_num_hours_trained"),
     ],
    [
      ("make_preparation", [], "Train them.",
       [
         (assign, "$qst_train_peasants_against_bandits_currently_training", 1),
         (rest_for_hours_interactive, 1000, 5, 0), #rest while not attackable
         (assign, "$auto_enter_town", "$current_town"),
         (assign, "$g_town_visit_after_rest", 1),
         (change_screen_return),
         ]),
      ("train_later", [], "Put it off until later.",
       [
         (jump_to_menu, "mnu_village"),
        ]),
    ]
  ),

  (
    "train_peasants_against_bandits_ready",0,
    "You put the peasants through the basics of soldiering, discipline and obedience.\
 You think {reg0} of them {reg1?have:has} fully grasped the training and {reg1?are:is} ready for some practice.",
    "none",
    [
      (store_character_level, ":level", "trp_player"),
      (val_div, ":level", 10),
      (val_add, ":level", 1),
      (quest_get_slot, ":quest_target_amount", "qst_train_peasants_against_bandits", slot_quest_target_amount),
      (quest_get_slot, ":quest_current_state", "qst_train_peasants_against_bandits", slot_quest_current_state),
      (val_sub, ":quest_target_amount", ":quest_current_state"),
      (assign, ":max_random", ":level"),
      (val_min, ":max_random", ":quest_target_amount"),
      (val_add, ":max_random", 1),
      (store_random_in_range, ":random_number", 1, ":max_random"),
      (assign, "$g_train_peasants_against_bandits_num_peasants", ":random_number"),

      (assign, reg0, ":random_number"),
      (store_sub, reg1, ":random_number", 1),
      (str_store_troop_name_by_count, s0, "trp_trainee_peasant", ":random_number"),
     ],
    [
      ("peasant_start_practice", [], "Start the practice fight.",
       [
         (set_jump_mission,"mt_village_training"),
         (quest_get_slot, ":target_center", "qst_train_peasants_against_bandits", slot_quest_target_center),
         (party_get_slot, ":village_scene", ":target_center", slot_castle_exterior),
         (modify_visitors_at_site, ":village_scene"),
         (reset_visitors),
         (set_visitor, 0, "trp_player"),
         (set_visitors, 1, "trp_trainee_peasant", "$g_train_peasants_against_bandits_num_peasants"),
         (set_jump_entry, 11),
         (jump_to_scene, ":village_scene"),
         (jump_to_menu, "mnu_train_peasants_against_bandits_training_result"),
         (music_set_situation, 0),
         (change_screen_mission),
         ]),
      ]
    ),

  (
    "train_peasants_against_bandits_training_result",mnf_disable_all_keys,
    "{s0}",
    "none",
    [
      (assign, reg5, "$g_train_peasants_against_bandits_num_peasants"),
      (str_store_troop_name_by_count, s0, "trp_trainee_peasant", "$g_train_peasants_against_bandits_num_peasants"),
      (try_begin),
        (eq, "$g_train_peasants_against_bandits_training_succeeded", 0),
        (str_store_string, s0, "@You were beaten. The peasants are heartened by their success, but the lesson you wanted to teach them probably didn't get through..."),
      (else_try),
        (str_store_string, s0, "@After beating your last opponent, you explain to the peasants how to better defend themselves against such an attack. Hopefully they'll take the experience on board and will be prepared next time."),
        (quest_get_slot, ":quest_current_state", "qst_train_peasants_against_bandits", slot_quest_current_state),
        (val_add, ":quest_current_state", "$g_train_peasants_against_bandits_num_peasants"),
        (quest_set_slot, "qst_train_peasants_against_bandits", slot_quest_current_state, ":quest_current_state"),
      (try_end),
     ],
    [
      ("continue", [], "Continue...",
       [
         (try_begin),
           (quest_get_slot, ":quest_current_state", "qst_train_peasants_against_bandits", slot_quest_current_state),
           (quest_slot_eq, "qst_train_peasants_against_bandits", slot_quest_target_amount, ":quest_current_state"),
           (jump_to_menu, "mnu_train_peasants_against_bandits_attack"),
         (else_try),
           (change_screen_map),
         (try_end),
         ]),
      ]
    ),

  (
    "train_peasants_against_bandits_attack",0,
    "As you get ready to continue the training, a sentry from the village runs up to you, shouting alarums.\
 The bandits have been spotted on the horizon, riding hard for {s3}.\
 The elder begs that you organize your newly-trained militia and face them.",
    "none",
    [
    (str_store_party_name, s3, "$current_town"),
     ],
    [
      ("peasants_against_bandits_attack_resist", [], "Prepare for a fight!",
       [ ## SB : use new bandit script
        # (store_random_in_range, ":random_no", 0, 3),
        # (try_begin),
          # (eq, ":random_no", 0),
          # (assign, ":bandit_troop", "trp_bandit"),
        # (else_try),
          # (eq, ":random_no", 1),
          # (assign, ":bandit_troop", "trp_mountain_bandit"),
        # (else_try),
          # (assign, ":bandit_troop", "trp_forest_bandit"),
        # (try_end),
        (call_script, "script_center_get_bandits", "$current_town", 0),
        (assign, ":bandit_troop", reg0),
        (party_get_slot, ":scene_to_use", "$g_encountered_party", slot_castle_exterior),
        (modify_visitors_at_site, ":scene_to_use"),
        (reset_visitors),
        (store_character_level, ":level", "trp_player"),
        (val_div, ":level", 2),
        (store_add, ":min_bandits", ":level", 16),
        (store_add, ":max_bandits", ":min_bandits", 6),
        (store_random_in_range, ":random_no", ":min_bandits", ":max_bandits"),
        (set_visitors, 0, ":bandit_troop", ":random_no"),
        # (assign, ":num_villagers", ":max_bandits"),
        #SB : more accurate count
        (store_party_size_wo_prisoners, ":num_villagers", "$current_town"),
        (val_min, ":num_villagers", ":max_bandits"), #dckplmc

        (try_begin),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_1"),
          (assign, ":rebel_troop", "trp_dacian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2"),
          (assign, ":rebel_troop", "trp_celtic_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2_1"),
          (assign, ":rebel_troop", "trp_celtic_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_3"),
          (assign, ":rebel_troop", "trp_sarmatian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_4"),
          (assign, ":rebel_troop", "trp_germanic_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_5"),
          (assign, ":rebel_troop", "trp_armenian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_6"),
          (assign, ":rebel_troop", "trp_parthian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
          (assign, ":rebel_troop", "trp_roman_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_9"),
          (assign, ":rebel_troop", "trp_bosporan_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_8"),
          (assign, ":rebel_troop", "trp_judean_village_walker"),
        (try_end),

        (set_visitors, 2, ":rebel_troop", ":num_villagers"),
        (set_party_battle_mode),
        (set_battle_advantage, 0),
        (assign, "$g_battle_result", 0),
        (set_jump_mission,"mt_village_attack_bandits"),
        (jump_to_scene, ":scene_to_use"),
        (assign, "$g_next_menu", "mnu_train_peasants_against_bandits_attack_result"),
        (jump_to_menu, "mnu_battle_debrief"),
        (assign, "$g_mt_mode", vba_after_training),
        (change_screen_mission),
        ]),
      ]
    ),

  (
    "train_peasants_against_bandits_attack_result",mnf_scale_picture|mnf_disable_all_keys,
    "{s9}",
    "none",
    [
      (try_begin),
        (eq, "$g_battle_result", 1),
        (str_store_string, s9, "@The bandits are broken!\
 Those few who remain alive and conscious run off with their tails between their legs,\
 terrified of the peasants and their new champion."),
        (call_script, "script_succeed_quest", "qst_train_peasants_against_bandits"),
        (jump_to_menu, "mnu_train_peasants_against_bandits_success"),
      (else_try),
        (call_script, "script_fail_quest", "qst_train_peasants_against_bandits"),
        (str_store_string, s9, "@Try as you might, you could not defeat the bandits.\
 Infuriated, they raze the village to the ground to punish the peasants,\
 and then leave the burning wasteland behind to find greener pastures to plunder."),
        (set_background_mesh, "mesh_pic_looted_village"),
      (try_end),
     ],
    [
      ("continue", [], "Continue...",
       [(try_begin),
          (call_script, "script_village_set_state",  "$current_town", svs_looted),
          (party_set_slot, "$current_town", slot_village_raid_progress, 0),
          (party_set_slot, "$current_town", slot_village_recover_progress, 0),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -3),
          (call_script, "script_end_quest", "qst_train_peasants_against_bandits"),
        (try_end),
        (change_screen_map),
    ]),
      ]
    ),

   (
    "train_peasants_against_bandits_success",mnf_disable_all_keys,
    "The bandits are broken!\
 Those few who remain run off with their tails between their legs,\
 terrified of the peasants and their new champion.\
 The villagers have little left in the way of wealth after their ordeal,\
 but they offer you all they can find to show their gratitude.",
    "none",
    [(party_clear, "p_temp_party"),
     #SB : probably apply casualties before adding new troops?
     (quest_get_slot, ":amount_trained", "qst_train_peasants_against_bandits", slot_quest_target_amount),
     (store_faction_of_party, ":village_faction", "$current_town"), #assuming player trains them with local weapons
     (faction_get_slot, ":recruit_troop", ":village_faction", slot_faction_tier_1_troop),
     (party_add_members, "$current_town", ":recruit_troop", ":amount_trained"),

     # (party_remove_members, "$current_town", "trp_farmer", ":amount_trained"),

    (call_script, "script_end_quest", "qst_train_peasants_against_bandits"),
    (call_script, "script_change_player_relation_with_center", "$current_town", 4),

    (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
    (try_for_range, ":slot_no", num_equipment_kinds ,max_inventory_items + num_equipment_kinds),
        (store_random_in_range, ":rand", 0, 100),
        (lt, ":rand", 50),
        (troop_set_inventory_slot, ":merchant_troop", ":slot_no", -1),
    (try_end),
    (call_script, "script_add_log_entry", logent_helped_peasants, "trp_player",  "$current_town", -1, -1),
     #(set_background_mesh, "mesh_pic_mb_warrior_3"), #SB : background mesh
    ],
    [
      ("village_bandits_defeated_accept",[],"Take it as your just due.",[(jump_to_menu, "mnu_auto_return_map"),
                                                                         (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
                                                                         (troop_sort_inventory, ":merchant_troop"),
                                                                         (change_screen_loot, ":merchant_troop"),
                                                                       ]),
      ("village_bandits_defeated_cont",[],  "Refuse, stating that they need these items more than you do.",[
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
      (call_script, "script_change_player_honor", 1),
      (change_screen_map)]),
    ],
  ),

  (
    "center_reports",0,
    "Town Name: {s1}^Rent Income: {reg1} denars^Tariff Income: {reg2} denars^Food Stock: for {reg3} days",
    "none",
    [(party_get_slot, ":town_food_store", "$g_encountered_party", slot_party_food_store),
     (call_script, "script_center_get_food_consumption", "$g_encountered_party"),
     (assign, ":food_consumption", reg0),
     (try_begin),
       (gt, ":food_consumption", 0),
       (store_div, reg3, ":town_food_store", ":food_consumption"),
     (else_try),
       (assign, reg3, 9999),
     (try_end),
     (str_store_party_name, s1, "$g_encountered_party"),
     (party_get_slot, reg1, "$g_encountered_party", slot_center_accumulated_rents),
     (party_get_slot, reg2, "$g_encountered_party", slot_center_accumulated_tariffs),
     ],
    [
      ("to_price_and_productions", [], "Show prices and productions.",
       [(jump_to_menu, "mnu_price_and_production"),
        ]),

      ("go_back_dot",[],"Go back.",
       [(try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
          (jump_to_menu, "mnu_village"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
        ]),
    ]
  ),

  (
    "price_and_production",0,
    "Productions are:^(Note: base/modified by raw materials/modified by materials plus prosperity)^{s1}^^Price factors are:^{s2}",
    "none",
    [

	 (assign, ":calradian_average_urban_hardship", 0),
	 (assign, ":calradian_average_rural_hardship", 0),

	 (try_for_range, ":center", towns_begin, towns_end),
		(call_script, "script_center_get_goods_availability", ":center"),
		(val_add, ":calradian_average_urban_hardship", reg0),
	 (try_end),

	 (try_for_range, ":center", villages_begin, villages_end),
		(call_script, "script_center_get_goods_availability", ":center"),
		(val_add, ":calradian_average_rural_hardship", reg0),
	 (try_end),

	 (val_div, ":calradian_average_rural_hardship", 110),
	 (val_div, ":calradian_average_urban_hardship", 22),

	 (call_script, "script_center_get_goods_availability", "$g_encountered_party"),

	 (assign, reg1, ":calradian_average_urban_hardship"),
	 (assign, reg2, ":calradian_average_rural_hardship"),

	 (try_begin),
		(ge, "$cheat_mode", 1),
		(str_store_string, s1, "str___hardship_index_reg0_avg_towns_reg1_avg_villages_reg2__"),
		(display_message, "@{!}DEBUG - {s1}"),
	 (try_end),

     (try_for_range, ":cur_good", trade_goods_begin, trade_goods_end),
	   (neq, ":cur_good", "itm_pork"), #tied to price of grain
	   (neq, ":cur_good", "itm_chicken"), #tied to price of grain
	   (neq, ":cur_good", "itm_butter"), #tied to price of cheese
	   (neq, ":cur_good", "itm_cattle_meat"),
	   (neq, ":cur_good", "itm_cabbages"), #possibly include later

	   (call_script, "script_center_get_production", "$g_encountered_party", ":cur_good"),
	   (assign, ":production", reg0),
	   (assign, ":base_production", reg2),
	   (assign, ":base_production_modded_by_raw_materials", reg1),

	   (call_script, "script_center_get_consumption", "$g_encountered_party", ":cur_good"),
	   (assign, ":consumer_consumption", reg2),
	   (assign, ":raw_material_consumption", reg1),
	   (assign, ":consumption", reg0),

       (store_sub, ":cur_good_price_slot", ":cur_good", trade_goods_begin),
       (val_add, ":cur_good_price_slot", slot_town_trade_good_prices_begin),
       (party_get_slot, ":price", "$g_encountered_party", ":cur_good_price_slot"),

	   (assign, ":total_centers", 0),
	   (assign, ":calradian_average_price", 0),
	   (assign, ":calradian_average_production", 0),
	   (assign, ":calradian_average_consumption", 0),

	   (try_for_range, ":center", centers_begin, centers_end),
		(neg|is_between, ":center", castles_begin, castles_end),
	    (val_add, ":total_centers", 1),
        (call_script, "script_center_get_production", ":center", ":cur_good"),
		(assign, ":center_production", reg2),
        (call_script, "script_center_get_consumption", ":center", ":cur_good"),
		(store_add, ":center_consumption", reg1, reg2),

        (party_get_slot, ":center_price", ":center", ":cur_good_price_slot"),
	    (val_add, ":calradian_average_price", ":center_price"),
	    (val_add, ":calradian_average_production", ":center_production"),
	    (val_add, ":calradian_average_consumption", ":center_consumption"),
	   (try_end),

	   (assign, ":calradian_total_production", ":calradian_average_production"),
	   (assign, ":calradian_total_consumption", ":calradian_average_consumption"),

	   (val_div, ":calradian_average_price", ":total_centers"),
	   (val_div, ":calradian_average_production", ":total_centers"),
	   (val_div, ":calradian_average_consumption", ":total_centers"),

       (str_store_item_name, s3, ":cur_good"),

       (assign, reg1, ":base_production"),
       (assign, reg2, ":base_production_modded_by_raw_materials"),
       (assign, reg3, ":production"),
       (assign, reg4, ":price"),

	   (assign, reg5, ":calradian_average_production"),
	   (assign, reg6, ":calradian_average_price"),

	   (assign, reg7, ":consumer_consumption"),
	   (assign, reg8, ":raw_material_consumption"),
	   (assign, reg9, ":consumption"),

	   (assign, reg10, ":calradian_average_consumption"),

	   (item_get_slot, ":production_slot", ":cur_good", slot_item_production_slot),
	   (party_get_slot, ":production_number", "$g_encountered_party", ":production_slot"),
	   (assign, reg11, ":production_number"),
	   (assign, reg12, ":calradian_total_production"),
	   (assign, reg13, ":calradian_total_consumption"),

	   (item_get_slot, ":production_string", ":cur_good", slot_item_production_string),
	   (str_store_string, s4, ":production_string"),

       (str_store_string, s1, "str___s3_price_=_reg4_calradian_average_reg6_capital_reg11_s4_base_reg1modified_by_raw_material_reg2modified_by_prosperity_reg3_calradian_average_production_base_reg5_total_reg12_consumed_reg7used_as_raw_material_reg8modified_total_reg9_calradian_consumption_base_reg10_total_reg13s1_"),
     (try_end),

     ],
    [
      ("go_back_dot",[],"Go back.",
       [(try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
          (jump_to_menu, "mnu_village"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
        ]),
    ]
  ),

("town_trade",mnf_enable_hot_keys,
  "You head towards the town center. Here you can find all important merchants of the town{s50}.^The settlement is of {s61} culture.^{s34}^^{s49}^^Hints: Press shift + 'Talk with X' to talk with merchants. Press control + 'Talk with the food merchant' to automatically buy all food.",
  "none",[
    (troop_set_slot, "trp_global_variables", start_town_conversation, 0),#this is to store if the conversation was started from the menu or the scene
    (str_clear, s34),
    (str_clear, s49),
    (str_clear, s50),
    (try_for_range, ":decree", slot_center_decree_curfew, slot_center_capital),
        (party_slot_eq, "$current_town", ":decree", 1),
        (store_sub, ":string", ":decree", slot_center_decree_curfew),
        (val_add, ":string", "str_decree_curfew_name"),
        (str_store_string, s48, ":string"),
        (str_store_string, s49, "@ {s49} ^The governor issued a {s48}"),
    (try_end),
    (try_begin),
        (party_slot_eq, "$current_town", slot_party_type, spt_town),
        (str_store_string, s50, "@ and the magister civium"),
    (try_end),
    (try_begin),
        (party_get_slot, ":town_seneschal", "$current_town", slot_town_seneschal),
        (gt, ":town_seneschal", -1),
        #(store_faction_of_party, ":fac", "$current_town"),
        #(faction_slot_eq, ":fac", slot_faction_culture, "fac_culture_7"),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
        (str_store_string, s34, "@You may also visit the scriptorium if you have legal matters. It is located on the center of the marketplace."),
    (try_end),
    (party_get_slot, ":culture", "$current_town", slot_center_culture),
    (str_store_faction_name, s61, ":culture"),
    (try_begin),
        (party_slot_eq, "$current_town", slot_center_statues, -1),
        (str_store_string, s34, "@{s34}^The streets are decorated with statues of you."),
        (set_background_mesh, "mesh_pic_statue"),
    (try_end),
	],[
	# ("economic_info",
      # []
       # ,"Show economic information.",
       # [
       # (jump_to_menu, "mnu_economic"),
		   # (assign, "$g_next_menu", "mnu_town_trade"),
        # ]),
    ("temple_visit",[
      (party_slot_ge, "$current_town", slot_center_has_temple, 1),
      (party_get_slot, ":god", "$current_town", slot_center_has_temple_god),
      (store_add, ":string", ":god", "str_gods_begin"),
      (str_store_string, s37, ":string"),
    ],"Visit the temple of {s37}.",[
      (try_begin),
          (is_currently_night),
          (display_message, "str_door_locked"),
      (else_try),
          (party_get_slot, ":god", "$current_town", slot_center_has_temple_god),
          (call_script, "script_enter_temple", ":god"),
      (try_end),
    ]),
    ("baths",[
      (this_or_next|party_slot_eq, "$current_town", slot_party_type, spt_town),
      (party_slot_ge, "$current_town", slot_center_has_water, 1),

      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_8"),#judean
      (le, "$sneaked_into_town", disguise_none),
      (eq, "$enlisted_party", -1),#no freelancer
    ],"Visit the Mikveh. (baths)",[
		  (jump_to_menu, "mnu_baths"),
    ]),
    ("baths",[
      (this_or_next|party_slot_eq, "$current_town", slot_party_type, spt_town),
      (party_slot_ge, "$current_town", slot_center_has_water, 1),

      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
      (le, "$sneaked_into_town", disguise_none),
      (eq, "$enlisted_party", -1),#no freelancer
    ],"Visit the baths.",[
		  (jump_to_menu, "mnu_baths"),
    ]),
	  ("slavemarket",[
		  (party_slot_ge, "$current_town", slot_center_has_slave_market, 1),
    ],"Visit the slavemarket.",[
      (modify_visitors_at_site, "scn_slavemarket"),
		  (assign, "$talk_context", 0),
      (reset_visitors),

      (try_for_range, ":visiterator", 1, 8),
			  (store_random_in_range, ":r", 0, 2),
			  (try_begin),
				  (eq, ":r", 0),
				  (set_visitor, ":visiterator", "trp_roman_town_walker",),
			  (else_try),
				  (set_visitor, ":visiterator", "trp_roman_town_walker_female",),
			  (try_end),
      (try_end),
      (set_visitor, 10, "trp_slave_trader",),
      (set_visitor, 11, "trp_slave_trader",),
      (try_for_range, ":visiterator", 12, 31),
			  (store_random_in_range, ":r", 0, 2),
			  (try_begin),
				  (eq, ":r", 0),
				  (set_visitor, ":visiterator", "trp_slave",),
			  (else_try),
				  (set_visitor, ":visiterator", "trp_slave_female",),
			  (try_end),
      (try_end),
      (set_jump_mission,"mt_slave_market"),
		  (jump_to_scene, "scn_slavemarket"),
		  (change_screen_mission),
    ]),

	  ("scriptorium", [
      (party_get_slot, ":town_seneschal", "$current_town", slot_town_seneschal),
      (gt, ":town_seneschal", -1),
      # (store_faction_of_party, ":fac", "$current_town"),
      # (faction_slot_eq, ":fac", slot_faction_culture, "fac_culture_7"),
      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
      (assign, ":l",1),
      (try_begin),
          (gt, "$sneaked_into_town", disguise_none),
          # (display_message, "@ You can't enter, you have sneaked into this town!"),
          (assign, ":l",0),
      (try_end),
      (eq, ":l", 1),
    ],"Visit the scriptorium.",[
      (party_get_slot, ":town_seneschal", "$current_town", slot_town_seneschal),

      (modify_visitors_at_site,"scn_scriptorium"),
      (reset_visitors),
      (assign, "$talk_context", tc_court_talk),
      (set_visitor, 2, ":town_seneschal"),
      (set_visitor,1,"trp_player"), #player
      (set_visitor,3,"trp_vigilia"),
      (set_visitor,4,"trp_vigilia"),
      (set_visitor,14,"trp_argentarius"),

          (try_begin),
              (party_slot_eq, "$current_town", slot_party_type, spt_town),
              (party_get_slot, ":guildmaster", "$current_town", slot_town_elder),
              (set_visitor,13,":guildmaster"),
          (try_end),

      (set_jump_mission,"mt_visit_scriptorium"),
      (jump_to_scene, "scn_scriptorium"),
      (change_screen_mission),
    ]),
    ("trade_with_arms_merchant",[(party_slot_ge, "$current_town", slot_town_weaponsmith, 1)
    ],"Trade with the arms merchant.",[
      (party_get_slot, ":merchant_troop", "$current_town", slot_town_weaponsmith),
      (assign, "$g_talk_troop", ":merchant_troop"),
      (try_begin),
        (this_or_next|key_is_down, key_left_shift),
        (key_is_down, key_right_shift),
        (call_script, "script_start_town_conversation", slot_town_weaponsmith, 9),
      (else_try),
        (troop_set_slot, ":merchant_troop", slot_troop_met, 1),
        (change_screen_trade, ":merchant_troop"),
      (try_end),
    ]),
    ("trade_with_armor_merchant",[
      (party_slot_ge, "$current_town", slot_town_armorer, 1)
    ],"Trade with the armor merchant.",[
      (party_get_slot, ":merchant_troop", "$current_town", slot_town_armorer),
      (assign, "$g_talk_troop", ":merchant_troop"),
      (try_begin),
        (this_or_next|key_is_down, key_left_shift),
        (key_is_down, key_right_shift),
        (call_script, "script_start_town_conversation", slot_town_armorer, 9),
      (else_try),
        (troop_set_slot, ":merchant_troop", slot_troop_met, 1),
        (change_screen_trade, ":merchant_troop"),
      (try_end),
    ]),
    ("trade_with_horse_merchant",[
      (party_slot_ge, "$current_town", slot_town_horse_merchant, 1)
    ],"Trade with the horse merchant.",[
      (party_get_slot, ":merchant_troop", "$current_town", slot_town_horse_merchant),
      (try_begin),
        (this_or_next|key_is_down, key_left_shift),
        (key_is_down, key_right_shift),
        (call_script, "script_start_town_conversation", slot_town_horse_merchant, 9),
      (else_try),
        (troop_set_slot, ":merchant_troop", slot_troop_met, 1),
        (change_screen_trade, ":merchant_troop"),
      (try_end),
    ]),
    ("trade_with_goods_merchant",[
      (party_slot_ge, "$current_town", slot_town_merchant, 1)
    ],"Trade with the goods merchant.",[
      (party_get_slot, ":merchant_troop", "$current_town", slot_town_merchant),
      (assign, "$g_talk_troop", ":merchant_troop"),
      (try_begin),
        (this_or_next|key_is_down, key_left_control),
        (key_is_down, key_right_control),
        (display_message, "@You buy food automatically."),
        (try_begin),# use follower party to buy food if player has one
          (store_party_size_wo_prisoners,":size", "p_follower_party"),
          (gt, ":size", 0),
          (assign, reg48, "trp_follower_party_mules"),
        (else_try),
          (assign, reg48, "trp_player"),
        (try_end),
        (call_script, "script_dplmc_auto_buy_food", reg48, ":merchant_troop", 1, "trp_player"),
      (else_try),
        (this_or_next|key_is_down, key_left_shift),
        (key_is_down, key_right_shift),
        (call_script, "script_start_town_conversation", slot_town_merchant, 9),
      (else_try),
        (troop_set_slot, ":merchant_troop", slot_troop_met, 1),
        (change_screen_trade, ":merchant_troop"),
      (try_end),
    ]),
    ("assess_prices",[
      (neg|party_slot_eq,"$current_town",slot_party_type, spt_castle),
      (store_faction_of_party, ":current_town_faction", "$current_town"),
      (store_relation, ":reln", ":current_town_faction", "fac_player_supporters_faction"),
      (ge, ":reln", 0),
    ],"Assess the local prices.",[
      (jump_to_menu,"mnu_town_trade_assessment_begin"),
    ]),
    ("back_to_town_menu",[
    ],"Go back.",[
      (jump_to_menu,"mnu_town"),
    ]),
]),

##diplomacy start+
##Begin auto-sell credit rubik (Custom Commander)
##Altered to only sell items from the player's inventory, not his companions'.
#
#Uses global variable $g_auto_sell_price_limit changed to $g_dplmc_auto_sell_price_limit
## CC
("dplmc_trade_auto_sell_begin",0,
  "Items in your inventory whose type is marked as sellable and whose prices"
  +" are below {reg1} denars will be sold to the {reg2?appropriate merchants:elder}"
  +" in the current {reg2?town:village} automatically.  Specifically food, trade"
  +" goods, and books will never be sold. ^^You can change some settings here freely.",
  "none",[
	  ##dplmc+ added section begin
    (this_or_next|is_between, "$current_town", towns_begin, towns_end),
    (is_between, "$current_town", villages_begin, villages_end),
    (call_script, "script_dplmc_initialize_autoloot", 0),#argument "0" means this does nothing if deemed unnecessary
    ##dplmc+ added section end
    (assign, reg1, "$g_dplmc_auto_sell_price_limit"),
	  (assign, reg2, 0),
    (try_begin),
      (is_between, "$current_town", towns_begin, towns_end),
      (assign, reg2, 1),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
	    (call_script, "script_dplmc_player_auto_sell_at_center", "$current_town"),
      (jump_to_menu, "$g_next_menu"),
    ]),
    ("change_settings",[],"Change settings.",[
      (start_presentation, "prsnt_dplmc_auto_sell_options"),
    ]),
    ("go_back",[],"Go back",[
      (jump_to_menu, "$g_next_menu")
    ]),
]),

("dplmc_trade_auto_buy_food_begin",0,
  "You can automatically buy food according to your shopping list. Do you want to continue?^^You can view and configure the shopping list here."
  +" You can also {s10} to automatically buy food whenever you leave a town or village.",
  "none", [
    (str_store_string, s10, "@enalbe"),
    (try_begin),
      (eq, "$g_dplmc_buy_food_when_leaving", 1),
      (str_store_string, s10, "@disable"),
    (try_end),
  ],[
  ("disable",[
    (eq, "$g_dplmc_buy_food_when_leaving", 1),
  ],"Disable to buy food automatically on leave.",[
    (assign, "$g_dplmc_buy_food_when_leaving", 0),
  ]),
  ("enable",[
    (eq, "$g_dplmc_buy_food_when_leaving", 0),
  ],"Enable to buy food automatically on leave.",[
    (assign, "$g_dplmc_buy_food_when_leaving", 1),
  ]),
  ("continue",[
    (assign, ":merchant_troop", -1),
    (try_begin),
      (is_between, "$current_town", towns_begin, towns_end),
      (party_get_slot, ":merchant_troop", "$current_town", slot_town_merchant),
    (else_try),
      (is_between, "$current_town", villages_begin, villages_end),
      (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
    (try_end),
	  (ge, ":merchant_troop", 1),
	],"Continue...",[
    (assign, ":merchant_troop", -1),
    (try_begin),
      (is_between, "$current_town", towns_begin, towns_end),
      (party_get_slot, ":merchant_troop", "$current_town", slot_town_merchant),
    (else_try),
      (is_between, "$current_town", villages_begin, villages_end),
      (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
    (try_end),
    (try_begin),# use follower party to buy food if player has one
      (store_party_size_wo_prisoners,":size", "p_follower_party"),
      (gt, ":size", 0),
      (assign, reg48, "trp_follower_party_mules"),
    (else_try),
      (assign, reg48, "trp_player"),
    (try_end),
    (call_script, "script_dplmc_auto_buy_food", reg48, ":merchant_troop", 0, "trp_player"),
    (jump_to_menu, "$g_next_menu"),
  ]),
  ("dplmc_change_shopping_list_of_food",[],"Configure your shopping list.",[
    (start_presentation, "prsnt_dplmc_shopping_list_of_food"),
  ]),
  ("go_back",[],"Go back",[
    (jump_to_menu, "$g_next_menu"),
  ]),
]),
## CC
##End auto-sell credit rubik (Custom Commander)
##diplomacy start+

  (
   "town_trade_assessment_begin",0,
   #"You overhear the following details about the roads out of town :^(experimental feature -- this may go into dialogs)^{s42}^You also overhear several discussions about the price of trade goods across the local area.^You listen closely, trying to work out the best deals around.",
   "You overhear several discussions about the price of trade goods across the local area.^You listen closely, trying to work out the best deals around.",
    "none",
    [
	(str_clear, s42),
##	(call_script, "script_merchant_road_info_to_s42", "$g_encountered_party"),

    ],

    [
      ("continue",[],"Continue...",
       [
           (assign,"$auto_enter_town", "$current_town"),
           (assign, "$g_town_assess_trade_goods_after_rest", "$current_town"), #SB : save this
           (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
           (val_div, reg0, 2),
           (store_sub, ":num_hours", 6, reg0),
           (assign, "$g_last_rest_center", "$current_town"),
           (assign, "$g_last_rest_payment_until", -1),
           (rest_for_hours, ":num_hours", 5, 0), #rest while not attackable
           (change_screen_return),
        ]),
      ("go_back_dot",[],"Go back.",
       [
           (jump_to_menu,"mnu_town_trade"),
        ]),
    ]
  ),

  (
    "town_trade_assessment",mnf_disable_all_keys,
    "As the party member with the highest trade skill ({reg2}), {reg3?you try to figure out:{s1} tries to figure out} the best goods to trade in. {s2}",
    "none",
    [

     (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),

     (assign, ":num_best_results", 0),
     (assign, ":best_result_1_item", -1),
     (assign, ":best_result_1_town", -1),
     (assign, ":best_result_1_profit", 0),
     (assign, ":best_result_2_item", -1),
     (assign, ":best_result_2_town", -1),
     (assign, ":best_result_2_profit", 0),
     (assign, ":best_result_3_item", -1),
     (assign, ":best_result_3_town", -1),
     (assign, ":best_result_3_profit", 0),
     (assign, ":best_result_4_item", -1),
     (assign, ":best_result_4_town", -1),
     (assign, ":best_result_4_profit", 0),
     (assign, ":best_result_5_item", -1),
     (assign, ":best_result_5_town", -1),
     (assign, ":best_result_5_profit", 0),

     (store_sub, ":num_towns", walled_centers_end, walled_centers_begin),
     (store_sub, ":num_goods", trade_goods_end, trade_goods_begin),
     (store_mul, ":max_iteration", ":num_towns", ":num_goods"),
     (val_mul, ":max_iteration", ":max_skill"),
     (val_div, ":max_iteration", 20),

     (assign, ":org_encountered_party", "$g_encountered_party"),

     (try_for_range, ":unused", 0, ":max_iteration"),
       (store_random_in_range, ":random_trade_good", trade_goods_begin, trade_goods_end),
       (store_random_in_range, ":random_town", towns_begin, towns_end),

       (party_get_slot, ":cur_merchant", ":org_encountered_party", slot_town_merchant),
	   (assign, ":num_items_in_town_inventory", 0),
       (try_for_range, ":i_slot", num_equipment_kinds, max_inventory_items + num_equipment_kinds),
         (troop_get_inventory_slot, ":slot_item", ":cur_merchant", ":i_slot"),
         (try_begin),
           (eq, ":slot_item", ":random_trade_good"),
		   (val_add, ":num_items_in_town_inventory", 1),
         (try_end),
       (try_end),

       (ge, ":num_items_in_town_inventory", 1),

       (assign, ":already_best", 0),

       (try_begin),
         (eq, ":random_trade_good", ":best_result_1_item"),
         (eq, ":random_town", ":best_result_1_town"),
         (val_add, ":already_best", 1),
       (try_end),

	   (try_begin),
         (eq, ":random_trade_good", ":best_result_2_item"),
         (eq, ":random_town", ":best_result_2_town"),
         (val_add, ":already_best", 1),
       (try_end),

	   (try_begin),
         (eq, ":random_trade_good", ":best_result_3_item"),
         (eq, ":random_town", ":best_result_3_town"),
         (val_add, ":already_best", 1),
       (try_end),

	   (try_begin),
         (eq, ":random_trade_good", ":best_result_4_item"),
         (eq, ":random_town", ":best_result_4_town"),
         (val_add, ":already_best", 1),
       (try_end),

	   (try_begin),
         (eq, ":random_trade_good", ":best_result_5_item"),
         (eq, ":random_town", ":best_result_5_town"),
         (val_add, ":already_best", 1),
       (try_end),

       (le, ":already_best", 1),

       (store_item_value, ":random_trade_good_price", ":random_trade_good"),
       (assign, "$g_encountered_party", ":org_encountered_party"),
       (call_script, "script_game_get_item_buy_price_factor", ":random_trade_good"),
       (store_mul, ":random_trade_good_buy_price", ":random_trade_good_price", reg0),
       (val_div, ":random_trade_good_buy_price", 100),
       (val_max, ":random_trade_good_buy_price", 1),
       (assign, "$g_encountered_party", ":random_town"),
       (call_script, "script_game_get_item_sell_price_factor", ":random_trade_good"),
       (store_mul, ":random_trade_good_sell_price", ":random_trade_good_price", reg0),
       (val_div, ":random_trade_good_sell_price", 100),
       (val_max, ":random_trade_good_sell_price", 1),
       (store_sub, ":difference", ":random_trade_good_sell_price", ":random_trade_good_buy_price"),

       (try_begin),
	     (this_or_next|eq, ":best_result_1_item", ":random_trade_good"),
		 (this_or_next|eq, ":best_result_2_item", ":random_trade_good"),
		 (this_or_next|eq, ":best_result_3_item", ":random_trade_good"),
		 (this_or_next|eq, ":best_result_4_item", ":random_trade_good"),
		 (eq, ":best_result_5_item", ":random_trade_good"),

         (try_begin),
		   (eq, ":best_result_1_item", ":random_trade_good"),
		   (gt, ":difference", ":best_result_1_profit"),
           (assign, ":best_result_1_item", ":random_trade_good"),
           (assign, ":best_result_1_town", ":random_town"),
           (assign, ":best_result_1_profit", ":difference"),
         (else_try),
		   (eq, ":best_result_2_item", ":random_trade_good"),
		   (gt, ":difference", ":best_result_2_profit"),
           (assign, ":best_result_2_item", ":random_trade_good"),
           (assign, ":best_result_2_town", ":random_town"),
           (assign, ":best_result_2_profit", ":difference"),
		 (else_try),
		   (eq, ":best_result_3_item", ":random_trade_good"),
		   (gt, ":difference", ":best_result_3_profit"),
           (assign, ":best_result_3_item", ":random_trade_good"),
           (assign, ":best_result_3_town", ":random_town"),
           (assign, ":best_result_3_profit", ":difference"),
		 (else_try),
		   (eq, ":best_result_4_item", ":random_trade_good"),
		   (gt, ":difference", ":best_result_4_profit"),
           (assign, ":best_result_4_item", ":random_trade_good"),
           (assign, ":best_result_4_town", ":random_town"),
           (assign, ":best_result_4_profit", ":difference"),
		 (else_try),
		   (eq, ":best_result_5_item", ":random_trade_good"),
		   (gt, ":difference", ":best_result_5_profit"),
           (assign, ":best_result_5_item", ":random_trade_good"),
           (assign, ":best_result_5_town", ":random_town"),
           (assign, ":best_result_5_profit", ":difference"),
		 (try_end),
	   (else_try),
       (try_begin),
         (gt, ":difference", ":best_result_1_profit"),
         (val_add, ":num_best_results", 1),
           (val_min, ":num_best_results", 5),
           (assign, ":best_result_5_item", ":best_result_4_item"),
           (assign, ":best_result_5_town", ":best_result_4_town"),
           (assign, ":best_result_5_profit", ":best_result_4_profit"),
           (assign, ":best_result_4_item", ":best_result_3_item"),
           (assign, ":best_result_4_town", ":best_result_3_town"),
           (assign, ":best_result_4_profit", ":best_result_3_profit"),
         (assign, ":best_result_3_item", ":best_result_2_item"),
         (assign, ":best_result_3_town", ":best_result_2_town"),
         (assign, ":best_result_3_profit", ":best_result_2_profit"),
         (assign, ":best_result_2_item", ":best_result_1_item"),
         (assign, ":best_result_2_town", ":best_result_1_town"),
         (assign, ":best_result_2_profit", ":best_result_1_profit"),
         (assign, ":best_result_1_item", ":random_trade_good"),
         (assign, ":best_result_1_town", ":random_town"),
         (assign, ":best_result_1_profit", ":difference"),
       (else_try),
         (gt, ":difference", ":best_result_2_profit"),
         (val_add, ":num_best_results", 1),
           (val_min, ":num_best_results", 5),
           (assign, ":best_result_5_item", ":best_result_4_item"),
           (assign, ":best_result_5_town", ":best_result_4_town"),
           (assign, ":best_result_5_profit", ":best_result_4_profit"),
           (assign, ":best_result_4_item", ":best_result_3_item"),
           (assign, ":best_result_4_town", ":best_result_3_town"),
           (assign, ":best_result_4_profit", ":best_result_3_profit"),
         (assign, ":best_result_3_item", ":best_result_2_item"),
         (assign, ":best_result_3_town", ":best_result_2_town"),
         (assign, ":best_result_3_profit", ":best_result_2_profit"),
         (assign, ":best_result_2_item", ":random_trade_good"),
         (assign, ":best_result_2_town", ":random_town"),
         (assign, ":best_result_2_profit", ":difference"),
       (else_try),
         (gt, ":difference", ":best_result_3_profit"),
         (val_add, ":num_best_results", 1),
           (val_min, ":num_best_results", 5),
           (assign, ":best_result_5_item", ":best_result_4_item"),
           (assign, ":best_result_5_town", ":best_result_4_town"),
           (assign, ":best_result_5_profit", ":best_result_4_profit"),
           (assign, ":best_result_4_item", ":best_result_3_item"),
           (assign, ":best_result_4_town", ":best_result_3_town"),
           (assign, ":best_result_4_profit", ":best_result_3_profit"),
         (assign, ":best_result_3_item", ":random_trade_good"),
         (assign, ":best_result_3_town", ":random_town"),
         (assign, ":best_result_3_profit", ":difference"),
         (else_try),
           (gt, ":difference", ":best_result_4_profit"),
           (val_add, ":num_best_results", 1),
           (val_min, ":num_best_results", 5),
           (assign, ":best_result_5_item", ":best_result_4_item"),
           (assign, ":best_result_5_town", ":best_result_4_town"),
           (assign, ":best_result_5_profit", ":best_result_4_profit"),
           (assign, ":best_result_4_item", ":random_trade_good"),
           (assign, ":best_result_4_town", ":random_town"),
           (assign, ":best_result_4_profit", ":difference"),
         (else_try),
           (gt, ":difference", ":best_result_5_profit"),
           (val_add, ":num_best_results", 1),
           (val_min, ":num_best_results", 5),
           (assign, ":best_result_5_item", ":best_result_4_item"),
           (assign, ":best_result_5_town", ":best_result_4_town"),
           (assign, ":best_result_5_profit", ":best_result_4_profit"),
         (try_end),
       (try_end),
     (try_end),

     (assign, "$g_encountered_party", ":org_encountered_party"),

     (str_clear, s3),

     (assign, reg2, ":max_skill"),
     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s1, ":max_skill_owner"),
     (try_end),
     (try_begin),
       (le, ":num_best_results", 0),
       (str_store_string, s2, "@However, {reg3?You are:{s1} is} unable to find any trade goods that would bring a profit."),
     (else_try),
        #SB : add lesser renown bonus
        (try_begin),
          (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
          (neq, reg1, "trp_player"),
          (call_script, "script_change_troop_renown", reg1, dplmc_companion_skill_renown / 2),
        (try_end),
       (try_begin),
         (ge, ":best_result_5_item", 0),
         (assign, reg6, ":best_result_5_profit"),
         (str_store_item_name, s4, ":best_result_5_item"),
         (str_store_party_name, s5, ":best_result_5_town"),
         (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} denars per item.{s3}"),
       (try_end),
       (try_begin),
         (ge, ":best_result_4_item", 0),
         (assign, reg6, ":best_result_4_profit"),
         (str_store_item_name, s4, ":best_result_4_item"),
         (str_store_party_name, s5, ":best_result_4_town"),
         (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} denars per item.{s3}"),
       (try_end),
       (try_begin),
         (ge, ":best_result_3_item", 0),
         (assign, reg6, ":best_result_3_profit"),
         (str_store_item_name, s4, ":best_result_3_item"),
         (str_store_party_name, s5, ":best_result_3_town"),
         (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} denars per item.{s3}"),
       (try_end),
       (try_begin),
         (ge, ":best_result_2_item", 0),
         (assign, reg6, ":best_result_2_profit"),
         (str_store_item_name, s4, ":best_result_2_item"),
         (str_store_party_name, s5, ":best_result_2_town"),
         (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} denars per item.{s3}"),
       (try_end),
       (try_begin),
         (ge, ":best_result_1_item", 0),
         (assign, reg6, ":best_result_1_profit"),
         (str_store_item_name, s4, ":best_result_1_item"),
         (str_store_party_name, s5, ":best_result_1_town"),
         (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} denars per item.{s3}"),
       (try_end),
       (str_store_string, s2, "@{reg3?You find:{s1} finds} out the following:^{s3}"),
     (try_end),
     ],
    [
      ("continue",[],"Continue...",
       [
           (jump_to_menu,"mnu_town_trade"),
        ]),
    ]
  ),

  #SB : flavour text
  (
    "sneak_into_town_suceeded",0,
    "Disguised in the garments of a poor {reg1?cheater:{s1}}, you fool the guards and make your way into the town.",
    "none",
    [(assign, reg1, "$cheat_mode"),
     (call_script, "script_get_disguise_string", "$sneaked_into_town", 1),

     # (try_begin),
       # (eq, "$sneaked_into_town", disguise_pilgrim),
       # (assign, ":string", "str_pilgrim_disguise"),
     # (try_end),
    ],
    [
      ("continue",[],"Continue...",
       [
           # (assign, "$sneaked_into_town",1),
           (jump_to_menu,"mnu_town"),
        ]),
    ]
  ),
  (
    "sneak_into_town_caught",0,
    "As you try to sneak in, one of the guards recognizes you and raises the alarm!\
 You must flee back through the gates before all the guards in the town come down on you!",
    "none",
    [
       (assign,"$auto_menu","mnu_captivity_start_castle_surrender"),
    ],
    [
      ("sneak_caught_fight",[],"Try to fight your way out!",
       [
           (assign,"$all_doors_locked",1),
           (party_get_slot, ":sneak_scene", "$current_town", slot_town_center), # slot_town_gate),
           (modify_visitors_at_site,":sneak_scene"),
           (reset_visitors),

           (set_jump_mission, "mt_sneak_caught_fight"),

           (try_begin),
             (this_or_next|eq, "$talk_context", tc_escape),
             (eq, "$talk_context", tc_prison_break),
             (assign, ":entry_no", 7),
           (else_try),
             (party_slot_eq, "$current_town", slot_party_type, spt_town),
             #(set_visitor,0,"trp_player"),
             (assign, ":entry_no", 0),
           (else_try),
             #(set_visitor,1,"trp_player"),
             (assign, ":entry_no", 1),
           (try_end),

           (try_begin),
             (gt, "$sneaked_into_town", disguise_none), #setup disguise
             (assign, ":override_state", af_override_everything),
             (mission_tpl_entry_set_override_flags, "mt_sneak_caught_fight", ":entry_no", ":override_state"),
                        #SB : script call to assign correct disguise, with weapons
             (call_script, "script_set_disguise_override_items", "mt_sneak_caught_fight", ":entry_no", 1),
           (try_end),

           (set_jump_entry, ":entry_no"),

           #(store_faction_of_party, ":town_faction","$current_town"),
           #(faction_get_slot, ":tier_2_troop", ":town_faction", slot_faction_tier_2_troop),
           #(faction_get_slot, ":tier_3_troop", ":town_faction", slot_faction_tier_3_troop),
           #(try_begin),
           #  (gt, ":tier_2_troop", 0),
           #  (gt, ":tier_3_troop", 0),
           #  (assign,reg0,":tier_3_troop"),
           #  (assign,reg1,":tier_3_troop"),
           #  (assign,reg2,":tier_2_troop"),
           #  (assign,reg3,":tier_2_troop"),
           #(else_try),
           #  (assign,reg0,"trp_swadian_skirmisher"),
           #  (assign,reg1,"trp_swadian_crossbowman"),
           #  (assign,reg2,"trp_swadian_infantry"),
           #  (assign,reg3,"trp_swadian_crossbowman"),
           #(try_end),
           #(assign,reg4,-1),
           #(shuffle_range,0,5),
           #(set_visitor,2,reg0),
           #(set_visitor,3,reg1),
           #(set_visitor,4,reg2),
           #(set_visitor,5,reg3),

           #(set_jump_mission, "mt_sneak_caught_fight"),
           (set_passage_menu, "mnu_town"),
           (jump_to_scene,":sneak_scene"),
           (change_screen_mission),
        ]),
      ("sneak_caught_surrender",[],"Surrender.",
       [
           (jump_to_menu,"mnu_captivity_start_castle_surrender"),
        ]),
    ]
  ),
  (
    "sneak_into_town_caught_dispersed_guards",0,
    "You drive off the guards and cover your trail before running off, easily losing your pursuers in the maze of streets.",
    "none",
    [],
    [
      ("continue",[],"Continue...",
       [
           (try_begin),
               (eq, "$sneaked_into_town", 0),
               (assign, "$sneaked_into_town",1),
           (try_end),

           (assign, "$town_entered", 1),
           #(assign, "$g_mt_mode", tcm_disguised),
           (jump_to_menu,"mnu_town"),
        ]),
    ]
  ),

(
    "sneak_into_town_caught_ran_away",0,
    "You make your way back through the gates and quickly retreat to the safety of the countryside.{s11}",
    "none",
    [

	(str_clear, s11),
	(assign, ":at_least_one_escaper_caught", 0),
	(assign, ":end_cond", kingdom_ladies_end),
	(try_for_range, ":prisoner", active_npcs_begin, ":end_cond"),
        (try_begin),
            (troop_slot_eq, ":prisoner", slot_troop_mission_participation, mp_prison_break_escaped),
            (assign, "$talk_context", tc_hero_freed),
            (assign, reg14, ":prisoner"),

            (call_script, "script_dplmc_remove_disguise"),

            (call_script, "script_setup_troop_meeting", ":prisoner", -1, -1),
            (troop_set_slot, ":prisoner", slot_troop_mission_participation, -1),

            (troop_get_slot, ":prison_center", ":prisoner", slot_troop_prisoner_of_party),
            (party_remove_prisoners, ":prison_center", ":prisoner", 1),
            (troop_set_slot, ":prisoner", slot_troop_prisoner_of_party, -1),

            (assign, ":end_cond", -1), #maybe more than 1 should be able to escape?
        (else_try),
            (troop_slot_eq, ":prisoner", slot_troop_mission_participation, mp_prison_break_caught),
            (str_store_troop_name, s12, ":prisoner"),
            (try_begin),
                (eq, ":at_least_one_escaper_caught", 0),
                (str_store_string, s11, "str_s11_unfortunately_s12_was_wounded_and_had_to_be_left_behind"),
            (else_try),
                (str_store_string, s11, "str_s11_also_s12_was_wounded_and_had_to_be_left_behind"),
            (try_end),
            (assign, ":at_least_one_escaper_caught", 1),
        (try_end),

        (troop_set_slot, ":prisoner", slot_troop_mission_participation, 0), #new
	(try_end),
	],
    [

    ("continue",[],"Continue...",[
    (assign,"$auto_menu",-1),
    (store_encountered_party,"$last_sneak_attempt_town"),
    (store_current_hours,"$last_sneak_attempt_time"),
    (change_screen_return),
    ]),

    ]
),

("enemy_offer_ransom_for_prisoner",0,
  "The family of {s1}, from {s2}, offers you a sum of {reg12} denars in silver if you are willing to sell him.",
  "none",[
    (call_script, "script_calculate_ransom_amount_for_troop", "$g_ransom_offer_troop"),
    (assign, reg12, reg0),
    (str_store_troop_name, s1, "$g_ransom_offer_troop"),
    (store_troop_faction, ":faction_no", "$g_ransom_offer_troop"),
    (str_store_faction_name, s2, ":faction_no"),
    #SB : add tableau
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 70),
    (position_set_y, pos0, 5),
    (position_set_z, pos0, 75),
    (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", "$g_ransom_offer_troop", pos0),
  ],[
  ("ransom_accept",[],"Accept the offer.",[
    (try_begin),
      (gt, "$g_player_chamberlain", 0),
      (call_script, "script_dplmc_pay_into_treasury", reg12),
    (else_try),
    ##diplomacy end
      (troop_add_gold, "trp_player", reg12),
    ##diplomacy begin
    (try_end),
    ##diplomacy end
		##diplomacy start+
		#The enemy actually loses the gold paid.
		(assign, ":gold_paid", reg12),
		(assign, ":lord_who_pays", "$g_ransom_offer_troop"),
		(store_troop_faction, ":faction_no", "$g_ransom_offer_troop"),
		#For kingdom ladies, someone else might pay.
		(try_begin),
			(is_between, "$g_ransom_offer_troop", kingdom_ladies_begin, kingdom_ladies_end),
			(neg|troop_slot_eq, "$g_ransom_offer_troop", slot_troop_occupation, slto_kingdom_hero),#I think at this step even for heroes it's 0
			(neg|troop_slot_ge, "$g_ransom_offer_troop", slot_troop_wealth, 1),
			(try_begin),
				#Check spouse pays
				(troop_get_slot, ":lord", "$g_ransom_offer_troop", slot_troop_spouse),
				(this_or_next|is_between, ":lord", active_npcs_begin, active_npcs_end),
					(troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
				(store_troop_faction, ":lord_faction", ":lord"),
				(eq, ":faction_no", ":lord_faction"),
				(neg|troop_slot_ge, ":lord", slot_troop_occupation, slto_retirement),
				(assign, ":lord_who_pays", ":lord"),
			(else_try),
				#Check father pays
				(troop_get_slot, ":lord", "$g_ransom_offer_troop", slot_troop_father),
				(this_or_next|is_between, ":lord", active_npcs_begin, active_npcs_end),
					(troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
				(store_troop_faction, ":lord_faction", ":lord"),
				(eq, ":faction_no", ":lord_faction"),
				(neg|troop_slot_ge, ":lord", slot_troop_occupation, slto_retirement),
				(assign, ":lord_who_pays", ":lord"),
			(else_try),
				#Check guardian pays
				(troop_get_slot, ":lord", "$g_ransom_offer_troop", slot_troop_guardian),
				(this_or_next|is_between, ":lord", active_npcs_begin, active_npcs_end),
        (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
				(store_troop_faction, ":lord_faction", ":lord"),
				(eq, ":faction_no", ":lord_faction"),
				(neg|troop_slot_ge, ":lord", slot_troop_occupation, slto_retirement),
				(assign, ":lord_who_pays", ":lord"),
			(else_try),
				#Check mother pays
				(troop_get_slot, ":lord", "$g_ransom_offer_troop", slot_troop_mother),
				(this_or_next|is_between, ":lord", active_npcs_begin, active_npcs_end),
        (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
				(store_troop_faction, ":lord_faction", ":lord"),
				(eq, ":faction_no", ":lord_faction"),
				(neg|troop_slot_ge, ":lord", slot_troop_occupation, slto_retirement),
				(assign, ":lord_who_pays", ":lord"),
			(try_end),
      #SB : copy from dialogues
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_ransom_offer_troop"),
      (assign, ":new_location", reg1),
      (troop_set_slot, "$g_ransom_offer_troop", slot_troop_cur_center, ":new_location"),
		(try_end),
		(try_begin),
			(ge, ":gold_paid", 0),
			(ge, ":lord_who_pays", 1),
			(troop_is_hero, ":lord_who_pays"),
			#Remove the gold.  The lady has her own funds (e.g. from her dower)
			#that will partially defray the expense to the lord, depending on
			#the campaign difficulty.
		    (game_get_reduce_campaign_ai, ":reduce_campaign_ai"),
		    (try_begin),
			   (eq, ":reduce_campaign_ai", 0), #hard: lord pays 50%, lady's resources pay for 50%
			   (val_div, ":gold_paid", 2),
		    (else_try),
			   (eq, ":reduce_campaign_ai", 1), #medium: lord pays 75%, lady's resources pay for 25%
			   (val_mul, ":gold_paid", 3),
			   (val_div, ":gold_paid", 4),
		    (try_end),#easy: lord pays 100%, lady pays nothing
			(call_script, "script_dplmc_remove_gold_from_lord_and_holdings", ":gold_paid", ":lord_who_pays"),
		(try_end),
		##diplomacy end+
    (party_remove_prisoners, "$g_ransom_offer_party", "$g_ransom_offer_troop", 1),
    (call_script, "script_remove_troop_from_prison", "$g_ransom_offer_troop"),
    (change_screen_return),
  ]),
  ("ransom_reject",[],"Reject the offer.",[
    ##diplomacy start+
    #Relation loss altered by lord personality type.
    #OLD:
      #(call_script, "script_change_player_relation_with_troop", "$g_ransom_offer_troop", -4),
    #NEW:
    (try_begin),
      (troop_slot_eq, "$g_ransom_offer_troop", slot_lord_reputation_type, lrep_quarrelsome),
      (call_script, "script_change_player_relation_with_troop", "$g_ransom_offer_troop", -6),
    (else_try),
      (troop_slot_eq, "$g_ransom_offer_troop", slot_lord_reputation_type, lrep_debauched),
      (call_script, "script_change_player_relation_with_troop", "$g_ransom_offer_troop", -5),
    (else_try),
      (call_script, "script_change_player_relation_with_troop", "$g_ransom_offer_troop", -4),
    (try_end),
    ##diplomacy end+
    (call_script, "script_change_player_honor", -1),
    (assign, "$g_ransom_offer_rejected", 1),
    ##diplomacy start+
    #TODO: Review this, it was partway through a redesign when I stopped.
    #Also apply a negative reaction modifier to other lords
    (assign, ":save_reg0", reg0),

    (store_faction_of_troop, ":captive_faction", "$g_ransom_offer_troop"),
    #For kingdom ladies:
    (try_begin),
      (is_between, "$g_ransom_offer_troop", kingdom_ladies_begin, kingdom_ladies_end),
      #(troop_slot_eq, "$g_ransom_offer_troop", slot_troop_occupation, slto_kingdom_lady),
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_talk_troop"),
      (assign, ":guardian", reg0),
      (store_faction_of_troop, ":captive_faction", ":guardian"),

      (try_for_range, ":troop_no", heroes_begin, kingdom_ladies_end),
        (troop_slot_ge, ":troop_no", slot_troop_occupation, slto_kingdom_hero),#lowest valid
        (neg|troop_slot_ge, ":troop_no", slot_troop_occupation, slto_robber_knight),#end of valid range
        (neq, "$g_ransom_offer_troop", ":troop_no"),
        (store_faction_of_troop, ":troop_faction", ":troop_no"),

        (assign, ":disapproval_threshold", 20),
        (try_begin),
          (neq, ":troop_faction", ":captive_faction"),
          (neg|is_between, ":troop_no", kingdom_ladies_begin, kingdom_ladies_end),
          (assign, ":disapproval_threshold", 40),
        (try_end),
        #(this_or_next|is_between, ":troop_no", kingdom_ladies_begin, kingdom_ladies_end),
        #	(eq, ":troop_faction", ":captive_faction"),
        (assign, ":relation_change", 0),
        #family
        (try_begin),
          (this_or_next|troop_slot_eq, ":troop_no", slot_troop_spouse, "$g_ransom_offer_troop"),
          (this_or_next|troop_slot_eq, "$g_ransom_offer_troop", slot_troop_spouse, ":troop_no"),
          (eq, ":guardian", ":troop_no"),
          (assign, ":relation_change", -4),
        (else_try),
          (eq, ":troop_no", slot_troop_betrothed, "$g_ransom_offer_troop"),
          (assign, ":relation_change", -4),
        (else_try),
          (call_script, "script_troop_get_family_relation_to_troop", "$g_ransom_offer_troop", ":troop_no"),
          (ge, reg0, 14),
          (assign, ":relation_change", -3),
        (else_try),
          (ge, reg0, 10),
          (assign, ":relation_change", -2),
        (else_try),
          (ge, reg0, 2),
          (assign, ":relation_change", -1),
        (else_try),
          (call_script, "script_troop_get_relation_with_troop", ":troop_no", "$g_ransom_offer_troop"),
          (ge, reg0, ":disapproval_threshold"),
          (this_or_next|is_between, ":troop_no", kingdom_ladies_begin, kingdom_ladies_end),
            (eq, ":troop_faction", ":captive_faction"),
          (assign, ":relation_change", -1),
        (else_try),
          (ge, ":guardian", 1),
          (call_script, "script_troop_get_relation_with_troop", ":troop_no", ":guardian"),
          (ge, reg0, ":disapproval_threshold"),
          (assign, ":relation_change", -1),
        (try_end),
        (lt, ":relation_change", 0),
        (try_begin),
          (troop_slot_eq, ":troop_no", slot_lord_reputation_type, lrep_quarrelsome),
          (val_mul, ":relation_change", 3),#-1 to -2, -2 to -3, -3 to -5, -4 to -6
          (val_sub, ":relation_change", 1),
          (val_div, ":relation_change", 2),
        (try_end),
        (call_script, "script_change_player_relation_with_troop", ":troop_no", ":relation_change"),
      (try_end),
    (else_try),
      #For others:
      (is_between, "$g_ransom_offer_troop", active_npcs_begin, active_npcs_end),
      (try_for_range, ":hero", heroes_begin, kingdom_ladies_end),
        (this_or_next|is_between, ":hero", active_npcs_begin, active_npcs_end),
        (troop_slot_eq, ":hero", slot_troop_occupation, slto_kingdom_hero),
        (neg|troop_slot_eq, ":hero", slot_troop_occupation, dplmc_slto_dead),
        (neg|troop_slot_ge, ":hero", slot_troop_occupation, slto_retirement),
        (neq, ":hero", "$g_ransom_offer_troop"),

        (store_faction_of_troop, ":troop_faction", ":hero"),
        (assign, ":relation_change", 0),
        (call_script, "script_troop_get_family_relation_to_troop", "$g_ransom_offer_troop", ":hero"),
        (try_begin),
          (ge, reg0, 10),
          (assign, ":relation_change", -1),
        (try_end),
        (call_script, "script_troop_get_relation_with_troop", ":hero", "$g_ransom_offer_troop"),
        (try_begin),
          (ge, reg0, 20),
          (eq, ":troop_faction", ":captive_faction"),
          (val_sub, ":relation_change", 1),
        (else_try),
          (ge, reg0, 40),
          (val_sub, ":relation_change", 1),
        (else_try),
          (lt, reg0, 0),
          (assign, ":relation_change", 0),
        (try_end),
        (lt, ":relation_change", 0),
        (try_begin),
          (troop_slot_eq, ":hero", slot_lord_reputation_type, lrep_quarrelsome),
          (val_mul, ":relation_change", 3),#-1 to -2, -2 to -3, -3 to -5, -4 to -6
          (val_sub, ":relation_change", 1),
          (val_div, ":relation_change", 2),
        (try_end),
        (call_script, "script_change_player_relation_with_troop", ":hero", ":relation_change"),
      (try_end),

      (try_for_range, ":lady", kingdom_ladies_begin, kingdom_ladies_end),
        (neg|troop_slot_eq, ":lady", slot_troop_occupation, slto_kingdom_hero),
        (neg|troop_slot_eq, ":lady", slot_troop_occupation, dplmc_slto_dead),
        (neg|troop_slot_ge, ":lady", slot_troop_occupation, slto_retirement),
        (neq, ":lady", "$g_ransom_offer_troop"),
        (assign, ":relation_change", 0),
        (call_script, "script_troop_get_family_relation_to_troop", ":lady", "$g_ransom_offer_troop"),
        (try_begin),
          (ge, reg0, 14),
          (assign, ":relation_change", -3),
        (else_try),
          (ge, reg0, 10),
          (assign, ":relation_change", -2),
        (else_try),
          (ge, reg0, 2),
          (assign, ":relation_change", -1),
        (else_try),
          (call_script, "script_troop_get_relation_with_troop", ":lady", "$g_ransom_offer_troop"),
          (ge, reg0, 20),
          (assign, ":relation_change", -1),
        (try_end),
        (lt, ":relation_change", 0),
        (call_script, "script_change_player_relation_with_troop", ":lady", ":relation_change"),
      (try_end),
    (try_end),
    (assign, reg0, ":save_reg0"),
    ##diplomacy end+
    (change_screen_return),
  ]),
]),

  (
    "training_ground",0,
    "You approach a training field where you can practice your martial skills. What kind of training do you want to do?",
    "none",
    [
      (try_begin), #SB : track slot
        (party_get_slot, ":scene_no", slot_grounds_track, "$g_encountered_party"),
        (le, ":scene_no", 0),
        (store_add, ":scene_no", "scn_training_ground_horse_track_1", "$g_encountered_party"),
        (val_sub, ":scene_no", training_grounds_begin),
        (party_set_slot, "$g_encountered_party", slot_grounds_track, ":scene_no"),
      (try_end),
      (try_begin), #SB : melee/ranged slot
        (party_get_slot, ":scene_no", slot_grounds_melee, "$g_encountered_party"),
        (le, ":scene_no", 0),
        (store_add, ":scene_no", "scn_training_ground_ranged_melee_1", "$g_encountered_party"),
        (val_sub, ":scene_no", training_grounds_begin),
        (party_set_slot, "$g_encountered_party", slot_grounds_melee, ":scene_no"),
      (try_end),
      (assign, "$g_training_ground_melee_training_scene", ":scene_no"),

      #SB : modify this interval
      (party_get_skill_level, ":training", "p_main_party", "skl_trainer"), #from 0 to 10
      (try_begin), #grab trainer troop if it isn't linked
        (party_get_slot, ":trainer_troop", "$g_encountered_party", slot_grounds_trainer),
        (try_begin),
          (le, ":trainer_troop", 0),
          (store_sub, ":trainer_troop", "$g_encountered_party", training_grounds_begin),
          (val_add, ":trainer_troop", training_ground_trainers_begin),
          (party_set_slot, "$g_encountered_party", slot_grounds_trainer, ":trainer_troop"),
        (try_end),
        (troop_get_slot, ":difficulty", ":trainer_troop", slot_troop_trainer_training_difficulty), #from 0 to 4
        (val_add, ":training", ":difficulty"), #0 to 14
      (try_end),
      (val_div, ":training", 2), #0 to 7
      (val_max, ":training", 3),
      (try_begin), #was $g_training_ground_training_count
        (party_slot_ge, "$g_encountered_party", slot_grounds_count, ":training"),
        (party_set_slot, "$g_encountered_party", slot_grounds_count, 0),
        # (assign, "$g_training_ground_training_count", 0),
        (rest_for_hours, 1, 5, 0), #rest while not attackable
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      (try_end),
      #SB : set background mesh, player troop
      (assign, "$g_player_troop", "trp_player"),
      (set_background_mesh, "mesh_pic_recruits"),
      ],
    [
      ("camp_trainer",
       [], "Speak with the trainer.",
       [
         (set_jump_mission, "mt_training_ground_trainer_talk"),
         # no need to reset visitors, trainer is always there
         (modify_visitors_at_site, "$g_training_ground_melee_training_scene"),
         (reset_visitors),
         (set_visitor, 7, "trp_veteran_fighter"),
         (set_visitor, 21, "trp_champion_fighter"),
         (set_jump_entry, 5),
         (jump_to_scene, "$g_training_ground_melee_training_scene"),
         (change_screen_mission),
         (music_set_situation, 0),
         ]),
      ("camp_train_melee",
       [
         (neg|troop_is_wounded, "trp_player"),
         (call_script, "script_party_count_fit_for_battle", "p_main_party"),
         (gt, reg0, 1),
         ], "Sparring practice.",
       [
         (assign, "$g_mt_mode", ctm_melee),
         (jump_to_menu, "mnu_training_ground_selection_details_melee_1"),
         (music_set_situation, 0),
         ]),
      ("camp_train_archery",[], "Ranged weapon practice.",
       [
         (jump_to_menu, "mnu_training_ground_selection_details_ranged_1"),
         (music_set_situation, 0),
         ]),
      ("camp_train_mounted",[], "Horseback practice.",
       [
         (assign, "$g_mt_mode", ctm_mounted),
         (jump_to_menu, "mnu_training_ground_selection_details_mounted"),
         (music_set_situation, 0),
         ]),

      ("go_to_track",[(eq, "$cheat_mode", 1)],"{!}Cheat: Go to track.",
       [
         (set_jump_mission, "mt_ai_training"),
         (try_begin), #SB : slots
           (party_get_slot, ":scene_no", slot_grounds_track, "$g_encountered_party"),
           (le, ":scene_no", 0),
           (store_add, ":scene_no", "scn_training_ground_horse_track_1", "$g_encountered_party"),
           (val_sub, ":scene_no", training_grounds_begin),
         (try_end),
         (jump_to_scene, ":scene_no"),
         (change_screen_mission),
        ]
       ),
      ("go_to_range",[(eq, "$cheat_mode", 1)],"{!}Cheat: Go to range.",
       [
         (set_jump_mission, "mt_ai_training"),
         (jump_to_scene, "$g_training_ground_melee_training_scene"),
         (change_screen_mission),
        ]
       ),
      ("leave",[],"Leave.",
       [(change_screen_return),
        ]),
    ]
  ),

  ("training_ground_selection_details_melee_1",0,
   "How many opponents will you go against?",
   "none",
   [
     (call_script, "script_write_fit_party_members_to_stack_selection", "p_main_party", 1),
     (troop_get_slot, "$temp", "trp_stack_selection_amounts", 1), #number of men fit
     (assign, "$temp_2", 1),
     ],
    [
      ("camp_train_melee_num_men_1",[(ge, "$temp", 1)], "One.",
       [
         (assign, "$temp", 1),
         (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
         ]),
      ("camp_train_melee_num_men_2",[(ge, "$temp", 2)], "Two.",
       [
         (assign, "$temp", 2),
         (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
         ]),
      ("camp_train_melee_num_men_3",[(ge, "$temp", 3)], "Three.",
       [
         (assign, "$temp", 3),
         (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
         ]),
      ("camp_train_melee_num_men_4",[(ge, "$temp", 4)], "Four.",
       [
         (assign, "$temp", 4),
         (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
         ]),
      ("go_back_dot",[],"Cancel.",
       [
         (jump_to_menu, "mnu_training_ground"),
        ]),
      ]
  ),

  ("training_ground_selection_details_melee_2",0,
   "Choose your opponent:^{s1}^{reg1}:",
   "none",
    [
      (assign, reg1, "$temp_2"),
      (troop_get_slot, "$temp_3", "trp_stack_selection_amounts", 0), #number of slots

      #SB : show current list
      (str_clear, s1),
      (store_sub, ":end", "$temp_2", 1),
      (try_for_range, ":slot_index", 0, ":end"),
        (store_add, reg0, ":slot_index", 1),
        (troop_get_slot, ":troop_id", "trp_temp_array_a", ":slot_index"),
        (gt, ":troop_id", 0),
        (str_store_troop_name, s2, ":troop_id"),
        (str_store_string, s1, "@{s1}^{reg0}: {s2}"),
      # (else_try),
        # (str_store_string, s1, "@{s1}^{reg0}:"),
      (try_end),
    ],
    [
      ("training_ground_selection_details_melee_random", [], "Choose randomly.",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", -1),]),
      ("go_back_dot",[],"Go back.",
       [(jump_to_menu, "mnu_training_ground"),]
       ), #SB : stack built from loop
      ]+
      [("stack"+str(x), [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", x),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", x),])
       for x in range(1, 20)]
  ),

  ("training_ground_selection_details_mounted",0,
   "What kind of weapon do you want to train with?",
   "none",
   [
   #SB : background mesh
   (set_background_mesh, "mesh_pic_mb_warrior_2"),
   ],
    [
      ("camp_train_mounted_details_1",[], "One handed weapon.",
       [
         (call_script, "script_start_training_at_training_ground", itp_type_one_handed_wpn, 0),
         ]),
      ("camp_train_mounted_details_2",[], "Polearm.",
       [
         (call_script, "script_start_training_at_training_ground", itp_type_polearm, 0),
         ]),
      ("camp_train_mounted_details_3",[], "Bow.",
       [
         (call_script, "script_start_training_at_training_ground", itp_type_bow, 0),
         ]),
      ("camp_train_mounted_details_4",[], "Thrown weapon.",
       [
         (call_script, "script_start_training_at_training_ground", itp_type_thrown, 0),
         ]),
      ("go_back_dot",[],"Go back.",
       [(jump_to_menu, "mnu_training_ground"),
        ]
       ),
      ]
  ),

  ("training_ground_selection_details_ranged_1",0,
   "What kind of ranged weapon do you want to train with?",
   "none",
   [
   (set_background_mesh, "mesh_pic_mb_warrior_4"), #SB : background mesh
   ],
    [
      ("camp_train_ranged_weapon_bow",[], "Bow and arrows.",
       [
         (assign, "$g_mt_mode", ctm_ranged),
         (assign, "$temp", itp_type_bow),
         (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
         ]),
      # ("camp_train_ranged_weapon_crossbow",[], "Crossbow.",
       # [
         # (assign, "$g_mt_mode", ctm_ranged),
         # (assign, "$temp", itp_type_crossbow),
         # (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
         # ]),
      ("camp_train_ranged_weapon_thrown",[], "Throwing Knives.",
       [
         (assign, "$g_mt_mode", ctm_ranged),
         (assign, "$temp", itp_type_thrown),
         (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
         ]),
      ("go_back_dot",[],"Go back.",
       [(jump_to_menu, "mnu_training_ground"),
        ]
       ),
      ]
  ),

  ("training_ground_selection_details_ranged_2",0,
   "What range do you want to practice at?",
   "none",
   [
   (set_background_mesh, "mesh_pic_mb_warrior_4"), #SB : background mesh
   ],
    [
      ("camp_train_ranged_details_1",[], "10 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 10),
         ]),
      ("camp_train_ranged_details_2",[], "20 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 20),
         ]),
      ("camp_train_ranged_details_3",[], "30 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 30),
         ]),
      ("camp_train_ranged_details_4",[], "40 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 40),
         ]),
      ("camp_train_ranged_details_5",[(eq, "$g_mt_mode", ctm_ranged),], "50 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 50),
         ]),
      ("camp_train_ranged_details_6",[(eq, "$g_mt_mode", ctm_ranged),], "60 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 60),
         ]),
      ("camp_train_ranged_details_7",[(eq, "$g_mt_mode", ctm_ranged),], "70 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 70),
         ]),
      ("go_back_dot",[],"Go back.",
       [(jump_to_menu, "mnu_training_ground"),
        ]
       ),
      ]
  ),

  ("training_ground_description",0,
   "{s0}",
   "none",
   [
   #Sb : format string here instead of script_start_training_at_training_ground
   (store_sub, reg0, "$g_training_ground_training_num_enemies", 1),
   (store_sub, ":string", "$g_mt_mode", 1),
   (val_add, ":string", "str_ctm_melee"),
   (str_store_string, s0, ":string"),

   ],
    [
      ("continue", [], "Continue...",
       [
         (jump_to_scene, "$g_training_ground_training_scene"),
         (change_screen_mission),
        ]
       ),
      ]
  ),

  ("training_ground_training_result",mnf_disable_all_keys,
   "{s7}{s2}",
   "none",
   [
     (store_skill_level, ":trainer_skill", "skl_trainer", "trp_player"),
     (store_add, ":trainer_skill_multiplier", 5, ":trainer_skill"),
     (call_script, "script_write_fit_party_members_to_stack_selection", "p_main_party", 1),
     (str_clear, s2),
     (troop_get_slot, ":num_fit", "trp_stack_selection_amounts", 1),
     (troop_get_slot, ":num_slots", "trp_stack_selection_amounts", 0),
     (try_begin),
       (gt, "$g_training_ground_training_success_ratio", 0),
       (store_mul, ":xp_ratio_to_add", "$g_training_ground_training_success_ratio", "$g_training_ground_training_success_ratio"),
       (try_begin),
         (eq, "$g_training_ground_training_success_ratio", 100),
         (val_mul, ":xp_ratio_to_add", 2), #2x when perfect
       (try_end),
       (try_begin),
         (eq, "$g_mt_mode", ctm_melee),
         (val_div, ":xp_ratio_to_add", 3),
         (val_mul, ":xp_ratio_to_add", 2),
       (try_end),
      ##Nero Claudius: training should be a reward, it is quite annoying
	  # (val_div, ":xp_ratio_to_add", 10), # value over 1000
       (try_begin),
         (gt, ":num_fit", 8),
         (val_mul, ":xp_ratio_to_add", 3),
         (assign, ":divisor", ":num_fit"),
         (convert_to_fixed_point, ":divisor"),
         (store_sqrt, ":divisor", ":divisor"),
         (convert_to_fixed_point, ":xp_ratio_to_add"),
         (val_div, ":xp_ratio_to_add", ":divisor"),
       (try_end),
##       (assign, reg0, ":xp_ratio_to_add"),
##       (display_message, "@xp earn ratio: {reg0}/1000"),
       (store_mul, ":xp_ratio_to_add_with_trainer_skill", ":xp_ratio_to_add", ":trainer_skill_multiplier"),
       (val_div, ":xp_ratio_to_add_with_trainer_skill", 10),
       (party_get_num_companion_stacks, ":num_stacks", "p_main_party"),
       (store_add, ":end_cond", ":num_slots", 2),
       (try_for_range, ":i_slot", 2, ":end_cond"),
         (troop_get_slot, ":amount", "trp_stack_selection_amounts", ":i_slot"),
         (troop_get_slot, ":troop_id", "trp_stack_selection_ids", ":i_slot"),
         (assign, ":end_cond_2", ":num_stacks"),
         (try_for_range, ":stack_no", 0, ":end_cond_2"),
           (party_stack_get_troop_id, ":stack_troop", "p_main_party", ":stack_no"),
           (eq, ":stack_troop", ":troop_id"),
           (assign, ":end_cond_2", 0), #break
           (call_script, "script_cf_training_ground_sub_routine_for_training_result", ":troop_id", ":stack_no", ":amount", ":xp_ratio_to_add_with_trainer_skill"),
           (str_store_troop_name_by_count, s1, ":troop_id", ":amount"),
           #SB : hero name count
           (try_begin),
             (troop_is_hero, ":troop_id"),
             (assign, reg2, 1),
           (else_try),
             (assign, reg2, 0),
             (assign, reg1, ":amount"),
           (try_end),
           (str_store_string, s2, "@{s2}^{reg2?:{reg1} }{s1} earned {reg0} experience."),
         (try_end),
       (try_end),
       (try_begin),
         (eq, "$g_mt_mode", ctm_melee),
         (store_mul, ":special_xp_ratio_to_add", ":xp_ratio_to_add", 3),
         (val_div, ":special_xp_ratio_to_add", 2),
         (try_for_range, ":enemy_index", 0, "$g_training_ground_training_num_enemies"),
           (troop_get_slot, ":troop_id", "trp_temp_array_a", ":enemy_index"),
           (assign, ":end_cond_2", ":num_stacks"),
           (try_for_range, ":stack_no", 0, ":end_cond_2"),
             (party_stack_get_troop_id, ":stack_troop", "p_main_party", ":stack_no"),
             (eq, ":stack_troop", ":troop_id"),
             (assign, ":end_cond_2", 0), #break
             (call_script, "script_cf_training_ground_sub_routine_for_training_result", ":troop_id", ":stack_no", 1, ":special_xp_ratio_to_add"),
             (str_store_troop_name, s1, ":troop_id"),
             (str_store_string, s2, "@{s2}^{s1} earned an additional {reg0} experience."),
           (try_end),
         (try_end),
       (try_end),
       (try_begin),
         (call_script, "script_cf_training_ground_sub_routine_for_training_result", "trp_player", -1, 1, ":xp_ratio_to_add"),
         (str_store_string, s2, "@^You earned {reg0} experience.{s2}"),
       (try_end),
     (try_end),
     (try_begin),
       (eq, "$g_training_ground_training_success_ratio", 0),
       (str_store_string, s7, "@The training didn't go well at all."),
     (else_try),
       (lt, "$g_training_ground_training_success_ratio", 25),
       (str_store_string, s7, "@The training didn't go well at all."),
     (else_try),
       (lt, "$g_training_ground_training_success_ratio", 50),
       (str_store_string, s7, "@The training didn't go very well."),
     (else_try),
       (lt, "$g_training_ground_training_success_ratio", 75),
       (str_store_string, s7, "@The training went quite well."),
     (else_try),
       (lt, "$g_training_ground_training_success_ratio", 99),
       (str_store_string, s7, "@The training went very well."),
     (else_try),
       (str_store_string, s7, "@The training went perfectly."),
     (try_end),

     ],
    [
      ("continue",[],"Continue...",
       [(jump_to_menu, "mnu_training_ground"),
        ]
       ),
      ]
   ),
#####################################################################
## Captivity....
#####################################################################
("captivity_avoid_wilderness",0,
    "Suddenly all the world goes black around you."
  +" Many hours later you regain your conciousness and find yourself at the spot you fell."
  +" Your enemies must have taken you up for dead and left you there."
  +" However, it seems that none of your wounds were lethal,"
  +" and altough you feel awful, you find out that you can still walk."
  +" You get up and try to look for any other survivors from your party. But you see only dead around you.",
    "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
	("whatever",[], "Get up!",[
    (call_script, "script_set_parties_around_player_ignore_player", 15, 24),
    (change_screen_map), ]),
]),

("captivity_start_wilderness",0,
  "Stub",
  "none",[
    (try_begin), #siege warfare
        (eq, "$g_empieza_asedio", 1),
        (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
        (assign, "$g_player_besiege_town", -1),
    (try_end),
    (try_begin),
        (neg|party_slot_eq, "p_main_party", slot_party_on_water, 1),#not on water
        (store_random_in_range, ":r", 0, 100),
        (lt, ":r", hero_escape_after_defeat_chance),
        (jump_to_menu, "mnu_captivity_avoid_wilderness"),
    (else_try),
        (assign, "$g_player_is_captive", 1),
        (try_begin),
            (eq,"$g_player_surrenders",1),
            (jump_to_menu, "mnu_captivity_start_wilderness_surrender"),
        (else_try),
            (jump_to_menu, "mnu_captivity_start_wilderness_defeat"),
        (try_end),
    (try_end),
  ],[
]),

("captivity_start_wilderness_surrender",0,
  "Stub",
  "none",[
    (try_begin), #siege warfare
        (eq, "$g_empieza_asedio", 1),
        (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
        (assign, "$g_player_besiege_town", -1),
    (try_end),

    (assign, "$g_player_is_captive", 1),
    (assign,"$auto_menu",-1), #We need this since we may come here by something other than auto_menu
    (assign, "$capturer_party", "$g_encountered_party"),
    (jump_to_menu, "mnu_captivity_wilderness_taken_prisoner"),
  ],[
]),

("captivity_start_wilderness_defeat",0,
  "Your enemies take you prisoner.",
  "none",[
      (assign, "$g_player_is_captive", 1),
      (assign,"$auto_menu",-1),
      (assign, "$capturer_party", "$g_encountered_party"),

      (try_begin), #siege warfare
          (eq, "$g_empieza_asedio", 1),
          (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
          (assign, "$g_player_besiege_town", -1),
      (try_end),

      (jump_to_menu, "mnu_captivity_wilderness_taken_prisoner"),
  ],[
  ]),

("captivity_start_castle_surrender",0,
  "Stub",
  "none",[
    (assign, "$g_player_is_captive", 1),
    (assign,"$auto_menu",-1),
    (assign, "$capturer_party", "$g_encountered_party"),
	  (try_begin), #siege warfare
        (eq, "$g_empieza_asedio", 1),
        (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
        (assign, "$g_player_besiege_town", -1),
    (try_end),
    (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
  ],[
]),

("captivity_start_castle_defeat",0,
  "Stub",
  "none",[
    (assign, "$g_player_is_captive", 1),
    (assign,"$auto_menu",-1),
    (assign, "$capturer_party", "$g_encountered_party"),
    (try_begin),
        (store_random_in_range, ":random_no", -50, 100),
        (ge, ":random_no", "$g_player_luck"),
        (assign, "$g_next_menu", "mnu_captivity_castle_taken_prisoner"),
        (jump_to_menu, "mnu_permanent_damage"),
      (else_try),
        (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
    (try_end),
    (try_begin), #siege warfare
        (eq, "$g_empieza_asedio", 1),
        (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
        (assign, "$g_player_besiege_town", -1),
    (try_end),
  ],[
]),

("captivity_start_under_siege_defeat",0,
  "Your enemies take you prisoner.",
  "none",
    [
    (assign, "$g_player_is_captive", 1),
    (assign,"$auto_menu",-1),
    (assign, "$capturer_party", "$g_encountered_party"),
    (try_begin), #siege warfare
        (eq, "$g_empieza_asedio", 1),
        (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
        (assign, "$g_player_besiege_town", -1),
    (try_end),

    (try_begin),
        (store_random_in_range, ":random_no", -50, 150),
        (ge, ":random_no", "$g_player_luck"),
        (assign, "$g_next_menu", "mnu_captivity_castle_taken_prisoner"),
        (jump_to_menu, "mnu_permanent_damage"),
    (else_try),
        (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
    (try_end),
  ],[
]),

("captivity_wilderness_taken_prisoner",mnf_scale_picture,
  "{!}{s2}",
  "none",[
    (try_begin),
        # Battle loose on water...
        (party_slot_eq, "p_main_party", slot_party_on_water, 1),
        (assign, "$g_player_is_captive", 0),
        (str_store_string, s2, "@After losing the sea battle, you manage to escape with one of your ships."),
        (set_background_mesh, "mesh_pic_seabattle"),
    (else_try),
        (str_store_string, s2, "@Your enemies take you prisoner."),
        (set_background_mesh, "mesh_pic_prisoner_wilderness"),
    (try_end),

    (try_begin),
        (store_faction_of_party, ":fac", "$capturer_party"),
        (eq, ":fac", "$players_kingdom"),
        (jump_to_menu, "mnu_captivity_avoid_wilderness"),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (call_script, "script_change_troop_health", "trp_player", 5),
      (assign, "$talk_context", tc_player_defeated),
      (try_begin),
          (party_slot_eq, "p_main_party", slot_party_on_water, 1),
          (call_script, "script_set_parties_around_player_ignore_player", 8, 12),
      (else_try),
          (set_camera_follow_party, "$capturer_party"),
          (assign, "$g_player_is_captive", 1),
          (store_random_in_range, ":random_hours", 18, 30),
          (call_script, "script_event_player_captured_as_prisoner"),
          (call_script, "script_stay_captive_for_hours", ":random_hours"),
          (assign,"$auto_menu","mnu_captivity_wilderness_check"),
      (try_end),
      (change_screen_return),
    ]),
]),

("captivity_wilderness_check",0,
  "stub",
  "none",
    [
      (jump_to_menu,"mnu_captivity_end_wilderness_escape")
    ],[
]),

("captivity_end_wilderness_escape", mnf_scale_picture,
  "After painful days of being dragged about as a prisoner, you find a chance and escape from your captors!",
  "none",[
    (play_cue_track, "track_escape"),
    (set_background_mesh, "mesh_pic_escape_1"),
  ],[
    ("continue",[],"Continue...",[
      (assign, "$g_player_is_captive", 0),
      (try_begin),
          (party_is_active, "$capturer_party"),
          (party_relocate_near_party, "p_main_party", "$capturer_party", 2),
      (try_end),
      (call_script, "script_set_parties_around_player_ignore_player", 15, 24), #it was radius:2 and hours:4, but players make lots of complains about consequent battle losses after releases from captivity then I changed this.
      (assign, "$g_player_icon_state", pis_normal),
      (set_camera_follow_party, "p_main_party"),
      (rest_for_hours, 0, 0, 0), #stop resting
      ##diplomacy begin
      #(assign, "$g_move_fast", 1),
      ##diplomacy end
      (change_screen_return),
    ]),
]),

("captivity_castle_taken_prisoner",0,
  "You are quickly surrounded by guards who take away your weapons. With curses and insults, they throw you into the dungeon where you must while away the miserable days of your captivity.",
  "none",[
      ##diplomacy start+ test gender with script
      #(troop_get_type, ":is_female", "trp_player"),#<- replaced
      (set_background_mesh, "mesh_pic_prisoner_man"),
      ##diplomacy end+
      #SB : deduct relation here, probably
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -1),
    ],[
      ("continue",[],"Continue...",[
        (assign, "$g_player_is_captive", 1),
        (store_random_in_range, ":random_hours", 16, 22),
        (call_script, "script_event_player_captured_as_prisoner"),
        (call_script, "script_stay_captive_for_hours", ":random_hours"),
        (assign,"$auto_menu", "mnu_captivity_castle_check"),
        (call_script, "script_change_troop_health", "trp_player", 4),
        (change_screen_return)
      ]),
]),

("captivity_rescue_lord_taken_prisoner",0,
  "You remain in disguise for as long as possible before revealing yourself."
  +" The guards are outraged and beat you savagely before throwing you back into the cell for God knows how long...",
  "none",[
    ##diplomacy start+ test gender with script
    #(troop_get_type, ":is_female", "trp_player"),#<-replaced
    (set_background_mesh, "mesh_pic_prisoner_man"),
    ##diplomacy end+
  ],[
    ("continue",[],"Continue...",[
      (assign, "$g_player_is_captive", 1),
      (store_random_in_range, ":random_hours", 16, 22),
      (call_script, "script_event_player_captured_as_prisoner"),
      (call_script, "script_stay_captive_for_hours", ":random_hours"),
      (assign,"$auto_menu", "mnu_captivity_castle_check"),
      (call_script, "script_change_troop_health", "trp_player", 4),
      (change_screen_return),
    ]),
]),

("captivity_castle_check",0,
  "stub",
  "none",[
    (store_random_in_range, reg(7), 0, 100),
    (try_begin),
		  (party_is_active, "$capturer_party"),
		  (store_faction_of_party, ":capturer_faction", "$capturer_party"),
		  (is_between, ":capturer_faction", kingdoms_begin, kingdoms_end),
		  (store_relation, ":relation_w_player_faction", ":capturer_faction", "fac_player_faction"),
		  (ge, ":relation_w_player_faction", 0),
      #SB : this doesn't make much sense when the player is unaffiliated
      (jump_to_menu,"mnu_captivity_end_exchanged_with_prisoner"),
    (else_try),
      (lt, reg(7), 40),
      (troop_get_slot, ":player_renown", "trp_player", slot_troop_renown),
      (val_mul, ":player_renown", 2),
      (store_character_level, ":player_level", "trp_player"),
      (store_mul, "$player_ransom_amount", ":player_level", 50),
      (val_add, "$player_ransom_amount", 100),
      (val_add, "$player_ransom_amount", ":player_renown"),
      (store_troop_gold, reg3, "trp_player"),
      (store_div, ":player_gold_div_20", reg3, 20),
      (val_add, "$player_ransom_amount", ":player_gold_div_20"),
		  (troop_get_slot, ":renown", "trp_player", slot_troop_renown),
		  (ge, ":renown", 200),
      #(gt, reg3, 100),
      (jump_to_menu,"mnu_captivity_end_propose_ransom"),
    (else_try),
      (lt, reg(7), 50), #10% chance to be set free
		  # (store_troop_gold, reg3, "trp_player"),
		  #(lt, reg3, 100),
      (jump_to_menu,"mnu_captivity_end_exchanged_with_prisoner"),
    (else_try),
      (jump_to_menu,"mnu_captivity_castle_remain"),
    (try_end),
],[]),

("captivity_end_exchanged_with_prisoner",0,
  "After days of imprisonment, you are finally set free {s0}",
  "none",[
    (play_cue_track, "track_escape"),
    (try_begin),
        (party_is_active, "$capturer_party"),
        (store_faction_of_party, ":capturer_faction", "$capturer_party"),
        (is_between, ":capturer_faction", kingdoms_begin, kingdoms_end),
        (store_relation, ":relation_w_player_faction", ":capturer_faction", "fac_player_faction"),
        (ge, ":relation_w_player_faction", 0),
        (str_store_party_name, s13, "$capturer_party"),
        (str_store_string, s0, "@as {s13} is no longer held by your enemies."),
    (else_try),
        (str_store_string, s0, "@when your captors exchange you with another prisoner."),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (assign, "$g_player_is_captive", 0),
      (try_begin),
        (party_is_active, "$capturer_party"),
        (party_relocate_near_party, "p_main_party", "$capturer_party", 2),
      (try_end),
      (call_script, "script_set_parties_around_player_ignore_player", 15, 24), #it was radius:2 and hours:12, but players make lots of complains about consequent battle losses after releases from captivity then I changed this.
      (assign, "$g_player_icon_state", pis_normal),
      (set_camera_follow_party, "p_main_party"),
      (rest_for_hours, 0, 0, 0), #stop resting
      (change_screen_return),
    ]),
]),

("captivity_end_propose_ransom",0,
  "You spend long hours in the sunless dank of the dungeon, more than you can count."
  +" Suddenly one of your captors enters your cell with an offer;"
  +" he proposes to free you in return for {reg5} denars of your hidden wealth. You decide to...",
  "none",[
    (assign, reg5, "$player_ransom_amount"),
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("captivity_end_ransom_accept",[
      (store_troop_gold,":player_gold", "trp_player"),
      (ge, ":player_gold","$player_ransom_amount")
    ],"Accept the offer.",[
      (play_cue_track, "track_escape"),
      (assign, "$g_player_is_captive", 0),
      (troop_remove_gold, "trp_player", "$player_ransom_amount"),
      (try_begin),
        (party_is_active, "$capturer_party"),
        (party_relocate_near_party, "p_main_party", "$capturer_party", 1),
      (try_end),
      (call_script, "script_set_parties_around_player_ignore_player", 15, 24), #it was radius:2 and hours:6, but players make lots of complains about consequent battle losses after releases from captivity then I changed this.
      (assign, "$g_player_icon_state", pis_normal),
      (set_camera_follow_party, "p_main_party"),
      (rest_for_hours, 0, 0, 0), #stop resting
      (change_screen_return),
    ]),
    ("captivity_end_ransom_accept_2",[
      (store_troop_gold,":player_gold", "trp_player"),
      (lt, ":player_gold","$player_ransom_amount"),

      (try_begin),
        (store_troop_gold, ":player_gold", "trp_player"),
        (assign, reg6, ":player_gold"),
      (try_end),
    ],"Pay him {reg6} denars, promising to pay the rest when you are free.",[
      (play_cue_track, "track_escape"),
      (assign, "$g_player_is_captive", 0),

      (party_get_slot, ":town_lord", "$current_town", slot_town_lord),
      (party_get_slot, ":guild_master_troop", "$current_town",slot_town_elder),

      (store_troop_gold,":player_gold", "trp_player"),
      (troop_remove_gold, "trp_player", ":player_gold"),
      (store_sub, ":new_debts", "$player_ransom_amount", ":player_gold"),
      (try_begin),
          (gt, ":town_lord", -1),
          (call_script, "script_change_debt_to_troop", ":town_lord", ":new_debts"),
      (else_try),
          (gt, ":guild_master_troop", -1),
          (call_script, "script_change_debt_to_troop", ":guild_master_troop", ":new_debts"),
      (try_end),

      (val_max, ":new_debts", 1),
      (val_div, ":new_debts", 200),
      (try_begin),
          (gt, ":new_debts", 0),
          (val_mul, ":new_debts", -1),
          (call_script, "script_change_troop_renown", "trp_player", ":new_debts"),
      (try_end),

      (try_begin),
        (party_is_active, "$capturer_party"),
        (party_relocate_near_party, "p_main_party", "$capturer_party", 1),
      (try_end),
      (call_script, "script_set_parties_around_player_ignore_player", 15, 24), #it was radius:2 and hours:6, but players make lots of complains about consequent battle losses after releases from captivity then I changed this.
      (assign, "$g_player_icon_state", pis_normal),
      (set_camera_follow_party, "p_main_party"),
      (rest_for_hours, 0, 0, 0), #stop resting
      (change_screen_return),
    ]),
    ("captivity_end_ransom_deny",[
    ],"Refuse him, wait for something better.",[
      (assign, "$g_player_is_captive", 1),
      (store_random_in_range, reg(8), 16, 22),
      (call_script, "script_stay_captive_for_hours", reg8),
      (assign,"$auto_menu", "mnu_captivity_castle_check"),
      (change_screen_return),
    ]),
]),

("captivity_castle_remain",mnf_scale_picture|mnf_disable_all_keys,
    "More days pass in the darkness of your cell. You get through them as best you can,\
 enduring the kicks and curses of the guards, watching your underfed body waste away more and more...",
    "none",
    [
		  ##diplomacy start+ test gender with script
        #(troop_get_type, ":is_female", "trp_player"),#<- replaced
          (set_background_mesh, "mesh_pic_prisoner_man"),
		  ##diplomacy end+
        (store_random_in_range, ":random_hours", 16, 22),
        (call_script, "script_stay_captive_for_hours", ":random_hours"),
        (assign,"$auto_menu", "mnu_captivity_castle_check"),

    ],
    [
      ("continue",[],"Continue...",
       [
           (assign, "$g_player_is_captive", 1),
           (change_screen_return),
        ]),
    ]
  ),

  (
##diplomacy end+ fix gender of pronoun
    "kingdom_army_quest_report_to_army",mnf_scale_picture,
    "{s8} sends word that {reg4?she:he} wishes you to join {reg4?her:his} new military campaign.\
 You need to bring at least {reg13} troops to the army,\
 and are instructed to raise more men with all due haste if you do not have enough.",
##diplomacy end+
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger"),
        (quest_get_slot, ":quest_target_troop", "qst_report_to_army", slot_quest_target_troop),
        (quest_get_slot, ":quest_target_amount", "qst_report_to_army", slot_quest_target_amount),
        (call_script, "script_get_information_about_troops_position", ":quest_target_troop", 0),
        (str_clear, s9),
        (try_begin),
          (eq, reg0, 1), #troop is found and text is correct
          (str_store_string, s9, s1),
        (try_end),
        (str_store_troop_name, s8, ":quest_target_troop"),
        (assign, reg13, ":quest_target_amount"),
		##diplomacy start+
      #Set gender with script
		#(troop_get_type, reg4, ":quest_target_troop"), #<- OLD
		(call_script, "script_dplmc_store_troop_is_female_reg", ":quest_target_troop", 4),
		##diplomacy end+
      ],
    [
      ("continue",[],"Continue...",
       [
           (quest_get_slot, ":quest_target_troop", "qst_report_to_army", slot_quest_target_troop),
           (quest_get_slot, ":quest_target_amount", "qst_report_to_army", slot_quest_target_amount),
           (str_store_troop_name_link, s13, ":quest_target_troop"),
           (assign, reg13, ":quest_target_amount"),
           (setup_quest_text, "qst_report_to_army"),
           ##diplomacy start+ fix gender of pronoun
           (str_store_string, s2, "@{s13} asked you to report to {reg4?her:him} with at least {reg13} troops."),
           ##diplomacy end+
           (call_script, "script_start_quest", "qst_report_to_army", ":quest_target_troop"),
           (call_script, "script_report_quest_troop_positions", "qst_report_to_army", ":quest_target_troop", 3),
           (change_screen_return),
        ]),
]),

("kingdom_army_quest_messenger",mnf_scale_picture,
    "{s8} sends word that {reg4?she:he} wishes to speak with you about a task {reg4?she:he} needs performed.\
 {reg4?She:He} requests you to come and see {reg4?her:him} as soon as possible.",
##diplomacy end+
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger"),
        (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
        ##diplomacy start+ put marshall's gender in reg4
        (call_script, "script_dplmc_store_troop_is_female", ":faction_marshall"),
        (assign, reg4, reg0),
        ##diplomacy end+
        (str_store_troop_name, s8, ":faction_marshall"),
    ],
    [
        ("continue",[],"Continue...",
        [
            (change_screen_return)
        ]),

    ]
),

  (
    "kingdom_army_quest_join_siege_order",mnf_scale_picture,
    "{s8} sends word that you are to join the siege of {s9} in preparation for a full assault.\
 Your troops are to take {s9} at all costs.",
    "none",
    [
		(set_background_mesh, "mesh_pic_messenger"),
        (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
        (quest_get_slot, ":quest_target_center", "qst_join_siege_with_army", slot_quest_target_center),
        (str_store_troop_name, s8, ":faction_marshall"),
        (str_store_party_name, s9, ":quest_target_center"),
      ],
    [
      ("continue",[],"Continue...",
       [
           (call_script, "script_end_quest", "qst_follow_army"),
           (quest_get_slot, ":quest_target_center", "qst_join_siege_with_army", slot_quest_target_center),
           (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
           (str_store_troop_name_link, s13, ":faction_marshall"),
           (str_store_party_name_link, s14, ":quest_target_center"),
           (setup_quest_text, "qst_join_siege_with_army"),
           (str_store_string, s2, "@{s13} ordered you to join the assault against {s14}."),
           (call_script, "script_start_quest", "qst_join_siege_with_army", ":faction_marshall"),
           (change_screen_return),
        ]),
     ]
  ),

  (
    "kingdom_army_follow_failed",mnf_scale_picture,
    "You have failed to follow {s8}. The marshal assumes that you were otherwise engaged, but would have appreciated your support.",
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger"),
        (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
        (str_store_troop_name, s8, ":faction_marshall"),
        (call_script, "script_abort_quest", "qst_follow_army", 1),
#        (call_script, "script_change_player_relation_with_troop", ":faction_marshall", -3),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  # (
    # "invite_player_to_faction_without_center",mnf_scale_picture,
# ##diplomacy start+ fix gender of pronouns
    # "{s32}",
# ##diplomacy end+
    # "none",
    # [
        # (faction_get_slot, "$g_invite_faction_lord", "$g_invite_faction", slot_faction_leader),
        # ##diplomacy start+ store gender in reg4
        # (call_script, "script_dplmc_store_troop_is_female", "$g_invite_faction_lord"),
        # (assign, reg4, reg0),
        # ##diplomacy start+
        # (str_store_troop_name, s8, "$g_invite_faction_lord"),
        # (str_store_faction_name, s9, "$g_invite_faction"),

        # (set_background_mesh, "mesh_pic_messenger"),
		# (try_begin),
			# (eq, "$g_invite_faction_lord", "trp_kingdom_7_lord"),
			# (str_store_string, s32, "@You receive a message from the Roman Senate!^^\
 # {s8} has heard from your fame and has ordered the senate to make you a Tribunus.\
 # You would be granted the honour of leading troops and a monthly salery of 1000 denars,\
 # and in return you would be obligated to follow the orders of Caesar Augustus and fight in {reg4?her:his} military campaigns,\
 # although {reg4?she:he} offers you no lands or titles.\
 # {reg4?She:He} will surely be offended if you do not take the offer... "),
		# (else_try),
			# (str_store_string, s32, "@You receive an offer of vassalage!^^\
 # {s8} of {s9} has sent a royal messenger to bring you an invititation in {reg4?her:his} own hand.\
 # You would be granted the honour of becoming a vassal {lord/lady} of {s9},\
 # and in return {s8} asks you to swear an oath of homage to {reg4?her:him} and fight in {reg4?her:his} military campaigns,\
 # although {reg4?she:he} offers you no lands or titles.\
 # {reg4?She:He} will surely be offended if you do not take the offer... "),
		# (try_end),

      # ],
    # [
      # ("faction_accept",[],"Accept!",
       # [(str_store_troop_name,s1,"$g_invite_faction_lord"),
        # (setup_quest_text,"qst_join_faction"),

        # (str_store_troop_name_link, s3, "$g_invite_faction_lord"),
        # (str_store_faction_name_link, s4, "$g_invite_faction"),
        # (quest_set_slot, "qst_join_faction", slot_quest_giver_troop, "$g_invite_faction_lord"),
        # (quest_set_slot, "qst_join_faction", slot_quest_expiration_days, 30),
		# (quest_set_slot, "qst_join_faction", slot_quest_failure_consequence, 0),
	# ##diplomacy start+ fix gender of pronoun
        # (str_store_string, s2, "@Find and speak with {s3} of {s4} to give {reg4?her:him} your oath of homage."),
        # ##diplomacy end+
        # (call_script, "script_start_quest", "qst_join_faction", "$g_invite_faction_lord"),
        # (call_script, "script_report_quest_troop_positions", "qst_join_faction", "$g_invite_faction_lord", 3),
        # (jump_to_menu, "mnu_invite_player_to_faction_accepted"),
        # ]),
      # ("faction_reject",[],"Decline the invitation.",
       # [(call_script, "script_change_player_relation_with_troop", "$g_invite_faction_lord", -3),
        # (call_script, "script_change_player_relation_with_faction", "$g_invite_faction", -10),
        # (assign, "$g_invite_faction", 0),
        # (assign, "$g_invite_faction_lord", 0),
        # (assign, "$g_invite_offered_center", 0),
        # (change_screen_return),
        # ]),
     # ]
  # ),

  # (
    # "invite_player_to_faction",mnf_scale_picture,
# ##diplomacy start+ fix gender of pronouns
    # "{s32}",
# ##diplomacy end+
    # "none",
    # [
        # (set_background_mesh, "mesh_pic_messenger"),
        # (faction_get_slot, "$g_invite_faction_lord", "$g_invite_faction", slot_faction_leader),
        # ##diplomacy start+ store gender in reg4
        # (call_script, "script_dplmc_store_troop_is_female", "$g_invite_faction_lord"),
        # (assign, reg4, reg0),
        # ##diplomacy start+
        # (str_store_troop_name, s8, "$g_invite_faction_lord"),
        # (str_store_faction_name, s9, "$g_invite_faction"),
        # (str_store_party_name, s2, "$g_invite_offered_center"),
		# (str_clear, s32),
		# (try_begin),
			# (eq, "$g_invite_faction_lord", "trp_kingdom_7_lord"),
			# (str_store_string, s32, "@You receive a message from the Roman Senate!^^\
 # {s8} has heard from your fame and has ordered the senate to make you a Tribunus.\
 # You would be granted the honour of leading troops and a monthly salery of 1000 denars,\
 # and in return you would be obligated to follow the orders of Caesar Augustus and fight in {reg4?her:his} military campaigns,\
 # offering you to be the governor of {s2}, which would mean that you have to collect taxes and maintaine public order.\
 # {reg4?She:He} will surely be offended if you do not take the offer... "),
		# (else_try),
			# (str_store_string, s32, "@You receive an offer of vassalage!^^\
 # {s8} of {s9} has sent a royal messenger to bring you an invititation in {reg4?her:his} own hand.\
 # You would be granted the honour of becoming a vassal {lord/lady} of {s9},\
 # and in return {s8} asks you to swear an oath of homage to {reg4?her:him} and fight in {reg4?her:his} military campaigns,\
 # offering you the fief of {s2} for your loyal service.\
 # {reg4?She:He} will surely be offended if you do not take the offer..."),
		# (try_end),

      # ],
    # [
      # ("faction_accept",[],"Accept!",
       # [(str_store_troop_name,s1,"$g_invite_faction_lord"),
        # (setup_quest_text,"qst_join_faction"),

        # (str_store_troop_name_link, s3, "$g_invite_faction_lord"),
        # (str_store_faction_name_link, s4, "$g_invite_faction"),
        # (quest_set_slot, "qst_join_faction", slot_quest_giver_troop, "$g_invite_faction_lord"),
        # (quest_set_slot, "qst_join_faction", slot_quest_expiration_days, 30),
        # ##diplomacy start+ fix gender of pronoun
        # (str_store_string, s2, "@Find and speak with {s3} of {s4} to give {reg4?her:him} your oath of homage."),
        # ##diplomacy end+
        # (call_script, "script_start_quest", "qst_join_faction", "$g_invite_faction_lord"),
        # (call_script, "script_report_quest_troop_positions", "qst_join_faction", "$g_invite_faction_lord", 3),
        # (jump_to_menu, "mnu_invite_player_to_faction_accepted"),
        # ]),
      # ("faction_reject",[],"Decline the invitation.",
       # [(call_script, "script_change_player_relation_with_troop", "$g_invite_faction_lord", -3),
        # (assign, "$g_invite_faction", 0),
        # (assign, "$g_invite_faction_lord", 0),
        # (assign, "$g_invite_offered_center", 0),
        # (change_screen_return),
        # ]),
     # ]
  # ),

  # (
    # "invite_player_to_faction_accepted",0,
# ##diplomacy start+ fix gender of pronouns (king's gender should already be in reg4)
    # "{s32}",
# ##diplomacy end+
    # "none",
    # [
        # (call_script, "script_get_information_about_troops_position", "$g_invite_faction_lord", 0),
        # (str_store_troop_name, s3, "$g_invite_faction_lord"),
        # (str_store_string, s5, "@{!}{s1}"),
		# (str_clear, s32),
		# (try_begin),
			# (eq, "$g_invite_faction_lord", "trp_kingdom_7_lord"),
			# (str_store_string, s32, "@{s3} wants to appoint you personally as a tribunus.\
 # You shall have to find {reg4?her:him} and talk to him in person. {s5}"),
		# (else_try),
			# (str_store_string, s32, "@In order to become a vassal, you must swear an oath of homage to {s3}.\
 # You shall have to find {reg4?her:him} and give {reg4?her:him} your oath in person. {s5}"),
		# (try_end),

      # ],
    # [
      # ("continue",[],"Continue...",
       # [(change_screen_return),
        # ]),
     # ]
  # ),

("crafted_item_finished",0,
  "Because you haven't collected your ordered {s24} yet, the {s22} from {s23} sends it to you. Though, now the messanger demands a payment. It seems the merchant hasn't paid him.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (str_store_troop_name, s22, "$g_notification_menu_var1"),
    (str_store_party_name, s23, "$g_notification_menu_var2"),
    (troop_get_slot, ":item", "$g_notification_menu_var1", slot_crafting_order_item),
    (str_store_item_name, s24, ":item"),
    (troop_get_slot, ":imod", "$g_notification_menu_var1", slot_crafting_order_time_modifier),
    (try_begin),
        (eq, ":imod", -1),
        (assign, ":imod", 0),
    (try_end),
    (troop_add_item, "trp_player", ":item", ":imod"),
    (troop_set_slot, "$g_notification_menu_var1", slot_crafting_order_item, 0),
    (troop_set_slot, "$g_notification_menu_var1", slot_crafting_order_time, 0),
    (troop_set_slot, "$g_notification_menu_var1", slot_crafting_order_time_modifier, 0),
  ],[
    ("continue",[],"Pay him. [100 denars.]",[
      (troop_remove_gold, "trp_player", 100),
      (change_screen_map),
    ]),
    ("continue",[],"{s24} is mine, but I will not pay the messanger!",[
      (call_script, "script_change_player_honor", -1),
      (change_screen_map),
    ]),
]),

("question_peace_offer",0,
  "You receive a peace offer!^^The {s1} offers you a peace agreement. What is your answer?",
  "none",[
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),

    ##diplomacy begin
    (store_relation,  ":relation", "fac_player_supporters_faction", "$g_notification_menu_var1"),
    (try_begin),
      (this_or_next|faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_inactive),
      (ge, ":relation", 0),
      (change_screen_return),
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (assign, reg0, ":relation"),
      (faction_get_slot, reg1, "fac_player_supporters_faction", slot_faction_state),
      (display_log_message, "@DANGER: Invalid Peace Offer from {s1}. Automatically blog scam! Relation: {reg0}. State: {reg1}", message_alert),
    (try_end),
    ##diplomacy end
  ],[
    ("peace_offer_accept",[],"Accept",[
      (call_script, "script_diplomacy_start_peace_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
      (change_screen_return),
    ]),
      ##diplomacy begin
    ("dplmc_peace_offer_terms",[],"Dictate the peace terms",[
      (start_presentation, "prsnt_dplmc_peace_terms"),
    ]),
      ##diplomacy end
    ("peace_offer_reject",[],"Reject",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -5),
      (change_screen_return),
    ]),
]),

  (
    "notification_truce_expired",0,
    "Truce Has Expired^^The truce between {s1} and {s2} has expired.",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),

      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
  ),
  (
    "notification_senate_meeting",0,
    "You are informed, that in three days a senate meeting will be hold in Rome.",
    "none",
    [
    (set_background_mesh, "mesh_pic_senatus"),
      ],
    [
      ("continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
  ),

  (
    "notification_feast_quest_expired",0,
    "{s10}",
    "none",
    [
    (str_store_string, s10, "str_feast_quest_expired"),
    ],
    [
      ("continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
  ),

("notification_sortie_possible",0,
  "Enemy Sighted: Enemies have been sighted outside the walls of {s4}, and {s5} and others are preparing for a sortie. You may join them if you wish.",
  "none",[
    (str_store_party_name, s4, "$g_notification_menu_var1"),
    (party_stack_get_troop_id, ":leader", "$g_notification_menu_var2", 0),
    (str_store_troop_name, s5, ":leader"),
  ],[
    ("continue",[],"Continue",[
	    (change_screen_return),
    ]),
]),

("notification_casus_belli_expired",0,
    "Kingdom Fails to Respond^^The {s1} has not responded to the {s2}'s provocations, and {s3} suffers a loss of face among {reg4?her:his} more bellicose subjects...^",
    "none",
    [
        (str_store_faction_name, s1, "$g_notification_menu_var1"),
        (str_store_faction_name, s2, "$g_notification_menu_var2"),
        (faction_get_slot, ":faction_leader", "$g_notification_menu_var1", slot_faction_leader),
        (str_store_troop_name, s3, ":faction_leader"),
        ##diplomacy start+ use a script for gender
        #(troop_get_type, reg4, ":faction_leader"),#<- OLD
        (call_script, "script_dplmc_store_troop_is_female_reg", ":faction_leader", 4),
        ##diplomacy end+

        (set_fixed_point_multiplier, 100),
        (position_set_x, pos0, 65),
        (position_set_y, pos0, 30),
        (position_set_z, pos0, 170),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
        ("continue",[],"Continue",
        [
        (call_script, "script_faction_follows_controversial_policy", "$g_notification_menu_var1", logent_policy_ruler_ignores_provocation),
        (change_screen_return),
        ]),
    ]
),

("notification_casus_belli_decide_player",0,
    "Your realm has suffered provocations from the people of {s2}. You still haven't reacted to the provocations."
    +" You can declare war using this casus belli or demand tribute as reparation."
    +" If you decide to ignore the matter you will suffer a loss of authority.",
    "none",
    [
        (play_sound, "snd_message_negative_sound"),

        (str_store_faction_name, s2, "$g_notification_menu_var2"),

        (set_fixed_point_multiplier, 100),
        (position_set_x, pos0, 65),
        (position_set_y, pos0, 30),
        (position_set_z, pos0, 170),
        (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
        (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
        (val_mul, ":faction_1", 128),
        (val_add, ":faction_1", ":faction_2"),
        (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),

        (call_script, "script_count_parties_of_faction_and_party_type", "$g_notification_menu_var2", spt_town),
        (store_mul, reg40, reg0, 8000),
        (call_script, "script_count_parties_of_faction_and_party_type", "$g_notification_menu_var2", spt_castle),
        (val_mul, reg0, 4000),
        (val_add, reg40, reg0),
    ],
    [
        ("tribute",[],"Demand a tribute of {reg40} denars",[
            (jump_to_menu, "mnu_decide_ai_tribute"),
        ]),

        ("war",[],"Declare war!",
        [
            (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", 1),
            (jump_to_menu, "mnu_auto_return_map"),
        ]),

        ("ignore",[],"Ignore the situation",
        [
            (jump_to_menu, "mnu_notification_casus_belli_expired"),
        ]),
    ]
),

("notification_tribute_demanded",0,
    "Due to recent provocations from your subjects, the {s1} demand reparations and tributes of {reg40} denars from you. How do you react?"
    " Refusing the demand will most likely lead to war!",
    "none",
    [
        (play_sound, "snd_message_negative_sound"),

        (str_store_faction_name, s1, "$g_notification_menu_var1"),
        (str_store_faction_name, s2, "$g_notification_menu_var2"),

        (set_background_mesh, "mesh_pic_messenger"),

        (call_script, "script_count_parties_of_faction_and_party_type", "$g_notification_menu_var2", spt_town),
        (store_mul, reg40, reg0, 8000),
        (call_script, "script_count_parties_of_faction_and_party_type", "$g_notification_menu_var2", spt_castle),
        (val_mul, reg0, 4000),
        (val_add, reg40, reg0),
      ],
    [
        ("continue",[
            (store_troop_gold, ":gold", "trp_player"),
            (ge, ":gold", reg40),
            (faction_slot_eq, "$players_kingdom", slot_faction_government_type, gov_feudal),
        ],"Pay the tribute.",
        [
            (store_mul, ":gold_lost", reg40, -1),
            (troop_remove_gold, "trp_player",  ":gold_lost"),
            (jump_to_menu, "mnu_auto_return_map"),

            (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
            (try_begin),
                (faction_slot_eq, "$g_notification_menu_var1", slot_faction_government_type, gov_imperial),
                (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_diplomacy, "$g_notification_menu_var1", reg40),
            (else_try),
                (call_script, "script_add_to_troop_wealth", ":leader_1", reg40),
            (try_end),
        ]),

        ("continue",[
            (faction_slot_eq, "$players_kingdom", slot_faction_government_type, gov_imperial),
        ],"Pay the tribute.",
        [
            (call_script, "script_add_to_faction_bugdet", slot_faction_spending_diplomacy, "$players_kingdom", reg40),
            (jump_to_menu, "mnu_auto_return_map"),

            (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
            (try_begin),
                (faction_slot_eq, "$g_notification_menu_var1", slot_faction_government_type, gov_imperial),
                (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_diplomacy, "$g_notification_menu_var1", reg40),
            (else_try),
                (call_script, "script_add_to_troop_wealth", ":leader_1", reg40),
            (try_end),

        ]),

        ("continue",[],"Refuse.",
        [
            (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
            (jump_to_menu, "mnu_auto_return_map"),
        ]),
    ]
),

("notification_vassal_provokes_overlord",0,
  "Subjects of {s12} have provoked their overlord {s11}. Nobles of {s11} demand now harsh punishment of {s12} and additional tirbutes.^{s22}",
  "none",[
      (play_sound, "snd_message_negative_sound"),

      (str_store_faction_name, s11, "$g_notification_menu_var1"),
      (str_store_faction_name, s12, "$g_notification_menu_var2"),

      (assign, reg50, 0),

      (str_store_string, s22, "@How will you decide?"),
      (try_begin),
          (neg|faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
          (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
          (faction_get_slot, ":leader_2", "$g_notification_menu_var2", slot_faction_leader),
          (str_store_troop_name, s13, ":leader_1"),
          (str_store_troop_name, s14, ":leader_2"),
          (store_random_in_range, ":rand", 0, 100),
          (try_begin),
              (le, ":rand", 50),
              (assign, ":sign", 1),
              (try_begin),
                  (faction_slot_eq, "$g_notification_menu_var1", slot_faction_government_type, gov_imperial),
                  (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_diplomacy, "$g_notification_menu_var1", 15000),
              (else_try),
                  (call_script, "script_add_to_troop_wealth", ":leader_1", 15000),
              (try_end),
              (try_begin),
                  (eq, ":leader_2", "trp_player"),
                  (assign, reg50, 1),
                  (str_store_string, s22, "@{s13} decides to demand a high tribute. What is your response?"),
              (else_try),
                  (str_store_string, s22, "@{s13} decides to demand a high tribute. {s14} reluctantly accepts the decision."),
              (try_end),
          (else_try),
              (str_store_string, s22, "@{s14} is pleased to hear that {s13} does not demand an additional tributes."),
              (try_begin),
                  (eq, ":leader_2", "trp_player"),
                  (assign, reg50, 2),
              (try_end),
              (assign, ":sign", -1),
          (try_end),
          (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
              (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
              (store_faction_of_troop, ":lord_faction", ":lord"),
              (eq, ":lord_faction", "$g_notification_menu_var2"),
              (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
              (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
              (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
              (store_random_in_range, ":relation_shift", 1, 4),
              (val_mul, ":relation_shift", ":sign"),
              (call_script, "script_troop_change_relation_with_troop", ":lord", ":leader_2", ":relation_shift"),
          (try_end),
          (store_random_in_range, ":relation_shift", 10, 21),
          (val_mul, ":relation_shift", ":sign"),
          (call_script, "script_troop_change_relation_with_troop", ":leader_1", ":leader_2", ":relation_shift"),
      (try_end),
    ],[
      ("continue",[
        (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
      ],"Demand no additional tribute and ignore the matter.",[
        (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
        (call_script, "script_change_player_relation_with_troop", ":leader_1", 15),
        (set_show_messages, 0),
        (try_for_range, ":roman", active_npcs_begin, active_npcs_end),
            (troop_slot_eq, ":roman", slot_troop_occupation, slto_kingdom_hero),
            (store_faction_of_troop, ":roman_fac", ":roman"),
            (eq, ":roman_fac", "$players_kingdom"),
            (this_or_next|troop_slot_eq, ":roman", slot_lord_reputation_type, lrep_martial),
            (this_or_next|troop_slot_eq, ":roman", slot_lord_reputation_type, lrep_quarrelsome),
            (troop_slot_eq, ":roman", slot_lord_reputation_type, lrep_debauched),
            (store_random_in_range, ":relation_shift", 1, 4),
            (val_mul, ":relation_shift", -1),
            (call_script, "script_change_player_relation_with_troop", ":roman", ":relation_shift"),
        (try_end),
        (set_show_messages, 1),
        (display_message, "@Your relation with Lords of your faction decreases.", message_negative),
        (jump_to_menu, "mnu_auto_return_map"),
      ]),

      ("continue",[
        (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
      ],"Demand additional tribute of 15,000 denars!",[
        (faction_get_slot, ":leader_2", "$g_notification_menu_var2", slot_faction_leader),
        (call_script, "script_change_player_relation_with_troop", ":leader_2", -25),
        (set_show_messages, 0),
        (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
            (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
            (store_faction_of_troop, ":lord_faction", ":lord"),
            (eq, ":lord_faction", "$players_kingdom"),
            (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
            (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
            (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
            (store_random_in_range, ":relation_shift", 1, 4),
            (call_script, "script_change_player_relation_with_troop", ":lord", ":relation_shift"),
        (try_end),
        (set_show_messages, 1),
        (display_message, "@Your relation with Lords of your faction increases.", message_positive),

        (try_begin),
            (faction_slot_eq, "$g_notification_menu_var1", slot_faction_government_type, gov_imperial),
            (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_diplomacy, "$g_notification_menu_var1", 15000),
        (else_try),
            (troop_add_gold, "trp_player", 15000),
        (try_end),
        (str_store_troop_name, s63, ":leader_2"),
        (str_store_string,s1,"@{s63} accepts your decision reluctantly."),
        (display_message, "@{s1}"),
        (jump_to_menu, "mnu_random_juice_events"),
      ]),

      ("continue",[
        (eq, reg50, 1),
      ],"Pay the tribute. [15,000 denars]",[
        (try_begin),
            (faction_slot_eq, "$g_notification_menu_var2", slot_faction_government_type, gov_imperial),
            (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_diplomacy, "$g_notification_menu_var2", 15000),
        (else_try),
            (troop_remove_gold, "trp_player", 15000),
        (try_end),
        (set_show_messages, 0),
        (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
            (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
            (store_faction_of_troop, ":lord_faction", ":lord"),
            (eq, ":lord_faction", "$players_kingdom"),
            (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
            (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
            (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
            (store_random_in_range, ":relation_shift", 1, 4),
            (val_mul, ":relation_shift", -1),
            (call_script, "script_change_player_relation_with_troop", ":lord", ":relation_shift"),
        (try_end),
        (set_show_messages, 1),
        (display_message, "@Your relation with Lords of your faction decreases.", message_negative),
        (jump_to_menu, "mnu_auto_return_map"),
      ]),

      ("continue",[
        (eq, reg50, 1),
      ],"Refuse to pay the tribute and declare war.",[
        (set_show_messages, 0),
        (try_for_range, ":roman", active_npcs_begin, active_npcs_end),
            (troop_slot_eq, ":roman", slot_troop_occupation, slto_kingdom_hero),
            (store_faction_of_troop, ":roman_fac", ":roman"),
            (eq, ":roman_fac", "$players_kingdom"),
            (this_or_next|troop_slot_eq, ":roman", slot_lord_reputation_type, lrep_martial),
            (this_or_next|troop_slot_eq, ":roman", slot_lord_reputation_type, lrep_quarrelsome),
            (troop_slot_eq, ":roman", slot_lord_reputation_type, lrep_debauched),
            (store_random_in_range, ":relation_shift", 1, 4),
            (call_script, "script_change_player_relation_with_troop", ":roman", ":relation_shift"),
        (try_end),
        (set_show_messages, 1),
        (display_message, "@Your relation with Lords of your faction increases.", message_positive),
        (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var2", "$g_notification_menu_var1", logent_faction_declares_war_to_declare_independence),
        (jump_to_menu, "mnu_auto_return_map"),
      ]),

      ("continue",[
        (eq, reg50, 2),
      ],"Good.",[
       (jump_to_menu, "mnu_auto_return_map"),
      ]),

      ("continue",[
        (neg|faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
        (neg|faction_slot_eq, "$g_notification_menu_var2", slot_faction_leader, "trp_player"),
      ],"Continue.",[
        (jump_to_menu, "mnu_auto_return_map"),
      ]),
]),

("notification_casus_belli_truce_decide_reaction_ask",0,
  "{s22}",
  "none",[
      (play_sound, "snd_message_negative_sound"),

      (faction_get_slot, ":leader_2", "$g_notification_menu_var2", slot_faction_leader),
      (str_store_troop_name, s63, ":leader_2"),

      (try_begin),
          (store_random_in_range, ":rand", 0, 100),
          (le, ":rand", 50),
          (str_store_string, s22, "@{s63} ignores your request and resolves the matter in favor of his own subjects."),
          (assign, reg50, 1),
      (else_try),
          (str_store_string, s22, "@{s63} resolves the matter in favor of your subjects."),
          (assign, reg50, 0),
      (try_end),
    ],[
      ("continue",[
        (eq, reg50, 1),
      ],"Break the pact and declare war!",[
        (set_show_messages, 0),
        (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
            (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
            (store_faction_of_troop, ":lord_faction", ":lord"),
            (eq, ":lord_faction", "$players_kingdom"),
            (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
            (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
            (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
            (store_random_in_range, ":relation_shift", 1, 4),
            (call_script, "script_change_player_relation_with_troop", ":lord", ":relation_shift"),
        (try_end),
        (set_show_messages, 1),
        (display_message, "@Your relation with Lords of your faction increases.", message_positive),
        (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
        (jump_to_menu, "mnu_auto_return_map"),
        (display_message, "@You have broken a pact!"),
        (call_script, "script_change_player_honor", -5),
        (call_script, "script_change_troop_renown", "trp_player", 25),
      ]),
      ("continue",[
        (eq, reg50, 1),
      ],"Continue.",[
        (set_show_messages, 0),
        (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
            (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
            (store_faction_of_troop, ":lord_faction", ":lord"),
            (eq, ":lord_faction", "$players_kingdom"),
            (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
            (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
            (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
            (store_random_in_range, ":relation_shift", 1, 4),
            (val_mul, ":relation_shift", -5),
            (call_script, "script_change_player_relation_with_troop", ":lord", ":relation_shift"),
        (try_end),
        (set_show_messages, 1),
        (call_script, "script_change_troop_renown", "trp_player", -75),
        (call_script, "script_change_player_right_to_rule", -8),
        (display_message, "@Your relation with Lords of your faction decreases.", message_negative),
        (jump_to_menu, "mnu_auto_return_map"),
      ]),
      ("continue",[
        (eq, reg50, 0),
      ],"Very good.",[
        (call_script, "script_change_troop_renown", "trp_player", 15),
        (call_script, "script_change_player_right_to_rule", 2),
        (jump_to_menu, "mnu_auto_return_map"),
      ]),
]),

("notification_casus_belli_truce_decide",0,
  "The {s61} have suffered provokations from subjects of {s62} a while ago."
  " However, {s63} of {s61} is in a dilemma, as {s21}.^^{s18}^^{s22}^^{s31}",
  "none",[
    (try_begin),
        (faction_slot_eq, "$g_notification_menu_var2", slot_faction_tributary_of, "$g_notification_menu_var1"),
        (jump_to_menu, "mnu_notification_vassal_provokes_overlord"),
    (else_try),
        # (display_message, "@notification_casus_belli_truce_decide"),
        (set_background_mesh, "mesh_pic_messenger"),
        (play_sound, "snd_message_negative_sound"),

        (str_store_faction_name, s61, "$g_notification_menu_var1"),
        (str_store_faction_name, s62, "$g_notification_menu_var2"),

        (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
        (faction_get_slot, ":leader_2", "$g_notification_menu_var2", slot_faction_leader),
        (call_script, "script_troop_get_relation_with_troop", ":leader_1", ":leader_2"),
        (assign, ":relation", reg0),

        (str_store_troop_name, s63, ":leader_1"),
        (str_store_troop_name, s64, ":leader_2"),

        (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "$g_notification_menu_var1", "$g_notification_menu_var2"),
        # (assign, ":diplomatic_status", reg0),
        (assign, ":duration_of_status", reg1),
        (assign, ":probability", 1),
        (assign, ":relation_loss", 0),
        (try_begin),
            (is_between, ":duration_of_status", dplmc_treaty_truce_days_expire + 1, dplmc_treaty_truce_days_initial + 1),
            (str_store_string, s21, "@{s61} is bound by a truce with the {s62}"),
            (assign, ":probability", 150),
            (assign, ":relation_loss", -1),
        (else_try),
            (is_between, ":duration_of_status", dplmc_treaty_trade_days_expire + 1, dplmc_treaty_trade_days_initial + 1),
            (val_sub, ":duration_of_status", dplmc_treaty_trade_days_expire),
            (str_store_string, s21, "@{s61} have a trade agreement with the {s62}"),
            (assign, ":probability", 130),
            (assign, ":relation_loss", -1),
        (else_try),
            (is_between, ":duration_of_status", dplmc_treaty_defense_days_expire + 1, dplmc_treaty_defense_days_initial + 1),
            (val_sub, ":duration_of_status", dplmc_treaty_defense_days_expire),
            (str_store_string, s21, "@{s61} have a defense pact with the {s62}"),
            (assign, ":probability", 70),
            (assign, ":relation_loss", -2),
        (else_try),
            (is_between, ":duration_of_status", dplmc_treaty_alliance_days_expire + 1, dplmc_treaty_alliance_days_initial + 1),
            (val_sub, ":duration_of_status", dplmc_treaty_alliance_days_expire),
            (str_store_string, s21, "@{s61} have an alliance with the {s62}"),
            (assign, ":probability", 50),
            (assign, ":relation_loss", -2),
        (else_try),
            (is_between, ":duration_of_status", dplmc_treaty_tributary_days_expire + 1, dplmc_treaty_tributary_days_initial + 1),
            (val_sub, ":duration_of_status", dplmc_treaty_tributary_days_expire),
            (str_store_string, s21, "@{s61} are a tributary of the {s62}"),
            (assign, ":probability", 30),
            (assign, ":relation_loss", -3),
        (try_end),
        (val_mul, ":duration_of_status", 1000),
        (val_div, ":duration_of_status", 20000),
        (store_sub, ":duration_of_status", 1000, ":duration_of_status"),
        (val_mul, ":probability", ":duration_of_status"),
        (val_div, ":probability", 1000),

        (assign, ":score_to_beat", 6),
        (assign, ":largest_neighbor", -1),
        (assign, ":leader_largest", -1),
        (assign, ":relation_largest", 0),
        (str_store_string, s30, "str_noone"),

        # (call_script, "script_count_parties_of_faction_and_party_type", "$g_notification_menu_var1", spt_town),
        # (assign, ":size_of_provoked_faction", reg0),
        # (call_script, "script_count_parties_of_faction_and_party_type", "$g_notification_menu_var1", spt_castle),
        # (val_add, ":size_of_provoked_faction", reg0),

        (try_for_range, ":neighbors_of_1", kingdoms_begin, kingdoms_end),
            (neq, ":neighbors_of_1", "$g_notification_menu_var1"),
            (neq, ":neighbors_of_1", "$g_notification_menu_var2"),
            (faction_slot_eq, ":neighbors_of_1", slot_faction_state, sfs_active),
            (store_add, ":slot", slot_faction_neighbors_begin, ":neighbors_of_1"),
            (val_sub, ":slot", kingdoms_begin),
            (faction_get_slot, ":two_factions_share_border", "$g_notification_menu_var1", ":slot"),
            (ge, ":two_factions_share_border", 1),
            # largest neighbour should be neighbour of both factions
            # (faction_get_slot, ":two_factions_share_border", "$g_notification_menu_var2", ":slot"),
            # (ge, ":two_factions_share_border", 1),

            # closest center should be not more than 100 away
            # (assign, ":center_1_in_100_range", -1),
            (assign, ":center_2_in_100_range", -1),
            # (assign, ":distance_1_2", -1),
            (try_for_range, ":center_1", centers_begin, centers_end),
                (eq, ":center_2_in_100_range", -1),
                (store_faction_of_party, ":faction_1", ":center_1"),
                (eq, ":faction_1", ":neighbors_of_1"),
                (store_add, ":already_done", ":center_1", 1),
                (try_for_range, ":center_2", ":already_done", centers_end),
                    (eq, ":center_2_in_100_range", -1),
                    (store_faction_of_party, ":faction_2", ":center_2"),
                    (eq, ":faction_2", "$g_notification_menu_var2"),
                    (store_distance_to_party_from_party, ":distance", ":center_2", ":center_1"),
                    (lt, ":distance", 100),
                    (assign, ":center_2_in_100_range", ":center_2"),
                    # (assign, ":center_1_in_100_range", ":center_1"),
                    # (assign, ":distance_1_2", ":distance"),
                (try_end),
            (try_end),
            (is_between, ":center_2_in_100_range", centers_begin, centers_end),
            # (str_store_party_name_link, s0, ":center_1_in_100_range"),
            # (str_store_party_name_link, s1, ":center_2_in_100_range"),
            # (assign, reg10, ":distance_1_2"),
            # (display_message, "@{s0} {s1}, {reg10}"),

            # (str_store_faction_name, s0, ":neighbors_of_1"),
            # (display_message, "@Neighbor {s0}"),
            (call_script, "script_count_parties_of_faction_and_party_type", ":neighbors_of_1", spt_town),
            (assign, ":cur_score", reg0),
            (call_script, "script_count_parties_of_faction_and_party_type", ":neighbors_of_1", spt_castle),
            (val_add, ":cur_score", reg0),
            # (assign, reg1, ":cur_score"),
            # (display_message, "@score {reg1}"),
            (gt, ":cur_score", ":score_to_beat"),
            (assign, ":score_to_beat", ":cur_score"),
            (assign, ":largest_neighbor", ":neighbors_of_1"),
            (faction_get_slot, ":leader_largest", ":neighbors_of_1", slot_faction_leader),
            (str_store_faction_name, s30, ":neighbors_of_1"),
            (call_script, "script_troop_get_relation_with_troop", ":leader_largest", ":leader_1"),
            (assign, ":relation_largest", reg0),
        (try_end),

        # (assign, reg1, ":score_to_beat"),
        # (display_message, "@largest_neighbor = {s30}, score_to_beat = {reg1}"),
        (assign, ":status_1_neigbor", 0),
        (assign, ":status_2_neigbor", 0),
        (assign, ":status_2_duration", 0),
        (assign, ":probability_switch", 0),
        (assign, ":neigbor_stance_to_2", 0),
        (assign, "$temp2", ":largest_neighbor"),
        (str_clear, s18),
        (try_begin),
            (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
            (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "$g_notification_menu_var1", ":largest_neighbor"),
            (assign, ":status_1_neigbor", reg0),

            (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "$g_notification_menu_var2", ":largest_neighbor"),
            (assign, ":status_2_neigbor", reg0),
            (assign, ":status_2_duration", reg1),

            (call_script, "script_npc_decision_checklist_peace_or_war", ":largest_neighbor", "$g_notification_menu_var2", -1),
            (assign, ":neigbor_stance_to_2", reg0),
            # (str_store_string, s1, reg1),
            # (display_message, "@{s30} has stance {reg0}, {s61}"),
            (try_begin),
                (faction_slot_eq, ":largest_neighbor", slot_faction_leader, "trp_player"),
                (str_store_string, s18, "@You may use this developments to your advantage."),
            (else_try),
                (str_store_string, s18, "@The {s30} may use this developments to their advantage."),
            (try_end),
        (try_end),

        (try_begin),
            (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
            (eq, ":status_2_neigbor", -2),
            (try_begin),
                (neg|faction_slot_eq, ":largest_neighbor", slot_faction_leader, "trp_player"),
                (str_store_string, s18, "@{s18} They are at war with {s62}. The right gifts and offers at the right moment may persuade {s61} to switch sides."),
            (try_end),
            (assign, ":probability_switch", 500),
        (else_try),
            (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
            (eq, ":status_2_neigbor", -1),
            (try_begin),
                (neg|faction_slot_eq, ":largest_neighbor", slot_faction_leader, "trp_player"),
                (str_store_string, s18, "@{s18} They also suffered provokations from the {s62}. The right gifts and offers at the right moment may persuade {s61} to switch sides."),
            (try_end),
            (assign, ":probability_switch", 400),
        (else_try),
            (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
            (eq, ":status_2_neigbor", 0),
            (try_begin),
                (neg|faction_slot_eq, ":largest_neighbor", slot_faction_leader, "trp_player"),
                (str_store_string, s18, "@{s18} They have no outstanding issues with {s62}, but strive for hegemony in the region. The right gifts and offers at the right moment may persuade {s61} to switch sides."),
            (try_end),
            (assign, ":probability_switch", 200),
        (else_try),
            (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
            (assign, ":probability_switch", 200),
            (try_begin),
                (is_between, ":status_2_duration", dplmc_treaty_truce_days_expire + 1, dplmc_treaty_truce_days_initial + 1),
                (str_store_string, s21, "@They are bound by a truce with the {s62}"),
                (assign, ":probability_switch", 150),
            (else_try),
                (is_between, ":status_2_duration", dplmc_treaty_trade_days_expire + 1, dplmc_treaty_trade_days_initial + 1),
                (val_sub, ":duration_of_status", dplmc_treaty_trade_days_expire),
                (str_store_string, s21, "@They have a trade agreement with the {s62}"),
                (assign, ":probability_switch", 130),
            (else_try),
                (is_between, ":status_2_duration", dplmc_treaty_defense_days_expire + 1, dplmc_treaty_defense_days_initial + 1),
                (val_sub, ":status_2_duration", dplmc_treaty_defense_days_expire),
                (str_store_string, s21, "@They have a defense pact with the {s62}"),
                (assign, ":probability_switch", 70),
            (else_try),
                (is_between, ":status_2_duration", dplmc_treaty_alliance_days_expire + 1, dplmc_treaty_alliance_days_initial + 1),
                (val_sub, ":status_2_duration", dplmc_treaty_alliance_days_expire),
                (str_store_string, s21, "@They have an alliance with the {s62}"),
                (assign, ":probability_switch", 50),
            (else_try),
                (is_between, ":status_2_duration", dplmc_treaty_tributary_days_expire + 1, dplmc_treaty_tributary_days_initial + 1),
                (val_sub, ":status_2_duration", dplmc_treaty_tributary_days_expire),
                (str_store_string, s21, "@They are a tributary of the {s62}"),
                (assign, ":probability_switch", 30),
            (try_end),
            (try_begin),
                (neg|faction_slot_eq, ":largest_neighbor", slot_faction_leader, "trp_player"),
                (str_store_string, s18, "@{s18} {s21} with {s62}, but still strive for hegemony in the region. The right gifts and offers at the right moment may persuade {s61} to switch sides, which would improve {s30} position in the region."),
            (try_end),
        (try_end),

        (try_begin),
            (le, ":status_1_neigbor", -1),
            (val_mul, ":probability_switch", 2),
            (val_div, ":probability_switch", 3),
        (else_try),
            (gt, ":status_1_neigbor", 0),
            (val_mul, ":probability_switch", 3),
            (val_div, ":probability_switch", 2),
        (try_end),

        (val_mul, ":neigbor_stance_to_2", -2),
        (val_add, ":neigbor_stance_to_2", 100),
        (val_mul, ":probability_switch", ":neigbor_stance_to_2"),
        (val_div, ":probability_switch", 100),

        (val_add, ":relation_largest", 100),
        (val_mul, ":probability_switch", ":relation_largest"),
        (val_div, ":probability_switch", 100),

        (assign, "$temp3", ":probability"),
        (assign, "$temp4", ":probability_switch"),

        (str_clear, s31),
        (assign, reg50, 0),
        (try_begin),
            (eq, ":leader_1", "trp_player"),
            (str_store_string, s22, "@You can request from {s64} to punish the troublemakers and resolve the dispute in the favor of your people. Or you use the opportunity and break the treaty with {s64}!"),
            (try_begin),
                (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
                (try_begin),
                    (ge, ":duration_of_status", dplmc_treaty_defense_days_initial),
                    (str_store_string, s31, "@An envoy of {s30} also appeared at your court and brought gifts and jewelries and making remarks about the trustworthiness of your ally {s64}. They hint that they would reward your support against {s64} with plenty of gold."),
                    (assign, reg50, 1),
                (else_try),
                    (str_store_string, s31, "@An envoy of {s30} also appeared at your court and brought gifts and jewelries and making remarks about the trustworthiness of {s64}."),
                (try_end),
            (try_end),
        (else_try),
            (eq, ":leader_2", "trp_player"),
            (try_begin),
                (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
                (str_store_string, s22, "@{s63} asks you to settle the dispute in favor of his subject. Agreeing to his request will increase your relation with them, but it will also upset undermine your authority. But keep in mind that the {s30} may take advantage of the situation."),
            (else_try),
                (str_store_string, s22, "@{s63} asks you to settle the dispute in favor of his subject. Agreeing to his request will increase your relation with them, but it will also upset undermine your authority."),
            (try_end),
        (else_try),
            (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
            (faction_slot_eq, ":largest_neighbor", slot_faction_leader, "trp_player"),
            (store_random_in_range, ":rand_switch", 1, 1250),
            (store_random_in_range, ":rand", 1, 1000),
            (try_begin),
                (lt, ":relation", 0),
                (this_or_next|le, ":rand", ":probability"),
                (le, ":rand_switch", ":probability_switch"),
                (assign, reg50, 5),
                (call_script, "script_troop_change_relation_with_troop", ":leader_1", ":leader_2", ":relation_loss"),
                (assign, ":result_string", "str_provokations_between_allies"),
                (str_store_string, s31, "@An envoy from {s61} appeared and said they may betray their allies and switch sides to you if you would help them with additional funds. Such action will lead to war with {s62}."),
            (else_try),
                (store_random_in_range, ":rand", 0, 100),
                (le, ":rand", 50),
                (val_mul, ":relation_loss", -1),
                (call_script, "script_troop_change_relation_with_troop", ":leader_1", ":leader_2", ":relation_loss"),
                (assign, ":result_string", "str_provokations_between_allies_help"),
                (assign, reg50, 4),
            (else_try),
                (assign, ":result_string", "str_provokations_between_allies"),
                (call_script, "script_troop_change_relation_with_troop", ":leader_1", ":leader_2", ":relation_loss"),
                (assign, reg50, 3),
            (try_end),
            (str_store_string, s22, ":result_string"),
        (else_try),
            (store_random_in_range, ":rand_switch", 1, 1250),
            (store_random_in_range, ":rand", 1, 1000),
            (try_begin),
                (lt, ":relation", 0),
                (this_or_next|le, ":rand", ":probability"),
                (le, ":rand_switch", ":probability_switch"),
                (assign, ":result_string", "str_break_treaty_declare_war"),
                (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
                (call_script, "script_troop_change_relation_with_troop", ":leader_1", ":leader_2", -15),
            (else_try),
                (store_random_in_range, ":rand", 0, 100),
                (le, ":rand", 50),
                (val_mul, ":relation_loss", -1),
                (call_script, "script_troop_change_relation_with_troop", ":leader_1", ":leader_2", ":relation_loss"),
                (assign, ":result_string", "str_provokations_between_allies_help"),
            (else_try),
                (assign, ":result_string", "str_provokations_between_allies"),
                (call_script, "script_troop_change_relation_with_troop", ":leader_1", ":leader_2", ":relation_loss"),
            (try_end),
            (try_begin),
                (eq, ":result_string", "str_break_treaty_declare_war"),
                # (eq, ":status_1_neigbor", -1),
                # (eq, ":status_2_neigbor", -2),
                (ge, ":duration_of_status", dplmc_treaty_defense_days_initial),
                (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
                (try_begin),
                    (is_between, ":duration_of_status", dplmc_treaty_tributary_days_expire + 1, dplmc_treaty_tributary_days_initial + 1),
                    (str_store_string, s31, "@{s63} betrays his overlord {s64} and switches sides to {s30}."),
                    (call_script, "script_dplmc_start_tributary_between_kingdoms", "$g_notification_menu_var1", ":largest_neighbor", 1),
                (else_try),
                    (str_store_string, s31, "@{s63} betrays his ally {s64} and switches sides to {s30}."),
                    (call_script, "script_dplmc_start_defensive_between_kingdoms", "$g_notification_menu_var1", ":largest_neighbor", 1),
                (try_end),
                (call_script, "script_diplomacy_start_war_between_kingdoms", ":largest_neighbor", "$g_notification_menu_var2", logent_faction_declares_war_to_curb_power),
            (else_try),
                (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
                (eq, ":result_string", "str_provokations_between_allies_help"),
                (str_store_string, s31, "@The swift action of {s64} prevented the {s30} to take advantage of the situation."),
            (else_try),
                (is_between, ":largest_neighbor", kingdoms_begin, kingdoms_end),
                (eq, ":result_string", "str_provokations_between_allies"),
                (str_store_string, s31, "@Rumors say that the inability of {s64} to take action allowed the {s30} to take advantage of the situation and the {s30} improved their relation with the {s61}."),
                (call_script, "script_troop_change_relation_with_troop", ":leader_1", ":leader_largest", 15),
            (try_end),
            (str_store_string, s22, ":result_string"),
        (try_end),
    (try_end),
  ],[
    ("ignore_largest_neighbor",[
      (is_between, "$temp2", kingdoms_begin, kingdoms_end),
      (faction_slot_eq, "$temp2", slot_faction_leader, "trp_player"),
    ],"Ignore the situation.",[
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("gifts_largest_neighbor",[
      (is_between, "$temp2", kingdoms_begin, kingdoms_end),
      (faction_slot_eq, "$temp2", slot_faction_leader, "trp_player"),
      (assign, ":block", 0),
      (try_begin),
          (faction_slot_eq, "$g_notification_menu_var2", slot_faction_government_type, gov_imperial),
      (else_try),
          (store_troop_gold, ":g", "trp_player"),
          (ge, ":g", 25000),
      (try_end),
      (eq, ":block", 0),
    ],"Send them gifts. [25,000 denars]",[
      (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
      (str_store_troop_name, s63, ":leader_1"),
      (str_clear, s1),
      (try_begin),
          (eq, reg50, 3),
          (call_script, "script_change_player_relation_with_troop", ":leader_1", 10),
          (store_relation, ":relation", "fac_player_supporters_faction", "$g_notification_menu_var1"),
          (val_add, ":relation", 5),
          (val_max, ":relation", 50),
          (call_script, "script_set_player_relation_with_faction", "$g_notification_menu_var1", ":relation"),
          (str_store_string, s1, "@{s63} accept your gifts."),
      (else_try),
          (str_store_string, s1, "@{s63} rejects your gifts."),
      (try_end),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("gifts_largest_neighbor",[
      (eq, reg50, 5),
      (is_between, "$temp2", kingdoms_begin, kingdoms_end),
      (faction_slot_eq, "$temp2", slot_faction_leader, "trp_player"),
      (assign, ":block", 0),
      (try_begin),
          (faction_slot_eq, "$g_notification_menu_var2", slot_faction_government_type, gov_imperial),
      (else_try),
          (store_troop_gold, ":g", "trp_player"),
          (ge, ":g", 50000),
      (try_end),
      (eq, ":block", 0),
    ],"Ask them to switch sides by offering 50,000 denars.",[
      (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
      (faction_get_slot, ":leader_2", "$g_notification_menu_var1", slot_faction_leader),
      (call_script, "script_change_player_relation_with_troop", ":leader_1", 5),
      (call_script, "script_change_player_relation_with_troop", ":leader_2", -35),

      (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "$g_notification_menu_var1", "$g_notification_menu_var2"),
      (assign, ":duration_of_status", reg1),
      (try_begin),
          (is_between, ":duration_of_status", dplmc_treaty_tributary_days_expire + 1, dplmc_treaty_tributary_days_initial + 1),
          (call_script, "script_dplmc_start_tributary_between_kingdoms", "$g_notification_menu_var1", "$temp2", 1),
          (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var2", "$temp2", logent_faction_declares_war_to_curb_power),
      (else_try),
          (call_script, "script_dplmc_start_defensive_between_kingdoms", "$g_notification_menu_var1", "$temp2", 1),
          (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var2", "$temp2", logent_faction_declares_war_to_curb_power),
      (try_end),
      (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
      (str_store_troop_name, s63, ":leader_1"),
      (str_store_string, s1, "@{s63} breaks his alliance and switches to your side."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),

    ("your_subjects",[
      (faction_slot_eq, "$g_notification_menu_var2", slot_faction_leader, "trp_player"),
    ],"Resolve the matter in favor of your subjects.",[
      (set_show_messages, 0),
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
          (store_faction_of_troop, ":lord_faction", ":lord"),
          (eq, ":lord_faction", "$players_kingdom"),
          (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
          (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
          (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
          (store_random_in_range, ":relation_shift", 1, 4),
          (call_script, "script_change_player_relation_with_troop", ":lord", ":relation_shift"),
      (try_end),
      (set_show_messages, 1),
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (call_script, "script_change_player_right_to_rule", 5),
      (display_message, "@Your relation with Lords of your faction increases.", message_positive),
      (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
      (call_script, "script_change_player_relation_with_troop", ":leader_1", -10),

      (try_begin),
          (is_between, "$temp2", kingdoms_begin, kingdoms_end),
          (faction_get_slot, ":leader_largest", "$temp2", slot_faction_leader),
          (call_script, "script_troop_change_relation_with_troop", ":leader_1", ":leader_largest", 15),
      (try_end),


      (store_random_in_range, ":rand_switch", 1, 1200),
      (store_random_in_range, ":rand", 1, 1000),
      (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "$g_notification_menu_var1", "$g_notification_menu_var2"),
      # (assign, ":diplomatic_status", reg0),
      (assign, ":duration_of_status", reg1),
      (str_clear,s1),
      (str_store_troop_name, s63, ":leader_1"),
      (try_begin),
          (call_script, "script_troop_get_player_relation", ":leader_1"),
          (lt, reg0, 0),
          (this_or_next|le, ":rand", "$temp3"),
          (le, ":rand_switch", "$temp4"),
          (call_script, "script_change_player_relation_with_troop", ":leader_1", -15),
          (try_begin),
              (ge, ":duration_of_status", dplmc_treaty_defense_days_initial),
              (is_between, "$temp2", kingdoms_begin, kingdoms_end),
              (try_begin),
                  (is_between, ":duration_of_status", dplmc_treaty_tributary_days_expire + 1, dplmc_treaty_tributary_days_initial + 1),
                  (call_script, "script_dplmc_start_tributary_between_kingdoms", "$g_notification_menu_var1", "$temp2", 1),
                  (call_script, "script_diplomacy_start_war_between_kingdoms", "$temp2", "$g_notification_menu_var2", logent_faction_declares_war_to_curb_power),
              (else_try),
                  (call_script, "script_dplmc_start_defensive_between_kingdoms", "$g_notification_menu_var1", "$temp2", 1),
                  (call_script, "script_diplomacy_start_war_between_kingdoms", "$temp2", "$g_notification_menu_var2", logent_faction_declares_war_to_curb_power),
              (try_end),
          (try_end),
          (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
          (str_store_string,s1,"@{s63} uses the opportunity and breaks his treaty with you and declares war!"),
      (else_try),
          (str_store_string,s1,"@{s63} accepts your decision reluctantly."),
      (try_end),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("other_subjects",[
      (faction_slot_eq, "$g_notification_menu_var2", slot_faction_leader, "trp_player"),
    ],"Resolve the matter in favor of {s63} subjects.",[
      (set_show_messages, 0),
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
          (store_faction_of_troop, ":lord_faction", ":lord"),
          (eq, ":lord_faction", "$players_kingdom"),
          (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
          (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
          (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
          (store_random_in_range, ":relation_shift", 1, 4),
          (val_mul, ":relation_shift", -1),
          (call_script, "script_change_player_relation_with_troop", ":lord", ":relation_shift"),
      (try_end),
      (set_show_messages, 1),
      (call_script, "script_change_troop_renown", "trp_player", -25),
      (call_script, "script_change_player_right_to_rule", -5),
      (display_message, "@Your relation with Lords of your faction decreases.", message_negative),
      (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
      (call_script, "script_change_player_relation_with_troop", ":leader_1", 5),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("ignore",[
      (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
    ],"Ignore the provocations.",[
      (set_show_messages, 0),
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
          (store_faction_of_troop, ":lord_faction", ":lord"),
          (eq, ":lord_faction", "$players_kingdom"),
          (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
          (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
          (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
          (store_random_in_range, ":relation_shift", 1, 4),
          (val_mul, ":relation_shift", -5),
          (call_script, "script_change_player_relation_with_troop", ":lord", ":relation_shift"),
      (try_end),
      (set_show_messages, 1),
      (call_script, "script_change_troop_renown", "trp_player", -50),
      (call_script, "script_change_player_right_to_rule", -5),
      (display_message, "@Your relation with Lords of your faction decreases.", message_negative),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("ask",[
      (neg|is_between, "$temp2", kingdoms_begin, kingdoms_end),
      (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
    ],"Ask to resolve the matter in favor of your people.",[
      (jump_to_menu, "mnu_notification_casus_belli_truce_decide_reaction_ask"),
    ]),
    ("ask_gift",[
      (is_between, "$temp2", kingdoms_begin, kingdoms_end),
      (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
    ],"Accept the gifts and ask to resolve the matter in favor of your people.",[
      (try_begin),
          (faction_slot_eq, "$g_notification_menu_var1", slot_faction_government_type, gov_imperial),
          (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_diplomacy, "$g_notification_menu_var1", 15000),
      (else_try),
          (troop_add_gold, "trp_player", 15000),
      (try_end),
      (store_relation, ":relation", "fac_player_supporters_faction", "$temp2"),
      (val_add, ":relation", 5),
      (val_max, ":relation", 50),
      (call_script, "script_set_player_relation_with_faction", "$temp2", ":relation"),
      (jump_to_menu, "mnu_notification_casus_belli_truce_decide_reaction_ask"),
    ]),
    ("ask_no_gift",[
      (is_between, "$temp2", kingdoms_begin, kingdoms_end),
      (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
    ],"Reject the gifts and ask to resolve the matter in favor of your people.",[
      (jump_to_menu, "mnu_notification_casus_belli_truce_decide_reaction_ask"),
    ]),
    ("switch_sides",[
      (eq, reg50, 1),
      (is_between, "$temp2", kingdoms_begin, kingdoms_end),
      (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
      (str_store_faction_name, "$temp2", s30),
    ],"Switch sides to {s30}, break the treaty and declare war! [25,000 denars from {s30}]",[
      (try_begin),
          (faction_slot_eq, "$g_notification_menu_var1", slot_faction_government_type, gov_imperial),
          (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_diplomacy, "$g_notification_menu_var1", 25000),
      (else_try),
          (troop_add_gold, "trp_player", 25000),
      (try_end),
      (set_show_messages, 0),
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
          (store_faction_of_troop, ":lord_faction", ":lord"),
          (eq, ":lord_faction", "$players_kingdom"),
          (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
          (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
          (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
          (store_random_in_range, ":relation_shift", 1, 4),
          (call_script, "script_change_player_relation_with_troop", ":lord", ":relation_shift"),
      (try_end),
      (set_show_messages, 1),
      (display_message, "@Your relation with Lords of your faction increases.", message_positive),
      (call_script, "script_dplmc_start_defensive_between_kingdoms", "$g_notification_menu_var1", "$temp2", 1),
      (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
      (call_script, "script_diplomacy_start_war_between_kingdoms", "$temp2", "$g_notification_menu_var2", logent_faction_declares_war_to_curb_power),

      (jump_to_menu, "mnu_auto_return_map"),
      (display_message, "@You have broken a pact and betrayed your ally!"),
      (call_script, "script_change_player_honor", -50),
      (call_script, "script_add_piety", -10, 1),
      (call_script, "script_change_troop_renown", "trp_player", 50),
    ]),
    ("declare_war",[
      (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
    ],"Break the treaty and declare war!",[
      (set_show_messages, 0),
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
          (store_faction_of_troop, ":lord_faction", ":lord"),
          (eq, ":lord_faction", "$players_kingdom"),
          (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
          (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
          (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
          (store_random_in_range, ":relation_shift", 1, 4),
          (call_script, "script_change_player_relation_with_troop", ":lord", ":relation_shift"),
      (try_end),
      (set_show_messages, 1),
      (display_message, "@Your relation with Lords of your faction increases.", message_positive),
      (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
      (jump_to_menu, "mnu_auto_return_map"),
      (display_message, "@You have broken a pact!"),
      (call_script, "script_change_player_honor", -25),
      (call_script, "script_add_piety", -5, 1),
      (call_script, "script_change_troop_renown", "trp_player", 25),
    ]),
    ("continue",[
      (assign, ":block", 0),
      (try_begin),
          (is_between, "$temp2", kingdoms_begin, kingdoms_end),
          (faction_slot_eq, "$temp2", slot_faction_leader, "trp_player"),
          (assign, ":block", 1),
      (try_end),
      (eq, ":block", 0),
      (neg|faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
      (neg|faction_slot_eq, "$g_notification_menu_var2", slot_faction_leader, "trp_player"),
    ],"Continue.",[
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("decide_ai_tribute",0,
    "You demand reparations and tributes from {s2}.^{s4}",
    "none",
    [
        (play_sound, "snd_message_negative_sound"),

        (store_random_in_range, ":rand_normal", -50, 50),
        (store_random_in_range, ":rand", -50, 50),
        (val_add, ":rand_normal", ":rand"),
        (val_abs, ":rand_normal"),
        #should be normal distributed with expectation value at 50

        (assign, reg40, 0),

        (call_script, "script_npc_decision_checklist_peace_or_war", "$g_notification_menu_var2", "$g_notification_menu_var1", -1),
        (assign, ":faction_2_to_1", reg0),

        (assign, ":explain_string", "str_none"),
        (try_begin),
            (faction_get_slot, ":leader_2", "$g_notification_menu_var2", slot_faction_leader),
            (try_begin),
                (this_or_next|troop_slot_eq, ":leader_2", slot_lord_reputation_type, lrep_martial),
                (this_or_next|troop_slot_eq, ":leader_2", slot_lord_reputation_type, lrep_debauched),
                (troop_slot_eq, ":leader_2", slot_lord_reputation_type, lrep_cunning),
                (val_sub, ":faction_2_to_1", 1),
            (try_end),
            (ge, ":faction_2_to_1", 0),
            (call_script, "script_count_parties_of_faction_and_party_type", "$g_notification_menu_var2", spt_town),
            (store_mul, reg40, reg0, 8000),
            (call_script, "script_count_parties_of_faction_and_party_type", "$g_notification_menu_var2", spt_castle),
            (val_mul, reg0, 4000),
            (val_add, reg40, reg0),
            (try_begin),
                (faction_slot_eq, "$g_notification_menu_var1", slot_faction_government_type, gov_imperial),
                (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_diplomacy, "$g_notification_menu_var1", reg40),
            (else_try),
                (troop_add_gold, "trp_player", reg40),
            (try_end),
            (assign, ":explain_string", "str_diplo_casus_expired_reparations_accepted"),
        (else_try),
            (assign, ":explain_string", "str_diplo_casus_expired_reparations_refused_war"),
            (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
        (try_end),

        (str_store_string, s4, ":explain_string"),

        (str_store_faction_name, s1, "$g_notification_menu_var1"),
        (str_store_faction_name, s2, "$g_notification_menu_var2"),

        (set_background_mesh, "mesh_pic_messenger"),
      ],
    [
        ("continue",[],"Continue",
        [
            (jump_to_menu, "mnu_auto_return_map"),
        ]),
    ]
),

("notification_casus_belli_decide",0,
  "The {s1} has suffered provocations from {s2}. {s3} demand reparations and tributes from {s2}.^{s4}",
  "none",[
    (play_sound, "snd_message_negative_sound"),

    (store_random_in_range, ":rand_normal", -50, 50),
    (store_random_in_range, ":rand", -50, 50),
    (val_add, ":rand_normal", ":rand"),
    (val_abs, ":rand_normal"),
    #should be normal distributed with expectation value at 50

    (assign, reg40, 0),

    (call_script, "script_npc_decision_checklist_peace_or_war", "$g_notification_menu_var1", "$g_notification_menu_var2", -1),
    (assign, ":faction_1_to_2", reg0),

    (call_script, "script_npc_decision_checklist_peace_or_war", "$g_notification_menu_var2", "$g_notification_menu_var1", -1),
    (assign, ":faction_2_to_1", reg0),

    (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
    (try_begin),
        (this_or_next|troop_slot_eq, ":leader_1", slot_lord_reputation_type, lrep_martial),
        (this_or_next|troop_slot_eq, ":leader_1", slot_lord_reputation_type, lrep_debauched),
        (troop_slot_eq, ":leader_1", slot_lord_reputation_type, lrep_cunning),
        (val_sub, ":faction_1_to_2", 1),
    (try_end),
    (str_store_troop_name, s3, ":leader_1"),

    (assign, ":explain_string", "str_none"),
    (try_begin),
        (lt,  ":faction_1_to_2", 0),
        (le, ":rand_normal", 50),
        (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
        (jump_to_menu, "mnu_auto_return_map"),
    (else_try),
        (le,  ":faction_1_to_2", 0),
        (le, ":rand_normal", 75),
        (try_begin),
            (faction_get_slot, ":leader_2", "$g_notification_menu_var2", slot_faction_leader),
            (eq, ":leader_2", "trp_player"),
            (jump_to_menu, "mnu_notification_tribute_demanded"),
        (else_try),
            (try_begin),
                (this_or_next|troop_slot_eq, ":leader_2", slot_lord_reputation_type, lrep_martial),
                (this_or_next|troop_slot_eq, ":leader_2", slot_lord_reputation_type, lrep_debauched),
                (troop_slot_eq, ":leader_2", slot_lord_reputation_type, lrep_cunning),
                (store_random_in_range, ":rand_normal", 0, 100),
                (le, ":rand_normal", 35),
                (val_sub, ":faction_2_to_1", 1),
            (try_end),
            (ge, ":faction_2_to_1", 0),
            (call_script, "script_count_parties_of_faction_and_party_type", "$g_notification_menu_var2", spt_town),
            (store_mul, reg40, reg0, 4000),
            (call_script, "script_count_parties_of_faction_and_party_type", "$g_notification_menu_var2", spt_castle),
            (val_mul, reg0, 2000),
            (val_add, reg40, reg0),
            (try_begin),
                (faction_slot_eq, "$g_notification_menu_var1", slot_faction_government_type, gov_imperial),
                (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_diplomacy, "$g_notification_menu_var1", reg40),
            (else_try),
                (call_script, "script_add_to_troop_wealth", ":leader_1", reg40),
            (try_end),

            #add truce
            (store_add, ":truce_slot", "$g_notification_menu_var1", slot_faction_truce_days_with_factions_begin),
            (val_sub, ":truce_slot", kingdoms_begin),
            (faction_set_slot, "$g_notification_menu_var2", ":truce_slot", dplmc_treaty_truce_days_initial),

            (store_add, ":truce_slot", "$g_notification_menu_var1", slot_faction_truce_days_with_factions_begin),
            (val_sub, ":truce_slot", kingdoms_begin),
            (faction_set_slot, "$g_notification_menu_var2", ":truce_slot", dplmc_treaty_truce_days_initial),

            (assign, ":explain_string", "str_diplo_casus_expired_reparations_accepted"),
        (else_try),
            (assign, ":explain_string", "str_diplo_casus_expired_reparations_refused_war"),
            (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
        (try_end),
    (else_try),
        (jump_to_menu, "mnu_notification_casus_belli_expired"),
    (try_end),

    (str_store_string, s4, ":explain_string"),

    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),

    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
    (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
    (val_mul, ":faction_1", 128),
    (val_add, ":faction_1", ":faction_2"),
    (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
  ],[
      ("continue",[],"Continue",[
        (jump_to_menu, "mnu_auto_return_map"),
      ]),
]),

("notification_lord_defects",0,
##diplomacy start+ Fix gender of pronouns
    "Defection: {s4} has abandoned the {s5} and joined the {s7}, taking {reg4?her:his} fiefs with {reg4?her:him}",
##diplomacy end+
    "none",
	[
	  (assign, ":defecting_lord", "$g_notification_menu_var1"),
	  (assign, ":old_faction", "$g_notification_menu_var2"),
	  (str_store_troop_name, s4, ":defecting_lord"),
	  (str_store_faction_name, s5, ":old_faction"),
	  (store_faction_of_troop, ":new_faction", ":defecting_lord"),
	  (str_store_faction_name, s7, ":new_faction"),
	  ##diplomacy start+ get gender with script
	  #(troop_get_type, reg4, ":defecting_lord"),#<-OLD
	  (call_script, "script_dplmc_store_troop_is_female_reg", ":defecting_lord", 4),
	  ##diplomacy end+

	],
    [
      ("continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
),

  (
    "notification_treason_indictment",0,
    "Treason Indictment^^{s9}",
    "none",
    [
	  (assign, ":indicted_lord", "$g_notification_menu_var1"),
	  (assign, ":former_faction", "$g_notification_menu_var2"),
	  (faction_get_slot, ":former_faction_leader", ":former_faction", slot_faction_leader),

	  #Set up string
	  (try_begin),
			(eq, ":indicted_lord", "trp_player"),
			(str_store_troop_name, s7, ":former_faction_leader"),
			(str_store_string, s9, "str_you_have_been_indicted_for_treason_to_s7_your_properties_have_been_confiscated_and_you_would_be_well_advised_to_flee_for_your_life"),
	  (else_try),
			(str_store_troop_name_link, s4, ":indicted_lord"),
			(str_store_faction_name_link, s5, ":former_faction"),
			(str_store_troop_name_link, s6, ":former_faction_leader"),

		   ##diplomacy start+ get gender with script
			#(troop_get_type, reg4, ":indicted_lord"),#<-OLD
			(call_script, "script_dplmc_store_troop_is_female_reg", ":indicted_lord", 4),
			##diplomacy end+
			(store_faction_of_troop, ":new_faction", ":indicted_lord"),
			(try_begin),
				(is_between, ":new_faction", kingdoms_begin, kingdoms_end),
				(str_store_faction_name_link, s10, ":new_faction"),
				(str_store_string, s11, "str_with_the_s10"),
			(else_try),
				(str_store_string, s11, "str_outside_calradia"),
			(try_end),
			(str_store_string, s9, "str_by_order_of_s6_s4_of_the_s5_has_been_indicted_for_treason_the_lord_has_been_stripped_of_all_reg4herhis_properties_and_has_fled_for_reg4herhis_life_he_is_rumored_to_have_gone_into_exile_s11"),
		(try_end),

	],
    [
      ("continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
	),

("notification_border_incident",0,
  "Border incident^^Word reaches you that {s9}. Though you don't know whether or not the rumors are true, you do know one thing -- this seemingly minor incident has raised tensions between the {s4} and {s3}.",
  "none",[
    (assign, ":acting_village", "$g_notification_menu_var1"),
    (assign, ":target_village", "$g_notification_menu_var2"),
    (store_faction_of_party, ":acting_faction", ":acting_village"),

    (try_begin),
        (eq, ":target_village", -1),
        (party_get_slot, ":target_faction", ":acting_village", slot_center_original_faction),
        (try_begin),
            (this_or_next|eq, ":target_faction", ":acting_faction"),
            (neg|faction_slot_eq, ":target_faction", slot_faction_state, sfs_active),
            (party_get_slot, ":target_faction", ":acting_village", slot_center_ex_faction),
        (try_end),

		    (str_store_party_name, s1, ":acting_village"),
		    (str_store_faction_name, s3, ":acting_faction"),
		    (str_store_faction_name, s4, ":target_faction"),
			  (faction_get_slot, ":target_leader", ":target_faction", slot_faction_leader),
		    (str_store_troop_name, s5, ":target_leader"),

        (str_store_string, s9, "str_local_notables_from_s1_a_village_claimed_by_the_s4_have_been_mistreated_by_their_overlords_from_the_s3_and_petition_s5_for_protection"),
        (display_log_message, "@There has been an alleged border incident: {s9}"),

        (call_script, "script_add_log_entry", logent_border_incident_subjects_mistreated, ":acting_village", -1, -1, ":acting_faction"),

    (else_try),
			  (store_faction_of_party, ":target_faction", ":target_village"),
		    (str_store_party_name, s1, ":acting_village"),
		    (str_store_party_name, s2, ":target_village"),
        (store_random_in_range, ":random", 0, 3),
        (try_begin),
            (eq, ":random", 0),
            (str_store_string, s9, "str_villagers_from_s1_stole_some_cattle_from_s2"),
            (display_log_message, "@There has been an alleged border incident: {s9}"),
            (call_script, "script_add_log_entry", logent_border_incident_cattle_stolen, ":acting_village", ":target_village", -1,":acting_faction"),
        (else_try),
            (eq, ":random", 1),
            (str_store_string, s9, "str_villagers_from_s1_abducted_a_woman_from_a_prominent_family_in_s2_to_marry_one_of_their_boys"),
            (display_log_message, "@There has been an alleged border incident: {s9}"),
            (call_script, "script_add_log_entry", logent_border_incident_bride_abducted, ":acting_village", ":target_village", -1, ":acting_faction"),
        (else_try),
            (eq, ":random", 2),
            (str_store_string, s9, "str_villagers_from_s1_killed_some_farmers_from_s2_in_a_fight_over_the_diversion_of_a_stream"),
            (display_log_message, "@There has been an alleged border incident: {s9}"),
            (call_script, "script_add_log_entry", logent_border_incident_villagers_killed, ":acting_village", ":target_village", -1,":acting_faction"),
        (try_end),

    (try_end),

    (str_store_faction_name, s3, ":acting_faction"),
    (str_store_faction_name, s4, ":target_faction"),

    (store_add, ":slot_provocation_days", ":acting_faction", slot_faction_provocation_days_with_factions_begin),
    (val_sub, ":slot_provocation_days", kingdoms_begin),
    (faction_set_slot, ":target_faction", ":slot_provocation_days", 30),

    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (store_sub, ":faction_1", ":acting_faction", kingdoms_begin),
    (store_sub, ":faction_2", ":target_faction", kingdoms_begin),
    (val_mul, ":faction_1", 128),
    (val_add, ":faction_1", ":faction_2"),
    (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
  ],[
  ("continue",[],"Continue",[
	  (change_screen_return),
  ]),
]),

("notification_player_faction_active",0,
  "You now possess land in your name, without being tied to any realm. This makes you a monarch in your own right, with your court temporarily located at {s12}. However, the other kings and rulers in the known world will at first consider you a threat, for if any upstart warlord can grab a throne, then their own legitimacy is called into question.^^Your first priority should be to establish an independent right to rule. You can establish your right to rule through several means -- marrying into a high-born family, recruiting new lords, governing your lands, treating with other kings, or dispatching your companions on missions.^^At any rate, your first step should be to appoint a chief minister from among your companions, to handle affairs of state. Different companions have different capabilities.^You may appoint new ministers from time to time. You may also change the location of your court, by speaking to the minister.",
  "none",
  [
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),
    (play_track, "track_coronation"),

	  (try_for_range, ":walled_center", walled_centers_begin, walled_centers_end),
        (lt, "$g_player_court", walled_centers_begin),
        (store_faction_of_party, ":walled_center_faction", ":walled_center"),
        (eq, ":walled_center_faction", "fac_player_supporters_faction"),
        (assign, "$g_player_court", ":walled_center"),
        (try_for_range, ":lady", kingdom_ladies_begin, kingdom_ladies_end),
            #Make sure the spouse hasn't been promoted, and is not a prisoner, and is not exiled/dead
            (troop_slot_eq, ":lady", slot_troop_occupation, slto_kingdom_lady),
            (neg|troop_slot_ge, ":lady", slot_troop_leaded_party, 0),
            #Make sure the lady isn't a prisoner
            (neg|troop_slot_ge, ":lady", slot_troop_prisoner_of_party, 0),
            (neg|main_party_has_troop, ":lady"),
            (try_begin),
                #Check if the lady is the player's spouse
                (this_or_next|troop_slot_eq, "trp_player", slot_troop_spouse, ":lady"),
                (troop_slot_eq, ":lady", slot_troop_spouse, "trp_player"),
                #Update location
                (troop_set_slot, ":lady", slot_troop_cur_center, "$g_player_court"),
            (else_try),
                #If the lady is unmarried, check if she is the player's dependent.
                (troop_slot_eq, ":lady", slot_troop_spouse, -1),
                (this_or_next|troop_slot_eq, ":lady", slot_troop_father, "trp_player"),
                (this_or_next|troop_slot_eq, ":lady", slot_troop_mother, "trp_player"),
                (troop_slot_eq, ":lady", slot_troop_guardian, "trp_player"),
                #Update location
                (troop_set_slot, ":lady", slot_troop_cur_center, "$g_player_court"),
            (try_end),
        (try_end),
	  (try_end),
    (str_store_party_name, s12, "$g_player_court"),
  ],[
	  ##diplomacy start+
	  #Make compatible with polygamy
  ("appoint_spouse",[
    (neg|check_quest_active, "qst_four_emperors"),
    (neg|quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 7), # not main story
    (neg|quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 11), # not main story

	  (troop_slot_ge, "trp_player", slot_troop_spouse, 1),
	  (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
	  (neg|troop_slot_eq, ":player_spouse", slot_troop_occupation, slto_kingdom_hero),
	  ##diplomacy start+
	  #Also do not appoint the missing or the dead
	  (neg|troop_slot_ge, ":player_spouse", slot_troop_occupation, slto_retirement),
	  (call_script, "script_dplmc_store_troop_is_female", ":player_spouse"),#reg0 make gender-correct
	  ##diplomacy end+
	  (str_store_troop_name, s10, ":player_spouse"),
  ],
    "Appoint your {reg0?wife:husband}, {s10}...",
  [
    (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
    (assign, "$g_player_minister", ":player_spouse"),
    (jump_to_menu, "mnu_minister_confirm"),
  ]),
  ("dplmc_appoint_spouse_plus_1",[
    (neg|check_quest_active, "qst_four_emperors"),
    (neg|quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 7), # not main story
    (neg|quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 11), # not main story

	  (troop_slot_ge, "trp_player", slot_troop_spouse, 1),
	  (assign, ":player_spouse", -1),
	  (try_for_range_backwards, ":troop_no", heroes_begin, kingdom_ladies_end),#Go backwards to ensure we end with the first match
		(troop_slot_eq, ":troop_no", slot_troop_spouse, "trp_player"),
		(neg|troop_slot_eq, "trp_player", slot_troop_spouse, ":troop_no"),#Not ordinary spouse
		(neg|troop_slot_ge, ":troop_no", slot_troop_occupation, slto_retirement),#Not retired/dead/exiled
		(neg|troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),#Not leading a party
		(assign, ":player_spouse", ":troop_no"),
	  (try_end),
	  (ge, ":player_spouse", 1),
	  (call_script, "script_dplmc_store_troop_is_female", ":player_spouse"),
	  (str_store_troop_name, s10, ":player_spouse"),
  ],
    "Appoint your {reg0?wife:husband}, {s10}...",
  [
    (assign, ":player_spouse", -1),
    (try_for_range_backwards, ":troop_no", heroes_begin, kingdom_ladies_end),#Go backwards to ensure we end with the first match
	      (troop_slot_eq, ":troop_no", slot_troop_spouse, "trp_player"),
        (neg|troop_slot_eq, "trp_player", slot_troop_spouse, ":troop_no"),#Not ordinary spouse
        (neg|troop_slot_ge, ":troop_no", slot_troop_occupation, slto_retirement),#Not retired/dead/exiled
        (neg|troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),#Not leading a party
        (assign, ":player_spouse", ":troop_no"),
    (try_end),
    (try_begin),
        (lt, ":player_spouse", 1),#This shouldn't be possible
        (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
    (try_end),

    (assign, "$g_player_minister", ":player_spouse"),
    (jump_to_menu, "mnu_minister_confirm"),
  ]), ##diplomacy end+
]+[
  ("appoint_npc"+str(x), [
    (assign, ":block", 0),
    (try_begin),
      (neg|troop_slot_ge, "trp_antonia", slot_troop_occupation, dplmc_slto_exile),
      (check_quest_active, "qst_four_emperors"),
      (this_or_next|quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 7), # not main story
      (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 11), # not main story
      (assign, ":block", 1),
    (try_end),
    (eq, ":block", 0),

    (main_party_has_troop, "trp_npc"+str(x)),
    (str_store_troop_name, s10, "trp_npc"+str(x)),
  ],"Appoint {s10}", [
    (assign, "$g_player_minister", "trp_npc"+str(x)),
    (jump_to_menu, "mnu_minister_confirm"),
  ]) for x in range (1, 17)
]+[
  ("appoint_default",[
    (assign, ":block", 0),
    (try_begin),
      (neg|troop_slot_ge, "trp_antonia", slot_troop_occupation, dplmc_slto_exile),
      (check_quest_active, "qst_four_emperors"),
      (this_or_next|quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 7), # not main story
      (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 11), # not main story
      (assign, ":block", 1),
    (try_end),
    (eq, ":block", 0),
  ],"Appoint a prominent citizen from the area...",
  [
    (assign, "$g_player_minister", "trp_temporary_minister"),
    (troop_set_faction, "trp_temporary_minister", "fac_player_supporters_faction"),
    (jump_to_menu, "mnu_minister_confirm"),
  ]),

  ("appoint_default",[
    (neg|troop_slot_ge, "trp_antonia", slot_troop_occupation, dplmc_slto_exile),
    (check_quest_active, "qst_four_emperors"),
    (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 7), # main story vespasian
  ],"Appoint Antonia.",
  [
    (assign, "$g_player_minister", "trp_antonia"),
    (troop_set_faction, "trp_antonia", "fac_player_supporters_faction"),
    (jump_to_menu, "mnu_minister_confirm"),
  ]),

  ("appoint_default",[
    (neg|troop_slot_ge, "trp_antonia", slot_troop_occupation, dplmc_slto_exile),
    (check_quest_active, "qst_four_emperors"),
    (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 11), # main story other goy
  ],"Appoint Antonia.",
  [
    (assign, "$g_player_minister", "trp_antonia"),
    (troop_set_faction, "trp_antonia", "fac_player_supporters_faction"),
    (jump_to_menu, "mnu_minister_confirm"),
  ]),

]),

("minister_confirm",0,
  "{s9}can be found at your court in {s12}. You should consult {reg4?her:him} periodically, to avoid the accumulation of unresolved issues that may sap your authority...",
  "none",
  [
	  (str_store_party_name, s12, "$g_player_court"),
    (try_begin),
        (store_and, ":name_set", "$players_kingdom_name_set", rename_kingdom),
        (eq, ":name_set", rename_kingdom),
        (change_screen_return),
    (try_end),
    (try_begin),
        (eq, "$g_player_minister", "trp_temporary_minister"),
        (str_store_string, s9, "str_your_new_minister_"),
    (else_try),
        (str_store_troop_name, s10, "$g_player_minister"),
        (str_store_string, s9, "str_s10_is_your_new_minister_and_"),
    (try_end),
    (try_begin),
        (neq, "$g_player_minister", "trp_gwenhwyfar"),
        (neq, "$g_player_minister", "trp_thestia_tomitia"),
        (main_party_has_troop, "$g_player_minister"),
        (remove_member_from_party, "$g_player_minister", "p_main_party"),
        (str_store_troop_name, s2, "$g_player_minister"),
        (display_message, "@{s2} leaves your party and travels to your court.", message_alert),
    (try_end),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 70),
    (position_set_y, pos0, 5),
    (position_set_z, pos0, 75),
    (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", "$g_player_minister", pos0),
    (call_script, "script_dplmc_store_troop_is_female_reg", "$g_player_minister", 4),
	],[
    ("continue",[],"Continue...",[
      #SB : explicitly state kingdom
      (assign, "$g_presentation_state", rename_kingdom),
      (start_presentation, "prsnt_name_kingdom"),
    ]),
]),

("notification_court_lost",0,
  "{s12}",
  "none",[
    (play_sound, "snd_message_negative_sound"),
    (try_begin),
      (is_between, "$g_player_court", centers_begin, centers_end),
      (str_store_party_name, s10, "$g_player_court"),
      (str_store_party_name, s11, "$g_player_court"),
    (else_try),
      (str_store_string, s10, "str_your_previous_court_some_time_ago"),
      (str_store_string, s11, "str_your_previous_court_some_time_ago"),
    (try_end),

    ##diplomacy start+ Handle player is co-ruler of NPC kingdom
    (assign, ":alt_faction", "fac_player_supporters_faction"),
    (try_begin),
      (is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
      (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", "$players_kingdom"),
      (ge, reg0, DPLMC_FACTION_STANDING_LEADER_SPOUSE),
      (assign, ":alt_faction", "$players_kingdom"),
    (try_end),
    ##diplomacy end+

    (try_begin), #SB : loss of court = loss of right to rule
      (store_and, ":name_set", "$players_kingdom_name_set", rename_center),
      (eq, ":name_set", rename_center),
      (call_script, "script_change_player_right_to_rule", -20),
      #the old "capital" should be stored so that this penalty does not apply twice
      #but we'll let the player name a new center
      (val_sub, "$players_kingdom_name_set", rename_center),
    (else_try), #need a court to lose one
      (is_between, "$g_player_court", centers_begin, centers_end),
      (call_script, "script_change_player_right_to_rule", -5),
    (try_end),
    (assign, "$g_player_court", -1),
    (str_store_string, s14, "str_after_to_the_fall_of_s11_your_court_has_nowhere_to_go"),
    (try_begin),
      ##diplomacy start+  Handle player is co-ruler of NPC kingdom
      (this_or_next|neg|is_between, ":alt_faction", npc_kingdoms_begin, npc_kingdoms_end),
      (neg|faction_slot_eq, ":alt_faction", slot_faction_state, sfs_active),
      ##diplomacy end+
      (faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_inactive),
      (str_store_string, s14, "str_as_you_no_longer_maintain_an_independent_kingdom_you_no_longer_maintain_a_court"),
    (try_end),

    (try_for_range, ":walled_center", walled_centers_begin, walled_centers_end),
      (eq, "$g_player_court", -1),
      ##diplomacy begin
      (neg|party_slot_eq, ":walled_center", slot_village_infested_by_bandits, "trp_peasant_woman"),
      ##diplomacy end
      (store_faction_of_party, ":walled_center_faction", ":walled_center"),
      ##diplomacy start+ Handle player is co-ruler of NPC kingdom
      (this_or_next|eq, ":alt_faction", ":walled_center_faction"),
      ##diplomacy end+
      (eq, ":walled_center_faction", "fac_player_supporters_faction"),
      (neg|party_slot_ge, ":walled_center", slot_town_lord, active_npcs_begin),

      (assign, "$g_player_court", ":walled_center"),
      (try_begin),
        (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
        (is_between, ":spouse", kingdom_ladies_begin, kingdom_ladies_end),
        ##diplomacy start+ Check that the spouse is not a hero, imprisoned (except by the player), or exiled/dead/etc.
              (try_begin),
                  (neg|troop_slot_eq, ":spouse", slot_troop_occupation, slto_kingdom_hero),
                  (neg|troop_slot_ge, ":spouse", slot_troop_occupation, slto_retirement),
                  (neg|troop_slot_ge, ":spouse", slot_troop_prisoner_of_party, 1),
                  ##diplomacy end+
                  (neg|main_party_has_troop,":spouse"),
                  (troop_set_slot, ":spouse", slot_troop_cur_center, "$g_player_court"),
              (try_end),
        (str_store_party_name, s11, "$g_player_court"),
      (try_end),

      (str_store_string, s14, "str_due_to_the_fall_of_s10_your_court_has_been_relocated_to_s12"), #actually s11
    (try_end),

    (try_for_range, ":walled_center", walled_centers_begin, walled_centers_end),
      (eq, "$g_player_court", -1),

      (store_faction_of_party, ":walled_center_faction", ":walled_center"),
      ##diplomacy start+ Handle player is co-ruler of NPC kingdom
      (this_or_next|eq, ":alt_faction", ":walled_center_faction"),
      ##diplomacy end+
      (eq, ":walled_center_faction", "fac_player_supporters_faction"),

      (assign, "$g_player_court", ":walled_center"),

      (try_begin),
        (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
        (is_between, ":spouse", kingdom_ladies_begin, kingdom_ladies_end),
        ##diplomacy start+ Check that the spouse is not a hero, imprisoned (except by the player), or exiled/dead/etc.
        (neg|troop_slot_eq, ":spouse", slot_troop_occupation, slto_kingdom_hero),
        (neg|troop_slot_ge, ":spouse", slot_troop_occupation, slto_retirement),
        (neg|troop_slot_ge, ":spouse", slot_troop_prisoner_of_party, 1),
        ##diplomacy end+
        (troop_set_slot, ":spouse", slot_troop_cur_center, "$g_player_court"),
      (try_end),

      (party_get_slot, ":town_lord", ":walled_center", slot_town_lord),
      (str_store_party_name, s11, "$g_player_court"),
      (str_store_troop_name, s9, ":town_lord"),
      (str_store_string, s14, "str_after_to_the_fall_of_s10_your_faithful_vassal_s9_has_invited_your_court_to_s11_"),
    (try_end),

    (try_begin),
      ##diplomacy start+  Handle player is co-ruler of NPC kingdom
      (this_or_next|neg|is_between, ":alt_faction", npc_kingdoms_begin, npc_kingdoms_end),
      (neg|faction_slot_eq, ":alt_faction", slot_faction_state, sfs_active),
      ##diplomacy end+
      (faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_inactive),
      (str_store_string, s14, "str_as_you_no_longer_maintain_an_independent_kingdom_you_no_longer_maintain_a_court"),
    (try_end),
    (str_store_string, s12, s14),
  ],[
    ("continue",[],"Continue...",[
	    (change_screen_return),
	  ]),
]),

  (
    "notification_player_faction_deactive",0,
    "Your kingdom no longer holds any land.",
    "none",
    [ (play_sound, "snd_message_negative_sound"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [
       (assign, "$g_player_minister", -1),
       (change_screen_return),
        ]),
     ]
  ),

  (
    "notification_player_wedding_day",mnf_scale_picture,
    "{s8} wishes to inform you that preparations for your wedding at {s10} have been complete, and that your presence is expected imminently .",
    "none",
    [
		(set_background_mesh, "mesh_pic_messenger"),
		(str_store_troop_name, s8, "$g_notification_menu_var1"),
		(str_store_party_name, s10, "$g_notification_menu_var2"),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "notification_player_kingdom_holds_feast",mnf_scale_picture,
    "{s11}",
    "none",
    [
		(set_background_mesh, "mesh_pic_messenger"),

		(str_store_troop_name, s8, "$g_notification_menu_var1"),
		(store_faction_of_troop, ":host_faction", "$g_notification_menu_var1"),
		(str_store_faction_name, s9, ":host_faction"),

#		(str_store_faction_name, s9, "$players_kingdom"),
		(str_store_party_name, s10, "$g_notification_menu_var2"),

		(str_clear, s12),
		(try_begin),
			(check_quest_active, "qst_wed_betrothed"),
			(quest_get_slot, ":giver_troop", "qst_wed_betrothed", slot_quest_giver_troop),
			(store_faction_of_troop, ":giver_troop_faction", ":giver_troop"),
			(eq, ":giver_troop_faction", "$players_kingdom"),
			(str_store_string, s12, "str_feast_wedding_opportunity"),
		(try_end),

		(str_store_string, s11, "str_s8_wishes_to_inform_you_that_the_lords_of_s9_will_be_gathering_for_a_feast_at_his_great_hall_in_s10_and_invites_you_to_be_part_of_this_august_assembly"),
		(try_begin),
			(eq, "$g_notification_menu_var1", 0),
			(str_store_string, s11, "str_the_great_lords_of_your_kingdom_plan_to_gather_at_your_hall_in_s10_for_a_feast"),
		(try_end),
		(str_store_string, s11, "@{!}{s11}{s12}"),

		(try_begin),
			(ge, "$cheat_mode", 1),
			(store_current_hours, ":hours_since_last_feast"),
			(faction_get_slot, ":last_feast_start_time", "$players_kingdom", slot_faction_last_feast_start_time),
			(val_sub, ":hours_since_last_feast", ":last_feast_start_time"),
			(assign, reg4, ":hours_since_last_feast"),
			(display_message, "@{!}DEBUG -- Hours since last feast started: {reg4}"),
		(try_end),

      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "notification_center_under_siege",0,
    "{s1} has been besieged by {s2} of {s3}!",
    "none",
    [ (play_sound, "snd_riot_sound"),
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":troop_faction", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":troop_faction"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "notification_village_raided",0,
    "Enemies have Laid Waste to a Fief^^{s1} has been raided by {s2} of {s3}!",
    "none",
    [ (play_sound, "snd_riot_sound"),
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":troop_faction", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":troop_faction"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "notification_village_raid_started",0,
    "Your Village is under Attack!^^{s2} of {s3} is laying waste to {s1}.",
    "none",
    [ (play_sound, "snd_riot_sound"),
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":troop_faction", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":troop_faction"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),
  (
    "notification_village_raid_started_rebells",0,
    "Your Village is under Attack!^^{s2} are laying waste to {s1}.",
    "none",
    [ (play_sound, "snd_riot_sound"),
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_party_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

("notification_one_faction_left",0,
  "Mundus coniungere!^^ One realm conquered the world.^{s1} has defeated all rivals and stands as the sole ruler, the ruler of the world.",
  "none",[
    (faction_get_slot, ":king", "$g_notification_menu_var1", slot_faction_leader),
    (str_store_troop_name, s1, ":king"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", kingdoms_end), #Excluding player kingdom
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
    (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

("notification_kingdom_restored",0,
  "Kingdom Restored!^^The people of {s1} have risen in rebellion against their occupiers, reclaiming their kingdom. Their former lords now rally to fight for its future.",
  "none",[
    (play_sound, "snd_riot_sound"),
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", kingdoms_end), #Excluding player kingdom
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
    (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

("notification_kingdom_liberated",0,
  "Kingdom Liberated!^^The people of {s1} have been freed from their oppressors, thanks to the valor of {s2}.",
  "none",[
    (play_sound, "snd_riot_sound"),
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", kingdoms_end), #Excluding player kingdom
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
    (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

  (
    "notification_oath_renounced_faction_defeated",0,
    "Your Old Faction was Defeated^^You won the battle against {s1}! This ends your struggle which started after you renounced your oath to them.",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", kingdoms_end), #Excluding player kingdom
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

("notification_center_lost",0,
  "An Estate was Lost^^You have lost {s1} to {s2}.",
  "none",
  [ (play_sound, "snd_message_negative_sound"),
    (str_store_party_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 62),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
    ],
  [
    ("continue",[],"Continue...",
      [(change_screen_return),
      ]),
    ]
),

("notification_center_sacked",0,
  "An Estate has been sacked^^{s1} has been sacked by {s2}.",
  "none",
  [ (play_sound, "snd_message_negative_sound"),
    (str_store_party_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 62),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
    ],
  [
    ("continue",[],"Cruel...",
      [(change_screen_return),
      ]),
    ]
),

("notification_troop_left_players_faction",0,
    "Betrayal!^^{s1} has left {s2} and joined {s3}.",
    "none",
    [ (play_sound, "snd_message_negative_sound"),
      (str_store_troop_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$players_kingdom"),
      (str_store_faction_name, s3, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 55),
      (position_set_y, pos0, 20),
      (position_set_z, pos0, 100),
      (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
]),

("notification_troop_joined_players_faction",0,
  "Good news!^^ {s1} has left {s2} and joined {s3}.",
  "none",[
    (str_store_troop_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (str_store_faction_name, s3, "$players_kingdom"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 55),
    (position_set_y, pos0, 20),
    (position_set_z, pos0, 100),
    (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", "$g_notification_menu_var1", pos0),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

# for main story: if parthia or armenia declare war on player Rome
("armenia_parthia_declare_war",0,
  "War avoided^^{s1} wanted to declare war against you! However, as the civil war continues, your minister {s25} negotiated a treaty to avoid a second front.^{reg22} denars had to be paid to avoid war.",
  "none",[
    (try_begin),
        (gt, "$g_player_minister", 0),
        (str_store_troop_name, s25, "$g_player_minister"),
    (else_try),
        (str_store_string, s25, "@Dickus Biggus"),
    (try_end),

    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),

    (try_begin),
        (eq, "$g_notification_menu_var1", "fac_kingdom_6"),
        (assign, reg22, 500000),
    (else_try),
        (assign, reg22, 100000),
    (try_end),

    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
    (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
    (val_mul, ":faction_1", 128),
    (val_add, ":faction_1", ":faction_2"),
    (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
    (play_sound, "snd_message_negative_sound"),
  ],[
    ("continue",[],"Continue...",[
      (call_script, "script_dplmc_start_nonaggression_between_kingdoms", "$players_kingdom", "$g_notification_menu_var1", 1),
      (call_script, "script_add_to_faction_bugdet", slot_faction_spending_diplomacy, "$players_kingdom", reg22),
      (change_screen_return),
    ]),
]),

#chief sot cambia texto abajo, y motomataru cambia texto y codigo
("notification_war_declared",0,
  "Declaration of War^^{s1} has declared war against {s2}!^{s57}^The sword has been drawn from the sheath, and the shield taken down from the wall. War has been declared!",
  "none",
  [
    #MOTO salvage explanation (when multiple explanations needed, only last one valid)
    (try_begin),
        (eq, "$g_last_acting_faction", "$g_notification_menu_var1"),
        (eq, "$g_last_target_faction", "$g_notification_menu_var2"),
        (str_store_string, s57, "@^{s64}^"),
        (assign, "$g_last_acting_faction", -1),
        (assign, "$g_last_target_faction", -1),
    (else_try),
        (str_clear, s57),
    (try_end),
    #MOTO salvage explanation end

    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),

    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
    (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
    (val_mul, ":faction_1", 128),
    (val_add, ":faction_1", ":faction_2"),
    (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
    (play_sound, "snd_message_negative_sound"),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

("notification_decide_tributary_war_decleration",0,
    "Your tributary vassal {s1} wants to declared war against {s2}.^^{s57}^^How do you wish to react? As they are your vassals you can force them to hold off from such plans. Or you use this opportunity to declare war without penalities.",
    "none",
    [
        (call_script, "script_npc_decision_checklist_peace_or_war", "$g_notification_menu_var1", "$g_notification_menu_var2", -1),
        (str_store_string, s57, reg1),

        (str_store_faction_name, s1, "$g_notification_menu_var1"),
        (str_store_faction_name, s2, "$g_notification_menu_var2"),

        (set_fixed_point_multiplier, 100),
        (position_set_x, pos0, 65),
        (position_set_y, pos0, 30),
        (position_set_z, pos0, 170),
        (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
        (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
        (val_mul, ":faction_1", 128),
        (val_add, ":faction_1", ":faction_2"),
        (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
      ],
    [
      ("continue",[],"Force them to hold off from such plans!",
       [
        (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
        (call_script, "script_change_player_relation_with_troop", ":leader", -25),
        (change_screen_return),
       ]),
      ("continue",[],"Follow {s1} in the war.",
       [
        (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
        (call_script, "script_change_player_relation_with_troop", ":leader", 10),

        (call_script, "script_diplomacy_start_war_between_kingdoms", "$players_kingdom", "$g_notification_menu_var2", logent_faction_declares_war_to_fulfil_pact),
        (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var1", "$g_notification_menu_var2", logent_faction_declares_war_to_respond_to_provocation),
        (change_screen_return),
       ]),
    ]
),

("notification_decide_defensive_war",0,
    "{s1} has declared war against your {s22} {s2}.^^{s57}^^How do you wish to react?",
    "none",
    [
        (try_begin),
            (faction_slot_eq, "$g_notification_menu_var2", slot_faction_tributary_of, "$players_kingdom"),
            (str_store_string, s22, "@tributary vassal"),
        (else_try),
            (str_store_string, s22, "@ally"),
        (try_end),

        (call_script, "script_npc_decision_checklist_peace_or_war", "$g_notification_menu_var1", "$g_notification_menu_var2", -1),
        (str_store_string, s57, reg1),

        (str_store_faction_name, s1, "$g_notification_menu_var1"),
        (str_store_faction_name, s2, "$g_notification_menu_var2"),

        (set_fixed_point_multiplier, 100),
        (position_set_x, pos0, 65),
        (position_set_y, pos0, 30),
        (position_set_z, pos0, 170),
        (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
        (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
        (val_mul, ":faction_1", 128),
        (val_add, ":faction_1", ":faction_2"),
        (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
        (play_sound, "snd_message_negative_sound"),
      ],
    [
      ("continue",[],"Try to enforce peace by threatening {s1} with joining the war. [costs 1,000 denars to send message]",
       [
        (try_begin),
            (store_troop_gold, reg0, "trp_player"),
            (lt, reg0, 1000),
            (display_message, "str_no_money", color_bad_news),
        (else_try),
            (store_add, ":slot_provocation_days", "$players_kingdom", slot_faction_provocation_days_with_factions_begin),
            (val_sub, ":slot_provocation_days", kingdoms_begin),
            (faction_set_slot, "$g_notification_menu_var1", ":slot_provocation_days", 15),

            (faction_get_slot, ":leader", "$g_notification_menu_var2", slot_faction_leader),
            (call_script, "script_change_player_relation_with_troop", ":leader", -10),

            (jump_to_menu, "mnu_threat_war_reaction"),
            (troop_remove_gold, "trp_player", 1000),
        (try_end),
       ]),
      ("continue",[],"Follow {s2} in the war.",
       [
        (faction_get_slot, ":leader", "$g_notification_menu_var2", slot_faction_leader),
        (call_script, "script_change_player_relation_with_troop", ":leader", 10),

        (call_script, "script_diplomacy_start_war_between_kingdoms", "$players_kingdom", "$g_notification_menu_var1", logent_faction_declares_war_to_fulfil_pact),
        (change_screen_return),
       ]),
      ("continue",[],"Break your agreement with {s2}.",
       [
        (call_script, "script_change_player_honor", -25),
        (call_script, "script_change_troop_renown", "trp_player", -50),

        (try_begin),
            (faction_slot_eq, "$g_notification_menu_var2", slot_faction_tributary_of, "$players_kingdom"),
            (faction_set_slot, "$g_notification_menu_var2", slot_faction_tributary_of, 0),
        (try_end),

        (store_add, ":truce_slot_a", "$g_notification_menu_var2", slot_faction_truce_days_with_factions_begin),
        (val_sub, ":truce_slot_a", kingdoms_begin),
        (faction_set_slot, "$players_kingdom", ":truce_slot_a", 0),

        (store_add, ":truce_slot_a", "$players_kingdom", slot_faction_truce_days_with_factions_begin),
        (val_sub, ":truce_slot_a", kingdoms_begin),
        (faction_set_slot, "$g_notification_menu_var2", ":truce_slot_a", 0),

        (store_add, ":slot_provocation_days", "$players_kingdom", slot_faction_provocation_days_with_factions_begin),
        (val_sub, ":slot_provocation_days", kingdoms_begin),
        (faction_set_slot, "$g_notification_menu_var2", ":slot_provocation_days", 30),

        (faction_get_slot, ":leader", "$g_notification_menu_var2", slot_faction_leader),
        (call_script, "script_change_player_relation_with_troop", ":leader", -100),

        (str_store_faction_name, s4, "$players_kingdom"),
        (display_log_message, "@{s4} broke its agreement with {s2}"),

        (change_screen_return),
       ]),
    ]
),

("notification_decide_offensive_war",0,
  "Your {s20} {s1} has declared war against {s2}.^^{s57}^^How do you wish to react?",
  "none",[
    (str_store_string, s20, "@ally"),
    (try_begin),
        (faction_slot_eq, "$players_kingdom", slot_faction_tributary_of, "$g_notification_menu_var1"),
        (str_store_string, s20, "@overlord"),
    (try_end),
    (call_script, "script_npc_decision_checklist_peace_or_war", "$g_notification_menu_var1", "$g_notification_menu_var2", -1),
    (str_store_string, s57, reg1),

    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),

    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
    (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
    (val_mul, ":faction_1", 128),
    (val_add, ":faction_1", ":faction_2"),
    (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
    (play_sound, "snd_message_negative_sound"),
  ],[
    ("continue",[
      (neg|faction_slot_eq, "$players_kingdom", slot_faction_tributary_of, "$g_notification_menu_var1"),
      (store_troop_gold, reg0, "trp_player"),
      (gt, reg0, 1000),
    ],"Try to persuade {s1} to stop the war. [costs 1,000 denars to send message]",[
      (store_add, ":slot_provocation_days", "$players_kingdom", slot_faction_provocation_days_with_factions_begin),
      (val_sub, ":slot_provocation_days", kingdoms_begin),
      (faction_set_slot, "$g_notification_menu_var1", ":slot_provocation_days", 15),
      # (faction_get_slot, ":leader", "$g_notification_menu_var2", slot_faction_leader),
      # (call_script, "script_change_player_relation_with_troop", ":leader", -10),
      (jump_to_menu, "mnu_persuade_war_reaction"),
      (troop_remove_gold, "trp_player", 1000),
    ]),
    ("continue",[],"Follow {s1} in the war.",[
      (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
      (call_script, "script_change_player_relation_with_troop", ":leader", 10),
      (call_script, "script_diplomacy_start_war_between_kingdoms", "$players_kingdom", "$g_notification_menu_var2", logent_faction_declares_war_to_fulfil_pact),
      (change_screen_return),
    ]),
    ("continue",[
      (faction_slot_eq, "$players_kingdom", slot_faction_tributary_of, "$g_notification_menu_var1"),
    ],"Declare your independence from {s1}.",[
      (call_script, "script_change_player_honor", -25),
      (call_script, "script_change_troop_renown", "trp_player", -50),

      (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
      (call_script, "script_change_player_relation_with_troop", ":leader", -100),
      (call_script, "script_diplomacy_start_war_between_kingdoms", "$players_kingdom", "$g_notification_menu_var1", logent_faction_declares_war_to_fulfil_pact),

      (change_screen_return),
    ]),
    ("continue",[
      (neg|faction_slot_eq, "$players_kingdom", slot_faction_tributary_of, "$g_notification_menu_var1"),
    ],"Break your alliance with {s1}.",[
      (call_script, "script_change_player_honor", -25),
      (call_script, "script_change_troop_renown", "trp_player", -50),

      (try_begin),
          (faction_slot_eq, "$g_notification_menu_var1", slot_faction_tributary_of, "$players_kingdom"),
          (faction_set_slot, "$g_notification_menu_var1", slot_faction_tributary_of, 0),
      (try_end),

      (store_add, ":truce_slot_a", "$g_notification_menu_var1", slot_faction_truce_days_with_factions_begin),
      (val_sub, ":truce_slot_a", kingdoms_begin),
      (faction_set_slot, "$players_kingdom", ":truce_slot_a", 0),

      (store_add, ":truce_slot_a", "$players_kingdom", slot_faction_truce_days_with_factions_begin),
      (val_sub, ":truce_slot_a", kingdoms_begin),
      (faction_set_slot, "$g_notification_menu_var1", ":truce_slot_a", 0),

      (store_add, ":slot_provocation_days", "$players_kingdom", slot_faction_provocation_days_with_factions_begin),
      (val_sub, ":slot_provocation_days", kingdoms_begin),
      (faction_set_slot, "$g_notification_menu_var1", ":slot_provocation_days", 30),

      (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
      (call_script, "script_change_player_relation_with_troop", ":leader", -100),

      (str_store_faction_name, s4, "$players_kingdom"),
      (display_log_message, "@{s4} broke its agreement with {s2}"),

      (change_screen_return),
    ]),
]),

("persuade_war_reaction",0,
  "{s57}",
  "none",[
    (call_script, "script_store_number_of_wars", "$g_notification_menu_var1"),
    (store_mul, ":player_strength", reg0, 10),

    (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),

    (call_script, "script_troop_get_player_relation", ":leader"),
    (assign, ":relation", reg0),
    (val_mul, ":relation", 2),
    (val_add, ":player_strength", ":relation"),

    (call_script, "script_personality_modifier", ":leader"),
    (assign, ":leader_modifier", reg0),##250-100
    (val_div, ":leader_modifier", 100),#3/2-1
    (val_div, ":player_strength", ":leader_modifier"),
    (try_begin),
        (ge, "$cheat_mode", 1),
        (assign, reg11, ":player_strength"),
        (display_message, "@player_strength: {reg11}"),
    (try_end),
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (str_store_troop_name, s3, ":leader"),
    (try_begin),
        (gt, ":player_strength", 100),
        (str_store_string, s57, "@Messengers are send and soon you recieve news that {s3} of {s1} has re-thought his actions. He send you a best wishes and will not attack the {s2}."),
        (assign, "$temp1", 1),
    (else_try),
        (str_store_string, s57, "@Messengers are send and soon you recieve news that {s3} of {s1} will attack the {s2} nevertheless."),
        (assign, "$temp1", -1),
    (try_end),
  ],[
    ("continue",[(eq, "$temp1", 1),],"Continue",[
      (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_notification_menu_var2", "$g_notification_menu_var1", 0),
      (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
      (call_script, "script_change_player_relation_with_troop", ":leader", -10),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("continue",[(eq, "$temp1", -1),],"Do not join this war and break your alliance!",[
      (call_script, "script_change_player_honor", -25),
      (call_script, "script_change_troop_renown", "trp_player", -50),

      (try_begin),
          (faction_slot_eq, "$g_notification_menu_var1", slot_faction_tributary_of, "$players_kingdom"),
          (faction_set_slot, "$g_notification_menu_var1", slot_faction_tributary_of, 0),
      (try_end),

      (store_add, ":truce_slot_a", "$g_notification_menu_var1", slot_faction_truce_days_with_factions_begin),
      (val_sub, ":truce_slot_a", kingdoms_begin),
      (faction_set_slot, "$players_kingdom", ":truce_slot_a", 0),

      (store_add, ":truce_slot_a", "$players_kingdom", slot_faction_truce_days_with_factions_begin),
      (val_sub, ":truce_slot_a", kingdoms_begin),
      (faction_set_slot, "$g_notification_menu_var1", ":truce_slot_a", 0),

      (store_add, ":slot_provocation_days", "$players_kingdom", slot_faction_provocation_days_with_factions_begin),
      (val_sub, ":slot_provocation_days", kingdoms_begin),
      (faction_set_slot, "$g_notification_menu_var1", ":slot_provocation_days", 30),

      (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
      (call_script, "script_change_player_relation_with_troop", ":leader", -100),

      (str_store_faction_name, s4, "$players_kingdom"),
      (display_log_message, "@{s4} broke its agreement with {s1}"),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("continue",[(eq, "$temp1", -1),],"Help your ally by declaring war.",[
      (call_script, "script_diplomacy_start_war_between_kingdoms", "$players_kingdom", "$g_notification_menu_var2", logent_faction_declares_war_to_curb_power),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("threat_war_reaction",0,
  "{s57}",
  "none",[
    (assign, ":player_strength", 0),
    (assign, ":enemy_strength", 10),
	  (try_for_parties, ":party_no"),
        (party_is_active, ":party_no"),
        (store_faction_of_party, ":faction_no", ":party_no"),
        (this_or_next|eq, ":faction_no", "$players_kingdom"),
        (eq, ":faction_no", "$g_notification_menu_var1"),

        (store_party_size_wo_prisoners, ":party_value", ":party_no"),#use size of party
        (try_begin),
            (is_between, ":party_no", towns_begin, towns_end),
            (val_div, ":party_value", 300),##average size 1200 -> 4
        (else_try),
            (is_between, ":party_no", castles_begin, castles_end),
            (val_div, ":party_value", 250),##average size 700 -> 3
        (else_try),
            (party_get_template_id, ":template", ":party_no"),
            (eq, ":template", "pt_kingdom_hero_party"),
            (val_div, ":party_value", 100),##average size 400 -> 4
        (else_try),
        ##consider all the new parties too!#Nero Claudius begin
            (this_or_next|eq, ":template", "pt_dacians"),
            (this_or_next|eq, ":template", "pt_nomads"),
            (this_or_next|eq, ":template", "pt_germans"),
            (this_or_next|eq, ":template", "pt_cals"),
            (eq, ":template", "pt_brits"),#Nero claudius end
            (val_div, ":party_value", 250),##average size 1000 -> 5
        (else_try),#nero claudius begin
            (this_or_next|eq, ":template", "pt_patrols_end"),
            (this_or_next|eq, ":template", "pt_hord_roxolanen"),
            (eq, ":template", "pt_hord_siraken"),
            (val_div, ":party_value", 50),##average size 200 -> 4
        (else_try),
            (assign, ":party_value", 0),
		    (try_end),
        (assign, ":is_ally", 0),#are they allies?, also include allies into strength calculation
        #total strengths
        (try_begin),
            (is_between, ":faction_no", kingdoms_begin, kingdoms_end),
            #check if party is part of an ally
            (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":faction_no", "$g_notification_menu_var1"),
            (assign, ":duration_of_status_actor", reg1),
            (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":faction_no", "$players_kingdom"),
            (assign, ":duration_of_status_player", reg1),
            (try_begin),#dont consider if allied with both
                (gt, ":duration_of_status_player", dplmc_treaty_defense_days_expire),
                (gt, ":duration_of_status_actor", dplmc_treaty_defense_days_expire),
                (assign, ":is_ally", 0),
            (else_try),
                (is_between, ":duration_of_status_actor", dplmc_treaty_defense_days_expire + 1, dplmc_treaty_defense_days_initial + 1),
                (assign, ":is_ally", 0),#no defense pact for attacker is considered
            (else_try),
                (is_between, ":duration_of_status_actor", dplmc_treaty_alliance_days_expire + 1, dplmc_treaty_alliance_days_initial + 1),
                (assign, ":is_ally", -1),
            (else_try),
                (is_between, ":duration_of_status_actor", dplmc_treaty_tributary_days_expire + 1, dplmc_treaty_tributary_days_initial + 1),
                (assign, ":is_ally", -1),
            (else_try),
                (is_between, ":duration_of_status_player", dplmc_treaty_defense_days_expire + 1, dplmc_treaty_defense_days_initial + 1),
                (assign, ":is_ally", 1),
            (else_try),
                (is_between, ":duration_of_status_player", dplmc_treaty_alliance_days_expire + 1, dplmc_treaty_alliance_days_initial + 1),
                (assign, ":is_ally", 1),
            (else_try),
                (is_between, ":duration_of_status_player", dplmc_treaty_tributary_days_expire + 1, dplmc_treaty_tributary_days_initial + 1),
                (assign, ":is_ally", 1),
            (try_end),
        (try_end),
        (try_begin),
            (this_or_next|eq, ":faction_no", "$g_notification_menu_var1"),
            (eq, ":is_ally", -1),
            (val_add, ":enemy_strength", ":party_value"),
        (else_try),
            (val_add, ":player_strength", ":party_value"),
        (try_end),
	  (try_end),
    (call_script, "script_store_number_of_wars", "$players_kingdom"),
    (assign, ":number_of_wars_player", reg0),
    (call_script, "script_store_number_of_wars", "$g_notification_menu_var1"),
    (assign, ":number_of_wars_enemy", reg0),

    (store_sub, ":modifier_enemy_1", 50, ":number_of_wars_enemy"),
    (store_sub, ":modifier_player_1", 50, ":number_of_wars_player"),

    (store_add, ":modifier_enemy_2", 50, ":number_of_wars_player"),
    (store_add, ":modifier_player_2", 50, ":number_of_wars_enemy"),

    (val_mul, ":enemy_strength", ":modifier_enemy_1"),
    (val_div, ":enemy_strength", 50),
    (val_mul, ":enemy_strength", ":modifier_enemy_2"),
    (val_div, ":enemy_strength", 50),

    (val_mul, ":player_strength", ":modifier_player_1"),
    (val_div, ":player_strength", 50),
    (val_mul, ":player_strength", ":modifier_player_2"),
    (val_div, ":player_strength", 50),

    (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
    (call_script, "script_personality_modifier", ":leader"),
    (val_mul, ":enemy_strength", reg0),
    (val_div, ":enemy_strength", 100),

    (call_script, "script_troop_get_player_relation", ":leader"),
    (assign, ":relation", reg0),
    (try_begin),
        (lt, ":relation", -75),
        (val_mul, ":enemy_strength", 2),
    (else_try),
        (lt, ":relation", -50),
        (val_mul, ":enemy_strength", 5),
        (val_div, ":enemy_strength", 3),
    (else_try),
        (lt, ":relation", 0),
        (val_mul, ":enemy_strength", 3),
        (val_div, ":enemy_strength", 2),
    (try_end),

    (store_random_in_range, ":rand_factor", 90, 151),
    (val_mul, ":enemy_strength", ":rand_factor"),
    (val_div, ":enemy_strength", 100),

    (val_div, ":relation", 10),
    (val_add, ":player_strength", ":relation"),

    (try_begin),
        (ge, "$cheat_mode", 1),
        (assign, reg11, ":player_strength"),
        (assign, reg12, ":enemy_strength"),
        (display_message, "@player_strength: {reg11}, enemy_strength: {reg12}"),
    (try_end),
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (str_store_troop_name, s3, ":leader"),

    (try_begin),
        (gt, ":player_strength", ":enemy_strength"),

        (store_mul, reg40, ":enemy_strength", 1000),
        (val_clamp, reg40, 5000, 100001),

        (str_store_string, s57, "@Messengers are sent, and soon you receive word that {s3} of {s1} has reconsidered his actions. He has sent you a gift of {reg40} denars and will not attack the {s2} in the future."),
        (assign, "$temp1", 1),
    (else_try),
        (str_store_string, s57, "@Messengers are sent, and soon you receive word that {s3} of {s1} will attack the {s2} regardless. You are now compelled to join the war."),
        (assign, "$temp1", -1),
    (try_end),
  ],[
    ("continue",[],"Continue",[
      (try_begin),
          (eq, "$temp1", -1),
          (call_script, "script_diplomacy_start_war_between_kingdoms", "$players_kingdom", "$g_notification_menu_var1", logent_faction_declares_war_to_curb_power),
      (else_try),
          (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_notification_menu_var2", "$g_notification_menu_var1", 0),

          (try_begin),
              (faction_slot_eq, "$players_kingdom", slot_faction_government_type, gov_imperial),
              (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_diplomacy, "$players_kingdom", reg40),
          (else_try),
              (try_begin),
                  (gt, "$g_player_chamberlain", 0),
                  (call_script, "script_dplmc_pay_into_treasury", reg40),
              (else_try),
                  (troop_add_gold, "trp_player", reg40),
              (try_end),
          (try_end),

          (faction_get_slot, ":leader", "$g_notification_menu_var2", slot_faction_leader),
          (call_script, "script_change_player_relation_with_troop", ":leader", -10),
      (try_end),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

#chief sot cambia texto abajo, motomataru cambia codigo
("notification_peace_declared",0,
#    "Peace Agreement^^{s1} and {s2} have made peace!^{s57}^^These two peoples have stopped fighting - for now. Perhaps one nation will use the time to sharpen a fresh knife to plunge into the heart of its enemy...",
    "Peace Agreement^^{s1} and {s2} have made peace!^{s57}^These two peoples have stopped fighting - for now. Perhaps one nation will use the time to sharpen a fresh knife to plunge into the heart of its enemy...",
    "none",
    [
      (try_begin),
          #MOTO salvage explanation (when multiple explanations needed, only last one valid)
          # (eq, 1, 0), #Alas, this does not seem to work
          # (eq, "$g_include_diplo_explanation", "$g_notification_menu_var1"),
          # (assign, "$g_include_diplo_explanation", 0),
          (eq, "$g_last_acting_faction", "$g_notification_menu_var1"),
          (eq, "$g_last_target_faction", "$g_notification_menu_var2"),
          (str_store_string, s57, "@^{s64}^"),
          (assign, "$g_last_acting_faction", -1),
          (assign, "$g_last_target_faction", -1),
          #MOTO salvage explanation end
      (else_try),
         (str_clear, s57),
      (try_end),

      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
      (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
      (val_mul, ":faction_1", 128),
      (val_add, ":faction_1", ":faction_2"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
    ],
    [
      ("continue",[],"Continue...",[
        (change_screen_return),
      ]),
]),

("notification_faction_defeated",0,
  "Faction Eliminated^^{s5} is no more!^^{s43}",
  "none",[
    (str_store_faction_name, s5, "$g_notification_menu_var1"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (try_begin),
        (is_between, "$g_notification_menu_var1", npc_kingdoms_begin, kingdoms_end), #Excluding player kingdom
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
    (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    (try_end),
    (play_sound, "snd_message_negative_sound"),

    (str_clear, s43),
    (try_begin),
        (eq, "$g_notification_menu_var1", "fac_kingdom_17"),
        (val_sub, "$g_unrest", 10),
        (val_max, "$g_unrest", 0),
        (display_log_message, "@The Jewish revolt has been defeated."),
        (display_message, "@Stability of the Empire increases", color_good_news),
        (try_begin),
            (check_quest_active, "qst_four_emperors"),
            (quest_slot_eq, "qst_four_emperors", slot_quest_target_center, 1),
            (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 2),
            (str_store_troop_name, s42, "trp_legatus_11"),
            (str_store_string, s43, "@The Jewish revolt has been defeated. Report back to {s42} as fast as possible."),
            (quest_set_slot, "qst_four_emperors", slot_quest_target_center, 2),
            (display_message, "str_quest_updated"),
            (add_quest_note_from_sreg, "qst_four_emperors", 4, "@You defeated the Jewish revolt. Report back to {s42} as fast as possible.", 1),
            (add_xp_as_reward, 2000),
        (try_end),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

("notification_center_genocid",0,
  "Massacre at {s5}^^A horrifying tragedy has unfolded in {s5}, where the {s6} have mercilessly slaughtered all foreign colonists. The former colony lies in ruins, its fields trampled and its homes burned.",
  "none",[
    (str_store_party_name, s5, "$g_notification_menu_var1"),
    (str_store_faction_name, s6, "$g_notification_menu_var2"),
    (set_background_mesh, "mesh_pic_looted_village"),
    (play_sound, "snd_message_negative_sound"),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

  (
    "notification_rebels_switched_to_faction",0,
    "Rebellion Success^^ Your rebellion is victorious! Your faction now has the sole claim to the title of {s11}, with {s12} as the single ruler.",
    "none",
    [
      (str_store_faction_name, s11, "$g_notification_menu_var1"),
      (str_store_troop_name, s12, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", npc_kingdoms_begin, kingdoms_end), #Excluding player kingdom
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
      ],
    [
      ("continue",[],"Continue...",
       [
         (assign, "$talk_context", tc_rebel_thanks),
         (start_map_conversation, "$g_notification_menu_var2", -1),
         (change_screen_return),
        ]),
     ]
  ),

  (
    "notification_player_should_consult",0,
##diplomacy start+ Replace "Your minister" with "{reg0?Your minister:{s11}}" and "him" with "{reg4?her:him}".
#Also "sends words" to "sends word"
    "Your minister {s11} send word that there are problems brewing in the realm which, if left untreated, could sap your authority. You should consult with {reg4?her:him} at your earliest convenience",
	##diplomacy end+
    "none",
    [ (play_sound, "snd_message_negative_sound"),
	    (setup_quest_text, "qst_consult_with_minister"),

    (str_store_troop_name, s11, "$g_player_minister"),
    (str_store_party_name, s12, "$g_player_court"),

		(str_store_string, s2, "str_consult_with_s11_at_your_court_in_s12"),
	  (call_script, "script_start_quest", "qst_consult_with_minister", -1),
		##diplomacy start+ Set minister gender and reg0 for generic vs specific
		(assign, reg4, 0),
		(try_begin),
			(call_script, "script_cf_dplmc_troop_is_female", "$g_player_minister"),
			(assign, reg4, 1),
		(try_end),
		(assign, reg0, 1),
		(try_begin),
			(is_between, "$g_player_minister", heroes_begin, kingdom_ladies_end),
			(assign, reg0, 0),
		(try_end),
		##diplomacy end+

		(quest_set_slot, "qst_consult_with_minister", slot_quest_expiration_days, 30),
		(quest_set_slot, "qst_consult_with_minister", slot_quest_giver_troop, "$g_player_minister"),
      ],
    [
      ("continue",[],"Continue...",
       [
	    (change_screen_return),
        ]),
     ]
  ),

  (
    "notification_player_feast_in_progress",0,
##diplomacy start+ make gender correct
    "Feast in Preparation^^Your {wife/husband} has started preparations for a feast in your hall in {s11}",
##diplomacy end+
    "none",
    [
    (str_store_party_name, s11, "$g_notification_menu_var1"),
    ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

("notification_lady_requests_visit",0, #add this once around seven days after the last visit, or three weeks, or three months
  "An elderly woman approaches your party and passes one of your men a letter, sealed in plain wax. It is addressed to you. When you break the seal, you see it is from {s15}. It reads, 'I so enjoyed your last visit. {s14} I am currently in {s10}.{s12}'",
  "none",[
    (assign, ":lady_no", "$g_notification_menu_var1"),
    (assign, ":center_no", "$g_notification_menu_var2"),
    (str_store_troop_name, s15, ":lady_no"),
    (str_store_party_name, s10, ":center_no"),
    (store_current_hours, ":hours_since_last_visit"),
    (troop_get_slot, ":last_visit_hours", ":lady_no", slot_troop_last_talk_time),
    (val_sub, ":hours_since_last_visit", ":last_visit_hours"),

    (call_script, "script_get_kingdom_lady_social_determinants", ":lady_no"),
    (assign, ":lady_guardian", reg0),

    (str_store_troop_name, s16, ":lady_guardian"),
    (call_script, "script_troop_get_family_relation_to_troop", ":lady_guardian", ":lady_no"),

    (str_clear, s14),
    (try_begin),
      (lt, ":hours_since_last_visit", 336),
      (try_begin),
          (troop_slot_eq, ":lady_no", slot_lord_reputation_type, lrep_otherworldly),
          (str_store_string, s14, "str_as_brief_as_our_separation_has_been_the_longing_in_my_heart_to_see_you_has_made_it_seem_as_many_years"),
      (else_try),
          (str_store_string, s14, "str_although_it_has_only_been_a_short_time_since_your_departure_but_i_would_be_most_pleased_to_see_you_again"),
      (try_end),
    (else_try),
      (ge, ":hours_since_last_visit", 336),
      (try_begin),
          (troop_slot_eq, ":lady_no", slot_lord_reputation_type, lrep_ambitious),
          (str_store_string, s14, "str_although_i_have_received_no_word_from_you_for_quite_some_time_i_am_sure_that_you_must_have_been_very_busy_and_that_your_failure_to_come_see_me_in_no_way_indicates_that_your_attentions_to_me_were_insincere_"),
      (else_try),
          (troop_slot_eq, ":lady_no", slot_lord_reputation_type, lrep_moralist),
          (str_store_string, s14, "str_i_trust_that_you_have_comported_yourself_in_a_manner_becoming_a_gentleman_during_our_long_separation_"),
      (else_try),
          (str_store_string, s14, "str_it_has_been_many_days_since_you_came_and_i_would_very_much_like_to_see_you_again"),
      (try_end),
    (try_end),

    (str_clear, s12),
    (str_clear, s18),
    ##diplomacy start+ Store gender in register for use below
    (assign, ":save_reg4", reg4),
    (call_script, "script_dplmc_store_troop_is_female_reg", ":lady_guardian", 4),
    ##diplomacy end+
    (try_begin),
      (troop_slot_eq, ":lady_no", slot_troop_lover, "trp_player"),#
      (troop_slot_ge, ":lady_no", slot_troop_spouse, 1),#is married
      (str_store_string, s12, "str_lover_1"),
    (else_try),
      (neq, ":lady_guardian", ":lady_no"),#she is not her own guardian
        (try_begin),
          (troop_slot_eq, ":lady_guardian", slot_lord_granted_courtship_permission, 0),
          (str_store_string, s12, "str__you_should_ask_my_s11_s16s_permission_but_i_have_no_reason_to_believe_that_he_will_prevent_you_from_coming_to_see_me"),
          (str_store_string, s18, "str__you_should_first_ask_her_s11_s16s_permission"),
        (else_try),
          (troop_slot_eq, ":lady_guardian", slot_lord_granted_courtship_permission, -1),
          (str_store_string, s12, "str__alas_as_we_know_my_s11_s16_will_not_permit_me_to_see_you_however_i_believe_that_i_can_arrange_away_for_you_to_enter_undetected"),
        (else_try),
          (troop_slot_eq, ":lady_guardian", slot_lord_granted_courtship_permission, 1),
          (str_store_string, s12, "str__as_my_s11_s16_has_already_granted_permission_for_you_to_see_me_i_shall_expect_your_imminent_arrival"),
        (try_end),
    (try_end),
    ##diplomacy start+ Revert register
    (assign, reg4, ":save_reg4"),
    ##diplomacy end+
    #SB : add tableau for lady
    (set_fixed_point_multiplier, 100),
    (init_position, pos0),
    (position_set_x, pos0, 60),
    (position_set_y, pos0, 20),
    (position_set_z, pos0, 100),
    (set_game_menu_tableau_mesh, "tableau_dplmc_lord_profile", ":lady_no", pos0),
  ],[
    ("continue",[],"Tell the woman to inform her mistress that you will come shortly",[
      (assign, ":lady_to_visit", "$g_notification_menu_var1"),
      (str_store_troop_name_link, s3, ":lady_to_visit"),
      (str_store_party_name_link, s4, "$g_notification_menu_var2"),

      (str_store_string, s2, "str_visit_s3_who_was_last_at_s4s18"),
      (call_script, "script_start_quest", "qst_visit_lady", ":lady_to_visit"),
      (quest_set_slot, "qst_visit_lady", slot_quest_giver_troop, ":lady_to_visit"), #don't know why this is necessary

      (try_begin),
          (eq, "$cheat_mode", 1),
          (quest_get_slot, ":giver_troop", "qst_visit_lady", slot_quest_giver_troop),
          (str_store_troop_name, s2, ":giver_troop"),
          (display_message, "str_giver_troop_=_s2"),
      (try_end),

      (quest_set_slot, "qst_visit_lady", slot_quest_expiration_days, 30),
      (change_screen_return),
    ]),
    ("continue",[],"Tell the woman to inform her mistress that you are indisposed",[
      (troop_set_slot, "$g_notification_menu_var1", slot_lady_no_messages, 1),
      (change_screen_return),
    ]),
]),

("garden",0,
  "{s12}",
  "none",[
    (call_script, "script_get_kingdom_lady_social_determinants", "$love_interest_in_town"),
	  (assign, ":guardian_lord", reg0),
    (try_begin),
        (neq, ":guardian_lord", "$love_interest_in_town"),
        (str_store_troop_name, s11, "$love_interest_in_town"),

        (try_begin),
            (call_script, "script_npc_decision_checklist_male_guardian_assess_suitor", ":guardian_lord", "trp_player"),
            (lt, reg0, 0),
            (troop_set_slot, ":guardian_lord", slot_lord_granted_courtship_permission, -1),
        (try_end),

        (assign, "$temp4_1", 0),
        (try_begin),
            (troop_slot_eq, ":guardian_lord", slot_lord_granted_courtship_permission, 1),
            (str_store_string, s12, "str_the_guards_at_the_gate_have_been_ordered_to_allow_you_through_you_might_be_imagining_things_but_you_think_one_of_them_may_have_given_you_a_wink"),
        (else_try), #the circumstances under which the lady arranges for a surreptitious entry
            (call_script, "script_troop_get_relation_with_troop", "trp_player", "$love_interest_in_town"),
            (gt, reg0, 0),

            (assign, ":player_completed_quest", 0),
            (try_begin),
                (check_quest_active, "qst_visit_lady"),
                (quest_slot_eq, "qst_visit_lady", slot_quest_giver_troop, "$love_interest_in_town"),
                (assign, ":player_completed_quest", 1),
            (else_try),
                (check_quest_active, "qst_formal_marriage_proposal"),
                (quest_slot_eq, "qst_formal_marriage_proposal", slot_quest_giver_troop, "$love_interest_in_town"),
                (this_or_next|check_quest_succeeded, "qst_formal_marriage_proposal"),
                    (check_quest_failed, "qst_formal_marriage_proposal"),
                (assign, ":player_completed_quest", 1),
            (else_try),
                (check_quest_active, "qst_duel_courtship_rival"),
                (quest_slot_eq, "qst_duel_courtship_rival", slot_quest_giver_troop, "$love_interest_in_town"),
                (this_or_next|check_quest_succeeded, "qst_duel_courtship_rival"),
                    (check_quest_failed, "qst_duel_courtship_rival"),
                (assign, ":player_completed_quest", 1),
            (try_end),

            (try_begin),
                (store_current_hours, ":hours_since_last_visit"),
                (troop_get_slot, ":last_visit_time", "$love_interest_in_town", slot_troop_last_talk_time),
                (val_sub, ":hours_since_last_visit", ":last_visit_time"),
                (this_or_next|ge, ":hours_since_last_visit", 96), #at least four days
                    (eq, ":player_completed_quest", 1),

                (try_begin),
                    (is_between, "$g_encountered_party", towns_begin, towns_end),
                    (str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter_however_as_you_walk_back_towards_your_lodgings_an_elderly_lady_dressed_in_black_approaches_you_i_am_s11s_nurse_she_whispers_urgently_don_this_dress_and_throw_the_hood_over_your_face_i_will_smuggle_you_inside_the_castle_to_meet_her_in_the_guise_of_a_skullery_maid__the_guards_will_not_look_too_carefully_but_i_beg_you_for_all_of_our_sakes_be_discrete"),
                    (assign, "$temp4_1", 1),
                (else_try),
                    (str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter_however_as_you_walk_back_towards_your_lodgings_an_elderly_lady_dressed_in_black_approaches_you_i_am_s11s_nurse_she_whispers_urgently_wait_for_a_while_by_the_spring_outside_the_walls_i_will_smuggle_her_ladyship_out_to_meet_you_dressed_in_the_guise_of_a_shepherdess_but_i_beg_you_for_all_of_our_sakes_be_discrete"),
                    (assign, "$temp4_1", 2),
                (try_end),
            (else_try),
                (str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter_however_as_you_walk_back_towards_your_lodgings_an_elderly_lady_dressed_in_black_approaches_you_i_am_s11s_nurse_she_whispers_urgently_her_ladyship_asks_me_to_say_that_yearns_to_see_you_but_that_you_should_bide_your_time_a_bit_her_ladyship_says_that_to_arrange_a_clandestine_meeting_so_soon_after_your_last_encounter_would_be_too_dangerous"),
            (try_end),
        (else_try),
            (str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter"),
        (try_end),
    (else_try),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", "$love_interest_in_town"),
        (gt, reg0, 0),
        (str_store_string, s12, "@The guards inform you that {s12} is awaiting you."),
        (assign, "$temp4_1", 3),
    (else_try),
        (str_store_string, s12, "@The guards inform you that {s12} doesn't want to see you."),
    (try_end),
	],[
    ("enter",[
      (call_script, "script_get_kingdom_lady_social_determinants", "$love_interest_in_town"),
      (assign, ":lord",reg0),
      (this_or_next|eq, "$temp4_1", 3),
      (troop_slot_eq, ":lord", slot_lord_granted_courtship_permission, 1)
    ], "Enter",[
      (jump_to_menu, "mnu_town"),
      (call_script, "script_setup_meet_lady", "$love_interest_in_town", "$g_encountered_party"),
    ]),
    ("nurse",[
      (eq, "$temp4_1", 1),
    ], "Go with the nurse",[
      (jump_to_menu, "mnu_town"),
      (call_script, "script_setup_meet_lady", "$love_interest_in_town", "$g_encountered_party"),
    ]),
    ("nurse",[
      (eq, "$temp4_1", 2),
    ], "Wait by the spring",[
      (jump_to_menu, "mnu_town"),
      (call_script, "script_setup_meet_lady", "$love_interest_in_town", "$g_encountered_party"),
    ]),
    ("leave",[],"Leave",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

("kill_local_merchant_begin",0,
  "You spot your victim and follow him, observing as he turns a corner into a dark alley. This will surely be your best opportunity to attack him.",
  "none",[
  ],[
    ("continue",[],"Continue...",[
      (set_jump_mission,"mt_back_alley_kill_local_merchant"),
      (party_get_slot, ":town_alley", "$qst_kill_local_merchant_center", slot_town_center),
      (modify_visitors_at_site,":town_alley"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),

      (jump_to_menu, "mnu_town"),
      (jump_to_scene,":town_alley"),
      (change_screen_mission),
    ]),
]),

("debug_alert_from_s65",0,
  "DEBUG ALERT: {s65}",
  "none",[
  ],[
    ("continue",[],"Continue...",[
      # (assign, "$debug_message_in_queue", 0),
      (change_screen_return),
    ]),
]),

("bandit_lair",0,
  "{s3}",
  "none",[
    (try_begin),
      (eq, "$loot_screen_shown", 1),

      (party_get_template_id, ":template", "$g_encountered_party"),
      (try_begin),
        (neq, ":template", "pt_looter_lair"),
        (check_quest_active, "qst_destroy_bandit_lair"),
        (quest_slot_eq, "qst_destroy_bandit_lair", slot_quest_target_party, "$g_encountered_party"),
        (call_script, "script_succeed_quest", "qst_destroy_bandit_lair"),
      (try_end),

      (try_for_range, ":bandit_template", bandit_party_templates_begin, bandit_party_templates_end), #SB : template range
        (party_template_slot_eq, ":bandit_template", slot_party_template_lair_party, "$g_encountered_party"),
        (party_template_set_slot, ":bandit_template", slot_party_template_lair_party, 0),
        #dckplmc
        (try_begin),
          (store_current_hours, ":cur_hours"),
          (val_add, ":cur_hours", 336),#14 days
          (val_sub, ":cur_hours", "$g_unrest"),#can go up to 100, usually below 50
          (party_template_set_slot, ":bandit_template", slot_party_template_lair_next_spawn, ":cur_hours"),
        (try_end),
      (try_end),

      (try_begin),
        (ge, "$g_encountered_party", 0),
        (party_is_active, "$g_encountered_party"),
        (remove_party, "$g_encountered_party"),
      (try_end),

      (assign, "$g_leave_encounter", 0),
      (change_screen_return),
    (else_try),
      (call_script, "script_encounter_init_variables"),
      (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
      (gt, ":bandit_type", 0),#is available
      (str_store_troop_name_plural, s4, ":bandit_type"),
      (str_store_string, s5, "str_bandit_approach_defile"),
      #SB : set pictures
      (try_begin),
        (eq, ":bandit_type", "trp_desert_bandit"),
        (str_store_string, s5, "str_bandit_approach_defile"),
      (else_try),
        (this_or_next|eq, ":bandit_type", "trp_meroe_infantry"),
        (eq, ":bandit_type", "trp_meroe_archers"),
        (str_store_string, s5, "str_bandit_approach_desert"),
        (set_background_mesh, "mesh_pic_nubian"),
      (else_try),
        (eq, ":bandit_type", "trp_sarranid_horseman"),
        (str_store_string, s5, "str_bandit_approach_desert"),
        (set_background_mesh, "mesh_pic_numider"),
      (else_try),
        (eq, ":bandit_type", "trp_gaetuli_horseman"),
        (str_store_string, s5, "str_bandit_approach_desert"),
        (set_background_mesh, "mesh_pic_numider"),
      (else_try),
        (eq, ":bandit_type", "trp_mountain_bandit"),
        (str_store_string, s5, "str_bandit_approach_cliffs"),
        (set_background_mesh, "mesh_pic_mountain_bandits"),
      (else_try),
        (eq, ":bandit_type", "trp_forest_bandit"),
        (str_store_string, s5, "str_bandit_approach_swamp"),
        (set_background_mesh, "mesh_pic_forest_bandits"),
      (else_try),
        (eq, ":bandit_type", "trp_taiga_bandit"),
        (str_store_string, s5, "str_bandit_approach_swamp"),
        (set_background_mesh, "mesh_pic_steppe_bandits"),
      (else_try),
        (eq, ":bandit_type", "trp_steppe_bandit"),
        (str_store_string, s5, "str_bandit_approach_thickets"),
        (set_background_mesh, "mesh_pic_steppe_bandits"),
      (else_try),
        (this_or_next|eq, ":bandit_type", "trp_black_sea_priate"),
        (eq, ":bandit_type", "trp_sea_raider"),
        (str_store_string, s5, "str_bandit_approach_cove"),
        (set_background_mesh, "mesh_pic_sea_raiders"),
      (else_try),
        (str_store_string, s5, "str_bandit_approach_defile"),
      (try_end),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0), #used in place of global variable
        (str_store_string, s3, "str_bandit_hideout_preattack"),
      (else_try),
        (party_get_template_id, ":template", "$g_encountered_party"),
        (eq, ":template", "pt_looter_lair"),
        (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 1), #used in place of global variable
        (str_store_string, s3, "str_lost_startup_hideout_attack"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 1), #used in place of global variable
        (str_store_string, s3, "str_bandit_hideout_failure"),
        (set_background_mesh, "mesh_pic_wounded"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 2), #used in place of global variable
        (str_store_string, s3, "str_bandit_hideout_success"),
        (set_background_mesh, "mesh_pic_victory"),
      (try_end),
    (try_end),
  ],[
    ("continue_1",[
      (store_relation, ":rel", "$g_encountered_party_faction", "fac_player_faction"),#is at peace
      (ge, ":rel", 0),

      (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0), #used in place of global variable

      (party_get_template_id, ":template", "$g_encountered_party"),

      (try_begin),
        (eq, ":template", "pt_black_sea_pirates_lair"),
        (assign, ":bandit_troop", "trp_black_sea_priate"),
      (else_try),
        (eq, ":template", "pt_sea_raider_lair"),
        (assign, ":bandit_troop", "trp_sea_raider"),
      (else_try),
        (eq, ":template", "pt_forest_bandit_lair"),
        (assign, ":bandit_troop", "trp_forest_bandit"),
      (else_try),
        (this_or_next|eq, ":template", "pt_nabatean_lair"),
        (eq, ":template", "pt_desert_bandit_lair"),
        (assign, ":bandit_troop", "trp_desert_bandit"),
      (else_try),
        (eq, ":template", "pt_egyptian_bandit_lair"),
        (assign, ":bandit_troop", "trp_egyptian_infantry_light"),
      (else_try),
        (eq, ":template", "pt_numidian_bandit_lair"),
        (assign, ":bandit_troop", "trp_sarranid_horseman"),
      (else_try),
        (eq, ":template", "pt_nubian_lair"),
        (assign, ":bandit_troop", "trp_meroe_archers"),
      (else_try),
        (eq, ":template", "pt_gaetuli_bandit_lair"),
        (assign, ":bandit_troop", "trp_gaetuli_horseman"),
      (else_try),
        (eq, ":template", "pt_mountain_bandit_lair"),
        (assign, ":bandit_troop", "trp_mountain_bandit"),
      (else_try),
        (eq, ":template", "pt_taiga_bandit_lair"),
        (assign, ":bandit_troop", "trp_taiga_bandit"),
      (else_try),
        (eq, ":template", "pt_saka_camp"),
        (assign, ":bandit_troop", "trp_saka_horse_archer"),
      (else_try),
        (eq, ":template", "pt_steppe_bandit_lair"),
        (assign, ":bandit_troop", "trp_steppe_bandit"),
      (try_end),
      (str_store_troop_name, s41, ":bandit_troop"),
      (neq, ":template", "pt_looter_lair"),
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 1000),
    ],"Hire 10 {s41} (1000 denars)",[
      (party_get_template_id, ":template", "$g_encountered_party"),
      (try_begin),
        (troops_can_join, 10),
        (try_begin),
          (eq, ":template", "pt_black_sea_pirates_lair"),
          (assign, ":bandit_troop", "trp_black_sea_priate"),
        (else_try),
          (eq, ":template", "pt_sea_raider_lair"),
          (assign, ":bandit_troop", "trp_sea_raider"),
        (else_try),
          (eq, ":template", "pt_forest_bandit_lair"),
          (assign, ":bandit_troop", "trp_forest_bandit"),
        (else_try),
          (this_or_next|eq, ":template", "pt_nabatean_lair"),
          (eq, ":template", "pt_desert_bandit_lair"),
          (assign, ":bandit_troop", "trp_desert_bandit"),
        (else_try),
          (eq, ":template", "pt_egyptian_bandit_lair"),
          (assign, ":bandit_troop", "trp_egyptian_infantry_light"),
        (else_try),
          (eq, ":template", "pt_numidian_bandit_lair"),
          (assign, ":bandit_troop", "trp_sarranid_horseman"),
        (else_try),
          (eq, ":template", "pt_nubian_lair"),
          (assign, ":bandit_troop", "trp_meroe_archers"),
        (else_try),
          (eq, ":template", "pt_gaetuli_bandit_lair"),
          (assign, ":bandit_troop", "trp_gaetuli_horseman"),
        (else_try),
          (eq, ":template", "pt_mountain_bandit_lair"),
          (assign, ":bandit_troop", "trp_mountain_bandit"),
        (else_try),
          (eq, ":template", "pt_taiga_bandit_lair"),
          (assign, ":bandit_troop", "trp_taiga_bandit"),
        (else_try),
          (eq, ":template", "pt_saka_camp"),
          (assign, ":bandit_troop", "trp_saka_horse_archer"),
        (else_try),
          (eq, ":template", "pt_steppe_bandit_lair"),
          (assign, ":bandit_troop", "trp_steppe_bandit"),
        (try_end),
        (party_add_members, "p_main_party", ":bandit_troop", 10),
        (troop_remove_gold, "trp_player", 1000),
      (else_try),
          (display_message, "str_not_enough_party_space"),
      (try_end),
    ]),
    ("continue_1",[
      (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0), #used in place of global variable
    ],"Attack the hideout...",[
      (try_begin),
        (neg|troop_is_wounded, "trp_player"),
        (party_set_slot, "$g_encountered_party", slot_party_ai_substate, 1),
        (party_get_template_id, ":template", "$g_encountered_party"),
        (assign, "$g_enemy_party", "$g_encountered_party"),

        (try_begin),
          (eq, ":template", "pt_black_sea_pirates_lair"),
          (assign, ":bandit_troop", "trp_black_sea_priate"),
          (assign, ":scene_to_use", "scn_lair_pirates"),
        (else_try),
          (eq, ":template", "pt_sea_raider_lair"),
          (assign, ":bandit_troop", "trp_sea_raider"),
          (assign, ":scene_to_use", "scn_lair_sea_raiders"),
        (else_try),
          (eq, ":template", "pt_forest_bandit_lair"),
          (assign, ":bandit_troop", "trp_forest_bandit"),
          (assign, ":scene_to_use", "scn_lair_forest_bandits"),
        (else_try),
          (eq, ":template", "pt_egyptian_bandit_lair"),
          (assign, ":bandit_troop", "trp_egyptian_infantry_heavy"),
          (assign, ":scene_to_use", "scn_lair_egypt_bandits"),
        (else_try),
          (eq, ":template", "pt_nabatean_lair"),
          (assign, ":bandit_troop", "trp_desert_bandit"),
          (assign, ":scene_to_use", "scn_lair_arabian"),
        (else_try),
          (eq, ":template", "pt_desert_bandit_lair"),
          (assign, ":bandit_troop", "trp_desert_bandit"),
          (assign, ":scene_to_use", "scn_lair_desert_bandits"),
        (else_try),
          (eq, ":template", "pt_numidian_bandit_lair"),
          (assign, ":bandit_troop", "trp_sarranid_horseman"),
          (assign, ":scene_to_use", "scn_lair_african"),
        (else_try),
          (eq, ":template", "pt_nubian_lair"),
          (assign, ":bandit_troop", "trp_meroe_archers"),
          (assign, ":scene_to_use", "scn_lair_african_2"),
        (else_try),
          (eq, ":template", "pt_gaetuli_bandit_lair"),
          (assign, ":bandit_troop", "trp_gaetuli_horseman"),
          (assign, ":scene_to_use", "scn_lair_african"),
        (else_try),
          (eq, ":template", "pt_mountain_bandit_lair"),
          (assign, ":bandit_troop", "trp_mountain_bandit"),
          (assign, ":scene_to_use", "scn_lair_mountain_bandits"),
        (else_try),
          (eq, ":template", "pt_taiga_bandit_lair"),
          (assign, ":bandit_troop", "trp_taiga_bandit"),
          (assign, ":scene_to_use", "scn_lair_taiga_bandits"),
        (else_try),
          (eq, ":template", "pt_steppe_bandit_lair"),
          (assign, ":bandit_troop", "trp_steppe_bandit"),
          (assign, ":scene_to_use", "scn_lair_steppe_bandits"),
        (else_try),
          (eq, ":template", "pt_saka_camp"),
          (assign, ":bandit_troop", "trp_saka_horse_archer"),
          (assign, ":scene_to_use", "scn_lair_saka"),
        (else_try),
          (eq, ":template", "pt_looter_lair"),
          (assign, ":bandit_troop", "trp_looter"),
          (assign, ":scene_to_use", "scn_lair_forest_bandits"),
        (try_end),

        (modify_visitors_at_site,":scene_to_use"),
        (reset_visitors),

        (store_character_level, ":player_level", "trp_player"),
        (store_add, ":number_of_bandits_will_be_spawned_at_each_period", 5, ":player_level"),
        (val_div, ":number_of_bandits_will_be_spawned_at_each_period", 3),

        (try_for_range, ":unused", 0, ":number_of_bandits_will_be_spawned_at_each_period"),
          (store_random_in_range, ":random_entry_point", 2, 11),
          (set_visitor, ":random_entry_point", ":bandit_troop", 1),
        (try_end),

        (party_clear, "p_temp_casualties"),

        (set_party_battle_mode),
        (set_battle_advantage, 0),
        (assign, "$g_battle_result", 0),
        (set_jump_mission,"mt_bandit_lair"),

        (jump_to_scene, ":scene_to_use"),
        (change_screen_mission),
      (else_try),
        (display_message, "@You are too wounded...", message_alert),
      (try_end),
    ]),

    ("leave_no_attack",
    [
      (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0),
    ],
    "Leave...",
    [
      (change_screen_return),
    ]),

    ("leave_victory",
    [
      (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 2),
    ],
    "Continue...",
    [
      (try_begin),
        (eq, "$loot_screen_shown", 0),
  #          (try_begin),
  #            (gt, "$g_ally_party", 0),
  #            (call_script, "script_party_add_party", "$g_ally_party", "p_temp_party"), #Add remaining prisoners to ally TODO: FIX it.
  #          (else_try),
  #            (party_get_num_attached_parties, ":num_quick_attachments", "p_main_party"),
  #            (gt, ":num_quick_attachments", 0),
  #            (party_get_attached_party_with_rank, ":helper_party", "p_main_party", 0),
  #            (call_script, "script_party_add_party", ":helper_party", "p_temp_party"), #Add remaining prisoners to our reinforcements
  #          (try_end),
        (troop_clear_inventory, "trp_temp_troop"),

        (party_get_num_companion_stacks, ":num_stacks", "p_temp_casualties"),
        (try_for_range, ":stack_no", 0, ":num_stacks"),
          (party_stack_get_troop_id, ":stack_troop", "p_temp_casualties", ":stack_no"),
          (try_begin),
            (party_stack_get_size, ":stack_size", "p_temp_casualties", ":stack_no"),
            (party_stack_get_troop_id, ":stack_troop", "p_temp_casualties", ":stack_no"),
            (gt, ":stack_size", 0),
            (party_add_members, "p_total_enemy_casualties", ":stack_troop", ":stack_size"), #addition_to_p_total_enemy_casualties
            (party_stack_get_num_wounded, ":stack_wounded_size", "p_temp_casualties", ":stack_no"),
            (gt, ":stack_wounded_size", 0),
            (party_wound_members, "p_total_enemy_casualties", ":stack_troop", ":stack_wounded_size"),
          (try_end),
        (try_end),

        (call_script, "script_party_calculate_loot", "p_total_enemy_casualties"), #p_encountered_party_backup changed to total_enemy_casualties
        (gt, reg0, 0),
        (troop_sort_inventory, "trp_temp_troop"),
        (try_begin),
          (party_get_template_id, ":template", "$g_encountered_party"),
          (eq, ":template", "pt_looter_lair"),
          (troop_add_items, "trp_temp_troop", "itm_oil", 10),
        (try_end),
        (assign, "$loot_screen_shown", 1),
        (try_begin),
          (call_script, "script_cf_dplmc_player_party_meets_autoloot_conditions"),###1
          (call_script, "script_party_calculate_loot", "p_total_enemy_casualties"),
          (assign, "$dplmc_return_menu", "mnu_bandit_lair"),
          #SB : variable resets
          (assign, "$lord_selected", "trp_player"),
          (str_clear, dplmc_loot_string),
          (jump_to_menu, "mnu_dplmc_manage_loot_pool"),

          (else_try),
            #Fall back to old behavior
            (change_screen_loot, "trp_temp_troop"),
            (assign, "$loot_screen_shown", 1),
          (try_end),
        ##diplomacy end+
      (else_try),
          (assign, "$loot_screen_shown", 1),
      (try_end),

      # (try_for_range, ":bandit_template", bandit_party_templates_begin, bandit_party_templates_end), #SB : template range
        # (party_template_slot_eq, ":bandit_template", slot_party_template_lair_party, "$g_encountered_party"),
        # (party_template_set_slot, ":bandit_template", slot_party_template_lair_party, 0),
      # (try_end),

      # (try_begin),
        # (ge, "$g_encountered_party", 0),
        # (party_is_active, "$g_encountered_party"),
        # (party_get_template_id, ":template", "$g_encountered_party"),
        # (eq, ":template", "pt_looter_lair"),
        # (remove_party, "$g_encountered_party"),
      # (try_end),
    ]),

    ("leave_defeat",
    [
      (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 1),
    ],
    "Continue...",
    [
      # (try_for_range, ":bandit_template", bandit_party_templates_begin, bandit_party_templates_end), #SB : template range
      #     (party_template_slot_eq, ":bandit_template", slot_party_template_lair_party, "$g_encountered_party"),
      #     (party_template_set_slot, ":bandit_template", slot_party_template_lair_party, 0),
      # (try_end),

      # (try_begin),
      #     (party_get_template_id, ":template", "$g_encountered_party"),
      #     (neq, ":template", "pt_looter_lair"),
      #     (check_quest_active, "qst_destroy_bandit_lair"),
      #     (quest_slot_eq, "qst_destroy_bandit_lair", slot_quest_target_party, "$g_encountered_party"),
      #     (call_script, "script_fail_quest", "qst_destroy_bandit_lair"),
      # (try_end),

      # (try_begin),
      #     (ge, "$g_encountered_party", 0),
      #     (party_is_active, "$g_encountered_party"),
      #     (party_get_template_id, ":template", "$g_encountered_party"),
      #     (neq, ":template", "pt_looter_lair"),
      #     (remove_party, "$g_encountered_party"),
      # (try_end),

      (assign, "$g_leave_encounter", 1),

      (try_begin),
          (party_is_active, "$g_encountered_party"),
          (party_set_slot, "$g_encountered_party", slot_party_ai_substate, 0),
      (try_end),

      (change_screen_return),
    ]),
]),

("notification_player_faction_political_issue_resolved",0,
  "After consulting with the peers of the realm, {s10} has decided to confer {s11} on {s12}.",
  "none",[
    (assign, ":faction_issue_resolved", "$g_notification_menu_var1"),
    (assign, ":faction_decision", "$g_notification_menu_var2"),
    (faction_get_slot, ":leader", "$players_kingdom", slot_faction_leader),
    (str_store_troop_name, s10, ":leader"),
    (try_begin),
        (eq, ":faction_issue_resolved", 1),
        (str_store_string, s11, "str_the_marshalship"),
    (else_try),
        (str_store_party_name, s11, ":faction_issue_resolved"),
    (try_end),
    (str_store_troop_name, s12, ":faction_decision"),
  ],[
  ("continue",[],"Continue...",[
    (change_screen_return),
  ]),
]),
("notification_player_faction_political_issue_resolved_for_player",0,
  "After consultation, {s10} has decided to confer {s11} on you. You may decline the honor, but it will probably mean that you will not receive other awards for a little while.{s12}",
  "none",[
    (faction_get_slot, ":leader", "$players_kingdom", slot_faction_leader),
    (str_store_troop_name, s10, ":leader"),
    (faction_get_slot, ":issue", "$players_kingdom", slot_faction_political_issue),
    (try_begin),
      (eq, ":issue", 1),
      (str_store_string, s11, "str_the_marshalship"),
      (str_store_string, s12, "@^^Note that so long as you remain marshal, it is expected you lead campaigns. So, if you are awaiting a feast, either for a wedding or for other purposes, you may wish to resign the marshalship."),
    # (else_try),
      # (str_clear, s12),
      # (str_store_party_name, s11, ":issue"),
    (try_end),

    # (try_begin),
        # (faction_slot_ge, "$players_kingdom", slot_faction_has_nor_titles, 1),
        # (neg|troop_slot_eq, "trp_player", slot_troop_honorary_title, ht_consul),
        # (call_script, "script_assign_consul_title", ":leader", "trp_player"),
    # (try_end),
  ],[
  ("accept",[],"Accept the honor",[
    # (faction_get_slot, ":issue", "$players_kingdom", slot_faction_political_issue),

    # (try_begin),
        # (eq, ":issue", 1),
    (call_script, "script_check_and_finish_active_army_quests_for_faction", "$players_kingdom"),
    (call_script, "script_appoint_faction_marshall", "$players_kingdom", "trp_player"),
    # (else_try),
    # (call_script, "script_give_center_to_lord", ":issue", "trp_player", 0), #Zero means don't add garrison
    (faction_set_slot, "$players_kingdom", slot_faction_political_issue, 0),
    # (try_end),

    (faction_get_slot, ":leader", "$players_kingdom", slot_faction_leader),
    (troop_set_slot, ":leader", slot_troop_stance_on_faction_issue, -1),

    (change_screen_return),
  ]),

  ("decline",[],"Decline the honor",[
    # (faction_get_slot, ":issue", "$players_kingdom", slot_faction_political_issue),
    # (try_begin),
        # (is_between, ":issue", centers_begin, centers_end),
        # (assign, "$g_dont_give_fief_to_player_days", 30),
    # (else_try),
    (assign, "$g_dont_give_marshalship_to_player_days", 30),
    # (try_end),

    (faction_get_slot, ":leader", "$players_kingdom", slot_faction_leader),
    (troop_set_slot, ":leader", slot_troop_stance_on_faction_issue, -1),

    (change_screen_return),
  ]),
]),

("notification_player_faction_province_appointed",0,
    "The governorship of {s10} has been awared to you by {s22}. If you accept you will take over ownership of {s11} and all other settlements of the province. You may decline the honor, but it will probably mean that you will not receive other awards for a while and it will upset {s22}.^^{s21}",
    "none",[
      (call_script, "script_write_economic_info_to_s0", "$g_notification_menu_var2", 0),
      (str_store_string_reg, s21, s0),
      (store_add, ":slot", slot_province_senatorial_begin, "$g_notification_menu_var2"),
      (troop_get_slot, "$temp4_1", "trp_province_array", ":slot"),
      (store_add, ":string", "$g_notification_menu_var2", str_province_begin),
      (str_store_string, s10, ":string"),
      (try_begin),
          (le, "$temp4_1", 0),
          (faction_get_slot, ":leader", "$players_kingdom", slot_faction_leader),
          (str_store_troop_name, s22, ":leader"),
      (else_try),
          (str_store_string, s22, "@the senate"),
      (try_end),
      (str_store_party_name, s11, "$g_notification_menu_var1"),
    ],[
    ("accept",[],"Accept the honor",[
      (call_script, "script_change_troop_renown", "trp_player", 50),
      (troop_set_slot, "trp_province_array", "$g_notification_menu_var2", "trp_player"),
      (call_script, "script_troop_set_rank", "trp_player",slot_troop_govern, "$g_notification_menu_var2"),
      (call_script, "script_give_center_to_lord2", "$g_notification_menu_var1", "trp_player", 0),
      (str_store_troop_name, s22, "trp_player"),
      (val_add, "$g_notification_menu_var2", "str_province_begin"),
      (str_store_string, s23, "$g_notification_menu_var2"),
      (str_store_party_name, s24, "$g_notification_menu_var1"),
      (display_log_message, "@You have taken over the governorship of {s23}. {s24} is integrated into the newly found province."),
      (change_screen_return),
    ]),
    ("decline",[],"Decline the honor",[
      (try_begin),
          (le, "$temp4_1", 0),
          (faction_get_slot, ":leader", "$players_kingdom", slot_faction_leader),
          (call_script, "script_change_player_relation_with_troop", ":leader", -10),
      (else_try),
          (call_script, "script_change_senate_support", -5, 0),
      (try_end),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (assign, "$g_dont_give_fief_to_player_days", 30),
      (change_screen_return),
    ]),
]),
("notification_player_senatorial_province_appointed",0,
  "The governorship of {s10} has expired and the senate has decided to awared it to you. If you accept you will take over ownership of all settlements of the province. You may decline the honor, but it will cost you support in the senate.^^{s21}",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
    (call_script, "script_write_economic_info_to_s0", "$g_notification_menu_var2", 0),
    (str_store_string_reg, s21, s0),
    (store_add, ":string", "$g_notification_menu_var2", str_province_begin),
    (str_store_string, s10, ":string"),
  ],[
  ("accept",[],"Accept the honor",[
    (assign, "$g_dont_give_fief_to_player_days", 30),#player has not refused a honour previously
    (call_script, "script_change_troop_renown", "trp_player", 50),

    (store_current_day, ":day"),
    (store_add, ":slot", slot_province_senatorial_begin, "$g_notification_menu_var2"),
    (val_add, ":day", 84),
    (troop_set_slot, "trp_province_array", ":slot", ":day"),

    (troop_get_slot, ":governor", "trp_province_array", "$g_notification_menu_var2"),
    (store_faction_of_troop, ":ex_governor_faction", ":governor"),
    (try_for_range, ":center", walled_centers_begin, walled_centers_end),
        (store_faction_of_party, ":center_faction", ":center"),
        (eq, ":center_faction", ":ex_governor_faction"),
        (party_get_slot, ":province_1", ":center", slot_center_province),
        (eq, ":province_1", "$g_notification_menu_var2"),
        (call_script, "script_give_center_to_lord2", ":center", "trp_player", 0),
    (try_end),

    (troop_set_slot, "trp_province_array", "$g_notification_menu_var2", "trp_player"),
    (call_script, "script_troop_set_rank", "trp_player",slot_troop_govern, "$g_notification_menu_var2"),

    #remove old governor
    (call_script, "script_troop_set_rank", ":governor", slot_troop_govern, -1),
    (call_script, "script_change_lord_party_to_fit_rank", ":governor"),

    (change_screen_map),
  ]),
  ("decline",[],"Decline the honor",[
    (call_script, "script_change_senate_support", -5, 0),
    (call_script, "script_change_troop_renown", "trp_player", -5),
    (assign, "$g_dont_give_fief_to_player_days", 30),
    (change_screen_map),
  ]),
]),
("notification_player_faction_province_decide",0,
  "Hello",
  "none",[
    (start_presentation, "prsnt_province_notifiction_player"),
  ],[
    ("accept",[],"Nothing.",[(change_screen_map)]),
]),
("notification_player_senatorial_province_expires",0,
  "Your governorship of {s10} has expired and the senate appointed a new governor.",
  "none",[
    (store_add, ":string", "$g_notification_menu_var2", str_province_begin),
    (str_store_string, s10, ":string"),
  ],[
  ("decline",[],"Continue.",[
    (assign, "$g_dont_give_fief_to_player_days", 45),#player has not refused a honour previously
    (call_script, "script_change_troop_renown", "trp_player", 15),
    (change_screen_map),
  ]),
]),
("notification_player_faction_fief_appointed",0,
  "Your liege {s10} has decided to confer {s11} on you. You may decline the honor, but it will probably mean that you will not receive other awards for a while.",
  "none",[
    (faction_get_slot, ":leader", "$players_kingdom", slot_faction_leader),
    (str_store_troop_name, s10, ":leader"),
    (str_store_party_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("accept",[],"Accept the honor",[
      (call_script, "script_give_center_to_lord", "$g_notification_menu_var1", "trp_player", 0), #Zero means don't add garrison
      (change_screen_return),
    ]),
    ("decline",[],"Decline the honor",[
      (assign, "$g_dont_give_fief_to_player_days", 30),
      (change_screen_return),
    ]),
]),
("starting_mission_finished",mnf_disable_all_keys,
  "The slaves run havoc in the villa. You try your best to stop them but without success:"
  +" Your former master Marcus Gaius Crachius is captured and forced to watch how two slaves rape his daughter. Then both are tortured to death."
  +" Meanwhile, you tried to loot the villa, but the other slaves set it ablaze. In the chaos, you weren't able to loot anything of value. But then, additional guards approach.^"
  +" Most of the slaves are captured by the guards, while some manage to flee into the forests.^"
  +" Some guards are chasing you and you run as fast as you have never run before in your life. Luckily, you spot a farmer with his carriage driving along a road."
  +" You jump on the carriage and hide yourself. The farmer didn't notice. The guards are too exhausted and head back.^^Soon you fall asleep.",
  "none",[
    (set_background_mesh, "mesh_pic_wildfire"),
  ],[
    ("continue",[], "Continue.",[
      (add_xp_as_reward, 250),
      (jump_to_menu, "mnu_start_phase_3"),
    ]),
]),
("start_phase_3",mnf_disable_all_keys,
  "The farmer was driving to Rome. When you awake, you witness the eternal city for the first time in your life and become overwhelmed by its splendor. You are awestruck."
  +" The streets are crowded with hundreds of people. Plebeians from all rungs of society can be seen. Farmers, bakers, merchants, craftsmen, and more are doing their daily business, with a few patricians mingling among them. As you are taking in the view, the carriage suddenly halts. You decide to jump from the carriage and give a short prayer of thanks."
  +" ^^As you have not even a single denar, you stray around the streets thinking about a"
  +" good way to obtain some coins. Suddenly, you hear something ...",
    "none",[
    (set_background_mesh, "mesh_pic_roma"),
    (assign, ":continue", 1),
    (try_begin),
      (eq, "$current_startup_quest_phase", 1),
      (try_begin),
        (eq, "$g_killed_first_bandit", 1),
        (str_store_string, s11, "str_killed_bandit_at_alley_fight"),
      (else_try),
        (str_store_string, s11, "str_wounded_by_bandit_at_alley_fight"),
      (try_end),
      (jump_to_menu, "mnu_start_phase_4"),
      (assign, ":continue", 0),
    (else_try),
      (eq, "$current_startup_quest_phase", 3),
      (try_begin),
        (eq, "$g_killed_first_bandit", 1),
        (str_store_string, s11, "str_killed_bandit_at_alley_fight"),
      (else_try),
        (str_store_string, s11, "str_wounded_by_bandit_at_alley_fight"),
      (try_end),
      (jump_to_menu, "mnu_start_phase_4"),
      (assign, ":continue", 0),
    (try_end),
    (str_clear, s16),
    (eq, ":continue", 1),
  ],[

    ("continue",[], "By the gods!",[
      (party_set_name, "p_main_party", "@{playername}'s party"),
      (assign, "$g_starting_town", "$current_town"),

      (party_relocate_near_party, "p_main_party", "$g_starting_town", 2),
      (party_set_morale, "p_main_party", 100),

      # (party_set_morale, "p_main_party", 100), #SB : roll this into previous script
      (set_encountered_party, "$current_town"),
      #SB : play sound
      (play_sound, "snd_draw_sword"),
      (modify_visitors_at_site, "scn_town_1_alley"),

      (reset_visitors),
      (set_visitor, 0, "trp_player"),

      #(set_visitor, 3, ":bandit_troop"),
      (set_visitor, 3, "trp_bandit"),

      (assign, "$talked_with_merchant", 0),
      (set_jump_mission, "mt_alley_fight"),
      (jump_to_scene, "scn_town_1_alley"),
      (change_screen_mission),
    ]),
]),

  ("start_phase_4",mnf_disable_all_keys,
    "{s11}",
    "none",
    [
      (assign, ":continue", 1),
      (try_begin),
        (eq, "$current_startup_quest_phase", 2),
        (change_screen_return),
        (assign, ":continue", 0),
      (else_try),
        (eq, "$current_startup_quest_phase", 3),
        (str_store_string, s11, "str_merchant_and_you_call_some_townsmen_and_guards_to_get_ready_and_you_get_out_from_tavern"),
      (else_try),
        (eq, "$current_startup_quest_phase", 4),
        (try_begin),
          (eq, "$g_killed_first_bandit", 1),
          (str_store_string, s11, "str_town_fight_ended_you_and_citizens_cleaned_town_from_bandits"),
        (else_try),
          (str_store_string, s11, "str_town_fight_ended_you_and_citizens_cleaned_town_from_bandits_you_wounded"),
        (try_end),
      (try_end),

      (eq, ":continue", 1),
    ],
    [
      ("continue",
      [
        (this_or_next|eq, "$current_startup_quest_phase", 1),
        (eq, "$current_startup_quest_phase", 4),
      ],
      "Continue...",
      [
        (assign, "$town_entered", 1),
        (modify_visitors_at_site, "scn_town_6_room"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 9, "trp_roman_start_merchant"),

        (assign, "$talk_context", tc_merchants_house),

        (assign, "$dialog_with_merchant_ended", 0),

        (set_jump_mission, "mt_meeting_merchant"),

        (jump_to_scene, "scn_town_6_room"),
        (change_screen_mission),
      ]),

      ("continue",
      [
        (eq, "$current_startup_quest_phase", 3),
      ],
      "Continue...",
      [
        (call_script, "script_prepare_town_to_fight"),
      ]),
    ]
  ),

("lost_tavern_duel",mnf_disable_all_keys,
  "{s11}{s12}",
  "none",[
    (str_clear, s11),
    (str_clear, s12),
    #use s11 as primary indicator string
    (try_begin),
        (agent_get_troop_id, ":type", "$g_main_attacker_agent"),
        (eq, ":type", "trp_belligerent_drunk"),
        (str_store_string, s11, "str_lost_tavern_duel_ordinary"),
    (else_try),
        (agent_get_troop_id, ":type", "$g_main_attacker_agent"),
        (eq, ":type", "trp_hired_assassin"),
        (store_random_in_range, ":r", 0, 1000),
        (try_begin),
            (lt, "$g_player_luck", ":r"),
            (str_store_string, s11, "str_lost_tavern_duel_assassin"),
            (call_script, "script_change_troop_health", "trp_player", 50),
        (else_try),
            (assign, "$temp", 0),
            (jump_to_menu, "mnu_death_waits"),
        (try_end),
    (try_end),
    (troop_set_slot, "trp_hired_assassin", slot_troop_cur_center, -1),
    (troop_set_slot, "trp_belligerent_drunk", slot_troop_cur_center, -1), #remove him for now

    #use s12 for additional info like lost purse, etc
    #SB : penalty for fighting while disguised
    (try_begin),
        (gt, "$sneaked_into_town", disguise_none),
        (store_random_in_range, ":random_no", -100, 200),
        # (ge, ":random_no", "$g_player_luck"),
        (ge, ":random_no", 0),
        (str_store_string, s12, "@ Unfortunately, when the guards inquired about the tavern brawl, your description was recognized and you were in no condition to fight them off."),
    (try_end),
  ],[
    ("continue",[
      (eq, "$sneaked_into_town", disguise_none),
    ],"Continue...",[
      (jump_to_menu, "mnu_town"),
      (troop_set_health, "trp_player", 25),
      #SB : renown loss, less than losing to bandits
      (call_script, "script_change_troop_renown", "trp_player", -1),
    ]),

    ("surrender",[
      (gt, "$sneaked_into_town", disguise_none),
    ],"Surrender...",[
      (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
    ]),
]),

("establish_court",mnf_disable_all_keys,
  "To establish {s4} as your court will require a small refurbishment. In particular, you will need 25,000 denars. it may also take a short while for some of your followers to relocate here. Do you wish to proceed?",
  "none",[
	  (str_store_party_name, s4, "$g_encountered_party"),
    (set_background_mesh, "mesh_pic_party"),
	],[
    ("establish",[
      (store_troop_gold, ":g1", "trp_player"),
      (store_troop_gold, ":g2", "trp_household_possessions"),
      (val_add, ":g1", ":g2"),
      (ge, ":g1", 25000),
	  ],"Establish {s4} as your court",[
		  (assign, "$g_player_court", "$current_town"),
      (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", 25000, "trp_player"),
      (jump_to_menu, "mnu_town"),
    ]),
    ("capital_exists",[
      (store_and, ":name_set", "$players_kingdom_name_set", rename_center),
      (ge, ":name_set", rename_center),
      (str_store_party_name, s1, "$g_player_court"),
      (disable_menu_option),
    ],"You cannot move the court as your capital is at {s1}.",[
    ]),
    ("continue",[],"Hold off...",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

("notification_relieved_as_marshal", mnf_disable_all_keys,
  "{s4} wishes to inform you that your services as marshal are no longer required. In honor of valiant efforts on behalf of the realm over the last {reg4} days, however, {reg8?she:he} offers you a purse of {reg5} denars.",
  "none",[
    (assign, reg4, "$g_player_days_as_marshal"),

    (store_div, ":renown_gain", "$g_player_days_as_marshal",4),
    (val_min, ":renown_gain", 20),
    (store_mul, ":denar_gain", "$g_player_days_as_marshal", 50),
    (val_max, ":denar_gain", 200),
    (val_min, ":denar_gain", 4000),
    (troop_add_gold, "trp_player", ":denar_gain"),
    (call_script, "script_change_troop_renown", "trp_player", ":renown_gain"),
    (assign, "$g_player_days_as_marshal", 0),
    (assign, "$g_dont_give_marshalship_to_player_days", 15),
    (assign, reg5, ":denar_gain"),

    (store_div, ":gravitas", ":denar_gain", 100),
    (call_script, "script_troop_change_triumph_points", "trp_player", ":gravitas"),

    (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
    (str_store_troop_name, s4, ":faction_leader"),
    ##diplomacy start+ get gender with script
    #(troop_get_type, reg8, ":faction_leader"),#<- OLD
    (assign, ":save_reg0", reg0),
    (call_script, "script_dplmc_store_troop_is_female", ":faction_leader"),
    (assign, reg8, reg0),
    (assign, reg0, ":save_reg0"),
    ##diplomacy end+
	],[
    ("continue",[],"Continue",[
      (change_screen_return),
    ]),
]),

########################################################
# Autoloot Game Menus Begin
########################################################

##########################################################
# Inventory allocation / Loot allocation Game Menu  -  by Fisheye
# Parameters:
# $return_menu : return to this menu after managing loot.  0 if this menu is called via random encounter
# diplomacy start+
# Added "return_menu", renaming it to "$dplmc_return_menu"
# diplomacy end+
("dplmc_manage_loot_pool", mnf_enable_hot_keys,
  "{s10}",
  "none",[
    ##diplomacy start+
    #Use a different troop!
    #(assign, "$pool_troop", "trp_dplmc_chamberlain"),
    (assign, "$pool_troop", "trp_temp_troop"),
    #Make sure things are initialized
    (call_script, "script_dplmc_initialize_autoloot", 0),#argument "0" means this does nothing if deemed unnecessary
    ##diplomacy end+
    (assign, reg20,0),
    (troop_get_inventory_capacity, ":inv_cap", "$pool_troop"),
    (try_for_range, ":i_slot", 0, ":inv_cap"),
      (troop_get_inventory_slot, ":item_id", "$pool_troop", ":i_slot"),
      (ge, ":item_id", 0),
      (neg|troop_has_item_equipped, "$pool_troop", ":item_id"),
      (val_add, reg20, 1),
    (try_end),
    # reg20 now contains number of items in loot pool
    (try_begin),
      (eq, reg20, 0),
      (str_store_string, s10, "str_dplmc_item_pool_no_items"),
      (str_store_string, s20, "str_dplmc_item_pool_leave"),
    (else_try),
      (eq, reg20, 1),
      (str_store_string, s10, "str_dplmc_item_pool_one_item"),
      (str_store_string, s20, "str_dplmc_item_pool_abandon"),
    (else_try),
      (str_store_string, s10, "str_dplmc_item_pool_many_items"),
      (str_store_string, s20, "str_dplmc_item_pool_abandon"),
    (try_end),
    ## CC
    (try_begin), #only show when we don't have equipment logs
            (str_is_empty, dplmc_loot_string),
      (set_fixed_point_multiplier, 100),
            (position_set_x, pos0, 20),
            (position_set_y, pos0, 30),
            (position_set_z, pos0, 80),
      (set_game_menu_tableau_mesh, "tableau_game_character_sheet", "$lord_selected", pos0),
    (try_end),
    ## CC
    #SB : str30 shows items looted after script_dplmc_auto_loot_troop was called
    # (try_begin),
      # (neg|str_is_empty, dplmc_loot_string),
      # (str_store_string, s10, "@{s10}^^{s30}"),
    # (try_end),
  ],[
	  ("dplmc_auto_loot",[
      (eq, "$inventory_menu_offset",0),
      (store_free_inventory_capacity, ":space", "$pool_troop"),
      (ge, ":space", 10),
      (gt, reg20, 0),
    ],"Let your heroes select gear from the items on the ground.",[
      # (set_player_troop, "trp_player"),
      # (assign, "$lord_selected", "trp_player"),
      ##diplomacy start+
      (call_script, "script_dplmc_initialize_autoloot", 0),#argument "0" means this does nothing if deemed unnecessary
      ##diplomacy end+
      (jump_to_menu, "mnu_dplmc_auto_loot")
    ]),
		("dplmc_auto_loot_no",[
      (eq, "$inventory_menu_offset",0),
      (store_free_inventory_capacity, ":space", "$pool_troop"),
      (lt, ":space", 10),
      (disable_menu_option)
    ],"Insufficient item pool space for auto-upgrade.",[]),
		("dplmc_loot",[
    ],"Access the items on the ground.",[
      (change_screen_loot, "$pool_troop"),
    ]),
    ("dplmc_loot_player",[
      (is_between, "$lord_selected", companions_begin, companions_end),
    ],"Access the captain's inventory.",[
      (set_player_troop, "trp_player"),
      (change_screen_equip_other, "$lord_selected"),
      (assign, "$lord_selected", "trp_player"),
    ]),
    ("dplmc_auto_loot_upgrade_management", [],"Update management of NPCs' equipment.",[
      (party_get_num_companion_stacks, ":num_stacks", "p_main_party"),
      ##nested diplomcy start+ Add error check.

      ##nested diplomacy end+
      (try_begin),
        (is_between, "$lord_selected", companions_begin, companions_end),
        (assign, "$temp", "$lord_selected"),
      (else_try),
        (assign, "$temp", -1),
        (try_for_range, ":stack_no", 0, ":num_stacks"),
          (party_stack_get_troop_id,   ":stack_troop", "p_main_party", ":stack_no"),
          (is_between, ":stack_troop", companions_begin, companions_end),
          (assign, "$temp", ":stack_troop"),
          (assign, ":num_stacks", 0),
        (try_end),
      (try_end),
      ##nested diplomacy start+   Add error check.
      (call_script, "script_dplmc_initialize_autoloot", 0),#argument "0" means this does nothing if deemed unnecessary
      (try_begin),#<- dplmc+ added
        (ge, "$temp", 1),#<- dplmc+ added
        (assign, "$temp_2", -1), #SB : other globals
        (try_for_range, ":item_slot", ek_item_0, ek_food),
          (troop_set_slot, "trp_stack_selection_ids", ":item_slot", 0),
        (try_end),
        (str_clear, dplmc_loot_string),
        (start_presentation, "prsnt_dplmc_autoloot_upgrade_management"),
      (try_end),
      ##nested diplomacy end+
    ]),
    ("dplmc_auto_loot_reset_player",[
      (neq, "$lord_selected", "trp_player")
    ],"Reset current troop to the player",[
      (assign, "$lord_selected", "trp_player"),
      (set_player_troop, "$lord_selected"),
    ]),
		("dplmc_leave",[],"{s20}",[
      ##diplomacy start+
      #Actually abandon the lost loot
      (troop_get_inventory_capacity, ":inv_cap", "$pool_troop"),
      (try_for_range, ":i_slot", 10, ":inv_cap"),
        (troop_get_inventory_slot, ":item_id", "$pool_troop", ":i_slot"),
        (ge, ":item_id", 0),
        (neg|troop_has_item_equipped, "$pool_troop", ":item_id"),
        (troop_set_inventory_slot, "$pool_troop", ":i_slot", -1), #delete it
        (troop_inventory_slot_set_item_amount, "$pool_troop", ":i_slot", 0),
      (try_end),

      #(jump_to_menu, "mnu_camp"),
      (set_player_troop, "trp_player"),
      (jump_to_menu, "$dplmc_return_menu"),
      (assign, "$pool_troop", -1), #mark ending
      ##diplomacy end+
    ]),
    ##nested diplomacy start+
    #Leave & take everything you can
    ("dplmc_leave_and_take_a",[
      (store_free_inventory_capacity, ":space", "trp_player"),
      (lt, ":space", reg20),
      (gt, reg20, 0),
      (gt, ":space", 0),
      (assign, reg0, ":space"),
    ],"Gather {reg0} of the {reg20} items on the ground and leave.",[
      (store_free_inventory_capacity, ":space", "trp_player"),
      #Take remaining items for player
      (troop_get_inventory_capacity, ":inv_cap", "$pool_troop"),
      (troop_sort_inventory, "$pool_troop"),
      (try_for_range, ":i_slot", 10, ":inv_cap"),
          (gt, ":space", 0),
          (troop_get_inventory_slot, ":item_id", "$pool_troop", ":i_slot"),
          (ge, ":item_id", 0),
          (neg|troop_has_item_equipped, "$pool_troop", ":item_id"),
          (troop_get_inventory_slot_modifier, ":imod", "$pool_troop", ":i_slot"),
          (troop_add_item, "trp_player", ":item_id", ":imod"),#give item to player
          (val_sub, ":space", 1),
          (troop_set_inventory_slot, "$pool_troop", ":i_slot", -1), #remove item from pool
          (troop_inventory_slot_set_item_amount, "$pool_troop", ":i_slot", 0),
      (try_end),
      #(jump_to_menu, "mnu_camp"),
      (set_player_troop, "trp_player"),
      (jump_to_menu, "$dplmc_return_menu"),
      (assign, "$pool_troop", -1), #mark ending
    ]),
		("dplmc_leave_and_take_b",[
      (store_free_inventory_capacity, ":space", "trp_player"),
      (ge, ":space", reg20),
      (gt, reg20, 0),#don't show if nothing is on the ground
      (store_sub, reg0, reg20, 1),
    ],"Gather the remaining {reg20} {reg0?items:item} on the ground and leave.",[
      (store_free_inventory_capacity, ":space", "trp_player"),
      #Take remaining items for player
      (troop_get_inventory_capacity, ":inv_cap", "$pool_troop"),
      (try_for_range, ":i_slot", 10, ":inv_cap"),
          (gt, ":space", 0),
          (troop_get_inventory_slot, ":item_id", "$pool_troop", ":i_slot"),
          (ge, ":item_id", 0),
          (neg|troop_has_item_equipped, "$pool_troop", ":item_id"),
          (troop_get_inventory_slot_modifier, ":imod", "$pool_troop", ":i_slot"),
          (troop_add_item, "trp_player", ":item_id", ":imod"),#give item to player
          (val_sub, ":space", 1),
          (troop_set_inventory_slot, "$pool_troop", ":i_slot", -1), #remove item frlom pool
          (troop_inventory_slot_set_item_amount, "$pool_troop", ":i_slot", 0),
      (try_end),
      (set_player_troop, "trp_player"),
      (jump_to_menu, "$dplmc_return_menu"),
      (assign, "$pool_troop", -1), #mark ending
    ]),
		("dplmc_leave_and_take_c",[
      (store_free_inventory_capacity, ":space", "trp_player"),
      (eq, ":space", 0),
      (gt, reg20, 0),#don't show if nothing is on the ground
      (disable_menu_option),
		],"There is no space left in your bags.",[]),
]),

("dplmc_auto_loot",0,
  "Your heroes will automatically grab items from the loot pool based on their pre-selected upgrade options. Heroes listed first in the party order will have first pick."
  +" Any equipment no longer needed will be dropped back into the loot pool. Any items in the loot pool will be lost when you leave.^ Are you sure you wish to do this?",
	"none",[
  ],[
    ("dplmc_autoloot_no",[],"No, I've changed my mind.",[
      (jump_to_menu, "mnu_dplmc_manage_loot_pool"),
    ]),
    ("dplmc_autoloot_yes",[],"Yes, perform the upgrading.",[
      ##diplomacy start+
      (call_script, "script_dplmc_initialize_autoloot", 0),#argument "0" means this does nothing if deemed unnecessary
      (assign, "$pool_troop", "trp_temp_troop"),
      #SB : reset variables
      (set_player_troop, "trp_player"),
      (assign, "$lord_selected", "trp_player"),
      ##diplomacy end+
      (call_script, "script_dplmc_auto_loot_all", "trp_temp_troop", dplmc_loot_string),
      (jump_to_menu, "mnu_dplmc_manage_loot_pool"),
    ]),
		("dplmc_autoloot_personal",[
      (is_between, "$lord_selected", companions_begin, companions_end),
      (str_store_troop_name, s1, "$lord_selected")
    ],"Yes, only upgrade {s1}.",[
      ##diplomacy start+
      (assign, "$pool_troop", "trp_temp_troop"),
      (call_script, "script_dplmc_auto_loot_troop", "$lord_selected", "$pool_troop", dplmc_loot_string),
      ##diplomacy end+
      (jump_to_menu, "mnu_dplmc_manage_loot_pool"),
    ]),
]),

("dplmc_notification_tribute_declared",0,
  "Tributary established^^The {s1} have been subjugated by {s2}!^{s3} diplomacy is now limited by his new overlord.^{s57}",
  "none",[
	  (str_clear, s57),
    (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
    (str_store_troop_name, s3, ":leader"),
	  (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
    (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
    (val_mul, ":faction_1", 128),
    (val_add, ":faction_1", ":faction_2"),
    (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
  ],[
    ("dplmc_continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

("notification_tributary_offer",0,
  "You recieve a message from {s1} of the {s2}. He offers you a tribute of 20,000 denars and to submit to you. The {s2} would be your vassal state from now on.^^"
  + " As vassal state they are not able to declare war or peace and will follow you into wars.",
  "none",[
    (str_store_faction_name, s2, "$g_notification_menu_var1"),
    (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
    (str_store_troop_name, s1, ":leader"),
  ],[
    ("dplmc_continue",[],"Accept. {s2} are now my tributaries.",[
      (call_script, "script_dplmc_start_tributary_between_kingdoms", "$g_notification_menu_var1", "fac_player_supporters_faction", 1),
      (change_screen_return),
    ]),
    ("dplmc_continue",[],"Reject the offer.",[
      (change_screen_return),
    ]),
]),

("dplmc_notification_alliance_declared",0,
  "Alliance Agreement^^{s1} and {s2} have formed an alliance!^{s57}",
  "none",[
	  (str_clear, s57),
	  (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
    (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
    (val_mul, ":faction_1", 128),
    (val_add, ":faction_1", ":faction_2"),
    (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
  ],[
    ("dplmc_continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

("dplmc_notification_defensive_declared",0,
  "Defensive Pact^^{s1} and {s2} have agreed to a defensive pact!^{s57}",
  "none",[
	  (str_clear, s57),
	  (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
    (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
    (val_mul, ":faction_1", 128),
    (val_add, ":faction_1", ":faction_2"),
    (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
  ],[
    ("dplmc_continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

("dplmc_notification_trade_declared",0,
  "Trade Agreement^^{s1} and {s2} have signed a trade agreement!^{s57}",
  "none",[
	  (str_clear, s57),
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
    (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
    (val_mul, ":faction_1", 128),
    (val_add, ":faction_1", ":faction_2"),
    (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
  ],[
    ("dplmc_continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

("dplmc_notification_nonaggression_declared",0,
  "Non-aggression Treaty^^{s1} and {s2} have concluded a non-aggression treaty!^{s57}",
  "none",[
    (str_clear, s57),
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
    (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
    (val_mul, ":faction_1", 128),
    (val_add, ":faction_1", ":faction_2"),
    (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
  ],[
    ("dplmc_continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),
(
  "dplmc_question_alliance_offer",0,
  "You Receive an Alliance Offer^^The {s1} wants to form an alliance with you. What is your answer?",
  "none",
  [
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    ],
  [
    ("dplmc_alliance_offer_accept",[],"Accept",
      [
        (call_script, "script_dplmc_start_alliance_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
        (change_screen_return),
      ]),
    ("dplmc_alliance_offer_reject",[],"Reject",
      [
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -2),
        (change_screen_return),
      ]),
    ]
),
(
  "dplmc_question_defensive_offer",0,
  "You Receive a Pact Offer^^The {s1} offers you a defensive pact. What is your answer?",
  "none",
  [
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    ],
  [
    ("dplmc_defensive_offer_accept",[],"Accept",
      [
        (call_script, "script_dplmc_start_defensive_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
        (change_screen_return),
      ]),
    ("dplmc_defensive_offer_reject",[],"Reject",
      [
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -2),
        (change_screen_return),
      ]),
    ]
),
(
  "dplmc_question_trade_offer",0,
  "You Receive a Pact Offer^^The {s1} offers you a trade pact. What is your answer?",
  "none",
  [
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    ],
  [
    ("dplmc_trade_offer_accept",[],"Accept",
      [
        (call_script, "script_dplmc_start_trade_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
        (change_screen_return),
      ]),
    ("dplmc_trade_offer_reject",[],"Reject",
      [
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -2),
        (change_screen_return),
      ]),
    ]
),
("dplmc_question_nonaggression_offer",0,
  "You Receive a Pact Offer^^The {s1} offers you a non-aggression treaty. What is your answer?",
  "none",[
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
  ],[
    ("dplmc_nonaggression_offer_accept",[],"Accept",[
      (call_script, "script_dplmc_start_nonaggression_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
      (change_screen_return),
    ]),
    ("dplmc_nonaggression_offer_reject",[],"Reject",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -2),
      (change_screen_return),
    ]),
]),
("dplmc_notification_tribute_expired",0,
  "Tributary treaty has expired^^{s30}",
  "none",[
    (str_store_faction_name, s11, "$g_notification_menu_var1"),
    (str_store_faction_name, s12, "$g_notification_menu_var2"),
    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
    (faction_get_slot, ":leader_2", "$g_notification_menu_var2", slot_faction_leader),
    (try_begin),
        (neq, ":leader_1", "trp_player"),
        (neq, ":leader_2", "trp_player"),
        (this_or_next|eq, "$g_notification_menu_var2", "fac_kingdom_6"),
        (this_or_next|eq, "$g_notification_menu_var2", "fac_kingdom_5"),
        (faction_slot_eq, "$g_notification_menu_var2", slot_faction_government_type, gov_imperial),
        (call_script, "script_troop_get_relation_with_troop", ":leader_1", ":leader_2"),
        (assign, ":relation", reg0),
        (store_random_in_range, ":rand", 0, 750),
        (val_add, ":relation", 100),
        (try_for_range, ":possible_mutual_enemy", kingdoms_begin, kingdoms_end),
            (neq, ":possible_mutual_enemy", "$g_notification_menu_var1"),
            (neq, ":possible_mutual_enemy", "$g_notification_menu_var2"),
            (faction_slot_eq, ":possible_mutual_enemy", slot_faction_state, sfs_active),
            (store_relation, ":fac_relation", ":possible_mutual_enemy", "$g_notification_menu_var2"),
            (lt, ":fac_relation", 0),
            (val_add, ":relation", 500),
        (try_end),
        (le, ":rand", ":relation"),
        (str_store_string, s30, "@The tributary treaty between {s11} and {s12} expired. However, a prolongation of the treaty was negotiated."),
        (faction_set_slot, "$g_notification_menu_var1", slot_faction_tributary_of, "$g_notification_menu_var2"),

        (store_add, ":truce_slot", "$g_notification_menu_var1", slot_faction_truce_days_with_factions_begin),
        (val_sub, ":truce_slot", kingdoms_begin),
        (faction_set_slot, "$g_notification_menu_var2", ":truce_slot", dplmc_treaty_tributary_days_initial),

        (store_add, ":truce_slot", "$g_notification_menu_var2", slot_faction_truce_days_with_factions_begin),
        (val_sub, ":truce_slot", kingdoms_begin),
        (faction_set_slot, "$g_notification_menu_var1", ":truce_slot", dplmc_treaty_tributary_days_initial),
    (else_try),
        (faction_slot_eq, "$g_notification_menu_var2", slot_faction_leader, "trp_player"),
        (str_store_troop_name, s13, ":leader_1"),
        (str_store_string, s30, "@The tributary treaty between {s11} and {s12} expired. Though you may negotiate to prolong the treaty. The success will depend on your relation with {s13}."),
    (else_try),
        (str_store_string, s30, "@The {s11} are no longer a tributary vassal of {s12}. The treaty has expired and was degraded to an alliance."),
    (try_end),
  ],[
    ("prolong",[
      (faction_slot_eq, "$g_notification_menu_var2", slot_faction_leader, "trp_player"),
    ],"Try to persuade them to prolong the treaty",[
      (faction_get_slot, ":leader_1", "$g_notification_menu_var1", slot_faction_leader),
      (call_script, "script_troop_get_player_relation", ":leader_1"),
      (assign, ":relation", reg0),
      (try_begin),
          (store_random_in_range, ":rand", 0, 750),
          (val_add, ":relation", 100),
          (try_for_range, ":possible_mutual_enemy", kingdoms_begin, kingdoms_end),
              (neq, ":possible_mutual_enemy", "$g_notification_menu_var1"),
              (neq, ":possible_mutual_enemy", "$g_notification_menu_var2"),
              (faction_slot_eq, ":possible_mutual_enemy", slot_faction_state, sfs_active),
              (store_relation, ":fac_relation", ":possible_mutual_enemy", "$g_notification_menu_var2"),
              (lt, ":fac_relation", 0),
              (val_add, ":relation", 500),
          (try_end),
          (le, ":rand", ":relation"),
          (str_store_troop_name, s13, ":leader_1"),
          (str_store_string, s1, "@You manage to instill so much fear in {s13} about the negative consequences of ending the treaty that {s13} agrees to extend the tributary agreement."),
          (faction_set_slot, "$g_notification_menu_var1", slot_faction_tributary_of, "$g_notification_menu_var2"),
          (store_add, ":truce_slot", "$g_notification_menu_var1", slot_faction_truce_days_with_factions_begin),
          (val_sub, ":truce_slot", kingdoms_begin),
          (faction_set_slot, "$g_notification_menu_var2", ":truce_slot", dplmc_treaty_tributary_days_initial),
          (store_add, ":truce_slot", "$g_notification_menu_var2", slot_faction_truce_days_with_factions_begin),
          (val_sub, ":truce_slot", kingdoms_begin),
          (faction_set_slot, "$g_notification_menu_var1", ":truce_slot", dplmc_treaty_tributary_days_initial),
      (else_try),
          (str_store_troop_name, s13, ":leader_1"),
          (str_store_string, s1, "@Although you do your best to warn {s13} about the negative consequences of rejecting your proposal, {s13} still refuses."),
      (try_end),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("no_prolong",[
      (faction_slot_eq, "$g_notification_menu_var2", slot_faction_leader, "trp_player"),
    ],"Do not prolong the treaty",[
      (change_screen_return),
    ]),
    ("dplmc_continue",[
      (neg|faction_slot_eq, "$g_notification_menu_var2", slot_faction_leader, "trp_player"),
    ],"Continue",[
      (change_screen_return),
    ]),
]),
("dplmc_notification_alliance_expired",0,
  "Alliance Has Expired^^The alliance between {s1} and {s2} has expired and was degraded to a defensive pact.",
  "none",[
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),

    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
  ],[
    ("dplmc_continue",[],"Continue",[
      (change_screen_return),
    ]),
]),
(
  "dplmc_notification_defensive_expired",0,
  "Defensive Pact Has Expired^^The defensive pact between {s1} and {s2} has expired and was degraded to a trade agreement.",
  "none",
  [
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),

    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    ],
  [
    ("dplmc_continue",[],"Continue",
      [
    (change_screen_return),
      ]),
    ]
),

(
  "dplmc_notification_trade_expired",0,
  "Trade Agreement Has Expired^^The trade agreement between {s1} and {s2} has expired and was degraded to a non-aggression treaty.",
  "none",
  [
    (str_store_faction_name, s1, "$g_notification_menu_var1"),
    (str_store_faction_name, s2, "$g_notification_menu_var2"),

    (set_fixed_point_multiplier, 100),
    (position_set_x, pos0, 65),
    (position_set_y, pos0, 30),
    (position_set_z, pos0, 170),
    (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    ],
  [
    ("dplmc_continue",[],"Continue",
      [
    (change_screen_return),
      ]),
    ]
),

("dplmc_deny_terms",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The {s1} refuses your terms.^^{s45}",
  "none",
  [(set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),],
  [
  ("dplmc_continue",[],"Continue",
      [
      (jump_to_menu, "mnu_question_peace_offer"),
      ]),
  ]
),

("dplmc_village_riot_result",mnf_scale_picture,
  "{s9}",
  "none",[
    (try_begin),
       (eq, "$g_battle_result", 1),
       (jump_to_menu, "mnu_dplmc_village_riot_removed"),
     (else_try),
       (set_background_mesh, "mesh_pic_villageriot"),
       (str_store_string, s9, "@Try as you might, you could not defeat the rebelling village."),
     (try_end),
  ],[
      ("dplmc_continue",[],"Continue...",[
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -3),
        (call_script, "script_change_troop_renown", "trp_player", -5), #SB : renown loss highest here
        (jump_to_menu, "mnu_village"),
      ]),
]),

("dplmc_village_riot_removed",mnf_disable_all_keys,
  "In bloody battle you and your men slaughter the rebels and regain control over the village. You relation with the village improves as the main troublemakers are now dead.",
  "none",
  [
    (set_background_mesh, "mesh_pic_looted_village"),
    (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
    # (call_script, "script_village_set_state",  "$current_town", svs_looted),
    # you wont loot it!
  ],[
    ("dplmc_continue",[],"Continue...",[
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 20),
      (jump_to_menu, "mnu_village"),
    ]),
]),

("dplmc_town_riot_removed",mnf_disable_all_keys,
  "In bloody battle you and your men slaughter the rebels and regain control over the town.",
  "none",
  [
  ],[
    ("dplmc_continue",[],"Continue...",[
      (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
      (assign, "$new_encounter", 1),
      (try_begin),
          (party_get_slot, ":town_lord","$g_encountered_party", slot_town_lord),
          (troop_get_slot, ":cur_banner", ":town_lord", slot_troop_banner_scene_prop),
          (try_begin),
              (gt, ":cur_banner", 0),
              (val_sub, ":cur_banner", banner_scene_props_begin),
              (val_add, ":cur_banner", banner_map_icons_begin),
              (party_set_banner_icon, "$g_encountered_party", ":cur_banner"),
          (else_try),
              (eq, ":cur_banner", -1),
              (troop_get_slot, ":flag_icon", ":town_lord", slot_troop_custom_banner_map_flag_type),
              (try_begin),
                (ge, ":flag_icon", 0),
                (val_add, ":flag_icon", custom_banner_map_icons_begin),
                (party_set_banner_icon, "$g_encountered_party", ":flag_icon"),
              (try_end),
          (try_end), #custom_banner_begin
      (try_end),
      (jump_to_menu, "mnu_castle_outside"),
    ]),
]),

("dplmc_riot_negotiate",mnf_disable_all_keys,
  "You approach the angry crowd and begin negotiations. The leader of the riot demands {reg0} denars. He agrees to lay down arms if you are willing to pay.",
  "none",[
    (party_get_slot, ":center_relation", "$g_encountered_party", slot_center_player_relation),
    (val_min, ":center_relation", 0),
    (try_begin),
      (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
      (val_sub, ":center_relation", 75),
      (set_background_mesh, "mesh_pic_townriot"),
    (else_try),
      (val_sub, ":center_relation", 50),
      (set_background_mesh, "mesh_pic_villageriot"),
    (try_end),

    (store_skill_level, ":persuasion_level", "skl_persuasion", "trp_player"),
    (val_add, ":center_relation", ":persuasion_level"),
    (val_mul, ":center_relation", ":center_relation"),
    (assign, reg0, ":center_relation"),
  ],[
  ("dplmc_pay_riot_treasury",[
    (gt, "$g_player_chamberlain", 0),
    (store_troop_gold, ":gold", "trp_household_possessions"),
    (ge, ":gold", reg0),
  ],"Induce your Quaestor to pay the money from the treasury.",[
    (call_script, "script_dplmc_withdraw_from_treasury", reg0),
    (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
    (try_begin),
      (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
      (jump_to_menu, "mnu_castle_outside"),
    (else_try),
      (jump_to_menu, "mnu_village"),
    (try_end),
  ]),
  ("dplmc_pay_riot_cash",[
    (store_troop_gold, ":gold", "trp_player"),
    (ge, ":gold", reg0),
  ],"Pay cash.",[
    (troop_remove_gold, "trp_player", reg0),
    (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
    (try_begin),
      (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
      (jump_to_menu, "mnu_castle_outside"),
    (else_try),
      (jump_to_menu, "mnu_village"),
    (try_end),
  ]),
  ("dplmc_back",[],"Back...",[
    (try_begin),
      (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
      (jump_to_menu, "mnu_castle_outside"),
    (else_try),
      (jump_to_menu, "mnu_village"),
    (try_end),
  ]),
]),

("dplmc_notification_riot",0,
  "Riot!^^The peasants of {s1} launched a riot against you! In a surprise attack, men loyal to you have been slain. The remainder joined the angry crowd.",
  "none",[
    (str_store_party_name, s1, "$g_notification_menu_var1"),
    (try_begin),
      (party_slot_eq, "$g_notification_menu_var1", slot_party_type, spt_town),
      (set_background_mesh, "mesh_pic_townriot"),
    (else_try),
      (set_background_mesh, "mesh_pic_villageriot"),
    (try_end),
  ],[
    ("dplmc_continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),
("dplmc_notification_appoint_chamberlain",0,
  "You can appoint a Quaestor who resides at your court for a weekly salary of 1,500 denars."
  +" ^^A Quaestor manages your private treasury, which can be used to savely store money. The money is then used to pay wages for troops or can be also used for construction projects."
  +" ^^If you govern a town, fortress or village, he will handle all financial affairs like collecting and determining taxes, paying wages and managing your estates."
  +" ^^If you are the leader of a faction, he supervises money transfers between kingdoms giving you more diplomatic options.",
  "none",[
    (set_background_mesh, "mesh_pic_payment"),
  ],[
    ("dplmc_appoint_default",[],"Appoint a prominent nobleman from the area.",[
      (call_script, "script_dplmc_appoint_chamberlain"),
      (jump_to_menu, "mnu_dplmc_chamberlain_confirm"),
    ]),
    ("dplmc_continue",[],"Proceed without Quaestor.",[
      (assign, "$g_player_chamberlain", -1), #denied
      (change_screen_return),
    ]),
]),

("dplmc_chamberlain_confirm",0,
  "Your Quaestor can be found at your court and your estates. You should consult him if you want to give him any financial advice or you need greater amounts of money. You should always make sure that there is enough money in the treasury to pay for your budget.",
  "none",[
    (set_background_mesh, "mesh_pic_payment"),
  ],[
    ("dplmc_continue",[],"Continue...",[
         (change_screen_return),
    ]),
]),
("dplmc_notification_appoint_constable",0,
  "You can now appoint a Custos Publicus who resides at you court for a weekly salary of 1500 denars. He will recruit new troops and provide information about your army.",
  "none",[
    (set_background_mesh, "mesh_pic_mb_warrior_2"),
  ],[
  ("dplmc_appoint_default",[],"Appoint a prominent nobleman from the area.",[
    (call_script, "script_dplmc_appoint_constable"),
    (jump_to_menu, "mnu_dplmc_constable_confirm"),
  ]),
  ("dplmc_continue",[],"Proceed without Custos Publicus.",[
    (assign, "$g_player_constable", -1), #denied
    (assign, "$g_constable_training_center", -1),
    (change_screen_return),
  ]),
]),

("dplmc_constable_confirm",0,
  "Your Custos Publicus can be found at your court. You should consult him if you want to recruit new troops or get detailed information about your standing army.",
  "none",[
    (set_background_mesh, "mesh_pic_mb_warrior_2"),
  ],[
  ("dplmc_continue",[],"Continue...",[
    (change_screen_return),
  ]),
]),

("dplmc_notification_appoint_chancellor",0,
  "You can now appoint a chancellor who resides at you court for a weekly salary of 2000 denars. He will be the keeper of your seal and conduct the correspondence between you and other important persons.",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
  ],[
  ("dplmc_appoint_default",[],"Appoint a prominent nobleman from the area.",[
    (call_script, "script_dplmc_appoint_chancellor"),
    (jump_to_menu, "mnu_dplmc_chancellor_confirm"),
  ]),
  ("dplmc_continue",[],"Proceed without chancellor.",[
    (assign, "$g_player_chancellor", -1), #denied
    (change_screen_return),
  ]),
]),

("dplmc_chancellor_confirm",0,
  "Your chancellor can be found at your court. You should consult him if you want to send messages or gifts.",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
  ],[
  ("dplmc_continue",[],"Continue...",[
    (change_screen_return),
  ]),
]),

("dplmc_deserters",0,
  "Some of your men don't believe that you will pay their wages and desert. Overall you lose: {s11} men.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
    (store_random_in_range, ":random", 1,  "$g_notification_menu_var1"),
    (call_script, "script_dplmc_player_troops_leave", ":random"),
    (str_store_string, s11, "@{reg0}"),
  ],[
  ("dplmc_continue",[],"Continue...",[
    (change_screen_return),
  ]),
]),

  (
    "dplmc_negotiate_besieger",0,
    "You appear with a white flag at the top of the wall. After a while a negotiator of {s11} approaches you. He demands {s6} and all associated villages as well as {reg0} denars for safe conduct.",
    "none",
    [
      (party_get_slot, ":besieger", "$current_town", slot_center_is_besieged_by),
      (party_stack_get_troop_id, ":enemy_party_leader", ":besieger", 0),
      (str_store_troop_name, s11, ":enemy_party_leader"),
      (store_faction_of_troop, ":besieger_faction", ":enemy_party_leader"),

      ##diplomacy start+
	  #1) Support promoted kingdom ladies, mercenary parties, etc.
	  #2) Fix mistake with potentially not counting besieger party in the size calculation!
	  ##OLD:
	  #(assign, ":besieger_size", 0),
      #(try_for_range, ":lord", active_npcs_begin, active_npcs_end),
      #  (store_faction_of_troop, ":lord_faction", ":lord"),
      #  (eq, ":lord_faction", ":besieger_faction"),
      #  (troop_get_slot, ":led_party", ":lord", slot_troop_leaded_party),
      ##NEW:
      (party_get_num_companions, ":besieger_size", ":besieger"),

	  (try_for_parties, ":led_party"),
        (ge, ":led_party", spawn_points_end),
        (neq, ":led_party", ":besieger"),#don't double count
        (store_faction_of_party, ":party_faction", ":led_party"),
        (eq, ":party_faction", ":besieger_faction"),
	  ##diplomacy end+
        (party_is_active, ":led_party"),

        (party_slot_eq, ":led_party", slot_party_ai_state, spai_accompanying_army),
        (party_slot_eq, ":led_party", slot_party_ai_object, ":besieger"),

        (party_is_active, ":besieger"),
        (store_distance_to_party_from_party, ":distance_to_marshal", ":led_party", ":besieger"),
        (lt, ":distance_to_marshal", 25),
        (party_get_num_companions, ":party_size", ":led_party"),
        (val_add, ":besieger_size", ":party_size"),
      (try_end),

      (assign, ":garrison_size", 0),
      (party_get_num_companion_stacks, ":num_stacks", "$current_town"),
      (try_for_range, ":i_stack", 0, ":num_stacks"),
        (party_stack_get_size, ":stack_size", "$current_town", ":i_stack"),
        (val_add, ":garrison_size", ":stack_size"),
      (try_end),
      (val_sub, ":besieger_size", ":garrison_size"),

      (store_skill_level, ":player_persuasion_skill", "skl_persuasion", "trp_player"),
      (val_mul, ":player_persuasion_skill", 10),
      (store_sub, "$diplomacy_var", ":besieger_size", ":player_persuasion_skill"),
      (val_mul, "$diplomacy_var", 4),
      ##diplomacy start+ : include ransom cost in calculation
      (call_script, "script_calculate_ransom_amount_for_troop", "trp_player"),
      (val_add, "$diplomacy_var", reg0),
      ##diplomacy end+
      (val_max,"$diplomacy_var",500),
      (val_div, "$diplomacy_var", 100),
      (val_mul, "$diplomacy_var", 100),
      (assign, reg0, "$diplomacy_var"),

      (str_store_party_name, s6, "$current_town"),

    ],
      [
      ("dplmc_comply_treasury",
      [
        (store_troop_gold, ":gold", "trp_household_possessions"),
        (ge, ":gold", "$diplomacy_var"),
      ],"Comply and induce your Quaestor to pay the money from the treasury.",
      [
        (call_script, "script_dplmc_withdraw_from_treasury", "$diplomacy_var"),
		##diplomacy start+ when the player pays, give the gold to the lord
		(party_get_slot, ":besieger", "$current_town", slot_center_is_besieged_by),
		(party_stack_get_troop_id, ":enemy_party_leader", ":besieger", 0),
		(call_script, "script_dplmc_distribute_gold_to_lord_and_holdings", "$diplomacy_var", ":enemy_party_leader"),
		##diplomacy end+
        (call_script, "script_dplmc_player_center_surrender", "$current_town"),
        (change_screen_return),
      ]),

      ("dplmc_comply",
      [
        (store_troop_gold, ":gold", "trp_player"),
        (ge, ":gold", "$diplomacy_var"),
      ],"Comply and pay the gold.",
      [
        (troop_remove_gold, "trp_player", "$diplomacy_var"),
		##diplomacy start+ when the player pays, give the gold to the lord
		(party_get_slot, ":besieger", "$current_town", slot_center_is_besieged_by),
		(party_stack_get_troop_id, ":enemy_party_leader", ":besieger", 0),
		(call_script, "script_dplmc_distribute_gold_to_lord_and_holdings", "$diplomacy_var", ":enemy_party_leader"),
		##diplomacy end+
        (call_script, "script_dplmc_player_center_surrender", "$current_town"),
        (change_screen_return),
      ]),

      ("dplmc_break_off",[],"Break off negotiations.",
       [
          (jump_to_menu, "mnu_town"),
        ]),
     ]
  ),

  (
    "dplmc_messenger",0,
##nested diplomacy start+ "His" to "{reg4?Her:His}"
    "Sire, I found {s10} and delivered your message. {reg4?Her:His} answer was {s11}.",
##nested diplomacy end+
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger"),
        (str_store_troop_name, s10, "$g_notification_menu_var1"),
        (try_begin),
          (eq, "$g_notification_menu_var2", 1),
          (str_store_string, s11, "@positive"),
        (else_try),
          (str_store_string, s11, "@negative"),
        (try_end),
        ##nested diplomacy start+
        (try_begin),
           (call_script, "script_cf_dplmc_troop_is_female", "$g_notification_menu_var1"),
           (assign, reg4, 1),
        (else_try),
           (assign, reg4, 0),
        (try_end),
        ##nested diplomacy end+
    ],
    [
      ("dplmc_continue",[],"Continue...",
       [
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_scout",0,
    "Your spy returned from {s10}^^{s11}{s12}",
    "none",
    [
    (set_background_mesh, "mesh_pic_messenger"),
    (str_store_party_name, s10, "$g_notification_menu_var1"),

    (call_script, "script_game_get_center_note", "$g_notification_menu_var1", 0),
    (str_store_string, s11, "@{!}{s0}"),
    (try_begin),
      (this_or_next|is_between, "$g_notification_menu_var1", towns_begin, towns_end),
      (is_between, "$g_notification_menu_var1", castles_begin, castles_end),
      (party_get_slot, ":center_food_store", "$g_notification_menu_var1", slot_party_food_store),
      (call_script, "script_center_get_food_consumption", "$g_notification_menu_var1"),
      (assign, ":food_consumption", reg0),
      (store_div, reg6, ":center_food_store", ":food_consumption"),
      (store_party_size, reg5, "$g_notification_menu_var1"),
      (str_store_string, s11, "@{s11}^^ The current garrison consists of {reg5} men.^The food stock lasts for {reg6} days."),
    (try_end),

    (str_clear, s12),
    (party_get_num_attached_parties, ":num_attached_parties", "$g_notification_menu_var1"),
    (try_begin),#<- dplmc+ unclosed try_begin!
      (gt, ":num_attached_parties", 0),
      (str_store_string, s12, "@^^Additional the following parties are currently inside:^"),
        (try_for_range, ":attached_party_rank", 0, ":num_attached_parties"),
          (party_get_attached_party_with_rank, ":attached_party", "$g_notification_menu_var1", ":attached_party_rank"),
          (str_store_party_name, s3, ":attached_party"),
          (store_party_size, reg1, ":attached_party"),
          (str_store_string, s12, "@{s12} {s3} with {reg1} troops.^"),
        (try_end),
	##diplomacy start+
	#Add missing try-end for (gt, ":num_attached_parties", 0),
	(try_end),
	##diplomacy end+

    (call_script, "script_update_center_recon_notes", "$g_notification_menu_var1"),
    ],
    [
      ("dplmc_continue",[],"Continue...",
       [
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_domestic_policy",0,
    "You can now shape the domestic policy of your kingdom. Do you want to change your policy now?",
    "none",
    [
      (try_begin),
          (eq, "$g_players_policy_set", 1),
          (change_screen_return),
      (try_end),

      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),
    ],
    [
      ("dplmc_yes",[],"Yes, I want to change the domestic policy.",
       [
         (start_presentation, "prsnt_dplmc_policy_management"),
        ]),
      ("dplmc_no",[],"No, I don't want to change the domestic policy.",
       [
         (change_screen_return),
        ]),
     ]
  ),

("dplmc_affiliate_end",0,
  "You recieve a message from {s10}, the head of the family you are affiliated with. The message reads:^^{s63}",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (str_store_troop_name, s10, "$g_notification_menu_var1"),
    (try_begin),
      ##nested diplomacy start+ (1) Fix a bug from the Diplomacy 3.3.2 version of this menu by getting your ex-affiliate
      #from "$g_notification_menu_var2" instead of "$g_player_affiliated_troop".
      ##OLD: #(eq, "$g_player_affiliated_troop", "$g_notification_menu_var1"),
      (eq, "$g_notification_menu_var2", "$g_notification_menu_var1"),
      ##nested diplomacy end+
      (str_store_string, s63, "@{playername}, ^^I always knew you were a bad egg, since the day you have pledged allegiance to my clan. ^Did you really think you could set my family against me? You've dropped your mask, you snake! You are an infliction, and I will not bear it anymore. ^Hereby, I disown and ban you from my house. I have urged my family to fight you, and I will warn other lords about your infamy. ^Tremble with fear, you have a deadly enemy! ^^{s10}."),
    (else_try),
      ##nested diplomacy start+ (2) Fix a bug from the Diplomacy 3.3.2 version of this menu by getting your ex-affiliate
      #from "$g_notification_menu_var2" instead of "$g_player_affiliated_troop".
      ##OLD:
      #(is_between, "$g_player_affiliated_troop", lords_begin, kingdom_ladies_end),
      #(str_store_troop_name, s10, "$g_player_affiliated_troop"),
      ##NEW:
      (ge, "$g_notification_menu_var1", walkers_end),
      (troop_is_hero, "$g_notification_menu_var1"),

      ##### (3) Make the next line use correct pronouns, and correct term for king/queen.  TODO: Change some of the funny wording.
      ##OLD:
      #(str_store_string, s63, "@{playername},^^ I've received a letter from {s9}, telling me about your disgracefull jiggery-pokery. In the present circumstances, {s9} could not provide evidence. But unlike you, {he/she} is a distinguished member of my family; and since all these years, I never had any reason to distrust {him/her}. I take {his/her} charges for granted. ^Hopefully, you failed to breakup my family unit. Hereby I reject your pledge : you are no longer related to my house. Each membership will retaliate against you in all conscience... ^I would be ashamed to confess how you maliciously fooled me, so I will not challenge you, to not be accountable for your death to my King. However I'm not used to report him every rat I crush while in wilderness, someday I may find you there ! ^^{s10}"),
      ##NEW:
      (call_script, "script_dplmc_store_troop_is_female", "$g_notification_menu_var1"),
      (assign, reg1, reg0),#Move to reg1, because reg0 will be overwritten below
      (store_faction_of_troop, ":faction_var", "$g_notification_menu_var1"),
      (try_begin),
          (gt, ":faction_var", 0),
          (faction_get_slot, ":faction_var", ":faction_var", slot_faction_leader),
          (gt, ":faction_var", 0),
          (call_script, "script_dplmc_store_troop_is_female", ":faction_var"),
          (eq, reg0, 1),
          (call_script, "script_dplmc_print_cultural_word_to_sreg", "$g_notification_menu_var1", DPLMC_CULTURAL_TERM_KING_FEMALE, s11),
          (assign, reg1, 1),#make sure the above didn't do anything funny with the register
      (else_try),
          (call_script, "script_dplmc_print_cultural_word_to_sreg", "$g_notification_menu_var1", DPLMC_CULTURAL_TERM_KING, s11),
          (assign, reg1, 0),#if there was no faction leader, reg0 might not have been initialized in the first place
      (try_end),
      #Aside from making the next line use the correct gender for the pronoun,
      #I made the wording a tiny bit less strange (although I left in "jiggery-pokery").
      (str_store_string, s63, "@{playername},^^ I've received a letter from {s9}, telling me about your disgraceful jiggery-pokery. In the present circumstances, {s9} could not provide evidence. But unlike you, {reg1?she:he} is a distinguished member of my family; and since all these years, I never had any reason to distrust {reg1?her:him}. I take {reg1?her:him} charges for granted. ^Hopefully, you failed to breakup my family unit. Hereby I reject your pledge : you are no longer related to my house. Each membership will retaliate against you in all conscience... ^I would be ashamed to confess how you maliciously fooled me, so I will not challenge you, to not be accountable for your death to my {s11}. However I'm not used to telling {reg0?her:him} about every rat I crush in the wilderness, and someday I may find you there ! ^^{s10}"),
      ##nested diplomacy end+
    (else_try),
      (str_store_string, s63, "@This is a diplomacy bug! Complain at the diplomacy forum."),
    (try_end),
  ],[
    ("dplmc_continue",[],"Continue...",[
      (change_screen_return),
    ]),
]),

  ##diplomacy end
##diplomacy start+
("dplmc_affiliated_family_report",0,
  "{s0}",
  "none",[
    (str_clear, s0),
    (str_clear, s1),
    (try_for_range, ":troop_no", active_npcs_including_player_begin, kingdom_ladies_end),
      (try_begin),
        (eq, ":troop_no", active_npcs_including_player_begin),
        (assign, ":troop_no", "trp_player"),
      (try_end),
      (call_script, "script_dplmc_store_troop_is_eligible_for_affiliate_messages", ":troop_no"),
      (this_or_next|eq, ":troop_no", "trp_player"),
      (ge, reg0, 1),
      (str_clear, s1),
      (str_store_string, s0, "str_dplmc_s0_newline_s1"),#add blank line to start
      #show name; (non-player) also show location
      (try_begin),
        (eq, ":troop_no", "trp_player"),
        (str_store_string, s1, "@{playername}"),
      (else_try),
        (call_script, "script_get_information_about_troops_position", ":troop_no", 0),#s1 = String, reg0 = knows-or-not
      (try_end),
      (str_store_string, s0, "str_dplmc_s0_newline_s1"),#add line
      #(non-player) show relation
      (try_begin),
        (neq, "trp_player", ":troop_no"),
        (call_script, "script_troop_get_player_relation", ":troop_no"),
        (assign, reg1, reg0) ,
        (str_store_string, s1, "str_relation_reg1"),
        (str_store_string, s0, "str_dplmc_s0_newline_s1"),#add line
      (try_end),
      #(non-prisoner) show party size
      (try_begin),
              (neg|troop_slot_ge, ":troop_no", slot_troop_prisoner_of_party, 0),
        (troop_get_slot, ":led_party", ":troop_no", slot_troop_leaded_party),
              (this_or_next|eq, ":led_party", 0),
          (ge, ":led_party", spawn_points_end),
        (this_or_next|eq, ":troop_no", "trp_player"),
          (neq, ":led_party", "p_main_party"),
        (party_is_active, ":led_party"),
        (assign, reg0, 0),
        (party_get_num_companions, reg1, ":led_party"),#number of troops
              (str_store_string, s1, "@Troops: {reg1}"),
        (str_store_string, s0, "str_dplmc_s0_newline_s1"),#add line
      (try_end),
    (try_end),
  ],[
  ("continue",[],"Continue...",[
    (jump_to_menu, "mnu_reports"),
  ]),
]),

("trade_report",0,
  "A list of towns is given, showing how many merchant caravans and traders visited each.^^{s0}",
  "none",[
    (str_clear, s0),
    (try_for_range, ":town", towns_begin, towns_end),
        (str_store_party_name, s10, ":town"),
        (party_get_slot, reg10, ":town", slot_center_caravan_visits),
        (party_get_slot, reg11, ":town", slot_center_trader_visits),
        (store_add, reg12, reg11, reg10),
        (str_store_string, s0, "@{s0}^{s10}: caravans: {reg10}, traders: {reg11}. Total: {reg12}"),
    (try_end),
  ],[
  ("continue",[],"Go back.",[
    (jump_to_menu, "mnu_dplmc_economic_report"),
  ]),
]),

  ##Economic report, currently just for debugging purposes
("dplmc_economic_report",0,
  "Events:^^Number of consumption outbreaks: {reg50}^Number of slow fever outbreaks: {reg51}^Number of camp fever outbreaks: {reg52}^\
  Number of measles outbreaks: {reg53}^Number of plague outbreaks: {reg54}^Number of smallpox outbreaks: {reg55}^\
  Number of greatpox outbreaks: {reg56}^Number of fire event: {reg57}^Number of drought event: {reg58}^\
  Number of earthquake events: {reg59}^Number of Beetle invasions: {reg60}^\
  Number of good harvests: {reg49}^Number of bad harvests: {reg48}^\
  Number of mild winters: {reg47}^Number of harsh winters: {reg46}^^\
  Richest lord in the world: {s33} (wealth: {reg33} denars)^Poorest lord in the world: {s34} (wealth: {reg34})^^{s0}",
  "none",[
    (troop_get_slot, reg46, "trp_global_variables", g_number_harsh_winters),
    (troop_get_slot, reg47, "trp_global_variables", g_number_mild_winters),
    (troop_get_slot, reg48, "trp_global_variables", g_number_poor_harvest),
    (troop_get_slot, reg49, "trp_global_variables", g_number_good_harvest),
    (troop_get_slot, reg50, "trp_global_variables", g_number_consumption),
    (troop_get_slot, reg51, "trp_global_variables", g_number_slow_fever),
    (troop_get_slot, reg52, "trp_global_variables", g_number_camp_fever),
    (troop_get_slot, reg53, "trp_global_variables", g_number_measles),
    (troop_get_slot, reg54, "trp_global_variables", g_number_plague),
    (troop_get_slot, reg55, "trp_global_variables", g_number_smallpox),
    (troop_get_slot, reg56, "trp_global_variables", g_number_greatpox),
    (troop_get_slot, reg57, "trp_global_variables", g_number_fire),
    (troop_get_slot, reg58, "trp_global_variables", g_number_drought),
    (troop_get_slot, reg59, "trp_global_variables", g_number_earthquake),
    (troop_get_slot, reg60, "trp_global_variables", g_number_insects),

    (assign, ":score_rich", 1000),
    (assign, ":rich", 0),
    (assign, ":poor", 0),
    (assign, ":score_poor", 50000),
    (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
      (troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_hero),
      (troop_get_slot, ":w", ":npc", slot_troop_wealth),
      (try_begin),
        (gt, ":w", ":score_rich"),
        (assign, ":rich", ":npc"),
        (assign, ":score_rich", ":w"),
      (try_end),
      (try_begin),
        (lt, ":w", ":score_poor"),
        (assign, ":poor", ":npc"),
        (assign, ":score_poor", ":w"),
      (try_end),
    (try_end),
    (try_begin),
      (gt, ":rich", 0),
      (str_store_troop_name, s33, ":rich"),
      (assign, reg33, ":score_rich"),
    (else_try),
      (str_store_string, s33, "@none"),
      (assign, reg33, 0),
    (try_end),
    (try_begin),
      (gt, ":poor", 0),
      (str_store_troop_name, s34, ":poor"),
      (assign, reg34, ":score_poor"),
    (else_try),
      (str_store_string, s34, "@none"),
      (assign, reg34, 0),
    (try_end),

    (str_clear, s0),
    (str_clear, s1),
    (assign, reg0, 0),
    (str_store_string, s0, "@Prosperity Report^"),

    #Show average prosperity for each faction
    (try_for_range, ":faction", 0, kingdoms_end),
        (this_or_next|eq, ":faction", 0),
        (is_between, ":faction", kingdoms_begin, kingdoms_end),

        (this_or_next|eq, ":faction", 0),
        (faction_slot_eq, ":faction", slot_faction_state, sfs_active),

        (try_begin),
            (eq, ":faction", 0),
            (str_store_string, s1, "@Total"),
        (else_try),
            (faction_get_slot, reg0, ":faction", slot_faction_adjective),
            (gt, reg0, 0),
            (str_store_string, s1, reg0),
        (else_try),
            (str_store_faction_name, s1, ":faction"),
        (try_end),

        ##(1) Faction Prosperity, towns
        (assign, ":sum", 0),
        (assign, ":q_5", 0),
        (assign, ":q_4", 0),
        (assign, ":q_3", 0),
        (assign, ":q_2", 0),
        (assign, ":q_1", 0),
        (assign, ":num", 0),

        (try_for_range, ":center_no", towns_begin, towns_end),
            (store_faction_of_party, reg0, ":center_no"),
            (this_or_next|eq, ":faction", 0),
            (eq, reg0, ":faction"),
            (val_add, ":num", 1),
            (party_get_slot, reg0, ":center_no", slot_town_prosperity),
            (val_add, ":sum", reg0),
            (try_begin),
              (lt, reg0, 20),
              (val_add, ":q_1", 1),
            (else_try),
              (lt, reg0, 40),
              (val_add, ":q_2", 1),
            (else_try),
              (lt, reg0, 60),
              (val_add, ":q_3", 1),
            (else_try),
              (lt, reg0, 80),
              (val_add, ":q_4", 1),
            (else_try),
              (val_add, ":q_5", 1),
            (try_end),
        (try_end),

        (assign, reg0, ":num"),
        (val_max, reg0, 1),
        (store_div, reg0, ":sum", reg0),
        (str_store_string, s0, "@{s0}^{s1} Average Town Prosperity: {reg0}"),
        (assign, reg0, ":q_5"),
        (try_begin),
            (this_or_next|eq, ":faction", 0),
            (gt, reg0, 0),
            (str_store_string, s0, "@{s0}^{s1} towns with prosperity 80-100: {reg0}"),
        (try_end),
        (assign, reg0, ":q_4"),
        (try_begin),
            (this_or_next|eq, ":faction", 0),
            (gt, reg0, 0),
            (str_store_string, s0, "@{s0}^{s1} towns with prosperity 60-79: {reg0}"),
        (try_end),
        (assign, reg0, ":q_3"),
        (try_begin),
            (this_or_next|eq, ":faction", 0),
            (gt, reg0, 0),
            (str_store_string, s0, "@{s0}^{s1} towns with prosperity 40-59: {reg0}"),
        (try_end),
        (assign, reg0, ":q_2"),
        (try_begin),
            (this_or_next|eq, ":faction", 0),
            (gt, reg0, 0),
            (str_store_string, s0, "@{s0}^{s1} towns with prosperity 20-39: {reg0}"),
        (try_end),
        (assign, reg0, ":q_1"),
        (try_begin),
            (this_or_next|eq, ":faction", 0),
            (gt, reg0, 0),
            (str_store_string, s0, "@{s0}^{s1} towns with prosperity 0-19: {reg0}"),
        (try_end),

        (str_store_string, s0, "@{!}{s0}^"),

        ##(2) Faction Prosperity, villages
        (assign, ":sum", 0),
        (assign, ":q_5", 0),
        (assign, ":q_4", 0),
        (assign, ":q_3", 0),
        (assign, ":q_2", 0),
        (assign, ":q_1", 0),
        (assign, ":num", 0),

        (try_for_range, ":center_no", villages_begin, villages_end),
            (store_faction_of_party, reg0, ":center_no"),
            (this_or_next|eq, ":faction", 0),
            (eq, reg0, ":faction"),
            (val_add, ":num", 1),
            (party_get_slot, reg0, ":center_no", slot_town_prosperity),
            (val_add, ":sum", reg0),
            (try_begin),
              (lt, reg0, 20),
              (val_add, ":q_1", 1),
            (else_try),
              (lt, reg0, 40),
              (val_add, ":q_2", 1),
            (else_try),
              (lt, reg0, 60),
              (val_add, ":q_3", 1),
            (else_try),
              (lt, reg0, 80),
              (val_add, ":q_4", 1),
            (else_try),
              (val_add, ":q_5", 1),
            (try_end),
        (try_end),

        (assign, reg0, ":num"),
        (val_max, reg0, 1),
        (store_div, reg0, ":sum", reg0),
        (str_store_string, s0, "@{s0}^{s1} Average Village Prosperity: {reg0}"),
        (try_begin),
            (this_or_next|eq, ":faction", 0),
            (gt, ":q_5", 0),
            (assign, reg0, ":q_5"),
            (str_store_string, s0, "@{s0}^{s1} villages with prosperity 80-100: {reg0}"),
        (try_end),
        (try_begin),
            (this_or_next|eq, ":faction", 0),
            (gt, ":q_4", 0),
            (assign, reg0, ":q_4"),
            (str_store_string, s0, "@{s0}^{s1} villages with prosperity 60-79: {reg0}"),
        (try_end),
        (try_begin),
            (this_or_next|eq, ":faction", 0),
            (gt, ":q_3", 0),
            (assign, reg0, ":q_3"),
            (str_store_string, s0, "@{s0}^{s1} villages with prosperity 40-59: {reg0}"),
        (try_end),
        (try_begin),
            (this_or_next|eq, ":faction", 0),
            (gt, ":q_2", 0),
            (assign, reg0, ":q_2"),
            (str_store_string, s0, "@{s0}^{s1} villages with prosperity 20-39: {reg0}"),
        (try_end),
        (try_begin),
            (this_or_next|eq, ":faction", 0),
            (gt, ":q_1", 0),
            (assign, reg0, ":q_1"),
            (str_store_string, s0, "@{s0}^{s1} villages with prosperity 0-19: {reg0}"),
        (try_end),
        (str_store_string, s0, "@{!}{s0}^"),
    (try_end),
    (assign, reg4, "$newglob_total_prosperity_from_bandits"),
    (assign, reg5, "$newglob_total_prosperity_from_caravan_trade"),
    (assign, reg7, "$newglob_total_prosperity_from_villageloot"),
    (assign, reg8, "$newglob_total_prosperity_from_townloot"),
    (assign, reg9, "$newglob_total_prosperity_from_village_trade"),
    (assign, reg10, "$newglob_total_prosperity_from_convergence"),
    (assign, reg11, "$newglob_total_prosperity_losses"),
    (assign, reg12, "$newglob_total_prosperity_gains"),
    (display_message, "@Total prosperity actual losses: {reg11}"),
    (display_message, "@Total prosperity actual gains: {reg12}"),

    (display_message, "@Prosperity changes from random bandits: {reg4}"),
    (display_message, "@Prosperity changes from caravan trades: {reg5}"),
    (display_message, "@Prosperity changes from farmer trades: {reg9}"),
    (display_message, "@Prosperity changes from looted villages: {reg7}"),
    (display_message, "@Prosperity changes from sieges: {reg8}"),
    (display_message, "@Theoretical prosperity changes from convergence: {reg10}"),
  ],[
  ("dplmc_back",[],"Show trade report.",[
    (jump_to_menu, "mnu_trade_report"),
  ]),
  ("dplmc_back",[],"Continue...",[
    (jump_to_menu, "mnu_reports"),
  ]),
]),
##diplomacy end+

#SB : secondary cheat menu

("town_cheats",0,
    "Select an option to interact with troops here",
    "none",[(call_script, "script_set_town_picture"),],
    [
      ("page",
      [],
      "Next Page.",
      [
        (jump_to_menu, "mnu_town_cheats_2"),
      ]),

      ("debug",
      [
      (party_get_slot, ":lord", "$current_town", slot_town_lord),
      (ge, ":lord", 0),
      (store_faction_of_troop, ":fac_lord", ":lord"),
      (store_faction_of_party, ":fac_party", "$current_town"),
      (neq, ":fac_lord", ":fac_party"),
      ],
      "Set town faction to the faction of the lord owning it.",
      [
      (party_get_slot, ":lord", "$current_town", slot_town_lord),
      (store_faction_of_troop, ":fac_lord", ":lord"),
      (party_set_faction, "$current_town", ":fac_lord"),
      ]),
      ("debug",
      [(troop_slot_eq, "trp_global_variables", g_is_dev, 1),],
      "Party Cheats.",
      [
        (jump_to_menu, "mnu_party_cheat"),
      ]),
      ("host_tournament",
      [(party_slot_eq, "$current_town", slot_party_type, spt_town),],
      "Host a tournament",
      [
           (call_script, "script_fill_tournament_participants_troop", "$current_town", 1),
           (assign, "$g_tournament_cur_tier", 0),
           (assign, "$g_tournament_player_team_won", -1),
           (assign, "$g_tournament_bet_placed", 0),
           (assign, "$g_tournament_bet_win_amount", 0),
           (assign, "$g_tournament_last_bet_tier", -1),
           (assign, "$g_tournament_next_num_teams", 0),
           (assign, "$g_tournament_next_team_size", 0),
           (jump_to_menu, "mnu_town_tournament"),
      ]),

      ("camp_cheat_gather",[(party_slot_eq, "$current_town", slot_party_type, spt_town),
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
      ],"Gather all inactive NPCs.",
       [ (assign, "$npc_to_rejoin_party", -1),
         (try_for_range, ":troop_no", companions_begin, companions_end),
           (neg|main_party_has_troop, ":troop_no"),
           (troop_slot_eq, ":troop_no", slot_troop_days_on_mission, 0),
           (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_inactive),
            # (neg|troop_slot_ge, ":troop_no", slot_troop_prisoner_of_party, 0),
           (troop_set_slot, ":troop_no", slot_troop_cur_center, "$current_town"),
           (troop_set_slot, ":troop_no", slot_troop_turned_down_twice, 0),
         (try_end),
         # (jump_to_menu, "mnu_camp_cheat"),
        ]
        ),

      # ("camp_cheat_gather",[(party_slot_eq, "$current_town", slot_party_type, spt_town),],"Gather all NPCs not in main party (cancel missions).",
       # [ (assign, "$npc_to_rejoin_party", -1),
         # (try_for_range, ":troop_no", companions_begin, companions_end),
            # (neg|main_party_has_troop, ":troop_no"),
            # (call_script, "script_remove_troop_from_prison", ":troop_no"),
            # (try_for_range, ":slots", slot_troop_days_on_mission, slot_troop_recruit_price),
              # (troop_set_slot, ":troop_no", ":slots", 0),
            # (try_end),
            # (troop_set_slot, ":troop_no", slot_troop_cur_center, "$current_town"),
         # (try_end),
        # ]
        # ),

      ("summon_drunk",
      [(party_slot_eq, "$current_town", slot_party_type, spt_town),
       # (troop_get_slot, ":town", "trp_belligerent_drunk", slot_troop_cur_center),
       (try_begin),
         # (is_between, ":town", towns_begin, towns_end),
         (troop_slot_eq, "trp_belligerent_drunk", slot_troop_cur_center, "$current_town"),
         (assign, reg10, 1),
       (else_try),
         (assign, reg10, 0),
       (try_end),
       ],
      "{reg10?Dismiss:Get} a drunkard.",
      [
        (try_begin),
          (eq, reg10, 1),
          (troop_set_slot, "trp_belligerent_drunk", slot_troop_cur_center, -1),
        (else_try),
          (troop_set_slot, "trp_belligerent_drunk", slot_troop_cur_center, "$current_town"),
        (try_end),
      ]),

      ("summon_ass",
      [(party_slot_eq, "$current_town", slot_party_type, spt_town),
       (try_begin),
         # (is_between, ":town", towns_begin, towns_end),
         (troop_slot_eq, "trp_hired_assassin", slot_troop_cur_center, "$current_town"),
         (assign, reg11, 1),
       (else_try),
         (assign, reg11, 0),
       (try_end),
      ],
      "{reg11?Scare away:Hire} an assassin.",
      [
        (try_begin),
          (eq, reg11, 1),
          (troop_set_slot, "trp_hired_assassin", slot_troop_cur_center, -1),
        (else_try),
          (troop_set_slot, "trp_hired_assassin", slot_troop_cur_center, "$current_town"),
        (try_end),
      ]),

      ("summon_bandit",
      [
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
       (neg|party_slot_eq, "$current_town", slot_party_type, spt_castle),
       (party_get_slot, reg12, "$current_town", slot_center_has_bandits),
       # (try_begin),
         # (party_slot_ge, "$current_town", slot_center_has_bandits, 1),
         # (assign, reg12, 1),
       # (else_try),
         # (assign, reg12, 0),
       # (try_end).
       (try_begin), #none present
         (eq, reg12, 0),
         (str_store_string, s12, "str_bandits"),
       (else_try),
         (str_store_troop_name_plural, s12, reg12),
       (try_end),
      ],
      "{reg12?Kick out:Get ambushed by} some {s12}.",
      [
       (try_begin), #cleanse
         (party_slot_ge, "$current_town", slot_center_has_bandits, 1),
         (party_set_slot, "$current_town", slot_center_has_bandits, 0),
       (else_try), #ambush
         (store_random_in_range, ":bandit", bandits_begin, bandits_end),
         (party_set_slot, "$current_town", slot_center_has_bandits, ":bandit"),
       (try_end),
      ]),

      ("summon_village_bandit",[
        (party_slot_eq, "$current_town", slot_party_type, spt_village),
        (party_get_slot, reg13, "$current_town", slot_village_infested_by_bandits),
        (try_begin),
          (le, reg13, 0),
          (str_store_troop_name_plural, s13, "trp_bandit"),
        (else_try),
          (str_store_troop_name_plural, s13, reg13),
        (try_end),
      ],"{reg13?Cleanse:Infest} the village {reg13?of:with} {s13}.",[
        (try_begin), #cleanse
          (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
          (party_set_slot, "$current_town", slot_village_infested_by_bandits, 0),
        (else_try), #infest
          (call_script, "script_center_get_bandits", "$current_town", 0),
          (party_set_slot, "$current_town", slot_village_infested_by_bandits, reg0),
          (jump_to_menu, "mnu_village"),
        (try_end),
      ]),

      ("summon_insurgent",
      [ (party_slot_eq, "$current_town", slot_village_infested_by_bandits, 0),
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
      ],
      "Spearhead a peasant revolution.",
      [
        (party_set_slot, "$current_town", slot_village_infested_by_bandits, "trp_peasant_woman"),

        #add additional troops
        (store_character_level, ":player_level", "trp_player"),
        (store_div, ":player_leveld2", ":player_level", 2),
        (store_mul, ":player_levelx2", ":player_level", 2),
        (try_begin),
          (is_between, "$current_town", villages_begin, villages_end),
          (store_random_in_range, ":random",0, ":player_level"),
          (party_add_members, "$current_town", "trp_mercenary_swordsman", ":random"),
          (store_random_in_range, ":random", 0, ":player_leveld2"),
          (party_add_members, "$current_town", "trp_hired_blade", ":random"),
        (else_try),
          (party_set_banner_icon, "$current_town", 0),
          (party_get_num_companion_stacks, ":num_stacks","$current_town"),
          (try_for_range, ":i_stack", 0, ":num_stacks"),
            (party_stack_get_size, ":stack_size","$current_town",":i_stack"),
            (val_div, ":stack_size", 2),
            (party_stack_get_troop_id, ":troop_id", "$current_town", ":i_stack"),
            (party_remove_members, "$current_town", ":troop_id", ":stack_size"),
          (try_end),
          (store_random_in_range, ":random",":player_leveld2", ":player_levelx2"),
          (party_add_members, "$current_town", "trp_watchman", ":random"),
          (store_random_in_range, ":random",0, ":player_level"),
          (party_add_members, "$current_town", "trp_mercenary_crossbowman", ":random"),
        (try_end),
      ]),

      ("center_refresh",
      [(party_slot_eq, "$current_town", slot_party_type, spt_town),],
      "Refresh merchants (global).",
      [
        # (party_get_slot, g.selected_troop,"$current_town", slot_town_weaponsmith),
        (call_script, "script_refresh_center_weaponsmiths"),
        # (party_get_slot, g.selected_troop,"$current_town", slot_town_armorer),
        (call_script, "script_refresh_center_armories"),
        # (party_get_slot, g.selected_troop,"$current_town", slot_town_horse_merchant),
        (call_script, "script_refresh_center_stables"),
        # (party_get_slot, g.selected_troop,"$current_town", slot_town_merchant),
        (call_script, "script_refresh_center_inventories"),
        # (assign, g.selected_troop, -1),
      ]),

      ("village_refresh",
      [(party_slot_eq, "$current_town", slot_party_type, spt_village),],
      "Refresh village goods.",
      [
        (call_script, "script_refresh_village_merchant_inventory", "$current_town"),
      ]),

      ("village_recruits",
      [(party_slot_eq, "$current_town", slot_party_type, spt_village),],
      "Refresh recruits.",
      [
        (call_script, "script_update_volunteer_troops_in_village", "$current_town"),
      ]),
      ("center_recruits",
      [(party_slot_eq, "$current_town", slot_party_type, spt_town),],
      "Refresh mercenaries.",
      [
        (call_script, "script_update_mercenary_units_of_towns"),
      ]),

      ("go_back",
      [(neg|party_slot_eq,"$current_town",slot_party_type, spt_village),],
      "Go Back.",
      [
        (jump_to_menu,"mnu_town"),
      ]),

      ("continue",
      [(party_slot_eq,"$current_town",slot_party_type, spt_village),],
      "Continue.",
      [
        (jump_to_menu,"mnu_village"),
      ]),
    ]),

(
  "town_cheats_2",0,
  "Select an option to interact with the center itself. Prosperity is {reg1}, Relation is {reg2}, there are {reg3} parties in town.",
  "none",[
      (call_script, "script_set_town_picture"),
      (party_get_slot, reg1, "$current_town", slot_town_prosperity),
      (party_get_slot, reg2, "$current_town", slot_center_player_relation),

      (assign, ":count", 0),
      (try_for_parties, ":party_no"),
        (party_is_active, ":party_no"),
        (party_is_in_town, ":party_no", "$current_town"),
        (val_add, ":count", 1),
      (try_end),
      (assign, reg3, ":count"),
    ],
    [
        ("page",
        [],
        "Previous Page.",
        [
          (jump_to_menu, "mnu_town_cheats"),
        ]),

        ("toggle_state",
        [(party_slot_eq, "$current_town", slot_party_type, spt_village),
          (party_get_slot, reg1, "$current_town", slot_village_state),
          (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
          ],
        "{reg1?Restore:Raze} this village.",
        [
          (try_begin),
            (party_slot_eq, "$current_town", slot_village_state, svs_normal),
            (call_script, "script_village_set_state", "$current_town", svs_looted),
          (else_try),
            (call_script, "script_village_set_state", "$current_town", svs_normal),
          (try_end),
        ]),

        ("village_manage",
        [(troop_slot_eq, "trp_global_variables", g_is_dev, 1),], "Manage this center.",
        [
          (assign, "$g_next_menu", "mnu_town_cheats_2"),
          (assign, reg63, 1),
          (jump_to_menu, "mnu_center_manage_2"),
        ]),
        ("increase_rel",
        [],
        "Increase Relation.",
        [
          (try_begin),
            (this_or_next|key_is_down, key_left_shift),
            (key_is_down, key_right_shift),
            (call_script, "script_change_player_relation_with_center", "$current_town", 1),
          (else_try),
            (call_script, "script_change_player_relation_with_center", "$current_town", 5),
          (try_end),
        ]),

        ("decrease_rel",
        [],
        "Decrease Relation.",
        [
          (try_begin),
            (this_or_next|key_is_down, key_left_shift),
            (key_is_down, key_right_shift),
            (call_script, "script_change_player_relation_with_center", "$current_town", -1),
          (else_try),
            (call_script, "script_change_player_relation_with_center", "$current_town", -5),
          (try_end),
        ]),

        ("increase_prosp",
        [],
        "Increase Prosperity.",
        [
          (try_begin),
            (this_or_next|key_is_down, key_left_shift),
            (key_is_down, key_right_shift),
            (call_script, "script_change_center_prosperity", "$current_town", 1),
          (else_try),
            (call_script, "script_change_center_prosperity", "$current_town", 5),
          (try_end),
        ]),

        ("decrease_prosp",
        [],
        "Decrease Prosperity.",
        [
          (try_begin),
            (this_or_next|key_is_down, key_left_shift),
            (key_is_down, key_right_shift),
            (call_script, "script_change_center_prosperity", "$current_town", -1),
          (else_try),
            (call_script, "script_change_center_prosperity", "$current_town", -5),
          (try_end),
        ]),

        ("castle_cheat_interior",
        [(neg|party_slot_eq, "$current_town", slot_party_type, spt_village),
        (troop_slot_eq, "trp_global_variables", g_is_dev, 1),],
        "{!}Interior.",
        [
          (set_jump_mission,"mt_ai_training"),
          (party_get_slot, ":castle_scene", "$current_town", slot_town_castle),
          (jump_to_scene,":castle_scene"),
          (change_screen_mission),
        ]),

        ("castle_cheat_town_exterior",
        [(troop_slot_eq, "trp_global_variables", g_is_dev, 1),],
        "{!}Exterior.",
        [
          # (try_begin),
            # (party_slot_eq, "$current_town",slot_party_type, spt_castle),
            # (party_get_slot, ":scene", "$current_town", slot_castle_exterior),
          # (else_try),
            # (party_get_slot, ":scene", "$current_town", slot_town_center),
          # (try_end),
          (party_get_slot, ":scene", "$current_town", slot_town_center),
          (set_jump_mission,"mt_ai_training"),
          (jump_to_scene,":scene"),
          (change_screen_mission),
        ]),

        ("castle_cheat_dungeon",
        [(neg|party_slot_eq, "$current_town", slot_party_type, spt_village),
        (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
        ],
        "{!}Prison.",
        [
          (set_jump_mission,"mt_ai_training"),
          (party_get_slot, ":castle_scene", "$current_town", slot_town_prison),
          (jump_to_scene,":castle_scene"),
          (change_screen_mission),
        ]),

        ("castle_cheat_town_walls",
        [
          (party_slot_eq,"$current_town",slot_party_type, spt_town),
          (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
        ],
        "{!}Town Walls.",
        [
          (party_get_slot, ":scene", "$current_town", slot_town_walls),
          (set_jump_mission,"mt_ai_training"),
          (jump_to_scene,":scene"),
          (change_screen_mission),
        ]),

        ("cheat_town_start_siege",
        [ (neg|party_slot_eq, "$current_town", slot_party_type, spt_village),
          (party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
          (lt, "$g_encountered_party_2", 1),
          # (call_script, "script_party_count_fit_for_battle","p_main_party"),
          # (gt, reg(0), 1),
          # (try_begin),
            # (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
            # (assign, reg6, 1),
          # (else_try),
            # (assign, reg6, 0),
          # (try_end),
          (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
        ],
        "Besiege the center...",
        [
              #siege warfare chief We repit this here for advoid issues.
        (assign, "$g_empieza_asedio", 1), #variable to begin siege
        (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
        (party_set_slot,"$g_encountered_party",slot_center_blockaded_time,0),
        (party_set_slot, "$g_encountered_party", slot_center_mantlets_placed, 0),
        (party_set_slot,"$g_encountered_party",slot_center_ladder_time,0),
        (party_set_slot,"$g_encountered_party",slot_center_latrines,0),
        (party_set_slot,"$g_encountered_party",slot_center_infiltration_type,0),
        (assign, "$g_siege_saneamiento", 0),
        (assign, "$g_traicion_interna", 0),
        (assign, "$g_infiltracion_interna", 0),
        (assign, "$g_campos_cercanos", 0),
        (assign, "$g_listos_para_asalto", 0),
        (assign, "$g_mantlets_1", 0),
        (assign, "$g_cabezas_dentro", 0), #event
        (assign, "$g_siege_method", 0),
        (assign, "$g_siege_sallied_out_once", 0),
        (assign, "$g_days_spent_starving", 0), #siege warfare, important, we use this in dialogs
        (assign, "$g_next_sally_at", 0), #sally more common siege warfare chief
        #siege warfare acaba
        (assign,"$g_player_besiege_town","$g_encountered_party"),
        (jump_to_menu, "mnu_castle_besiege"),
        ]),

        ("center_reports",
        [],
        "Show reports.",
        [
          (jump_to_menu,"mnu_center_reports"),
        ]),

        # ("sail_from_port",
        # [
          # (party_slot_eq,"$current_town",slot_party_type, spt_town),
          # (party_get_position, pos1, "$current_town"),
          # (map_get_water_position_around_position, pos2, pos1, 6),
          # (get_distance_between_positions, ":dist", pos1, pos2),
          # (lt, ":dist", 6),
          # # (party_set_position, "p_main_party", pos2),
          # (ge, "$cheat_mode", 1),
          # #(party_slot_eq,"$current_town",slot_town_near_shore, 1),
        # ],
        # "{!}Sail from port.",
        # [
          # (assign, "$g_player_icon_state", pis_ship),
          # (party_set_flags, "p_main_party", pf_is_ship, 1),
          # # (party_get_position, pos1, "p_main_party"),
          # # (map_get_water_position_around_position, pos2, pos1, 6),
          # (party_set_position, "p_main_party", pos2),

          # (change_screen_return),
        # ]),

        ("go_back",
        [(neg|party_slot_eq,"$current_town",slot_party_type, spt_village),],
        "Go Back.",
        [
          (jump_to_menu,"mnu_town"),
        ]),

        ("continue",
        [(party_slot_eq,"$current_town",slot_party_type, spt_village),],
        "Continue.",
        [
          (jump_to_menu,"mnu_village"),
        ]),
  ]
),

#rename_court to set a capital
("rename_court",0,
  "{!}This menu jumps to the rename presentation. If you see it destroy your PC.",
  "none",[
  # (call_script, "script_change_player_right_to_rule", 1), #handled in dialogues
  # (assign, reg0, "$temp"),
  # (display_message, "@{reg0}"),
  (try_begin),
      #(eq, "$temp", 1), #avoid menus getting stuck
      (jump_to_menu, "mnu_auto_return_map"),
  (try_end),
  (assign, "$g_presentation_state", rename_center),
  (call_script, "script_add_log_entry", logent_player_renamed_capital, "trp_player", "$g_player_court", -1, -1),
  (assign, "$temp", 1),
  (start_presentation, "prsnt_name_kingdom"),
],[]),

 #export/import from prsnt_companion_overview
("export_import", mnf_enable_hot_keys,
  "Press C to access {s1}'s character screen and then the statistics button on the bottom left. This allows you to export a characters stats/skills, then modify them and then reimport them.",
  "none",[
    (set_background_mesh, "mesh_pic_mb_warrior_1"),
    (set_player_troop, "$temp_troop"),
    (str_store_troop_name_plural, s1, "$temp_troop"),
  ],[
    ("rename",[],"Rename the companion.",[
      (assign, "$g_presentation_state", rename_companion),
      (start_presentation, "prsnt_name_kingdom"),
    ]),

    ("display_slots",[
      (ge, "$cheat_mode", 1)
    ], "Show me all your secrets...",[
      (assign, "$g_talk_troop", "$temp_troop"),
      (jump_to_menu, "mnu_display_troop_slots"),
    ]),
    ("continue",[],"Go back.",[
      (set_player_troop, "trp_player"),
      (start_presentation, "prsnt_companion_overview"),
    ]),
]),

  ( #helper menu to show all slots
    "display_faction_slots", menu_text_color(0xFF990000),
    "{s1}",
    "none",
    [
    (str_store_faction_name, s1, "$diplomacy_var"),
    (try_for_range, reg1, 0, 1000),
      (faction_get_slot, reg0, "$diplomacy_var", reg1),
      (neq, reg0, 0), #if there's a value in here
      (str_store_string, s1, "@{s1}^{reg1}: {reg0}"),
    (try_end),

    ],
    [

      ("notes",
      [(is_between, "$diplomacy_var", kingdoms_begin, kingdoms_end),],
      "View Notes.",
      [
        (change_screen_notes, 2, "$diplomacy_var"),
      ]),
      ("previous",
      [

      ],
      "Previous Faction.",
      [
        (val_sub, "$diplomacy_var", 1),
        (val_clamp, "$diplomacy_var", 0, 52),
        (jump_to_menu, "mnu_display_faction_slots"),
      ]),

      ("next",
      [

      ],
      "Next Faction.",
      [
        (val_add, "$diplomacy_var", 1),
        (val_clamp, "$diplomacy_var", 0, 52),
        (jump_to_menu, "mnu_display_faction_slots"),
      ]),

      ("continue",
      [],
      "Continue.",
      [
      (change_screen_map),
      ]),
    ]
  ),

  ( #helper menu to show all slots
    "display_party_slots", menu_text_color(0xFF990000),
    "{s1}",
    "none",
    [
    (set_background_mesh, "mesh_pic_messenger"),
    (str_store_party_name, s1, "$g_encountered_party"),
    (assign, reg1, "$g_encountered_party"),
    (assign, "$pout_party", 0),
    (try_for_parties, ":party_no"),
      # (assign, "$pout_party", ":party_no"),
      (party_is_active, ":party_no"),
      (gt, ":party_no", "$pout_party"),
      (assign, "$pout_party", ":party_no"),
    (try_end),
    (assign, reg2, "$pout_party"),
    (str_store_string, s1, "@{reg1}/{reg2}: {s1}"),
    #There's probably too many slots (and conflicting ones) to actually output the slot names to string
    (try_for_range, reg1, 0, 1000), #slot_town_trade_good_productions_begin
      (party_get_slot, reg0, "$g_encountered_party", reg1),
      (neq, reg0, 0), #if there's a value in here
      (str_store_string, s1, "@{s1}^{reg1}: {reg0}"),
    (try_end),

    # Process the prev and next parties
    # (assign, "$diplomacy_var",  "$g_encountered_party"),
    # (assign, "$diplomacy_var2", "$g_encountered_party"),
    # (try_for_parties, ":party_no"),
      # (party_is_active, ":party_no"),
      # (eq, "$diplomacy_var2", "$g_encountered_party"),
      # (try_begin), #find last party before current one
        # (lt, ":party_no", "$g_encountered_party"),
        # (assign, "$diplomacy_var", ":party_no"),
      # (else_try), #find first party after current one
        # (gt, ":party_no", "$g_encountered_party"),
        # (assign, "$diplomacy_var2", ":party_no"),
      # (try_end),
    # (try_end),
    (store_sub, "$diplomacy_var",  "$g_encountered_party", 1),
    (store_add, "$diplomacy_var2", "$g_encountered_party", 1),
    (try_begin), #find first
      (neg|party_is_active, "$diplomacy_var"),
      (assign, "$diplomacy_var", 0),
      (assign, ":end", "$g_encountered_party"),
      (try_for_range_backwards, ":party_no", 0, ":end"),
        (party_is_active, ":party_no"),
        (lt, ":party_no", "$g_encountered_party"),
        (gt, ":party_no", "$diplomacy_var"),
        (assign, "$diplomacy_var", ":party_no"),
        (assign, ":end", 0),
      (try_end),
    (try_end),
    # (val_max, "$diplomacy_var", "p_main_party"), #lock as first party

    (try_begin), #look for next
      (neg|party_is_active, "$diplomacy_var2"),
      (assign, "$diplomacy_var2", "$pout_party"), #this was previous checked as highest party
      (assign, ":end", "$pout_party"),
      (try_for_range, ":party_no", "$g_encountered_party", ":end"),
        (party_is_active, ":party_no"),
        (gt, ":party_no", "$g_encountered_party"),
        (le, ":party_no", "$diplomacy_var2"),
        (assign, "$diplomacy_var2", ":party_no"),
        (assign, ":end", "$g_encountered_party"),
      (try_end),
    (try_end),

    ],
    [

      ("notes",
      [(is_between, "$g_encountered_party", centers_begin, centers_end),],
      "View Notes.",
      [
        (change_screen_notes, 3, "$g_encountered_party"),
      ]),
      ("previous",
      [
        (ge, "$diplomacy_var", "p_main_party"),
        (lt, "$diplomacy_var", "$g_encountered_party"),
        (party_is_active, "$diplomacy_var"),
        (str_store_party_name, s2, "$diplomacy_var"),
      ],
      "Previous Party ({s2}).",
      [
        # (jump_to_menu, "mnu_party_cheat"),
        (assign, "$g_encountered_party", "$diplomacy_var"),
      ]),

      ("next",
      [
        (le, "$diplomacy_var2", "$pout_party"),
        (gt, "$diplomacy_var2", "$g_encountered_party"),
        (party_is_active, "$diplomacy_var2"),
        (str_store_party_name, s2, "$diplomacy_var2"),
      ],
      "Next Party ({s2}).",
      [
        (assign, "$g_encountered_party", "$diplomacy_var2"),
      ]),

      ("change",
      [],
      "Modify slots.",
      [
        (assign, "$g_presentation_state", 0), #start off at first slot
        (assign, "$g_presentation_input", rename_center),
        (start_presentation, "prsnt_modify_slots"),
      ]),

      ("continue",
      [],
      "Continue.",
      [
        # (jump_to_menu, "mnu_party_cheat"),
        (assign, "$new_encounter", 2),
        (set_encountered_party, "$g_encountered_party"),
        (call_script, "script_game_event_party_encounter", "$g_encountered_party", -1),
        # (change_screen_map),
        # (start_encounter, "$g_encountered_party"),
      ]),
    ]
  ),
  ( #exchange cheat from cmenu_encounter
    "party_cheat",0,
    "{!}{s10} is a {reg10?holding:member} of {s11} with relation {reg11}{reg6? (player relation {reg6}):} at ({reg8},{reg9}) {reg7} km away.^\
 It has {reg12}/{reg13} soldiers {reg13?in {reg14} stacks:}{reg15? and {reg15} prisoners in {reg16} stacks:{reg17? and {reg17} attached parties:}.^\
 AI Behaviour is {s13}{reg18? (currently {s14}):}, Object is {s15}{reg19? (currently {s16}):} at ({reg20},{reg21})",
    "none",
    [
    (assign, reg44, "$g_encountered_party"),
    (display_message, "@Party id: {reg44}"),
    (assign, "$new_encounter", 0), #this undoes the cheat toggle global immediately
    (set_fixed_point_multiplier, 1000),
    #basic world info first line
    (str_store_party_name, s10, "$g_encountered_party"),
    (str_store_faction_name, s11, "$g_encountered_party_faction"),
    (try_begin),
      (this_or_next|is_between, "$g_encountered_party", centers_begin, centers_end),
      (is_between, "$g_encountered_party", training_grounds_begin, training_grounds_end),
      (assign, reg10, 1),
      (party_get_slot, reg6, "$g_encountered_party", slot_center_player_relation),
    (else_try),
      (assign, reg10, 0),
      (try_begin),
        (party_stack_get_troop_id, ":leader_troop", "$g_encountered_party", 0),
        (troop_is_hero, ":leader_troop"),
        (call_script, "script_troop_get_relation_with_troop", ":leader_troop", "trp_player"),
        (assign, reg6, reg0),
      (try_end),
    (try_end),
    (party_get_position, pos1, "$g_encountered_party"),
    (position_get_x, reg8, pos1),
    (position_get_y, reg9, pos1),
    (assign, reg11, "$g_encountered_party_relation"),
    (store_distance_to_party_from_party, reg7, "$g_encountered_party", "p_main_party"),

    #party composition second line
    (call_script, "script_party_count_fit_for_battle", "$g_encountered_party"),
    (assign, reg12, reg0),
    (party_get_num_companions, reg13, "$g_encountered_party"),
    (party_get_num_companion_stacks, reg14, "$g_encountered_party"),
    (party_get_num_prisoners, reg15, "$g_encountered_party"),
    (party_get_num_prisoner_stacks, reg16, "$g_encountered_party"),
    (party_get_num_attached_parties, reg17, "$g_encountered_party"),

    #AI info third line
    (get_party_ai_behavior, ":behaviour", "$g_encountered_party"),
    (val_add, ":behaviour", "str_ai_bhvr_hold"),
    (str_store_string, s13, ":behaviour"),
    (get_party_ai_current_behavior, ":cur_behaviour", "$g_encountered_party"),
    (val_add, ":cur_behaviour", "str_ai_bhvr_hold"),
    (try_begin),
      (neq, ":cur_behaviour", ":behaviour"),
      (str_store_string, s14, ":cur_behaviour"),
      (assign, reg18, 1),
    (else_try),
      (str_clear, s14),
      (assign, reg18, 0),
    (try_end),

    (get_party_ai_object, ":object", "$g_encountered_party"),
    (try_begin),
      (this_or_next|le, ":object", 0),
      (neg|party_is_active, ":object"),
      (str_store_string, s15, "str_dplmc_none"),
    (else_try),
      (str_store_party_name, s15, ":object"),
    (try_end),
    (get_party_ai_current_object, ":cur_object", "$g_encountered_party"),
    (assign, reg19, 1),
    (try_begin),
      (eq, ":cur_object", ":object"),
      (assign, reg19, 0), #disable display
    (else_try),
      (this_or_next|le, ":cur_object", 0),
      (neg|party_is_active, ":cur_object"),
      (str_store_string, s16, "str_dplmc_none"),
    (else_try),
      (str_store_party_name, s16, ":cur_object"),
    (try_end),

    (party_get_ai_target_position, pos2, "$g_encountered_party"),
    (position_get_x, reg20, pos2),
    (position_get_y, reg21, pos2),

    #grab the background mesh stuff
    (try_begin),
      (is_between, "$g_encountered_party", centers_begin, centers_end),
      (assign, "$current_town", "$g_encountered_party"),
      (call_script, "script_set_town_picture"),
    (else_try),
      (eq, "$g_encountered_party_template", "pt_looters"),
      (set_background_mesh, "mesh_pic_bandits"),
    (else_try),
      (eq, "$g_encountered_party_template", "pt_mountain_bandits"),
      (set_background_mesh, "mesh_pic_mountain_bandits"),
    (else_try),
      (eq, "$g_encountered_party_template", "pt_steppe_bandits"),
      (set_background_mesh, "mesh_pic_steppe_bandits"),
    (else_try),
      (eq, "$g_encountered_party_template", "pt_taiga_bandits"),
      (set_background_mesh, "mesh_pic_steppe_bandits"),
    (else_try),
      (this_or_next|eq, "$g_encountered_party_template", "pt_black_sea_pirates"),
      (eq, "$g_encountered_party_template", "pt_sea_raiders"),
      (set_background_mesh, "mesh_pic_sea_raiders"),
    (else_try),
      (eq, "$g_encountered_party_template", "pt_forest_bandits"),
      (set_background_mesh, "mesh_pic_forest_bandits"),
    (else_try),
      (this_or_next|eq, "$g_encountered_party_template", "pt_deserters"),
      (eq, "$g_encountered_party_template", "pt_routed_warriors"),
      (set_background_mesh, "mesh_pic_deserters"),
    #SB : dplmc party templates
    # (else_try),
      # (eq, "$g_encountered_party_template", "pt_center_reinforcements"),
      # (set_background_mesh, "mesh_pic_recruits"),
    (else_try),
      (eq, "$g_encountered_party_template", "pt_kingdom_hero_party"),
      (party_stack_get_troop_id, ":leader_troop", "$g_encountered_party", 0),
      (ge, ":leader_troop", 1),
      (troop_get_slot, ":leader_troop_faction", ":leader_troop", slot_troop_original_faction),
      (try_begin),
        (eq, ":leader_troop_faction", fac_kingdom_1),
        (set_background_mesh, "mesh_pic_swad"),
      (else_try),
        (this_or_next|eq, ":leader_troop_faction", fac_kingdom_2),
        (this_or_next|eq, ":leader_troop_faction", fac_kingdom_9),
        (eq, ":leader_troop_faction", fac_kingdom_10),
        (set_background_mesh, "mesh_pic_vaegir"),
      (else_try),
        (this_or_next|eq, ":leader_troop_faction", fac_kingdom_3),
        (this_or_next|eq, ":leader_troop_faction", fac_kingdom_11),
        (eq, ":leader_troop_faction", fac_kingdom_12),
        (set_background_mesh, "mesh_pic_khergit"),
      (else_try),
        (this_or_next|eq, ":leader_troop_faction", fac_kingdom_4),
        (this_or_next|eq, ":leader_troop_faction", fac_kingdom_13),
        (this_or_next|eq, ":leader_troop_faction", fac_kingdom_14),
        (this_or_next|eq, ":leader_troop_faction", fac_kingdom_15),
        (eq, ":leader_troop_faction", fac_kingdom_16),
        (set_background_mesh, "mesh_pic_nord"),
      (else_try),
        (eq, ":leader_troop_faction", fac_kingdom_5),
        (set_background_mesh, "mesh_pic_rhodock"),
      (else_try),
        (eq, ":leader_troop_faction", fac_kingdom_17),
        (set_background_mesh, "mesh_pic_mountain_bandits"),
      (else_try),
        (eq, ":leader_troop_faction", fac_kingdom_6),
        (set_background_mesh, "mesh_pic_sarranid_encounter"),
      (try_end),
    (try_end),
    ],
    [

      ("talk",
      [],
      "Encounter the party.",
      [
        (call_script, "script_game_event_party_encounter", "$g_encountered_party", -1),
        # (change_screen_map),
      ]),

      ("slots",
      [],
      "Dump all slot values.",
      [ #g_encountered_party is the input
        (jump_to_menu, "mnu_display_party_slots"),
      ]),

      ("reinf",
      [],
      "Reinforce party.",
      [

      (try_begin),
        (is_between, "$g_encountered_party", villages_begin, villages_end),
        # (party_add_template, "$g_encountered_party", "pt_village_defenders"),
        (call_script, "script_refresh_village_defenders", "$g_encountered_party"),
      (else_try),
        (is_between, "$g_encountered_party", walled_centers_begin, walled_centers_end),

        (try_for_range, ":party_template_slot", slot_cohort_town_begin, slot_cohort_town_end),
            (party_get_slot, ":party_template", "$g_encountered_party", ":party_template_slot"),
            (ge, ":party_template", 1),
            (call_script, "script_cohort_refil_garrison", "$g_encountered_party", ":party_template", ":party_template_slot",0),
        (try_end),
      (else_try),
        (party_slot_eq, "$g_encountered_party", spt_kingdom_hero_party),

        (try_for_range, ":party_template_slot", slot_cohort_begin, slot_cohort_end),
            (party_get_slot, ":party_template", "$g_encountered_party", ":party_template_slot"),
            (ge, ":party_template", 1),
            (call_script, "script_cohort_describe_strength_to_s5_and_refil", "$g_encountered_party", ":party_template", ":party_template_slot",-1,-1,1),
        (try_end),
      (else_try),
        # (this_or_next|eq, "$g_encountered_party_faction", "fac_outlaws"),
        # (is_between, "$g_encountered_party_faction", bandit_factions_begin, bandit_factions_end),
        (party_get_template_id, ":party_template", "$g_encountered_party"),
        (party_add_template, "$g_encountered_party", ":party_template"),
      (try_end),
      ]),

    ("exp",
      [],
      "Upgrade party.",
      [
        (party_get_num_companion_stacks, ":num_stacks", "$g_encountered_party"),
        (party_clear, "p_temp_party"),
         (try_for_range_backwards, ":stack", 0, ":num_stacks"),
            (party_stack_get_troop_id, ":id", "$g_encountered_party", ":stack"),
            (try_begin),
              (party_stack_get_size, ":size", "$g_encountered_party", ":stack"),
              # (call_script, "script_game_get_upgrade_xp", ":id"),
              # (store_mul, ":xp", reg0, ":size"),
              (try_begin),
                (troop_is_hero, ":id"),
                (store_character_level, ":level", ":id"),
                (assign, ":end", 100),
                (try_begin), #assign block of exp
                  (le, ":level", 10),
                  (assign, ":xp", 100),
                (else_try),
                  (le, ":level", 25),
                  (assign, ":xp", 1000),
                (else_try), #most people stop before level 30
                  (le, ":level", 35),
                  (assign, ":xp", 10000),
                (else_try),
                  (le, ":level", 50),
                  (assign, ":xp", 30000),
                (else_try),
                  (le, ":level", 60),
                  (assign, ":xp", 1000000),
                (else_try), #good luck, level caps at 63
                  (assign, ":xp", 10000000),
                (try_end),
                (try_for_range, ":unused", 0, ":end"),
                  (party_add_xp_to_stack, "$g_encountered_party", ":stack", ":xp"),
                  (add_xp_to_troop, 1, ":id"), #this actually upgrades the level
                  # (add_xp_as_reward, ":xp"),
                  (store_character_level, ":cur_level", ":id"),
                  (lt, ":level", ":cur_level"), #done
                  (assign, ":end", 0),
                (try_end),
              (else_try),
                (troop_get_upgrade_troop, ":upgrade_troop", ":id", 0),
                (gt, ":upgrade_troop", 0),
                (troop_get_upgrade_troop, ":upgrade_2", ":id", 1),
                (try_begin),
                  (gt, ":upgrade_2", 0),
                  (store_random_in_range, ":random_no", 0, 2),
                  (eq, ":random_no", 0),
                  (assign, ":upgrade_troop", ":upgrade_2"),
                (try_end),
                (party_add_members, "p_temp_party", ":upgrade_troop", ":size"),
                (party_stack_get_num_wounded, ":num_wounded", "$g_encountered_party", ":stack"),
                (party_wound_members, "p_temp_party", ":upgrade_troop", ":num_wounded"),
                (party_remove_members, "$g_encountered_party", ":id", ":size"),
                # (party_add_xp_to_stack, "$g_encountered_party", ":stack", ":xp"),
              (try_end),
            (try_end),
         (try_end),
         (call_script, "script_party_add_party_companions", "$g_encountered_party", "p_temp_party"),
      ]),

      ("wound",
      [],
      "Wound party.",
      [
        (call_script, "script_party_wound_all_members", "$g_encountered_party"),
      ]),
    ("heal",
      [],
      "Heal party.",
      [
        (call_script, "script_party_heal_all_members_aux", "$g_encountered_party"),
      ]),

     ("rename",[],"Rename party.",
       [
	   (assign, "$g_presentation_state", rename_party),
       (start_presentation, "prsnt_name_kingdom"),
       ]
       ),
      ("exchange",
      [],
      "Exchange with party.",
      [
        (change_screen_exchange_members,1),
      ]),

      ("bandits",
      [(is_between, "$g_encountered_party", centers_begin, centers_end),],
      "Spawn bandits nearby.",
      [
      (set_spawn_radius, 25),
      (try_for_range, ":unused", 0, 10),
        (store_random_in_range, ":party_template", bandit_party_templates_begin, bandit_party_templates_end),
        (call_script, "script_spawn_party", "$g_encountered_party", ":party_template"),
      (try_end),
      ]),

      ("leave",[],"Leave.",
       [
        (assign, "$g_leave_encounter", 1),
        (change_screen_return),
       ]
      ),
    ]
  ),

#helper menu to show all troop slots
( "display_troop_slots", menu_text_color(0xFF009900),
  "{s1}^{s2}",
  "none",[
    # (set_background_mesh, "mesh_pic_cattle"),
    (assign, reg1, "$g_talk_troop"),
    (str_store_troop_name, s1, "$g_talk_troop"),
    (str_store_troop_name_plural, s2, "$g_talk_troop"),
    (store_troop_faction, ":faction_no", "$g_talk_troop"),
    (str_store_faction_name, s3, ":faction_no"),
    (troop_get_class, ":class", "$g_talk_troop"),
    (str_store_class_name, s4, ":class"),
    (store_character_level, reg2, "$g_talk_troop"),
    (str_store_string, s1, "@{reg1}: {s1}, {s2} classified as level {reg2} {s3} {s4}"),
    (try_begin), #upgrades
      (neg|troop_is_hero, "$g_talk_troop"),
      (try_begin),
        (troop_get_upgrade_troop, ":upgrade_0", "$g_talk_troop", 0),
        (gt, ":upgrade_0", 0),
        (str_store_troop_name_plural, s2, ":upgrade_0"),
        (str_store_string, s1, "@{s1}^becomes {s2}"),
        (troop_get_upgrade_troop, ":upgrade_1", "$g_talk_troop", 1),
        (gt, ":upgrade_1", 0),
        (str_store_troop_name_plural, s2, ":upgrade_1"),
        (str_store_string, s1, "@{s1} and {s2}"),
      (try_end),

      (call_script, "script_game_get_upgrade_xp", "$g_talk_troop"),
      (assign, reg10, reg0),
      (call_script, "script_game_get_upgrade_cost", "$g_talk_troop"),
      (assign, reg11, reg0),
      (str_store_string, s1, "@{s1}^costs {reg11} to upgrade with {reg10} xp"),

      (call_script, "script_game_get_troop_wage", "$g_talk_troop", -1),
      (assign, reg12, reg0),
      (call_script, "script_game_get_join_cost", "$g_talk_troop"),
      (assign, reg13, reg0),

      #this is because this script ties a global to the price
      (assign, ":troop_no", "$g_talk_troop"),
      (assign, "$g_talk_troop", ransom_brokers_begin),
      (call_script, "script_game_get_prisoner_price", ":troop_no"),
      (assign, reg14, reg0),
      (assign, "$g_talk_troop", ":troop_no"),

      (str_store_string, s1, "@{s1}^wage of {reg12}, buy costs {reg13} sell costs {reg14}"),
    (else_try),
      (troop_is_hero, "$g_talk_troop"),
      (str_store_string, s2, "@hero"),
      (call_script, "script_cf_troop_debug_range", "$g_talk_troop", s2, 0),
      (str_store_string, s1, "@{s1} is a {s2}"),
      (try_begin),
        (store_troop_gold, ":gold", "$g_talk_troop"),
        (gt, ":gold", 0),
        (assign, reg1, ":gold"),
        (str_store_string, s1, "@{s1} with {reg1} gold"),
      (try_end),
      # (try_begin),
        # (store_partner_quest, ":quest_no"),
        # (ge, ":quest_no", 0),
        # (str_store_quest_name, s2, ":quest_no"),
        # (str_store_string, s1, "@{s1} tasking you with {s2}"),
      # (try_end),
    (try_end),

    (str_clear, s2),
    (try_for_range, reg1, 0, 1000),
      (troop_get_slot, reg0, "$g_talk_troop", reg1),
      (neq, reg0, 0), #if there's a value in here
      (str_store_string, s2, "@{s2}^{reg1}: {reg0}"),
    (try_end),

    (set_fixed_point_multiplier, 100),
    (init_position, pos0),
    (try_begin),
      (str_is_empty, s2),
      (position_set_x, pos0, 17),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 100),
    (else_try),
      (position_set_x, pos0, 60),
      (position_set_y, pos0, 20),
      (position_set_z, pos0, 100),
    (try_end),
    (store_mul, ":troop_no", "$g_talk_troop", 2),
    (set_game_menu_tableau_mesh, "tableau_game_party_window", ":troop_no", pos0),
  ],[
    ("next",[
      (lt, "$g_talk_troop", "trp_troops_end"), #last troop apparently
      (store_add, ":troop_no", "$g_talk_troop", 1),
      (str_store_troop_name, s2, ":troop_no"),
    ],"Next Troop ({s2}).",[
      (val_add, "$g_talk_troop", 1),
      (jump_to_menu, "mnu_display_troop_slots"),
    ]),
    ("prev",[
      (gt, "$g_talk_troop", "trp_player"),
      (store_sub, ":troop_no", "$g_talk_troop", 1),
      (str_store_troop_name, s2, ":troop_no"),
    ],"Previous Troop ({s2}).",[
      (val_sub, "$g_talk_troop", 1),
      (jump_to_menu, "mnu_display_troop_slots"),
    ]),
    #So apparently this one needs to re-jump to the menu
    ("notes",[
      (is_between, "$g_talk_troop", heroes_begin, kingdom_ladies_end),
    ],"View Notes.",[
      (change_screen_notes, 1, "$g_talk_troop"),
    ]),
    ("prev_range",[
      (gt, "$g_talk_troop", "trp_player"),
      (call_script, "script_cf_troop_debug_range", "$g_talk_troop", s3, -1),
      (str_store_troop_name, s3, reg0),
    ],"Head ({s3}).",[
      (call_script, "script_cf_troop_debug_range", "$g_talk_troop", s0, -1),
      (assign, "$g_talk_troop", reg0),
      (jump_to_menu, "mnu_display_troop_slots"),
    ]),
    ("next_range",[
      (call_script, "script_cf_troop_debug_range", "$g_talk_troop", s3, 1),
      (str_store_troop_name, s3, reg0),
    ],"Tail ({s3}).",[
      (call_script, "script_cf_troop_debug_range", "$g_talk_troop", s0, 1),
      (assign, "$g_talk_troop", reg0),
      (jump_to_menu, "mnu_display_troop_slots"),
    ]),
    ("end",[
      (str_store_troop_name, s2, "trp_fiducia"),
    ],"Jump to the last Troop ({s2}).",[
      (assign, "$g_talk_troop", "trp_fiducia"),
      (jump_to_menu, "mnu_display_troop_slots"),
    ]),
    ("first",[
      (str_store_troop_name, s2, 0),
    ],"Jump to the first Troop ({s2}).",[
      (assign, "$g_talk_troop",0),
      (jump_to_menu, "mnu_display_troop_slots"),
    ]),
    ("rename",[
    ],"Rename.",[
      (assign, "$g_player_troop", "$g_talk_troop"),
      (assign, "$g_presentation_state", rename_companion),
      (start_presentation, "prsnt_name_kingdom"),
    ]),
    ("change",[
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
    ],"Modify slots.",[
      (assign, "$g_presentation_state", 0), #start off at first slot
      (assign, "$g_presentation_input", rename_companion),
      (start_presentation, "prsnt_modify_slots"),
    ]),
    ("inventory",[
    ],"Modify inventory.",[
      (change_screen_loot, "$g_talk_troop"),
    ]),
    ("gender",[
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
    ], "Toggle gender.",[
      (try_begin),
        (eq, "$g_talk_troop", "trp_player"),
        (store_sub, "$character_gender", tf_female, "$character_gender"),
        (troop_set_type, "trp_player", "$character_gender"),
      (else_try),
        (troop_get_type, ":gender", "$g_talk_troop"),
        (store_sub, ":gender", tf_female, ":gender"),
        (troop_set_type, "$g_talk_troop", ":gender"),
      (try_end),
    ]),
    ("continue",[
    ],"Continue.",[
      (change_screen_map),
    ]),
]),

("dplmc_choose_disguise", 0,
  "You are about to sneak into {s1}. Make sure you don't bring suspicious items or excess denars that might be confiscated. {s2}",
  "none",[
    (troop_get_inventory_capacity, ":inv_cap", "trp_random_town_sequence"),
    (assign, ":count", 0),
    (try_for_range, ":i_slot", ek_food + 1, ":inv_cap"),
      (troop_get_inventory_slot, ":cur_item", "trp_random_town_sequence", ":i_slot"),
      (gt, ":cur_item", -1),
      #(assign, reg3, ":cur_item"),
      #(display_message, "@{reg3}"),
      (val_add, ":count", 1),
    (try_end),
    # (assign, reg0, ":count"),
    # (assign, reg1, "$temp"),
    # (display_message, "@{reg0} , {reg1}"),
    (try_begin),
      (gt, ":count", "$temp"),
      #put stuff back
      (set_show_messages, 0), #move all gold
      (call_script, "script_move_inventory_and_gold", "trp_random_town_sequence", "trp_player", -1),
      (set_show_messages, 1),
      (display_message, "@You cannot bring that many items with you. Your items have been returned to your inventory."),
    (try_end),

    (str_store_party_name, s1, "$current_town"),
    #build text
    (try_begin),
      (eq, "$sneaked_into_town", disguise_none),
      (str_store_string, s2, "@Select a suitable disguise for this occasion."),
      (assign, "$temp", 0),
    (else_try),
      (eq, "$sneaked_into_town", disguise_pilgrim),
      (str_store_string, s2, "@As a poor priest with a stout stick and a few tricks up your sleeve, you will be able to blend in with the crowds but not bring much of value with you."),
      (assign, "$temp", 6),
    (else_try),
      (eq, "$sneaked_into_town", disguise_farmer),
      (str_store_string, s2, "@As a poor roman farmer, you will be able to a wrangle livestock and smuggle articles of food through."),
      (assign, "$temp", 15),
    (else_try),
      (eq, "$sneaked_into_town", disguise_hunter),
      (str_store_string, s2, "@As a eastern trader, provisions and raw goods are expected as well as horseflesh."),
      (assign, "$temp", 12),
    (else_try),
      (eq, "$sneaked_into_town", disguise_guard),
      (str_store_string, s2, "@As a germanic warrior, you will be able to bear weapons but bring only a few personal belongings."),
      (assign, "$temp", 6),
    (else_try),
      (eq, "$sneaked_into_town", disguise_merchant),
      (str_store_string, s2, "@As a roman merchant, you will be able to bring any assortment of goods."),
      (assign, "$temp", 32),
    (else_try),
      (eq, "$sneaked_into_town", disguise_bard),
      (str_store_string, s2, "@As a bard, you will be allowed some personal possessions and your instrument."),
      (assign, "$temp", 9),
    (try_end),
    (set_fixed_point_multiplier, 100),
    (init_position, pos0),
    (try_begin),
      (str_is_empty, s2),
      (position_set_x, pos0, 17),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 100),
    (else_try),
      (position_set_x, pos0, 60),
      (position_set_y, pos0, 20),
      (position_set_z, pos0, 100),
    (try_end),
    (set_game_menu_tableau_mesh, "tableau_game_inventory_window", "trp_player", pos0),
    (troop_get_slot, "$temp_2", "trp_player", slot_troop_player_disguise_sets),
  ],[
    ("continue",[
      (gt, "$temp", 0),
      (assign, reg1, "$temp"),
    ],"Choose up to {reg1} items to bring.",[
      (change_screen_loot, "trp_random_town_sequence"),
    ]),

      ("continue",
      [(neq, "$sneaked_into_town", disguise_none)],
      "Select how much gold to carry.",
      [
        (assign, "$pool_troop", "trp_random_town_sequence"),
        (start_presentation, "prsnt_deposit_withdraw_money"),
      ]),

      ("continue",
      [(neq, "$sneaked_into_town", disguise_none)],
      "Attempt to sneak in...",
      [
        (set_show_messages, 0),

        #do inventory placeholder
        (troop_clear_inventory, "trp_temp_troop"),
        (call_script, "script_dplmc_copy_inventory", "trp_player", "trp_temp_troop"),
        (call_script, "script_dplmc_copy_inventory", "trp_random_town_sequence", "trp_player"),
        (call_script, "script_dplmc_copy_inventory", "trp_temp_troop", "trp_random_town_sequence"),
        #do gold swap
        (store_troop_gold, ":cur_amount", "trp_random_town_sequence"),
        (store_troop_gold, ":cur_gold", "trp_player"),
        (troop_remove_gold, "trp_player", ":cur_gold"),
        (troop_remove_gold, "trp_random_town_sequence", ":cur_amount"),
        (troop_add_gold, "trp_player", ":cur_amount"),
        (troop_add_gold, "trp_random_town_sequence", ":cur_gold"),

        (set_show_messages, 1),

        (faction_get_slot, ":player_alarm", "$g_encountered_party_faction", slot_faction_player_alarm),
        (party_get_num_companions, ":num_men", "p_main_party"),
        (party_get_num_prisoners, ":num_prisoners", "p_main_party"),
        (val_add, ":num_men", ":num_prisoners"),
        (val_mul, ":num_men", 2),
        (val_div, ":num_men", 3),
        (store_add, ":get_caught_chance", ":player_alarm", ":num_men"),
        (store_random_in_range, ":random_chance", 0, 100),
        (try_begin),
          (this_or_next|ge, "$cheat_mode", 1),
          (this_or_next|ge, ":random_chance", ":get_caught_chance"),
          (eq, "$g_last_defeated_bandits_town", "$g_encountered_party"),
          (assign, "$g_last_defeated_bandits_town", 0),
          (assign, "$town_entered", 1), #dckplmc
          (assign, "$g_mt_mode", tcm_disguised),
          (jump_to_menu, "mnu_sneak_into_town_suceeded"),
        (else_try),
          (jump_to_menu,"mnu_sneak_into_town_caught"),
        (try_end),
      ]),

      ("disguise_pilgrim",
      [
        (neq, "$sneaked_into_town", disguise_pilgrim),
      ], "Don the robes of a poor pilgrim.",
      [
        (assign, "$sneaked_into_town", disguise_pilgrim),
      ]),

      #SB : todo, add peasant woman variant
      ("disguise_farmer",
      [(store_and, ":disguise", "$temp_2", disguise_farmer),
       (eq, ":disguise", disguise_farmer),
       (neq, "$sneaked_into_town", disguise_farmer),],
      "Accept your fate as a downtrodden farmer.",
      [
        (assign, "$sneaked_into_town", disguise_farmer),
      ]),
      ("disguise_hunter",
      [(store_and, ":disguise", "$temp_2", disguise_hunter),
       (eq, ":disguise", disguise_hunter),
       (neq, "$sneaked_into_town", disguise_hunter),],
      "Disguise yourself as a skilled {huntsman/huntress}.",
      [
        (assign, "$sneaked_into_town", disguise_hunter),
      ]),
      ("disguise_guard",
      [(store_and, ":disguise", "$temp_2", disguise_guard),
       (eq, ":disguise", disguise_guard),
       (neq, "$sneaked_into_town", disguise_guard),],
      "Pass yourself off as a caravan guard.",
      [
        (assign, "$sneaked_into_town", disguise_guard),
      ]),
      ("disguise_merchant",
      [(store_and, ":disguise", "$temp_2", disguise_merchant),
       (eq, ":disguise", disguise_merchant),
       (neq, "$sneaked_into_town", disguise_merchant),],
      "Adopt the guise of a trader.",
      [
        (assign, "$sneaked_into_town", disguise_merchant),
      ]),
      ("disguise_bard",
      [(store_and, ":disguise", "$temp_2", disguise_bard),
       (eq, ":disguise", disguise_bard),
       (neq, "$sneaked_into_town", disguise_bard),],
      "Try your luck as a bard.",
      [
        (assign, "$sneaked_into_town", disguise_bard),
      ]),

      ("back",
      [],
      "Never mind...",
      [
        #put stuff back
        (set_show_messages, 0), #move all gold
        (call_script, "script_move_inventory_and_gold", "trp_random_town_sequence", "trp_player", -1),
        (set_show_messages, 1),

        (assign, "$sneaked_into_town", disguise_none),
        #(jump_to_menu, "mnu_castle_outside"),
        (jump_to_menu, "$temp4_1"),
      ]),
]),

("honorary_title_granted",0,
  "{s22} granted you the honorary title of {s23}.",
  "none",
  [
    (str_store_troop_name, s22, "$g_notification_menu_var2"),
    (store_add, ":title_string", "$g_notification_menu_var1", "str_title_begin"),
    (str_store_string, s23, ":title_string"),
  ],
  [
    ("continue",[],"Continue.",
      [
        (change_screen_map),
      ]),
]),

("faction_found_select_banner",0,
  "You need to choose a banner for your new faction. You can either choose between the preset banners or design a custom banner."
  +" You can later change the banner at any time in the 'camp menu' under 'take an action'.",
  "none",[
    (assign, "$g_edit_banner_troop", "trp_player"),
    (assign, "$g_presentation_next_presentation", -1),
  ],[
  ("select_preset_banner",[],"Choose from preset banners.",[
    (jump_to_menu, "mnu_auto_return"),
    (start_presentation, "prsnt_banner_selection"),
  ]),
  ("select_custom_banner",[],"Create a custom banner.",[
    (jump_to_menu, "mnu_auto_return"),
    (start_presentation, "prsnt_custom_banner"),
  ]),
]),

("choose_banner",0,
  "Here you can select a banner for {s1}. You can either choose between the preset banners or design a custom banner.",
  "none",
  [
    (try_begin),
        (neq, "$g_edit_banner_troop", "trp_player"),
        (str_store_troop_name, s1, "$g_edit_banner_troop"),
    (else_try),
        (str_store_string, s1, "@you"),
    (try_end),
  ],
  [
    ("select_preset_banner",[],"Choose from preset banners.",
      [
        (jump_to_menu, "mnu_auto_return"),
        #(assign, "$g_presentation_next_presentation", -1),
        (start_presentation, "prsnt_banner_selection"),
      ]
      ),
    ("select_custom_banner",[],"Create a custom banner.",
      [
        (jump_to_menu, "mnu_auto_return"),
        #(assign, "$g_presentation_next_presentation", -1),
        (start_presentation, "prsnt_custom_banner"),
      ]),
]),

("fruhling",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Spring!^^The snow is melting, the flowers prosper, it is spring",
  "none",[
    (set_background_mesh, "mesh_pic_spring"),
  ],[
    ("continue",[],"Aestas...",[
      (assign, "$season", 1),
      (assign, "$shader_season", 0),##shader
      (change_screen_map),
    ]),
]),

("winter",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Winter^^The leaves are fallen, cold winds are coming, it is winter",
  "none",[
    (set_background_mesh, "mesh_pic_winter"),
  ],[
    ("continue",[],"Hiems...",[
      (assign, "$season", 0),
      (assign, "$shader_season", 3),##shader
      (try_for_parties, ":party"),
        (call_script, "script_game_get_party_speed_multiplier", ":party"),
      (try_end),
      (change_screen_map),
    ]),
]),

("event_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Octavia and Sabina.^^Agrippina, Neros mother, forced a marriage between her 16-year-old son and Octavia, the 13-year-old daughter of Tiberius Claudius Caesar Augustus."
  +" Years later, Nero fell in love with Poppaea Sabina. Sabina challenged him to reject Octavia. Nero accused his childless wife of adultery with a slave and banished her. Twelve days later he married Sabina."
  +" This caused heavy riots and uprisings, because Octavia was very popular among the people. Therefore, Nero had the rumor scattered, Octavia had tried together with her lover to depose him. Thus Nero banished her to an island."
  +" Nero gave the order to cut her wrists and suffocate her in hot steam, a few days later.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
	  (call_script, "script_add_to_troop_wealth", "trp_kingdom_7_lord", -50000),
    (try_for_range, ":npcs", active_npcs_begin, active_npcs_end),
      (store_faction_of_troop, ":fac", ":npcs"),
      (eq, ":fac", "fac_kingdom_7"),
      (this_or_next|troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_hero),
      (troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_lady),
      (troop_get_slot, ":personality", ":npcs", slot_lord_reputation_type),
      (try_begin),
        (this_or_next|is_between, ":personality", lrep_selfrighteous, lrep_goodnatured),
        (eq, ":personality", lrep_roguish),
        (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -2),
      (else_try),
        (is_between, ":personality", lrep_goodnatured, lrep_custodian),
        (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -4),
       (try_end),
	   (try_end),
	   (val_add, "$g_unrest", 10),
     (display_message, "@Stability of the Empire decreases", color_bad_news),
     (call_script, "script_update_party_creation_random_limits"),
     (call_script, "script_spawn_bandits"),
  ],[
    ("continue",[],"Terrible.",[
      (call_script, "script_change_player_honor", 2),
      (change_screen_map),
    ]),
	  ("continue",[],"Nice! Haha!",[
      (call_script, "script_change_player_honor", -2),
      (change_screen_map),
    ]),
]),
("event_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Arson?^^Some people still accuse Nero of arson. Although Nero tried to his best to blame the Christs, the rumors still don't disappear."
  +" Nero's dislike of the Ancient city is well known and some people spread even rumors saying he wants to rename Rome into Neropolis, the city of Nero."
  +" Maybe the fire happened on his orders with the goal to found a new city on the ruins of Rome?",
  "none",[
    (set_background_mesh, "mesh_pic_fire_of_rome"),
  ],[
    ("continue",[],"Continue.",[
      (try_for_range, ":npcs", active_npcs_begin, active_npcs_end),
        (store_faction_of_troop, ":fac", ":npcs"),
        (eq, ":fac", "fac_kingdom_7"),
        (this_or_next|troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_hero),
        (troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_lady),
        (troop_get_slot, ":personality", ":npcs", slot_lord_reputation_type),
        (try_begin),
          (this_or_next|is_between, ":personality", lrep_selfrighteous, lrep_goodnatured),
          (eq, ":personality", lrep_roguish),
          (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -2),
        (else_try),
          (is_between, ":personality", lrep_goodnatured, lrep_custodian),
          (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -4),
        (try_end),
      (try_end),

      (val_add, "$g_unrest", 12),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (call_script, "script_add_to_troop_wealth", "trp_kingdom_7_lord", -25000),
      (change_screen_map),
    ]),
]),
("event_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Pisonian conspiracy^^Gaius Calpurnius Piso, a leading Roman statesman, benefactor of literature, and orator, intended to have Nero assassinated, and replace him as Imperator Caesar Augustus through acclamation by the Praetorian Guard."
  +" He enlisted the aid of several prominent senators, equestrians, and soldiers with a loosely conceived plan in which the prefect of the Praetorian Guard with Ofonius Tigellinus would conduct Piso to the Praetorian Camp, where the Guard"
  +" would acclaim him as new Caesar.Right before the conspirators plot was put into motion a freedman named Milichus discovered the conspiracy and reported it to Nero's secretary Epaphroditos."
  +" The plot promptly collapsed as many conspirators quickly gave up everything they knew. Nero ordered Piso, the philosopher Seneca, his nephew Lucan, and the satirist Petronius to commit suicide. Many others were also killed.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("continue",[],"Continue.",[
      (call_script, "script_add_to_troop_wealth", "trp_kingdom_7_lord", -50000),
      (val_add, "$g_unrest", 10),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (call_script, "script_update_party_creation_random_limits"),
      (call_script, "script_spawn_bandits"),
      (call_script, "script_spawn_bandits"),
      (try_for_range, ":npcs", active_npcs_begin, active_npcs_end),
        (store_faction_of_troop, ":fac", ":npcs"),
        (eq, ":fac", "fac_kingdom_7"),
        (this_or_next|troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_hero),
        (troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_lady),
        (troop_get_slot, ":personality", ":npcs", slot_lord_reputation_type),
        (try_begin),
          (this_or_next|is_between, ":personality", lrep_selfrighteous, lrep_goodnatured),
          (eq, ":personality", lrep_roguish),
          (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -1),
        (else_try),
          (is_between, ":personality", lrep_goodnatured, lrep_custodian),
          (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -2),
        (try_end),
      (try_end),
      (change_screen_map),
    ]),
]),
("event_4",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Lampoons^^Many lampoons are circulating both in Greek and Latin, for example the following:^^"
  +"'Nero, Orestes, Alcmeon their mothers slew.'^'A calculation new. Nero his mother slew.'^'Who can deny the descent from Aeneas' great line of our Nero? One his mother took off, the other one took off his sire.'"
  +"^'While our ruler his lyre does twang and the Parthian his bowstring, Paean-singer our princeps shall be, and Far-darter our foe.'"
  +"^'Rome is becoming one house; off with you to Veii, Quirites! If that house does not soon seize upon Veii as well.'"
  +"^^Nero has put much effort into finding the person composing this.",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
  ],[
	  ("continue",[],"Continue",[
      (call_script, "script_add_to_troop_wealth", "trp_kingdom_7_lord", -50000),
      (val_add, "$g_unrest", 8),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (call_script, "script_update_party_creation_random_limits"),
      (call_script, "script_spawn_bandits"),
      #(call_script, "script_spawn_bandits"),
      (change_screen_map),
    ]),
]),
("event_5",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Neronia and Iuvenalia^^A year ago Nero held a festival, the Iuvenalia, to celebrate its traditional beard shave."
  +" On this occasion, however, it was not professional artists who appeared, but senators and aristocrats, which was as degusting as it was damnable to the Roman aristocracy."
  +" At the end of the games Nero himself performed on stage. This year, Caesar Augustus donated the Neronia, games that were based on the Greek Games and took place in Neapolis,"
  +" because there the audience was more open to performances of all kinds than in Rome. Again, Princeps Nero performed on stage in publicly and for the first time in front of a large audience.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
    (try_for_range, ":npcs", active_npcs_begin, active_npcs_end),
      (store_faction_of_troop, ":fac", ":npcs"),
      (eq, ":fac", "fac_kingdom_7"),
      (this_or_next|troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_hero),
      (troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_lady),
      (troop_get_slot, ":personality", ":npcs", slot_lord_reputation_type),
      (try_begin),
        (this_or_next|is_between, ":personality", lrep_selfrighteous, lrep_goodnatured),
        (eq, ":personality", lrep_roguish),
        (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -1),
      (else_try),
        (is_between, ":personality", lrep_goodnatured, lrep_custodian),
        (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -2),
      (try_end),
    (try_end),
    (call_script, "script_add_to_troop_wealth", "trp_kingdom_7_lord", -100000),
    (val_add, "$g_unrest", 15),
    (display_message, "@Stability of the Empire decreases", color_bad_news),
    (call_script, "script_update_party_creation_random_limits"),
  ],[
    ("continue",[],"Terrible.",[
      (call_script, "script_change_player_honor", 2),
      (change_screen_map),
    ]),
	  ("continue",[],"Nice.",[
      (call_script, "script_change_player_honor", -2),
      (change_screen_map),
    ]),
]),
("event_6",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Agrippina^^At the beginning of his reign Nero was under the influence of his mother Agrippina. But Agrippina gradually lost control over her son."
  +" Then she threatened to overthrow Nero through intrigues, conspiracies and bribes. Nero, who feared his mother, set up a commission to investigate Agrippinas conspiracies, which also included Seneca."
  +" But the commission could not prove anything. With the help of his former teacher Anicetus, now an admiral, he wanted to sink Agrippina with a specially prepared ship. But she managed to swim ashore."
  +" On March 23, 59 AD, he ordered to murdered her in her villa.",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
    (call_script, "script_add_to_troop_wealth", "trp_kingdom_7_lord", -100000),
    (val_add, "$g_unrest", 10),
    (display_message, "@Stability of the Empire decreases", color_bad_news),
    (try_for_range, ":npcs", active_npcs_begin, active_npcs_end),
      (store_faction_of_troop, ":fac", ":npcs"),
      (eq, ":fac", "fac_kingdom_7"),
      (this_or_next|troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_hero),
      (troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_lady),
      (troop_get_slot, ":personality", ":npcs", slot_lord_reputation_type),
      (try_begin),
        (this_or_next|is_between, ":personality", lrep_selfrighteous, lrep_goodnatured),
        (eq, ":personality", lrep_roguish),
        (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -3),
      (else_try),
        (is_between, ":personality", lrep_goodnatured, lrep_custodian),
        (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -5),
      (try_end),
    (try_end),
  ],[
	  ("continue",[],"Terrible.",[
      (call_script, "script_change_player_honor", 2),
      (change_screen_map),
    ]),
	  ("continue",[],"Bitch.",[
      (call_script, "script_change_player_honor", -2),
      (change_screen_map),
    ]),
]),
("event_7",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Nero and the Olympic Games^^Nero participated in the Olympics. He had bribed organizers to postpone the games for a year so he could participate, and artistic competitions were added to the athletic events."
  +" Nero won every contest in which he was a competitor. During the games Nero sang and played his lyre on stage, acted in tragedies and raced chariots. He won a 10-horse chariot race, despite being thrown from the chariot and leaving the race."
  +" He was crowned on the basis that he would have won if he had completed the race.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("continue",[],"He won through bribery, I am sure.",[
      (call_script, "script_add_to_troop_wealth", "trp_kingdom_7_lord", -100000),
      (val_add, "$g_unrest", 5),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (try_for_range, ":npcs", active_npcs_begin, active_npcs_end),
        (store_faction_of_troop, ":fac", ":npcs"),
        (eq, ":fac", "fac_kingdom_7"),
        (this_or_next|troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_hero),
        (troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_lady),
        (troop_get_slot, ":personality", ":npcs", slot_lord_reputation_type),
        (try_begin),
          (this_or_next|is_between, ":personality", lrep_selfrighteous, lrep_goodnatured),
          (eq, ":personality", lrep_roguish),
          (store_random_in_range, ":r", 0, 100),
          (le, ":r", 25),
          (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -4),
        (else_try),
          (is_between, ":personality", lrep_goodnatured, lrep_custodian),
          (store_random_in_range, ":r", 0, 100),
          (le, ":r", 20),
          (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -2),
        (try_end),
      (try_end),
      (change_screen_map),
    ]),
]),
("event_8",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The dancing Caesar!^^On a tour through Italia, Nero hosted several festivities on which he even appeared as an actor and dancer. The crowd always celebrated him, though many say only because they were 'bribed' with food and wine."
  +" The Roman nobility is shocked about such a shameful action. The Princeps, a common dancer? To see his plump figure in dance moves on a stage is for most aristocrats just ridiculous.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("continue",[],"Terrible.",[
      (call_script, "script_add_to_troop_wealth", "trp_kingdom_7_lord", -100000),
      (val_add, "$g_unrest", 5),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (try_for_range, ":npcs", active_npcs_begin, active_npcs_end),
        (store_faction_of_troop, ":fac", ":npcs"),
        (eq, ":fac", "fac_kingdom_7"),
        (this_or_next|troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_hero),
        (troop_slot_eq, ":npcs", slot_troop_occupation, slto_kingdom_lady),
        (troop_get_slot, ":personality", ":npcs", slot_lord_reputation_type),
        (try_begin),
          (this_or_next|is_between, ":personality", lrep_selfrighteous, lrep_goodnatured),
          (eq, ":personality", lrep_roguish),
          (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -2),
        (else_try),
          (is_between, ":personality", lrep_goodnatured, lrep_custodian),
          (call_script, "script_troop_change_relation_with_troop", ":npcs", "trp_kingdom_7_lord", -1),
        (try_end),
      (try_end),
      (change_screen_map),
    ]),
]),

("center_looted",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Only fleeting shadows flit in the corners. Death corpses rot silently.",
  "none",[
    (set_background_mesh, "mesh_pic_looted_village"),
  ],[
    ("continue",[],"Continue ...",[
      (change_screen_map),
    ]),
]),
   ##################
  #####################SIEGE WARFARE RANDOM EVENTS
  ####siege warfare random event chief

  #si no tiene hecho letrinas y saneamiento
(
  "event_siege_01",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Rats!^^One of your advisers tells you that he has found rats in the provisions that your men are eating. This could have been prevented with sanitation!",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("choice_01_1a",[],"That is terrible! Destroy the contaminated supplies.",[
      (assign, ":number_of_foods_player_has", 0),
      (try_for_range, ":cur_edible", food_begin, food_end),

        (call_script, "script_cf_player_has_item_without_modifier", ":cur_edible", imod_rotten),
        (val_add, ":number_of_foods_player_has", 1),
        (store_random_in_range, ":food_lose", 0, 2),
        (try_begin),
          (gt, ":number_of_foods_player_has", 0),
          (try_begin),
            (eq, ":food_lose", 0), #35%
            (troop_remove_item, "trp_player", ":cur_edible"),
          (else_try),
          (try_end),
        (else_try),
          (eq, ":number_of_foods_player_has", 0),
          (display_message, "@Your men have nothing to eat!", 0xFF0000),
          (call_script, "script_change_player_party_morale", -8),
          (assign, ":number_of_foods_player_has", 1),
          #NPC companion changes begin
          (try_begin),
            (call_script, "script_party_count_fit_regulars", "p_main_party"),
            (gt, reg0, 0),
            (call_script, "script_objectionable_action", tmt_egalitarian, "str_men_hungry"),
          (try_end),
          #NPC companion changes end
        (try_end),
      (try_end),
      (display_message, "@Part of your food was destroyed.", 0xFF0000),
      (change_screen_return),
    ]),
    ("choice_01_2a",[],"My men must eat. Kill as many rats as you can.",[
      (jump_to_menu,"mnu_ratas_siege"),
    ]),
]),
###matar ratas submenu
("ratas_siege",0,
  "Before all the rats are exterminated, many of your men fall sick and die.^^Your casualties: {s8}",
  "none", [
    (set_background_mesh, "mesh_pic_camp"),
    (call_script, "script_inflict_casualties_to_party", "p_main_party", 8),
    (call_script, "script_collect_friendly_parties"),
  ],[
    ("back_to_siegea",[],"Done.",[
      (call_script, "script_change_player_party_morale", -5),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
#matar ratas acaba
#bajas enfermedad
("event_siege_02",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Dysentery!^^Poor hygiene in your camp has led to dysentery. The men start dying all around you. This could have been prevented with sanitation!",
  "none",[
  ],[
    ("choice_02_1b",[],"Hire a physician to try to help the sick (1000 denars).",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 1000),
        (troop_remove_gold, "trp_player", 1000),
        (jump_to_menu,"mnu_enfermedad2_siege"),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (jump_to_menu,"mnu_enfermedad_siege"),
      (try_end),
    ]),
    ("choice_02_2b",[],"There is nothing I can do.",[
      (jump_to_menu,"mnu_enfermedad_siege"),
    ]),
    ("choice_02_3b",[],"Pray to the gods.",[
      (jump_to_menu,"mnu_enfermedad3_siege"),
    ]),
    ("choice_02_4b",[
      (party_get_skill_level, ":heal", "p_main_party", skl_wound_treatment),
      (ge, ":heal", 5),
    ],"I or my companions can cure them.",[
      (jump_to_menu,"mnu_enfermedad4_siege"),
    ]),
]),
("enfermedad_siege",0,
  "Death governs your camp. Many of your men are sick and dying.^^Your casualties: {s8}",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
    (call_script, "script_inflict_casualties_to_party", "p_main_party", 10),
    (call_script, "script_collect_friendly_parties"),
  ],[
    ("back_to_siegeb",[],"Damn.",[
      (call_script, "script_change_player_party_morale", -8),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (call_script, "script_change_player_honor", -5),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("enfermedad2_siege",0,
  "Some men die from the disease, but most manage to recover thanks to the physician you hired.^^Your casualties: {s8}",
  "none", [
    (call_script, "script_inflict_casualties_to_party", "p_main_party", 2),
    (call_script, "script_collect_friendly_parties"),
    (play_sound, "snd_disease_sound"),
  ],[
    ("back_to_siegeb",[],"Back to siege.",[
      (call_script, "script_change_player_party_morale", 5),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_player_honor", 1),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("enfermedad3_siege",0,
  "Death governs your camp. Many of your men are sick and dying. Perhaps your god has saved some lives.^^Your casualties: {s8}",
  "none", [
    (call_script, "script_inflict_casualties_to_party", "p_main_party", 9),
    (call_script, "script_collect_friendly_parties"),
  ],[
    ("back_to_sieged",[],"Done.",[
      (call_script, "script_change_player_party_morale", -5),
      (call_script, "script_change_troop_renown", "trp_player", -15),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("enfermedad4_siege",0,
  "Thanks to your healing abilities, you manage to save many men, but some still die.^^Your casualties: {s8}",
  "none", [
    (call_script, "script_inflict_casualties_to_party", "p_main_party", 2),
    (call_script, "script_collect_friendly_parties"),
  ],[
    ("back_to_siegees",[],"Back to siege.",[
      (call_script, "script_change_player_honor", 1),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("event_siege_03",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Waste!^^There is so much garbage, vermin and other nasty things that your camp seems to be more of a pigsty. Your men are unhappy. This could have been prevented with sanitation!",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
      ("choice_03_4c",[
        (party_get_skill_level, ":leadership", "p_main_party", skl_leadership),
        (ge, ":leadership", 6),
      ],"I will give an inspiring speech to gain time.",[
        (call_script, "script_change_player_party_morale", -1),
        (change_screen_return),
      ]),
      ("choice_03_2c",[],"I will see what I can do.",[
        (call_script, "script_change_player_party_morale", -6),
        (change_screen_return),
      ]),
]),
###acaba enfermedades chief
#seguir
#eventos incursion, infiltracion y emboscadas
("event_siege_04",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Enemy raids on supply storages!^^Some enemies have managed to infiltrate at night and burn some of your supplies. Part of your food was destroyed.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (assign, ":number_of_foods_player_has", 0),
    (try_for_range, ":cur_edible", food_begin, food_end),

      (call_script, "script_cf_player_has_item_without_modifier", ":cur_edible", imod_rotten),
      (val_add, ":number_of_foods_player_has", 1),
      (store_random_in_range, ":food_lose", 0, 3),
      (try_begin),
        (gt, ":number_of_foods_player_has", 0),
        (try_begin),
          (eq, ":food_lose", 0), #25%
          (troop_remove_item, "trp_player", ":cur_edible"),
        (else_try),
        (try_end),
      (else_try),
        (eq, ":number_of_foods_player_has", 0),
        (display_message, "@Your men have nothing to eat!", 0xFF0000),
        (call_script, "script_change_player_party_morale", -8),
        (assign, ":number_of_foods_player_has", 1),
        #NPC companion changes begin
        (try_begin),
          (call_script, "script_party_count_fit_regulars", "p_main_party"),
          (gt, reg0, 0),
          (call_script, "script_objectionable_action", tmt_egalitarian, "str_men_hungry"),
        (try_end),
        #NPC companion changes end
      (else_try),
      (try_end),
    (try_end),
    (display_message, "@Part of your food was destroyed.", 0xFF0000),
  ],[
    ("choice_04_1d",[],"Punish the men who were on duty that night.",[
      (call_script, "script_change_player_party_morale", -4), #discipline concept need.
      (call_script, "script_change_troop_renown", "trp_player", 5), #JuJu70- must be a renown change and not duplicate morale malus
      (display_message,"@Your men think that you are a strong leader."),
      (change_screen_return),
    ]),
    ("choice_04_2d",[],"No, do nothing!",[
      (call_script, "script_change_troop_renown", "trp_player", -15),
      (display_message,"@Your men think that you are a weak leader."),
      (change_screen_return),
    ]),
]),

("event_siege_05",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Successful defence of supply storages!^^During the night, your men captured and executed a group of enemies who tried to infiltrate and burn supplies.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (call_script, "script_inflict_casualties_to_party", "$g_enemy_party", 3),
    (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),
  ],[
    ("choice_05_1e",[],"Congratulate them for doing their job well.",[
      # (call_script, "script_change_player_party_morale", 5),
      (change_screen_return),
    ]),
    ("choice_05_2e",[],"Reward each with gold (300 denars).",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 300),
        (call_script, "script_change_troop_renown", "trp_player", 5),
        (call_script, "script_change_player_party_morale", 5),
        (troop_remove_gold, "trp_player", 300),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -5),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_05_3e",[],"Reward them with a night off with pay (200 denars).",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 200),
        (troop_remove_gold, "trp_player", 200),
        (call_script, "script_change_player_party_morale", 5),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -5),
        (call_script, "script_change_player_party_morale", -2),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_05_4e",[],"Do nothing. You are a stern leader.",[
      (call_script, "script_change_player_party_morale", -5),
      (call_script, "script_change_player_honor", -3),
      (display_message,"@Your men think that you are a strong leader."),
      (change_screen_return),
    ]),
]),
("event_siege_06",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Attack on supply line!^^Commander, our food supply routes may be in danger. Our scouts have discovered enemy raiders behind our lines.^^" +
  "We could avoid such problems by blockading the place.^^Do you want to send men to protect the routes and pursue the enemy?",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("choice_06_1f",[],"Send men.",[
      (jump_to_menu,"mnu_encuentro_avituallamiento"),
    ]),
    ("choice_06_2f",[
      (store_troop_gold, ":gold", "trp_player"),(ge, ":gold", 500),
    ],"Send messengers to pay them off (500 denars).",[
      (troop_remove_gold, "trp_player", 500),
      (jump_to_menu,"mnu_encuentro_avituallamiento2"),
    ]),
    ("choice_06_3f",[],"Do nothing.",[
      (assign, ":number_of_foods_player_has", 0),
      (try_for_range, ":cur_edible", food_begin, food_end),

        (call_script, "script_cf_player_has_item_without_modifier", ":cur_edible", imod_rotten),
        (val_add, ":number_of_foods_player_has", 1),
        (store_random_in_range, ":food_lose", 0, 3),
        (try_begin),
          (gt, ":number_of_foods_player_has", 0),
          (try_begin),
            (eq, ":food_lose", 0), #25%
            (troop_remove_item, "trp_player", ":cur_edible"),
          (else_try),
          (try_end),
        (else_try),
          (eq, ":number_of_foods_player_has", 0),
          (display_message, "@Your men have nothing to eat!", 0xFF0000),
          (call_script, "script_change_player_party_morale", -8),
          (assign, ":number_of_foods_player_has", 1),
          #NPC companion changes begin
          (try_begin),
            (call_script, "script_party_count_fit_regulars", "p_main_party"),
            (gt, reg0, 0),
            (call_script, "script_objectionable_action", tmt_egalitarian, "str_men_hungry"),
          (try_end),
          #NPC companion changes end
        (try_end),
      (try_end),
      (display_message, "@Part of your food was destroyed.", 0xFF0000),
      (change_screen_return),
    ]),
]),
#submenu encuentro avituallamiento
("encuentro_avituallamiento",0,
  "You dispatch a group of men to protect and pursue the enemies that plague your supply routes. Your men attempt to corner the enemy to force him to fight until death. There are some losses, but your men manage to win the battle and secure the supply routes.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none", [
    (set_background_mesh, "mesh_pic_charge"),
    (call_script, "script_simulate_battle_with_parties", 55, "$g_enemy_party", 55, 0, 0),
  ],[
    ("back_to_siegeg2",[],"Well done.",[
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("encuentro_avituallamiento2",0,
  "{s4}",
  "none", [
    (str_clear, s4),
    (set_background_mesh, "mesh_pic_messenger"),
    (store_random_in_range, ":options", 0,5),
    (try_begin),
      (le, ":options", 1),
      (call_script, "script_simulate_battle_with_parties", 50, "$g_enemy_party", 50, 0, 0),
      (str_store_string, s4, "@While your messengers try to negotiate with the enemy raiders, a squad of your men appears by chance, and a battle begins. " +
      "Your men manage to destroy the looters and fix the problem, but at the cost of some lives.^^Your casualties: {s8}^^Enemy casualties: {s10}"),
      (set_background_mesh, "mesh_pic_siege_attack"),
    (else_try),
      (le, ":options", 3),
      (str_store_string, s4, "@The enemy raiders accept the deal, take the money, and promise not to attack your supplies for some weeks."),
      (set_background_mesh, "mesh_pic_messenger"),
    (else_try),
      (str_store_string, s4, "@The raiders take the money, kill the messengers, and continue to damage your supply routes."),
      (set_background_mesh, "mesh_pic_messenger"),
      #comida
      (assign, ":number_of_foods_player_has", 0),
      (try_for_range, ":cur_edible", food_begin, food_end),

        (call_script, "script_cf_player_has_item_without_modifier", ":cur_edible", imod_rotten),
        (val_add, ":number_of_foods_player_has", 1),
        (store_random_in_range, ":food_lose", 0, 3),
        (try_begin),
          (gt, ":number_of_foods_player_has", 0),
          (try_begin),
            (eq, ":food_lose", 0), #25%
            (troop_remove_item, "trp_player", ":cur_edible"),
          (else_try),
          (try_end),
        (else_try),
          (eq, ":number_of_foods_player_has", 0),
          (display_message, "@Your men have nothing to eat!", 0xFF0000),
          (call_script, "script_change_player_party_morale", -8),
          (assign, ":number_of_foods_player_has", 1),
          #NPC companion changes begin
          (try_begin),
            (call_script, "script_party_count_fit_regulars", "p_main_party"),
            (gt, reg0, 0),
            (call_script, "script_objectionable_action", tmt_egalitarian, "str_men_hungry"),
          (try_end),
          #NPC companion changes end
        (try_end),
      (try_end),
      (display_message, "@Part of your food was destroyed.", 0xFF0000),
      ###messengers
      (store_random_in_range, ":p_leave", 4, 8),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
      (try_end),
    (try_end),
  ],[
    ("back_to_siegeg3",[],"Very well.",[
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("event_siege_07",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Poisoned water!^^Our scouts have found that the defenders have poisoned the water with dead animals. Do you want to buy water and ask the merchants to bring it via our supply route?",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("choice_07_1g",[],"Yes (600 denars).",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 600),
        (troop_remove_gold, "trp_player", 600),
        (change_screen_return),
      (else_try),
        (display_message, "@You don't have enough silver. You order water to be rationed and wells to be dug."),
        (call_script, "script_change_troop_renown", "trp_player", -10),
        (jump_to_menu,"mnu_sed_siege"),
      (try_end),
    ]),
    ("choice_07_2g",[],"No. Ration water and dig wells.",[
      (jump_to_menu,"mnu_sed_siege"),
    ]),
    ("choice_07_3g",[],"Without water, we cannot continue. Abandon the siege.",[
      (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
      (assign, "$g_player_besiege_town", -1),
      (change_screen_return),
    ]),
]),
###perdidas por sed mientras cavan pozos
("sed_siege",0,
  "Water is running out, and your men weaken. Driven by the madness of thirst, some of them drink poisoned water and die. Finally, a well is completed and you get water for the time being. You can continue the siege.^^Your casualties from poisoned water:{s8}",
  "none", [  (set_background_mesh, "mesh_pic_messenger"),
    (call_script, "script_inflict_casualties_to_party", "p_main_party", 4),
    (call_script, "script_collect_friendly_parties"),
  ],[
    ("back_to_siegeh",[],"Fate is inexorable.",[
      (call_script, "script_change_player_party_morale", -5),
      (call_script, "script_change_troop_renown", "trp_player", -15),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
  ####sed acaba
("event_siege_08",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Desertion!^^Bad news: one of our men has deserted to the enemy. It may be because of his low morale or because they have offered him money. Whatever it is, the enemy may know our plans.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("choice_08_1h",[],"Offer 400 denars. I don't want more desertions.",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 400),
        (call_script, "script_change_player_party_morale", 5),
        (troop_remove_gold, "trp_player", 400),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_player_party_morale", -5),
        (call_script, "script_change_troop_renown", "trp_player", -15),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_08_2h",[],"Offer 800 denars to minimize temptation.",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 800),
        (call_script, "script_change_player_party_morale", 4),
        (troop_remove_gold, "trp_player", 800),
        (call_script, "script_change_player_party_morale", 10),
        (call_script, "script_change_troop_renown", "trp_player", 5),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_player_party_morale", -5),
        (call_script, "script_change_troop_renown", "trp_player", -15),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_08_3h",[],"Do not worry. I can always change plans.",[
      (change_screen_return),
    ]),
]),
("event_siege_09",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Enemy traitor!^^A deserter from the enemy has joined our ranks. He has informed us that {s2}.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (store_random_in_range, ":rand_no", 1, 10),
    (try_begin),
      (ge, ":rand_no", 8),
      (str_store_string , s2, "@the enemy thinks reinforcements will soon arrive."),
    (else_try),
      (ge, ":rand_no", 5),
      (str_store_string , s2, "@fear and discontent are spreading inside."),
    (else_try),
      (ge, ":rand_no", 3),
      (str_store_string , s2, "@he likes the wife of his former master, and he will fight by your side if you give her to him after the conquest."),
    (else_try),
      (ge, ":rand_no", 0),
      (str_store_string , s2, "@the enemy's morale is low, and we should attack."),
    (try_end),
  ],[
    ("choice_09_1i",[],"He is welcome to our ranks.",[
      (party_add_members, "p_main_party", "trp_watchman", 1),
      (call_script, "script_change_player_party_morale", -5),
      (change_screen_return),
    ]),
    ("choice_09_2i",[],"I do not want deserters among my men. Kill him.",[
      (call_script, "script_change_player_honor", -5),
      (change_screen_return),
    ]),
    ("choice_09_3i",[],"I'm sure he's a spy. Return him to the enemy.",[
      (change_screen_return),
    ]),
]),
("event_siege_10",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Low fighting spirit^^Our men and the enemy do not insult each other as much any more, and sometimes talk to each other. This can affect their fighting spirit when we attack. What shall we do?",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("choice_10_1j",[],"Allow it. The enemy's fighting spirit is also affected.",[
      (call_script, "script_change_player_honor", 5),
      (call_script, "script_change_troop_renown", "trp_player", -15),
      (change_screen_return),
    ]),
    ("choice_10_2j",[],"What? Forbid it and punish the offenders.",[
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_player_party_morale", -5),
      (change_screen_return),
    ]),
]),
###frio invierno bajas
("event_siege_11",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Cold death!^^The cold of winter always takes its toll when it comes. Some men have died of cold, flu and other minor illnesses.^^Your casualties: {s8}",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (call_script, "script_inflict_casualties_to_party", "p_main_party", 1),
    (call_script, "script_collect_friendly_parties"),
  ],[
    ("choice_11_1j",[],"Requiescat in pace.",[
      (change_screen_return),
    ]),
]),

("event_siege_12",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Lack of discipline!^^From day to day you notice more and more indiscipline among some of your men. Your officers ask you what to do?",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("choice_12_1j",[],"Shorten their rations",[
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (call_script, "script_change_player_party_morale", 2),
      (change_screen_return),
    ]),
    ("choice_12_2j",[],"Whipp them.",[
      (display_message, "@Your soldiers are whipped."),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (call_script, "script_change_player_party_morale", 3),
      (change_screen_return),
    ]),
     ("choice_12_3j",[],"Do nothing.",[
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_player_party_morale", -5),
      (change_screen_return),
     ]),
]),
("event_siege_13",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Enemy raid!^^A group of enemies attacked our men by surprise and then quickly withdrew.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 30, "$g_enemy_party", 80, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("choice_13_1b",[],"Be more cautious (Solution: blockade the place).",[
      (change_screen_return),
    ]),
]),
("event_siege_14",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Skirmish while foraging!^^While foraging, a group of enemies encountered a group of our men.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 85, "$g_enemy_party", 85, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("choice_14_1b",[],"Be more cautious (Solution: blockade the place).",[
      (change_screen_return),
    ]),
]),
("event_siege_15",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Homestead skirmish!^^We were attacked by an enemy force while raiding neighboring villages. The villagers joined the enemy, causing us many casualties.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 40, "$g_enemy_party", 70, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("choice_15_1b",[],"Be more cautious (Solution: blockade the place).",[
      (change_screen_return),
    ]),
]),
("event_siege_16",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "River skirmish!^^The enemy and our men came upon each other near a river, and the fight for water caused numerous casualties on both sides.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 60, "$g_enemy_party", 75, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("choice_16_1b",[],"Be more cautious (Solution: blockade the place).",[
      (change_screen_return),
    ]),
]),
("event_siege_17",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Quick sally out!^^The enemy sallied out through a secret passage, attacking us before swiftly retreating back to the protection of their walls.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 25, "$g_enemy_party", 80, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("choice_17_1b",[],"Be more cautious (Solution: blockade the place).",[
      (change_screen_return),
    ]),
]),
("event_siege_18",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Abducted women!^^Some of your men have abducted women from the surrounding villages and brought them to the siege camp for fun.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("choice_18_1b",[],"You allow it and ask for the most beautiful woman.",[
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_player_party_morale", 5),
      (party_add_members, "p_main_party", "trp_refugee", 6),
      (call_script, "script_change_troop_health", "trp_player", 25),
      (jump_to_menu,"mnu_no_paymentandkill"),
    ]),
    ("choice_18_2b",[],"Order the release of the women and punish the kidnappers.",[
      (call_script, "script_change_player_party_morale", -10),
      (call_script, "script_change_player_honor", 5),
      (change_screen_return),
    ]),
]),

("no_paymentandkill",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "In revenge, the men of the nearby villages joined together and attacked your foraging parties.^Your casualties: {s8}",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (call_script, "script_inflict_casualties_to_party", "p_main_party", 2),
    (call_script, "script_collect_friendly_parties"),
  ],[
    ("choice_nppayment_2j",[],"Damn!",[
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),

("event_siege_19",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Enemy attacks blockade!^^The enemy is trying to break our blockade, and our men are trying to contain them.^^Your casualties: {s8}^^Enemy casualties: {s10}", #enemy desesperate, player adventage
  "none",[
    (call_script, "script_simulate_battle_with_parties", 25, "$g_enemy_party", 70, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("choice_19_1b",[],"Send some men while I take others to force them to withdraw.",[
      (store_random_in_range, ":rand", 0, 7),
      (try_begin),
        (le, ":rand", 3),
        (jump_to_menu,"mnu_no_defendiendo"),
      (else_try),
        (jump_to_menu,"mnu_defendiendo_circunvallation"),
      (try_end),
    ]),
    ("choice_19_2b",[],"Send all the men to protect that part of the circumvallation.",[
      (store_random_in_range, ":rand", 0, 7),
      (try_begin),
        (le, ":rand", 3),
        (jump_to_menu,"mnu_defendiendo_mal"),
      (else_try),
        (jump_to_menu,"mnu_defendiendo_circunvallation"),
      (try_end),
    ]),
    ("choice_19_3b",[],"Do not worry. Our wall is strong.",[
      (jump_to_menu,"mnu_no_defendiendo"),
    ]),
]),

###ataque a circunvallation por defensores
("no_defendiendo",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The enemy has overcome our defenses and burned our small camps and checkpoints, breaking our blockade.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 30, "$g_enemy_party", 80, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("defendiendo_1bnd",[],"We must build the blockade again.",[
      (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("defendiendo_circunvallation",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "We have managed to repel the enemy, who returned to the protection of his walls...^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 30, "$g_enemy_party", 60, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("defendiendo_1dcir",[],"Well done.",[
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("defendiendo_mal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Another group of enemies took advantage of our troops being here and set fire to another part of our blockade.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 35, "$g_enemy_party", 70, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("defendiendo_1mal",[],"Damn!",[
      (party_set_slot,"$g_encountered_party",slot_center_blockaded,0),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
#####ataque a circunvallation acaba

###ataque a maquinas de asedio
("event_siege_20",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Enemy attacks equipment!^^The enemy is trying to burn our assault equipment.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 40, "$g_enemy_party", 90, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("choice_20_1b",[],"Send some men while I take others to force them to withdraw.",[
      (store_random_in_range, ":rand", 0, 8),
      (try_begin),
        (le, ":rand", 3),
        (jump_to_menu,"mnu_defendiendo_mal_equip"),
      (else_try),
        (le, ":rand", 5),
        (jump_to_menu,"mnu_no_defendiendo_equip"),
      (else_try),
        (jump_to_menu,"mnu_defendiendo_equip"),
      (try_end),
    ]),
    ("choice_20_2b",[],"Quickly. Send all men to protect the equipment.",[
      (store_random_in_range, ":rand", 0, 8),
      (try_begin),
        (le, ":rand", 3),
        (jump_to_menu,"mnu_defendiendo_mal_equip"),
      (else_try),
        (jump_to_menu,"mnu_defendiendo_equip"),
      (try_end),
    ]),
    ("choice_20_3b",[],"Do not worry. Our men will guard it.",[
      (jump_to_menu,"mnu_no_defendiendo_equip"),
    ]),
]),
###ataque a equipamiento de asedio
("no_defendiendo_equip",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The enemy has overcome our defenses and burned down our equipment.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 40, "$g_enemy_party", 80, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("defendiendo_1bnde",[],"We must begin construction again.",[
      (assign, "$g_siege_method", 0),
      (assign, "$g_mantlets_1", 0),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("defendiendo_equip",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "We have managed to repel the enemy, who returned to the protection of his walls.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 55, "$g_enemy_party", 60, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("defendiendo_1heq",[],"Well done.",[
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("defendiendo_mal_equip",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Another group of enemies has surrounded our positions and burned down our siege equipment on the other side.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 40, "$g_enemy_party", 60, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("defendiendo_1vmal",[],"Damn!",[
      (assign, "$g_siege_method", 0),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
#####ataque a equipamiento acaba

#continuamos aqui
("event_siege_21",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Enemy infiltrates blockade!^^Your guards discovered several men trying to sneak out at night to escape your blockade.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("choice_21_1b",[],"Allow them to escape.",[
      (call_script, "script_change_player_party_morale", -5),
      (store_random_in_range, ":p_leave", 8, 12),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "$g_encountered_party"),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_21_2b",[],"Kill them.",[
      (call_script, "script_change_player_honor", -5),
      (store_random_in_range, ":p_leave", 8, 12),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "$g_encountered_party"),
      (try_end),
      (change_screen_return),
    ]),
]),

("event_siege_22",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Enemy attempts to resupply!^^At night, your guards report that they observed a group of enemies dressed in sheepskins heading to a nearby stream. Right now, they are filling leather sacks with water to bring back to the settlement.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("atacar_emboscada_player2",[],"Go there with any companions who want to join.",[
      (try_begin),
        (store_troop_health, ":health", "trp_player", 0), #get relative health in 1-100 range and put it into the ":health" variable
        (lt, ":health", 30),
        (val_add, ":health", 35),               #add to it the 5%
        (troop_set_health,   "trp_player", ":health"),   #set it
      (try_end),

      (store_random_in_range, ":scene_a_usar", 0,3),
      (try_begin),
        (eq, ":scene_a_usar", 1),
        (assign, ":scene_to_use", "scn_river_ambush_1"),
      (else_try),
        (eq, ":scene_a_usar", 2),
        (assign, ":scene_to_use", "scn_river_ambush_2"),
      (else_try),
        (assign, ":scene_to_use", "scn_river_ambush_3"),
      (try_end),

      (set_jump_mission,"mt_ambush_riversw"),
      (modify_visitors_at_site,":scene_to_use"),
      #### tropas cambiar por las del asentamiento
      (reset_visitors, 0),
      (set_visitor,0,"trp_player"), #player
      (assign, ":cur_entry", 1),
      (try_for_range, ":companion", companions_begin, companions_end),
        (lt, ":cur_entry", 16),
        (main_party_has_troop,":companion"),
        (set_visitor, ":cur_entry", ":companion"),
        (val_add, ":cur_entry", 1),
      (try_end),

      (assign, ":num_troops", 8),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "$g_encountered_party"),
        (assign, ":lost_troop", reg0),
        #(try_for_range, ":visiterator", 17, 18), #possible 17 and 31, but this add 8 enemies each 1 entry point
        (assign, ":visiterator", 17),
        (set_visitor, ":visiterator", ":lost_troop"),
        #  (try_end),
      (try_end),
      (jump_to_scene,":scene_to_use"),
      (change_screen_mission),
    ]),
    ("choice_22_1b",[],"Send men to ambush the enemy in sheepskins.",[
      (store_random_in_range, ":rand", 0, 3),
      (try_begin),
        (eq, ":rand", 0),
        (jump_to_menu,"mnu_victoria_ovejas"),
      (else_try),
        (eq, ":rand", 1),
        (jump_to_menu,"mnu_derrota_ovejas"),
      (else_try),
        (jump_to_menu,"mnu_tablas_ovejas"),
      (try_end),
    ]),
    ("choice_22_2b",[],"Do nothing.",[
      (change_screen_return),
    ]),
]),
#####atacar ovejas chief
("victoria_ovejas",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Your soldiers surrounded the enemy in sheepskins and fell upon them by surprise, spreading death.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 80, "$g_enemy_party", 45, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("defendiendo_1lovej",[],"Perfect!",[
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("derrota_ovejas",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "It's a trap! Commander, the men dressed in sheepskins were a decoy to bring out our men and ambush them. Many were killed before returning to the protection of our circumvallation.^^Your casualties: {s8}^^Enemy casualties: {s10}",
  "none",[
    (call_script, "script_simulate_battle_with_parties", 40, "$g_enemy_party", 90, 0, 0),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("defendiendo_1poveja",[],"That is terrible.",[
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
("tablas_ovejas",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Your soldiers were deployed to surround the enemy, but they were too slow and noisy. The men in sheepskins sensed the threat and returned to the settlement quickly.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("defendiendo_1oveja2",[],"Well, next time.",[
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
###atacar ovejas acaba
("event_siege_23",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Exile mercenary!^^Today a mercenary who wants to join our ranks came to our camp. He says he is an exile from the place that we are besieging, and he wants revenge.",
  "none",[
    (set_background_mesh, "mesh_pic_siege_sighted"),
  ],[
    ("choice_23_1b",[],"Accept him.",[
      (party_add_members, "p_main_party", "trp_mercenary_horseman", 1),
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -20),
      (change_screen_return),
    ]),
    ("choice_23_2b",[],"I don't need more men.",[
      (change_screen_return),
    ]),
]),
("event_siege_24",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Psychological terror!^^We have accumulated the heads of enemies and dead peasants. Do you want to launch them over the walls to undermine the morale of the enemy and cause disease?",
  "none",[
    (set_background_mesh, "mesh_pic_siege_sighted"),
  ],[
    ("choice_24_1b",[],"What? You're a crazy maniac. Do not do that!",[
      (call_script, "script_change_player_honor", 5),
      (change_screen_return),
    ]),
    ("choice_24_2b",[],"Sure, it will be useful when negotiating their surrender.",[
      (call_script, "script_change_player_honor", -5),
      (jump_to_menu,"mnu_cabezas_moral"),
    ]),
]),
###cabezas
("cabezas_moral",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The heads are launched into the settlement. From the outside, you hear the cries and tears of the citizens when they recognize a loved one. War is merciless, and you've proven you're the most terrible of foes.",
  "none",[
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("defendiendo_1q",[],"This will help them give up... or die...",[
      (assign, "$g_cabezas_dentro", 1),
      #(call_script, "script_change_player_party_morale", -5),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (display_message,"@Your men think you're heartless and fear you!"),
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
###cabezas acaba
("event_siege_25",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Siege sluts!^^A merchant offers a group of dancers to entertain your men during the night.",
  "none",[
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[
    ("choice_25_1b",[],"This will just distract and tire my men.",[
      (call_script, "script_change_player_party_morale", -8),
      (change_screen_return),
    ]),
    ("choice_25_2b",[],"Hire dancers just for yourself (100 denars).",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 100),
        (troop_remove_gold, "trp_player", 100),
        (add_xp_as_reward,100),
        (display_message, "@You feel happy."),
        (call_script, "script_change_player_party_morale", -4),
        (call_script, "script_change_troop_health", "trp_player", 25),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -5),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_25_3b",[],"Hire dancers for your men (500 denars).",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 500),
        (troop_remove_gold, "trp_player", 500),
        (display_message, "@You feel good for helping."),
        (call_script, "script_change_player_party_morale", 8),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -5),
        (call_script, "script_change_player_party_morale", -2),
      (try_end),
      (change_screen_return),
    ]),
]),

("event_siege_26",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Bandits!^^A group of bandits approaches your camp. As your men reach for their arms, the bandits put down their weapons and say they come in peace. The leader of the bandits steps forward and asks if they may join you.",
  "none",[
    (set_background_mesh, "mesh_pic_bandits"),
  ],[
    ("choice_26_1b",[],"Of course! Such promising men are always welcome!",[
      (call_script, "script_change_player_party_morale", -8),
      (call_script, "script_change_player_honor", -2),
      (party_add_members, "p_main_party", "trp_looter", 5),
      (display_message, "@New troops join your party."),
      (change_screen_return),
    ]),
    ("choice_26_2b",[],"I'm sorry. We have no room for your kind!",[
      (display_message, "@The bandits leave, angry."),
      (change_screen_return),
    ]),
    ("choice_26_3b",[],"Prove yourselves worthy by raiding a village.",[
      (jump_to_menu,"mnu_sanguinario_p"),
    ]),
    ("choice_26_4b",[],"Kill them all!",[
      (call_script, "script_troop_add_gold", "trp_player", 100),
      (call_script, "script_change_player_honor", 1),
      #		(call_script, "script_change_troop_renown", "trp_player", -10),
      (display_message, "@Your men kill all the bandits."),
      (change_screen_return),
    ]),
]),
("sanguinario_p",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "After two hours, the bandits return with some loot and someone's head...",
  "none",[
    (set_background_mesh, "mesh_pic_looted_village"),
    (call_script, "script_troop_add_gold", "trp_player", 500),
    (call_script, "script_change_player_honor", -10),
    #		(call_script, "script_change_troop_renown", "trp_player", -10),
    (call_script, "script_change_player_party_morale", -8),
  ],[
    ("choice_26_3b",[],"Well done! An officer will show you to your places.",[
      (party_add_members, "p_main_party", "trp_looter", 5),
      #     (display_message, "@After tow hours the bandits return with some loot and the chiefs head..."),
      (change_screen_map),
    ]),
]),
("event_siege_27",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "More merchants!^^Several merchants approach you wanting to sell goods in the camp that has formed close to yours with the wives of the soldiers, prostitutes, refugees, children and other followers of the army.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("choice_27_1b",[],"They (and their money) are welcome.",[
      (call_script, "script_troop_add_gold", "trp_player", 400),
      (call_script, "script_change_player_party_morale", 5),

      (store_random_in_range, ":p_leave", 5, 10),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
      (try_end),
      (display_message, "@At night, some of your men make off with happy widows."),

      (change_screen_return), #menos discipline
    ]),
    ("choice_27_2b",[],"There are enough merchants already.",[
      (call_script, "script_change_player_party_morale", -5),
      (change_screen_return), #mas discipline
    ]),
    ("choice_27_3b",[],"Kill them and steal their money.",[
      (call_script, "script_change_player_honor", -15),
      (call_script, "script_change_player_party_morale", -10),
      #            (call_script, "script_change_troop_renown", "trp_player", -30),
      (call_script, "script_troop_add_gold", "trp_player", 1600),
      (change_screen_return),
    ]),
]),

("event_siege_28",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The weak are begging!^^To make the food last longer, the defenders threw out their women, children and elderly. You can see them moving towards your circumvallation, begging for food.",
  "none",[
    (set_background_mesh, "mesh_pic_siege_sighted"),
  ],[
    ("choice_28_1b",[],"Send soldiers to kill the children and elderly, taking the women.",[
      (call_script, "script_change_player_honor", -20),
      (call_script, "script_change_player_party_morale", 5),
      #		(call_script, "script_change_troop_renown", "trp_player", -15),
      (party_add_members, "p_main_party", "trp_refugee", 8),
      (change_screen_return),
    ]),
    ("choice_28_2b",[(store_troop_gold, ":gold", "trp_player"),(ge, ":gold", 1000),],"Buy food for them (1000 denars). Then let them leave.",[
      (troop_remove_gold, "trp_player", 1000),
      (display_message, "@You feel good for helping."),
      (call_script, "script_change_player_honor", 5),
      (call_script, "script_change_player_party_morale", -5),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (display_message,"@Your men think that you are a weak leader."),
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 10),
      (display_message,"@Your enemies appreciate your pity. Perhaps this will help you when you negotiate their surrender."),
      (change_screen_return),
    ]),
    ("choice_28_3b",[],"Do not give them anything. Allow them to die of starvation.",[
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (display_message,"@Your men think that you are a strong leader."),
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -10),
      (display_message, "@You know that in the coming days, dozens of children, women and elderly will die before your eyes, languishing from hunger."),
      (change_screen_return),
    ]),
]),
("event_siege_29",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Rape!^^One of your soldiers, angered by the long siege, rapes the wife of one of your officers.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("choice_29_1b",[],"Ignore the situation.",[
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (display_message,"@Your officer seems upset."),
      (jump_to_menu,"mnu_lucha_oficial"),
      (change_screen_return),
    ]),
    ("choice_29_2b",[],"Punish the soldier.",[
      (call_script, "script_change_player_party_morale", -4),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (display_message,"@Your men think that you are a strong leader."),
      (display_message,"@Your officer seems upset."),
      (jump_to_menu,"mnu_lucha_oficial"),
    ]),
    ("choice_29_3b",[],"Execute the soldier.",[
      (call_script, "script_change_player_party_morale", -8),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (display_message,"@Your men think that you are a very strong leader."),
      (display_message,"@Your officer seems happy."),

      (assign, ":num_troops", 1),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_29_4b",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 1000),
    ],"Pay compensation to the officer (1000 denars).",[
      (troop_remove_gold, "trp_player", 1000),
      (display_message, "@The wife is pregnant, and the officer asks for a high compensation. To avoid rumors and problems, you pay."),
      (change_screen_return),
    ]),
]),

###soldado problematico
("lucha_oficial",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Your officer kills the soldier and there is a brawl between some friends of the soldier and those loyal to your officer, leaving some dead.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (store_random_in_range, ":p_leave", 6, 12),
    (assign, ":num_troops", ":p_leave"),
    (try_for_range, ":unused", 0, ":num_troops"),
      (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
    (try_end),
    (set_background_mesh, "mesh_pic_siege_attack"),
  ],[
    ("defendiendo_1z",[],"That is terrible.",[
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),
####siege warfare acaba chief random event
###soldado problematico

####siege warfare acaba chief random event
  #####
  #panel comandante chief
("panel_comandante",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Before the battle begins...",
  "none",[
    (set_background_mesh, "mesh_pic_mb_warrior_3"),
  ],[
      ("choice_1comm",[
        (eq, "$g_empieza_discurso", 0),
      ],"Impassion your men with a rousing speech.",[
        (party_get_skill_level, ":leadership", "p_main_party", "skl_leadership"),
        (val_div, ":leadership", 2),
        (store_skill_level, ":persuasion", "skl_persuasion", "trp_player"),
        (val_div, ":persuasion", 2),
        (store_skill_level, ":oratory", "skl_oratory", "trp_player"),

        (store_add, ":slider", ":oratory", ":persuasion"),
        (val_add, ":slider", ":leadership"),
        (store_attribute_level, ":charisma","trp_player", ca_charisma),
        (val_div, ":charisma", 3),#charisma of 12 -> 4
        (store_random_in_range, ":r", 0, ":charisma"),
        (val_add, ":slider", ":r"),
        (val_add, ":slider", 1),
        # (assign, reg2, ":slider"),
        # (display_message, ":@slider: {reg2}"),
        (store_random_in_range, ":r", 0, 21),
        # (assign, reg2, ":r"),
        # (display_message, ":@r: {reg2}"),
        (try_begin),
          (lt, ":r", ":slider"),
          (store_div, ":moral_boost", ":oratory", 2),
          (val_add, ":moral_boost", ":persuasion"),
          (store_random_in_range, reg1, -3, 2),
          (display_message, "@{reg1}"),
          (val_add, ":moral_boost", reg1),
          (val_clamp, ":moral_boost", 1, 11),
          (call_script, "script_change_player_party_morale", ":moral_boost"),
          (jump_to_menu,"mnu_discurso_1"),
        (else_try),
          (jump_to_menu,"mnu_discurso_off"),
        (try_end),
      ]),

      ("choice_3comm",[
          (eq, "$g_empieza_campeon", 0),
          (party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
          (ge, ":tactics", 6),
        ],"Skirmishers: Send your men to hinder the enemy's advance.",
        [
          (assign, ":g_escaramuza_result2", 0),    #MOTO chief rewrite
          (try_begin),
            (troop_is_hero, "$g_talk_troop"),

            (party_get_skill_level, ":lider", "p_main_party",      skl_tactics),
            (store_skill_level, ":lider2", skl_tactics,      "$g_talk_troop"),
            (store_sub, reg0, ":lider", ":lider2"),

            (try_begin),
              (lt, reg0, -1),    #AI better than player?
              (assign, ":g_escaramuza_result2", 1),
            (else_try),
              (gt, reg0, 1),    #player better than AI?
              (assign, ":g_escaramuza_result2", 2),
            (try_end),
          (try_end),
          #MOTO rewrite end

          (store_random_in_range, ":rand", 0, 3),
          (try_begin),
            (eq, ":rand", 0),
            (eq, ":g_escaramuza_result2", 1),    #MOTO chief rewrite
            (jump_to_menu,"mnu_escaramuza_1"),
          (else_try),
            (eq, ":rand", 1),
            (eq, ":g_escaramuza_result2", 2),    #MOTO rewrite
            (jump_to_menu,"mnu_escaramuza_2"),
          (else_try),
            (eq, ":rand", 2),
            (jump_to_menu,"mnu_escaramuza_2"),
          (else_try),
            (jump_to_menu,"mnu_escaramuza_3"),
          (try_end),
        ]
      ),
      ("choice_4comm",[(le, "$g_empieza_discurso", 0),
          (neg|troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
        ],"Make a sacrifice to the gods.",
        [
          (store_random_in_range, ":rand", 0, 5),
          (party_get_skill_level, ":lider", "p_main_party", skl_leadership),
          (try_begin),
            (eq, ":rand", 0),
            (ge, ":lider", 4),
            (jump_to_menu,"mnu_sacrificio_1"),
          (else_try),
            (eq, ":rand", 1),
            (ge, ":lider", 4),
            (jump_to_menu,"mnu_sacrificio_2"),
          (else_try),
            (eq, ":rand", 2),
            (ge, ":lider", 4),
            (jump_to_menu,"mnu_sacrificio_3"),
          (else_try),
            (eq, ":rand", 3),
            (ge, ":lider", 4),
            (jump_to_menu,"mnu_sacrificio_4"),
          (else_try),
            (jump_to_menu,"mnu_sacrificio_off"),
          (try_end),
        ]
      ),

      ("choice_4comm",[(le, "$g_empieza_discurso", 0),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
        ],"Make a sacrifice to YHWH.",
        [
          (store_random_in_range, ":rand", 0, 5),
          (party_get_skill_level, ":lider", "p_main_party", skl_leadership),
          (try_begin),
            (eq, ":rand", 0),
            (ge, ":lider", 4),
            (jump_to_menu,"mnu_sacrificio_1"),
          (else_try),
            (eq, ":rand", 1),
            (ge, ":lider", 4),
            (jump_to_menu,"mnu_sacrificio_2"),
          (else_try),
            (eq, ":rand", 2),
            (ge, ":lider", 4),
            (jump_to_menu,"mnu_sacrificio_3"),
          (else_try),
            (eq, ":rand", 3),
            (ge, ":lider", 4),
            (jump_to_menu,"mnu_sacrificio_4"),
          (else_try),
            (jump_to_menu,"mnu_sacrificio_off"),
          (try_end),
        ]
      ),
      ("choice_5comm",[],"Do nothing.",
        [
          (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),
  #sacrificios
  (
    "sacrificio_off",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The gods remain mute to your prayers and sacrifices.",
    "none",
    [(set_background_mesh, "mesh_pic_cattle"),
    ],
    [
      ("sacri_1s",[],"Back.",
        [
          (assign, "$g_empieza_discurso", 1),
          (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),

  (
    "sacrificio_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The viscera of the slaughtered animals are full of worms: a bad omen.^^Maybe you should not fight today.",
    "none",
    [(set_background_mesh, "mesh_pic_cattle"),
    ],
    [
      ("sacri_1s2",[],"Back.",
        [
          (assign, "$g_empieza_discurso", 1),
          (call_script, "script_change_player_party_morale", -5),
          (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),
  (
    "sacrificio_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "As you look down at the blood of the slaughtered animal, one of your men points to the horizon where an eagle takes flight with a snake in its claws. A good omen indeed.^^The time is ripe to attack the enemy.",
    "none",
    [(set_background_mesh, "mesh_pic_cattle"),
    ],
    [
      ("sacri_1s3",[],"Back.",
        [
          (assign, "$g_empieza_discurso", 1),
          (call_script, "script_change_player_party_morale", 10),
          (try_begin),
            (troop_slot_ge, "trp_player", slot_troop_religion, 1),
            (call_script, "script_troop_get_relation_with_troop", "trp_player", "trp_fortuna"),
            (ge, reg0, -20),
            (troop_get_slot,":god", "trp_player", slot_troop_religion),
            (store_add, ":string", ":god", "str_gods_begin"),
            (str_store_string, s20, ":string"),
            (display_message, "@You feel so alive! {s20} has healed you!", color_good_news),
            (troop_set_health, "trp_player", 100),
          (try_end),
          (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),
  (
    "sacrificio_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "As you thrust the sacrificial knife into the neck of the animal, it escapes from your hands and runs a few yards before collapsing, facing the enemy. It can only be a bad omen.^^Maybe you should not fight today.",
    "none",
    [(set_background_mesh, "mesh_pic_cattle"),
    ],
    [
      ("sacri_1s4",[],"Back.",
        [
          (assign, "$g_empieza_discurso", 1),
          (call_script, "script_change_player_party_morale", -5),
          (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),
  (
    "sacrificio_4",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Digging into the intestines of the slaughtered animal, you discover a silver pendant ring. It can only be a good omen.^^You're ready for battle.",
    "none",
    [(set_background_mesh, "mesh_pic_cattle"),
    ],
    [
      ("sacri_1s5",[],"Back.",
        [
          (assign, "$g_empieza_discurso", 1),
          (call_script, "script_change_player_party_morale", 10),
          (try_begin),
            (troop_slot_ge, "trp_player", slot_troop_religion, 1),
            (call_script, "script_troop_get_relation_with_troop", "trp_player", "trp_fortuna"),
            (ge, reg0, -20),
            (troop_get_slot,":god", "trp_player", slot_troop_religion),
            (store_add, ":string", ":god", "str_gods_begin"),
            (str_store_string, s20, ":string"),
            (display_message, "@You feel so alive! {s20} has healed you!", color_good_news),
            (troop_set_health, "trp_player", 100),
          (try_end),
          (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),
  #sacrificios acaba

  #discursos
  (
    "discurso_off",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You also step forward and try to make condescending remarks, but it's not convincing. Your nerves betray you, and you are unable to articulate a single word.",
    "none",
    [
    ],
    [
      ("defendiendo_1_bd",[],"Back.",
        [
          (assign, "$g_empieza_discurso", 1),
          #(call_script, "script_change_player_party_morale", -4),
          (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),

  (
    "discurso_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You inspect the troops and move among them. While speaking to them, you look each man in the eye, seeking to convey the significance of the moment.",
    "none",
    [
    ],
    [
      ("defendiendo_1_cd",[],"Continue...",
        [
          (assign, "$g_empieza_discurso", 1),
          (assign, "$temp1", 0),
          (set_jump_mission, "mt_give_speech"),
          (call_script, "script_setup_random_scene"),
          (jump_to_menu,"mnu_simple_encounter"),
          (change_screen_mission),
        ]
      ),

     ("defendiendo_1_cd",[],"[Skip]",
        [
         (assign, "$g_empieza_discurso", 1),
         (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),

  ###escaramuza chief
  (
    "escaramuza_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Commander, the enemy commander overcame your tactical skills. Before we were prepared, we were surprised by enemy missile troops. They caused numerous casualties.^^Your casualties: {s8}",
    "none",
    [
      (set_background_mesh, "mesh_pic_charge"),
      (call_script, "script_inflict_casualties_to_party", "p_main_party", 2),
      (call_script, "script_collect_friendly_parties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
    ],
    [
      ("defendiendo_1e",[],"Damn!",
        [
          (assign, "$g_empieza_campeon", 1),
          (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),
  (
    "escaramuza_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Our men were deployed in time and closed with the enemy, causing them heavy casualties, before returning.^^Enemy casualties: {s8}",
    "none",
    [
      (set_background_mesh, "mesh_pic_charge"),
      (call_script, "script_inflict_casualties_to_party", "$g_enemy_party", 2),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
    ],
    [
      ("defendiendo_2e",[],"Well done.",
        [
          (assign, "$g_empieza_campeon", 1),
          (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),
  (
    "escaramuza_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Upon approaching the enemy, our men found the enemy commander had deployed missile troops to protect his army's advance. To avoid losing men, your soldiers did not attack and returned.",
    "none",
    [(set_background_mesh, "mesh_pic_charge"),
    ],
    [
      ("defendiendo_3e",[],"Right.",
        [
          (assign, "$g_empieza_campeon", 1),
          (jump_to_menu,"mnu_simple_encounter"),
        ]
      ),
    ]
  ),

("temples",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Rome has various sights. Which to you want to visit?",
  "none",
  [
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("enter_f1",[
      (ge, "$cheat_mode",1),
    ],"Participate in the race",[
      (assign, "$temp1",0),
      (jump_to_menu, "mnu_horse_race"),
    ]),
    ("bacchus",[
      (check_quest_active, "qst_deliver_bribe"),
    ],"Visit the villa of the senator.",[
      (jump_to_menu, "mnu_deliver_bribe"),
    ]),
    ("bacchus",[
      (check_quest_active, "qst_town_trade_2"),
      (quest_slot_eq, "qst_town_trade_2", slot_quest_current_state, 1),
    ],"Visit Lucillus villa.",[
      (jump_to_menu, "mnu_lucillus_villa"),
    ]),
    ("bacchus",[
      (eq, "$g_do_one_more_meeting_with_merchant", 5),
    ],"Visit Gaius Lucarius villa.",[
      (assign, "$town_entered", 1),
      (modify_visitors_at_site, "scn_town_6_room"),
      (reset_visitors),
      (set_jump_mission,"mt_lucillus_peaceful"),
      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_lucillus_peaceful", 1, 0),
        (mission_tpl_entry_set_override_flags, "mt_lucillus_peaceful", 1, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 8, "trp_slave"),
      (set_visitor, 9, "trp_slave_female"),
      (try_begin),
        (gt, "$g_player_chamberlain", 0),
        (call_script, "script_dplmc_appoint_chamberlain"),  #fix for wrong troops after update
        (set_visitor, 12, "$g_player_chamberlain"),
      (try_end),
      (try_begin),
        (gt, "$g_player_constable", 0),
        (call_script, "script_dplmc_appoint_constable"),  #fix for wrong troops after update
        (set_visitor, 13, "$g_player_constable"),
      (try_end),
      (try_begin),
        (gt, "$g_player_chancellor", 0),
        (call_script, "script_dplmc_appoint_chancellor"), #fix for wrong troops after update
        (set_visitor, 14, "$g_player_chancellor"),
      (try_end),
      (jump_to_scene, "scn_town_6_room"),
      (change_screen_mission),
    ]),
    ("bacchus",[
      (troop_slot_eq, "trp_avaritia", slot_troop_spouse, 5),
    ],"Visit Avaritias and Superbus villa.",[
      (assign, "$town_entered", 1),
      (modify_visitors_at_site, "scn_town_6_room"),
      (reset_visitors),
      (set_jump_mission,"mt_lucillus_peaceful"),
      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_lucillus_peaceful", 1, 0),
        (mission_tpl_entry_set_override_flags, "mt_lucillus_peaceful", 1, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 8, "trp_avaritia"),
      (set_visitor, 9, "trp_superbus"),
      (jump_to_scene, "scn_town_6_room"),
      (change_screen_mission),
    ]),
    ("bacchus",[
      (quest_slot_eq, "qst_town_trade_2", slot_quest_current_state, 11),
    ],"Visit Lucillus villa.",[
      (modify_visitors_at_site, "scn_house_2"),
      (reset_visitors),
      (set_jump_mission,"mt_lucillus_peaceful"),
      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_lucillus_peaceful", 1, 0),
        (mission_tpl_entry_set_override_flags, "mt_lucillus_peaceful", 1, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 4, "trp_slave"),
      (set_visitor, 5, "trp_slave_female"),
      (set_visitor, 6, "trp_slave"),
      (set_visitor, 7, "trp_slave_female"),
      (set_visitor, 8, "trp_slave"),
      (set_visitor, 9, "trp_slave_female"),
      (try_begin),
        (gt, "$g_player_chamberlain", 0),
        (call_script, "script_dplmc_appoint_chamberlain"),  #fix for wrong troops after update
        (set_visitor, 12, "$g_player_chamberlain"),
      (try_end),
      (try_begin),
        (gt, "$g_player_constable", 0),
        (call_script, "script_dplmc_appoint_constable"),  #fix for wrong troops after update
        (set_visitor, 13, "$g_player_constable"),
      (try_end),
      (try_begin),
        (gt, "$g_player_chancellor", 0),
        (call_script, "script_dplmc_appoint_chancellor"), #fix for wrong troops after update
        (set_visitor, 14, "$g_player_chancellor"),
      (try_end),
      (jump_to_scene, "scn_house_2"),
      (change_screen_mission),
    ]),
    ("bacchus",[
      (check_quest_active, "qst_widow"),
    ],"Visit Lucia Sabina's house.",[
      (jump_to_menu, "mnu_lucias_house"),
    ]),
    ("bacchus",[
      (troop_slot_eq, "trp_player", slot_troop_religion, worships_christus),
    ],"Visit the Christian underground temple.",[
      (call_script, "script_enter_secret_christian_church", 1),
    ]),
    ("bacchus",[
      (eq, 0, 1),
    ],"Visit the gardens of pleasures.",[
      (troop_get_slot, ":renown", "trp_player", slot_troop_renown),
      (try_begin),
        (ge, ":renown", 250),
        (display_message, "@You are welcomed and you undress."),
        (modify_visitors_at_site,"scn_temple_of_bacchus"),
        (reset_visitors),
        (set_visitor,1,"trp_player"), #player

        (set_visitor,6,"trp_orgie_male1"),
        (set_visitor,7,"trp_orgie_male1"),
        (set_visitor,8,"trp_orgie_male1"),
        (set_visitor,9,"trp_orgie_male1"),
        (set_visitor,10,"trp_orgie_male1"),
        (set_visitor,11,"trp_orgie_male1"),
        (set_visitor,12,"trp_orgie_male1"),
        (set_visitor,13,"trp_orgie_male1"),
        (set_visitor,14,"trp_orgie_fem2"),
        (set_visitor,15,"trp_orgie_fem3"),
        (set_visitor,16,"trp_orgie_fem1"),

        #some music guys
        (store_random_in_range, ":music_guy", tavern_minstrels_begin, tavern_minstrels_end),
        (set_visitor,21,":music_guy"),
        (store_random_in_range, ":music_guy2", tavern_minstrels_begin, tavern_minstrels_end),
        (set_visitor,22,":music_guy2"),

        (set_jump_mission,"mt_orgie"),
        (jump_to_scene, "scn_temple_of_bacchus"),
        (change_screen_mission),
      (else_try),
        (display_message, "@You are not allowed to enter! (need more renown)"),
        (jump_to_menu, "mnu_town"),
      (try_end),
    ]),
    ###for temples: entry 1 player, entry 2 to 4 for priests use 3 for one priest
    ### entry 5 to 23 for people clapping and applauding, entry 24 to 28 are for town_walkers
    ("jupiter",[],"Visit the Temple of Jupiter.",[
      (call_script, "script_visit_temple", "scn_temple_of_jupiter", "trp_roman_priest"),
    ]),
    ("mars",[],"Visit the Temple of Mars.",[
      (call_script, "script_visit_temple", "scn_temple_of_mars", "trp_roman_priest"),
    ]),
    ("aphrodite",[],"Visit the Temple of Aphrodite.",[
      (call_script, "script_visit_temple", "scn_temple_of_aphrodite", "trp_roman_priest_female"),
    ]),
    ("sons_of_zeus",[],"Visit the Temple of Castor and Pollux.",[
      (call_script, "script_visit_temple", "scn_temple_of_castorpollux", "trp_roman_priest"),
    ]),
    ("saturn",[],"Visit the Temple of Saturn.",[
      (call_script, "script_visit_temple", "scn_temple_of_saturn", "trp_roman_priest"),
    ]),
    ("vesta",[],"Visit the Temple of Vesta.",[
      (call_script, "script_visit_temple", "scn_temple_of_vesta", "trp_roman_priest_female"),
    ]),
    ("mithras",[
      (quest_slot_ge, "qst_wlodowiecus_adventure_1", slot_quest_current_state, 6),
    ],"Visit the Temple of Mithras.",[
      (call_script, "script_visit_temple", "scn_temple_of_mithras", "trp_roman_priest"),
    ]),
    ("senate",[
      (assign, ":c", 0),
      (try_begin),
        (eq, "$players_kingdom", "$g_encountered_party_faction"),
        (assign, ":c", 1),
      (else_try),
        (store_relation, ":cur_relation", "fac_player_supporters_faction", "$g_encountered_party_faction"),
        (ge, ":cur_relation", 10),
        (assign, ":c", 1),
      (try_end),
      (eq, ":c", 1),
      (eq, "$current_town", "p_town_6"),
      (party_slot_eq, "$current_town", slot_center_is_besieged_by, -1),#not during a siege
    ],"Visit the Senate",[
      (try_begin),
        # (is_currently_night),
        # (display_message, "str_door_locked"),
      # (else_try),
        (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 10),#at least some support
        (troop_slot_eq, "trp_global_variables", g_senate_event_possible, 0),
        (store_random_in_range, ":ratio_event", 0, 100),
        (is_between, ":ratio_event", 20, 80),
        (troop_set_slot, "trp_global_variables", g_senate_event_possible, 1),
        (try_begin),
        #   (display_message, "@Check0"),
          (neg|check_quest_active, "qst_money_stinks"),
          (quest_slot_eq, "qst_money_stinks", slot_quest_object_state, 0),
        #   (display_message, "@Check1"),
          (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 50),
          (neq, "$g_is_emperor", 1),
          (ge, "$g_rank", 1),
        #  (display_message, "@Check2"),
          (call_script, "script_troop_get_player_relation", "trp_kingdom_7_lord"),
          (ge, reg0, 10),
          # (display_message, "@Check3"),
          (assign, ":event_juice", "mnu_puppius_meet"),
        (else_try),
          (troop_slot_eq, "trp_diggus", slot_troop_bachus, 0),
          (troop_slot_ge, "trp_diggus", slot_troop_met, 1),
          (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 50),
          (assign, ":event_juice", "mnu_event_senate_digus_reveange"),
          (troop_set_slot, "trp_diggus", slot_troop_bachus, 1),
        (else_try),
          (eq, "$senate_events", 0),
          (assign,":event_juice", "mnu_event_senate_01"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 1),
          (assign,":event_juice", "mnu_event_senate_02"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 2),
          (assign,":event_juice", "mnu_event_senate_03"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 3),
          (assign, ":event_juice", "mnu_event_senate_04"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 4),
          (assign, ":event_juice", "mnu_event_senate_05"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 6),
          (assign, ":event_juice", "mnu_event_senate_06"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 7),
          (assign, ":event_juice", "mnu_event_senate_07"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 8),
          (assign, ":event_juice", "mnu_event_senate_08"),
          (val_add, "$senate_events", 1),
        (else_try),
          (eq, "$senate_events", 9),
          (assign, ":event_juice", "mnu_event_senate_09"),
          (val_add, "$senate_events", 1),
        (else_try),
          (store_random_in_range, ":event_juice", "mnu_event_senate_01", "mnu_event_senate_end"),
        (try_end),

        (jump_to_menu, ":event_juice"),
      (else_try),
        (jump_to_menu, "mnu_senatus"),
      (try_end),
    ]),
    ("none",[],"Go back.",[
		  (jump_to_menu, "mnu_town"),
    ]),
]),

  # (
    # "economic",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    # "You try to measure the size of the various fields of this settlement.^Food production: ^Acres of pasture land: {reg10}^\
	# Acres of grain fields: {reg11}^Acres of olive groves: {reg12}^Acres of vineyards: {reg13}^Acres of flax fields: {reg14}^\
	# Acres of date groves: {reg15}^\
	# Head of cattle: {reg16}^\
	# Head of sheep: {reg17}^\
	# Number of horses: {reg18}^\
	# Number of fishing boats: {reg19}^\
	# Number of gardens (cabbages): {reg20}\
	# ",
    # "none",
    # [	(party_get_slot, ":pasture", "$current_town", slot_center_acres_pasture),
		# (party_get_slot, ":grain", "$current_town", slot_center_acres_grain),
		# (party_get_slot, ":olives", "$current_town", slot_center_acres_olives),
		# (party_get_slot, ":vineyards", "$current_town", slot_center_acres_vineyard),
		# (party_get_slot, ":flax", "$current_town", slot_center_acres_flax),
		# (party_get_slot, ":dates", "$current_town", slot_center_acres_dates),
		# (assign, reg10, ":pasture"),
		# (assign, reg11, ":grain"),
		# (assign, reg12, ":olives"),
		# (assign, reg13, ":vineyards"),
		# (assign, reg14, ":flax"),
		# (assign, reg15, ":dates"),

		# (party_get_slot, ":cattle", "$current_town", slot_center_head_cattle),
		# (party_get_slot, ":sheep", "$current_town", slot_center_head_sheep),
		# (party_get_slot, ":horses", "$current_town", slot_center_head_horses),
				# (assign, reg16, ":cattle"),
				# (assign, reg17, ":sheep"),
				# (assign, reg18, ":horses"),
		# (party_get_slot, ":fish", "$current_town", slot_center_fishing_fleet),
		# (party_get_slot, ":gardens", "$current_town", slot_center_household_gardens),
				# (assign, reg19, ":fish"),
				# (assign, reg20, ":gardens"), ],
    # [
      # ("next_page",[],"Next page.",
        # [
          # (jump_to_menu,"mnu_economic_2"),
        # ]
      # ),

      # ("defendiendo_2e",[],"Go back.",
        # [
          # (jump_to_menu,"$g_next_menu"),
        # ]
      # ),
    # ]
  # ),
  # (
    # "economic_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    # "You try to measure the size of the various production sides.\
	# ^Resources production:^^\
	# Number of salt pans: {reg20}^\
	# Number of apiaries: {reg21}^\
	# Number of silk farms: {reg22}^\
	# Number of dye cookers: {reg23}^\
	# Number of iron deposits: {reg24}^\
	# Number of hunters (fur): {reg25}^\
	# Number of soapstone deposits: {reg26}^\
	# Number of amber deposits: {reg27}^\
	# Number of elephant hunters (ivory): {reg28}^\
	# Number of silver deposits: {reg29}^\
	# Number of forests: {reg30}\
	# ",
    # "none",
    # [
		# (party_get_slot, ":salt", "$current_town", slot_center_salt_pans),
		# (assign, reg20, ":salt"),
		# (party_get_slot, ":honey", "$current_town", slot_center_apiaries),
		# (party_get_slot, ":silk", "$current_town", slot_center_silk_farms),
		# (party_get_slot, ":kirmiz", "$current_town", slot_center_kirmiz_farms),
		# (party_get_slot, ":iron", "$current_town", slot_center_iron_deposits),
		# (party_get_slot, ":fur", "$current_town", slot_center_fur_traps),
		# (assign, reg21, ":honey"),
		# (assign, reg22, ":silk"),
		# (assign, reg23, ":kirmiz"),
		# (assign, reg24, ":iron"),
		# (assign, reg25, ":fur"),
		# (party_get_slot, ":soapstone", "$current_town", slot_center_soapstone_depositis),
		# (party_get_slot, ":amber", "$current_town", slot_center_amber_deposits),
		# (party_get_slot, ":ivory", "$current_town", slot_center_walrus_fleet),
		# (party_get_slot, ":silver", "$current_town", slot_center_silver_deposits),
		# (party_get_slot, ":wood", "$current_town", slot_center_forest),
		# (assign, reg26, ":soapstone"),
		# (assign, reg27, ":amber"),
		# (assign, reg28, ":ivory"),
		# (assign, reg29, ":silver"),
		# (assign, reg30, ":wood"),
    # ],
    # [
      # ("next_page",[],"Next page.",
        # [
          # (jump_to_menu,"mnu_economic_3"),
        # ]
      # ),
      # ("defendiendo_2e",[],"Previous page.",
        # [
          # (jump_to_menu,"mnu_economic"),
        # ]
      # ),
    # ]
  # ),
  # (
    # "economic_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    # "You try to measure the size of the various enterprises.\
	# ^Resources production:^^\
	# Number of mills: {reg20}^\
	# Number of breweries: {reg21}^\
	# Number of wine presses: {reg22}^\
	# Number of olive presses: {reg23}^\
	# Number of linen looms: {reg24}^\
	# Number of silk looms: {reg25}^\
	# Number of wool looms: {reg26}^\
	# Number of pottery kilns: {reg27}^\
	# Number of tanneries: {reg28}^\
	# This settlement has accumulated a total capital of {reg29} denars, which can be taxed. The administration has a budget of {reg50} denars for the townwatch and other projects.^\
	# The prosperity rating is {reg51}.",
    # "none",
    # [(party_get_slot, ":mills", "$current_town", slot_center_mills),
		# (assign, reg20, ":mills"),
		# (party_get_slot, ":breweries", "$current_town", slot_center_breweries),
		# (party_get_slot, ":wine", "$current_town", slot_center_wine_presses),
		# (party_get_slot, ":olive_oil", "$current_town", slot_center_olive_presses),
		# (party_get_slot, ":linen", "$current_town", slot_center_linen_looms),
		# (party_get_slot, ":silk_looms", "$current_town", slot_center_silk_looms),
		# (assign, reg21, ":breweries"),
		# (assign, reg22, ":wine"),
		# (assign, reg23, ":olive_oil"),
		# (assign, reg24, ":linen"),
		# (assign, reg25, ":silk_looms"),
		# (party_get_slot, ":wool_looms", "$current_town", slot_center_wool_looms),
		# (party_get_slot, ":pottery", "$current_town", slot_center_pottery_kilns),
		# (party_get_slot, ":tanneries", "$current_town", slot_center_tanneries),
		# (assign, reg26, ":wool_looms"),
		# (assign, reg27, ":pottery"),
		# (assign, reg28, ":tanneries"),
		# (party_get_slot, ":capital", "$current_town", slot_center_capital),
		# (party_get_slot, ":wealth", "$current_town", slot_town_wealth),
		# (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
		# (assign, reg29, ":capital"),
		# (assign, reg50, ":wealth"),
		# (assign, reg51, ":prosperity"),
		# # (assign, ":modified_production",0),
		# # (assign, ":base_production_modded_by_raw_materials",0),
		# # (assign, ":base_production",0),
		# # (try_for_range, ":goods", trade_goods_begin, trade_goods_end),
			# # (call_script, "script_center_get_production", "$current_town", ":goods"),
			# # (val_add, ":modified_production", reg0), #modded by prosperity
			# # (val_add, ":base_production_modded_by_raw_materials", reg1),
			# # (val_add, ":base_production", reg2),
		# # (try_end),

		# # (try_for_range, ":goods", trade_goods_begin, trade_goods_end),
			# # (call_script, "script_center_get_production", "$current_town", ":goods"),
			# # (assign, ":capital", reg0),
			# # (assign, ":wealth", reg1),
			# # (assign, ":prosperity", reg2),

			# # (store_sub, ":item_to_price_slot", slot_town_trade_good_prices_begin, trade_goods_begin),
	        # # (store_add, ":cur_good_price_slot", ":goods", ":item_to_price_slot"),
	        # # (party_get_slot, ":cur_center_price", "$current_town", ":cur_good_price_slot"),
			# # (val_mul, ":capital", ":cur_center_price"),
			# # (val_mul, ":wealth", ":cur_center_price"),
			# # (val_mul, ":prosperity", ":cur_center_price"),

			# # (val_add, ":modified_production", ":capital"), #modded by prosperity
			# # (val_add, ":base_production_modded_by_raw_materials", ":wealth"),
			# # (val_add, ":base_production", ":prosperity"),
		# # (try_end),

		# # (assign, reg33, ":modified_production"),
		# # (assign, reg34, ":base_production_modded_by_raw_materials"),
		# # (assign, reg35, ":base_production"),
		# # (display_message, "@total modified_production: {reg33}"),
		# # (display_message, "@total base_production_modded_by_raw_materials: {reg34}"),
		# # (display_message, "@total base_production: {reg35}"),

		# ],
    # [
	 # ("defendiendo_2e",[],"Previous page.",
        # [
          # (jump_to_menu,"mnu_economic_2"),
        # ]
      # ),
    # ]
  # ),

("goy_enter_domus_augusti",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The Praetorians open the doors and greet you as Caesar Augustus. A golden wreath of laurel is placed on your head, and another on the head of Antonia."
  +" {s10} receives a silver wreath of laurel. Meanwhile, guards are eliminating Nero's most loyal courtiers. Antonia seeks information about Nero and Poppaea Sabina, but none of the guards can provide any details."
  +" She orders a search for them. You, Antonia, and {s10} wander through the palace, eventually spotting Nero. You attempt to apprehend him, successfully trapping him inside the dining room.",
  "none",[
    (set_background_mesh, "mesh_pic_emperor"),
    (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
    (str_store_troop_name, s10, ":goy"),
	],[
    ("continue",[],"Continue.",[
      (play_track, "track_cutscene_to_hades",2),
      (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
      (call_script, "script_activate_main_story_civil_war", ":goy"),

      (display_message, "@You found Nero's lyre!", color_good_news),
      (troop_add_item, "trp_player","itm_lyre_rich",0),
      #36 player
      #39 praetorian centurio
      #11 Poppaea
      #10 Nero
      #40 Tigellinus
      #6 or 7 Acte
      (assign, "$temp3", 0),# used for poppaea
      (assign, "$temp4", 0),#1 Nero banished, 2 Nero killed
      (assign, "$temp4_1", 0),#1 banish, 2 death, 3 divorce
      (assign, "$talk_context", tc_campaign_talk),
      (modify_visitors_at_site,"scn_imperial_dinning_room"),
      (reset_visitors, 0),
      (str_store_string, s68, "str_female_white_face_2"),
      (troop_set_face_keys, "trp_courtier_female", s68, 0),
      (troop_set_face_keys, "trp_courtier_female", s68, 1),
      (set_visitor, 10, "trp_courtier_female"),#acte
      (set_visitor, 36, "trp_player"),
      (set_visitor, 17, "trp_antonia"),

      (set_visitor, 67, ":goy"),
      (set_visitor, 39, "trp_quest_primus_pilus"),#soldier
      (set_visitor, 10, "trp_kingdom_7_lord"),
      (set_visitor, 11, "trp_kingdom_7_lady_1"),
      (set_visitor, 40, "trp_tigellinus"),
      (set_jump_mission, "mt_nero_final"),
      (jump_to_scene, "scn_imperial_dinning_room"),
      (change_screen_mission),
    ]),
]),

("meeting_in_senate",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "After concluding your speech, you receive word that {s25} awaits you at the Senate. He has meticulously drafted a bill for the senators, seeking to officially declare you Princeps."
  +" Your presence is urgently requested, as the wheels of political destiny turn in the hallowed halls of the Senate, poised to shape the future of your imperial ascension.",
  "none",[
    (set_background_mesh, "mesh_pic_emperor"),
    (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
    (str_store_troop_name_link, s25, ":goy"),
    (quest_get_slot, ":pop_or_antonia", "qst_four_emperors", slot_quest_main_antonia_or_poppaea),
    (try_begin),
      (this_or_next|eq, ":pop_or_antonia", "trp_antonia"),
      (eq, ":pop_or_antonia", "trp_kingdom_7_lady_1"),
      (str_store_troop_name, s11, ":pop_or_antonia"),
      (str_store_string, s20, "@You and {s11} walk to the Curia Julia."),
    (else_try),
      (str_store_string, s20, "@You walk to the Curia Julia."),
    (try_end),
	],[
    ("continue",[],"Continue.",[
      (modify_visitors_at_site,"scn_senate"),
      (reset_visitors, 0),
      (quest_get_slot, ":pop_or_antonia", "qst_four_emperors", slot_quest_main_antonia_or_poppaea),
      (set_visitors, 0, ":pop_or_antonia", 1),
      (set_visitors, 0, "trp_player", 1),
      (set_visitors, 1, "trp_aux_cav_praetoriani_2", 3),
      (set_visitors, 2, "trp_aux_cav_praetoriani_2", 3),

      (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
      (set_visitors, 3, "trp_praetoriani_milites", 1),
      (set_visitors, 4, "trp_praetoriani_milites", 1),
      (set_visitors, 50, ":goy", 1),
      (set_visitors, 51, "trp_praetoriani_milites", 1),
      (set_visitors, 51, "trp_praetoriani_milites", 1),
      (set_jump_mission, "mt_kill_supporters"),
      (jump_to_scene, "scn_senate"),
      (change_screen_mission),
    ]),
]),

("meeting_with_centurio_2", mnf_disable_all_keys,
  "The traitor met his demise amidst the clash. Now, you've directed the Praetorian guard to intensify their efforts in rooting out any remaining traitors and loyalists to {s22}."
  +" However, a fresh challenge looms from the North: {s21}, seizing upon the unrest in Roma, has been proclaimed Caesar by the Rhine legions. His march towards Roma is imminent."
  +" Preparations for battle are imperative. It would be prudent to swiftly bolster your forces by recruiting a new legion.^^You have 30 days to prepare yourself."
  +"^^{s23}",
  "none",[
    (quest_get_slot, ":pop_or_antonia", "qst_four_emperors", slot_quest_main_antonia_or_poppaea),
    (try_begin),
      (this_or_next|eq, ":pop_or_antonia", "trp_antonia"),
      (eq, ":pop_or_antonia", "trp_kingdom_7_lady_1"),
      (str_store_troop_name, s24, ":pop_or_antonia"),
      (str_store_string, s23, "@Nevertheless, amidst the tumult, a moment of respite beckons. {s24} eagerly anticipates your presence in the Domus Augusti, where discussions regarding your marriage await."),
    (else_try),
      (str_clear, s23),
    (try_end),

    (store_current_day, reg1),
    (val_max, reg1, 1),
    (quest_set_slot, "qst_four_emperors", slot_quest_timer, reg1),

    (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
    (str_store_troop_name, s22, ":goy"),
    (try_begin),
      (eq, ":goy", "trp_senator_2"),
      (assign, ":other_goy", "trp_statthalter_9"),
    (else_try),
      (eq, ":goy", "trp_statthalter_9"),
      (assign, ":other_goy", "trp_senator_2"),
    (try_end),
    (str_store_troop_name, s21, ":other_goy"),
    (set_background_mesh, "mesh_pic_emperor"),

    (display_message, "str_quest_updated"),
    (str_store_troop_name_link, s24, ":other_goy"),
    (add_quest_note_from_sreg, "qst_blank_quest_19", 9, "@You have been declared Caesar Augustus by the Praetorian guard.", 1),
    (add_quest_note_from_sreg, "qst_blank_quest_19", 10, "@{s24} is challenging your claim and has been declared Caesar by the Rhine legions.", 1),
    (add_quest_note_from_sreg, "qst_four_emperors", 5, "@{s24} will march with the Rhine legions towards Rome. You have 30 days to prepare yourself for battle.", 1),
    (add_xp_as_reward, 2500),
  ],[
    ("Continue...",[],"Continue.",[
      (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
      (call_script, "script_kill_lord_lady", ":goy", "trp_player", 0),

      (quest_get_slot, ":pop_or_antonia", "qst_four_emperors", slot_quest_main_antonia_or_poppaea),

      (try_begin),
        (gt, ":pop_or_antonia", 0),
        (assign, "$temp4", 0), # state of situation: 0 start of conversation,
        (assign, "$temp3", -1), # poppaea agent number
        (assign, "$temp1", 0), # fate of antonia
        (assign, "$temp2", 0), # player stab

        (set_jump_mission, "mt_vespasian_final_dialogue"),
        (modify_visitors_at_site,"scn_imperial_palace"),
        (reset_visitors),

        (try_begin),
          (eq, ":pop_or_antonia", "trp_antonia"),
          (set_visitor, 17, "trp_quest_primus_pilus"),
        (try_end),
        (set_visitor, 18, "trp_player"),
        (set_visitor, 19, ":pop_or_antonia"),

        (jump_to_scene, "scn_imperial_palace"),
        (change_screen_mission),
      (else_try),
        (jump_to_menu, "mnu_auto_return_map"),
      (try_end),
    ]),
]),

("meeting_with_centurio_3", mnf_disable_all_keys,
  "Today the Roman population sees a rare spectacle: At first, the former praefectus urbi, who was well known for his cruelty, is burned alive."
  +" Then the people can watch how {s34} {s33}^^{s20}",
  "none",[
    (quest_get_slot, ":pop_or_antonia", "qst_four_emperors", slot_quest_main_antonia_or_poppaea),
    (try_begin),
      (this_or_next|eq, ":pop_or_antonia", "trp_antonia"),
      (eq, ":pop_or_antonia", "trp_kingdom_7_lady_1"),
      (str_store_troop_name, s11, ":pop_or_antonia"),
      (str_store_string, s20, "@{s11} has prepared a short speech which you will hold in front of the people of Rome."),
    (else_try),
      (str_store_string, s20, "@You prepare a short speech and make yourself ready to hold it in front of the people of Rome."),
    (try_end),

    (set_background_mesh, "mesh_pic_palast"),
    #first kill Tigellinus
    (troop_set_slot, "trp_tigellinus", slot_troop_occupation, dplmc_slto_dead),
    (assign, "$praefectus_urbani", -1),
    ##apply decisions
    (try_begin), # antonia
      (eq, "$temp4_1", -1),
      (str_store_troop_name_link, s21, "trp_antonia"),
      (display_log_message, "@{s21} has been killed by you!"),
      (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@You killed {s21} with your gladius.", 1),
      (call_script, "script_kill_lord_lady", "trp_antonia", "trp_player", 0),
      (str_store_string, s33, "str_antonia_dead"),
    (else_try),#Poppaea
      (eq, "$temp4_1", 2),#death
      (quest_set_slot, "qst_blank_quest_19", slot_quest_main_poppaea_fate, 1),
      (str_store_troop_name_link, s21, "trp_kingdom_7_lady_1"),
      (display_log_message, "@{s21} has been executed on your orders!"),
      (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On your orders, {s21} was executed.", 1),
      (call_script, "script_kill_lord_lady", "trp_kingdom_7_lady_1", "trp_player", 0),
      (str_store_string, s33, "str_poppaea_dead"),
    (else_try),
      (eq, "$temp4_1", 1),#banish
      (quest_set_slot, "qst_blank_quest_19", slot_quest_main_poppaea_fate, 2),
      (str_store_troop_name_link, s21, "trp_kingdom_7_lady_1"),
      (display_log_message, "@{s21} was banned from the Roman Empire."),
      (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On your orders, {s21} was banished from the Roman Empire.", 1),
      (troop_set_slot, "trp_kingdom_7_lady_1", slot_troop_occupation, dplmc_slto_exile),
      (call_script, "script_change_troop_faction", "trp_kingdom_7_lady_1", "fac_outlaws"),
      (str_store_string, s33, "str_poppaea_banished"),
    (else_try),
      (quest_set_slot, "qst_blank_quest_19", slot_quest_main_poppaea_fate, 3),
      (str_store_troop_name_link, s21, "trp_kingdom_7_lady_1"),
      (display_log_message, "@{s21} returns to her family."),
      (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On your orders, {s21} was banished from Rome.", 1),

      (troop_remove_item, "trp_kingdom_7_lady_1", "itm_female_caligea_gold"),
      (troop_remove_item, "trp_kingdom_7_lady_1", "itm_female_crown"),
      (troop_remove_item, "trp_kingdom_7_lady_1", "itm_roman_female_augusta"),

      (troop_add_item, "trp_kingdom_7_lady_1", "itm_caligea"),
      (troop_add_item, "trp_kingdom_7_lady_1", "itm_roman_noble_dress_2"),
      (troop_equip_items, "trp_kingdom_7_lady_1"),

      (store_current_day, ":day"),
      (quest_set_slot, "qst_blank_quest_19", slot_quest_main_poppaea_timer, ":day"),
      (str_store_string, s33, "str_poppaea_divorced"),
    (try_end),

    (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
    (try_begin),
      (eq, ":goy", "trp_senator_2"),
      (assign, ":other_goy", "trp_statthalter_9"),
    (else_try),
      (eq, ":goy", "trp_statthalter_9"),
      (assign, ":other_goy", "trp_senator_2"),
    (try_end),
    (call_script, "script_usurp_faction", ":other_goy", "fac_kingdom_7"),

    (call_script, "script_troop_set_title_according_to_faction", "trp_kingdom_7_lady_1", "fac_kingdom_7"),

    (try_begin),
      (this_or_next|eq, "$temp4_1", 1),
      (eq, "$temp4_1", 2),
      (troop_set_slot, "trp_kingdom_7_lady_1", slot_troop_occupation, dplmc_slto_dead),
      (call_script, "script_change_relation_with_family_friends_enemies", "trp_kingdom_7_lady_1", -1, 30, "trp_player"),
    (try_end),

    (try_begin),##Nero
      (eq, "$temp4", 2),#death
      (display_log_message, "@Nero has been executed on your orders!"),
      (str_store_string, s34, "str_nero_dead"),
    (else_try),
      (eq, "$temp4", 1),#banish
      (str_store_string, s34, "str_nero_banished"),
      (troop_set_slot, "trp_kingdom_7_lord", slot_troop_occupation, dplmc_slto_exile),
      (call_script, "script_change_troop_faction", "trp_kingdom_7_lord", "fac_outlaws"),
    (try_end),

    # #####Remove Neros party
    # (troop_get_slot, ":king_party", "trp_kingdom_7_lord", slot_troop_leaded_party),
    # (try_begin),
    #   (party_is_active, ":king_party"),
    #   (ge, ":king_party", 0),
    #   (remove_party,":king_party"),
    # (try_end),
    # ##he dies either way
    # (troop_set_slot, "trp_kingdom_7_lord", slot_troop_occupation, dplmc_slto_dead),

    # #divorce them
    # (troop_set_slot, "trp_kingdom_7_lord", slot_troop_leaded_party, -1),
    # (troop_set_slot, "trp_kingdom_7_lord", slot_troop_spouse, -1),
    # (troop_set_slot, "trp_kingdom_7_lord", slot_troop_cur_center, -1),
    # (troop_set_slot, "trp_kingdom_7_lord", slot_troop_home, -1),

    # (troop_set_slot, "trp_kingdom_7_lady_1", slot_troop_cur_center, -1),
    # (troop_set_slot, "trp_kingdom_7_lady_1", slot_troop_home, -1),
    # (troop_set_slot, "trp_kingdom_7_lady_1", slot_troop_spouse, -1),

    # (call_script, "script_troop_set_title_according_to_faction", "trp_kingdom_7_lady_1", "fac_kingdom_7"),

    # (complete_quest, "qst_blank_quest_2"),
    # (call_script, "script_give_center_to_lord", "p_town_6", "trp_player", 0),

    # (assign, "$g_player_court", "p_town_6"),
    #(call_script, "script_add_log_entry", logent_renounced_allegiance,   "trp_player",  -1, "$g_talk_troop", "$g_talk_troop_faction"),
    # (call_script, "script_player_leave_faction", 0), #"1" would mean give back fiefs
    # (call_script, "script_activate_player_faction", "trp_player"), #Activating player faction should now work
    # #					(call_script, "script_appoint_faction_marshall", "$players_kingdom", "trp_player"), #Keep commented. May be unnecessary.
    # (call_script, "script_change_player_honor", -25),
    # (assign, "$g_fire", 3),
    # (try_begin),
    # (eq, "$temp4", 1),
    # (call_script,"script_change_troop_faction","trp_aux_commander_12","$players_kingdom"),
    # (troop_set_slot, "trp_aux_commander_12", slot_troop_occupation, slto_kingdom_hero),
    # (display_message, "@Germanicus, the brother of Poppaea Sabina, recieved the letter and is not very happy about it. It seems, he accepts your demand."),
    # (call_script, "script_change_player_relation_with_troop", "trp_aux_commander_12", -30),
    # (display_message, "@Poppaea Sabina is not very amused as she hears from your shameful demands."),
    # (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_1", -30),
    # (call_script, "script_change_player_honor", -5),
    # (try_end),
    (call_script, "script_update_all_notes"),
  ],[

    ("Continue...",[],"Continue...",[
      #1,2 player antonia,
      #3-10: guards
      #11-36 people
      #37 camera
      (play_track, "track_trailer_2", 2),

      (set_jump_mission, "mt_cutscene_rome_speech"),
      (modify_visitors_at_site, "scn_cutscene_rome_victory_2"),
      (reset_visitors),

      (set_visitor, 0, "trp_player"),
      (try_begin),
          (eq,"$character_gender", tf_female),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_female),
      (else_try),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_male),
      (try_end),
      (str_store_troop_face_keys, s1, "trp_player"),
      (troop_set_face_keys, "trp_multiplayer_profile_troop_male", s1),
      (call_script, "script_dplmc_copy_inventory", "trp_player", "trp_multiplayer_profile_troop_male"),

      (set_visitor, 1, "trp_multiplayer_profile_troop_male"),

      (quest_get_slot, ":pop_or_antonia", "qst_four_emperors", slot_quest_main_antonia_or_poppaea),
      (set_visitor, 2, ":pop_or_antonia"),
      (set_visitor, 3, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 4, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 5, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 6, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 7, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 8, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 9, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 10, "trp_aux_cav_praetoriani_2"),

      (try_for_range, ":entry", 11, 36),
          (set_visitors, ":entry", "trp_roman_town_walker_female", 5),
          (set_visitors, ":entry", "trp_roman_town_walker", 5),
      (try_end),

      (assign, "$tutorial_state", 0),
      (assign, "$g_next_menu", "mnu_meeting_in_senate"),

      (jump_to_scene, "scn_cutscene_rome_victory_2"),
      (change_screen_mission),
    ]),
]),

("message_travel_to_rome", mnf_disable_all_keys,
  "You recieve message from {s25}:"
  +"^^Dear {playername}, travel to Roma as fast as possible. {s22} has crossed the Alps and is marching towards Roma! Battle awaits us.",
  "none",[
    (str_store_troop_name, s25, "$g_player_minister"),
    (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
    (try_begin),
      (eq, ":goy", "trp_senator_2"),
      (assign, ":other_goy", "trp_statthalter_9"),
    (else_try),
      (eq, ":goy", "trp_statthalter_9"),
      (assign, ":other_goy", "trp_senator_2"),
    (try_end),
    (str_store_troop_name, s22, ":other_goy"),
    (set_background_mesh, "mesh_pic_emperor"),

    (display_message, "str_quest_updated"),
    (str_store_party_name_link, s10, "p_town_6"),
    (str_store_troop_name_link, s24, ":other_goy"),
    (add_quest_note_from_sreg, "qst_blank_quest_19", 9, "@You have been declared Caesar Augustus by the Praetorian guard. However, {s24} is challenging your claim and marching towards {s10}. Travel to {s10} as fast as possible.", 1),
    (add_quest_note_from_sreg, "qst_four_emperors", 5, "@{s24} is marching with the Rhine legions towards Rome. Travel to {s10} as fast as possible to meet them in battle.", 1),
    (add_xp_as_reward, 2500),
    (set_background_mesh, "mesh_pic_emperor"),
  ],[
  ("Continue...",[],"Continue...",[
    (play_track, "track_cutscene_to_hades",2),
    (quest_set_slot, "qst_four_emperors", slot_quest_timer, -1),
    (quest_set_slot, "qst_four_emperors", slot_quest_current_state, 12),
    (call_script, "script_diplomacy_start_war_between_kingdoms", "$players_kingdom", "fac_kingdom_7", logent_faction_declares_war_to_end_civil_war),
    (jump_to_menu, "mnu_auto_return_map"),
  ]),
]),

# ("become_emperor",menu_text_color(0xFF000000)|mnf_disable_all_keys,
#   "After Rome has fallen to you, the Praetorian Guard calls you the new Caesar Augustus. As you march through the streets of Rome, people cheer. ^^"
#   +" But: To strengthen your power you should persuade the senate to justify your rule!^^"
#   +" It is also a good idea to visit the Imperial Palace located in Rome. There you have the possibility to talk with special advisers. They can help you to govern the Empire.",
#   "none",[
# 	  (set_background_mesh, "mesh_pic_emperor"),
#   ],[
#     ("glory",[],"Glory to the new Caesar Augustus! Hehe Me!",[
#       ##if player has no banner
#       (try_begin),
#         (troop_slot_eq, "trp_player", slot_troop_banner_scene_prop, 0),
#         (assign, ":cur_banner_mesh", "mesh_banner_kingdom_7"),
#         (faction_set_slot, "fac_player_faction", slot_faction_banner, ":cur_banner_mesh"),
#         (faction_set_slot, "fac_player_supporters_faction", slot_faction_banner, ":cur_banner_mesh"),
#         (store_sub, ":selected_banner", ":cur_banner_mesh", banner_meshes_begin),
#         (store_add, ":selected_banner_map_icon", ":selected_banner", banner_map_icons_begin),
#         (party_set_banner_icon, "p_main_party", ":selected_banner_map_icon"),

#         (store_add, ":selected_banner_spr", ":selected_banner", banner_scene_props_begin),
#         (troop_set_slot, "trp_player", slot_troop_banner_scene_prop, ":selected_banner_spr"),
#         ##all use faction banners
#         (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
#             (store_faction_of_troop, ":faction_lord", ":lord"),
#             (eq, ":faction_lord", "$players_kingdom"),
#             (troop_set_slot, ":lord", slot_troop_banner_scene_prop, ":selected_banner_spr"),
#             (try_begin),
#                 (troop_get_slot, ":leaded_party_lord", ":lord", slot_troop_leaded_party),
#                 (gt, ":leaded_party_lord", 0),
#                 (party_is_active, ":leaded_party_lord"),
#                 (party_set_banner_icon, ":leaded_party_lord", ":selected_banner_map_icon"),
#             (try_end),
#         (try_end),
#         (try_for_range, ":cur_center", walled_centers_begin, walled_centers_end),
#         ##all use faction banners
#           (this_or_next|party_slot_eq, ":cur_center", slot_town_lord, "trp_player"),
#           (store_faction_of_party, ":fac", ":cur_center"),
#           (eq, ":fac", "$players_kingdom"),
#           (party_set_banner_icon, ":cur_center", ":selected_banner_map_icon"),
#         (try_end),
#       (try_end),

#       (try_begin),#####Kill Nero if not already done
#         (eq, "$temp", 20),
#         (troop_get_slot, ":king_party", "trp_kingdom_7_lord", slot_troop_leaded_party),
#         (try_begin),
#           (party_is_active, ":king_party"),
#           (ge, ":king_party", 0),
#           (remove_party,":king_party"),
#         (try_end),
#         (display_log_message, "@Nero and his wife, Poppaea Sabina, have been killed by your troops!"),
#         (display_log_message, "@You take over the imperial treasure."),

#         (troop_get_slot, ":gold", "trp_kingdom_7_lord", slot_troop_wealth),
#         (val_mul, ":gold", 2),
#         (val_div, ":gold", 3),
#         (troop_add_gold, "trp_player", ":gold"),
#         (troop_set_slot, "trp_kingdom_7_lord", slot_troop_wealth, 0),#set it to 0

#         (troop_set_slot, "trp_kingdom_7_lord", slot_troop_leaded_party, -1),
#         (troop_set_slot, "trp_kingdom_7_lord", slot_troop_occupation, dplmc_slto_dead),
#         (troop_set_slot, "trp_kingdom_7_lady_1", slot_troop_occupation, dplmc_slto_dead),
#         (troop_set_slot, "trp_kingdom_7_lady_1", slot_troop_cur_center, -1),
#         (troop_set_slot, "trp_kingdom_7_lady_1", slot_troop_home, -1),

#         (troop_set_slot, "trp_kingdom_7_lord", slot_troop_cur_center, -1),
#         (troop_set_slot, "trp_kingdom_7_lord", slot_troop_home, -1),
#         (call_script, "script_update_troop_location_notes", "trp_kingdom_7_lord", 0),
#         (call_script, "script_update_troop_location_notes", "trp_kingdom_7_lady_1", 0),
#       (try_end),

#       (try_for_range, ":center", villages_begin, villages_end),##Nero is no longer lord, remove all his holdings
#         (party_slot_eq, ":center", slot_town_lord, "trp_kingdom_7_lord"),
#         (party_set_slot, ":center", slot_town_lord, stl_unassigned),
#         (str_store_party_name, s1, ":center"),
#         (display_message, "@Nero lost ownership of {s1}."),
#       (try_end),

#       (try_for_range, ":walled_center", walled_centers_begin, walled_centers_end),##Nero is no longer lord, player gains all his holdings
#         (party_slot_eq, ":walled_center", slot_town_lord, "trp_kingdom_7_lord"),
#         (call_script, "script_give_center_to_faction", ":walled_center", "$players_kingdom"),
#         (display_message, "@You took over ownership of {s1}."),
#       (try_end),

#       (faction_set_slot, "fac_player_supporters_faction",  slot_faction_culture, "fac_culture_7"),
#       (faction_set_slot, "fac_player_faction",  slot_faction_culture, "fac_culture_7"),

#       (display_log_message, "@You call yourself an illegitimate son of Claudius to justify your claim."),
#       #setting up same fake father for both
#       (store_mul, ":same_father", "trp_kingdom_7_lord", DPLMC_VIRTUAL_RELATIVE_MULTIPLIER),#defined in module_constants.py
#       (val_add, ":same_father", DPLMC_VIRTUAL_RELATIVE_FATHER_OFFSET),#defined in module_constants.py
#       (troop_set_slot, "trp_player", slot_troop_father, ":same_father"),
#       (troop_set_slot, "trp_kingdom_7_lord", slot_troop_father, ":same_father"),

#       (try_begin),###If player is doing the quest, Praetorians will join him.
#         (neq, "$temp", 20),
#         (troop_slot_eq, "trp_legatus_12", slot_troop_occupation, slto_kingdom_hero),
#         (call_script,"script_change_troop_faction","trp_legatus_12","$players_kingdom"),
#         (troop_set_slot, "trp_legatus_12", slot_troop_occupation, slto_kingdom_hero),
#       (try_end),

#       ##Affiliated family will always join
#       (try_for_range, ":npc", "trp_knight_1_1", "trp_knight_1_1_wife"),
#         (troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_hero),
#         (gt, "$g_player_affiliated_troop", 1),
#         (call_script, "script_dplmc_is_affiliated_family_member", ":npc"),
#         (ge, reg0, 1),
#         (store_faction_of_troop, ":fac", ":npc"),
#         (eq, ":fac", "fac_kingdom_7"),
#         (str_store_troop_name, s29, ":npc"),
#         (call_script,"script_change_troop_faction",":npc","$players_kingdom"),
#         (troop_set_slot, ":npc", slot_troop_occupation, slto_kingdom_hero),
#         (display_message, "@{s29} joins your case as you are affiliated to his family.", message_positive),
#       (try_end),

#       (assign, ":enemies", 0),
#       (try_for_range,":npc","trp_legatus_1","trp_legatus_12"),
#         (troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_hero),
#         (store_faction_of_troop, ":fac", ":npc"),
#         (eq, ":fac", "fac_kingdom_7"),
#         (call_script, "script_troop_get_player_relation", ":npc"),
#         (assign, ":player_relation", reg0),
#         (try_begin),
#           (gt, ":player_relation", 15), # and at least more than 15 relation
#           (troop_get_slot, ":renown_player", "trp_player", slot_troop_renown), ##player must have more renown
#           (troop_get_slot, ":renown_npc", ":npc", slot_troop_renown),
#           (troop_get_slot, ":support", "trp_senator_dummy", slot_senate_support),
#           (val_add, ":renown_player", ":support"),
#           (gt, ":renown_player", ":renown_npc"),
#           (call_script,"script_change_troop_faction",":npc","$players_kingdom"),
#           (troop_set_slot, ":npc", slot_troop_occupation, slto_kingdom_hero),
#           (store_random_in_range,":new_relation",2,10),
#           (call_script, "script_troop_change_relation_with_troop", "trp_player", ":npc", ":new_relation"),
#         (else_try),
#           (ge, ":player_relation", 90),#always join if they love player
#           (call_script,"script_change_troop_faction",":npc","$players_kingdom"),
#           (troop_set_slot, ":npc", slot_troop_occupation, slto_kingdom_hero),
#         (else_try),
#           (str_clear, s40),
#           (str_store_troop_name, s40, ":npc"),
#           (display_message, "@{s40} will fight you!", message_negative),
#           (call_script, "script_troop_change_relation_with_troop", "trp_player", ":npc", -5),
#           (val_add, ":enemies", 1),
#         (try_end),
#       (try_end),

#       (try_begin),
#           (eq, ":enemies", 0),
#           (try_for_range, ":npc", "trp_aux_commander_1", "trp_knight_1_1_wife"),
#             (troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_hero),
#             (call_script,"script_change_troop_faction",":npc","$players_kingdom"),
#             (troop_set_slot, ":npc", slot_troop_occupation, slto_kingdom_hero),
#             (store_random_in_range,":new_relation",0,4),
#             (call_script, "script_troop_change_relation_with_troop", "trp_player", ":npc", ":new_relation"),
#           (try_end),
#       (try_end),

#       (try_for_range, ":npc", "trp_aux_commander_1", "trp_statthalter_1"),
#           (troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_hero),
#           (store_faction_of_troop, ":fac", ":npc"),
#           (eq, ":fac", "fac_kingdom_7"),
#           (gt, ":enemies", 0),
#           (try_begin),
#               (call_script, "script_troop_get_player_relation", ":npc"),
#               (assign, ":relation", reg0),
#               (ge, ":relation", 1),
#               (try_begin),##either relation is high
#                 (ge, ":relation", 90),
#                 (assign, ":c", 1),
#               (else_try),
#                 (assign, ":c", 0),
#               (try_end),
#               (try_begin), ## or if not
#                 (neq, ":c", 1),
#                 (troop_get_slot, ":support", "trp_senator_dummy", slot_senate_support),
#                 (try_begin),
#                   (le, "$g_unrest", 15),
#                   (store_random_in_range, ":r", 0, 400),
#                   (le, ":r",":support"),
#                   (assign, ":c", 1),
#                 (else_try),
#                   (le, "$g_unrest", 30),
#                   (store_random_in_range, ":r", 0, 300),
#                   (le, ":r",":support"),
#                   (assign, ":c", 1),
#                 (else_try),
#                   (le, "$g_unrest", 50),
#                   (store_random_in_range, ":r", 0, 250),
#                   (le, ":r",":support"),
#                   (assign, ":c", 1),
#                 (else_try),
#                   (le, "$g_unrest", 75),
#                   (store_random_in_range, ":r", 0, 200),
#                   (le, ":r",":support"),
#                   (assign, ":c", 1),
#                 (else_try),
#                   (le, "$g_unrest", 100),
#                   (store_random_in_range, ":r", 0, 175),
#                   (le, ":r",":support"),
#                   (assign, ":c", 1),
#                 (else_try),
#                   (store_random_in_range, ":r", 0, 150),
#                   (le, ":r",":support"),
#                   (assign, ":c", 1),
#                 (try_end),
#               (try_end),

#               (eq, ":c", 1),
#               (call_script,"script_change_troop_faction",":npc","$players_kingdom"),
#               (troop_set_slot, ":npc", slot_troop_occupation, slto_kingdom_hero),
#               (store_random_in_range,":new_relation",4,10),
#               (call_script, "script_troop_change_relation_with_troop", "trp_player", ":npc", ":new_relation"),
#           (try_end),
#       (try_end),

#       (try_for_range, ":npc", "trp_statthalter_1", "trp_knight_1_1_wife"),
#           (troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_hero),
#           (store_faction_of_troop, ":fac", ":npc"),
#           (eq, ":fac", "fac_kingdom_7"),
#           (gt, ":enemies", 0),
#           (try_begin),
#               (call_script, "script_troop_get_player_relation", ":npc"),
#               (gt, reg0, 10),#was 40
#               (store_random_in_range, ":r", 0, 80),
#               (is_between, ":r", 0, "$g_unrest"),
#               (call_script,"script_change_troop_faction",":npc","$players_kingdom"),
#               (troop_set_slot, ":npc", slot_troop_occupation, slto_kingdom_hero),
#               (store_random_in_range,":new_relation",0,10),
#               (call_script, "script_troop_change_relation_with_troop", "trp_player", ":npc", ":new_relation"),
#           (try_end),
#       (try_end),

#       (try_begin),
#         (eq, ":enemies", 0),
#         (try_for_range, ":npc", "trp_knight_1_1", "trp_legatus_1"),
#           (troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_hero),
#           (store_faction_of_troop, ":fac", ":npc"),
#           (eq, ":fac", "fac_kingdom_7"),
#           (call_script,"script_change_troop_faction",":npc","$players_kingdom"),
#           (troop_set_slot, ":npc", slot_troop_occupation, slto_kingdom_hero),
#         (try_end),
#       (try_end),

#       (call_script, "script_update_faction_notes","$players_kingdom"),
#       (call_script, "script_change_player_right_to_rule", 1),

#       (call_script, "script_become_emperor", ":enemies"),

#       (add_quest_note_from_sreg, "qst_blank_quest_19", 1, "@Nunc videmus optabilem mortem fuisse cum gloria.", 0),
#       (add_quest_note_from_sreg, "qst_blank_quest_19", 2, "@They say luck is with the bravest, so am I the bravest man in the world?", 0),
#       ##set all honorary titles to 0, player can assign them later
#       (display_message, "@All honorary titles have been revoked!"),
#       (try_for_range, ":npcs", active_npcs_begin, active_npcs_end),
#         (troop_set_slot, ":npcs", slot_troop_honorary_title, 0),
#       (try_end),

#       (call_script, "script_change_troop_controversy", "trp_player", 100),
#       (try_begin),##decide if civil war starts
#         (eq, ":enemies", 0),
#         (faction_set_slot, "fac_kingdom_7", slot_faction_state, sfs_inactive),
#         (assign, "$g_civil_war", -1),##set it -1, otherwise features wont be available
#         (call_script, "script_update_all_notes"),
#         (change_screen_map),
#       (else_try),
#         (call_script, "script_diplomacy_start_war_between_kingdoms", "$players_kingdom", "fac_kingdom_7", 1),
#         (display_log_message, "@A Civil war has started in the Imperium Romanum", message_negative),
#         (jump_to_menu, "mnu_civil_war"),
#       (try_end),
#     ]),
# ]),

("civil_war",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "An Empire divided^^Not all Roman generals accept you as new Caesar Augustus. {s44}, this traitor, has called himself Caesar Augustus too!^^Civil war starts!",
  "none",[
    (set_background_mesh, "mesh_pic_emperor"),
         # find best candidate to become king
        (assign, ":best_troop", -1),
        (assign, ":best_renown", -1),
        (try_for_range, ":troop", original_kingdom_heroes_begin, active_npcs_end),
          (store_troop_faction, ":faction", ":troop"),
          (eq, ":faction", "fac_kingdom_7"),
          (troop_slot_eq, ":troop", slot_troop_occupation, slto_kingdom_hero),  #only other heros of this faction may become the king
          (troop_get_slot, ":renown", ":troop", slot_troop_renown),#renown
          (troop_get_slot, ":wealth", ":troop", slot_troop_wealth),#wealth
          (val_add, ":renown", ":wealth"),
          (troop_slot_ge, ":troop", slot_troop_legion, 1),
          (gt, ":renown", ":best_renown"),
          (assign, ":best_troop", ":troop"),
          (assign, ":best_renown", ":renown"),
        (try_end),

        (try_begin),
          # check if a candidate was found
          (neq, ":best_troop", -1),

          # make them king
          (faction_set_slot, "fac_kingdom_7", slot_faction_leader, ":best_troop"),
            (assign, "$g_civil_war", ":best_troop"),
          # announce it!
          #TODO: generate a presentation for this! (start_presentation, "prsnt_enemy_succession"),
          (str_store_troop_name, s1, ":best_troop"),
          (display_log_message, "@{s1} calls himself Caesar Augustus, Princeps of Rome!", 0xFFFF2222),
          (call_script, "script_troop_set_title_according_to_faction", ":best_troop", "fac_kingdom_7"),
        (try_end),
      (str_store_troop_name_link, s1, ":best_troop"),
      (str_store_troop_name, s44, ":best_troop"),
      (setup_quest_text,  "qst_blank_quest_3"),
      (str_store_string, s2, "@Win the civil wat either by defeating all your enemies or by capturing the enemy Princeps.\
 If you have capture the enemy Princeps, {s1}, bring him before the senate in Rome and declare yourself victor. (You must have him in your party as prisoner!)^\
 Additionally, you must be on the winning the war! Otherwise your enemies won't accept a peace!"),
      (call_script, "script_start_quest", "qst_blank_quest_3", "trp_fortuna"),
      (call_script, "script_update_all_notes"),
    ],
    [
     ("answere_1",[],"Damn it!",
       [

        (change_screen_map),
		],
       ),

    ]
),

# ("end_civil_war",menu_text_color(0xFF000000)|mnf_disable_all_keys,
#     "End of the Civil war^\
# 	Finally you captured this rat. Now you can end the war. Now you are the only true Imperator Caesar Augustus, Princeps of Rome.",
#     "none",
#     [(set_background_mesh, "mesh_pic_triumph"),],
#     [
#      ("answere_1",[],"Victory!",
#        [
# 		(faction_set_slot, "fac_kingdom_7", slot_faction_leader, "trp_kingdom_7_lord"),
# 		(complete_quest,  "qst_blank_quest_3"),
# 		(assign, "$g_civil_war", -1),

#         (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
#             (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),
#             (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_exile),
# 			(store_troop_faction, ":faction", ":npc"),
# 			(eq, ":faction", "fac_kingdom_7"),
# 			(try_begin),
# 			  (eq, ":npc", "trp_kingdom_7_lord"),
# 			  (troop_set_slot, ":npc", slot_troop_occupation, dplmc_slto_dead),
# 			(else_try),
# 			  (call_script,"script_change_troop_faction",":npc","$players_kingdom"),
#               (troop_set_slot, ":npc", slot_troop_occupation, slto_kingdom_hero),
# 			(try_end),
# 			(store_random_in_range,":new_relation",5,10),
# 			(call_script, "script_troop_change_relation_with_troop", "trp_player", ":npc", ":new_relation"),
# 		(try_end),
#         (try_for_range, ":walled_centers", walled_centers_begin, walled_centers_end),
#           (store_faction_of_party, ":fac", ":walled_centers"),
#           (eq, ":fac", "fac_kingdom_7"),
#           (call_script, "script_give_center_to_faction_aux", ":walled_centers", "$players_kingdom"),
#         (try_end),
# 		(call_script, "script_change_player_right_to_rule", 5),
# 		(faction_set_slot, "fac_kingdom_7", slot_faction_state, sfs_inactive),
# 		(call_script, "script_update_all_notes"),
# 		(display_log_message, "@The civil war ends. Hopefully the Imperium Romanum will become peaceful again."),

#     ##if a rebellion happens in roman land and meanwhile the player wins the civil war, player faction is then probably not at war with the rebel faction
#     (try_for_parties, ":party"),
#        (party_slot_eq, ":party", slot_party_type, spt_rebellion),#if its a rebellion
#        (store_faction_of_party, ":rebel_faction", ":party"),
#        (store_relation, ":relation", ":rebel_faction", "$players_kingdom"),
#        (ge, ":relation", 0),##with positive faction with player
#        (party_get_slot,":target_center", ":party", slot_rebellion_target),
#        (try_begin),
#         (is_between, ":target_center", walled_centers_begin, walled_centers_end),
#         (store_faction_of_party, ":target_center_faction", ":target_center"),
#         (eq, ":target_center_faction", "$players_kingdom"),##and the target is from the player faction
#         (set_relation, ":rebel_faction", ":target_center_faction", -50),#then declare war between them!
#        (else_try),
#         (display_message, "@ERROR: A rebellion with invalid target!", color_bad_news),
#        (try_end),
#     (try_end),

# 		(change_screen_map),
# 		],
#        ),

#     ]
# ),

("senatus",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s60}",
  "none",[
    (troop_get_slot, reg38, "trp_senator_dummy", slot_senate_support),
    (troop_get_slot, reg39, "trp_senator_dummy", slot_senate_next_meeting),

    (str_clear, s51),
    (try_begin),
        (eq, reg39, 0),
        (str_store_string, s43,"@Currently, there is a senate meeting processing."),
        (try_begin),
            (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_slaves),
            (str_store_string, s51, "@The senators are currently discussing the rights of slaves."),
        (else_try),
            (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_grain),
            (str_store_string, s51, "@The senators are currently discussing the grain supply of Rome."),
        (else_try),
            (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_nobles),
            (str_store_string, s51, "@The senators are currently discussing the rights of nobles and citizens."),
        (else_try),
            (str_store_string, s51, "@The senators are currently discussing no special topic at all."),
        (try_end),
    (else_try),
        (ge, reg39, 1),
        (str_store_string, s43,"@The senate is empty, as there is currently no meeting taking place. The next meeting will be in {reg39} days."),
    (else_try),
        (str_store_string, s43,"@The senate is empty, as there is currently no meeting taking place. It is unknown when the next meeting will be hold."),
    (try_end),

    (str_clear, s35),
    (try_begin),
          (check_quest_active, "qst_blank_quest_4"),
          (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
          (assign, ":max_skill", reg0),
          (assign, reg2, reg0),
          (assign, ":max_skill_owner", reg1),
          (try_begin),
              (eq, ":max_skill_owner", "trp_player"),
              (assign, reg3, 1),
          (else_try),
              (assign, reg3, 0),
              (str_store_troop_name, s1, ":max_skill_owner"),
          (try_end),
          (val_mul, ":max_skill", 2),
          (store_sub, ":hours", 96, ":max_skill"),
          (assign, reg40, ":hours"),
          (str_store_string, s35, "@As the party member with the highest trade skill ({reg2}), {reg3?you expect:{s1} expects} it would take {reg40} hours to answere all the petitions."),
    (try_end),
    (set_background_mesh, "mesh_pic_senatus"),

    (str_store_string, s60,
      "@You enter the Curia Julia at the Forum Romanum. It is the Senate house. {s43}^"
      +" From the senators, {reg38}% support you.^{s51}"
      +" ^During a senate meeting, you have various opportunities to improve your standing in the Empire:^^"
      +" You can give a speech (lower controversy, improve renown and honor, depends on charisma and oratory skill)^"
      +" You can bribe senators (lower controversy, loss of honor)^^{s35}"
    ),

    (try_begin),
        (eq, reg39, 0),
        (assign,"$temp",1),
        (assign,"$temp2",0),
        (assign, "$temp3", 0),
        (assign, "$temp4", 0),
        (set_jump_mission,"mt_senate_meeting"),
        (modify_visitors_at_site, "scn_senate"),
        (reset_visitors),
        (set_visitor,1, "trp_praetoriani_milites"),
        (set_visitor,2, "trp_praetoriani_milites"),
        (set_visitor,3, "trp_praetoriani_milites"),
        (set_visitor,4, "trp_praetoriani_milites"),
        (try_for_range, ":entry", 5, 45),
            (set_visitor,":entry", "trp_senator"),
        (try_end),
        (set_visitor,50, "trp_senator_dummy"),

        (try_begin),#second outift
            (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
            (call_script, "script_init_second_outfit", "mt_senate_meeting", 0, 0),
            (mission_tpl_entry_set_override_flags, "mt_senate_meeting", 0, af_override_outfit_1|af_override_horse),
        (try_end),
        (set_jump_entry, 0),
        (assign, "$vc_menu_active", "prsnt_senate"),
        (jump_to_scene, "scn_senate"),
        (change_screen_mission),
    (else_try),
        (assign,"$temp",0),
        (assign, "$temp4", 0),
        (set_jump_mission,"mt_senate_meeting"),
        (modify_visitors_at_site, "scn_senate"),
        (reset_visitors),
        (set_visitor,1, "trp_praetoriani_milites"),
        (set_visitor,2, "trp_praetoriani_milites"),
        (set_visitor,3, "trp_praetoriani_milites"),
        (set_visitor,4, "trp_praetoriani_milites"),

        (try_begin),#second outift
            (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
            (call_script, "script_init_second_outfit", "mt_senate_meeting", 0, 0),
            (mission_tpl_entry_set_override_flags, "mt_senate_meeting", 0, af_override_outfit_1|af_override_horse),
        (try_end),

        (set_jump_entry, 0),
        (assign, "$vc_menu_active", "prsnt_senate"),
        (jump_to_scene, "scn_senate"),
        (change_screen_mission),
    (try_end),
  ],[
    ("leg",[
      (check_quest_active, "qst_water_dispute"),
      (neg|check_quest_failed, "qst_water_dispute"),
      (neg|check_quest_succeeded, "qst_water_dispute"),
      (quest_slot_eq, "qst_water_dispute", slot_quest_current_state, 0),
    ],"Lobby for water rights",[
      (jump_to_menu, "mnu_looby_for_water_rights"),
    ]),
    ("leg",[
      (troop_slot_eq, "trp_player", slot_troop_honorary_title, ht_censor),
    ],"Inspect the imperial treasury.",[
      (jump_to_menu, "mnu_inspect_treasury"),
    ]),

    ("leg",[
      (check_quest_active, "qst_grain_supply"),
      (quest_get_slot, ":target", "qst_grain_supply",slot_quest_target_party),
      (gt, ":target", 1),
      (try_begin),
        (party_get_num_attached_parties, ":num_attached_parties",  "p_main_party"),
        (ge, ":num_attached_parties", 1),
        (try_for_range_backwards, ":attached_party_rank", 0, ":num_attached_parties"),
          (party_get_attached_party_with_rank, ":attached_party", "p_main_party", ":attached_party_rank"),
          (eq, ":attached_party", ":target"),
          (party_detach, ":attached_party"),
          (party_relocate_near_party, ":attached_party", "p_main_party", 1),
          (party_set_slot,":attached_party",slot_party_time_service, -1),
          (str_store_party_name, s22, ":attached_party"),
          (display_message, "@{s22} has left your force."),
        (try_end),
      (try_end),

      (store_distance_to_party_from_party,":distance", ":target", "p_town_6"),
      (le, ":distance", 5),
     ],"Proclaim you have the promised amount of grain.",[
      (jump_to_menu, "mnu_finish_grain"),
    ]),

    ("leg",[
      (eq, "$g_is_emperor", 1),
      (le, "$g_civil_war", 0),
      (eq, reg39, 0),
      (eq, "$edict10", 0),
    ],"Propose to rename a month after you.",[
      (try_begin),
        (troop_slot_ge, "trp_player", slot_troop_renown, 900),
        (jump_to_menu, "mnu_rename_month"),
      (else_try),
        (display_message, "@You need more renown! (at least 900 renown)"),
      (try_end),
    ]),

    ("leg",[
      (check_quest_active, "qst_usurp_province"),
      (quest_slot_eq, "qst_usurp_province", slot_quest_target_dna, -1),	##means senate
      (quest_get_slot, ":town", "qst_usurp_province", slot_quest_target_center),
      (str_store_party_name, s20, ":town"),
    ],"Bring the petition from {s22} before the senate.",[
      (try_begin),
        (eq, reg39, 0),
        (jump_to_menu, "mnu_senate_decide"),
      (else_try),
        (display_message, "@There must be a meeting in progress to make your proposal!", message_alert),
      (try_end),
    ]),

    ("leg",[
      (check_quest_active, "qst_bacchhus_quest"),
      (quest_slot_eq, "qst_bacchhus_quest", slot_quest_current_state, 2),
    ],"Propose to revoke the 'Senatus consultum de Bacchanalibus'",[
      (try_begin),
        (eq, reg39, 0),
        (jump_to_menu, "mnu_senate_decide_bacchus"),
      (else_try),
        (display_message, "@There must be a meeting in progress to make your proposal!", message_alert),
      (try_end),
    ]),

    ("leg",[
      (eq, reg39, 0),
      (ge, "$g_rank", 1),
    ],"Join the discussion",[
      (jump_to_menu, "mnu_senate_discussion"),
    ]),
    ("leg",[
      (neq, "$g_player_is_captive", 1),#not captive
      (neq, "$g_civil_war", 1),
      (neq, "$g_civil_war", -1),
      (assign, ":c", 0),
      (try_begin),
        (troop_get_slot, ":party", "$g_civil_war", slot_troop_prisoner_of_party),
        (eq, ":party", "p_main_party"),
        (assign, ":c", 1),
      (else_try),
        (faction_slot_eq, "fac_kingdom_7", slot_faction_state, sfs_defeated),
        (assign, ":c", 1),
      (else_try),
        (party_count_prisoners_of_type, ":number", "p_main_party", "$g_civil_war"),
        (ge, ":number", 1),
        (assign, ":c", 1),
      (try_end),
      (eq, ":c", 1),
    ],"End the civil war and declare yourself victor!",[
      (try_begin),
        (neg|faction_slot_eq, "fac_kingdom_7", slot_faction_state, sfs_defeated),
        (store_add, ":slot_war_damage_inflicted", "fac_kingdom_7", slot_faction_war_damage_inflicted_on_factions_begin),
        (val_sub, ":slot_war_damage_inflicted", kingdoms_begin),
        (faction_get_slot, ":war_damage_inflicted", "$players_kingdom", ":slot_war_damage_inflicted"),

        (store_add, ":slot_war_damage_suffered", "$players_kingdom", slot_faction_war_damage_inflicted_on_factions_begin),
        (val_sub, ":slot_war_damage_suffered", kingdoms_begin),
        (faction_get_slot, ":war_damage_suffered", "fac_kingdom_7", ":slot_war_damage_suffered"),

        (assign, reg45, ":war_damage_suffered"),
        (assign, reg44, ":war_damage_inflicted"),
        (try_begin),
          (val_add, ":war_damage_suffered", 30),
          (gt, ":war_damage_inflicted", ":war_damage_suffered"),
          (jump_to_menu, "mnu_end_civil_war"),
        (else_try),
          (display_message, "@You must be winning the war to end it! Conquere more enemy twons, raid more villages and defeat more enemies!"),
          (display_message, "@War damage inflicted: {reg44}, war damage suffered: {reg45}."),
          (display_message, "@The war damage inflicted must be 30 points greater than the war damage suffered!"),
        (try_end),
      (else_try),
        (jump_to_menu, "mnu_end_civil_war"),
      (try_end),
    ]),
    ("leg",[
      (neq, reg39, 0),
      (this_or_next|eq, "$g_is_emperor", 1),
      (this_or_next|troop_slot_ge, "trp_player", slot_troop_honorary_title, 1),
      (ge, "$g_rank", 2),
    ],"Issue a compulsory order to start a meeting. (costs: 4000 gold, lowers senate support)",[
      (try_begin),
        (store_troop_gold, ":g", "trp_player"),
        (lt, ":g", 4000),
        (display_message, "str_not_enough_gold"),
      (else_try),
        (assign, reg39, 0),
        (troop_set_slot, "trp_senator_dummy", slot_senate_next_meeting, 0),
        (troop_set_slot, "trp_senator_dummy", slot_senate_topic, 0),
        (display_message, "@You prepare the necessary sacrifices and consult the auspices.", message_alert),
        (troop_remove_gold, "trp_player",4000),
        (call_script, "script_change_senate_support", -2, 0),
      (try_end),
    ]),
    ("leg",[
      (neq, reg39, 0),
    ],"Walk around.",[
      (assign,"$temp",0),
      (assign, "$temp4", 0),
      (set_jump_mission,"mt_senate_meeting"),
      (modify_visitors_at_site, "scn_senate"),
      (reset_visitors),
      (set_visitor,1, "trp_praetoriani_milites"),
      (set_visitor,2, "trp_praetoriani_milites"),
      (set_visitor,3, "trp_praetoriani_milites"),
      (set_visitor,4, "trp_praetoriani_milites"),

      (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_senate_meeting", 0, 0),
          (mission_tpl_entry_set_override_flags, "mt_senate_meeting", 0, af_override_outfit_1|af_override_horse),
      (try_end),

      (set_jump_entry, 0),
      (jump_to_scene, "scn_senate"),
      (change_screen_mission),
    ]),

    ("leg",[
      (eq, reg39, 0),
    ],"Attend to the meeting.",[
      (assign,"$temp",1),
      (assign,"$temp2",0),
      (assign, "$temp3", 0),
      (assign, "$temp4", 0),
      (set_jump_mission,"mt_senate_meeting"),
      (modify_visitors_at_site, "scn_senate"),
      (reset_visitors),
      (set_visitor,1, "trp_praetoriani_milites"),
      (set_visitor,2, "trp_praetoriani_milites"),
      (set_visitor,3, "trp_praetoriani_milites"),
      (set_visitor,4, "trp_praetoriani_milites"),
      (try_for_range, ":entry", 5, 45),
          (set_visitor,":entry", "trp_senator"),
      (try_end),
      (set_visitor,50, "trp_senator_dummy"),

      (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_senate_meeting", 0, 0),
          (mission_tpl_entry_set_override_flags, "mt_senate_meeting", 0, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_jump_entry, 0),
      (jump_to_scene, "scn_senate"),
      (change_screen_mission),
    ]),
    ("leg",[
      (eq, "$g_has_senat_sup", 0),
      (eq, "$g_is_emperor", 1),
      (eq, reg39, 0),
    ],"Legitimize your rule with the senate.",[
      (play_sound, "snd_senatus_sound_2"),
      (jump_to_menu, "mnu_legitim_rule"),
    ]),
    ("speech",[
      (eq, "$g_speech", 0),
      (eq, reg39, 0),
    ],"Give a speech.",[
      (call_script, "script_give_a_speech", "$current_town"),
    ]),
      # ("con",[(eq, "$g_bribe", 0),],"Try to bribe (15000 denars)",
        # [
		# (store_troop_gold, ":g", "trp_player"),
		# (try_begin),
			# (lt, ":g", 15000),
			# (display_message, "@You don't have enough denars!"),
			# (jump_to_menu, "mnu_town"),
		# (else_try),

            # (store_random_in_range, ":r", 0, 100),
            # (try_begin),
                # (is_between, ":r", 0, 10),
                # (call_script, "script_change_player_honor", -5),
                # (troop_remove_gold, "trp_player", 15000),
                # (display_message, "@The senators you wanted to bribe called you dishonorable!"),
                # (call_script, "script_change_player_relation_with_center", "$current_town", -1),
                # (troop_get_slot, ":con", "trp_player", slot_troop_controversy),
                # (val_add, ":con", 60),
                # (val_clamp, ":con", 0, 101),
                # (troop_set_slot, "trp_player", slot_troop_controversy, ":con"),
            # (else_try),
                # (call_script, "script_change_player_honor", -1),
                # (troop_remove_gold, "trp_player", 15000),
                # (display_message, "@You successfully bribed some senators."),
                # (troop_set_slot, "trp_player", slot_troop_controversy, 0),
                # (call_script, "script_change_player_relation_with_center", "$current_town", 4),
            # (try_end),
            # (assign, "$g_bribe", 1),
            # (assign, "$auto_enter_town", "$current_town"),
            # (assign, "$g_town_visit_after_rest", 1),
            # (assign, "$g_last_rest_center", "$current_town"),
            # (assign, "$g_last_rest_payment_until", -1),
            # (play_sound, "snd_senatus_sound_2"),
            # (rest_for_hours, 12, 6, 0),
            # (change_screen_map),
		# (try_end),        ]
      # ),
    ("petitions",[
      (check_quest_active, "qst_blank_quest_4"),
      (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
      (assign, ":max_skill", reg0),
      (assign, reg2, reg0),
      (assign, ":max_skill_owner", reg1),
      (try_begin),
        (eq, ":max_skill_owner", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":max_skill_owner"),
      (try_end),
      (val_mul, ":max_skill", 2),
      (store_sub, ":hours", 96, ":max_skill"),
      (assign, reg41, ":hours"),
	  ],"Handle Petitions. ({reg41} hours)",[
      (call_script, "script_end_quest", "qst_blank_quest_4"),
      (assign, "$auto_enter_town", "$current_town"),
      (assign, "$g_town_visit_after_rest", 1),
      (assign, "$g_last_rest_center", "$current_town"),
      (assign, "$g_last_rest_payment_until", -1),
      (play_sound, "snd_senatus_sound_2"),

      (jump_to_menu, "mnu_petition"),
      (rest_for_hours, reg41, 10, 0),
    ]),
	  ("leave",[],"Go back.",[
      (jump_to_menu,"mnu_town"),
    ]),
]),

("legitim_rule",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "To Legitimize your rule you need a two thirds majority in the senate.^^ Currently, you have {reg50}% of the senators supporting you.",
    "none",[
    (troop_get_slot, reg50, "trp_senator_dummy", slot_senate_support),
    (set_background_mesh, "mesh_pic_senatus"),
  ],[
    ("leg_rule",[
      (eq, "$g_has_senat_sup", 0),
	    (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 66),
	  ],"Legitimize your rule.",[
      (assign, "$g_has_senat_sup", 1),
      (try_for_range,":npc","trp_legatus_1","trp_knight_1_1_wife"),
          (store_random_in_range,":new_relation",5,10),
          (call_script, "script_troop_change_relation_with_troop", "trp_player", ":npc", ":new_relation"),
      (try_end),
      (call_script, "script_change_player_right_to_rule", 70),
      (call_script, "script_change_troop_controversy", "trp_player", -100),
      (assign,"$temp",0),
      (assign,"$temp2",0),
      (assign, "$temp3", 0),
      (set_jump_mission,"mt_senate_cuttscene"),
      (modify_visitors_at_site, "scn_senate"),
      (reset_visitors),
      (set_visitor,1, "trp_praetoriani_milites"),
      (set_visitor,2, "trp_praetoriani_milites"),
      (set_visitor,3, "trp_praetoriani_milites"),
      (set_visitor,4, "trp_praetoriani_milites"),
      (try_for_range, ":entry", 5, 45),
      (set_visitor,":entry", "trp_senator"),
      (try_end),
      (set_visitor,50, "trp_senator_dummy"),
      (set_visitor, 49, "trp_player"),
      (call_script, "script_copy_player_troop"),
      (set_visitor, 0, "trp_pseudo_troop_end"),
      (assign, "$tutorial_state", 0),
      (jump_to_scene, "scn_senate"),
      (change_screen_mission),
    ]),
    ("leave",[],"Go back.",[
      (jump_to_menu,"mnu_senatus"),
    ]),
]),

("barracks",menu_text_color(0xFF000000)|mnf_enable_hot_keys,
  "{reg22?You enter the {s0}. This is the place where troops are recruited and trained. You can recruit cohorts and other military units or individual soldiers.^^{s1}:{s5} However, you may hire mercenary companies or you can refill your cohorts.}",
  "none",[
    (call_script, "script_get_improvement_details", slot_center_has_barracks, "$current_town"),

    (str_store_string, s5, "@The town has no {s0} build."),
    (assign, reg22, 0),
    (try_begin),
        (neg|is_between, "$g_encountered_party", minor_towns_begin, minor_towns_end),
        (party_get_slot, reg22, "$current_town", slot_center_has_barracks),
        (ge, reg22, 1),
        (try_begin),
            (eq, reg22, 1),
            (assign, reg22, "trp_player"),
        (try_end),
        (troop_get_slot, ":player_culture", "trp_player", slot_troop_culture),
        (troop_slot_eq, reg22, slot_troop_culture, ":player_culture"),
        (assign, reg22, 1),
    (else_try),
        (ge, reg22, 1),
        (str_store_string, s5, "@The building of {s0} is of wrong culture and hence cannot be used."),
        (assign, reg22, 0),
    (try_end),

    (str_clear, s1),
    (try_begin),
        (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
        (troop_slot_eq, "trp_players_legion", 1, 1),
        (str_store_string, s1, "@You can customize your legion troops here."),
    (try_end),
    (try_begin),
        (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
        (this_or_next|troop_slot_eq, "trp_players_aux_cav", 1, 1),
        (troop_slot_eq, "trp_players_aux_inf", 1, 1),
        (str_store_string, s1, "@You can customize your auxiliary troops here. {s1}"),
    (try_end),
    (set_background_mesh, "mesh_pic_recruits"),
  ],[
    ("rec_visit",[
      (party_slot_ge, "$current_town", slot_center_has_barracks, 1),
      (neg|is_between, "$g_encountered_party", minor_towns_begin, minor_towns_end),
      # (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
      # (faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_7"),
    ],"Walk around.",[
      (party_get_slot, ":builder", "$current_town", slot_center_has_barracks),
      (try_begin),
        (eq, ":builder", 1),
        (assign, ":builder", "trp_player"),
      (try_end),
      (troop_get_slot, ":culture", ":builder", slot_troop_culture),
      (try_begin),
        (eq, ":culture", "fac_culture_7"),
        (assign, ":scene", "scn_barracks"),
      (else_try),
        (this_or_next|eq, ":culture", "fac_culture_8"),
        (this_or_next|eq, ":culture", "fac_culture_6"),
        (eq, ":culture", "fac_culture_5"),
        (assign, ":scene", "scn_barracks_eastern"),
      (else_try),
        (this_or_next|eq, ":culture", "fac_culture_9"),
        (this_or_next|eq, ":culture", "fac_culture_3"),
        (eq, ":culture", "fac_culture_10"),
        (assign, ":scene", "scn_barracks_nomadic"),
      (else_try),
        (assign, ":scene", "scn_barracks_barbarian"),
      (try_end),

      (faction_get_slot, ":troop", "$g_encountered_party_faction", slot_faction_tier_2_troop),
      (faction_get_slot, ":source", "$g_encountered_party_faction", slot_faction_tier_4_troop),
      (assign, "$talk_context", tc_town_talk),
      (assign, "$temp", 0),
      (assign, "$temp4_1", 0),
      (set_jump_mission, "mt_barracks"),
      (modify_visitors_at_site,":scene"),
      (reset_visitors),
      (set_jump_entry, 0),

      (troop_clear_inventory, "trp_commander_barracks"),
      (call_script, "script_dplmc_copy_inventory", ":source", "trp_commander_barracks"),

      (set_visitor, 1, "trp_commander_barracks"),
      (set_visitor, 2, ":troop"),
      (set_visitor, 3, ":troop"),
      (set_visitor, 4, ":troop"),
      (set_visitor, 5, ":troop"),
      (set_visitor, 6, ":troop"),
      (set_visitor, 7, ":troop"),
      (jump_to_scene, ":scene"),
      (change_screen_mission),
    ]),

    ("rec_visit",[
      (ge, reg22, 1),
    ],"Recruit cohorts, mercenary companies or refill units.",[
      (assign, "$temp", -1),
      (start_presentation, "prsnt_recruit_cohorts"),
    ]),
    ("rec_visit",[
      (le, reg22, 0),
    ],"Recruit mercenaries or refill units.",[
      (assign, "$temp", -1),
      (start_presentation, "prsnt_recruit_cohorts"),
    ]),
    ("rec_visit",[
      (assign, ":continueee", 0),
      (party_get_slot, ":lord", "$current_town", slot_town_lord),
      (try_begin),
          (ge, ":lord", 1),
          (troop_slot_eq, ":lord", slot_troop_legion, 13),
          (troop_slot_eq, "trp_players_legion", 1, 1),##legion is created
          (assign, ":continueee", 1),
      (else_try),
          (eq, ":lord", "trp_player"),
          (troop_slot_eq, "trp_players_legion", 1, 1),##legion is created
          (assign, ":continueee", 1),
      (try_end),
      (eq, ":continueee", 1),
    ],"Customize your legion.",[
      (assign, "$g_next_menu", "mnu_barracks"),
      (assign, "$g_player_troop", "trp_players_legion"),
      # (assign, "$temp4", 1),
      (start_presentation, "prsnt_custom_troop_tree_legion"),
    ]),
    ("rec_visit",[
      (ge, reg22, 1),
      (troop_slot_eq, "trp_players_aux_cav",1,1),
    ],"Customize your auxilia ala.",[
      (assign, "$g_next_menu", "mnu_barracks"),
      (assign, "$g_player_troop", "trp_players_aux_cav"),
      (start_presentation, "prsnt_custom_troop_tree_legion"),
    ]),
    ("rec_visit",[
      (ge, reg22, 1),
      (troop_slot_eq, "trp_players_aux_inf",1,1),
    ],"Customize your auxilia cohort.",[
      (assign, "$g_next_menu", "mnu_barracks"),
      (assign, "$g_player_troop", "trp_players_aux_inf"),
      (start_presentation, "prsnt_custom_troop_tree_legion"),
    ]),
    ("rec0",[
      (ge, reg22, 1),
    ],"Recruit soldiers.",[
      (assign, reg43, 1),
      (assign, "$temp4", 1),
      (try_begin),
          (neg|faction_slot_eq, "$g_encountered_party_faction", slot_faction_culture, "fac_culture_7"),
          (assign, "$temp4_1", 1),
          (faction_get_slot, ":troop", "$g_encountered_party_faction", slot_faction_tier_1_troop),
          (assign, "$temp_troop", ":troop"),
      (else_try),
          (assign, "$temp4_1", 2),
          (assign, "$temp_troop", "trp_aux_archer"),
      (try_end),
      (assign, "$g_next_menu", "mnu_barracks"),
      (start_presentation, "prsnt_barracks"),
    ]),
    ("rec0",[
      (neg|is_between, "$g_encountered_party_faction", minor_kingdoms_begin,minor_kingdoms_end),
      (ge, reg22, 1),
      (assign, ":continue", 0),
      (party_get_slot, ":lord", "$current_town", slot_town_lord),
      (try_begin),
          (ge, ":lord", 1),
          (troop_slot_eq, ":lord", slot_troop_legion, 13),
          (troop_slot_eq, "trp_players_legion", 1, 1),##legion is created
          (assign, ":continue", 1),
      (else_try),
          (eq, ":lord", "trp_player"),
          (troop_slot_eq, "trp_players_legion", 1, 1),##legion is created
          (assign, ":continue", 1),
      (try_end),
      (this_or_next|eq, ":continue", 1),
      (this_or_next|troop_slot_eq, "trp_players_aux_inf", 1,1),
      (this_or_next|troop_slot_eq, "trp_players_aux_cav", 1,1),
      (this_or_next|troop_slot_eq, "trp_players_infantry", 1,1),
      (this_or_next|troop_slot_eq, "trp_players_cavalry", 1,1),
      (troop_slot_eq, "trp_players_skirmisher", 1,1),
    ],"Recruit Custom Soldiers.",[
      (assign, "$temp4", 2),
      (try_begin),
          (troop_slot_eq, "trp_players_infantry", 1, 1),
          (assign, "$temp_troop", "trp_custom_infantry"),
      (else_try),
          (troop_slot_eq, "trp_players_cavalry", 1, 1),
          (assign, "$temp_troop", "trp_custom_cav_barb"),
      (else_try),
          (troop_slot_eq, "trp_players_skirmisher", 1, 1),
          (assign, "$temp_troop", "trp_custom_skirmisher"),
      (else_try),
          (troop_slot_eq, "trp_players_legion", 1, 1),
          (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
          (assign, "$temp_troop", "trp_custom_legionary"),
      (else_try),
          (troop_slot_eq, "trp_players_aux_cav", 1,1),
          (assign, "$temp_troop", "trp_custom_cav_of"),
      (else_try),
          (assign, "$temp_troop", "trp_custom_sagitarius"),
      (try_end),
      (assign, reg43, 1),
      (assign, "$temp4_1", 3),
      (assign, "$g_next_menu", "mnu_barracks"),
      (start_presentation, "prsnt_barracks"),
    ]),
    ("leave",[],"Go back.",[
      (jump_to_menu,"mnu_town"),
    ]),
]),

("rumors",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Rumours^^{s40}",
  "none",[
    (store_random_in_range, ":r", "str_fake_rumor_1", "str_fake_rumor_end"),
    (str_store_string, s40, ":r"),
    (set_background_mesh, "mesh_pic_senators"),
  ],[
    ("support_1",[],"I think this is enemies gossip...",[
      (change_screen_map),
    ]),
    ("support_2",[],"I should be carefully with him...",[
      (call_script, "script_change_player_relation_with_troop", "$temp", -10),
      (change_screen_map),
    ]),
]),

("passions_in_the_tomb",0,    #modified motomataru chief
  "The dark shadows, the gloom of the burial chamber and the smell of smoke from the torch disappear. You find yourself in a tent."
  +" You are dressed in a richly decorated Etruscan tunic, with a golden laurel on your head. You hear people from outside chanting:"
  +" 'Lukomo! Lukomo! Lukomo!' There are two other men in the tent, while Antonia stands in front of you. She is dressed in a shinning dress, emphasizing her figure."
  +" The others say something about a goddess, Turan, who has appeared. Antonia wants to touch you with her shimmering hands. The closer she gets, the more her shine blinds you."
  +" Once she touched you, you are blinded by light. ^^You find yourself lying with Antonia in the chamber. You feel her even breathing on your chest."
  +" You lie there for a while until Antonia gets up and dresses herself.",
  "none",[
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[
  ("continue",[],"Continue.",[
    (set_jump_mission, "mt_visit_tarquinii"),
    (modify_visitors_at_site,"scn_tarquinii_tomb_1"),
    (reset_visitors, 0),
    (set_visitor, 2, "trp_antonia"),
    (set_visitor, 0, "trp_player"),
    (jump_to_scene, "scn_tarquinii_tomb_1"),
    (change_screen_mission),
    (add_xp_as_reward, 2500),
  ],"Leave."),
]),

("tarquinii_meeting_final",0,    #modified motomataru chief
  "She kisses you goodbye and leaves. You remain in the tomb for a short while, thinking about what happened. You look at the paintings and for a moment you hear crowds of people chanting and celebrating your name."
  +" And all of a sudden the voices are gone. A soldiers interrupts you by asking if everything is fine. Your men were worried when they see only Antonia leaving the tomb but not you."
  +"^^Next step is to travel to Rome and talk with Nero, or as Antonia would say, with piggy.",
  "none",[
        (set_background_mesh, "mesh_pic_deserters"),
    ],[
    ("continue",[
    ],"Continue.",[
      (add_quest_note_from_sreg, "qst_blank_quest_19", 5, "@You met Antonia again at Tarquinii and discussed the future goals of the plan. Now you have to stage a revolt in Judea!", 1),

      (setup_quest_text,"qst_poking_the_lion"),
      (str_store_string, s2, "@Your goal is to stage a revolt in Judea."),
      (call_script, "script_start_quest", "qst_poking_the_lion", "trp_fortuna"),
      (str_store_party_name, s22, "p_town_6"),
      (add_quest_note_from_sreg, "qst_poking_the_lion", 4, "@Travel to {s22} to convince Nero to confiscate the temple treasury of Hierosolyma.", 1),

      (quest_set_slot,"qst_poking_the_lion",slot_quest_current_state, 1),
      (display_message, "str_quest_updated"),

      (change_screen_map),
    ],"Leave."),
]),

("tarquinii",0,    #modified motomataru chief
  "Near the town of Tarquinii is one of the largest Etruscan burial sites."
  +" One can find tomb next to tomb just like a real city.",
  "none",[
        (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("enter",[
      (eq, 0, 1),
    ],"Enter the tomb.",[
      (set_jump_mission, "mt_visit_tarquinii"),
      (modify_visitors_at_site,"scn_tarquinii_tomb_1"),
      (reset_visitors, 0),
      (try_begin),
          (check_quest_active, "qst_blank_quest_19"),
          (quest_slot_eq,"qst_blank_quest_19", slot_quest_object_state, 1),
          (set_visitor, 1, "trp_antonia"),
      (try_end),
      (set_visitor, 0, "trp_player"),
      (jump_to_scene, "scn_tarquinii_tomb_1"),
      (change_screen_mission),
    ], "Enter the tomb."),
    ("continue",[
    ],"Walk around.",[
      (set_jump_mission, "mt_visit_tarquinii"),
      (modify_visitors_at_site,"scn_tarquinii"),
      (reset_visitors, 0),
      (try_begin),
          (check_quest_active, "qst_blank_quest_19"),
          (quest_slot_eq,"qst_blank_quest_19", slot_quest_object_state, 1),
          (set_visitor, 1, "trp_antonia"),
      (try_end),
      (set_visitor, 0, "trp_player"),
      (jump_to_scene, "scn_tarquinii"),
      (change_screen_mission),
    ],"Leave."),
    ("continue",[],"Leave.",[
      (change_screen_map),
    ]),
]),

("pillars",0,    #modified motomataru chief
  "When Heracles had to perform twelve labours, one of them (the tenth) was to fetch the Cattle of Geryon of the far West and bring them to Eurystheus."
  +" The pillars of Heracles marked the westward extent of his travels.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("continue",[
    ],"Walk around.",[
      (set_jump_mission, "mt_explore_secret_place"),
      (set_jump_entry, 0),
      (jump_to_scene, "scn_pillars"),
      (change_screen_mission),
    ],"Leave."),

    ("continue",[],"Leave.",[
      (change_screen_map),
    ]),
]),

("grave_anatolia",0,    #modified motomataru chief
  "Its said that the grave of the legendary Lycus of Athens is located somewhere in this mountains."
  +" He once was exiled from Athen and settled here. After him the land has the name Lycia.",
  "none",[
    (set_background_mesh, "mesh_pic_cave"),
  ],[
  ("continue",[],"Walk around.",[
    (set_jump_mission, "mt_explore_secret_place"),
    (set_jump_entry, 0),
    (jump_to_scene, "scn_grave_anatolia"),
    (change_screen_mission),
  ],"Leave."),
  ("continue",[],"Leave.",[
    (change_screen_map),
  ]),
]),

("underworld",0,    #modified motomataru chief
  "{s40}",
  "none",[
    (try_begin),
        (quest_slot_eq, "qst_blank_quest_5", slot_quest_current_state, 1),
        #player 0
        #camera: 60, 61, 62
        #first spawn: 1,2, raget 3,4
        #then relocate to 5,6 -> start conversation
        (play_track, "track_cutscene_to_hades",2),
        (modify_visitors_at_site, "scn_roman_intro_2"),
        (reset_visitors),
        (set_jump_mission, "mt_roman_intro_2"),
        (set_visitor, 0, "trp_player"),
        # (set_visitor, 1, "trp_claudia"),
        # (set_visitor, 2, "trp_amokos"),

        (set_visitor, 5, "trp_claudia"),
        (set_visitor, 6, "trp_amokos"),
        (jump_to_scene, "scn_roman_intro_2"),
        (change_screen_mission),
    (else_try),
        (quest_slot_eq, "qst_blank_quest_5", slot_quest_current_state, 2),
        (set_background_mesh, "mesh_pic_underworld"),
        (try_begin),
            (store_time_of_day,reg12),
            (ge,reg12,5),
            (lt,reg12,21),
            (assign,"$town_nighttime",0),
        (else_try),
            (assign,"$town_nighttime",1),
        (try_end),
        (str_store_string, s40, "@A shimmering light appears in the distance. The gates of the underworld open before you. There emerges a quiet commotion from the long dark passage behind the gates. The underworld is awakening."),

        (display_message, "str_quest_updated"),
        (add_quest_note_from_sreg, "qst_blank_quest_5", 3, "@While you performed your task you have fallen into the entrance! You need to find a way out.", 0),
    (else_try),
        (set_background_mesh, "mesh_pic_deserters"),
        (str_store_string, s40, "@You see a crater in the distance, a lot of smoke and nothing special at all."),
    (try_end),
  ],[
    # ("continue2",[
        # (check_quest_active, "qst_blank_quest_5"),
        # (eq,"$town_nighttime",0),
    # ],
        # "Come back at night...",
    # [
        # (change_screen_map),
    # ]),
    ("continue",[
      (check_quest_active, "qst_blank_quest_5"),
      (quest_slot_eq, "qst_blank_quest_5", slot_quest_current_state, 2),
    ],"Descend into the underworld...",[
      ##entry 0 = player
      ##entry 1 = sisyphus (sitzend)
      ##entry 2 = wahrsagertyp
      ##entry 3 = herakles (sitzend)
      ##entry 4 = achilleus
      ##entry 5 = agamemnon
      ##entry 6 = odysseus
      ##entry 7 = alexander
      ##entry 8 = caesar
      (set_jump_mission, "mt_underworld"),
      (modify_visitors_at_site,"scn_underworld"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 1, "trp_sisyphus"),
      (set_visitor, 2, "trp_wahrsager"),
      # (set_visitor, 3, "trp_herakles"),
      (set_visitor, 4, "trp_achilleus"),
      (set_visitor, 5, "trp_agamemnon"),
      (set_visitor, 6, "trp_odysseus"),
      (set_visitor, 7, "trp_alexander"),
      (set_visitor, 8, "trp_caesar"),
      (set_visitor, 9, "trp_whore", 3249304392),
      (jump_to_scene, "scn_underworld"),
      (change_screen_mission),
    ]),
    # ("continue",[(neg|check_quest_active, "qst_blank_quest_5"),],"Walk around",
    # [
        # (jump_to_scene, "scn_underworld"),
        # (change_screen_mission),
    # ]),
    ("continue",[
        (neg|check_quest_active, "qst_blank_quest_5"),
        (neg|quest_slot_eq, "qst_blank_quest_5", slot_quest_current_state, 2),
    ],"Leave...",[
       (change_screen_map),
    ]),
]),

("journey_underworld",0,    #modified motomataru chief
  "Claudia walks towards the house while you follow Amokos. He leads you on a steep and rocky path. "+
  "The higher you get, the worse it smells. Smoke fills the air. It becomes harder to breath. "+
  "Soon Amokos stops and says:^'This is the entrance. Now throw the coin into it.'^You stand in from of a crater. "+
  "Its hot and stinks. You take out a cooper coin and come closer to the crater. "+
  "You want to throw it but suddenly the ground shakes, you stumble and fall into the crater! "+
  "Amokos tries to help you but he isn't able to catch you. You hit the ground and everything becomes black.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_underworld"),
    ]),
]),

("awak",0,    #modified motomataru chief
  "You have awaken. Thunders are roaring in the distance and it rains. Your head hurts. You find yourself laying on soft cushions, while a woman anoints your wounds."+
  " She notices that you have awaken and smiles. Then she gives you a tunic and tells you to dress."+
  " You stand up, put on the tunic and then follow her. She walks through her small but elegant house towards the dinning room. She tells you to take a seat."+
  " Then she walks away. After a while she returns with food which she serves. As it seems she doesn't have any slaves. The thunders are still roaring in the distance.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
    (call_script, "script_end_quest", "qst_blank_quest_5"),
    (add_xp_as_reward, 1500),
  ],[
    ("continue",[],"Continue...",[
      (set_jump_mission, "mt_roman_intro_3"),
      (modify_visitors_at_site,"scn_antonias_house"),
      (reset_visitors),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_antonia"),
      (jump_to_scene, "scn_antonias_house"),
      ##remove spr_draw_bridge_a if needed
      (change_screen_mission),
    ]),
]),

("slave_hideout",0,
  "You have encountered a hideout. What do you want to do?",
  "none",[
    (try_begin),
      (check_quest_active, "qst_blank_quest_7"),
      (neg|check_quest_succeeded,"qst_blank_quest_7"),
      (neg|check_quest_failed,"qst_blank_quest_7"),
      (quest_slot_eq, "qst_blank_quest_7", slot_quest_target_party, "$g_encountered_party"),
      (quest_get_slot,":stage","qst_blank_quest_7",slot_quest_current_state),
      (is_between, ":stage", 0,3),
      (quest_set_slot, "qst_blank_quest_7", slot_quest_current_state, 2),
      (set_jump_mission,"mt_slave_hideout"),
      (set_jump_entry, 0),
      (jump_to_scene, "scn_random_scene_plain_forest"),
      (change_screen_mission),
    (else_try),
      (change_screen_map),
      (remove_party, "$g_encountered_party"),
    (else_try),
      (set_background_mesh, "mesh_pic_deserters"),
    (try_end),
  ],[
    ("leave",[],"Leave.",[
      (change_screen_map),
      (remove_party, "$g_encountered_party"),
    ]),
]),

("village_hunt_music_defeated",0,
  "A heavy blow from the rogue guard sends you to the ground, and your vision spins and goes dark. " +
  "Time passes. When you open your eyes again, you find yourself battered and bloody, " +
  "but luckily none of the wounds appear to be lethal.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("continue",[],"Continue...",[
      (call_script, "script_change_troop_health", "trp_player", 5),
      (jump_to_menu, "mnu_village"),
    ]),
]),

("village_hunt_lover_defeated",0,
  "A heavy blow from the ghost sends you to the ground, and your vision spins and goes dark. " +
  "Time passes. When you open your eyes again, you find yourself battered and bloody, " +
  "but luckily none of the wounds appear to be lethal.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_village"),
    ]),
]),

("baths",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You enter the local thermae. You see people enjoying the roman lifestyle. It is a place of pleasure.",
  "none",[
    (set_background_mesh, "mesh_pic_baths"),
  ],[
    ("use_bath",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 100),
    ],"Buy ticket for one day (100 denars). [Improves health]",[
      (try_begin),
        (neg|troop_slot_ge, "trp_player", slot_troop_unhealth, 300),
        (store_random_in_range, ":r", 1, 10),
      (else_try),
        (neg|troop_slot_ge, "trp_player", slot_troop_unhealth, 600),
        (store_random_in_range, ":r", 50, 140),
      (else_try),
        (store_random_in_range, ":r", 140, 350),
      (try_end),
      (val_mul, ":r", -1),
      (call_script, "script_change_troop_health", "trp_player", ":r"),
      (troop_remove_gold, "trp_player", 100),
      (troop_get_slot, ":renown", "trp_player", slot_troop_renown),
      (try_begin),
      # (eq, "$g_meet_someone", 0),
        (ge, ":renown", 300),
        (party_get_num_attached_parties, ":num_attached_parties", "$current_town"),
        (ge, ":num_attached_parties", 1),
        (try_for_range, ":attached_party_rank", 0, ":num_attached_parties"),
          (party_get_attached_party_with_rank, ":attached_party", "$current_town", ":attached_party_rank"),
          (party_get_num_companion_stacks, ":num_stacks",":attached_party"),
          (try_for_range, ":i_stack", 0, ":num_stacks"),
            (party_stack_get_troop_id, ":stack_troop",":attached_party",":i_stack"),
            (troop_is_hero, ":stack_troop"),
            (call_script, "script_troop_get_relation_with_troop", "trp_player", ":stack_troop"),
            (gt, reg0, -10),
            (store_random_in_range, ":rand", 0, 100),
            (is_between, ":rand", 20, 65),
            (str_store_troop_name, s40, ":stack_troop"),
            (display_message, "@You have met {s40} and had a nice talk", message_positive),
            (call_script, "script_change_player_relation_with_troop", ":stack_troop", 5),
            (assign, ":num_attached_parties", -1),#break loop
          (try_end),
        (try_end),
      # (assign, "$g_meet_someone", 1),
      (else_try),
      # (eq, "$g_meet_someone", 0),
        (ge, ":renown", 300),
        (store_random_in_range, ":rand", 0, 100),
        (is_between, ":rand", 20, 50),
        (display_message, "@You have met a town official and had a nice talk", message_positive),
        (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      # (assign, "$g_meet_someone", 1),
      (else_try),
        (display_message, "@You enjoy your bath.", message_positive),
      (try_end),
      (assign, "$auto_enter_town", "$current_town"),
      (assign, "$g_town_visit_after_rest", 1),
      (assign, "$g_last_rest_center", "$current_town"),
      (assign, "$g_last_rest_payment_until", -1),
      (rest_for_hours, 6, 4, 0),
      (change_screen_map),
    ]),
    ("visit_thermae",[
      (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
      (try_begin),
        (eq, "$g_encountered_party", "p_town_6"),
        (str_store_string, s10, "@Thermae Agrippae"),
      (else_try),
        (str_store_string, s10, "@Thermae"),
      (try_end),
    ],"Enter the {s10}.",[
      (set_jump_mission, "mt_baths"),
      (modify_visitors_at_site, "scn_public_baths"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_baths", 0, af_override_horse),
      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_baths", 0, 0),
        (mission_tpl_entry_set_override_flags, "mt_baths", 0, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 0, "trp_player"),
      (assign, ":entry", 1),
      (try_begin),
        (party_get_num_attached_parties, ":num_attached_parties", "$current_town"),
        (ge, ":num_attached_parties", 1),
        (try_for_range, ":attached_party_rank", 0, ":num_attached_parties"),
          (party_get_attached_party_with_rank, ":attached_party", "$current_town", ":attached_party_rank"),
          (party_get_num_companion_stacks, ":num_stacks",":attached_party"),
          (try_for_range, ":i_stack", 0, ":num_stacks"),
            (party_stack_get_troop_id, ":stack_troop",":attached_party",":i_stack"),
            (troop_is_hero, ":stack_troop"),
            (store_random_in_range, ":rand", 0, 100),
            (is_between, ":rand", 20, 65),
            (set_visitor, ":entry", ":stack_troop"),
            (val_add, ":entry", 1),
            (gt, ":entry", 15),
            (assign, ":num_attached_parties", -1),
          (try_end),
        (try_end),
      (try_end),
      (jump_to_scene, "scn_public_baths"),
      (change_screen_mission),
    ], "Enter the thermae."),

    ("leave",[],"Go back.",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

("triumph_hold",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Gravitas is a measure of your military fame among the people of Rome. You need at least {reg11} garvitas to have a triumph granted to you by the senate."
  +" However, as Princeps you can just by-pass the senate. Though this will upset the people of Rome.^^Currently, you have {reg10} gravitas.",
  "none",[
    (str_store_troop_name_plural, s15, "trp_player"),
    (set_background_mesh, "mesh_pic_triumph"),
    (troop_get_slot, reg10, "trp_player", slot_troop_triumph_points),
    (assign, reg11, triumph_threshold),
	],[
    ("continue",[],"Hold a triumph!",[
      (assign, "$g_triumph", 1),
      (try_begin),
          (troop_slot_ge, "trp_player", slot_troop_triumph_points, triumph_threshold),
          (call_script, "script_troop_holds_triumph", "trp_player"),
      (else_try),
          (call_script, "script_triumph_marsh_start", "mnu_town", 1, 1),
          (call_script, "script_change_senate_support", -15, 0),
          (call_script, "script_change_player_relation_with_center", "p_town_6", -25),
      (try_end),
    ]),
    ("continue",[],"Go back.",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

("triumph",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The following decree is declared by the senate and Princeps:^^Citizens of Rome,"
  +"^We are honored to announce that {s15} has been awarded a triumph for his exceptional valor and leadership in recent military campaigns."
  +" This prestigious recognition is a testament to {s15}'s unwavering dedication and outstanding achievements in service to Rome."
  +" ^The Senate and the People of Rome have decreed that a grand procession shall be held to celebrate this momentous occasion."
  +" Join us in the festivities as we pay tribute to {s15} for his contributions to the glory and honor of Rome."
  +"^Ave Imperator!^^^A triumph is held to honor you.^^{s40}",
  "none",[
    (str_store_troop_name_plural, s15, "trp_player"),
    (set_background_mesh, "mesh_pic_triumph"),
    (party_get_slot, ":player_relation", "$current_town", slot_center_player_relation),
    (try_begin),
      (is_between, ":player_relation", 0, 20),
      (str_store_string, s40, "@Some People stay in the streets and cheer as you parade."),
      (assign, "$temp",1),
    (else_try),
      (is_between, ":player_relation", 20, 60),
      (str_store_string, s40, "@A lot of People stay in the streets and cheer as you parade."),
      (assign, "$temp",2),
    (else_try),
      (is_between, ":player_relation", 60, 101),
      (str_store_string, s40, "@The people of Rome praise you like a god as you march on."),
      (assign, "$temp",3),
    (else_try),
      (lt, ":player_relation", -20),
      (str_store_string, s40, "@The people of Rome throw with stones on you. You can feel their hate against you."),
      (assign, "$temp",1),
    (else_try),
      (str_store_string, s40, "@The people of Rome ignore you."),
      (assign, "$temp",1),
    (try_end),
	],[
    ("continue",[],"Glory to me! (with trumpeter)",[
      (assign, "$g_triumph", 1),
      (call_script, "script_triumph_marsh_start", "mnu_town","$temp", 1),
    ]),
    ("continue",[],"Glory to me! (without trumpeter)",[
      (assign, "$g_triumph", 1),
      (call_script, "script_triumph_marsh_start", "mnu_town","$temp", 0),
    ]),
]),

###fire of rome
("fire_of_rome",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The great fire of Rome^^"
+"Sing, Muse, of the fiery tempest's rage,"
+"^That swept through Rome in a relentless blaze."
+"^The Great Fire, a dragon's wrath unbound,"
+"^Consuming the heart of the ancient town."
+"^^^"
+"^As flames danced high in the midnight air,"
+"^A city's dreams turned to smoke and despair."
+"^Rome, once grand and proud,"
+"^Reduced to ashes beneath a fiery shroud.",
  "none",[
    (set_background_mesh, "mesh_pic_fire_of_rome"),
    (try_begin),
        (this_or_next|check_quest_active, "qst_blank_quest_8"),
        (check_quest_succeeded, "qst_blank_quest_8"),
        (call_script, "script_end_quest", "qst_blank_quest_8"),
    (try_end),
    (try_begin),
        (this_or_next|check_quest_active, "qst_petrus"),
        (check_quest_succeeded, "qst_petrus"),
        (call_script, "script_end_quest", "qst_petrus"),
    (try_end),
	],[
    ("continue",[],"Continue.",[
      (play_track, "track_cutscene_fire_track",2),
      (modify_visitors_at_site, "scn_roman_intro_1"),
      (set_jump_mission, "mt_roman_even_fire"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (jump_to_scene, "scn_roman_intro_1"),
      (change_screen_mission),
  ]),
]),

("fire_of_rome_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You leave the place. You start wandering through the streets of Rome and think that life isn't that bad with all the money you now have."
    +" Then you smell something. Smoke. SMOKE! That means FIRE!"
    +" Chaos breaks out around you. People start screaming and running away. Now you realize Rome burns!"
    +"^^You try to fight your way out of the chaos, but you are attacked by some looters, who use the opportunity to pillage some houses.",
    "none",
  [
    (set_background_mesh, "mesh_pic_fire_of_rome"),
	],[
    ("continue",[],"Continue...",[
      (modify_visitors_at_site,"scn_roman_burns"),
      (reset_visitors, 0),
      (set_jump_entry,0),
      (set_visitor, 1, "trp_looter"), #
      (set_visitor, 2, "trp_looter"), #
      (set_visitor, 3, "trp_looter"), #
      (set_jump_mission, "mt_kill_christs"),
      (jump_to_scene, "scn_roman_burns"),
      (change_screen_mission),
    ]),
]),
#########
# events when player is part of the roman empire
###########
("nero_event_new",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "A servant brings you the girl. She seems to be very young, but has no fear, neither from you nor from the guards. You talk a bit with her and soon discover that she is a Christian. She takes her faith seriously"
  +" and wants to stay a virgin until she marries another humble Christian man. She would rather die than have sex without marriage.^^"
  +" Indeed, she is a very beautiful girl. You could sell her for much money...",
  "none",[
    (set_background_mesh, "mesh_pic_girls"),
  ],[
    ("answere_1",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 1000),
    ],"Gift her 1,000 denars and let her go.",[
      (troop_remove_gold, "trp_player", 1000),
      (call_script, "script_change_player_honor", 5),
      (str_store_string, s1, "@The girl is very happy about your decision, hugs you and places you in the name of the sole almighty God. You write a letter to Nero with a detailed description about her 'torture'."),
      (assign, "$temp", "mesh_pic_girls"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Let her go.",[
      (call_script, "script_change_player_honor", 1),
      (str_store_string, s1, "@The girl is very happy about your decision, hugs you and places you in the name of the sole almighty God. You write a letter to Nero with a detailed description about her 'torture'."),
      (assign, "$temp", "mesh_pic_girls"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_3",[],"Keep her as slave.",[
      (party_force_add_prisoners, "p_main_party", "trp_slave_female", 1),
      (call_script, "script_change_player_honor", -1),
      (str_store_string, s1, "@The girl is imprisoned by your troops and tortured, but in a way that preserve her beauty. You write a letter to Nero with a detailed description about her torture. She is now your slave."),
      (assign, "$temp", "mesh_pic_girls"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_4",[],"Sell her on a slave market.",[
      (troop_add_gold, "trp_player", 15000),
      (call_script, "script_change_player_honor", -5),
      (str_store_string, s1, "@The girl is tortured in a way that preverve her beauty. Than she is brought to a slave market where she is sold for 15,000 denars to a patrician, who is famous for his cruel treatment of slaves. You write a letter to Nero with a detailed description about her torture."),
      (assign, "$temp", "mesh_pic_girls"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),

("nero_event_01",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Nero's intervention!^^A scandal shakes the eternal city, Rome. A senator, a close friend of Caesar Nero, has raped the daughter of one of the richest landowners in Italia. Now the landowner brought the case to court. But Nero intervened and stopped the trial."
  +" The landowner and several senators are angry about Nero's action. Everyone in Rome is talking about it. What will you do?",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("answere_1",[],"Support Nero.",[
      (try_begin),
        (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 35),
        (call_script, "script_change_senate_support", -3, 0),
      (try_end),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_troop_controversy", "trp_player", -30),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lord", 2),
      (call_script, "script_change_relation_with_family_friends_enemies", "trp_kingdom_7_lord", 1, 9, "trp_player"),
		  # (store_troop_faction, ":faction1", "trp_kingdom_7_lord"),
			# (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
		  		# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_kingdom_7_lord"),
				# (assign, ":relation", reg0),
				# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_player"),
				# (is_between, reg0, -40, 40),
				# (store_troop_faction,":faction", ":troop"),
				# (eq, ":faction", ":faction1"),
				# (try_begin),
					# (lt, ":relation", 0),
					# (store_div, ":relation_lose", ":relation", 3),
					# (val_sub, ":relation_lose", 2),
          # (val_abs, ":relation_lose"),
					# (val_clamp, ":relation_lose", 1, 13),
					# (val_mul, ":relation_lose", -1),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
        # (else_try),#enemies of him like you
					# (ge, ":relation", 20),
					# (assign, ":relation_gain", ":relation"),
					# (val_abs, ":relation_gain"),
					# (val_div, ":relation_gain", 3),
					# (val_sub, ":relation_gain", 2),
					# (val_clamp, ":relation_gain", 1, 13),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_gain"),
				# (try_end),
			# (try_end),
		  # (str_store_troop_name, s44, "trp_kingdom_7_lord"),
		  # (display_message, "@The enemies of {s44} hate you for your support."),
	    (change_screen_map),
    ]),
    ("answere_2",[],"Stay neutral.",[
		  (change_screen_map),
    ]),
    ("answere_3",[],"Attack Nero.",[
      (try_begin),
        (neg|troop_slot_ge, "trp_senator_dummy", slot_senate_support, 65),
        (call_script, "script_change_senate_support", 1, 0),
      (try_end),
		  (call_script, "script_change_player_honor", 5),
      (call_script, "script_change_troop_controversy", "trp_player", 35),
		  (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lord", -2),
      (call_script, "script_change_relation_with_family_friends_enemies", "trp_kingdom_7_lord", -1, 9, "trp_player"),
		  # (store_troop_faction, ":faction1", "trp_kingdom_7_lord"),
			# (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
		  	# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_kingdom_7_lord"),
				# (assign, ":relation", reg0),
				# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_player"),
				# (is_between, reg0, -40, 40),
				# (store_troop_faction,":faction", ":troop"),
				# (eq, ":faction", ":faction1"),
				# (try_begin),
					# (lt, ":relation", 0),
					# (store_div, ":relation_lose", ":relation", 3),
					# (val_sub, ":relation_lose", 2),
          # (val_abs, ":relation_lose"),
					# (val_clamp, ":relation_lose", 1, 13),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
        # (else_try),#enemies of him like you
					# (ge, ":relation", 20),
					# (assign, ":relation_gain", ":relation"),
					# (val_abs, ":relation_gain"),
					# (val_div, ":relation_gain", 3),
					# (val_sub, ":relation_gain", 2),
					# (val_clamp, ":relation_gain", 1, 13),
					# (val_mul, ":relation_lose", -1),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_gain"),
				# (try_end),
			# (try_end),
		  # (str_store_troop_name, s44, "trp_kingdom_7_lord"),
		  # (display_message, "@The enemies of {s44} like you for your support."),
		  (change_screen_map),
    ]),
]),
("nero_event_02",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Mysterious death!^^Rumors spread through the eternal city, Rome. ^A senator criticized Nero sharp in his speech. At the following day, the senator died under suspicious circumstances."
  +" Now the people of Rome are talking about how the senator died. Some say that the Princeps ordered his assassination, others say that it was a simple robbery. The rumors fly through Rome. What will you do?",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
  ],[
    ("answere_1",[],"Protect Nero.",[
      (try_begin),
        (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 20),
        (call_script, "script_change_senate_support", -4, 0),
      (try_end),
		  (call_script, "script_change_player_honor", -3),
      (call_script, "script_change_troop_controversy", "trp_player", -20),
		  (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lord", 5),
      (call_script, "script_change_relation_with_family_friends_enemies", "trp_kingdom_7_lord", 1, 9, "trp_player"),
		  # (store_troop_faction, ":faction1", "trp_kingdom_7_lord"),
			# (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
        # (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_kingdom_7_lord"),
				# (assign, ":relation", reg0),
				# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_player"),
				# (is_between, reg0, -40, 40),
				# (store_troop_faction,":faction", ":troop"),
				# (eq, ":faction", ":faction1"),
				# (try_begin),
					# (lt, ":relation", 0),
					# (store_div, ":relation_lose", ":relation", 3),
					# (val_sub, ":relation_lose", 3),
          # (val_abs, ":relation_lose"),
					# (val_clamp, ":relation_lose", 1, 13),
					# (val_mul, ":relation_lose", -1),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
        # (else_try),#enemies of him like you
					# (ge, ":relation", 20),
					# (assign, ":relation_gain", ":relation"),
					# (val_abs, ":relation_gain"),
					# (val_div, ":relation_gain", 3),
					# (val_sub, ":relation_gain", 3),
					# (val_clamp, ":relation_gain", 1, 13),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_gain"),
				# (try_end),
			# (try_end),
		  # (str_store_troop_name, s44, "trp_kingdom_7_lord"),
		  # (display_message, "@The enemies of {s44} hate you for your support."),
	    (change_screen_map),
    ]),
    ("answere_2",[],"Say nothing to the case.",[
		  (change_screen_map),
    ]),
    ("answere_3",[],"Attack Nero, he is a murderer!",[
      (try_begin),
        (neg|troop_slot_ge, "trp_senator_dummy", slot_senate_support, 80),
        (call_script, "script_change_senate_support", 2, 0),
      (try_end),
		  (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_troop_controversy", "trp_player", 20),
      # (troop_get_slot, ":controversy", "trp_player", slot_troop_controversy),
      # (val_add, ":controversy", 20),
      # (val_clamp, ":controversy", 0, 100),
	    # (troop_set_slot, "trp_player", slot_troop_controversy, ":controversy"),
		  (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lord", -8),
      (call_script, "script_change_relation_with_family_friends_enemies", "trp_kingdom_7_lord", -1, 9, "trp_player"),
		  # (store_troop_faction, ":faction1", "trp_kingdom_7_lord"),
			# (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
		  	# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_kingdom_7_lord"),
				# (assign, ":relation", reg0),
				# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_player"),
				# (is_between, reg0, -50, 50),
				# (store_troop_faction,":faction", ":troop"),
				# (eq, ":faction", ":faction1"),
				# (try_begin),
					# (lt, ":relation", 0),
					# (store_div, ":relation_lose", ":relation", 3),
					# (val_sub, ":relation_lose", 3),
          # (val_abs, ":relation_lose"),
					# (val_clamp, ":relation_lose", 1, 13),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
        # (else_try),#enemies of him like you
					# (ge, ":relation", 20),
					# (assign, ":relation_gain", ":relation"),
					# (val_abs, ":relation_gain"),
					# (val_div, ":relation_gain", 3),
					# (val_sub, ":relation_gain", 3),
					# (val_clamp, ":relation_gain", 1, 13),
					# (val_mul, ":relation_lose", -1),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_gain"),
				# (try_end),
			# (try_end),
		  # (str_store_troop_name, s44, "trp_kingdom_7_lord"),
		  # (display_message, "@The enemies of {s44} like you for your support."),
		  (change_screen_map),
    ]),
]),
("nero_event_03",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Unpleasant art! ^^Rumors spread through the eternal city, Rome. ^The poet {s30} has composed a {s31} ^Caesar Augustus hates it and has forbidden to publish the piece.",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
    (store_random_in_range, ":string", "str_roman_full_names1", "str_roman_full_namesend"),
    (str_store_string, s30, ":string"),
    (store_random_in_range, ":string", "str_poem_1", "str_poem_end"),
    (str_store_string, s31, ":string"),
	],[
    ("answere_1",[],"Nero has done the right thing, nobody should offend the Princeps.",[
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lord", 1),
      (call_script, "script_change_troop_controversy", "trp_player", -25),
      (display_message, "@You lose support in the senate.", color_bad_news),
      (set_show_messages, 0),
      (call_script, "script_change_senate_support", -1, 0),
      (set_show_messages, 1),
      (change_screen_map),
    ]),
    ("answere_2",[],"Say nothing to the case.",[
		  (change_screen_map),
    ]),
    ("answere_3",[],"Freedom of speech is important, Nero is a fool!",[
		  (call_script, "script_change_player_honor", 2),
	    (call_script, "script_change_troop_controversy", "trp_player", 25),
		  (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lord", -2),
      (display_message, "@You gain support in the senate.", color_good_news),
      (set_show_messages, 0),
      (call_script, "script_change_senate_support", 1, 0),
      (set_show_messages, 1),
      (change_screen_map),
    ]),
]),
("nero_event_04",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Who is the successor? ^^Nero still hasn't a successor."
  +" Thus, the high society of Rome speculates who will be the successor. The rumors fly high."
  +" Others are saying Nero only havn't appointed a successor, as he is still waiting for a son,"
  +" who doesn't come. People start thinking Nero could be impotent.",
  "none",[
    (set_background_mesh, "mesh_pic_girls"),
  ],[
    ("answere_2",[],"Who cares?",[
		  (change_screen_map),
    ]),
]),
("nero_event_05",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Building corruption!^^Caesar Augustus ordered to build a new {s31}. Rumors say that the responsible official has taken some of the money into his own pocket and used poor-quality material for the building."
  +" The fact, that the offical purchased a villa near Rome, supports the rumors. Princeps Nero is angry about such talk, because the offical is a distant relative of him.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
    (store_random_in_range, ":string", "str_building_1", "str_building_end"),
    (str_store_string, s31, ":string"),
	],[
    ("answere_1",[],"Support Nero, the official isn't corrupt.",[
      (try_begin),
        (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 35),
        (call_script, "script_change_senate_support", -2, 0),
      (try_end),
		  (call_script, "script_change_player_honor", -2),
	    (call_script, "script_change_troop_controversy", "trp_player", -20),
		  (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lord", 2),
      (call_script, "script_change_relation_with_family_friends_enemies", "trp_kingdom_7_lord", 1, 9, "trp_player"),
		  # (store_troop_faction, ":faction1", "trp_kingdom_7_lord"),
			# (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
        # (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_kingdom_7_lord"),
				# (assign, ":relation", reg0),
				# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_player"),
				# (is_between, reg0, -40, 40),
				# (store_troop_faction,":faction", ":troop"),
				# (eq, ":faction", ":faction1"),
				# (try_begin),
					# (lt, ":relation", 0),
					# (store_div, ":relation_lose", ":relation", 3),
					# (val_sub, ":relation_lose", 3),
          # (val_abs, ":relation_lose"),
					# (val_clamp, ":relation_lose", 1, 13),
					# (val_mul, ":relation_lose", -1),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
        # (else_try),#enemies of him like you
					# (ge, ":relation", 20),
					# (assign, ":relation_gain", ":relation"),
					# (val_abs, ":relation_gain"),
					# (val_div, ":relation_gain", 3),
					# (val_sub, ":relation_gain", 3),
					# (val_clamp, ":relation_gain", 1, 13),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_gain"),
				# (try_end),
			# (try_end),
		  # (str_store_troop_name, s44, "trp_kingdom_7_lord"),
		  # (display_message, "@The enemies of {s44} hate you for your support."),
	    (change_screen_map),
    ]),
    ("answere_2",[],"Say nothing to the case.",[
		  (change_screen_map),
    ]),
    ("answere_3",[],"Attack Nero, the official is corrupt!",[
      (try_begin),
        (neg|troop_slot_ge, "trp_senator_dummy", slot_senate_support, 70),
        (call_script, "script_change_senate_support", 2, 0),
      (try_end),
		  (call_script, "script_change_player_honor", 2),
	    (call_script, "script_change_troop_controversy", "trp_player", 20),
		  (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lord", -3),
      (call_script, "script_change_relation_with_family_friends_enemies", "trp_kingdom_7_lord", -1, 9, "trp_player"),
		  # (store_troop_faction, ":faction1", "trp_kingdom_7_lord"),
			# (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
		  		# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_kingdom_7_lord"),
				# (assign, ":relation", reg0),
				# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_player"),
				# (is_between, reg0, -40, 40),
				# (store_troop_faction,":faction", ":troop"),
				# (eq, ":faction", ":faction1"),
				# (try_begin),
					# (lt, ":relation", 0),
					# (store_div, ":relation_lose", ":relation", 3),
					# (val_sub, ":relation_lose", 3),
          # (val_abs, ":relation_lose"),
					# (val_clamp, ":relation_lose", 1, 13),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
        # (else_try),#enemies of him like you
					# (ge, ":relation", 20),
					# (assign, ":relation_gain", ":relation"),
					# (val_abs, ":relation_gain"),
					# (val_div, ":relation_gain", 3),
					# (val_sub, ":relation_gain", 3),
					# (val_clamp, ":relation_gain", 1, 13),
					# (val_mul, ":relation_lose", -1),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_gain"),
				# (try_end),
			# (try_end),
		  # (str_store_troop_name, s44, "trp_kingdom_7_lord"),
		  # (display_message, "@The enemies of {s44} like you for your support."),
		  (change_screen_map),
    ]),
]),
("nero_event_06",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Passions of the Augusta!^^Rumors spread through Rome about the Augusta! {s31}",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
    (store_random_in_range, ":string", "str_offense_of_empress_1", "str_offense_of_empress_end"),
    (str_store_string, s31, ":string"),
	],[
     ("answere_2_emperor",[
      (eq, "$g_is_emperor", 1),
    ],"Say nothing to the case.",[
      (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
      (str_store_troop_name, s20, ":spouse"),
      (call_script, "script_change_player_relation_with_troop", ":spouse", -10),
      (display_message, "@Your wife {s20} is angry about you because you don't help her in this case.", color_bad_news),
      (change_screen_map),
    ]),

	  ("answere_1_emperor",[
      (eq, "$g_is_emperor", 1),
	  	(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
	    (str_store_troop_name, s20, ":spouse"),
	  ],"Ha, my wife {s20} is really a pig!",[
      (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
      (str_store_troop_name, s20, ":spouse"),
      (call_script, "script_change_player_relation_with_troop", ":spouse", -30),
      (display_message, "@Your wife {s20} is angry about you because you spread the rumors!", color_bad_news),
      (change_screen_map),
    ]),
	  ("answere_3_emperor",[
      (eq, "$g_is_emperor", 1),
    ],"Who dares to attack my wife! Punish the troublemakers!",[
      (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
      (str_store_troop_name, s20, ":spouse"),
      (call_script, "script_change_player_relation_with_troop", ":spouse", 5),
      (call_script, "script_change_relation_with_family_friends_enemies", ":spouse", 1, 5, "trp_player"),
      # (display_message, "@Your wife {s20} is happy about your help!", color_good_news),
      # (store_troop_faction, ":faction1", ":spouse"),
      # (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
        # (call_script, "script_troop_get_relation_with_troop", ":troop", ":spouse"),
        # (assign, ":relation", reg0),
        # (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_player"),
        # (is_between, reg0, -40, 40),
        # (store_troop_faction,":faction", ":troop"),
        # (eq, ":faction", ":faction1"),
        # (try_begin),
          # (lt, ":relation", 0),
          # (store_div, ":relation_lose", ":relation", 3),
          # (val_sub, ":relation_lose", 3),
          # (val_abs, ":relation_lose"),
          # (val_clamp, ":relation_lose", 1, 13),
          # (val_mul, ":relation_lose", -1),
          # (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
        # (else_try),#enemies of him like you
          # (ge, ":relation", 20),
          # (assign, ":relation_gain", ":relation"),
          # (val_abs, ":relation_gain"),
          # (val_div, ":relation_gain", 3),
          # (val_sub, ":relation_gain", 3),
          # (val_clamp, ":relation_gain", 1, 9),
          # (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_gain"),
        # (try_end),
      # (try_end),
      (change_screen_map),
    ]),
    ("answere_1",[(neq, "$g_is_emperor", 1),],"Support the Augusta and counter these rumors.",[
		  (call_script, "script_change_player_honor", 4),
	    (call_script, "script_change_troop_controversy", "trp_player", -20),
		  (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lord", 3),
		  (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lady_1", 3),
      (call_script, "script_change_relation_with_family_friends_enemies", "trp_kingdom_7_lady_1", 1, 5, "trp_player"),
		  # (store_troop_faction, ":faction1", "trp_kingdom_7_lord"),
			# (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
		  		# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_kingdom_7_lady_1"),
				# (assign, ":relation", reg0),
				# (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_player"),
				# (is_between, reg0, -50, 50),
				# (store_troop_faction,":faction", ":troop"),
				# (eq, ":faction", ":faction1"),
				# (try_begin),
					# (lt, ":relation", 0),
					# (store_div, ":relation_lose", ":relation", 3),
					# (val_sub, ":relation_lose", 3),
          # (val_abs, ":relation_lose"),
					# (val_clamp, ":relation_lose", 1, 8),
					# (val_mul, ":relation_lose", -1),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
        # (else_try),#enemies of him like you
					# (ge, ":relation", 20),
					# (assign, ":relation_gain", ":relation"),
					# (val_abs, ":relation_gain"),
					# (val_div, ":relation_gain", 3),
					# (val_sub, ":relation_gain", 3),
					# (val_clamp, ":relation_gain", 1, 8),
					# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_gain"),
				# (try_end),
			# (try_end),
		  # (str_store_troop_name, s44, "trp_kingdom_7_lady_1"),
		  # (display_message, "@The enemies of {s44} hate you for your support."),
	    (change_screen_map),
    ]),
    ("answere_2",[(neq, "$g_is_emperor", 1),],"Say nothing to the case.",[
		  (change_screen_map),
    ]),
    ("answere_3",[(neq, "$g_is_emperor", 1),],"Attack Nero and his wife, they are both pigs!",[
      (try_begin),
        (neg|troop_slot_ge, "trp_senator_dummy", slot_senate_support, 70),
        (call_script, "script_change_senate_support", 1, 0),
      (try_end),
		  (call_script, "script_change_player_honor", -4),
      (call_script, "script_change_troop_controversy", "trp_player", 20),
		  (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lord", -6),
		  (call_script, "script_troop_change_relation_with_troop", "trp_player", "trp_kingdom_7_lady_1", -6),
      (call_script, "script_change_relation_with_family_friends_enemies", "trp_kingdom_7_lady_1", -1, 5, "trp_player"),
      # (store_troop_faction, ":faction1", "trp_kingdom_7_lady_1"),
      # (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
          # (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_kingdom_7_lady_1"),
        # (assign, ":relation", reg0),
        # (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_player"),
        # (is_between, reg0, -40, 40),
        # (store_troop_faction,":faction", ":troop"),
        # (eq, ":faction", ":faction1"),
        # (try_begin),
          # (lt, ":relation", 0),
          # (store_div, ":relation_lose", ":relation", 3),
          # (val_sub, ":relation_lose", 3),
          # (val_abs, ":relation_lose"),
          # (val_clamp, ":relation_lose", 1, 8),
          # (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
        # (else_try),#enemies of him like you
          # (ge, ":relation", 20),
          # (assign, ":relation_gain", ":relation"),
          # (val_abs, ":relation_gain"),
          # (val_div, ":relation_gain", 3),
          # (val_sub, ":relation_gain", 3),
          # (val_clamp, ":relation_gain", 1, 8),
          # (val_mul, ":relation_lose", -1),
          # (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_gain"),
        # (try_end),
      # (try_end),
      # (str_store_troop_name, s44, "trp_kingdom_7_lady_1"),
      # (display_message, "@The enemies of {s44} like you for your support."),
      (change_screen_map),
    ]),
]),

("spouse_vaste",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Spouse spendings^^You receive a letter from your Quaestor in which he wants to infrom you that your wife has {s31}.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
    (store_random_in_range, reg30, 15000, 25000),
    (store_random_in_range, ":string", "str_parties_of_wife_1", "str_parties_of_wife_end"),
    (str_store_string, s31, ":string"),
    (set_show_messages, 0),
    (call_script, "script_dplmc_withdraw_from_treasury", reg30),
    (set_show_messages, 1),
    (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
    (troop_set_slot, ":spouse", slot_troop_bachus, 1),
	],[
    ("answere_2_emperor",[],"My wife is a true follower of Bachus.",[
      (try_begin),
        (troop_slot_ge, "trp_senator_dummy", slot_senate_support, 35),
        (call_script, "script_change_senate_support", -2, 0),
      (try_end),
      (call_script, "script_change_player_honor", -4),
      (display_message, "@Your wife is the talk of the Empire."),
      (change_screen_map),
    ]),
    ("answere_1",[],"Write a letter to your wife, stating she should not waste money.",[
      (call_script, "script_change_player_honor", 1),
      (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
      (try_begin),
        (call_script, "script_troop_get_relation_with_troop", ":spouse", "trp_player"),
        (ge, reg0, -60),
        (call_script, "script_change_player_relation_with_troop", ":spouse", -10),
      (try_end),
      (display_message, "@Your wife is the talk of the Empire."),
      (change_screen_map),
    ]),
	  ("answere_2",[],"Write a letter to your wife, stating she should start a diet.",[
      (call_script, "script_change_player_honor", 1),
      (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
      (try_begin),
        (call_script, "script_troop_get_relation_with_troop", ":spouse", "trp_player"),
        (ge, reg0, -66),
        (call_script, "script_change_player_relation_with_troop", ":spouse", -15),
      (try_end),
      (display_message, "@Your wife is the talk of the Empire."),
      (change_screen_map),
    ]),
]),
##events for wmen to join
("event_camp_follower_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Female companions^^You receive news that a group of women and widows has heard of your fame and kindness and wishes to join you.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("choice_9_1nor",[],"They are welcome.",[
      (display_message, "@A group of women joins your army."),
      (party_add_members, "p_main_party", "trp_refugee", 6),
      (party_add_members, "p_main_party", "trp_peasant_woman", 6),
      (change_screen_return, 0),
    ]),
    ("choice_9_2nor",[],"I do not need them.",[
      (display_message, "@The women are disappointed."),
      (change_screen_return, 0),
    ]),
    ("choice_9_3nor",[],"Kill them. Surely they will yield some good loot.",[
      (display_message, "@Among the bodies, your men find 500 denars."),
      (call_script, "script_change_player_honor", -5),
      (troop_add_gold, "trp_player", 500),
      (call_script, "script_change_troop_renown", "trp_player", -16),
      (change_screen_return, 0),
    ]),
]),
("event_camp_follower_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Follower women^^You receive news that a number of women express interest in becoming camp followers.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("choice_10_1nor",[],"They are welcome.",[
      (display_message, "@A group of six women joins your army."),
      (party_add_members, "p_main_party", "trp_follower_woman", 6),
      (change_screen_return, 0),
    ]),
    ("choice_10_2nor",[],"I do not need more mouths to feed.",[
      (change_screen_return, 0),
    ]),
]),
("event_camp_follower_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Happy widows join^^You receive news that a group of happy widows and whores wants to join you."
  +" They have heard that you treat women well and pay fair prices for their 'work'.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("choice_11_1no",[],"They are welcome.",[
      (party_add_members, "p_main_party", "trp_fighter_woman", 3),
      (party_add_members, "p_main_party", "trp_hunter_woman", 3),
      (change_screen_return, 0),
    ]),
    ("choice_11_2no",[],"I do not need more troops.",[
      (change_screen_return, 0),
    ]),
]),
###india trade events:
("india_event_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
   "Introduction to trade^^One day you come across a small caravan. The men of the group are clearly a long way from home. Their animals are tired and gear weathered in their long travels. They look exotic and speak only broken Latin."+
   "^You question the travelers and learn that they are traders from the Kushan Empire in the East. Elated to have the attention of the Princeps, they show you their wares, boasting beautiful fabrics and dyes. You share food, expertly flavoured with their exotic spices. The men are happy to leave you some of their goods as gifts, and top it off with an amber and black striped gem, shaped like a large egg. They call it the Tiger's Eye, and it looks remarkably like one.^"
   +"Seems like trade with Kushan brings very interesting luxury goods to your empire. Perhaps this is something to discuss with their ambassador at Domus Augusti in Rome.",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
  ],[
    ("answere_0",[],"Interessting...",[
      (troop_add_gold, "trp_player", 1000),
      (change_screen_map),
    ]),
]),

("india_event_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Naval competition^^There have been increasing pirate attacks on your sea trade around the horn of Africa. Rumor has it, that your great trade fleet has displaced traditional sea merchants"
  +" from Aden. Without a livelihood, some are now turning to crime.",
  "none",[
    (set_background_mesh, "mesh_pic_ships")
  ],[
    ("answere_0",[],"Do nothing. Some losses are inevitable and the situation will stabilize on its own.",[
      (troop_remove_gold, "trp_player", 50000),
      (str_store_string, s1, "@The pirates continue plundering your trade. Losses are mounting."),
      (assign, "$temp", "mesh_pic_seabattle"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_1",[],"Double marines on board, arrange shipping into larger convoys.",[
      (troop_remove_gold, "trp_player", 25000),
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (str_store_string, s1, "@Strong security measures prevent losses and stories of naval victories are well-received at home. Money well spent."),
      (assign, "$temp", "mesh_pic_seabattle"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Import vast quantities of salted fish from Aden, to create jobs for their unemployed mariners.",[
      (troop_remove_gold, "trp_player", 50000),
      (call_script, "script_change_troop_renown", "trp_player", -25),
      (str_store_string, s1, "@The attacks stop, but it costs you, while Romans quietly question whether your approach is humane or cowardly."),
      (assign, "$temp", "mesh_pic_harbor"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Secretly arrange to pay protection money to the biggest pirate gangs.",[
      (troop_remove_gold, "trp_player", 15000),
      (display_message, "@The attacks stop, for no apparent reason. The Roman public quickly loses interest in the matter."),
      (change_screen_map),
    ]),
]),

("india_event_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Sailing by spirit stone^^The latest trade convoy to Kushan brings rumors of advanced navigation methods used by people in faraway lands even further east from Kushan."
  +" It is said they use stones imbued with spirits, who help guard the ships and find their way in the open ocean. Perhaps we can visit this land to buy such stones and"+
  " learn from their best mariners. A modest fleet should be enough and can be outfitted for 100,000 denars.",
  "none",[
    (set_background_mesh, "mesh_pic_ships")
  ],[
    ("answere_0",[],"Search for the spirit stones.",[
      (troop_remove_gold, "trp_player", 100000),
      (store_random_in_range, ":r", 0, 2),
      (str_clear, s1),
      (try_begin),
        (eq, ":r", 0),
        (str_store_string, s1, "@The expedition returns bringing spirit stones and knowledge of their use and manufacture. If balanced on a fine needle, the stone will always face the same direction, no matter how you turn. Ships surrounded by the darkest clouds with no land in sight can use it to keep course and are less likely to be lost. Trading missions are less likely to fail from now on."),
        (troop_set_slot, "trp_diplomat_india", slot_india_compass, 2),
      (else_try),
        (eq, ":r", 1),
        (str_store_string, s1, "@The fleet we sent to lean about the spirit stones returned finding nothing. Maybe the stones are just an old seaman's story, or maybe there will be another lead we can pursue later."),
      (try_end),
      (assign, "$temp", "mesh_pic_harbor"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Not necessary.",[
      (change_screen_map),
    ]),
]),
("india_event_4",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Expand sea trade^^After the latest sea expedition to shores beyond Kushan and the acquisition of the spirit stones for navigation, it is clear that the Roman mariners could"
  +" establish trade routes going even farther. This will require a massive expansion of our great fleet, costing 1,000,000 denars, and still go through Kushan ports as an intermediate stop,"
  +" but will increase the volume of our sea trade.",
  "none",[
    (set_background_mesh, "mesh_pic_ships")
  ],[
    ("answere_0",[],"Make it so!",[
      (troop_remove_gold, "trp_player", 1000000),
      (troop_set_slot, "trp_diplomat_india", slot_india_india_sea_caravan_expanded, 1),
      (change_screen_map),
    ]),
    ("answere_2",[],"Not necessary.",[
      (change_screen_map),
    ]),
]),
##exploration events
("exploration_event_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Grand exhibition^^Your numerous exploration missions mapped much of the lands south and east of the empire and brought countless curios back to Rome."
  +" Each caused a spike of interest and boosted your renown, but eventually people moved on to other news. Perhaps it is time to remind them by organizing a grand festival,"
  +" showing off all the discoveries together to impress the common people.",
  "none",[
    (set_background_mesh, "mesh_pic_bachus")
  ],[
    ("answere_0",[],"Throw a Great Festival of Discovery (cost: 1,000,000 denars)",[
      (troop_set_slot, "trp_plinius_elder", slot_expedition_event_1_shown, 1),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 25),
      (call_script, "script_change_player_honor", 30),
      (call_script, "script_change_troop_renown", "trp_player", 350),
      (call_script, "script_change_player_right_to_rule", 25),
      (troop_remove_gold, "trp_player", 1000000),
      (str_store_string, s1, "str_expedition_event_string_1"),
      (assign, "$temp", "mesh_pic_party"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Not necessary.",[
      (troop_set_slot, "trp_plinius_elder", slot_expedition_event_1_shown, 1),
      (change_screen_map),
    ]),
]),

("exploration_event_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The great worm heist^^Your explorers have made it all the way to the Han Empire, and brought detailed notes of how silk is manufactured there."
  +" Given how desirable and expensive the smooth luxury cloth is in Rome and all its provinces, producing it here would be enormously lucrative."
  +" However, the worms that produce silk are very tightly controlled by the Han Empire and any attempt to export them is punishable by death."
  +"^Many have tried to steal the silk worms and the mulberry bushes they need, but none have succeeded."
  +" Having the resources of a great empire at your command, however, would give you a good chance if you chose to try.^Will you?",
  "none",[
    (set_background_mesh, "mesh_pic_ships")
  ],[
    ("answere_0",[],"Steal the silk worms (cost: 1,000,000 denars)",[
      (troop_set_slot, "trp_plinius_elder", slot_expedition_event_2_shown, 1),
      (troop_remove_gold, "trp_player", 1000000),
      (troop_set_slot, "trp_plinius_elder", slot_expedition_silk_stolen, 1),
      (str_store_string, s1, "str_expedition_event_string_2"),
      (assign, "$temp", "mesh_pic_party"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Not necessary.",[
      (troop_set_slot, "trp_plinius_elder", slot_expedition_event_2_shown, 1),
      (change_screen_map),
    ]),
]),
##########################
#    events for flavor   #
##########################
("emperor_event_comet",0,
  "The Comet of Doom!^^A fiery streak cuts through the night sky, visible from the grandest cities to the smallest villages across the Roman Empire. The comet, its tail burning bright like a flaming spear, has sparked terror and awe among the populace. In the forums of Rome, whispers spread that it heralds the wrath of the gods or the fall of an Caesar."
  +" In the provinces, priests scramble to interpret its meaning, offering sacrifices to avert disaster."
  +"^^Your court is divided. Some see it as an ill omen forewarning calamity, while others dismiss it as mere celestial coincidence. The people, however, grow restless, their faith shaken by this eerie spectacle.",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
  ],[
    ("continue",[
      (store_troop_gold, ":gold", "trp_player"),
      (store_troop_gold, ":treasury", "trp_household_possessions"),
      (val_add, ":gold", ":treasury"),
      (ge, ":gold", 250000),
    ],"Declare the comet a sign of divine displeasure and offer a grand sacrifice. [costs: 250,000 denars; use your own funds!]",[
      (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", 250000, "trp_player"),
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (call_script, "script_change_player_honor", 5),
      (call_script, "script_add_piety", 50),
      (str_store_string, s1, "@The priests declare the gods appeased after the grand sacrifice. The people gather to witness the solemn ceremony, their fears soothed by the promise of divine favor. The comet's fiery presence fades from memory, replaced by renewed hope and loyalty to your rule."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("continue",[
    ],"Declare the comet a sign of divine displeasure and offer a grand sacrifice. [costs: 250,000 denars; use public funds!]",[
      (call_script, "script_add_to_faction_treasury", -250000, "$g_notification_menu_var1"),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      # (call_script, "script_change_player_honor", 5),
      (call_script, "script_add_piety", 5),
      (str_store_string, s1, "@The priests declare the gods appeased after the grand sacrifice. The people gather to witness the solemn ceremony, their fears soothed by the promise of divine favor. The comet's fiery presence fades from memory, replaced by renewed hope and loyalty to your rule."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("continue",[
      (store_troop_gold, ":gold", "trp_player"),
      (store_troop_gold, ":treasury", "trp_household_possessions"),
      (val_add, ":gold", ":treasury"),
      (ge, ":gold", 100000),
    ],"Declare the comet a sign of divine displeasure and offer a sacrifice. [costs: 100,000 denars; use your own funds!]",[
      (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", 100000, "trp_player"),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_add_piety", -5),
      (str_store_string, s1, "@The priests perform the rites with what was given, but they warn that the gods demand greater offerings. The comet lingers in the heavens, fueling panic and distrust among the populace. Many question whether your leadership can avert the gods' wrath."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("continue",[
    ],"Declare the comet a sign of divine displeasure and offer a sacrifice. [costs: 100,000 denars; use public funds!]",[
      (call_script, "script_add_to_faction_treasury", -100000, "$g_notification_menu_var1"),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_add_piety", -5),
      (str_store_string, s1, "@The priests perform the rites with what was given, but they warn that the gods demand greater offerings. The comet lingers in the heavens, fueling panic and distrust among the populace. Many question whether your leadership can avert the gods' wrath."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("continue",[
    ],"What a nonsense! Do nothing.",[
      (try_for_range,":npc",active_npcs_begin,active_npcs_end),
          (this_or_next|troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_hero),#alive
          (troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_lady),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (store_random_in_range,":new_relation",15,35),
          (val_mul, ":new_relation", -1),
          (call_script, "script_troop_change_relation_with_troop", "trp_player", ":npc", ":new_relation"),
      (try_end),
      (val_add, "$g_unrest", 25),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (call_script, "script_change_troop_renown", "trp_player", -100),
      (call_script, "script_change_player_honor", -25),
      (call_script, "script_add_piety", -150),
      (str_store_string, s1, "@No offerings are made, and the comet continues to blaze ominously in the sky. Across the empire, fear and unrest grow. Many blame the inaction of their leaders, seeing the fiery omen as a herald of impending doom. Rebellion seems to simmer on the horizon."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),

("emperor_event_grain_supply",0,
  "The Grain Ships Have Sunk!^^Several ships carrying grain bound for Rome have sunk, threatening famine in the city.^{s25}",
  "none",[
    (store_random_in_range, ":r", 0, 2),
    (try_begin),
        (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
        # (ge, "$g_is_emperor", 1),
        (str_store_string, s25, "str_event_grain_emperor"),
    (else_try),
        (eq, ":r", 0),
        (neg|faction_slot_ge, "$g_notification_menu_var1", slot_faction_debts, 1000000),
        (str_store_string, s25, "str_event_grain_ai_help"),
        (call_script, "script_add_to_faction_treasury", -150000, "$g_notification_menu_var1"),
    (else_try),
        (str_store_string, s25, "str_event_grain_ai_ignore"),
        (call_script, "script_spawn_party", "p_town_6", "pt_rebels"),
    (try_end),
    (set_background_mesh, "mesh_pic_ships"),
  ],[
    ("continue",[
      (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
      # (ge, "$g_is_emperor", 1),
      (store_troop_gold, ":gold", "trp_player"),
      (store_troop_gold, ":treasury", "trp_household_possessions"),
      (val_add, ":gold", ":treasury"),
      (ge, ":gold", 150000),
    ],"Buy additional grain, using funds from your own purse! [150,000 denars]",[
      (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", 150000, "trp_player"),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 2),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("continue",[
      (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
      # (ge, "$g_is_emperor", 1),
    ],"Buy additional grain, using funds from the imperial treasury! [150,000 denars]",[
      (call_script, "script_add_to_faction_treasury", -150000, "$g_notification_menu_var1"),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("continue",[
      (faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
      # (ge, "$g_is_emperor", 1),
    ],"Let them eat cake! [Do nothing]",[
      (call_script, "script_change_troop_renown", "trp_player", -25),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_player_relation_with_center", "p_town_6", -5),
      (call_script, "script_spawn_party", "p_town_6", "pt_rebels"),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("continue",[
      (neg|faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
      # (lt, "$g_is_emperor", 1),
    ],"Continue",[
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

##event for pharaoh quest line
("emperor_event_pharaoh",0,
  "{s25}",
  "none",[
    (try_begin),
        (ge, "$g_is_emperor", 1),
        (str_store_string, s25, "str_event_pharaoh_emperor_description"),
    (else_try),
        (str_store_string, s25, "str_event_pharaoh_king_description"),
    (try_end),
    (set_background_mesh, "mesh_pic_pyramid"),
  ],[
    ("continue",[],"Time to be become Pharaoh!",[
      (setup_quest_text,"qst_become_pharao"),
      (str_store_party_name, s22, "p_town_48"),
      (str_store_string, s2, "@Speak to the magistrate civium of {s22} to initiate a coronation ceremony."),
      (call_script, "script_start_quest", "qst_become_pharao", "trp_fortuna"),
      (quest_set_slot, "qst_become_pharao", slot_quest_current_state, 1),
      (quest_set_slot, "qst_become_pharao", slot_quest_object_state, 1),
      (change_screen_map),
    ]),
]),

###event chain regarding Avaritia and Superbus
("emperor_event_superbus",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Avaritia the thief^^During your daily briefing on the security situation in the city of Rome, an adviser closes his speech with a curious bit of news. He speaks, somewhat unsure whether he is doing the right thing bringing it up.^"
+" 'Divine Caesar, forgive me for bothering you with such a trivial matter, but perhaps it will be of interest."
+"^A thief captured several days ago in the city market claims to be an old acquaintance of yours. Of course, we usually pay such claims no mind. Criminals will say all kinds of nonsense when they are caught, after all. However, she has volunteered to be interrogated under torture and after three days of intense pain she is still insisting on her story."
+"^We suspect there may be a chance, as small as it is, oh Caesar, that she may be telling the truth."
+"^She says her name is Avaritia. Would you like to see her, my lord?'",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
  ],[
    ("answere_1",[],"Send her in.",[
      (call_script, "script_get_meeting_scene"),
      (assign, ":meeting_scene", reg0),
      (modify_visitors_at_site,":meeting_scene"),
      (reset_visitors),
      (set_visitor,0,"trp_player"),
      (set_visitor,17,"trp_avaritia"),
      (set_jump_mission,"mt_conversation_encounter"),
      (jump_to_scene,":meeting_scene"),
      (assign, "$talk_context", tc_avaritia_talk),
      (change_screen_map_conversation, "trp_avaritia"),
    ]),
    ("answere_2",[],"Dismissed.",[
      (str_store_string, s1, "@You wave the annoying adviser off. The Princeps has more important business to attend to."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),
("emperor_event_latrones",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Latrones^^Latrones is a popular Roman two-player board game of military tactics played on a checkered board, the object of which is to eliminate the opponent's"
  +" pieces by outflanking them with your own. Success, as on a battlefield, requires a mix of trickery, intelligence, and experience. It is commonly played in parks and taverns,"
  +" but the nature of a board game means only a few spectators gathered around the table can watch.^^A minor nobleman, who chairs and patronizes Rome's annual latrones tournaments"
  +" is looking to change that. He has devised a scheme for this year's final event to be held at the city's great amphitheater. A huge board would be drawn on the ground, and live gladiators used for pieces,"
  +" commanded by Rome's top two players. As per the game's rules, when two allied gladiators end up on either side of an opponent, they would slay him.^^"
  +"The nobleman hopes to up the game's appeal by introducing bloodsport elements so popular with the crowds. He is asking for your permission and financial support.",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
  ],[
    ("answere_1",[],"Ridiculous! Board games belong on a table.",[
      (troop_set_slot, "trp_diplomat_india", slot_special_event_2, 1),
      (str_store_string, s1, "str_latrones_event_12"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_2",[],"No! Killing gladiators who don't fight back is wrong.",[
      (troop_set_slot, "trp_diplomat_india", slot_special_event_2, 1),
      (str_store_string, s1, "str_latrones_event_12"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_3",[],"Let him do it at his own expense.",[
      (troop_set_slot, "trp_diplomat_india", slot_special_event_2, 1),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 3),
      (str_store_string, s1, "str_latrones_event_3"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_4",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 50000),
    ],"Contribute 50,000 denari to the Latrones Championship Finals.",[
      (troop_set_slot, "trp_diplomat_india", slot_special_event_2, 1),
      (troop_remove_gold, "trp_player", 50000),
      (call_script, "script_change_troop_renown", "trp_player", 50),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 7),
      (str_store_string, s1, "str_latrones_event_4"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),
("emperor_event_purge_nero",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Forget Him!^^The morning was full of meetings with your advisers, who disproportionately referenced the old Princeps. '{s40} approached this problem as follows...',"
  +" '{s40} has left us with a good foundation in this area...', '{s40} sent a mission to...', '{s40} has prohibited this...' and similar were far too common. Annoyingly common!"
  +"^Traveling through the streets of Rome, you can't help noticing how many things in the people's daily life still have {s40}'s name or image on them. A small market square is overlooked by {s40}'s statue."
  +" An actor in the amphitheater tells jokes about {s40}. Columns bear engravings of {s40}'s likeness."
  +" Happy widows in front of houses of ill repute call out to passers by promising to make them feel like {s40} and Caligula at the same time."
  +" Even the poor beggar, happily beaming at the sight of a shiny coin tossed his way, does so when looking at {s40}'s face on that coin."
  +"^A casual visitor might be forgiven to assume {s40} was still Caesar Augustus, Princeps of Rome. Should something be done about this?",
  "none",[
      (set_background_mesh, "mesh_pic_palast"),
      (try_begin),
          (eq, "$g_campaign_type", g_campaign_king),
          (str_store_string, s40, "@Claudius"),
      (else_try),
          (str_store_string, s40, "@Nero"),
      (try_end),
  ],[
    ("answere_1",[],"Chide your advisers to pay you more respect.",[
      (troop_set_slot, "trp_diplomat_india", slot_special_event_1, 1),
      (str_store_string, s1, "@The advisers apologize profusely. Of course, they did not mean to offend, and putting up with Caesar's whims is expected. You hardly ever hear the old Princeps name from anyone in the palace, but beyond its walls nothing changed."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_2",[],"The above, and fund more public performances about yourself.",[
      (troop_set_slot, "trp_diplomat_india", slot_special_event_1, 1),
      (troop_remove_gold, "trp_player", 50000),
      (call_script, "script_change_player_right_to_rule", 2),
      (str_store_string, s1, "@With enough judiciously spent silver you are able to turn the public fashions. Salacious jokes and conversations are now about you, as {s40} talk falls out of style. They talk is not always flattering, but it's definitely about the current Princeps."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_3",[],"All above, and buy up as many {s40} coins as possible, recasting them into your own.",[
      (troop_set_slot, "trp_diplomat_india", slot_special_event_1, 1),
      (troop_remove_gold, "trp_player", 150000),
      (call_script, "script_change_player_right_to_rule", 10),
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_change_troop_renown", "trp_player", -15),
      (str_store_string, s1, "@It costs a fortune, but the impact is clear. Rome now talks about you, pays with your faces cast in metal, just as it should"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_4",[],"All above, and tear down all public displays of {s40}.",[
      (troop_set_slot, "trp_diplomat_india", slot_special_event_1, 1),
      (troop_remove_gold, "trp_player", 250000),
      (call_script, "script_change_player_right_to_rule", 17),
      (call_script, "script_change_troop_renown", "trp_player", -20),
      (call_script, "script_change_player_honor", -5),
      (str_store_string, s1, "@The full-scale remodeling is not cheap, but in the end you have successfully branded Rome with a mark of your ownership. There is some talk of how this money could've been better spent, but little doubt whose city this is."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_5",[]," All above, and declare any mention of his name treasonous.",[
      (troop_set_slot, "trp_diplomat_india", slot_special_event_1, 1),
      (troop_remove_gold, "trp_player", 350000),
      (call_script, "script_change_player_right_to_rule", 25),
      (call_script, "script_change_troop_renown", "trp_player", -23),
      (call_script, "script_change_player_honor", -15),
      (str_store_string, s1, "@Such a draconian decision is nearly unprecedented, but within your power. The full-scale war on {s40}'s legacy sees any mention of him stamped out. The eternal city is full of broken statues, defaced mosaics, and people bleeding out on crosses for the crime of uttering his name. The harsh terror is eventually relaxed, but the point has been made. This is your city and you showed everyone. Even if in doing so you are now quietly called 'the mad Caesar'."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),

("emperor_event_00",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Thestia Domitia^^One of your slaves in the palace seems quite remarkable. She doesn't act like usual slave from the streets - she seems to be learn and tactful,"
  +" having behaviour similar to Roman aristocrats than slaves. You also notice that she is rather shy and a sad person, yet humbly follow all tasks you request from her."
  +" You decide to ask one of your courtiers about her. He says, the young slave used to be a member of the Domitius family, back in times of your predecessor,"
  +" but they went into disgrace with the old Princeps. He then, accused the pater familias of treason and ordered to execute most of the living"
  +" members of the family, except her and the few, who could hid their relationship to the family."
  +" He turned her into his slave to serve in Domus Augusti. This caused a major scandal in the Empire and high resentment towards your predecessor.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("answere_0",[],"I offer her a rank as may companion.",[
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 3),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_occupation, slto_player_companion),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_cur_center, -1),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_met, 1),
      (call_script, "script_recruit_troop_as_companion", "trp_thestia_tomitia"),
      (call_script, "script_change_player_relation_with_troop", "trp_thestia_tomitia", 20),
      (troop_set_faction, "trp_thestia_tomitia", "$players_kingdom"),
      (troop_set_note_available, "trp_thestia_tomitia", 1),
      (str_store_string, s1, "@She seems to be very happy about your proposal and accepts. Rumors spread through Roma, about your good deed! She is now a companion."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_0",[
      (neg|troop_slot_ge, "trp_player", slot_troop_spouse, 1),
      (neg|troop_slot_ge, "trp_player", slot_troop_betrothed, 1),
    ],"I will propose her to marry me. She seems a good match.",[
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 3),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_spouse, "trp_player"),
      (troop_set_slot, "trp_player", slot_troop_spouse, "trp_thestia_tomitia"),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_occupation, slto_kingdom_lady),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_cur_center, -1),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_met, 1),
      (call_script, "script_recruit_troop_as_companion", "trp_thestia_tomitia"),
      (call_script, "script_change_player_relation_with_troop", "trp_thestia_tomitia", 20),
      (troop_set_faction, "trp_thestia_tomitia", "$players_kingdom"),
      (troop_set_note_available, "trp_thestia_tomitia", 1),
      (str_store_string, s1, "@She seems to be very happy about your proposal and accepts. Rumors spread through Roma, about your good deed! She is now your wife."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_0",[],"I will adopt her. She deserves something better.",[
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 3),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_father, "trp_player"),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_occupation, slto_kingdom_lady),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_cur_center, -1),
      (troop_set_slot, "trp_thestia_tomitia", slot_troop_met, 1),
      (call_script, "script_change_player_relation_with_troop", "trp_thestia_tomitia", 20),
      (troop_set_faction, "trp_thestia_tomitia", "$players_kingdom"),
      (troop_set_note_available, "trp_thestia_tomitia", 1),
      (str_store_string, s1, "@She seems to be very happy about your decision and your generosity. Rumors spread through Roma, about your good deed! She is now your adoptive daughter."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_1",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (lt, ":gold", 50000),
        (store_troop_gold, ":gold", "trp_household_possessions"),
      (try_end),
      (ge, ":gold", 50000),
    ],"From now on she shall be free! Additionally, I gift her 50,000 denars.",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (lt, ":gold", 50000),
        (troop_remove_gold, "trp_household_possessions", 50000),
      (else_try),
        (troop_remove_gold, "trp_player", 50000),
      (try_end),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 3),
      (str_store_string, s1, "@She seems to be very happy about your decision and your generosity. Rumors spread through Roma, about your good deed!"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_2",[],"From now on she shall be free!",[
      (str_store_string, s1, "@She seems to be very happy about your decision."),
	    (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_3",[],"Whatever...",[
      (call_script, "script_change_player_honor", -2),
      (change_screen_map),
    ]),
]),
("emperor_event_fake_nero",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Is Nero still alive?^^Rumors spread Nero is alive! A man who looks like Nero and plays the lyre with great skill is gathering supporters, mainly deserters and bandits."
  +" He seems to find much support among the poor. Luckily, none of the governors and legates seem to take him seriously.",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
  ],[
    ("answere_3",[],"Whatever...",[
      (quest_set_slot, "qst_nero_reborn", slot_quest_current_state, 1),
      (change_screen_map),
    ]),
]),
("emperor_event_fake_nero_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Nero reborn!"
  +"^^Yesterday, the man claiming to be Nero and his army of deserters have raided the Mausoleum of Augustus and several other imperial possessions near Rome,"
  +" reclaiming what rightfully should belong to him! The garrison advanced against his army and killed many of them."
  +" Though he could escape and retreated to the island of Cythnus near Sardinia. It would be the best for you to travel to the island and get rid of the matter.",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
  ],[
    ("answere_3",[],"Continue.",[
      (quest_set_slot, "qst_nero_reborn", slot_quest_current_state, 2),
      (setup_quest_text,"qst_nero_reborn"),
      (str_store_string, s2, "@A man claims to be Nero reborn. He is assembling an army of deserters and bandits on the island of Cythnus. Travel to Cythnus and confront him."),
      (call_script, "script_start_quest", "qst_nero_reborn", "trp_fortuna"),
      (change_screen_map),
    ]),
]),
("emperor_event_01",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The island^^You heard that old Caesar Claudius had an Island near the Italian peninsula. There he had a palace full of naked young boys and girls running around and playing."
  +" He celebrated many parties their.^Surely it is a great place to enjoy. But you do not have such an island. You only have your small palace in stinky Rome.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("answere_1",[],"This poor children.",[
	    (change_screen_map),
    ]),
    ("answere_2",[],"I also need such a place!",[
	    (store_troop_gold, ":gold", "trp_player"),
      (val_mul, ":gold", 2),
      (val_div, ":gold", 3),
      (troop_remove_gold, "trp_player", ":gold"),
      (call_script, "script_change_player_honor", -10),
      (display_message, "@Soon after you ordered to build a palace on an Island you lost interest on the project."),
      (change_screen_map),
    ]),
]),
("emperor_event_02",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Underworld^^Last night one of your most beautiful slaves died. She has fallen from the stairs and broke her neck."
  +" Today you remember that the entrance to the underworld is in Sicily, at the mount of Etna.^"
  +"As the son of gods you could try to bring her out of the underworld.",
  "none",[
    (set_background_mesh, "mesh_pic_underworld"),
  ],[
    ("answere_1",[],"This is nonsense.",[
      (add_xp_as_reward, 100),
	    (change_screen_map),
    ]),
    ("answere_2",[],"Yes outfit an expedition to the underworld. I want her back!",[
      (add_xp_as_reward, 50),
      (call_script, "script_change_player_honor", -5),
      (display_message, "@The expedition you send never returned!", message_negative),
      (change_screen_map),
    ]),
]),
("emperor_event_03",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Death^^Everywhere you go people die! You frequently see people dying in various ways."
  +" Some die from an illness, others through violence."
  +" Slaves die when they are punished too hard, senators are murdered or whatever.^You will also die one day!",
  "none",[
    (set_background_mesh, "mesh_pic_underworld"),
  ],[
    ("answere_1",[],"Yes it is our destiny to die.",[
      (add_xp_as_reward, 250),
	    (call_script, "script_change_player_honor", 2),
	    (change_screen_map),
    ]),
    ("answere_2",[],"No I will not die. I am some sort of god!",[
      (call_script, "script_change_player_honor", -10),
      (change_screen_map),
    ]),
]),
("emperor_event_04",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Boats^^Last night you had a dream. In your dream you travelled with a party-boat full of attractive young women through the Empire, making party all time."
  +" This idea of a party-boat does not go out of your head.^What will you do?",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
     ("answere_1",[],"Build such a boat! (200000 denars)",[
      (add_xp_as_reward, 50),
      (store_troop_gold, ":gold", "trp_player"),
      (call_script, "script_change_player_honor", -10),
      (try_begin),
          (lt, ":gold", 200000),
          (display_message, "str_not_enough_gold", message_negative),
          (call_script, "script_change_troop_renown", "trp_player", -50),
	    (else_try),
          (troop_remove_gold, "trp_player", 200000),
          (display_message, "@After the ship was build, it sunk in the habor.", message_negative),
          (call_script, "script_change_troop_renown", "trp_player", -10),
      (try_end),
      (change_screen_map),
    ]),
    ("answere_2",[],"This is a really stupid idea.",[
      (add_xp_as_reward, 100),
      (call_script, "script_change_player_honor", 2),
      (change_screen_map),
    ]),
]),
("emperor_event_05",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Music^^You always dreamed to be a famous musician, haven't you? But you cannot sing that good, sadly."
  +" Now as you are called Caesar Augustus, you have the possibility to start a great carrier.^What will you do?.",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
  ],[
    ("answere_1",[],"Force a lot of people to listen to your music!",[
      (store_random_in_range, ":r", 0, 30),
      (add_xp_as_reward, 1000),
      (try_begin),
        (eq, ":r", 0),
        (display_message, "@Your performance was perfect. It is a real miracle at all!", message_positive),
        (call_script, "script_change_troop_renown", "trp_player", 50),
      (else_try),
        (display_message, "@Your performance was horrible and people laugh about you.", message_negative),
        (call_script, "script_change_troop_renown", "trp_player", -10),
        (call_script, "script_change_player_honor", -10),
        (try_for_range, ":lords", active_npcs_begin, active_npcs_end),
          (store_faction_of_troop, ":fac", ":lords"),
          (eq, ":fac", "$players_kingdom"),
          (store_random_in_range, ":rand", 1, 3),
          (val_mul, ":rand", -1),
          (call_script, "script_change_player_relation_with_troop", ":lords", ":rand"),
        (try_end),
      (try_end),
      (change_screen_map),
    ]),
    ("answere_2",[],"I don't like singing or music at all!",[
      (change_screen_map),
    ]),
    ("answere_3",[],"What a nonsense.",[
      (add_xp_as_reward, 50),
      (change_screen_map),
    ]),
]),
("emperor_event_05_coins",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Coins^^Every Princeps has presented his face on coins, so that every citizen knows how his ruler looks like.^"
  +" Your adviser has asked you if you want to issue a new coinage featuring your portrait."
  +" It would cost you only 200,000 denars and would increase your fame. And even in the future, people would see this coins and know who you are.",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
  ],[
    ("answere_0",[
      (troop_slot_ge, "trp_player", slot_troop_spouse, 1),
      (store_troop_gold, ":gold", "trp_player"),
      (store_troop_gold, ":gold3", "trp_household_possessions"),
      (val_add, ":gold", ":gold3"),
      (ge, ":gold", 200000),
	  ],"Do it and the portrait of my wife should also be featured",[
        #(store_troop_gold, ":gold", "trp_player"),
      (store_troop_gold, ":gold3", "trp_household_possessions"),
      (store_sub, ":c", 200000, ":gold3"),
      (try_begin),
        (lt, ":c", 0),
        (call_script, "script_dplmc_withdraw_from_treasury", 200000),
      (else_try),
        (eq, ":c",0),
        (troop_remove_gold, "trp_player", 200000),
      (else_try),
        (call_script, "script_dplmc_withdraw_from_treasury", ":gold3"),
        (troop_remove_gold, "trp_player", ":c"),
      (try_end),
      (troop_get_slot,":spouse", "trp_player", slot_troop_spouse),
      (call_script, "script_change_player_relation_with_troop", ":spouse", 5),
      (display_message, "@The coins are mint and increase your renown!", color_good_news),
      (call_script, "script_change_troop_renown", "trp_player", 100),
	    (change_screen_map),
    ]),
    ("answere_1",[
      (store_troop_gold, ":gold", "trp_player"),
      (store_troop_gold, ":gold3", "trp_household_possessions"),
      (val_add, ":gold", ":gold3"),
      (ge, ":gold", 200000),
    ],"Yes a good idea",[
      (store_troop_gold, ":gold3", "trp_household_possessions"),
      (store_sub, ":c", 200000, ":gold3"),
      (try_begin),
        (lt, ":c", 0),
        (call_script, "script_dplmc_withdraw_from_treasury", 200000),
      (else_try),
        (eq, ":c",0),
        (troop_remove_gold, "trp_player", 200000),
      (else_try),
        (call_script, "script_dplmc_withdraw_from_treasury", ":gold3"),
        (troop_remove_gold, "trp_player", ":c"),
      (try_end),
      (display_message, "@The coins are mint and increase your renown!",color_good_news),
      (call_script, "script_change_troop_renown", "trp_player", 100),
      (change_screen_map),
    ]),
    ("answere_2",[],"No, too expansive",[
      (change_screen_map),
      (call_script, "script_change_troop_renown", "trp_player", -200),
      (display_message, "@Fame is important ...",color_bad_news),
    ]),
]),
("emperor_event_06",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Megas Alexandros!^^You spend time with a beautiful courtier. She says that you are great, but Megas Alexandros was even greater because he had conquered the whole world!^You answer:",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("answere_1",[],"What? I am a god. I will build an army like Alxeander and conquer even more! (150,000 denars)",[
      (store_troop_gold, ":gold", "trp_player"),
      (add_xp_as_reward, 150),
      (try_begin),
          (lt, ":gold", 150000),
          (display_message, "str_not_enough_gold", message_negative),
          (call_script, "script_change_troop_renown", "trp_player", -100),
      (else_try),
          (troop_remove_gold, "trp_player", 150000),
          (display_message, "@You start rebuilding the makedonian phalanx. You levey more than 500 men.", message_alert),
          (display_message, "@You can now recruit greek troops in barracks", message_alert),
          (call_script, "script_change_troop_renown", "trp_player", 50),
          (party_add_members, "p_main_party", "trp_phalanx", 500),
          (party_add_members, "p_main_party", "trp_hoplit", 100),
          (party_add_members, "p_main_party", "trp_hoplit_2", 100),
          (troop_set_slot, "trp_global_variables", g_can_recruit_greek, 1),
      (try_end),
      (change_screen_map),
    ]),
    ("answere_2",[],"Up with her head!",[
      (call_script, "script_change_player_honor", -2),
      (change_screen_map),
    ]),
    ("answere_3",[],"No. Your breasts are much greater! Now come to my bed...",[
      (add_xp_as_reward, 1500),
      (call_script, "script_change_troop_health", "trp_player", 25),
      (display_message, "@She follows you into a room and you have some funny hours with her.", message_positive),
      (change_screen_map),
    ]),
    ("answere_4",[],"Yes. Alexander was greater than me! And?",[
      (add_xp_as_reward, 250),
      (change_screen_map),
    ]),
]),
("emperor_event_07",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Party time^^Finally you have some time for the pleasures of life!^Today you celebrate a small party in your palace.^What will you do?",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
  ],[
    ("answere_1",[],"Talk with other people, especially the senators to ensure their support.",[
      (add_xp_as_reward, 2500),
      (call_script, "script_change_senate_support", 1, 0),
      (change_screen_map),
    ]),
    ("answere_2",[],"Wine, I want wine!",[
      (call_script, "script_change_player_honor", -2),
      (troop_add_items, "trp_player", "itm_wine", 3),
      (call_script, "script_change_troop_health", "trp_player", 100),
      (change_screen_map),
    ]),
    ("answere_3",[],"Hm, I will take the most beautiful woman and... BANG BANG BANG",[
      (add_xp_as_reward, 1500),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_change_troop_health", "trp_player", 50),
      (change_screen_map),
    ]),
]),
("emperor_event_08",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Accident^^During breakfast one of your slaves stumbles and broke some expansive dishes. The slave starts to cry and apologies for the mistake.",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
  ],[
    ("answere_1",[],"Punish this stupid creature!",[
	    (call_script, "script_change_player_honor", -2),
	    (change_screen_map),
    ]),
    ("answere_2",[],"No problem. We can buy new one",[
      (add_xp_as_reward, 50),
		  (call_script, "script_change_player_honor", 1),
		  (troop_remove_gold, "trp_player", 2000),
      (change_screen_map),
    ]),
]),
 ("emperor_event_09",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Philosophy^^Last day you talked with a greek philiosph about matters of life and death. He pointed out that there are no gods, and that you, of course, are also no god."
  +" He says, that religion is used by the upper class to control the lower classes.",
  "none",[
      (set_background_mesh, "mesh_pic_palast"),
    ],[
    ("answere_1",[],"Yes, thats exactly the purposes of religion.",[
      (add_xp_as_reward, 250),
	    (call_script, "script_change_player_honor", -10),
	    (change_screen_map),
    ]),
    ("answere_2",[],"No! I am a god. Punish him!",[
		  (call_script, "script_change_player_honor", -10),
      (change_screen_map),
    ]),
    ("answere_3",[],"There are gods, of course!",[
      (add_xp_as_reward, 50),
		  (call_script, "script_change_player_honor", 2), (change_screen_map),
    ]),
]),
("emperor_event_10",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Temptations^^As you walk through your palace, you see this beautiful creature. Golden it stands before you. This flower is one of your slaves. Scared she askes:"
  +"^'Divine Caesar. Is there anything I could do for you?'^You answere:",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("continue",[],"No, I was just looking at this beautiful wall painting.",[
      (add_xp_as_reward, 125),
	    (change_screen_map),
    ]),
    ("fuck",[],"You will come with me, girl, into my room. And we have fun!",[
      (add_xp_as_reward, 250),
      (play_sound,"snd_female_laugh"),
      (call_script, "script_change_troop_health", "trp_player", 25),
      (display_message, "@She follows you into a room and you have some funny hours with her.", message_positive),
      (change_screen_map),
    ]),
]),
("emperor_event_11",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Flowers^^You walk through your beautiful gardens with one of your favourite courtiers. She softly touches you, smiles and says:"
  +" 'Flowers, flowers, I want flowers everywhere! They are so beautiful. Decorate the whole palace with flowers!'^You answere:",
  "none",[
    (set_background_mesh, "mesh_pic_girls"),
  ],[
    ("answere_1",[],"This is nonsense.",[
      (add_xp_as_reward, 100),
		  (change_screen_map),
    ]),
    ("answere_2",[],"What? She seems to have gone crazy. Up with her head.",[
      (call_script, "script_change_player_honor", -2),
      (change_screen_map),
    ]),
    ("answere_3",[],"Yes, what ever you want. I will order it! (50,000 denars)",[
      (add_xp_as_reward, 50),
	    (store_troop_gold, ":gold", "trp_player"),
	    (try_begin),
          (lt, ":gold", 50000),
          (display_message, "str_not_enough_gold", message_negative),
          (call_script, "script_change_troop_renown", "trp_player", -50),
	    (else_try),
          (troop_remove_gold, "trp_player", 50000),
          (display_message, "@You order to bring the most beautiful and expensive flowers from the known world.", message_positive),
          (call_script, "script_change_troop_renown", "trp_player", 10),
          #(call_script, "script_change_player_honor", 2),
	    (try_end),
      (display_message, "@People are outraged at your wastefulness.", message_negative),
      (set_show_messages, 0),
      (try_for_range, ":lords", active_npcs_begin, active_npcs_end),
          (store_faction_of_troop, ":fac", ":lords"),
          (eq, ":fac", "$players_kingdom"),
          (store_random_in_range, ":rand", 0, 3),
          (val_mul, ":rand", -1),
          (call_script, "script_change_player_relation_with_troop", ":lords", ":rand"),
      (try_end),
      (set_show_messages, 1),
		  (change_screen_map),
    ]),
]),
("emperor_event_11_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Rich troublemaker^^You hear about a rich merchant who spreads rumors about you in Rome. He also seems to be involved into other intrigues against you."
  +" Due to his wealth it seems to be appropriate to get rid of this troublemaker, before he can cause any real damage to your case.",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
  ],[
    ("answere_1",[],"Whatever, I don't have time for this.",[
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_troop_renown", "trp_player", -25),
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (call_script, "script_change_senate_support", -2, 0),
      (str_clear,s1),
      (str_store_string,s1,"@The merchant was indeed involved into an intrigue against you and managed to damage your reputation, renown and relation with Rome."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("answere_2",[],"I will order the praetorian guard to watch him. Psychological terror will drive him insane.",[
      (add_xp_as_reward, 100),
      (str_clear,s1),
      (str_store_string,s1,"@All day and night long the praetorian guards follow and watch him. All day and night long they stay before his house and talk about the various ways he could be"
      +" punished if they find out that he has committed a crime. After a few days, he can no longer stand the pressure and takes his own life. The problem is gone, and nobody can blame you!"),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("answere_3",[],"Order the praetorian guard to get rid of him",[
      (add_xp_as_reward, 100),
      (call_script, "script_change_player_honor", -10),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (str_clear,s1),
      (str_store_string,s1,"@The merchant is imprisoned by the praetorians and will get crucified. Since there is too little evidence to justify this action, your reputation and relation with Rome suffers."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("emperor_event_12",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Divine freetime^^Being a Caesar can be very stressful. Dozens of people ask you every day either for a favor, or for a order... Finally, you have some free time.^	What will you do?",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
  ],[
    ("answere_1",[],"I will read Cicero or Homer.",[
      (add_xp_as_reward, 500),
      (try_begin),
        (store_attribute_level, ":int","trp_player", ca_intelligence),
        (lt, ":int", 30),
        (troop_raise_attribute, "trp_player", ca_intelligence, 1),
      (try_end),
      (display_message, "@You read some verses of Homers Illias and the Divinatio in Caecilium of Cicero.", message_positive),
      (change_screen_map),
    ]),
    ("answere_2",[],"I will do some sport.",[
      (add_xp_as_reward, 500),
      (try_begin),
        (store_attribute_level, ":str","trp_player", ca_strength),
        (lt, ":str", 30),
        (troop_raise_attribute, "trp_player", ca_strength, 1),
      (try_end),
      (display_message, "@You train speer throwing.", message_positive),
      (call_script, "script_change_troop_health", "trp_player", -50),
      (change_screen_map),
    ]),
    ("answere_3",[],"Bring me wine and something to eat!",[
      (call_script, "script_change_troop_health", "trp_player", 50),
      (display_message, "@You enjoy your meal.", message_positive),
      (change_screen_map),
    ]),
    ("answere_3",[],"Order your guard to bring you the most beautiful girl of Rome and tell her: She has won a night with Caesar himself!",[
      (add_xp_as_reward, 250),
      (call_script, "script_change_troop_health", "trp_player", 25),
      (call_script, "script_change_player_honor", -5),
      (display_message, "@The girl shows up. You have some good hours with her.", message_positive),
      (change_screen_map),
    ]),
]),
("emperor_event_13",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "A senator's son^^One of the senators approaches you stating, he has an illegitimate son (who he favours) who wishes to join your bodyguard, you agree to meet the boy as it would be unseemly to flat out reject a noble."
  +" When you meet the boy, however it is clear that he is rather homely and certainly not a man of war. The senator seems to be willing ro pay 10,000 denars, to grease the deal."
  +" Faced with this plump, smiling young man do you ...",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
	],[
    ("choice_08_1n",[],"Allow him to join your bodyguard, without asking for money.",[
      (call_script, "script_change_player_party_morale", -15),
      (change_screen_return),
    ]),
    ("choice_08_2n",[],"Take the money, grease the deal.",[
      (call_script, "script_change_player_honor", -2),
	    (troop_add_gold, "trp_player", 10000),
      (call_script, "script_change_player_party_morale", -30),
		  (change_screen_return),
    ]),
    ("choice_08_3n",[],"Refuse outright, no money or morale boost.",[
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_troop_renown", "trp_player", -25),
      (display_message, "@The senators seems very angry!"),
      (call_script, "script_change_senate_support", -1, 0),
      (change_screen_return),
    ]),
]),
("emperor_event_14",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Urchin^^As you are on the way to your palace a small child dressed in rags passes through your guards. The child walks up to you and begs for some food;"
  +" your guards hesitate, as they do not want to hurt a child.",
  "none",[
	  (set_background_mesh, "mesh_pic_family"),
	],[
    ("choice_25_1",[],"Lifes not fair, give him nothing.",[
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_change_player_relation_with_center", "p_town_6", -2),
      (display_message, "@ The child's eyes sadly watch you while you follow your path."),
      (change_screen_return),
    ]),
    ("choice_25_2",[],"Give the boy a handful of gold.",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 100),
        (troop_remove_gold, "trp_player", 100),
        (display_message, "@ You feel good for helping."),
        (call_script, "script_change_player_honor", 1),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -5),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_25_3",[],"Give the boy a sack of gold.",[
      (store_troop_gold, ":gold", "trp_player"),
	    (try_begin),
		    (ge, ":gold", 400),
		    (troop_remove_gold, "trp_player", 400),
        (display_message, "@ You feel good for helping."),
        (call_script, "script_change_player_honor", 5),
		  (else_try),
		    (display_message, "str_not_enough_gold"),
		    (call_script, "script_change_troop_renown", "trp_player", -8),
		  (try_end),
	    (change_screen_return),
    ]),
]),
("emperor_event_15",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Gluttony^^After having feasted with your friends repeatedly for the last four months, it appears your clothes no longer fit well."
  +" You have begun wearing open chest tunics and generally snacking on delicious fruits from the east. Dinner is of course a spiced pig roasted to perfection."
  +"	You have no lack of ladies/men willing to satisfy your flesh. Your {s33} however feels you have reached some sort of tipping point, and has suggested fresh air and a general"
  +" course of exercise and a diet.",
  "none",[
	  (set_background_mesh, "mesh_pic_orgie"),
    (str_store_string, s33, "@physician"),
    (try_begin),
        (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
        (gt, ":spouse", 0),
        (str_store_troop_name, s34, ":spouse"),
        (str_store_string, s33, "@spouse {s34}"),
    (try_end),
	],[
    ("choice_05_1n",[],"Eat more food and change your physician.",[
      (troop_add_item, "trp_player","itm_dried_meat",0),
      (troop_add_item, "trp_player","itm_sausages",0),
      (try_begin),
          (store_attribute_level, ":str","trp_player", ca_strength),
          (gt, ":str", 13),
          (troop_raise_attribute, "trp_player", ca_strength, -2),
      (try_end),
      (try_begin),
          (store_attribute_level, ":ag","trp_player", ca_agility),
          (gt, ":ag", 13),
          (troop_raise_attribute, "trp_player", ca_agility, -2),
      (try_end),
      (call_script, "script_change_troop_health", "trp_player", 50),
      (change_screen_return),
    ]),
    ("choice_05_2n",[],"Go to the Agrippa-Therma, to enjoy the water baths there whilst exercising regularly.",[
      (add_xp_as_reward, 250),
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
          (ge, ":gold", 300),
          (troop_remove_gold, "trp_player", 300),
          (call_script, "script_change_troop_health", "trp_player", -25),
      (else_try),
          (display_message, "str_not_enough_gold"),
          (call_script, "script_change_troop_renown", "trp_player", -25),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_05_3n",[],"Exist entirely on bowls of beans and lentils.",[
      (add_xp_as_reward, 250),
      (display_message, "@You develop a foul temper and often execute men who comment on your weight."),
      (call_script, "script_change_player_party_morale", -7),
      (call_script, "script_change_troop_health", "trp_player", 10),
      (change_screen_return),
    ]),
]),
("emperor_event_16",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Sewing contest^^You pass through one of the suburbs of Rome which appears down on its luck."
  +" To give the suburb a boost you announce that you will sponsor a sewing and embroidery contest for the gentle ladyfolk of the town and will reward handsomely the one"
  +" who can produce the brightest, most fashionable yet suitably manly new tunic.",
  "none",[
	  (set_background_mesh, "mesh_pic_family"),
	],[
    ("choice_34_1",[],"Reward the suburb well. Declare the prettiest girl to be the winner and gift her a dinner with you. (cost: 2,500 denars)",[
      (add_xp_as_reward, 250),
      (try_begin),
          (store_troop_gold, ":gold", "trp_player"),
          (ge, ":gold", 2500),
          (troop_remove_gold, "trp_player", 2500),
          (display_message, "@ The tunic isn't important, but the girl..."),
          (call_script, "script_change_troop_renown", "trp_player", 5),
          (troop_add_item, "trp_player","itm_roman_poor2",0),
          (call_script, "script_change_troop_health", "trp_player", 25),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 2),
      (else_try),
          (display_message, "str_not_enough_gold"),
          (call_script, "script_change_troop_renown", "trp_player", -5),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_34_2",[],"Scold the local magistrate for not treating the matter seriously and declaring these rags are not fit for dishcloths.",[
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -5),
      (change_screen_return),
    ]),
    ("choice_34_3",[],"You collect various coloured tunics brought to you and you compliment the local magistrate. (cost: 1,000 denars)",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
          (ge, ":gold", 1000),
          (troop_remove_gold, "trp_player", 1000),
          (display_message, "@ Fame is important."),
          (call_script, "script_change_troop_renown", "trp_player", 5),
          (troop_add_item, "trp_player","itm_roman_poor1",0),
          (troop_add_item, "trp_player","itm_roman_poor2",0),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 1),
      (else_try),
          (display_message, "str_not_enough_gold"),
          (call_script, "script_change_troop_renown", "trp_player", -3),
      (try_end),
      (change_screen_return),
    ]),
]),
("emperor_event_17",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Via Appia^^You walk along the Via Appia and visit the many graves here. Then you see this beautiful tomb much more esthetic then the others."
  +" But the ravages of time have taken their toll: Several inscriptions and reliefs are damaged.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("choice_32_1",[],"Loot and pillage it!.",[
      (call_script, "script_change_player_honor", -50),
      (call_script, "script_change_troop_renown", "trp_player", -50),
      (call_script, "script_change_player_relation_with_center", "p_town_6", -100),
      (call_script, "script_change_player_party_morale", -20),
      (call_script, "script_troop_add_gold", "trp_player", 5000),
      (troop_add_item, "trp_player","itm_pottery",0),
      (display_message, "@ Among the remains of the corpse you find some gold. But the people of Rome despise your action."),
      (try_for_range, ":lords", active_npcs_begin, active_npcs_end),
        (store_faction_of_troop, ":fac", ":lords"),
        (eq, ":fac", "$players_kingdom"),
        (store_random_in_range, ":rand", 2, 5),
        (val_mul, ":rand", -1),
        (call_script, "script_change_player_relation_with_troop", ":lords", ":rand"),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_32_2",[],"Pay for a new gravemarker (20,000 denars)",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 20000),
        (troop_remove_gold, "trp_player", 20000),
        (display_message, "@ You feel good for helping."),
        (call_script, "script_change_player_honor", 10),
        (display_message, "@ Someday, you will be buried too. Like a god of course."),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -5),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_32_3",[],"Tend to the grave and pay your respects",[
      (call_script, "script_change_player_honor", 1),
      (display_message, "@ Someday, you will be buried too. Like a god of course."),
      (change_screen_return),
    ]),
]),
("emperor_event_18",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Poor senators^^You are meet in the palace by some senators who support you. They have come with a small request:"
  +" They all seem to owe a rich merchant 200,000 denars. But they are not able to pay back their debts."
  +" The merchant now has threatened them to bring them before court if they don't pay! The senators would ask you for help in this matter.",
  "none",[
	  (set_background_mesh, "mesh_pic_senators"),
	],[
    ("choice_24_1",[],"I won't help them. They are fools.",[
      (call_script, "script_change_player_honor", -10),
      (call_script, "script_change_troop_renown", "trp_player", -20),
      (call_script, "script_change_senate_support", -5, 0),
      (str_clear,s1),
      (str_store_string,s1,"@The senators are disappointed. They will probably not support you any longer. They also take revenge and damage your renown and reputation."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_24_2",[
      (troop_get_slot, ":g", "trp_player"),
      (ge, ":g", 200000),
    ],"I will pay their debts with my own money. (cost: 200,000 denars)",[
      (troop_remove_gold, "trp_player", 200000),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (str_clear,s1),
      (str_store_string,s1,"@The senators are happy. The debt is paid."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_24_3",[],"I will order the praetorian guard to watch him, if he does any mistake, he will be imprisoned.",[
      # (call_script, "script_change_player_honor", -5),
      # (call_script, "script_change_troop_renown", "trp_player", -25),
      # (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      # (call_script, "script_change_senate_support", -2, 0),
      (str_clear,s1),
      (str_store_string,s1,"@All day and night long the praetorian guards follow and watch him. All day and night long they stay before his house and talk about the various ways he could be punished if they find out at least one crime he has committed in the past. After a few days, he can no longer stand the pressure and takes his own life. The problem is gone, and nobody can blame you!"),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("answere_3",[],"Order the praetorian guard to get rid of him",[
      (call_script, "script_change_player_honor", -10),
      # (call_script, "script_change_troop_renown", "trp_player", -25),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (str_clear,s1),
      (str_store_string,s1,"@The senators are happy about your support. The merchant is imprisoned by the praetorians and will get crucified. Since there is too little evidence to justify this action, your reputation and relation with Rome suffers."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("emperor_event_19",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Day of mourning^^An important magistrate wants to meet you. He presents himself as an emissary from Ostia and without delay informs you that an influential man has died {s2}"
  +" and that his family requests that you agree to declare an official day of mourning in Ostia in his honor. You...",
  "none",[
	  (store_random_in_range, ":rand_no", 1, 10),
    (try_begin),
		    (ge, ":rand_no", 8),
        (str_store_string , s2, "@of a fulminatng disease"),
    (else_try),
        (ge, ":rand_no", 5),
        (str_store_string , s2, "@in a hunting accident"),
    (else_try),
        (ge, ":rand_no", 3),
        (str_store_string , s2, "@of uncertain circumstances"),
    (else_try),
        (str_store_string , s2, "@of an indigestion"),
    (try_end),
	],[
    ("choice_08_1",[],"Agree to such request. (cost: 5,000 denars)",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 5000),
        (party_get_slot, ":cur_relation", "p_town_6", slot_center_player_relation),
        (val_add, ":cur_relation", 2),
        (party_set_slot, "p_town_6", slot_center_player_relation, ":cur_relation"),
        (troop_remove_gold, "trp_player", 5000),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -50),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_08_2",[],"Refuse to such request.",[
      (call_script, "script_change_player_relation_with_center", "p_town_6", -10),
      (change_screen_return),
    ]),
]),
("emperor_event_20",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Vile beggars^^As you walk through the streets of Rome, your procession is always surrounded by beggars. Sometimes they block your path, sometimes they beg very aggressively."
  +" It is getting very annoying over time. Maybe you should do something?",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
	],[
    ("choice_02_1",[],"Allocate 10,000 denars for an alms fund.",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 10000),
        (call_script, "script_change_player_honor", 5),
        (call_script, "script_change_troop_renown", "trp_player", 10),
        (call_script, "script_change_player_relation_with_center", "p_town_6", 4),
        (troop_remove_gold, "trp_player", 10000),
        (display_message, "@Your little help helped not much, there are still many many beggars ..."),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -50),
      (try_end),
      (change_screen_return),
    ]),
    ("choice_02_2",[],"Ignore them.",[
		  (change_screen_return),
    ]),
    ("choice_02_3",[],"Beggars huh? The guards will get rid of them.",[
      (call_script, "script_change_player_honor", -10),
      (change_screen_return),
    ]),
]),
("emperor_event_21",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Attractive courtiers^^You are expected to take part in many social occasions frequented by Rome's high society."
  +" Many among them are extremely pleasant company, thanks to good health, expensive clothing, jewelry, makeup, and spending their time on nothing but perfecting the art of being desirable."
  +" You find yourself attracted to some of them.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
	],[
    ("choice_02_1",[],"Be impartial and rule justly, ignoring personal feelings.",[
      (add_xp_as_reward, 250),
      (str_store_string, s1, "@It will take more than a few pretty faces and charming words to influence your decisions as divine Caesar. After all, there is already no shortage of partners of all shapes and temperaments at your beck and call."),
      (assign, "$temp", "mesh_pic_palast"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_02_2",[],"Play favorites and allow yourself to be influenced.",[
      (add_xp_as_reward, 50),
      (call_script, "script_change_player_honor", -15),
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
        (store_faction_of_troop, ":fac", ":lord"),
        (eq, ":fac", "$players_kingdom"),
        (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_benefactor),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_goodnatured),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_custodian),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
        (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_upstanding),
        (call_script, "script_change_player_relation_with_troop", ":lord", -10),
      (try_end),
      (call_script, "script_change_senate_support", -5, 0),
      (str_store_string, s1, "@You make somewhat lopsided decisions favoring those you like, and often invite your favorites to the palace to discuss politics alone. The socialites quickly grasp what can be converted to influence in your court. Many of the nobles are eager to give you exactly what you want. They compete viciously, trying to outdo each other for the coveted spot of the Princeps favorite, while gossip of your likes and dislikes becomes a valuable commodity over which intricate plots are woven. Many upstanding nobles regard your partiality as scandalous, spreading rumors and harboring hidden disdain, but none dare to ever openly acknowledge what is happening. Caesar Augustus is beyond suspicion, after all."),
      (assign, "$temp", "mesh_pic_senators"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_02_3",[],"Caligula was right: take whatever you want, whenever you want. (This is a bad idea.)",[
      (call_script, "script_change_player_honor", -50),
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
        (store_faction_of_troop, ":fac", ":lord"),
        (eq, ":fac", "$players_kingdom"),
        (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_benefactor),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_goodnatured),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_custodian),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
        (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_upstanding),
        (call_script, "script_change_player_relation_with_troop", ":lord", -50),
      (try_end),
      (call_script, "script_change_senate_support", -30, 0),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 6),
      (val_add, "$g_unrest", 5),
      (str_store_string, s1, "@You unapologetically pursue your interests in a way that is difficult to hide. While nobody would refuse the Princeps company, the degenerate manner in which you do it is highly embarrassing to everyone. Your actions earn you many enemies among the upper classes, although some of the plebs cheer it on, happy to see you stick it to the high society."),
      (assign, "$temp", "mesh_pic_hexe_party"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("emperor_event_22",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Take from the rich^^A Roman nobleman has been justly convicted of treason for plotting against you. The man has been executed, but there is now the matter of his assets, which are considerable.",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
	],[
    ("choice_02_1",[],"Allow the family to inherit his assets.",[
      (call_script, "script_change_player_honor", 2),
      (str_store_string, s1, "@A man's sins are his alone. His family should not suffer. The society generally approves of your leniance, but some see it as a sign of weakness."),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_02_1",[],"Seize the traitor's assets.",[
      (troop_add_gold, "trp_player", 100000),
      (str_store_string, s1, "@To the victor go the spoils!"),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_02_1",[],"Seize the traitor's assets and accuse a few more wealthy Romans of treason to size even more.",[
      (troop_add_gold, "trp_player", 250000),
      (call_script, "script_change_player_honor", -25),
      (call_script, "script_change_player_relation_with_center", "p_town_6", -5),
      (call_script, "script_change_troop_renown", "trp_player", -50),
      (call_script, "script_change_senate_support", -1, 0),
      (str_store_string, s1, "@A vicious slander campaign against your targets lends more convictions, and some families come to pay you off voluntarily to avoid being accused. You seize a fortune, but the secret disdain for you rule soars."),
      (assign, "$temp", "mesh_pic_senators"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("emperor_event_23",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "That's Inappropriate!^^A comedian performs before you and a group of Rome's high society. He is entertaining enough, but nothing special."
  +" As he sees the crowd's ambivalent reaction, the comedian reaches for more and more risky jokes, until he makes one about you that probably crossed a line."
  +" The joke is definitely funny, but the crowd grows so silent, a pin drop would be heard. You order the comedian to approach and he does so, trembling, as tension rises in the room.",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
	],[
    ("choice_02_1",[],"Laugh.",[
      (add_xp_as_reward, 100),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 2),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (str_store_string, s1, "@After holding a dramatic pause with a stoic expression on your face, you let honest laughter overtake you and the relieved audience joins in. The man's jokes ARE funny, after all. He continues, often at your expense, but everyone has a great time in the end."),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_02_1",[],"Have him whipped.",[
      (call_script, "script_change_player_honor", -4),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (str_store_string, s1, "@After reminding the man who he was joking about, you make a show of benevolence from accepting his groveling pleas. The guards bring out a whip and fix a rack right in the hall, and the comedy show turns into a violent spectacle. Most of the crowd find it just as entertaining and have a good time, while the few who thought you acted dishonorably keep quiet."),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_02_1",[],"Kill him.",[
      (call_script, "script_change_player_relation_with_center", "p_town_6", -5),
      (call_script, "script_change_player_honor", -10),
      (str_store_string, s1, "@You tell the man his joke was very funny, but your face says otherwise. Though it needs a better punchline, you say, then swiftly drive a dagger into the comedian's chest. You point to the convulsing man on the floor and announce to the crowd: 'NOW it's funny!' This is met with nervous laughter. There is no great fallout from the act as actors are held in low regard and he did insult Caesar, but some plebs still question if it was necessary."),
      (assign, "$temp", "mesh_pic_senators"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),

("emperor_event_24",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Vestal virgin^^After thirty years of devoted service, the Vestal Virgin {s19}, a distance cousin of {s21}, completes her sacred duties and is now free to leave the temple."
  +" As Caesar, you must decide her fate. Will you honor her with a generous dowry for her years of unwavering commitment,"
  +" or will you deny her this gift and return her to the world with nothing?",
  "none",[
    (try_begin),
        (call_script, "script_cf_get_random_lord_of_faction", "$players_kingdom"),
        (assign, "$temp", reg0),
        (str_store_troop_name_plural, s21, "$temp"),
        (set_background_mesh, "mesh_pic_woman"),

        (store_random_in_range, ":name_1", "str_roman_female_name_01", "str_roman_female_name_end"),
        (store_random_in_range, ":name_2", "str_roman_female_cognomen_1", "str_roman_female_cognomen_end"),
        (str_store_string, s19, ":name_1"),
        (str_store_string, s20, ":name_2"),
        (str_store_string, s19, "@{s19} {s20}"),

    (else_try),
        (jump_to_menu, "mnu_auto_return_map"),
    (try_end),
	],[
    ("choice_01",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 1000000),
    ],"Give her a huge dowry of 1,000,000 denars.",[
      (add_xp_as_reward, 1000),
      (call_script, "script_add_piety", 50, 1),
      (troop_remove_gold, "trp_player", 1000000),
      (call_script, "script_change_player_relation_with_troop", "$temp", 40),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 25),
      (call_script, "script_change_player_honor", 20),
      (call_script, "script_change_troop_renown", "trp_player", 50),
      (str_store_string, s1, "@You bestow upon the former Vestal Virgin a substantial dowry, acknowledging her three decades of loyalty and sacrifice. Upon making your decision, the temple priests and the people of Rome take note of your choice. They praise your generosity"),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_02",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 500000),
    ],"Give her a dowry of 500,000 denars.",[
      (troop_remove_gold, "trp_player", 500000),
      (call_script, "script_add_piety", 25, 1),
      (add_xp_as_reward, 500),
      (call_script, "script_change_player_relation_with_troop", "$temp", 20),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 12),
      (call_script, "script_change_player_honor", 10),
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (str_store_string, s1, "@You bestow upon the former Vestal Virgin a substantial dowry, acknowledging her three decades of loyalty and sacrifice. Upon making your decision, the temple priests and the people of Rome take note of your choice. They praise your generosity."),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_03",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 250000),
    ],"Give her a dowry of 250,000 denars.",[
      (call_script, "script_add_piety", 15, 1),
      (troop_remove_gold, "trp_player", 250000),
      (add_xp_as_reward, 250),
      (call_script, "script_change_player_relation_with_troop", "$temp", 5),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 6),
      (call_script, "script_change_player_honor", 5),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (str_store_string, s1, "@You bestow upon the former Vestal Virgin a substantial dowry, acknowledging her three decades of loyalty and sacrifice. Upon making your decision, the temple priests and the people of Rome take note of your choice. They praise your generosity."),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_04",[],"Give her no dowry.",[
      (call_script, "script_add_piety", -20, 1),
      (call_script, "script_change_player_relation_with_center", "p_town_6", -5),
      (call_script, "script_change_player_honor", -10),
      (call_script, "script_change_troop_renown", "trp_player", -25),
      (str_store_string, s1, "@You send the former Vestal Virgin away without a dowry. Upon making your decision, the temple priests and the people of Rome take note of your choice. Rumours spread that you are greedy!"),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),

("emperor_event_25",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Downfall of a family^^A once-prosperous family, the gens Pupii, has fallen on hard times and can no longer afford the wealth required to maintain their status among the equites."
  +" Their fall from grace is imminent. As Caesar, you hold the power to intervene. Will you choose to provide them with the funds necessary to retain their standing,"
  +" or will you let them face their fate unaided? They need at least 250,000 denars to maintain their status.",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
	],[
    ("choice_01",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 1000000),
    ],"Gift them 1,000,000 denars.",[
      (add_xp_as_reward, 1000),
      (troop_remove_gold, "trp_player", 1000000),
      (call_script, "script_change_player_relation_with_troop", "$temp", 40),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 25),
      (call_script, "script_change_player_honor", 20),
      (call_script, "script_change_troop_renown", "trp_player", 50),
      (str_store_string, s1, "@You offer the struggling family a substantial sum to help them regain their position among the equites. This act of generosity strengthens your reputation"),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_02",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 500000),
    ],"Gift them 500,000 denars.",[
      (troop_remove_gold, "trp_player", 500000),
      (add_xp_as_reward, 500),
      (call_script, "script_change_player_relation_with_troop", "$temp", 20),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 12),
      (call_script, "script_change_player_honor", 10),
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (str_store_string, s1, "@You offer the struggling family a substantial sum to help them regain their position among the equites. This act of generosity strengthens your reputation"),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_03",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 250000),
    ],"Gift them 250,000 denars.",[
      (troop_remove_gold, "trp_player", 250000),
      (add_xp_as_reward, 250),
      (call_script, "script_change_player_relation_with_troop", "$temp", 5),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 6),
      (call_script, "script_change_player_honor", 5),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (str_store_string, s1, "@You offer the struggling family a substantial sum to help them regain their position among the equites. This act of generosity strengthens your reputation"),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_04",[],"Gift them nothing.",[
      (call_script, "script_change_player_relation_with_center", "p_town_6", -2),
      (call_script, "script_change_troop_renown", "trp_player", -25),
      (str_store_string, s1, "@You refuse to aid the family, allowing them to lose their equestrian status. The family tries everything to smear your reputation, though most people think it's their own fault."),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),

("emperor_event_26",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The state is greedy^^A wealthy woman named {s19}, living in a town in Asia minor, died without a will."
  +" This situation prompted a legal question about what should happen to her substantial estate, worth 200,000 denars."
  +" Given the significant wealth involved and the lack of clear heirs, the decision fell to the Roman senate."
  +" The senate decided, that the wealth should go to the state according to law."
  +" Though {s21} asked you to intervene and donate the money to his family. {s19} was a freed slave of his family.",
  "none",[
    (try_begin),
        (call_script, "script_cf_get_random_lord_of_faction", "$players_kingdom"),
        (assign, "$temp", reg0),
        (str_store_troop_name_plural, s21, "$temp"),
        (set_background_mesh, "mesh_pic_woman"),
        (store_random_in_range, ":name_1", "str_roman_female_name_01", "str_roman_female_name_end"),
        (store_random_in_range, ":name_2", "str_roman_female_cognomen_1", "str_roman_female_cognomen_end"),
        (str_store_string, s19, ":name_1"),
        (str_store_string, s20, ":name_2"),
        (str_store_string, s19, "@{s19} {s20}"),
    (else_try),
        (jump_to_menu, "mnu_auto_return_map"),
    (try_end),
	],[
    ("choice_01",[],"Allow {s21}'s family to inherit her assets.",[
      (call_script, "script_change_player_honor", 5),
      (call_script, "script_change_player_relation_with_troop", "$temp", 25),
      (call_script, "script_change_relation_with_family_friends_enemies", "$temp", 1, 10, "trp_player"),
      (str_store_troop_name_plural, s21, "$temp"),
      (str_store_string, s1, "@{s21} is very happy about your support. Though, the senate is upset as you used your veto and acted againest their decision."),

      (call_script, "script_change_senate_support", -5, 0),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_02",[],"The estate shall be auctioned and the funds go to the Roman state!",[
      (call_script, "script_add_to_faction_treasury", 200000, "$players_kingdom"),
      (str_store_troop_name_plural, s21, "$temp"),
      (call_script, "script_change_player_relation_with_troop", "$temp", -50),
      (call_script, "script_change_relation_with_family_friends_enemies", "$temp", -1, 30, "trp_player"),
      (str_store_string, s1, "@Dura lex, sed lex! The law is harsh, but it is the law. Though {s21} is upset about your decision."),
      (assign, "$temp", "mesh_pic_family"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
  #####
 ### provincial events
 #####
###events for jerusalem
("event_jerusalem_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Pilgrim jams^^The great temple of Hierosolyma is center of the jewish faith, where they come from all corners of Judea to pray.^"+
  " The governer of Hierosolyma {s40} has issued a decree to limit the amount of pilgrims entering the city to avoid traffic jams.^"+
  " Many jewish people are angered about this action and seized weapons against the local garrison.",
  "none",[
    (set_background_mesh, "mesh_pic_villageriot"),
    (party_get_slot, ":lord", "p_town_19", slot_town_lord),
    (str_store_troop_name, s40, ":lord"),
	],[
    ("answere_1",[],"Continue.",[
      (set_spawn_radius, 15),
      (try_begin),
          (store_num_parties_of_template, reg54, "pt_mountain_bandits"),
          (lt, reg54, 20),
          (try_for_range, ":unused", 0, 4),
              (call_script, "script_spawn_party","p_town_19","pt_mountain_bandits"),
              (assign, ":party", reg0),
              (party_add_template, ":party", "pt_mountain_bandits"),
              (party_add_template, ":party", "pt_mountain_bandits"),
              (party_add_template, ":party", "pt_mountain_bandits"),
              (party_set_slot, ":party", slot_party_spawn_point, "p_town_19"),
          (try_end),
      (try_end),
      (call_script, "script_spawn_looters", "p_town_19", 4),
      (val_add, "$g_unrest", 2),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (store_random_in_range, ":str", 5, 15),
      (call_script, "script_party_inflict_attrition", "p_town_19", ":str"),
      (change_screen_map),
    ]),
]),

("event_jerusalem_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Another Messiah^^Centuries ago Jewish prophets said, that a savior will come and bring eternal peace to this world.^"
  +" Most jews believe that this savior is a king who liberates Hierosolyma and the people of Israel from their foreign occupation.^"
  +" As a result dozens of small warlords ran around Judea and claim to be the true king over Hierosolyma.",
  "none",[
    (set_background_mesh, "mesh_pic_villageriot"),
	],[
    ("answere_1",[],"Continue.",[
      (set_spawn_radius, 5),
      (try_for_range, ":unused", 0, 6),
          (call_script, "script_spawn_party","p_town_19","pt_mountain_bandits"),
          (assign, ":party", reg0),
          (party_add_template, ":party", "pt_mountain_bandits"),
          (party_add_template, ":party", "pt_mountain_bandits"),
          (party_set_slot, ":party", slot_party_spawn_point, "p_town_19"),
      (try_end),
      (call_script, "script_spawn_looters", "p_town_19", 5),
      (val_add, "$g_unrest", 2),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (store_random_in_range, ":str", 10, 15),
      (call_script, "script_party_inflict_attrition", "p_town_19", ":str"),
      (change_screen_map),
    ]),
]),

("event_jerusalem_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Corrupt priests^^Due to the unstable situation in Judea, the governor {s40} of Hierosolyma has asked the high priests to support him.^"
  +" Some accepted the offer and started to support the foreign rule in their sermons.^"
  +" There are Judeans who are upset with this and call the high priests traitors. However there are also others who may reconsider to join rebel groups. Hopefully this will stabilize the region.",
  "none",[
    (set_background_mesh, "mesh_pic_townriot"),
    (party_get_slot, ":lord", "p_town_19", slot_town_lord),
    (str_store_troop_name, s40, ":lord"),
	],[
    ("answere_1",[],"Continue.",[
      (set_spawn_radius, 5),
      (try_for_range, ":unused", 0, 5),
        (call_script, "script_spawn_party","p_town_19","pt_mountain_bandits"),
        (assign, ":party", reg0),
        (party_set_slot, ":party", slot_party_spawn_point, "p_town_19"),
      (try_end),
      (val_sub, "$g_unrest", 2),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (change_screen_map),
    ]),
]),
("event_jerusalem_4",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The great Jewish revolt!^^The governor {s40} of Hierosolyma suspected, that most of the Jewish population do not pay their taxes. It seems more plausible that {s40} has taken the missing taxes for himself. However, the governor ordered to"
  +" confiscate silver and gold from the treasuries of the temple as compensation for the missing taxes.^ This action had fatale consequences:^ Most jews seized their weapons. This is not a simple town riot it is open rebellion!^"
  +" Without problems they killed the garrison of Hierosolyma! ^^The great jewish rebellion has started.",
  "none",[
    (set_background_mesh, "mesh_pic_villageriot"),
    (party_get_slot, ":lord", "p_town_19", slot_town_lord),
    (str_store_troop_name, s40, ":lord"),
	],[
    ("answere_1",[],"Continue ...",[
      (call_script, "script_cf_start_jewish_revolt"),
      (change_screen_map),
    ]),
]),
##end jerusalem events
##begin events with empire provincial taxation
("event_tax_to_high",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Tax riots!^^High taxes and the rumors of corrupt taxcollectors has caused riots and uprising recently in some towns. The troublemakers demand less taxes.",
  "none",[
    (set_background_mesh, "mesh_pic_townriot"),
    (try_for_range, ":center", towns_begin, towns_end),
        (store_faction_of_party, ":faction", ":center"),
        (eq, ":faction", "$players_kingdom"),
        (store_random_in_range, ":r", 0, 100),
        (lt, ":r", 49),
        (store_random_in_range, ":lose", 1, 3),
        (val_mul, ":lose", -1),
        (call_script, "script_change_player_relation_with_center", ":center", ":lose"),
        (try_begin),
            (party_get_slot, ":lord", ":center", slot_town_lord),
            (gt, ":lord", 0),
            (store_random_in_range, ":rand", 3, 7),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":lord", ":rand"),
        (try_end),
        (store_random_in_range, ":str", 12, 16),
        (call_script, "script_party_inflict_attrition", ":center", ":str"),
       # (lt, ":r", 30),
        (try_begin),
            (faction_slot_ge, "$players_kingdom", slot_faction_tax_rate, 30),
            (store_num_parties_of_template, ":num_parties", "pt_rebels"),
            (lt, ":num_parties", 30),
            (store_random_in_range, ":r", 0, 3),
            (eq, ":r", 0),
            (call_script, "script_spawn_party", ":center", "pt_rebels"),
        (try_end),
    (try_end),
    (try_begin),
      (lt, "$g_unrest", 50),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (val_add, "$g_unrest", 1),
    (try_end),
		# (try_for_range, ":lords", active_npcs_begin, active_npcs_end),
			# (store_faction_of_troop, ":fac", ":lords"),
			# (eq, ":fac", "$players_kingdom"),
			# (store_random_in_range, ":rand", 1, 7),
			# (val_mul, ":rand", -1),
			# (call_script, "script_change_player_relation_with_troop", ":lords", ":rand"),
		# (try_end),
	],[
    ("answere_1",[],"We will see what I can do ...",[
	    (change_screen_map),
    ]),
    ("answere_2",[],"Those smelly peasants ...",[
	    (change_screen_map),
    ]),
]),

("event_temple",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Temple of your honor^^The people of {s25} have sent an envoy requesting permission to build a temple in your honor."
  +" You may choose to either accept or decline this request. If you accept, there will be no additional costs for you, as they will use their own wealth to fund the construction.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, "$temp2", -1),
    (assign, ":score_to_beat", 5),
    (try_for_range, ":walled_center", walled_centers_begin, walled_centers_end),
        (store_faction_of_party, ":faction_center", ":walled_center"),
        (eq, ":faction_center", "$players_kingdom"),
        (neg|party_slot_eq, ":walled_center", slot_town_lord, "trp_player"),
        (party_get_slot, ":score", ":walled_center", slot_center_player_relation),
        (store_random_in_range, ":rand", -35, 25),
        (val_add, ":score", ":rand"),
        (ge, ":score", ":score_to_beat"),
        (assign, ":score_to_beat", ":score"),
        (assign, "$temp2", ":walled_center"),
    (try_end),
    (str_clear, s25),
    (try_begin),
        (eq, "$temp2", -1),
        (jump_to_menu, "mnu_auto_return_map"),
    (else_try),
        (str_store_party_name, s25, "$temp2"),
    (try_end),
	],[
    ("answere_1",[
    ],"Grant the request",[
      (call_script, "script_change_player_relation_with_center", "$temp2", 5),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("answere_2",[
      (quest_get_slot, ":lord", "qst_blank_quest_21",slot_quest_target_troop),
      (str_store_troop_name, s44, ":lord"),
    ],"Refuse the request",[
      (call_script, "script_change_player_relation_with_center", "$temp2", -5),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("event_corruption",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s44}, governor of {s40}, has been blamed to evade taxes, exploit the population with high tributes and abuse of office. The list of crimes he has done against {s40} is long, and the local population is against him.^^"
  +" A local lawer has taken the opportunity and wrote a petition to ask the Princeps for help in this case. ^^"
  +" If you do not response accordingly revolts and peasant uprisings are expected.",
  "none",
  [
    (set_background_mesh, "mesh_pic_senatus"),
    (quest_get_slot, ":center", "qst_blank_quest_21",slot_quest_target_center),
    (quest_get_slot, ":lord", "qst_blank_quest_21",slot_quest_target_troop),
    (str_store_party_name, s40, ":center"),
    (str_store_troop_name, s44, ":lord"),
	],[
    ("i_will",[
      (quest_get_slot, ":lord", "qst_blank_quest_21",slot_quest_target_troop),
      (str_store_troop_name, s44, ":lord"),
    ],"I will talk to {s44} personally.",[
      (quest_set_slot, "qst_blank_quest_21", slot_quest_target_dna, 200),
      (change_screen_map),
    ]),
    ("answere_1",[
      (quest_get_slot, ":lord", "qst_blank_quest_21",slot_quest_target_troop),
      (str_store_troop_name, s44, ":lord"),
    ],"{s44} is guilty, but I won't punish him hard.",[
      (assign, "$temp", 1),
      (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_govern, "$players_kingdom", -5000),
      (jump_to_menu, "mnu_reaction"),
    ]),
    ("answere_2",[
      (quest_get_slot, ":lord", "qst_blank_quest_21",slot_quest_target_troop),
      (str_store_troop_name, s44, ":lord"),
    ],"{s44} is guilty and must be punished, he must pay reparation!",[
      (assign, "$temp", 2),
	    (jump_to_menu, "mnu_reaction"),
    ]),
    ("answere_3",[
      (quest_get_slot, ":lord","qst_blank_quest_21", slot_quest_target_troop),
      (str_store_troop_name, s44, ":lord"),
    ],"{s44} is not guilty. He simply does his job.",[
      (assign, "$temp", 3),
      (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_govern, "$players_kingdom", -10000),
      (jump_to_menu, "mnu_reaction"),
    ]),
]),

("event_corruption_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Irreguar finances^^An adviser informs you of an irregularity in imperial finances. It seems {s44} of {s45} has been sending significantly less coin to Rome than your advisers think is owed."
  +" Such disputes are routine and an imperial inspection of the settlement's finances can often establish facts. In this case, however, much of the original documents were said to be in {s44}'s"
  +" personal possession and were conveniently inaccessible while traveling on campaign.^^Current relation with {s44}: {reg44}",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (str_store_troop_name, s44, "$temp2"),
    (str_store_party_name, s45, "$temp1"),
    (call_script, "script_troop_get_player_relation", "$temp2"),
    (assign, reg44, reg0),
    (quest_set_slot, "qst_governor_corruption", slot_quest_dont_give_again_remaining_days, 14),
	],[
    ("answere_0",[
    ],"It's fine. I trust {s44}. ",[
      (call_script, "script_change_player_relation_with_troop", "$temp2", 2),
      (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_govern, "$players_kingdom", -20000),
      (change_screen_map),
    ]),
    ("answere_1",[
	  ],"Send a letter, summoning {s44}. And they'd better have all the papers.",[
      (jump_to_menu, "mnu_corruption_2_result"),
    ]),
    ("answere_2",[
	  ],"Personally track down {s44} in secret.",
    [
      (jump_to_menu, "mnu_corruption_2_result2")
    ]),
]),

("corruption_2_result",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s1}",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (store_random_in_range, "$temp", 0, 100),
    (try_begin),
      (ge, "$temp", 20),
      (str_store_string, s1, "str_corruption_event_text_1"),
    (else_try),
      (lt, "$temp", 20),
      (setup_quest_text,"qst_governor_corruption"),
      (str_store_troop_name_link, s44, "$temp2"),
      (quest_set_slot, "qst_governor_corruption", slot_quest_expiration_days, 7),
      (quest_set_slot, "qst_governor_corruption", slot_quest_target_troop, "$temp2"),
      (str_store_string, s2, "@Find and confront {s44} about corruption without warning. You will need to move fast, however. No matter how well you keep your intentions secret, rumors will spread and {s44} will surely destroy any evidence if given time."),
      (call_script, "script_start_quest", "qst_governor_corruption", "trp_fortuna"),
      (str_store_string, s1, "str_corruption_event_text_2"),
    (try_end),
  ],[
  ("answere_0",[
	],"Continue..",[
    (try_begin),
      (ge, "$temp", 20),
      (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_govern, "$players_kingdom", -20000),
      (change_screen_map),
    (else_try),
      (lt, "$temp", 20),
      #Fake that it is a party encounter when enlisted party in a town (lines taken from script_game_event_party_encounter)
      (troop_get_slot, ":lord_party", "$temp2", slot_troop_leaded_party),
        (assign, "$g_encountered_party", ":lord_party"),
        (store_faction_of_party, "$g_encountered_party_faction","$g_encountered_party"),
        (store_relation, "$g_encountered_party_relation", "$g_encountered_party_faction", "fac_player_faction"),
        (party_get_slot, "$g_encountered_party_type", "$g_encountered_party", slot_party_type),
        (party_get_template_id,"$g_encountered_party_template","$g_encountered_party"),
        (assign, "$talk_context", tc_party_encounter),
        (call_script, "script_setup_party_meeting", "$g_encountered_party"),
    (try_end),
  ]),
]),

("corruption_2_result2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You dismiss the advisers, but make a note to seek out {s44} in your travels and demand the papers without warning. You will need to move fast, however. No matter how well you keep your intentions secret, rumors will spread and any evidence will surely disappear given time",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
	],[
  ("answere_0",[
  ],"Continue..",[
    (setup_quest_text,"qst_governor_corruption"),
    (str_store_troop_name_link, s44, "$temp2"),
    (quest_set_slot, "qst_governor_corruption", slot_quest_expiration_days, 7),
    (quest_set_slot, "qst_governor_corruption", slot_quest_target_troop, "$temp2"),
    (str_store_string, s2, "@Find and confront {s44} about corruption without warning. You will need to move fast, however. No matter how well you keep your intentions secret, rumors will spread and {s44} will surely destroy any evidence if given time."),
    (call_script, "script_start_quest", "qst_governor_corruption", "trp_fortuna"),
    (change_screen_map),
  ]),
]),

("corrupt_provincial",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Stubborn Local^^The Senate has initiated a trial against the wealthy and influential noble {s12} from {s44}, a settlement within the province of {s40}."
  +" The Senate was outraged by his audacious claim that it rested within his authority to decide whether gratitude should be extended to Rome and its governors."
  +" This declaration is widely seen as a grave insult to Rome and its citizens. {s12} is highly regarded among the people of {s40}, who are now urging you to exercise your consular veto to halt the trial."
  +" On the other hand, senators insist that the evaluation of officials' actions must remain the sole prerogative of the Roman Senate."
  +" They argue that such decisions should be free from undue influence or pressure from provincial factions."
  +"^^You now face a difficult choice: undermine your standing in the Senate by vetoing the decree, or risk inciting the anger of the locals in {s40}.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (str_store_party_name, s44, "$g_notification_menu_var1"),

    (party_get_slot, ":province", "$g_notification_menu_var1", slot_center_province),
    (store_add, ":slot", ":province", slot_province_senatorial_begin),
    (troop_get_slot, "$temp", "trp_province_array", ":slot"),

    (val_add, ":province", "str_province_begin"),
    (str_store_string, s40, ":province"),

    (call_script, "script_get_character_name_for_troop", tf_male, "fac_culture_7"),
	],[
    ("answere_1",[
      (gt, "$temp", 0),
    ],"The province is senatorial and the governor elected by the senate. Don't use your veto. Senate shall decide!",[
      (call_script, "script_change_player_relation_with_center", "p_town_6", 2),
      (call_script, "script_change_senate_support", 5, 0),
      (party_get_slot, ":province", "$g_notification_menu_var1", slot_center_province),
      (try_for_range, ":center", centers_begin, centers_end),
          (party_slot_eq, ":center", slot_center_province, ":province"),
          (store_faction_of_party, ":faction", ":center"),
          (eq, ":faction", "$players_kingdom"),
          (store_random_in_range, ":lose", -5, -1),
          (call_script, "script_change_player_relation_with_center", ":center", ":lose"),
      (try_end),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", -5),
      (str_store_string,s1,"@The province views your decision as a statement of loyalty to the Senate's authority. While some locals express discontent at the lack of intervention, others acknowledge your deference to Rome's laws. However, resentment lingers among {s40}'s population, who feel their concerns have been overlooked."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_2",[
    ],"Use your veto and stop this motion.",[
      (call_script, "script_change_troop_renown", "trp_player", -25),
      (call_script, "script_change_player_relation_with_center", "p_town_6", -5),
      (call_script, "script_change_senate_support", -25, 0),
      (party_get_slot, ":province", "$g_notification_menu_var1", slot_center_province),
      (try_for_range, ":center", centers_begin, centers_end),
          (party_slot_eq, ":center", slot_center_province, ":province"),
          (store_faction_of_party, ":faction", ":center"),
          (eq, ":faction", "$players_kingdom"),
          (store_random_in_range, ":lose", 5, 11),
          (call_script, "script_change_player_relation_with_center", ":center", ":lose"),
      (try_end),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", 15),
      (str_store_string,s1,"@Your veto is seen as a bold defense of the province's interests, earning you the admiration of the people of {s40}. Celebrations erupt in the streets of {s44}, as your intervention is hailed as a triumph over senatorial arrogance. Yet whispers of dissent begin to stir among senators, questioning your commitment to Rome's principles."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_3",[
      (le, "$temp", 0),
    ],"Don't use your veto. The senate shall decide!",[
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 4),
      (call_script, "script_change_senate_support", 10, 0),
      (party_get_slot, ":province", "$g_notification_menu_var1", slot_center_province),
      (try_for_range, ":center", centers_begin, centers_end),
          (party_slot_eq, ":center", slot_center_province, ":province"),
          (store_faction_of_party, ":faction", ":center"),
          (eq, ":faction", "$players_kingdom"),
          (store_random_in_range, ":lose", -10, -1),
          (call_script, "script_change_player_relation_with_center", ":center", ":lose"),
      (try_end),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", -10),
      (str_store_string,s1,"@By abstaining from vetoing the motion, you reinforce the Senate's supremacy, but at the cost of alienating many in {s40}. The locals feel betrayed and mutter about being abandoned by their supposed protector. Still, the Senate takes note of your adherence to its jurisdiction, strengthening your standing in Rome."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_4",[
      (store_troop_gold, ":gold", "trp_player"),
      (store_troop_gold, ":treasury", "trp_household_possessions"),
      (val_add, ":gold", ":treasury"),
      (ge, ":gold", 100000),
    ],"Use your veto and stop this motion. But also shower the province with gifts to ease their anger. [100,000]",[
      (call_script, "script_change_troop_renown", "trp_player", -5),
      # (call_script, "script_change_player_relation_with_center", "p_town_6", 4),
      # (call_script, "script_change_senate_support", 10, 0),
      (party_get_slot, ":province", "$g_notification_menu_var1", slot_center_province),
      (try_for_range, ":center", centers_begin, centers_end),
          (party_slot_eq, ":center", slot_center_province, ":province"),
          (store_faction_of_party, ":faction", ":center"),
          (eq, ":faction", "$players_kingdom"),
          (store_random_in_range, ":lose", 2, 6),
          (call_script, "script_change_player_relation_with_center", ":center", ":lose"),
      (try_end),
      # (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", 3),

      (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", 100000, "trp_player"),
      (str_store_string,s1,"@Your veto is a boon to {s40}, but the lavish gifts you bestow transform frustration into celebration. Merchants, nobles, and commoners alike praise your generosity, and tensions are quickly eased. However, some senators view your actions as an extravagant and calculated play for provincial loyalty, sowing suspicion among your peers in Rome."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),

("miss_managment",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Mismanagement^^"
  +" You receive messages that {s44}, the governor of {s40}, has taken advantage of his position in such a degree that he left the population"
  +" destitute. It doesn't seem he did it with any intention to enrich himself, it seems more he is not capable for the job and messes even"
  +" the easiest things up!",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (str_store_troop_name, s44, "$g_notification_menu_var2"),

    (party_get_slot, ":province", "$g_notification_menu_var1", slot_center_province),
    (store_add, ":slot", ":province", slot_province_senatorial_begin),
    (troop_get_slot, "$temp", "trp_province_array", ":slot"),

    (val_add, ":province", "str_province_begin"),
    (str_store_string, s40, ":province"),
	],[
    ("answere_1",[
      (gt, "$temp", 0),
    ],"The province is senatorial and the governor elected by the senate. There is nothing I can do about it!",[
      (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_govern, "$players_kingdom", -20000),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("answere_1",[
      (le, "$temp", 0),
    ],"I am not the one to blame when other people are incompetent!",[
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", -3),
      (str_clear,s1),
      (str_store_party_name, s40, "$g_notification_menu_var1"),
      (str_store_troop_name, s44, "$g_notification_menu_var2"),
      (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_govern, "$players_kingdom", -10000),
      (store_skill_level, ":trade","skl_trade", "trp_player"),
      (try_begin),
        (ge, ":trade", 6),
        (str_store_string, s33, "@As you futher investigate, you find out that some funds from {s44} province are missing..."),
      (else_try),
        (str_store_string, s33, "@As you futher investigate, you come to a different conclusion. Maybe you made an mistake..."),
      (try_end),
      (str_store_string,s1,"@The people of {s40} had expected some kind of help from you. But it seems they assumed wrong...^^A little bit later you checked your provincial tax income and notice, that it is a little bit lower than before. {s33}"),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_2",[
      (le, "$temp", 0),
    ],"I will send a procurator to investigate this matter...",[
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", 4),
      (str_store_party_name, s40, "$g_notification_menu_var1"),
      (str_store_troop_name, s44, "$g_notification_menu_var2"),
      (try_begin),
        (this_or_next|troop_slot_eq, "$g_notification_menu_var2", slot_lord_reputation_type, lrep_quarrelsome),
        (this_or_next|troop_slot_eq, "$g_notification_menu_var2", slot_lord_reputation_type, lrep_cunning),
        (this_or_next|troop_slot_eq, "$g_notification_menu_var2", slot_lord_reputation_type, lrep_selfrighteous),
        (this_or_next|troop_slot_eq, "$g_notification_menu_var2", slot_lord_reputation_type, lrep_roguish),
        (troop_slot_eq, "$g_notification_menu_var2", slot_lord_reputation_type, lrep_debauched),
        (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", -10),
        (str_store_string, s22, "@{s44} seems very angry about the procurator you have sent."),
      (else_try),
        (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", 2),
        (str_store_string, s22, "@{s44} seems very happy about the help you have sent him and he apologies for his stupidity."),
      (try_end),
      (str_clear,s1),
      (str_store_string,s1,"@The people of {s40} are very happy about your help. {s22}^^The procurator indeed found out that due to {s44}'s bad mathematic skill, funds were missing and there were even more mistakes in regards to the grain supply."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),

("reaction",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s41}.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (quest_get_slot, ":center", "qst_blank_quest_21",slot_quest_target_center),
    (quest_get_slot, ":lord", "qst_blank_quest_21",slot_quest_target_troop),
    (str_store_party_name, s40, ":center"),
    (str_store_troop_name, s44, ":lord"),
    (try_begin),
      (eq, "$temp", 1),#small punish
      (str_store_string, s41, "@The people of {s40} are not very amused to hear that {s44} has only received a small punishment and did not refund the inappropriately collected taxe."),
      (call_script, "script_change_player_relation_with_center", ":center", -15),
      (call_script, "script_change_player_relation_with_troop", ":lord", -5),
    (else_try),
      (eq, "$temp", 2),#big punish
      (str_store_string, s41, "@The people of {s40} celebrate the Princeps for his help and {s44} has refunded the inappropriately collected taxes."),
      (call_script, "script_change_player_relation_with_center", ":center", 15),
      (call_script, "script_change_player_relation_with_troop", ":lord", -40),
      (call_script, "script_add_to_troop_wealth", ":lord", -5000),
      (val_sub, "$g_unrest", 3),
      (display_message, "@Stability of the Empire increases", color_good_news),
      (val_max, "$g_unrest", 0),
    (else_try),
      (eq, "$temp", 3),#no punish
      (str_store_string, s41, "@The people of {s40} are angry that {s44} has been declared as unguilty. Other cities despise your tyranny too."),
      (call_script, "script_change_player_relation_with_center", ":center", -40),
      (try_for_range, ":parties", towns_begin, towns_end),
        (store_faction_of_party, ":fac", ":parties"),
        (eq, ":fac", "$players_kingdom"),
        (store_random_in_range, ":r", 0, 100),
        (lt, ":r", 40),
        (call_script, "script_change_player_relation_with_center", ":parties", -5),
      (try_end),
      (call_script, "script_change_player_relation_with_troop", ":lord", 40),
      (val_add, "$g_unrest", 3),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
    (try_end),
	],[
  ("answere_1",[
	],"Continue.",[
    (complete_quest, "qst_blank_quest_21"),
    (change_screen_map),
  ]),
]),

##end events with empire provincial taxation
##end provincial events
####
## stuff for the rule of the empire
####
("imperial_duties",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Libelli (petitions)^^"
  +"Every citizen of Rome and even peregrini (foreigners) has the right to write petitions to Caesar Augustus. It is expected from the Princeps to answer this petitions with the help of lawyers.^"
  +"Now it is time for you to visit Rome and handle this matter.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
  ],[
    ("answere_1",[],"Means this I must read hundreds of writings and answere them?",[
      (display_message, "@Yes! Hint: Go to Rome and then visit the senate, there you have the option to handle petitions."),
      (setup_quest_text,"qst_blank_quest_4"),
      (quest_set_slot, "qst_blank_quest_4", slot_quest_expiration_days, 20),
      (str_store_string, s2, "@Go to Rome and then visit the senate, there you have the option to handle petitions. It is important to do it. The penalty is high if the quest expire."),
      (call_script, "script_start_quest", "qst_blank_quest_4", "trp_fortuna"),
      (change_screen_map),
    ]),
]),
###libelli events after the offices has beeen created
("libelli_event_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Bureaucratic escalation^^Due to the high amount of petitions going into the libelli office, the head of the office asks you for money, to hire additional personal.^"
  +"He points out that it is very important or they cannot answere all petitions.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
  ],[
    ("answere_1",[
      (store_troop_gold, ":gold", "trp_player"),
	    (ge, ":gold", 20000),
    ],"Well. I give you 20,000 denars!",[
      (troop_remove_gold, "trp_player", 20000),
      (display_message, "@ The head of the offices is pleased to hear that."),
      (change_screen_map),
    ]),
    ("answere_2",[],"I do not have money for this nonsens. Work harder!",[
      (display_message, "@ The head of the office is disappointed."),
      (call_script, "script_add_to_faction_bugdet", slot_faction_taxes_govern, "$players_kingdom", -20000),
      (change_screen_map),
    ]),
]),
 ###event if the office has been disbanded and the libelli edict issued
("libelli_event_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Erosion of institutions^^In some terms the libelli system acted like a supreme court. People had the possibility to reject to abuse of office.^"
  +" It also gave previous Caesars more controll over their Empire.^"
  +" But you have disbanded this institution. Now people lose trust in you.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
  ],[
    ("answere_1",[],"Oh, come on!",[
      (try_for_range, ":unused", 0, 18),
          (store_random_in_range, ":center", walled_centers_begin, walled_centers_end),
          (store_faction_of_party, ":faction", ":center"),
          (eq, ":faction", "$players_kingdom"),
          (store_random_in_range, ":rand", 1, 5),
          (val_mul, ":rand", -1),
          (call_script, "script_change_player_relation_with_center", ":center", ":rand"),
          (call_script, "script_spawn_looters", ":center", 3),
      (try_end),
      (display_message, "@The Empire trembles!", message_negative),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (val_add, "$g_unrest", 2),
      (change_screen_map),
    ]),
]),

("promotion",0,
  "{s39}",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (try_begin),
        (eq, "$g_rank", 0),
        (str_store_string, s41, "str_tribunus"),
        (assign, reg1, salary_aux_1),
        (str_store_string, s39, "@You have been promoted to {s41}, Congratulations! Changes: ^^New salary: {reg1} denars. You can take now up to 100,000 denars from the imperial treasury to recruit troops."),
        (troop_set_slot, "trp_global_variables", g_player_recruitement_limit, gold_tribue),
    (else_try),
        (eq, "$g_rank", 1),
        (str_store_string, s40, "str_tribunus"),
        (str_store_string, s41, "str_praefectus"),
        (assign, reg1, salary_aux_2),
        (str_store_string, s39, "@You have been promoted from {s40} to {s41}, Congratulations! Changes: ^^New salary: {reg1} denars. You can take now up to 250,000 denars from the imperial treasury to recruit troops."),
        (troop_set_slot, "trp_global_variables", g_player_recruitement_limit, gold_praefect),
        (call_script, "script_change_influence", "trp_player", -250),
    (else_try),
        (eq, "$g_rank", 2),
        (str_store_string, s40, "str_praefectus"),
        (str_store_string, s41, "str_legatus"),
        (assign, reg1, salary_legate),
        (str_store_string, s39, "@You have been promoted from {s40} to {s41}, Congratulations! Changes: ^^New salary: {reg1} denars. You can take now up to 500,000 denars from the imperial treasury to recruit troops."),
        (troop_set_slot, "trp_global_variables", g_player_recruitement_limit, gold_legate),
        (call_script, "script_change_influence", "trp_player", -500),
    (try_end),
    (play_sound, "snd_cornu"),
    (add_xp_as_reward, 800),

    (val_add, "$g_rank", 1),
    (val_clamp, "$g_rank", 0, 4),
  ],[
  ("continue",[],"Continue...",[
    (try_begin),
        (eq, "$g_rank", 1),
        (assign, "$temp1", -1),
        (assign, "$temp_troop", -1),
        (call_script, "script_change_troop_renown", "trp_player", 10),
        (start_presentation, "prsnt_select_auxiliar_cohort"),
    (else_try),
        (eq, "$g_rank", 3),
        (assign, "$temp1", -1),
        (assign, "$temp_troop", -1),
        (call_script, "script_change_troop_renown", "trp_player", 25),
        (start_presentation, "prsnt_select_legion_command"),
    (else_try),
        (change_screen_map),
    (try_end),
  ]),
]),

("germania_conquered",0,    #modified motomataru chief
  "You have conquered Germania! You have taken revenge for this shameful massacre of Roman soldiers in the Teuteburger forest.\
  You have managed what nobody before did and subjected the freedom loving Germans. You gain the cognomen 'Germanicus'. You obtain Donar's golden club.",
  "none",
  [
	(set_background_mesh, "mesh_pic_triumph"),
   ],
   [
     ("continue",[],"Ave Caesar! Glory to the Princeps. Me he he...",
     [
     (troop_add_item, "trp_player", "itm_hercules_club", 0),
     (add_xp_as_reward, 10000),
     (display_log_message, "@Germania is now Roman, you gain the cognomen 'Germanicus'.^^Go to Rome to hold a triumph!"),
     (quest_set_slot, "qst_blank_quest_22", slot_quest_target_dna, 1),
     (val_sub, "$g_unrest", 20),
     (display_message, "@Stability of the Empire increases", color_good_news),
     (val_max, "$g_unrest", 0),
		 (call_script, "script_change_troop_renown", "trp_player", 500),
	   (complete_quest, "qst_blank_quest_22"),
     (change_screen_map),
     ]),
   ]
 ),
  ("britannia_conquered",0,    #modified motomataru chief
  "You have conquered Britannia! This Isle now belongs to the Roman Empire. You gain the cognomen 'Britannicus'. You obtain a golden carnyx.^^Go to Rome to hold a triumph!",
  "none",
  [
	(set_background_mesh, "mesh_pic_triumph"),
   ],
   [
     ("continue",[],"Ave Caesar! Glory to the Princeps. Me he he...",
     [
     (troop_add_item, "trp_player", "itm_celtic_carnyx", 0),
     (add_xp_as_reward, 10000),
     (quest_set_slot, "qst_blank_quest_25", slot_quest_target_dna, 1),
     (display_log_message, "@Britannia is now Roman, you gain the cognomen 'Britannicus'"),
     (val_sub, "$g_unrest", 20),
     (display_message, "@Stability of the Empire increases", color_good_news),
     (val_max, "$g_unrest", 0),
     (call_script, "script_change_troop_renown", "trp_player", 250),
	 (complete_quest, "qst_blank_quest_25"),
     (change_screen_map),
     ]),
   ]
 ),
  ("dacia_conquered",0,    #modified motomataru chief
  "You have conquered Dacia! This land now belongs to the Roman Empire. You gain the cognomen 'Dacicus'. You obtain the trasure of the Getae.^^Go to Rome to hold a triumph!",
  "none",
  [
	(set_background_mesh, "mesh_pic_triumph"),
   ],
   [
     ("continue",[],"Ave Caesar! Glory to the Princeps. Me he he...",
     [
     (troop_add_item, "trp_player", "itm_dacian_treasure", 0),
      (add_xp_as_reward, 10000),
     (display_log_message, "@Dacia is now Roman, you gain the cognomen 'Dacicus'"),
     (quest_set_slot, "qst_blank_quest_24", slot_quest_target_dna, 1),
     (val_sub, "$g_unrest", 20),
     (display_message, "@Stability of the Empire increases", color_good_news),
     (val_max, "$g_unrest", 0),
     (call_script, "script_change_troop_renown", "trp_player", 250),
    (complete_quest, "qst_blank_quest_24"),
     (change_screen_map),
     ]),
   ]
 ),
  ("mesopotamia_conquered",0,    #modified motomataru chief
  "You have conquered Mesopotamia! This fertile land between Euphrat and Tigris now belongs to the Roman Empire. You gain the cognomen 'Parthicus'. You also obtain the crown of the Shah.^^Go to Rome to hold a triumph!",
  "none",
  [
	(set_background_mesh, "mesh_pic_triumph"),
   ],
   [
     ("continue",[],"Ave Caesar! Glory to the Princeps. Me he he...",
     [
     (add_xp_as_reward, 10000),
     (troop_add_item, "trp_player", "itm_crown_shah", 0),
     (display_log_message, "@Mesopotamia is now Roman, you gain the cognomen 'Parthicus'"),
     (quest_set_slot, "qst_blank_quest_23", slot_quest_target_dna, 1),
      (val_sub, "$g_unrest", 20),
      (display_message, "@Stability of the Empire increases", color_good_news),
      (val_max, "$g_unrest", 0),
      (call_script, "script_change_troop_renown", "trp_player", 250),
      (complete_quest, "qst_blank_quest_23"),
     (change_screen_map),
     ]),
   ]
 ),

("ad_mortem",mnf_scale_picture,
  "You take a walk close to Rome. The sun touches your face softly. You see a couple sitting in the distance. You hear no birds, no wind, all is quiet...",
  "none",
  [
	(set_background_mesh, "mesh_pic_landschaft"),
   ],
   [
     ("continue",[],"Continue...",
     [
        (assign, "$g_encountered_party", "p_main_party"),#to fix bug in dialog
        (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
        (assign, "$talk_context", 0),#to fix bug in dialog
        (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
        (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
        (assign, "$g_encountered_party_faction", "$players_kingdom"),#to fix bug in dialog
        (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog

        (play_track, "track_cutscene_intro_1",2),
        (modify_visitors_at_site, "scn_roman_intro_1"),
        (set_jump_mission, "mt_roman_intro_1"),
        (reset_visitors),
        (set_visitor, 0, "trp_player",),
        (set_visitor, 1, "trp_old_man",),
        (set_visitor, 2, "trp_guest"),
        (set_visitor, 3, "trp_guest_female"),
        (jump_to_scene, "scn_roman_intro_1"),
        (change_screen_mission),
    # (setup_quest_text,"qst_blank_quest_5"),
    # (str_store_string, s2, "@Ad mortem! ^Hint: Go to Sicily and enter the Undeworld, there look for Teiresias among the dead. (It must be night and you should sacrifice some cows before you enter the underworld to appease the gods.)"),
    # (call_script, "script_start_quest", "qst_blank_quest_5", "trp_fortuna"),
    # (change_screen_map),
     ]),
   ]
),

###triggers when a new year starts, so that agents will age one year at all
("age",0,    #modified motomataru chief
  "A new year has come!^^"+
  "Before us great Death stands^"+
  "Our fate held close within his quiet hands.^"+
  "When with proud joy we lift Life's red wine^"+
  "To drink deep of the mystic shining cup^"+
  "And ecstasy through all our being leaps^"+
  "Death bows his head and weeps.",
  "none",[
	  (set_background_mesh, "mesh_pic_winter"),
  ],[
    ("continue",[],"Continue ...",[
      (try_for_range, ":faction_lord", active_npcs_begin, kingdom_ladies_end),
          (neg|troop_slot_eq, ":faction_lord", slot_troop_occupation, dplmc_slto_dead),#not dead
          (call_script, "script_age_troop_one_year", ":faction_lord"),
      (try_end),
      (try_for_range, ":minor_faction_lord", minor_kings_begin, minor_queens_end),
          (neg|troop_slot_eq, ":minor_faction_lord", slot_troop_occupation, dplmc_slto_dead),#not dead
          (call_script, "script_age_troop_one_year", ":minor_faction_lord"),
      (try_end),
      (troop_set_slot, "trp_global_variables", g_age, 1),
      (call_script, "script_age_troop_one_year", "trp_player"),
      (try_for_range, ":lady", "trp_kingdom_1_lady_1", "trp_gwenhwyfar"),
          (neg|troop_slot_eq, ":lady", slot_troop_spouse, "trp_player"),
          (call_script, "script_add_lady_items", ":lady"),
      (try_end),
      (change_screen_map),
    ]),
]),

("create_pcamp", 0,
    "{s5}", "none",
    [
        (assign, ":free_companion", -1),
        (assign, "$g_talk_troop_party", -1),
        (assign, ":num_free_camps", 0),

        # Find a free camp party slot
        (try_for_range_backwards, ":cur_chest", pcamp_chests_begin, pcamp_chests_end),
            (troop_slot_eq, ":cur_chest", slot_pcamp_chest_party, 0),
            (val_add, ":num_free_camps", 1),
            (assign, "$g_talk_troop_party", ":cur_chest"),
        (try_end),

        # Check skill
        (store_sub, ":num_camp_slots", pcamp_chests_end, pcamp_chests_begin),
        (store_sub, ":num_current_camps", ":num_camp_slots", ":num_free_camps"),
        (store_skill_level, ":skill", pcamp_build_skill, "trp_player"),
        (val_sub, ":skill", pcamp_build_skill_threshold-1),
        (val_sub, ":skill", ":num_current_camps"),
        (val_max, ":skill", 0),
        (val_min, ":num_free_camps", ":skill"),

        # Find a companion to command it
        (party_get_num_companion_stacks, ":num_stacks", "p_main_party"),
        (try_for_range, ":i_stack", 0, ":num_stacks"),
            (party_stack_get_troop_id, ":stack_troop","p_main_party",":i_stack"),
            (troop_is_hero, ":stack_troop"),
            (is_between, ":stack_troop", companions_begin, companions_end),
            (troop_slot_eq, ":stack_troop", slot_troop_prisoner_of_party, -1),
            (assign, ":free_companion", ":stack_troop"),
        (try_end),

        # Find closest center
        (call_script, "script_get_closest_center", "p_main_party"),
        (assign, "$g_talk_troop_faction", reg0),
        (store_distance_to_party_from_party, ":center_distance", "p_main_party", reg0),

        # Check conditions and prepare the message
        (assign, reg5, ":num_free_camps"),
        (store_troop_gold, reg6, "trp_player"),
        (assign, reg7, pcamp_build_cost),
        (str_store_party_name, s0, "$g_talk_troop_faction"),
        (assign, "$g_talk_troop", -1),
        (try_begin),
            (le, "$g_talk_troop_party", 0),
            (str_store_string, s5, "str_pcamp_too_many_camps"),
        (else_try),
            (le, ":free_companion", 0),
            (str_store_string, s5, "str_pcamp_no_free_companions"),
        (else_try),
            (lt, reg6, reg7),
            (str_store_string, s5, "str_pcamp_no_reg7_denars"),
        (else_try),
            (le, ":num_free_camps", 0),
            (str_store_string, s5, "str_pcamp_skill_too_low"),
            (ge, "$cheat_mode", 1),
            (str_store_string, s5, "str_pcamp_s5_cheat_can_do_anyway"),
            (assign, "$g_talk_troop", ":free_companion"),
        (else_try),
            (gt, ":center_distance", pcamp_max_center_distance),
            (str_store_string, s5, "str_pcamp_too_far_from_s0"),
            (ge, "$cheat_mode", 1),
            (str_store_string, s5, "str_pcamp_s5_cheat_can_do_anyway"),
            (assign, "$g_talk_troop", ":free_companion"),
        (else_try),
            (str_store_string, s5, "str_pcamp_can_start_camp_s0_reg5_reg6_reg7"),
            (assign, "$g_talk_troop", ":free_companion"),
        (try_end),
    ],
    [
        ("build_camp",[
            (ge, "$g_talk_troop", 0),
            (assign, reg7, pcamp_build_cost),
        ],
            "Yes, create a permanent camp. ({reg7} denars)",
        [
            (troop_remove_gold, "trp_player", pcamp_build_cost),

            # Spawn the camp
            (set_spawn_radius, 0),
            (call_script, "script_spawn_party","p_main_party", "pt_player_camp"),
            (assign, ":camp_party", reg0),
            (party_set_slot, ":camp_party", slot_party_type, spt_player_camp),

            # Set up ai to (hopefully) avoid any weird behavior from it
            (party_set_slot, ":camp_party", slot_party_ai_state, spai_undefined),
            (party_set_ai_behavior, ":camp_party", ai_bhvr_hold),
            (party_set_ai_initiative, ":camp_party", 0),
            (party_set_helpfulness, ":camp_party", 0),
            (party_set_aggressiveness, ":camp_party", 0),
            (party_set_courage, ":camp_party", 100), # what is the real max value??
            (party_set_bandit_attraction, ":camp_party", 0),

            # Register links to chest
            (assign, ":camp_chest", "$g_talk_troop_party"),
            (call_script, "script_cleanup_player_camp_slot", ":camp_chest"),
            (troop_set_slot, ":camp_chest", slot_pcamp_chest_party, ":camp_party"),
            (troop_set_slot, ":camp_chest", slot_pcamp_chest_center, "$g_talk_troop_faction"),
            (party_set_slot, ":camp_party", slot_pcamp_camp_chest, ":camp_chest"),

            (call_script, "script_find_closest_town", ":camp_party"),
            (troop_set_slot, ":camp_chest", slot_pcamp_chest_city, reg0),

            # Set the commander; the party should always remain fac_player_faction
            (call_script, "script_set_player_camp_commander", ":camp_party", "$g_talk_troop"),

            # (try_begin),
            # (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
            # (party_set_faction, ":camp_party", "$players_kingdom"),
            # (else_try),
            # (party_set_faction, ":camp_party", "fac_player_supporters_faction"),
            # (try_end),

            # Switch the encounter target
            (assign, "$auto_enter_town", ":camp_party"),
            (jump_to_menu, "mnu_auto_return_map"),
        ]),

        ("camp_cancel", [],
            "Go back.",
        [(jump_to_menu, "mnu_camp")])
    ]
),

("player_camp",mnf_scale_picture,
		"You have arrived at your camp. It is commanded by {s3}. What do you want to do?", "none",
		[
			(assign, "$g_camp_mode", 0),
			(assign, "$g_player_icon_state", pis_normal),
			(set_background_mesh, "mesh_pic_camp"),
			(try_begin),
				(eq, "$g_leave_encounter", 1),
				(assign, "$g_encountered_party_template", -1),
				(change_screen_return),
			(else_try),
				(party_get_slot, "$g_talk_troop", "$g_encountered_party", slot_pcamp_camp_commander),
				(party_get_slot, ":camp_chest", "$g_encountered_party", slot_pcamp_camp_chest),
				# withdraw cash
				(store_troop_gold, ":gold", ":camp_chest"),
				(troop_remove_gold, ":camp_chest", ":gold"),
				(troop_add_gold, "trp_player", ":gold"),
				# update stuff
				(call_script, "script_calc_player_camp_bandit_attraction", "$g_encountered_party"),
				(call_script, "script_set_pcamp_banner_from_troop", "$g_encountered_party", "trp_player"),
				(str_store_troop_name, s3, "$g_talk_troop"),
				# Automatically enter dialog in some cases
				(try_begin),
					(eq, "$new_encounter", 1),
					(assign, "$new_encounter", 0),
					(assign, "$g_mission_result", 0),
				(try_end),
				(try_begin),
					(this_or_next|eq, "$g_mission_result", 1),
					(party_slot_eq, "$g_encountered_party", slot_pcamp_camp_initialized, 0),
					(assign, "$g_mission_result", 0),
					(party_set_slot, "$g_encountered_party", slot_pcamp_camp_initialized, 1),
					(assign, "$talk_context", tc_permanent_camp_talk),
					(call_script, "script_setup_party_meeting", "$g_encountered_party"),
				(try_end),
			(try_end),
		],
		[
			("camp_manage",[],"Manage the camp.",
				[
					(assign, "$talk_context", tc_permanent_camp_talk),
					(call_script, "script_setup_party_meeting", "$g_encountered_party"),
				]),

			# Original camp menus
			("camp_action",[],"Take an action.",
				[(jump_to_menu, "mnu_camp_action")]),

			("camp_cheat", [(ge, "$cheat_mode", 1)], "CHEAT MENU!",
				[(jump_to_menu, "mnu_camp_cheat")]),

			# Wait in camp etc
			("camp_wait_here",[],"Wait here for some time.",
				[
					(assign, "$g_camp_mode", 1),
					(assign, "$g_infinite_camping", 0),
					(assign, "$auto_enter_town", "$g_encountered_party"),

					# Ensure position is exactly the same to avoid two partially overlapping icons
					# However it doesn't compensate rotation, so there is still mismatch...
					#(assign, "$g_player_icon_state", pis_camping),
					#(party_relocate_near_party, "p_main_party", "$g_encountered_party", 0),

					(rest_for_hours_interactive, 24 * 7, 5, 1), #rest while attackable

					(assign, "$g_encountered_party_template", -1),
					(change_screen_return),
				]),

			("resume_travelling",[],"Resume travelling.",
				[
					(assign, "$g_encountered_party_template", -1),
					(change_screen_return),
				]),
]),

("remember",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your promise^\
	A messenger brings a letter from the Praefectus of the Praetorian Guard: ^^\
	{playername},^\
	Now that you are Caesar Augustus and Princeps of Rome I want to remind you on your promise you gave me.^ \
	I know you are a man of honor and you will do all necessaries to fullify your promise.^\
	Yours faithfully Kaeso Flavius!",
    "none",
    [(set_background_mesh, "mesh_pic_messenger"),],
    [
     ("answere_1",[],"Ah I should fullify my promise.",
       [
		(display_message, "@Hint: Go and talk with your minister about edicts."),
		(quest_set_slot, "qst_blank_quest_19", slot_quest_current_state, 110),
		(change_screen_map),
		],
       ),
     ("answere_2",[],"I won't do anyrhing. Those stupid Christians.",
       [
		(quest_set_slot, "qst_blank_quest_19", slot_quest_current_state, 200),
		(change_screen_map),
		],
       ),
    ]
),
("remember2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your promise^\
	A messenger brings a letter from the Praefectus of the Praetorian Guard: ^^\
	{playername},^\
	I know that a Caesar has many duties and managing an empire is not easy.^ \
	Many days have passed and you still have not fullify your promise. For the sake of our friendship,^\
	I beg you to keep your promise.^\
	Yours hopefully Kaeso Flavius!",
    "none",
    [(set_background_mesh, "mesh_pic_messenger"),],
    [
     ("answere_1",[],"Ah I will fullify my promise immediately.",
       [
		(display_log_message, "@New edict issued: Edictum Christiani, see reports for more information."),
		(try_begin),
			(eq, "$edict4", 1),
			(display_log_message, "@Edict revoked: Edictum securitatis publica."),
			(assign, "$edict4", 0),
		(try_end),
		(assign, "$edict3", 1),
		(quest_set_slot, "qst_blank_quest_19", slot_quest_current_state, -1),
		(str_clear, s20),
		(add_quest_note_from_sreg, "qst_blank_quest_19", 3, s20, 0),
		(change_screen_map),
		],
       ),
     ("answere_2",[],"I will sent him an angry letter stating I will never help any Christians!",
       [
		(quest_set_slot, "qst_blank_quest_19", slot_quest_current_state, 0),
		(call_script, "script_change_player_relation_with_troop", "trp_legatus_12", -200),
		(display_message, "@You have broken your promise!", message_negative),
		(str_clear, s20),
		(add_quest_note_from_sreg, "qst_blank_quest_19", 3, s20, 0),
		(change_screen_map),
		],
       ),
    ]
),

("persecution",0,
  "Persecution^^As you come closer to the town, you see crosses. First you don't know what is going on. You stand there and look"
  +" at those people hanging on the crosses.^Mankind left alone and lonely, as Death, on the morrow Harvests the grain of humans.^^"
  +"You see a mob, several hundred people, throwing rotten food on a woman with her child. You hear someone shout: 'Those Christians are weak sheep! They must be slaughtered like the animals they are.' The mob roars.",
  "none",[
    (set_background_mesh, "mesh_pic_kreuzigung"),
		(party_get_slot, ":slaves", "$current_town", slot_crucified_slave_icon),
		(remove_party, ":slaves"),
		(party_set_slot, "$current_town", slot_crucified_slave_icon, -1),
    (party_set_slot, "$current_town", slot_center_pursue, 0),
  ],[
    ("answer_1",[
      (troop_slot_eq, "trp_player", slot_troop_religion, worships_christus),
    ],"My poor brothers and sisters in faith!",[
      (jump_to_menu, "mnu_town"),
    ]),
    ("answer_1",[
      (neg|troop_slot_eq, "trp_player", slot_troop_religion, worships_christus),
    ],"Pathetic",[
      (jump_to_menu, "mnu_town"),
    ]),
    ("answer_2",[
      (store_attribute_level, ":intelligence", "trp_player", ca_intelligence),
      (ge, ":intelligence", 18),
    ],"Religious fanatism is the cancer of mankind.",[
      (jump_to_menu, "mnu_town"),
    ]),
    ("answer_3",[
      (neq, "$g_is_emperor", 1),
      (store_attribute_level, ":intelligence", "trp_player", ca_intelligence),
      (ge, ":intelligence", 20),
    ],"I should help her.",[
      (jump_to_menu, "mnu_speech"),
    ]),
]),

("speech",0,
    "You come closer to the mob and shout: 'Silentium! Leave the poor woman alone!' ^\
	You climb on a rock and then continue:^\
	'Why are you doing this? Why must people always be cruel! She is like you. She has nothing. Does anybody of you have anything. ^\
	There is only one difference between you and her: She worships another god! And? What's the problem? Does any god ever has done anything for you?^\
	Does anybody of you ever see a god doing something for the good of mankind? There is no difference if there is only one god, or several gods! It makes no difference!^\
	The reality is that you are all poor. That's it! That's what really matters! You all are exploited by the rich. You should not kill each other.^\
	You should help each other. There is no higher creature which will help, no god who will give you something. You must help yourself. That is only possible, ^^\
	IF YOU STAND TOGETHER!'",
    "none",
    [
        (set_background_mesh, "mesh_pic_townriot"),
      ],
    [
      ("reaction",[
	  ],"See how the mob reacts.",
	  [
	  (jump_to_menu, "mnu_reaction_mob"),
      ]),

	],
),
("reaction_mob",0,
    "During your speech nobody moved. Everybody watched you. Only the woman with the child takes the opportunity and run away quickly.^\
	After you have shouted the last words, there is silence. Not even the birds are singing. You look around and watch the people closely. ^\
	Some are looking at their feet. Others stare at you. Some women cry. Then you see a man throwing a stone in your direction hitting your arm ...^^\
	You decide to ...",
    "none",
    [ (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      ],
    [
      ("answer_1",[],"RUN!",
	  [
	(store_attribute_level, ":agility", "trp_player", ca_agility),
	(store_random_in_range, ":r", 0, 35),
	(try_begin),
		(lt, ":r", ":agility"),
		(display_message, "@You run like you never run before in life and managed to escape the worth of the mob!", message_positive),
		(change_screen_map),
	(else_try),
		(display_message, "@You stumble and fall!", message_negative),
		(jump_to_menu, "mnu_caputred_by_mob"),
	(try_end),
      ]),
	],
),

("caputred_by_mob",0,
    "You fall and hit the earth. Then the mob surrounds you. Stones are hitting your body. You feel pain, only pain ...",
    "none",
    [
	(store_random_in_range, ":pain", 0, 100),
	(try_begin),
		(lt, ":pain", 20),
		(troop_raise_attribute, "trp_player", ca_strength, -1),
    (display_message, "@Your arms have been injured.", color_bad_news),
	(else_try),
		(lt, ":pain", 40),
		(troop_raise_attribute, "trp_player", ca_agility, -1),
    (display_message, "@Your legs have been injured.", color_bad_news),
	(try_end),

      ],
    [
      ("answere_1",[],
	  "... and all becomes black ...",
	  [
	  (rest_for_hours_interactive, 6, 5, 0),
	  (change_screen_map),
      ]),
	],
),

("library_alexandria",0,
  "The knowledge of the whole world can be found here. Safely guarded by walls.^^"
  +"You may buy copies of books from the library.",
  "none",[
	  (set_background_mesh, "mesh_pic_library"),
  ],[
    ("answere_2",[],"Trade books.",[
      (try_begin),
        (this_or_next|party_slot_ge, "$current_town", slot_center_player_relation, 20),
        (eq, "$g_is_emperor",1),#is Emperor
        (try_for_range, ":books", books_begin, books_end),
          (neq, ":books", "itm_book_poop"),
          (store_item_kind_count, ":number", ":books", "trp_alexandrian_library"),
          (lt, ":number", 1),
          (troop_add_item,"trp_alexandrian_library",":books"),
        (try_end),
        (change_screen_trade, "trp_alexandrian_library"),
      (else_try),
        (display_message, "@The scholars don't trust you enough. (Improve your relation with Alexandria.)"),
      (try_end),
    ]),
    ("answere_2",[],"Walk around.",[
      #0 player
      #1-20 sitting
      #21-32 standing
      #33 head of library
      #40,41 special next to each other
      #42 special
      (modify_visitors_at_site, "scn_library"),
      (set_jump_mission, "mt_library"),
      (reset_visitors),
      (try_for_range, ":index", 1, 21),
        (set_visitor, ":index", "trp_guest_sitting"),
      (try_end),

      (try_for_range, ":index", 21, 33),
        (set_visitor, ":index", "trp_guest"),
      (try_end),
      (set_visitor, 33, "trp_alexandrian_library"),
      (try_begin),
        (quest_slot_eq, "qst_philosopher", slot_quest_current_state, 0),
        (set_visitor, 40, "trp_solus"),
      (try_end),

      (try_begin),
        (lt, "$g_is_emperor", 1),
        (set_visitor, 36, "trp_greek_philosopher"),
        (set_visitor, 37, "trp_roman_philosopher"),
      (try_end),

      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_library", 0, 0),
        (mission_tpl_entry_set_override_flags, "mt_library", 0, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 0, "trp_player"),
      (jump_to_scene, "scn_library"),
      (change_screen_mission),
    ]),
	  ("answere_1",[],"Go back",[
	    (jump_to_menu, "mnu_town"),
    ]),
]),

("temple_jerusalem_story_decide",0,
  "Do you want to collect the tribute? You need at least 50 non-wounded men in your party and you should be not wounded!",
  "none",[
    (set_background_mesh, "mesh_pic_jerusalem_tempel"),
  ],[
    ("answere_1",[
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (gt, reg0, 50), #it is very dangerous you need enough men to protect yourself from angry jews
      (neg|troop_is_wounded, "trp_player"),
    ],"Continue.",[
      (jump_to_menu, "mnu_temple_jerusalem_story"),
    ]),
    ("answere_1",[],"Go back.",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

("temple_jerusalem_story",0,
  "You enter the Court of the Gentiles together with your troops. It is the main yard of the temple and open to people of all religions. You see merchants selling all kind of goods, from food to expensive souvenirs. Then you spot the money-changer. They make a fine living by exchanging currencies of the pilgrims who flood the temple every day. Judging by the high amount of foreign languages you hear, the pilgrims seem to come from all corners of the Empire. You spot everything, from poor, raggedly dressed beggars to magnificently adorned noble ladies. Yet, what they all have in common is their fervent faith.^^Finally, you inform a priest about your audience. You tell him that you are send by Caesar Nero to discuss important matters of politics with the high priests. He bows and informs you to wait a moment, he will arrange an audience. While you wait you let your glance again wander over the crowd. The sun is burning and the air in the yard slowly turns into a stench of a variety of smells. Rotten fish mixes with spices, the stinking sweat of the poor mingles with the perfume of the noble ladies.^^The priest comes back and tells you to follow him. The high priests await the legate of the Princeps. You enter the hall together with two of your soldiers.",
  "none",[
    (set_background_mesh, "mesh_pic_jerusalem_tempel"),
  ],[
    ("answere_1",[],"Continue.",[
      (assign, "$temp2", "trp_kingdom_17_lord"),
      (assign, "$temp1", 1),
      (assign, "$talk_context", 0),
      (modify_visitors_at_site,"scn_castle_masada_in"),
      (reset_visitors),
      (set_visitor,0,"trp_player"),
      (set_visitor,6,"trp_aux_cav_decurio"),
      (set_visitor,16,"trp_kingdom_17_lord"),
      (set_visitor,17,"trp_jewish_priest"),
      (set_visitor,18,"trp_jewish_priest"),
      (set_visitor,19,"trp_jewish_priest"),
      (set_jump_mission,"mt_event2_talk"),
      (jump_to_scene, "scn_castle_masada_in"),
      (change_screen_mission),
    ]),
]),

("temple_jerusalem_story_loot_1",0,
  "Your men break up the door into the inner court. The other pilgrims start to scream and chaos breaks out. You order some of your men to guard the entrance. You and your other men storm into the inner court and imprison the priests. Then your men break up the door into the sanctum and start looting. All the treasuries are carried out of the temple. ^After half an hour one of your men reports that there is nothing left to loot. You order to leave the temple. But you are soon stopped by an angry mob, shouting insults, moving in your direction. Now you must fight!",
  "none",[
    (set_background_mesh, "mesh_pic_jerusalem_tempel"),
  ],[
  ("answere_1",[],"Continue.",[
    (modify_visitors_at_site, "scn_temple_jerusalem"),
    (reset_visitors),
    (assign, ":num_monks", 50),
    (store_character_level, ":level", "trp_player"),
    (val_div, ":level", 5),
    (val_add, ":num_monks", ":level"),
    (set_visitors, 1, "trp_mountain_bandit", ":num_monks"),
    (set_visitors, 1, "trp_judean_village_walker", ":num_monks"),
    (set_jump_mission,"mt_temple_raid"),
    (jump_to_scene, "scn_temple_jerusalem"),
    (change_screen_mission),
    (party_clear, "p_total_enemy_casualties"),
  ]),
]),

("temple_jerusalem_story_loot_2",0,
  "You defeat the mob and leave the city. You reach a mountain, not far from Hierosolyma, where you make a rest to oversee the looted treasures: A bow with arrows, as strong and mighty as a thunderstorm. You call the bow 'Thunder'. A huge golden  menorah, gold and silver ingots, jewelry, velvet cloths and nice carpeting. Additionally, you looted valuables worth 150,000 denars.^^A soldier interrupts you and informs you that a woman is waiting for you. It must be Antonia.",
  "none",[
    (set_background_mesh, "mesh_pic_jerusalem_tempel"),
    (add_xp_as_reward, 5000),
    (quest_set_slot, "qst_poking_the_lion", slot_quest_current_state, 5),
  ],[
    ("answere_1",[],"Continue.",[
      (assign, "$temp2", "trp_antonia"),
      (assign, "$temp1", 1),
      (assign, "$talk_context", 0),
      (set_jump_mission,"mt_event2_talk"),
      (modify_visitors_at_site,"scn_mount_golgotha"),
      (reset_visitors),
      (set_visitor,1,"trp_player"),
      (set_visitor,2,"trp_antonia"),
      (jump_to_scene, "scn_mount_golgotha"),
      (change_screen_mission),
    ]),
]),

("temple_jerusalem_story_loot_end",0,
    "You gather the loot and retreat twoards {s22}. A large Judean army is gathering near {s23}, you better avoid it for now.^^Now it is time to gain the trust of either Otho, Vitellius, Galba or Vespasian.",
    "none",
    [
      (str_store_party_name, s22, "p_village_109"),
      (str_store_party_name, s23, "p_town_19"),
      (party_relocate_near_party, "p_main_party", "p_village_109", 1),
      (troop_add_gold, "trp_player", 150000),
      (try_begin),
          (eq, "$templelooted", 1),
          (troop_add_gold, "trp_player", 75000),
      (try_end),
      (troop_add_item, "trp_player", "itm_thunder",imodbit_masterwork),
      (troop_add_item, "trp_player", "itm_thunder_arrows"),
      (troop_add_item, "trp_player", "itm_temple_gold"),
      (troop_add_item, "trp_player", "itm_temple_gold"),
      (troop_add_item, "trp_player", "itm_silver"),
      (troop_add_item, "trp_player", "itm_silver"),
      (troop_add_item, "trp_player", "itm_jewelry"),
      (troop_add_item, "trp_player", "itm_wool_cloth"),
      (troop_add_item, "trp_player", "itm_wool_cloth"),
      (troop_add_item, "trp_player", "itm_velvet"),
      (troop_add_item, "trp_player", "itm_velvet"),
   ],[
    ("answere_1",[],
	  "Continue.",
	  [
      (call_script, "script_succeed_quest", "qst_poking_the_lion"),
      (call_script, "script_end_quest", "qst_poking_the_lion"),

      (str_store_troop_name_link, s22, "trp_senator_1"),
      (str_store_troop_name_link, s23, "trp_legatus_11"),
      (str_store_troop_name_link, s24, "trp_statthalter_9"),
      (str_store_troop_name_link, s25, "trp_senator_2"),

      (add_quest_note_from_sreg, "qst_blank_quest_19", 6, "@You staged a revolt in Judea! Now you need to find allies among {s22}, {s23}, {s24} or {s25}.", 1),

      (str_store_string, s2, "@Antonia ordered you to gain the trust of either {s22}, {s23}, {s24} or {s25}. Antonia favors {s23}, but you can choose whomever you like.^(Hint: Improve your relation to be at least 50 and have 750 influence points, then in the influence-dialogue-menu a new dialogue option will appear.)"),
      (quest_set_slot, "qst_four_emperors", slot_quest_current_state, 1),
      (call_script, "script_start_quest", "qst_four_emperors", "trp_fortuna"),

      (call_script, "script_cf_start_jewish_revolt"),
      (call_script, "script_change_player_relation_with_center", "p_town_19", -100),
      (call_script, "script_change_player_relation_with_faction", "fac_kingdom_17", -200),
      (jump_to_menu, "mnu_loot_final2"),
      (change_screen_map),
    ]),
]),
("temple_jerusalem",0,
  "You see the Great Temple, the Jews call it Beit HaMikdash HaSheni. It is their second temple. The first was destroyed centuries ago. ^^"
  +" Walking around you see many people who seek truth and security through religion in times of need.^"
  +" But you also see traders praising their goods.^^"
  +" The forecourt is open for pilgrims and the inner court for priests. Only at Jom Kippur highpriests are allowed to enter the sanctum.",
  "none",[
	  (set_background_mesh, "mesh_pic_jerusalem_tempel"),
  ],[
    ("answere_steal",[
      (neq, "$g_campaign_type", g_campaign_story_rome),
      (neg|troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
      (eq, "$templelooted", 0),
	  ],"Loot the temple",[
      (try_begin),
          (call_script, "script_party_count_members_with_full_health", "p_main_party"),
          (gt, reg0, 50), #it is very dangerous you need enough men to protect yourself from angry jews
          (jump_to_menu, "mnu_loot_temple"),
      (else_try),
          (display_message, "@You need at least 50 men, or it is too dangerous."),
      (try_end),
    ]),
    ("answere_steal",[
      (neq, "$g_campaign_type", g_campaign_story_rome),
      (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
      (neq, "$jewish_revolt", 1),
      (neg|faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_active),
      (faction_get_slot, ":king", "$players_kingdom", slot_faction_leader),
      (neg|is_between, ":king", active_npcs_begin, active_npcs_end),
	  ],"Incite a Revolt",[
      (try_begin),
          (troop_slot_ge, "trp_player", slot_troop_renown, 200),
          (store_party_size_wo_prisoners, reg59, "p_main_party"),
          (ge, reg59, 100),
          (jump_to_menu, "mnu_revolt_start"),
      (else_try),
          (display_message, "@Improve your renown (200 is needed) and recruit more men (100 are needed)."),
      (try_end),
    ]),
    ("answere_steal",[
      (neq, "$g_campaign_type", g_campaign_story_rome),
      (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
	  ],"Fund rebels",[
		  (jump_to_menu, "mnu_found_rebells"),
    ]),
    ("answere_1",[],"Walk around",[
      (modify_visitors_at_site,"scn_temple_jerusalem"),
      (reset_visitors),
      (set_visitor,1,"trp_player"), #player
      (set_visitor,9,"trp_merchant7"),
      (set_visitor,10,"trp_jewish_priest"),
      (set_visitor,11,"trp_merchant5"),
      (set_visitor,12,"trp_merchant6"),
      (try_for_range, ":visiterator", 32, 40),
          (store_random_in_range, ":sex", 0, 100),
          (try_begin),
              (lt,":sex",50), #10% risk of tripping
              (set_visitor, ":visiterator", "trp_roman_town_walker"),
          (else_try),
              (set_visitor, ":visiterator", "trp_roman_town_walker_female"),
          (try_end),
      (try_end),
      (call_script, "script_init_town_walkers"), #chief anadido walkers a castillos
      (set_jump_mission,"mt_visit_temple_jerusalem"),
      (jump_to_scene, "scn_temple_jerusalem"),
      (change_screen_mission),
    ]),
    ("answere_2",[],"Go back",[
	    (jump_to_menu, "mnu_town"),
    ]),
]),
("loot_temple",0,
  "You and your men gather before the temple. Are you sure you want to loot the great temple, center of the jewish faith. Be aware of the consequences!",
  "none",[
	  (set_background_mesh, "mesh_pic_jerusalem_tempel"),
  ],[
    ("answere_1",[],"It is a stupid idea.",[
	    (jump_to_menu, "mnu_town"),
    ]),
    ("answere_2",[],"Yes. I will loot it! HAHAA!!",[
	    (jump_to_menu, "mnu_temple_looted"),
    ]),
]),
("temple_looted",0,
  "You bring some carts before the temple and order some men to guard them. Then you give order to the rest of your men to follow you. The plan is to go into the temple, kill all priests, bring the loot out of the temple to the carts and then leave Hierosolyma as fast as possible!",
  "none",[
	  (set_background_mesh, "mesh_pic_jerusalem_tempel"),
  ],[
    ("answere_1",[],"Proceed as planned.",[
		  (jump_to_menu, "mnu_loot_final"),
    ]),
    ("answere_1",[],"No stop it, It is too dangerous.",[
		  (jump_to_menu, "mnu_town"),
    ]),
]),
("loot_final",0,
  "Your men wear pligrim cloths over their armors to get not suspicious. Then you pass through the streams of pilgrim into the forecourt. Then you and your men break up the door into the inner court. The other pilgrims start to scream and chaos breaks out.^"
  +" You order that some of your men guard the entrance into the inner court. You and your other men storm into the inner court and kill every priests you see. Then your men break up the door into the sanctum and start looting every thing.^^"
  +" You and your men carry all the treasuries out of the temple to the carts.^^"
  +" After half an hour one of your men reports that there is nothing left to loot. You order that the men with the carts shall leave Hierosolyma dressed as pilgrims. As the carts leave the temple hill over the main entrance, you see an angry mob, shouting insults, moving in your direction.^"
  +" Now you must fight or you will die!",
  "none",[
	  (set_background_mesh, "mesh_pic_jerusalem_tempel"),
  ],[
  ("answere_1",[],"Damn it.",[
    (modify_visitors_at_site, "scn_temple_jerusalem"),
    (reset_visitors),
    (assign, ":num_monks", 50),
    (store_character_level, ":level", "trp_player"),
    (val_div, ":level", 5),
    (val_add, ":num_monks", ":level"),
    (set_visitors, 1, "trp_mountain_bandit", ":num_monks"),
    (set_visitors, 1, "trp_judean_village_walker", ":num_monks"),
    #(set_visitors, 1, "trp_abad", 1),
    (set_jump_mission,"mt_temple_raid"),
    (jump_to_scene, "scn_temple_jerusalem"),
    (change_screen_mission),
    #
    (party_clear, "p_total_enemy_casualties"),
  ]),
]),
("great_jewish_reolt_start",0,
  "After you defeated the mob you quickly leave the temple hill. You must get out of Hierosolyma, as fast as possible. {s20}",
  "none",[
    (set_background_mesh, "mesh_pic_victory"),
    (try_begin),
      (eq, "$jewish_revolt", 0),
      (str_store_string, s20, "@As your run through Hierosolyma you see no Roman troops. That is strange. You run and run. Finally you manage to get out of the city. You meet the other men with the loot. Then you look to the city, you see fire in some parts of Hierosolyma. Strange."),
    (else_try),
      (str_store_string, s20, "@You run and run. Finally you get out of the city. You meet the other men with the loot on the agreed point on a hill near Hierosolyma."),
    (try_end),
  ],[
  ("answere_1",[],"Luckily alive!",[
    (try_begin),
      (neq, "$jewish_revolt", 1),
      (display_message, "@Your dishonorable greedy act has angered the Jewish population so much, that they started to rebel against the foreign occupation!", message_negative),
      (call_script, "script_cf_start_jewish_revolt"),
      (call_script, "script_change_player_relation_with_center", "p_town_19", -100),
      (call_script, "script_change_player_honor", -20),
      (call_script, "script_change_troop_renown", "trp_player", 150),
      (call_script, "script_change_player_relation_with_faction", "fac_kingdom_17", -200),
      (jump_to_menu, "mnu_loot_final2"),
    (else_try),
      (call_script, "script_change_player_relation_with_center", "p_town_19", -100),
      (call_script, "script_change_player_honor", -20),
      (call_script, "script_change_troop_renown", "trp_player", 150),
      (jump_to_menu, "mnu_loot_final2"),
    (try_end),
  ]),
]),

("loot_final2",0,
  "Now lets see what your men have looted:^^"
  +"A bow with arrows, as strong and mighty as a thunderstorm. You call the bow 'Thunder'^^"
  +"A golden menorah^^"
  +"  Gold, gold coins^^"
  +"Jewellery^^"
  +"Velvet cloths and nice carpeting^^"
  +"Silver ingots^^"
  +"Additionally you looted expensive artifacts worth 150,000 denars.",
  "none",[
    (troop_add_gold, "trp_player", 150000),
    (troop_add_item, "trp_player", "itm_menorah"),
    (troop_add_item, "trp_player", "itm_thunder",imodbit_masterwork),
    (troop_add_item, "trp_player", "itm_thunder_arrows"),
    (troop_add_item, "trp_player", "itm_temple_gold"),
    (troop_add_item, "trp_player", "itm_temple_gold"),
    (troop_add_item, "trp_player", "itm_silver"),
    (troop_add_item, "trp_player", "itm_silver"),
    (troop_add_item, "trp_player", "itm_jewelry"),
    (troop_add_item, "trp_player", "itm_wool_cloth"),
    (troop_add_item, "trp_player", "itm_wool_cloth"),
    (troop_add_item, "trp_player", "itm_velvet"),
    (troop_add_item, "trp_player", "itm_velvet"),
    (assign, "$templelooted", 1),
    (party_set_icon, "p_town_19", "icon_town_jerusalem_without_temple"),
  ],[
  ("answere_1",[],"Well done.",[
    (try_begin),
      (party_get_slot, ":lord", "p_town_19", slot_town_lord),
      (gt, ":lord", 1),
      (call_script, "script_change_player_relation_with_troop", ":lord", -30),
      (str_store_troop_name, s21, ":lord"),
      (display_message, "@ The governer of Hierosolyma, {s21}, is not very amused about your action."),
    (try_end),
    (change_screen_map),
  ]),
]),

("death_waits",0,
  "Death waits^^You are so tired. You close your eyes and fall asleep.^^"
  +"Suddenly you hear a sweet noise. She whispers: ^^"
  +"'Wake up {playername}. I am here.'"
  +"^^You open your eyes. In front of you stands this beautiful girl. The most beautiful girl you have ever seen.^^"
  +"'What do you want?', you ask.^^"
  +"^'Your life!', she answers. 'You will come with me, {playername}'"
  +"^^She stands close to you. You can smell her breath. It is like the allure of thousand of flowers."
  +"The shape of her body reminds you on a hilly landscape. She is as white as a flowering cherry tree grove.^"
  +"Her hair is like the golden sun over the blue of her heavenly eyes. And her smile...^^"
  +"But something is wrong. She smells too good, she is too white, her hair is too golden, her eyes are too blue.^"
  +"She strokes with her hand over your face. Her hand is as soft as a cloud.^^^"
	+"'Come with me, {playername}'^^"
  +"She hands you her hand.",
    "none",
    [
      (play_track, "track_final_glory", 1),
    ],[
    ("answere_1",[
      (eq, "$temp", 1),
    ],"Go away, demon! Away with you!",[
      (display_log_message, "@You awake from a strange dream. You have high fever.", message_negative),
      (call_script, "script_change_troop_health", "trp_player", 25),
      (change_screen_map),
    ]),
    ("answere_2",[
    ],"--Take her hand.--",[
		  (jump_to_menu, "mnu_death"),
    ]),
]),

("death",0,
    "Ad mortem ..."
	  +"^^^^'Take a last look at the beauty of this world. Acta est fabula, plaudite!', she says.",
    "none",
    [
	    (set_background_mesh, "mesh_pic_landschaft"),
    ],[
    ("answere_1",[],
	    "... Finally I come back to you ...",
	  [
		  (jump_to_menu, "mnu_finall_judgment"),
    ]),
]),

  (
    "finall_judgment",0,
    "Suddenly the beautiful girl is gone. It stinks indescribably awful. Death. Pain.^^\
	Here is what you have earned!^^\
	Will you be redeemed?^^\
	You glimpsed worlds grandeur and have achieved nothing.^^\
	Out of dust you came to dust you become.",
    "none",
    [
		(set_background_mesh, "mesh_pic_underworld")
      ],
    [
      ("answere_1",[],
	  "... Will I ever see you again? ...",
	  [
		(change_screen_quit),
      ]),

	],
  ),
  (
    "extra_wage",0,
    "How much do you want to give them?",
    "none",
    [

      ],
    [

      ("answere_1",[(call_script, "script_game_get_total_wage"),
	  (store_troop_gold, ":gold", "trp_player"),
	  (ge, ":gold", reg0),
	  ],
	  "I will give them {reg0}",
	  [
	  (call_script, "script_game_get_total_wage"),
	  (troop_remove_gold, "trp_player", reg0),
	  (call_script, "script_change_player_party_morale", 30),
	  (display_message, "@Your men are happy about your generosity!", message_positive),
	  (jump_to_menu, "mnu_camp"),
      ]),
      ("answere_2",[(call_script, "script_game_get_total_wage"),
	  (store_troop_gold, ":gold", "trp_player"),
	  (val_mul, reg0, 2),
	  (ge, ":gold", reg0),
	  ],
	  "I will give them {reg0}",
	  [
	  (call_script, "script_game_get_total_wage"),
	  (val_mul, reg0, 2),
	  (troop_remove_gold, "trp_player", reg0),
	  (call_script, "script_change_player_party_morale", 60),
	  (display_message, "@Your men are happy about your generosity!", message_positive),
	  (jump_to_menu, "mnu_camp"),
      ]),
      ("answere_0",[
	  ],
	  "Go back.",
	  [
	  (jump_to_menu, "mnu_camp"),
      ]),
	],
  ),

# ("test_holyside",0,
#     "You see stones in the distance.",
#     "none",
#     [(set_background_mesh, "mesh_pic_deserters"),

#       ],
#     [
#       ("answere_1",[
# 	  ],
# 	  "Visit this place.",
# 	  [
#       (party_get_slot, ":scene", "$g_encountered_party", slot_castle_exterior),
#       (jump_to_scene, ":scene"),
#       (change_screen_mission),
#       ]),
#       ("answere_2",[
# 	  ],
# 	  "Leave",
# 	  [
# 		(change_screen_map),
#       ]),
# ]),

  (
    "forest",0,
    "A dark, dark forest.",
    "none",
    [(set_background_mesh, "mesh_pic_deserters"),

      ],
    [
      ("answere_1",[(party_is_active, "p_forest"),
	  ],
	  "Visit this place.",
	  [
	  (modify_visitors_at_site, "scn_forest"),
	  (reset_visitors),
	  (set_visitor, 1, "trp_gwenhwyfar"),
	  (set_jump_entry, 0),
	  (set_jump_mission, "mt_visit_forest"),
	  (jump_to_scene, "scn_forest"),
	  (change_screen_mission),
      ]),
      ("answere_2",[
	  ],
	  "Leave",
	  [
		(change_screen_map),
      ]),
	],
  ),
  # (
    # "slavic_holy_side",0,
    # "You see a mountain in the distance. This place seems to be sacred for the local population.",
    # "none",
    # [(set_background_mesh, "mesh_pic_deserters"),

      # ],
    # [
      # ("answere_1",[
	  # ],
	  # "Visit this place.",
	  # [
	  # (modify_visitors_at_site, "scn_slavic_holy_side"),
	  # (reset_visitors),
	  # (set_jump_entry, 0),
	  # (set_jump_mission, "mt_visit_forest"),
	  # (jump_to_scene, "scn_slavic_holy_side"),
	  # (change_screen_mission),
      # ]),
      # ("answere_2",[
	  # ],
	  # "Leave",
	  # [
		# (change_screen_map),
      # ]),
	# ],
  # ),

  (
    "pyramids",0,
    "It's hot, too hot. You see huge stone buildings in the distance.",
    "none",
    [(set_background_mesh, "mesh_pic_pyramid"),

      ],
    [
      ("answere_1",[
	  ],
	  "Visit this place.",
	  [
	  #special persons
	  #entry: 1, 2
	  #persons sitting: entry 3,4,5
	  #slaves working: 6,7,8,9,10
	  #guards: 11, 12, 13, 14, 15, 16
	  (modify_visitors_at_site, "scn_pyramid"),
	  (reset_visitors),
	  (set_visitor, 1, "trp_kasius"),
	  (set_visitor, 2, "trp_orchon"),
	  (set_visitor, 3, "trp_refugee"),
	  (set_visitor, 4, "trp_refugee"),
	  (set_visitor, 5, "trp_refugee"),
	  (set_visitors, 6, "trp_slave",3),
	  (set_visitors, 7, "trp_slave",2),
	  (set_visitors, 8, "trp_slave",2),
	  (set_visitor, 9, "trp_slave"),
	  (set_visitor, 10, "trp_slave"),
	  (set_visitor, 11, "trp_mercenary_swordsman"),
	  (set_visitor, 12, "trp_mercenary_crossbowman"),
	  (set_visitor, 13, "trp_mercenary_swordsman"),
	  (set_visitor, 14, "trp_mercenary_crossbowman"),
	  (set_visitor, 15, "trp_mercenary_horseman"),
	  (set_visitor, 16, "trp_mercenary_horseman"),
	  (set_visitor, 21, "trp_slave_mine"),
	  (set_visitor, 22, "trp_slave_mine"),
	  (set_visitor, 23, "trp_slave_mine"),
	  (set_visitor, 24, "trp_slave_mine"),
	  (set_visitor, 25, "trp_slave_mine"),
	  (set_visitor, 26, "trp_slave_mine"),
	  (set_jump_entry, 0),
	  (set_jump_mission, "mt_visit_pyramid"),
	  (jump_to_scene, "scn_pyramid"),
	  (change_screen_mission),
      ]),
      ("answere_2",[
	  ],
	  "Leave",
	  [
		(change_screen_map),
      ]),
	],
  ),
  (
    "vally_of_kings",0,
    "The valley stands on the west bank of the Nile, opposite Thebes. Many pharaohs have been buried in the valley. \
 Rumors say the tombs are full of treasures. Thus, many grave robbers tried their luck to search for them. \
 But legends say everybody, who disturbs the mummy of a pharaoh is cased by a curse! Beware, as anybody who has entered a tomb never left it alive...",
    "none",
    [

      ],
    [
      ("answere_1",[
	  ],
	  "Explore.",
	  [
	  (modify_visitors_at_site, "scn_vally_of_kings"),
	  (reset_visitors),
	  (set_jump_entry, 0),
    (set_visitors,1,"trp_hired_blade", 3),
    (set_visitors,2,"trp_hired_blade", 2),
    (set_visitors,3,"trp_hired_blade", 2),

	  (set_jump_mission, "mt_visit_vally_of_kings"),
	  (jump_to_scene, "scn_vally_of_kings"),
	  (change_screen_mission),
      ]),
      ("answere_2",[
	  ],
	  "Leave.",
	  [
		(change_screen_map),
      ]),
	],
  ),

("sartemis",0,
  "Behind the ruins of the old city of Babylon you spot a large palace, overgrown with all kinds of plants. This must be the legendary hanging gardens of Semiramis.",
  "none",[
    (set_background_mesh, "mesh_pic_hanging_gardens"),
  ],[
  ("answere_1",[
  ],"Explore.",[
    #(party_get_slot, ":scene_to_use", "$g_encountered_party", slot_castle_exterior),
    (modify_visitors_at_site, "scn_sartemis"),
    (reset_visitors),
    (set_jump_mission, "mt_visit_sartemis"),
    (try_begin),
      (quest_slot_eq, "qst_gardens_of_pleasure", slot_quest_current_state, 0),
      (neg|is_currently_night),
      (set_visitor, 2, "trp_persian_village_walker"),
    (else_try),
      (is_currently_night),
      (this_or_next|quest_slot_eq, "qst_gardens_of_pleasure", slot_quest_current_state, 3),
      (quest_slot_eq, "qst_gardens_of_pleasure", slot_quest_current_state, 4),
      (set_visitor, 12, "trp_fortuna"),
    (else_try),
      (quest_slot_ge, "qst_gardens_of_pleasure", slot_quest_current_state, 7),
      ##13-26 sitting
      #27-32 kissing
      #33 - 40 dancers
      (set_visitor, 12, "trp_fortuna"),

      (set_visitor,13,"trp_orgie_male1"),
      (set_visitor,14,"trp_orgie_male1"),
      (set_visitor,15,"trp_orgie_male1"),
      (set_visitor,16,"trp_orgie_fem3"),
      (set_visitor,17,"trp_orgie_male1"),
      (set_visitor,18,"trp_orgie_fem2"),
      (set_visitor,19,"trp_orgie_fem2"),
      (set_visitor,20,"trp_orgie_male1"),
      (set_visitor,21,"trp_orgie_fem3"),
      (set_visitor,22,"trp_orgie_fem3"),
      (set_visitor,23,"trp_orgie_male1"),
      (set_visitor,24,"trp_orgie_fem2"),
      (set_visitor,25,"trp_orgie_fem3"),
      (set_visitor,26,"trp_orgie_male1"),
      #some music guys
      (store_random_in_range, ":music_guy", tavern_minstrels_begin, tavern_minstrels_end),
      (set_visitor,42,":music_guy"),
      (store_random_in_range, ":music_guy2", tavern_minstrels_begin, tavern_minstrels_end),
      (set_visitor,43,":music_guy2"),
    (else_try),
      (neg|is_currently_night),
      (quest_slot_ge, "qst_gardens_of_pleasure", slot_quest_current_state, 5),
      (set_visitor, 12, "trp_fortuna"),
    (try_end),

    (try_begin),
      (quest_slot_ge, "qst_gardens_of_pleasure", slot_quest_current_state, 7),
      (try_begin),
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_visit_sartemis", 7, 0),
        (mission_tpl_entry_set_override_flags, "mt_visit_sartemis", 7, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 7, "trp_player"),
    (else_try),
      (set_visitor, 0, "trp_player"),
    (try_end),
    (jump_to_scene, "scn_sartemis"),
    (change_screen_mission),
  ]),
  ("answere_2",[
	],"Leave.",[
		(change_screen_map),
  ]),
]),

("census",0,
  "Census!^^You receive a message. It contains the census:^^"
  +" In total, there live {reg23} families in the Imperium Romanum.^"
  +" The total town population is {reg22} families. You have a total of {reg42} towns.^"
  +" The total village population is {reg20} families. You have a total of {reg40} villages.^"
  +" The total fort population is {reg21} families. You have a total of {reg41} fortresses.^"
  +" The biggest town is Rome, with around {reg45} families living there.^^"
  +" The data will help your tax collectors to increase the tax efficients. Soon you will see the benefits.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, ":pop_urban", 0),
    (assign, ":pop_rural", 0),
    (assign, ":pop_castle", 0),
    (assign, ":pop_total", 0),
    (assign, ":town_count", 0),
    (assign, ":village_count", 0),
    (assign, ":castle_count", 0),
    (try_for_range, ":center", centers_begin, centers_end),
      (store_faction_of_party, ":f", ":center"),
      (eq, ":f", "$players_kingdom"),
      (try_begin),
        (party_slot_eq, ":center", slot_party_type, spt_village),
        (party_get_slot, ":wealth", ":center", slot_town_prosperity),
        (val_add, ":wealth", 20),
        (store_random_in_range, ":max_pop", 7000, 7500),#families
        (val_mul, ":max_pop", ":wealth"),
        (val_div, ":max_pop", 120),
        (val_add, ":pop_rural", ":max_pop"),
        (val_add, ":village_count", 1),
      (else_try),
        (party_slot_eq, ":center", slot_party_type, spt_castle),
        (party_get_slot, ":wealth", ":center", slot_town_prosperity),
        (val_add, ":wealth", 30), ###bei castellen ist es stark vom wohlstand abhangig, wurde ich sagen
        (store_random_in_range, ":max_pop", 1800, 2000),#families ###manche waren recht gross, andere ziemliche nester
        (val_mul, ":max_pop", ":wealth"),
        (val_div, ":max_pop", 120),
        (val_add, ":pop_castle", ":max_pop"),
        (val_add, ":castle_count", 1),
      (else_try),
        (party_slot_eq, ":center", slot_party_type, spt_town),
        (party_get_slot, ":wealth", ":center", slot_town_prosperity),
        (val_add, ":wealth", 20),
        (store_random_in_range, ":max_pop", 18000, 20000),#families
        (val_mul, ":max_pop", ":wealth"),
        (val_div, ":max_pop", 120),
        (val_add, ":pop_urban", ":max_pop"),
        (val_add, ":town_count", 1),
      (try_end),
    (try_end),
    (val_add, ":pop_total", ":pop_rural"),
    (val_add, ":pop_total", ":pop_urban"),
    (val_add, ":pop_total", ":pop_castle"),
    (assign, reg20, 0),
    (assign, reg21, 0),
    (assign, reg22, 0),
    (assign, reg23, 0),
    (assign, reg20, ":pop_rural"),
    (assign, reg21, ":pop_castle"),
    (assign, reg22, ":pop_urban"),
    (assign, reg23, ":pop_total"),
    (assign, reg40, 0),
    (assign, reg41, 0),
    (assign, reg42, 0),
    (assign, reg40, ":village_count"),
    (assign, reg41, ":castle_count"),
    (assign, reg42, ":town_count"),
    (store_random_in_range, ":rand", 35000, 48000),
    (assign, reg45, ":rand"),
	],[
    ("answere_1",[],"Interessting.",[
      (assign, "$conducted_census", 1),
      (change_screen_map),
    ]),
]),

  ("berserker_recruit_2troop",0,
    "There are two berserker who could join to you.",
    "none", [ (set_background_mesh, "mesh_pic_mb_warrior_1"),
    ],
    [("acept_thempa",[], "They are welcome!",
        [
          (party_add_members,"p_main_party","trp_germanic_berserker",2),
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
          (jump_to_menu,"mnu_paganholysites_visit"),
      ]),
      ("back_to_town_menupa",[],"Head back.",
        [
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
          (jump_to_menu,"mnu_paganholysites_visit"),
      ]),
    ]
  ),
  ("berserker_recruit_troop",0,
    "There is a berserker who could join to you.",
    "none", [ (set_background_mesh, "mesh_pic_mb_warrior_1"),
    ],
    [("acept_thempa2",[], "He is welcome!",
        [
          (party_add_members,"p_main_party","trp_germanic_berserker",1),
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
          (jump_to_menu,"mnu_paganholysites_visit"),
      ]),
      ("back_to_town_menupa2",[],"Head back.",
        [
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
          (jump_to_menu,"mnu_paganholysites_visit"),
      ]),
    ]
  ),
  ("nonberserker_avaiable_troop",0,
    "The berserkers don't want to join you.",
    "none", [ (set_background_mesh, "mesh_pic_mb_warrior_1"),
    ],
    [("back_to_town_menupa2",[],"Head back.",
        [
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
          (jump_to_menu,"mnu_paganholysites_visit"),
      ]),
    ]
  ),
  ("nonberserker_renown_low",0,
    "You look like a beggar, hardly a leader worth following. You need more renown (>150) for berserkers to join your party.",
    "none", [ (set_background_mesh, "mesh_pic_mb_warrior_1"),
    ],
    [("back_to_town_menupa2",[],"Head back.",
        [
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
          (jump_to_menu,"mnu_paganholysites_visit"),
      ]),
    ]
  ),

("saquear_paganholysite_lost",mnf_disable_all_keys,
  "You have lost the battle and your men retreat. Your gods doesn't favor you!",
  "none",[
    (set_background_mesh, "mesh_pic_defeat"),
    (try_begin),
      (check_quest_active, "qst_raid_german_temple"),
      (neg|check_quest_succeeded,"qst_raid_german_temple"),
      (neg|check_quest_failed,"qst_raid_german_temple"),
      (quest_slot_eq, "qst_raid_german_temple", slot_quest_target_center, "$g_encountered_party"),
      (call_script, "script_fail_quest", "qst_raid_german_temple"),
    (try_end),
  ],[
    ("backpa",[],"Continue.",[
      (change_screen_map),
    ]),
]),

("saquear_paganholysite",mnf_disable_all_keys,
  "Blood and treasure. Those of your men with fewer scruples proceed towards {s3}, killing anyone in their path and plundering its riches. The fire and death sweeping the place are rampant. You plunder spoils of war are worth {reg3} denars.",
  "none",[
    (try_begin),
        (eq, "$capture_screen_shown", 0),
        (assign, "$capture_screen_shown", 1),
        (party_clear, "p_temp_party"),
        (assign, "$g_move_heroes", 0),
        (call_script, "script_party_add_wounded_members_as_prisoners", "p_temp_party", "p_total_enemy_casualties"),
        (party_get_num_prisoners,  ":num_captured_enemies", "p_temp_party"),
        (gt, ":num_captured_enemies", 0),
        (change_screen_exchange_with_party, "p_temp_party"),
    (else_try),
        (eq, "$loot_screen_shown", 0),
        (assign, "$loot_screen_shown", 1),
        (troop_clear_inventory, "trp_temp_troop"),
        #creating loot
        (try_for_range, ":curr_item" , "itm_spice", "itm_siege_supply"),
            (set_item_probability_in_merchandise, ":curr_item", 0),
        (try_end),
        (try_begin),
            (eq, "$g_encountered_party", "p_arabian_holy_side_1"),
            (party_slot_eq, "$g_encountered_party", slot_holy_side_event, 0),
            (troop_add_item, "trp_temp_troop", "itm_allat"),
            (party_set_slot, "$g_encountered_party", slot_holy_side_event, 1),
        (try_end),
        (store_random_in_range, ":loot_amount", 5, 10),
        (party_get_skill_level, ":player_party_looting", "p_main_party", "skl_looting"),
        (val_add, ":loot_amount", ":player_party_looting"),
        (val_max, ":loot_amount", 2),
        (try_begin),
            (eq, "$g_encountered_party", "p_delphi"),
            (set_item_probability_in_merchandise, "itm_temple_gold", 30), #was 40 #/4,5
            (set_item_probability_in_merchandise, "itm_silver", 30),	#was 15 #/3
            (set_item_probability_in_merchandise, "itm_jewelry", 40),
            (set_item_probability_in_merchandise, "itm_ivory", 15),
            (set_item_probability_in_merchandise, "itm_wine", 50),
            (val_add, ":loot_amount", 2),
        (else_try),
            (set_item_probability_in_merchandise, "itm_amber", 30), #was 40 #/4,5
            (set_item_probability_in_merchandise, "itm_silver", 30),	#was 15 #/3
            (set_item_probability_in_merchandise, "itm_furs", 40),
            (set_item_probability_in_merchandise, "itm_ale", 50),
            (try_for_range, ":curr_item", "itm_smoked_fish", "itm_raw_olives"),
                (store_random_in_range, ":rand", 0, 4),
                (val_mul, ":rand", 13),
                (set_item_probability_in_merchandise, ":curr_item", ":rand"),
            (try_end),
        (try_end),
        (troop_add_merchandise,"trp_temp_troop", itp_type_goods, ":loot_amount"),
        (troop_sort_inventory, "trp_temp_troop"),
        (change_screen_loot, "trp_temp_troop"),
    (else_try),
        # All shown

        # 1.PLUNDER MONEY
        (party_get_skill_level, ":max_loot", "p_main_party", "skl_looting"),
        (val_mul, ":max_loot", 200),	# 0 -1000
        (val_add, ":max_loot", 500),	# 100 - 1500

        (try_begin),#being dishonorable gives a bonues
            (lt, "$player_honor", -90),
            (val_mul, ":max_loot", 21),
            (val_div, ":max_loot", 10),
        (else_try),
            (lt, "$player_honor", -70),
            (val_mul, ":max_loot", 19),
            (val_div, ":max_loot", 10),
        (else_try),
            (lt, "$player_honor", -40),
            (val_mul, ":max_loot", 17),
            (val_div, ":max_loot", 10),
        (else_try),
            (lt, "$player_honor", -20),
            (val_mul, ":max_loot", 15),
            (val_div, ":max_loot", 10),
        (try_end),

        (store_random_in_range, ":random", 500, ":max_loot"),

        (try_begin),
            (eq, "$g_encountered_party", "p_delphi"),
            (val_mul, ":random", 5),
        (else_try),
            (val_div, ":random", 10),
            (val_mul, ":random", 30),
        (try_end),

        (try_begin),
            (check_quest_active, "qst_raid_german_temple"),
            (neg|check_quest_succeeded,"qst_raid_german_temple"),
            (neg|check_quest_failed,"qst_raid_german_temple"),
            (quest_slot_eq, "qst_raid_german_temple", slot_quest_target_center, "$g_encountered_party"),
            (quest_get_slot, ":quest_target_amount", "qst_raid_german_temple",slot_quest_target_amount),
            (val_mul, ":quest_target_amount", 3),
            (val_div, ":quest_target_amount", 2),
            (val_add, ":random", ":quest_target_amount"),
            (call_script, "script_succeed_quest", "qst_raid_german_temple"),
        (try_end),
        (call_script, "script_troop_add_gold", "trp_player", ":random"),
        (assign, reg3, ":random"),
        # 2.ICON
        #(call_script, "script_change_party_icon_loot_state", "$g_encountered_party", 1),
        (try_begin),
            (neq, "$g_encountered_party", "p_delphi"),
            (party_add_particle_system, "$g_encountered_party", "psys_map_village_fire"),
            (party_add_particle_system, "$g_encountered_party", "psys_map_village_fire_smoke"),
            (party_set_slot, "$g_encountered_party", slot_village_smoke_added, 1),
        (try_end),
        # 3.DEVASTATED TIME
        (party_set_slot,"$g_encountered_party", slot_party_looted_left_days, 14), #two weeks
        # 6. Reduce relations with nearby faction

        (try_begin),
            (eq, "$g_encountered_party", "p_delphi"),
            (call_script, "script_add_log_entry", logent_raided_delphi, "trp_player", -1, -1, -1),

            (try_for_range, ":cur_center", centers_begin, centers_end),
                (this_or_next|party_slot_eq, ":cur_center", slot_center_province, p_balk_acha),
                (this_or_next|party_slot_eq, ":cur_center", slot_center_province, p_balk_epir),
                (this_or_next|party_slot_eq, ":cur_center", slot_center_province, p_balk_mac),
                (this_or_next|party_slot_eq, ":cur_center", slot_center_province, p_balk_dalm),
                (this_or_next|party_slot_eq, ":cur_center", slot_center_province, p_balk_thrac),
                (this_or_next|party_slot_eq, ":cur_center", slot_center_province, p_ita_magna),
                (party_slot_eq, ":cur_center", slot_center_province, p_ita_sici),
                (call_script, "script_change_player_relation_with_center", ":cur_center", -50),
            (try_end),
        (else_try),
            (party_get_slot, ":culture_side", "$g_encountered_party", slot_center_culture),
            (set_fixed_point_multiplier, 100),
            (try_for_range, ":cur_village", villages_begin, villages_end),
                (store_distance_to_party_from_party, ":cur_dist", ":cur_village", "$g_encountered_party"),
                (lt, ":cur_dist", 25),
                (store_faction_of_party, ":village_faction", ":cur_village"),
                (is_between, ":village_faction", npc_kingdoms_begin, npc_kingdoms_end),
                (faction_get_slot, ":village_culture", ":village_faction", slot_faction_culture),
                (eq, ":village_culture", ":culture_side"),
                (call_script, "script_change_player_relation_with_faction", ":village_faction", -5),
            (try_end),
            (try_for_range, ":center", centers_begin, centers_end),
                (party_slot_eq, ":center", slot_center_culture, ":culture_side"),
                (store_distance_to_party_from_party, ":cur_distance", "p_main_party", ":center"),
                (lt,":cur_distance", 25),
                (call_script, "script_change_player_relation_with_center", ":center", -25),
            (try_end),
        (try_end),
        # 7. PENALTYS (moved from the mno)
        (call_script, "script_change_player_honor", -5),
        (call_script, "script_change_troop_renown", "trp_player", 5),

        # 8. REST
        (set_background_mesh, "mesh_pic_looted_village"),
        (play_sound, "snd_cow_moo"),
        (party_clear, "$g_encountered_party"),
        (str_store_party_name, s3, "$g_encountered_party"),
    (try_end),
  ],[
    ("backpa",[],"Leave the place.",[
      (rest_for_hours_interactive, 3, 5, 1), #rest while attackable
      (change_screen_return),
    ]),
]),

("gwenny_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Scared ravens!^^Your men take a small break to eat and refresh, while you take a walk. After some time of enjoying the beauty of nature you come to a grove."
  +" Suddenly, you hear a noise. You look around and see ravens flying on the sky. You try to count them, but they are so many! It must be hundreds or even more!"
  +" They fly, so fast! As if they want to flee from something."
  +" ^You turn around and see Gwenhwyfar standing next to you watching you closely. You see that she smiles.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("answere_1",[],"She is really beautiful when she smiles!",[
      (add_xp_as_reward, 250),
	    (change_screen_map),
    ]),
    ("answere_2",[],"Something is strange with her.",[
      (add_xp_as_reward, 150),
	    (change_screen_map),
    ]),
]),

("gwenny_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Dead fish!^^Tired from travelling, you and your men found a river for a break. As you walk towards the water to drink, you see that the river is full of dead fish. You order that nobody will drink from the water!"
  +" ^^While your men are looking for another well, you still stand here and look at the dead fish. What has killed it?^^"
  +" As you turn around to walk back Gwenhwyfar stands behind you, smiling at you. 'Why are you always looking at me?', you ask her. 'Sorry, I was thinking about something. I won't stare at you again. I swear!', she says.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("answere_1",[],"Hm, what is she thinking?",[
      (add_xp_as_reward, 250),
	    (change_screen_map),
    ]),
    ("answere_2",[],"A strange girl she is...",[
      (add_xp_as_reward, 150),
	    (change_screen_map),
    ]),
]),

("gwenny_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Dead men!^^While your men take a short rest from the exhausting march, you think that it would be a good idea to discover the surrounding area.^^"
  +" You walk around and come across a forest. You fight through the bushes and discover several corpses hanging on a tree. You come closer. After you viewed the corpses closely, you believe that they have died some hours ago."
  +" You start thinking who could have killed them. After some minutes you turn around to go back to your men. But you see Gwenhwyfar standing on a hill not far from you ... Is she watching you?",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("answere_1",[],"Maybe she is a demon or something like that?",[
      (add_xp_as_reward, 250),
	    (change_screen_map),
    ]),
]),

("gwenny_4",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The lake!^^While travelling you come across a small lake. Peaceful it lies under the golden sun, surrounded by hills, woods and tones of flowers. You order to take a short break. Then you order Gwenhwyfar several things, like sewing a new tunic.^^"
  +" You start walking to the lake. It's so beautiful. The water is clear and the sun touches your face softly.^"
  +" After a while you see a fish moving around in a small puddle. How did the fish get into the puddle? The puddle is several feet away from the lake. You stand before the puddle and start thinking. Then you feel watched."
  +" Gwenhwyfar is behind me, I am sure! You turne around and nobody is behind you. You look around, but nobody is there!^^"
  +" You walk back to your troops and find that Gwenhwyfar is sitting next to one of your officers having a nice chat with him while working on the tunic.",
  "none",[
    (set_background_mesh, "mesh_pic_landschaft"),
  ],[
    ("answere_1",[],"Am I crazy?",[
      (add_xp_as_reward, 250),
	    (change_screen_map),
    ]),
]),

("gwenny_5",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Nightmares!^^Since the last strange event with Gwenhwyfar you have a restless sleep. You are tortured by nightmares. Whenever you wake up you are bathed in sweat."
  +" But you can't remember your dreams, making it impossible for you to find the cause of your nightmares."
  +" The only logical cause would be Gwenhwyfar. But there are no ghosts, no demons, no monsters ...",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("answere_1",[],"There are NO MAGICAL CREATURES!",[
      (add_xp_as_reward, 250),
      (change_screen_map),
    ]),
]),

("gwenny_6",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Sleepless nights^^Your nightmares got worse and worse. It is a pain! You can't sleep anymore. But not only to sleep, but also to eat is a challenge. You always feel that Gwenhwyfar is watching you with her eyes.^^"
  +" But she is always smiling, she is always funny. All of your companions and men like her. She is always picking berries, she cooks and she cleans and she sews the cloths of yourself and your troops. She is so useful. You can't remember how it was before she joined.^^"
  +" But she is watching you! For sure she is watching you. And what if there ... are demons and ghosts? She is watching you.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("answere_1",[],"AHAHA I must talk with her!!!",[
      (add_xp_as_reward, 250),
	    (display_message, "@Talk with Gwenhwyfar to find out 'what' she really is."),
	    (change_screen_map),
    ]),
]),

("mine",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s28}^^{s29}^{s30}",
  "none",[
    (str_clear, s31),
    (str_clear, s30),
    (str_clear, s29),
    (str_clear, s28),
    (str_store_party_name, s31, "$current_town"),
    (try_begin),
        (str_store_string, s28, "@The sound of carts and shovels fills the air as several slaves and freemen work. The mines are part of {s31}."),
        (set_background_mesh, "mesh_pic_mine"),
        (try_begin),
            (party_slot_ge, "$current_town", slot_center_iron_deposits, 1),
            (str_store_string, s29, "@It is an iron mine."),
        (else_try),
            (party_slot_ge, "$current_town", slot_center_silver_deposits, 1),
            (str_store_string, s30, "@It is a silver and gold mine."),
        (try_end),
    (try_end),
	],[
    ("answere_2",[
	  ],"Visit the mine.",[
      (try_begin),
          (neg|is_currently_night),
          (party_get_current_terrain, ":terrain", "$current_town"),
          (party_get_slot, ":town_center", "$current_town", slot_village_market_town),
          (try_begin),
              (this_or_next|eq, ":town_center", "p_town_40"),
              (this_or_next|eq, ":town_center", "p_town_28"),
              (this_or_next|eq, ":town_center", "p_town_29"),
              (this_or_next|eq, ":town_center", "p_town_39"),
              (this_or_next|eq, ":town_center", "p_town_48"),
              (this_or_next|eq, ":town_center", "p_town_21"),
              (this_or_next|eq, ":town_center", "p_town_20"),
              (this_or_next|eq, ":town_center", "p_town_19"),
              (this_or_next|eq, ":terrain", rt_desert),
              (this_or_next|eq, ":terrain", rt_desert_forest),
              (eq, ":town_center", "p_town_47"),
              (assign, ":scene_to_use", "scn_mine_desert"),
          (else_try),
              (assign, ":scene_to_use", "scn_mine_plain"),
          (try_end),

          #(party_get_slot, ":scene_to_use", "$g_encountered_party", slot_castle_exterior),
          (modify_visitors_at_site, ":scene_to_use"),
          (reset_visitors),
          (set_visitor, 3, "trp_mine_boss"),
          (set_visitor, 4, "trp_slave"),
          (set_visitor, 5, "trp_slave"),
          (set_visitors, 6, "trp_slave",3),
          (set_visitors, 7, "trp_slave",2),
          (set_visitors, 8, "trp_slave",2),
          (set_visitor, 9, "trp_slave"),
          (set_visitor, 10, "trp_slave"),
          (set_visitor, 11, "trp_slave"),
          (set_visitor, 12, "trp_slave"),
          (set_visitor, 13, "trp_slave"),
          (set_visitor, 14, "trp_slave"),
          (set_visitors, 15, "trp_slave",3),
          (set_visitors, 16, "trp_slave",3),
          (set_visitor, 17, "trp_slave"),
          (set_visitor, 18, "trp_slave"),
          (set_visitor, 19, "trp_slave"),
          (set_visitor, 23, "trp_slave_mine"),
          (set_visitor, 24, "trp_slave_mine"),
          (set_visitor, 25, "trp_slave_mine"),
          (set_visitor, 26, "trp_slave_mine"),
          (set_visitor, 27, "trp_slave_mine"),
          (set_visitor, 28, "trp_slave_mine"),
          (set_visitor, 29, "trp_slave_mine"),

          (set_jump_entry, 0),

          (set_jump_mission, "mt_visit_mine"),
          (jump_to_scene, ":scene_to_use"),
          (change_screen_mission),
      (else_try),
          (display_message, "@It is night and the mine is closed.", message_alert),
      (try_end),
    ]),
    ("answere_1",[],"Leave.",[
	    (jump_to_menu, "mnu_village"),
    ]),
]),

#############################################
########OLYMPIC GAMES########################
#############################################
  (
    "running_race_one",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
    "You won the race! A wreath of laurel is placed on your head.",
    "none",
    [(set_background_mesh, "mesh_pic_orgie"),
    ],[

      ("leave",[],"Continue.",[
    (jump_to_menu, "$g_next_menu"),
    (val_add, "$g_tournament_num_participants_for_fight", 1),#count player victories
    (assign, "$g_tournament_bet_win_amount", 1),#remove other opponents
    (assign, "$g_tournament_bet_placed", 1),#has player won?

    (call_script, "script_change_troop_renown", "trp_player", 2),
    (add_xp_as_reward, 100),
      ]),

    ]
  ),
  (
    "running_race_one_by_another",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
    "The race was one by {s1}! A wreath of laurel is placed on his head.",
    "none",
    [
    (set_background_mesh, "mesh_pic_orgie"),
    (str_store_troop_name, s1, "$g_tournament_player_team_won"),
    ],[

      ("leave",[],"Continue.",[
    (jump_to_menu, "$g_next_menu"),
    (assign, "$g_tournament_bet_placed", 0),#has player won?
      ]),

    ]
  ),
  (
    "throwing_one",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
    "You won! A wreath of laurel is placed on your head.",
    "none",
    [
    (set_background_mesh, "mesh_pic_orgie"),
    ],[

      ("leave",[],"Continue.",[
    (call_script, "script_change_troop_renown", "trp_player", 2),
    (add_xp_as_reward, 100),
    (jump_to_menu, "$g_next_menu"),
    (val_add, "$g_tournament_num_participants_for_fight", 1),#count player victories
    (assign, "$g_tournament_bet_placed", 1),#has player won?
    (assign, "$g_tournament_bet_win_amount", 1),#for remove of opponents
      ]),

    ]
  ),
  (
    "throwing_one_by_another",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
    "You lost. {s1} has won! A wreath of laurel is placed on his head.",
    "none",
    [
    (set_background_mesh, "mesh_pic_orgie"),
    (str_store_troop_name, s1, "$g_tournament_player_team_won"),
    ],[

      ("leave",[],"Continue.",[
    (jump_to_menu, "$g_next_menu"),
    (assign, "$g_tournament_bet_placed", 0),#has player won?
    (assign, "$g_tournament_bet_win_amount", 1),#for remove of opponents
      ]),

    ]
  ),

("pygmachia_won",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "You defeated {s1}!  The crowd celebrates your victory.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
    (str_store_troop_name, s1, "$g_tournament_player_team_won"),
  ],[
  ("leave",[],"Continue.",[
    (call_script, "script_change_troop_renown", "trp_player", 2),
    (add_xp_as_reward, 100),
    (jump_to_menu, "$g_next_menu"),
    (val_add, "$g_tournament_num_participants_for_fight", 1),#count player victories
    (assign, "$g_tournament_bet_placed", 1),#has player won?
    (assign, "$g_tournament_bet_win_amount", 1),#for remove of opponents
  ]),
]),
("pygmachia_defeat",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "You lost the fight. {s1} won. The crowd is celebrating with your opponent while your wounds are treated by a physician.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
    (str_store_troop_name, s1, "$g_tournament_player_team_won"),
  ],[
  ("leave",[],"Continue.",[
    (jump_to_menu, "$g_next_menu"),
    (assign, "$g_tournament_bet_placed", 0),#has player won?
    (assign, "$g_tournament_bet_win_amount", 1),#for remove of opponents
  ]),
]),

("olympia_give_up",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "Are you sure you want to give up? You would lose the Olympic games.",
  "none",[
    (str_store_troop_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
  ("leave",[],"Yes, it is pointless.",[
    (change_screen_map),
    (call_script, "script_games_over"),
  ]),
  ("leave",[],"No, I will continue fighting.",[
    (jump_to_menu, "$g_next_menu"),
  ]),
]),

("games_over",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "The Olympic games are over!^^{s11} is declared victor!",
  "none",[
    (str_store_troop_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
  ("leave",[],"Continue.",[
    (change_screen_map),
  ]),
]),

("olympic_games",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "Olympic games!^^Soon the Olympic games will take place in Olympia. Hurry up, if you want to participate!",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("leave",[],"Continue.",[
      (str_store_string, s2, "@The Olympic games will soon take place in Olympia. Hurry up if you want to participate. ^^(Hint: If the quest expires, the games are over.)"),
      (quest_set_slot, "qst_olympic_games", slot_quest_expiration_days, 75),
      (call_script, "script_start_quest", "qst_olympic_games", "trp_fortuna"),
      (change_screen_map),
    ]),
]),

("olympic_games_opening",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "Olympia is crowded by people who came from every corner of the known world to see the greatest athletes battling each other in competitions. Due to the high amount of people the administration has issued to build additional infrastructures: houses, a small aqueduct and public toilettes has been built. The walls of the houses are full of graffiti advertising goods and other things. ^^You arrived just in time for the opening ceremony. Eystachus, speaks: ^'Today, dear people! Today the day has come! In the coming days we will see the best athletes, real champions, fighting for the ultimate goal: Glory and fame!'"#
  "^^Do you wish to participate in the games? The games will take one week to finish. On each day another competition will take place. The following competitions are held: Spear throw, discus throw, horse race, mule race, running race with tunic, running race with hoplite gear."+
  " The one with most victories will be declared victor of the games!",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("leave",[],"Participate too!",[
      (store_attribute_level, ":strength","trp_player", ca_strength),
      (store_skill_level, ":athlets", skl_athletics,"trp_player"),
      (store_skill_level, ":throw", skl_power_throw,"trp_player"),
      (store_skill_level, ":riding", skl_riding,"trp_player"),

      (try_begin),
          (ge, ":strength", 12),
          (ge, ":riding", 3),
          (ge, ":throw", 3),
          (ge, ":athlets", 3),
          (jump_to_menu, "mnu_competition_fist_fighting"),

          (assign, "$g_tournament_cur_tier", 1),

          (assign, "$g_tournament_num_participants_for_fight", 0),#count player victories
          (assign, "$g_tournament_bet_placed", -1),#has player won?
          (assign, "$g_tournament_bet_win_amount", -1),#for remove of opponents

          (troop_set_slot, "trp_organiser", won_horse, -1),
          (troop_set_slot, "trp_organiser", won_mule, -1),
          (troop_set_slot, "trp_organiser", won_throwing, -1),
          (troop_set_slot, "trp_organiser", won_fighting, -1),
          (troop_set_slot, "trp_organiser", won_throwing_2, -1),
          (troop_set_slot, "trp_organiser", won_running_tunic, -1),
          (troop_set_slot, "trp_organiser", won_running_hoplit, -1),
          (troop_set_slot, "trp_organiser", current_opponent_1, -1),
          (troop_set_slot, "trp_organiser", olympia_auto_menu, 0),
          (troop_set_slot, "trp_organiser", rest_olympia, 0),
          (troop_set_slot, "trp_organiser", olympia_progress, 0),
          (troop_set_slot, "trp_organiser", olympia_easter_egg, 1),
          (quest_set_slot, "qst_olympic_games", slot_quest_dont_give_again_remaining_days, 336),
          (call_script, "script_end_quest", "qst_olympic_games"),
      (else_try),
          (display_message, "@To participate you need at least strength 12, athletic skill of 3, power throw skill of 3, riding skills of 3!", message_alert),
      (try_end),
    ]),
    ("leave",[],"View participants list.",[
      (jump_to_menu, "mnu_olympia_participants"),
    ]),
    ("leave",[],"Come back later.",[
      (change_screen_map),
    ]),
]),

("olympia_participants",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "The participants are:^{s21}",
  "none",[
    (str_clear, s21),
    (try_for_range, ":participants", 0, 49),
        (troop_get_slot, ":guy", "trp_olympia_participants", ":participants"),
        (gt, ":guy", -1),
        (str_store_troop_name, s22, ":guy"),
        (str_store_string, s21, "@{s22}^{s21}"),
    (try_end),
  ],[
    ("leave",[],"Go back.",[
      (jump_to_menu, "mnu_olympic_games_opening"),
    ]),
]),

##generic competiion won menu
("competition_won",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "{s22} The next competition will take place in one day. Meanwhile the athlets have time to rest.",
  "none",[
    (try_begin),
        (eq, "$g_tournament_bet_placed", 1),#has player won?
        (str_store_string, s22, "@You won the competition!"),
        (call_script, "script_play_victorious_sound"),
        (add_xp_as_reward, 500),
    (else_try),
        (str_store_troop_name, s23, "$g_tournament_player_team_won"),
        (str_store_string, s22, "@You were defeated. {s23} has won the competition."),
    (try_end),

    (try_begin),
        (troop_slot_ge, "trp_organiser", olympia_progress, 6),
        (jump_to_menu, "mnu_olympia_over"),
    (try_end),
  ],[
  ("leave",[],"Continue.",[
    (assign,"$auto_menu",-1),
    (assign, "$g_last_rest_center", -1),
    (assign, "$auto_enter_town", -1),

    (troop_get_slot, ":progress", "trp_organiser", olympia_progress),
    (val_add, ":progress", 1),
    (try_begin),
        (eq, ":progress", 1),
        (assign, ":next_menu", "mnu_competition_diaulos"),
    (else_try),
        (eq, ":progress", 2),
        (assign, ":next_menu", "mnu_competition_hoplite"),
    (else_try),
        (eq, ":progress", 3),
        (assign, ":next_menu", "mnu_competition_throwing"),
    (else_try),
        (eq, ":progress", 4),
        (assign, ":next_menu", "mnu_competition_throwing_2"),
    (else_try),
        (eq, ":progress", 5),
        (assign, ":next_menu", "mnu_competition_horse"),
    (else_try),
        (eq, ":progress", 6),
        (assign, ":next_menu", "mnu_competition_mule"),
    (try_end),
    (troop_set_slot, "trp_organiser", olympia_progress, ":progress"),
    (assign, "$g_tournament_cur_tier", 1),
    (assign, "$g_tournament_num_participants_for_fight", 0),#count player victories
    (assign, "$g_tournament_bet_placed", -1),#has player won?
    (assign, "$g_tournament_bet_win_amount", -1),#for remove of opponents

    (store_current_hours, ":hours"),
    (val_add, ":hours", 24),
    (troop_set_slot, "trp_organiser", rest_olympia, ":hours"),
    (troop_set_slot, "trp_organiser", olympia_auto_menu, ":next_menu"),
    (rest_for_hours,24, 12, 0),
    (change_screen_map),
  ]),
]),

###fist fighting competition
("competition_fist_fighting",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "The first competition is Pygmachia, the fist fights. You are at round {reg21} and {reg22} opponents are remaining.^^{s22}^In total you have won {reg23} fights.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
    (try_begin),
        (troop_slot_eq, "trp_organiser", won_fighting, -1),
        (try_for_range, ":participants", 0, 49),
            (troop_get_slot, ":guy", "trp_olympia_participants", ":participants"),
            (troop_set_slot, "trp_temp_array_olympia_c", ":participants", ":guy"),
        (try_end),
        (troop_set_slot, "trp_organiser", won_fighting, -2),
    (try_end),

    (try_begin),
        (eq, "$g_tournament_bet_win_amount", 1),#for remove of opponents
        (assign, ":guys_to_remove", 0),
        (try_for_range, ":participants", 0, 49),
            (neg|troop_slot_eq,"trp_temp_array_olympia_c", ":participants", -1),
            (val_add, ":guys_to_remove", 1),
        (try_end),
        (val_div, ":guys_to_remove", 2),

        (assign, "$g_tournament_bet_win_amount", -1),#for remove of opponents
    (else_try),
        (assign, ":guys_to_remove", -1),
    (try_end),
    (str_clear, s22),
    (try_begin),#remove the opponent player has defeated
        (eq, "$g_tournament_bet_placed", 1),#has player won?
        (troop_get_slot, ":opponent", "trp_organiser", current_opponent_1),
        (gt, ":opponent", -1),
        (assign, ":break", 49),
        (try_for_range, ":participants", 0, ":break"),
            (troop_slot_eq,"trp_temp_array_olympia_c", ":participants", ":opponent"),
            (troop_set_slot, "trp_temp_array_olympia_c", ":participants", -1),
            (assign, ":break", -1),
            (assign, ":opponent", -1),
        (try_end),
        (str_store_string, s22, "@You have won the last fight."),
        (val_sub, ":guys_to_remove", 1),
    (try_end),
    #remove other guys
    (assign, ":break", 49),
    (try_for_range, ":unused", 0, ":guys_to_remove"),#find other guys and remove them
        (assign, ":score", -1),
        (assign, ":remove_slot", -1),
        (try_for_range, ":participants", 0, ":break"),#find other guys and remove them
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
            (gt, ":guy", -1),
            (neg|troop_slot_eq, "trp_administrator", current_opponent_1, ":guy"),
            (store_character_level, ":level", ":guy"),
            (store_random_in_range, ":r", 0, 2),
            (val_add, ":level", ":r"),
            (gt, ":level", ":score"),
            (assign, ":score", ":level"),
            (assign, ":remove_slot", ":participants"),
        (try_end),
        (troop_set_slot,"trp_temp_array_olympia_c", ":remove_slot", -1),
    (try_end),

    (assign, reg23, "$g_tournament_num_participants_for_fight"),#count player victories
    (assign, reg21, "$g_tournament_cur_tier"),
    (assign, reg22, 0),
    (try_for_range, ":participants", 0, 49),
        (neg|troop_slot_eq,"trp_temp_array_olympia_c", ":participants", -1),
        (val_add, reg22, 1),
    (try_end),

    (try_begin),
        (eq, reg22, 0),
        (assign, "$g_tournament_bet_placed", 1),#has player won?
        (troop_set_slot, "trp_organiser", won_fighting, "trp_player"),
        (jump_to_menu, "mnu_competition_won"),
    (else_try),
        (eq, "$g_tournament_bet_placed", 0),#player lost, its over
        (call_script, "script_get_random_winer"),
        (assign, "$g_tournament_player_team_won", reg0),
        (troop_set_slot, "trp_organiser", won_fighting,reg0),
        (jump_to_menu, "mnu_competition_won"),
    (try_end),
  ],[
    ("leave",[],"Fight!",[
      (modify_visitors_at_site, "scn_olympia"),
      (reset_visitors),
      (set_visitor, 30, "trp_player"),
      (assign, "$g_next_menu", "mnu_competition_fist_fighting"),
      (val_add, "$g_tournament_cur_tier", 1),
      (assign, ":opponent", -1),
      (assign, ":score_to_beet", -1),
      (try_for_range, ":participants", 0, 49),
          (troop_get_slot, ":guy", "trp_temp_array_olympia_c", ":participants"),
          (gt, ":guy", -1),
          (store_character_level, ":level", ":guy"),
          (store_random_in_range, ":r", 0, 2),
          (val_add, ":level", ":r"),
          (gt, ":level", ":score_to_beet"),
          (assign, ":score_to_beet", ":level"),
          (assign, ":opponent", ":guy"),
      (try_end),
      (set_visitor, 31, ":opponent"),
      (troop_set_slot, "trp_organiser", current_opponent_1, ":opponent"),
      (try_for_range, ":entry", 32, 40),
          (store_random_in_range, ":r", 0, 3),
          (try_begin),
              (le, ":r", 1),
              (assign, ":guest", "trp_guest"),
          (else_try),
              (assign, ":guest", "trp_guest_female"),
          (try_end),
          (set_visitors, ":entry", ":guest", 5),
      (try_end),
      #####visitors
      (set_jump_mission, "mt_pygmachia"),
      (jump_to_scene, "scn_olympia"),
      (change_screen_mission),
    ]),
    ("leave",[],"Show remaining opponents.",[
      (assign, "$g_next_menu", "mnu_competition_fist_fighting"),
      (jump_to_menu, "mnu_olympia_remainging_opponents"),
    ]),
    ("leave",[],"Walk around.",[
      (modify_visitors_at_site, "scn_olympia"),
      (reset_visitors),
      (set_visitor, 2, "trp_roman_priest"),
      (set_visitor, 3, "trp_tavern_minstrel_4"),
      (set_visitor, 5, "trp_guest_female"),
      (set_visitors, 6, "trp_guest_female",3),
      (set_visitors, 7, "trp_guest",2),
      (set_visitors, 8, "trp_guest_female",2),
      (set_visitor, 9, "trp_guest"),
      (set_visitor, 10, "trp_guest_female"),
      (set_visitor, 11, "trp_guest_female"),
      (set_visitor, 12, "trp_guest"),
      (set_visitor, 13, "trp_guest"),
      (set_visitor, 14, "trp_guest_female"),
      (set_visitors, 15, "trp_guest",3),
      (set_visitors, 16, "trp_guest_female",3),
      (set_visitor, 17, "trp_guest_female"),
      (set_visitor, 18, "trp_guest"),
      (set_visitor, 19, "trp_guest"),
      (set_visitor, 20, "trp_guest_female"),
      (set_visitors, 21, "trp_guest_female",2),
      (set_visitor, 23, "trp_mercenary_swordsman"),

      (set_visitor, 24, "trp_athlet_1"),
      (set_visitor, 25, "trp_athlet_2"),
      (set_visitor, 26, "trp_athlet_3"),
      (set_visitor, 27, "trp_athlet_4"),

      (store_current_hours, ":hours"),
      (troop_set_slot, "trp_organiser", rest_olympia, ":hours"),
      (troop_set_slot, "trp_organiser", olympia_auto_menu, "mnu_competition_fist_fighting"),
      (jump_to_menu, "mnu_auto_return_map"),

      (set_jump_entry, 40),
      #41-50 are gropies
      (try_for_range, ":entry", 41, 51),
          (set_visitor, ":entry", "trp_groupie"),
      (try_end),
      (set_jump_mission, "mt_visit_olympia"),
      (jump_to_scene, "scn_olympia"),
      (set_passage_menu,"mnu_olympia"),
      (change_screen_mission),
    ]),
    ("leave",[],"Give up.",[
      (assign, "$g_next_menu", "mnu_competition_fist_fighting"),
      (jump_to_menu, "mnu_olympia_give_up"),
    ]),
]),
###############fist fighting end
###second diaulos
("competition_diaulos",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "The second competition is the Diaulos, a running race. Two races will take place: The winners of the first race will run against each other in the second and final race."+
  " ^^You are at round {reg21} and {reg22} opponents are remaining.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
    (try_begin),
        (troop_slot_eq, "trp_organiser", won_running_tunic, -1),
        (try_for_range, ":participants_0", 0, 49),
            (troop_get_slot, ":guy", "trp_olympia_participants", ":participants_0"),
            (troop_set_slot, "trp_temp_array_olympia_c", ":participants_0", ":guy"),
        (try_end),
        (troop_set_slot, "trp_organiser", won_running_tunic, -2),
    (try_end),

    (str_clear, s22),
    #remove guys
    (try_begin),
        (eq, "$g_tournament_bet_win_amount", 1),#for remove of opponents
        (assign, ":guys_to_remove", 42),
        (assign, "$g_tournament_bet_win_amount", -1),#for remove of opponents
    (else_try),
        (assign, ":guys_to_remove", -1),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #first remove the people who were defeated
    (assign, ":break", 49),
    (try_for_range, ":participants", 0, ":break"),#find guys and remove them
        (ge, ":guys_to_remove", 1),
        (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
        (gt, ":guy", -1),
        (assign, ":c", 0),
        (assign, ":break_2", 9),
        (try_for_range, ":slot", 1, ":break_2"),
            (neg|troop_slot_eq, "trp_temp_array_olympia_b", ":slot", -1),
            (troop_slot_eq, "trp_temp_array_olympia_b", ":slot", ":guy"),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
            (assign, ":c", 1),
            (assign, ":break_2", -1),
        (try_end),
        (eq, ":c", 1),
        (assign, ":c", 0),
        (try_begin),
            (neq, ":guy_won", ":guy"),
            (assign, ":c", 1),
        (else_try),
            (assign, ":guy_won", -1),
        (try_end),
        (eq, ":c", 1),
        (troop_set_slot,"trp_temp_array_olympia_c", ":participants", -1),

        (val_sub, ":guys_to_remove", 1),
        (try_begin),
            (eq, ":guys_to_remove", 0),
            (assign, ":break", -1),
        (try_end),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #remove other guys
    (assign, ":break", 49),
    (try_for_range, ":unused", 0, ":guys_to_remove"),#find other guys and remove them
        (assign, ":score", -1),
        (assign, ":remove_slot", -1),
        (try_for_range, ":participants", 0, ":break"),#find other guys and remove them
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
            (gt, ":guy", -1),
            (neq, ":guy_won", ":guy"),
            (store_character_level, ":level", ":guy"),
            (store_random_in_range, ":r", 0, 2),
            (val_add, ":level", ":r"),
            (gt, ":level", ":score"),
            (assign, ":score", ":level"),
            (assign, ":remove_slot", ":participants"),
        (try_end),
        (troop_set_slot,"trp_temp_array_olympia_c", ":remove_slot", -1),
    (try_end),

    (assign, reg23, "$g_tournament_num_participants_for_fight"),#count player victories
    (assign, reg21, "$g_tournament_cur_tier"),
    (assign, reg22, 0),
    (try_for_range, ":participants_3", 0, 49),
        (neg|troop_slot_eq,"trp_temp_array_olympia_c", ":participants_3", -1),
        (val_add, reg22, 1),
    (try_end),

    (try_begin),
        (eq, reg22, 0),
        (assign, "$g_tournament_bet_placed", 1),#has player won?
        (troop_set_slot, "trp_organiser", won_running_tunic, "trp_player"),
        (jump_to_menu, "mnu_competition_won"),
    (else_try),
        (eq, "$g_tournament_bet_placed", 0),#player lost, its over
        (call_script, "script_get_random_winer"),
        (assign, "$g_tournament_player_team_won", reg0),
        (troop_set_slot, "trp_organiser", won_running_tunic,reg0),
        (jump_to_menu, "mnu_competition_won"),
    (try_end),
  ],[
    ("leave",[],"Run!",[
      (assign, "$g_tournament_player_team_won", -1),
      (assign, "$g_tournament_bet_placed", 0),
      (modify_visitors_at_site, "scn_horse_race_arena_olympia"),
      (reset_visitors),
      (assign, "$temp4_1", 0),
      (assign, "$temp4", 1),
      (set_jump_mission, "mt_horse_racing"),

      (try_for_range, ":slot", 0, 49),
          (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":slot"),
          (troop_set_slot, "trp_temp_array_olympia_a", ":slot", ":guy"),
      (try_end),

      (try_for_range, ":slot", 1, 8),
          (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
      (try_end),

      (try_for_range, ":slots", 1, 8),
          (assign, ":score_to_beet", -1),
          (assign, ":opponent", -1),
          (assign, ":opponent_slot", -1),
          (try_for_range, ":participants", 0, 49),
              (troop_get_slot, ":guy", "trp_temp_array_olympia_a", ":participants"),
              (gt, ":guy", -1),
              (store_character_level, ":level", ":guy"),
              (store_random_in_range, ":r", 0, 2),
              (val_add, ":level", ":r"),
              (gt, ":level", ":score_to_beet"),
              (assign, ":opponent", ":guy"),
              (assign, ":opponent_slot", ":participants"),
          (try_end),
          (troop_set_slot, "trp_temp_array_olympia_b", ":slots", ":opponent"),
          (troop_set_slot, "trp_temp_array_olympia_a", ":opponent_slot", -1),
      (try_end),
      (troop_set_slot, "trp_temp_array_olympia_b", 0, "trp_player"),

      (try_for_range, ":entry", 8, 15),
          # (mission_tpl_entry_set_override_flags, "mt_horse_racing", ":entry", af_override_horse),
          (mission_tpl_entry_clear_override_items, "mt_horse_racing", ":entry"),
          (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_roman_poor1"),
          (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_caligea"),
      (try_end),
      # (mission_tpl_entry_set_override_flags, "mt_horse_racing", 0, af_override_horse),#player
      (mission_tpl_entry_clear_override_items, "mt_horse_racing", 0),
      (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_roman_poor1"),
      (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_caligea"),
      (set_jump_entry, 0),

      (try_for_range, ":entry", 8,15),
          (store_sub, ":slot", ":entry", 7),
          (troop_get_slot, ":opponent", "trp_temp_array_olympia_b", ":slot"),
          (set_visitor, ":entry", ":opponent"),
      (try_end),
      (set_visitors, 1, "trp_guest", 10),
      (set_visitors, 2, "trp_guest_female", 10),
      (set_visitors, 3, "trp_guest", 10),
      (set_visitors, 4, "trp_guest_female", 10),
      (set_visitors, 5, "trp_guest", 10),
      (set_visitors, 6, "trp_guest_female", 10),
      (set_visitors, 7, "trp_guest", 10),
      (set_visitors, 16, "trp_guest_female", 10),
      (set_visitors, 17, "trp_guest", 10),
      (try_for_range, ":entry", 28, 48),
        (store_random_in_range, ":r", 0, 2),
        (try_begin),
          (eq, ":r", 0),
          (set_visitors, ":entry", "trp_guest", 10),
        (else_try),
          (set_visitors, ":entry", "trp_guest_female", 10),
        (try_end),
      (try_end),
      (try_for_range, ":entry", 58, 76),
        (store_random_in_range, ":r", 0, 2),
        (try_begin),
          (eq, ":r", 0),
          (set_visitors, ":entry", "trp_guest", 10),
        (else_try),
          (set_visitors, ":entry", "trp_guest_female", 10),
        (try_end),
      (try_end),
      #####visitors

      (jump_to_scene, "scn_horse_race_arena_olympia"),
      (assign, "$g_next_menu", "mnu_competition_diaulos"),
      (val_add, "$g_tournament_cur_tier", 1),
      (change_screen_mission),
    ]),
    ("leave",[],"Show remaining opponents.",[
      (assign, "$g_next_menu", "mnu_competition_diaulos"),
      (jump_to_menu, "mnu_olympia_remainging_opponents"),
    ]),
    ("leave",[],"Walk around.",[
      (modify_visitors_at_site, "scn_olympia"),
      (reset_visitors),
      (set_visitor, 2, "trp_roman_priest"),
      (set_visitor, 3, "trp_tavern_minstrel_4"),
      (set_visitor, 5, "trp_guest_female"),
      (set_visitors, 6, "trp_guest_female",3),
      (set_visitors, 7, "trp_guest",2),
      (set_visitors, 8, "trp_guest_female",2),
      (set_visitor, 9, "trp_guest"),
      (set_visitor, 10, "trp_guest_female"),
      (set_visitor, 11, "trp_guest_female"),
      (set_visitor, 12, "trp_guest"),
      (set_visitor, 13, "trp_guest"),
      (set_visitor, 14, "trp_guest_female"),
      (set_visitors, 15, "trp_guest",3),
      (set_visitors, 16, "trp_guest_female",3),
      (set_visitor, 17, "trp_guest_female"),
      (set_visitor, 18, "trp_guest"),
      (set_visitor, 19, "trp_guest"),
      (set_visitor, 20, "trp_guest_female"),
      (set_visitors, 21, "trp_guest_female",2),
      (set_visitor, 23, "trp_mercenary_swordsman"),

      (set_visitor, 24, "trp_athlet_1"),
      (set_visitor, 25, "trp_athlet_2"),
      (set_visitor, 26, "trp_athlet_3"),
      (set_visitor, 27, "trp_athlet_4"),

      (set_jump_entry, 40),
      #41-50 are gropies
      (try_for_range, ":entry", 41, 51),
          (set_visitor, ":entry", "trp_groupie"),
      (try_end),
      (set_jump_mission, "mt_visit_olympia"),
      (store_current_hours, ":hours"),
      (troop_set_slot, "trp_organiser", rest_olympia, ":hours"),
      (troop_set_slot, "trp_organiser", olympia_auto_menu, "mnu_competition_diaulos"),
      (jump_to_menu, "mnu_auto_return_map"),

      (jump_to_scene, "scn_olympia"),
      (change_screen_mission),
    ]),

    ("leave",[],"Give up.",[
      (assign, "$g_next_menu", "mnu_competition_diaulos"),
      (jump_to_menu, "mnu_olympia_give_up"),
    ]),
]),
###############END
###third hoplite run
("competition_hoplite",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "The third competition is the Hoplitodromos, a running race where the opponents wear full armor. Two races will take place: The winners of the first race will run against each other in the second and final race."+
  " ^^You are at round {reg21} and {reg22} opponents are remaining.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
    (try_begin),
        (troop_slot_eq, "trp_organiser", won_running_hoplit, -1),
        (try_for_range, ":participants_0", 0, 49),
            (troop_get_slot, ":guy", "trp_olympia_participants", ":participants_0"),
            (troop_set_slot, "trp_temp_array_olympia_c", ":participants_0", ":guy"),
        (try_end),
        (troop_set_slot, "trp_organiser", won_running_hoplit, -2),
    (try_end),

    (str_clear, s22),
    #remove guys
    (try_begin),
        (eq, "$g_tournament_bet_win_amount", 1),#for remove of opponents
        (assign, ":guys_to_remove", 42),
        (assign, "$g_tournament_bet_win_amount", -1),#for remove of opponents
    (else_try),
        (assign, ":guys_to_remove", -1),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #first remove the people who were defeated
    (assign, ":break", 49),
    (try_for_range, ":participants", 0, ":break"),#find guys and remove them
        (ge, ":guys_to_remove", 1),
        (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
        (gt, ":guy", -1),
        (assign, ":c", 0),
        (assign, ":break_2", 9),
        (try_for_range, ":slot", 1, ":break_2"),
            (neg|troop_slot_eq, "trp_temp_array_olympia_b", ":slot", -1),
            (troop_slot_eq, "trp_temp_array_olympia_b", ":slot", ":guy"),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
            (assign, ":c", 1),
            (assign, ":break_2", -1),
        (try_end),
        (eq, ":c", 1),
        (assign, ":c", 0),
        (try_begin),
            (neq, ":guy_won", ":guy"),
            (assign, ":c", 1),
        (else_try),
            (assign, ":guy_won", -1),
        (try_end),
        (eq, ":c", 1),
        (troop_set_slot,"trp_temp_array_olympia_c", ":participants", -1),

        (val_sub, ":guys_to_remove", 1),
        (try_begin),
            (eq, ":guys_to_remove", 0),
            (assign, ":break", -1),
        (try_end),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #remove other guys
    (assign, ":break", 49),
    (try_for_range, ":unused", 0, ":guys_to_remove"),#find other guys and remove them
        (assign, ":score", -1),
        (assign, ":remove_slot", -1),
        (try_for_range, ":participants", 0, ":break"),#find other guys and remove them
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
            (gt, ":guy", -1),
            (neq, ":guy_won", ":guy"),
            (store_character_level, ":level", ":guy"),
            (store_random_in_range, ":r", 0, 2),
            (val_add, ":level", ":r"),
            (gt, ":level", ":score"),
            (assign, ":score", ":level"),
            (assign, ":remove_slot", ":participants"),
        (try_end),
        (troop_set_slot,"trp_temp_array_olympia_c", ":remove_slot", -1),
    (try_end),

    (assign, reg23, "$g_tournament_num_participants_for_fight"),#count player victories
    (assign, reg21, "$g_tournament_cur_tier"),
    (assign, reg22, 0),
    (try_for_range, ":participants_3", 0, 49),
        (neg|troop_slot_eq,"trp_temp_array_olympia_c", ":participants_3", -1),
        (val_add, reg22, 1),
    (try_end),

    (try_begin),
        (eq, reg22, 0),
        (assign, "$g_tournament_bet_placed", 1),#has player won?
        (troop_set_slot, "trp_organiser", won_running_hoplit, "trp_player"),
        (jump_to_menu, "mnu_competition_won"),
    (else_try),
        (eq, "$g_tournament_bet_placed", 0),#player lost, its over
        (call_script, "script_get_random_winer"),
        (assign, "$g_tournament_player_team_won", reg0),
        (troop_set_slot, "trp_organiser", won_running_hoplit,reg0),
        (jump_to_menu, "mnu_competition_won"),
    (try_end),
  ],[
    ("leave",[],"Run!",[
      (assign, "$g_tournament_player_team_won", -1),
      (assign, "$g_tournament_bet_placed", 0),
      (modify_visitors_at_site, "scn_horse_race_arena_olympia"),
      (reset_visitors),
      (assign, "$temp4_1", 0),
      (assign, "$temp4", 2),
      (set_jump_mission, "mt_horse_racing"),

      (try_for_range, ":slot", 0, 49),
          (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":slot"),
          (troop_set_slot, "trp_temp_array_olympia_a", ":slot", ":guy"),
      (try_end),

      (try_for_range, ":slot", 1, 8),
          (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
      (try_end),

      (try_for_range, ":slots", 1, 8),
          (assign, ":score_to_beet", -1),
          (assign, ":opponent", -1),
          (assign, ":opponent_slot", -1),
          (try_for_range, ":participants", 0, 49),
              (troop_get_slot, ":guy", "trp_temp_array_olympia_a", ":participants"),
              (gt, ":guy", -1),
              (store_character_level, ":level", ":guy"),
              (store_random_in_range, ":r", 0, 2),
              (val_add, ":level", ":r"),
              (gt, ":level", ":score_to_beet"),
              (assign, ":opponent", ":guy"),
              (assign, ":opponent_slot", ":participants"),
          (try_end),
          (troop_set_slot, "trp_temp_array_olympia_b", ":slots", ":opponent"),
          (troop_set_slot, "trp_temp_array_olympia_a", ":opponent_slot", -1),
      (try_end),
      (troop_set_slot, "trp_temp_array_olympia_b", 0, "trp_player"),

      (try_for_range, ":entry", 8, 15),
          # (mission_tpl_entry_set_override_flags, "mt_horse_racing", ":entry", af_override_horse),
          (mission_tpl_entry_clear_override_items, "mt_horse_racing", ":entry"),
          (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_mak_helm_2"),
          (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_hoplon_1"),
          (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_mail_shirt"),
          (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_legio_armored_caligea"),
      (try_end),
      # (mission_tpl_entry_set_override_flags, "mt_horse_racing", 0, af_override_horse),#player
      (mission_tpl_entry_clear_override_items, "mt_horse_racing", 0),
      (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_mak_helm_2"),
      (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_hoplon_1"),
      (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_mail_shirt"),
      (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_legio_armored_caligea"),
      (set_jump_entry, 0),

      (try_for_range, ":entry", 8,15),
          (store_sub, ":slot", ":entry", 7),
          (troop_get_slot, ":opponent", "trp_temp_array_olympia_b", ":slot"),
          (set_visitor, ":entry", ":opponent"),
      (try_end),
      (set_visitors, 1, "trp_guest", 10),
      (set_visitors, 2, "trp_guest_female", 10),
      (set_visitors, 3, "trp_guest", 10),
      (set_visitors, 4, "trp_guest_female", 10),
      (set_visitors, 5, "trp_guest", 10),
      (set_visitors, 6, "trp_guest_female", 10),
      (set_visitors, 7, "trp_guest", 10),
      (set_visitors, 16, "trp_guest_female", 10),
      (set_visitors, 17, "trp_guest", 10),
      (try_for_range, ":entry", 28, 48),
        (store_random_in_range, ":r", 0, 2),
        (try_begin),
          (eq, ":r", 0),
          (set_visitors, ":entry", "trp_guest", 10),
        (else_try),
          (set_visitors, ":entry", "trp_guest_female", 10),
        (try_end),
      (try_end),
      (try_for_range, ":entry", 58, 76),
        (store_random_in_range, ":r", 0, 2),
        (try_begin),
          (eq, ":r", 0),
          (set_visitors, ":entry", "trp_guest", 10),
        (else_try),
          (set_visitors, ":entry", "trp_guest_female", 10),
        (try_end),
      (try_end),
      #####visitors
      (jump_to_scene, "scn_horse_race_arena_olympia"),
      (assign, "$g_next_menu", "mnu_competition_hoplite"),
      (val_add, "$g_tournament_cur_tier", 1),
      (change_screen_mission),
    ]),
    ("leave",[],"Show remaining opponents.",[
      (assign, "$g_next_menu", "mnu_competition_hoplite"),
      (jump_to_menu, "mnu_olympia_remainging_opponents"),
    ]),
    ("leave",[],"Walk around.",[
      (modify_visitors_at_site, "scn_olympia"),
      (reset_visitors),
      (set_visitor, 2, "trp_roman_priest"),
      (set_visitor, 3, "trp_tavern_minstrel_4"),
      (set_visitor, 5, "trp_guest_female"),
      (set_visitors, 6, "trp_guest_female",3),
      (set_visitors, 7, "trp_guest",2),
      (set_visitors, 8, "trp_guest_female",2),
      (set_visitor, 9, "trp_guest"),
      (set_visitor, 10, "trp_guest_female"),
      (set_visitor, 11, "trp_guest_female"),
      (set_visitor, 12, "trp_guest"),
      (set_visitor, 13, "trp_guest"),
      (set_visitor, 14, "trp_guest_female"),
      (set_visitors, 15, "trp_guest",3),
      (set_visitors, 16, "trp_guest_female",3),
      (set_visitor, 17, "trp_guest_female"),
      (set_visitor, 18, "trp_guest"),
      (set_visitor, 19, "trp_guest"),
      (set_visitor, 20, "trp_guest_female"),
      (set_visitors, 21, "trp_guest_female",2),
      (set_visitor, 23, "trp_mercenary_swordsman"),

      (set_visitor, 24, "trp_athlet_1"),
      (set_visitor, 25, "trp_athlet_2"),
      (set_visitor, 26, "trp_athlet_3"),
      (set_visitor, 27, "trp_athlet_4"),
      (set_jump_entry, 40),
      #41-50 are gropies
      (try_for_range, ":entry", 41, 51),
          (set_visitor, ":entry", "trp_groupie"),
      (try_end),
      (store_current_hours, ":hours"),
      (troop_set_slot, "trp_organiser", rest_olympia, ":hours"),
      (troop_set_slot, "trp_organiser", olympia_auto_menu, "mnu_competition_hoplite"),
      (jump_to_menu, "mnu_auto_return_map"),

      (set_jump_mission, "mt_visit_olympia"),
      (jump_to_scene, "scn_olympia"),
      (set_passage_menu,"mnu_olympia"),
      (change_screen_mission),
    ]),

    ("leave",[],"Give up.",[
      (assign, "$g_next_menu", "mnu_competition_hoplite"),
      (jump_to_menu, "mnu_olympia_give_up"),
    ]),
]),
###############END
###4th throwing spears
    ("competition_throwing",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
    "The fourth competition is spear throw. Two rounds will take place: The winners of the first round will battle each other in the second and final round."+
    " ^^You are at round {reg21} and {reg22} opponents are remaining.",
    "none",
    [(set_background_mesh, "mesh_pic_orgie"),
    (try_begin),
        (troop_slot_eq, "trp_organiser", won_throwing, -1),
        (try_for_range, ":participants_0", 0, 49),
            (troop_get_slot, ":guy", "trp_olympia_participants", ":participants_0"),
            (troop_set_slot, "trp_temp_array_olympia_c", ":participants_0", ":guy"),
        (try_end),
        (troop_set_slot, "trp_organiser", won_throwing, -2),
    (try_end),

    (str_clear, s22),
    #remove guys
    (try_begin),
        (eq, "$g_tournament_bet_win_amount", 1),#for remove of opponents
        (assign, ":guys_to_remove", 42),
        (assign, "$g_tournament_bet_win_amount", -1),#for remove of opponents
    (else_try),
        (assign, ":guys_to_remove", -1),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #first remove the people who were defeated
    (assign, ":break", 49),
    (try_for_range, ":participants", 0, ":break"),#find guys and remove them
        (ge, ":guys_to_remove", 1),
        (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
        (gt, ":guy", -1),
        (assign, ":c", 0),
        (assign, ":break_2", 9),
        (try_for_range, ":slot", 1, ":break_2"),
            (neg|troop_slot_eq, "trp_temp_array_olympia_b", ":slot", -1),
            (troop_slot_eq, "trp_temp_array_olympia_b", ":slot", ":guy"),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
            (assign, ":c", 1),
            (assign, ":break_2", -1),
        (try_end),
        (eq, ":c", 1),
        (assign, ":c", 0),
        (try_begin),
            (neq, ":guy_won", ":guy"),
            (assign, ":c", 1),
        (else_try),
            (assign, ":guy_won", -1),
        (try_end),
        (eq, ":c", 1),
        (troop_set_slot,"trp_temp_array_olympia_c", ":participants", -1),

        (val_sub, ":guys_to_remove", 1),
        (try_begin),
            (eq, ":guys_to_remove", 0),
            (assign, ":break", -1),
        (try_end),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #remove other guys
    (assign, ":break", 49),
    (try_for_range, ":unused", 0, ":guys_to_remove"),#find other guys and remove them
        (assign, ":score", -1),
        (assign, ":remove_slot", -1),
        (try_for_range, ":participants", 0, ":break"),#find other guys and remove them
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
            (gt, ":guy", -1),
            (neq, ":guy_won", ":guy"),
            (store_character_level, ":level", ":guy"),
            (store_random_in_range, ":r", 0, 2),
            (val_add, ":level", ":r"),
            (gt, ":level", ":score"),
            (assign, ":score", ":level"),
            (assign, ":remove_slot", ":participants"),
        (try_end),
        (troop_set_slot,"trp_temp_array_olympia_c", ":remove_slot", -1),
    (try_end),

    (assign, reg23, "$g_tournament_num_participants_for_fight"),#count player victories
    (assign, reg21, "$g_tournament_cur_tier"),
    (assign, reg22, 0),
    (try_for_range, ":participants_3", 0, 49),
        (neg|troop_slot_eq,"trp_temp_array_olympia_c", ":participants_3", -1),
        (val_add, reg22, 1),
    (try_end),

    (try_begin),
        (eq, reg22, 0),
        (assign, "$g_tournament_bet_placed", 1),#has player won?
        (troop_set_slot, "trp_organiser", won_throwing, "trp_player"),
        (jump_to_menu, "mnu_competition_won"),
    (else_try),
        (eq, "$g_tournament_bet_placed", 0),#player lost, its over
        (call_script, "script_get_random_winer"),
        (assign, "$g_tournament_player_team_won", reg0),
        (troop_set_slot, "trp_organiser", won_throwing,reg0),
        (jump_to_menu, "mnu_competition_won"),
    (try_end),
    ],

    [
    ("leave",[],"Throw!",[
        (assign, "$temp4_1", 2),
        (assign, "$g_tournament_player_team_won", -1),
        (assign, "$g_next_menu", "mnu_competition_throwing"),
        (try_for_range, ":slot", 0, 49),
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":slot"),
            (troop_set_slot, "trp_temp_array_olympia_a", ":slot", ":guy"),
        (try_end),

        (try_for_range, ":slot", 1, 8),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
        (try_end),

        (try_for_range, ":slots", 1, 8),
            (assign, ":score_to_beet", -1),
            (assign, ":opponent", -1),
            (assign, ":opponent_slot", -1),
            (try_for_range, ":participants", 0, 49),
                (troop_get_slot, ":guy", "trp_temp_array_olympia_a", ":participants"),
                (gt, ":guy", -1),
                (store_character_level, ":level", ":guy"),
                (store_random_in_range, ":r", 0, 2),
                (val_add, ":level", ":r"),
                (gt, ":level", ":score_to_beet"),
                (assign, ":opponent", ":guy"),
                (assign, ":opponent_slot", ":participants"),
            (try_end),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slots", ":opponent"),
            (troop_set_slot, "trp_temp_array_olympia_a", ":opponent_slot", -1),
        (try_end),
        (troop_set_slot, "trp_temp_array_olympia_b", 0, "trp_player"),

        (assign, "$g_tournament_bet_placed", 0),
        (modify_visitors_at_site, "scn_horse_race_arena_olympia"),
        (reset_visitors),
        (assign, "$temp4", 2),
        (set_jump_mission, "mt_spear_throwing"),

        (try_for_range, ":entry", 8, 15),
            (mission_tpl_entry_clear_override_items, "mt_spear_throwing", ":entry"),
            (mission_tpl_entry_add_override_item, "mt_spear_throwing",":entry", "itm_roman_poor1"),
            (mission_tpl_entry_add_override_item, "mt_spear_throwing",":entry", "itm_caligea"),
            (mission_tpl_entry_add_override_item, "mt_spear_throwing",":entry", "itm_throwing_spears_olymp"),
        (try_end),
        (mission_tpl_entry_clear_override_items, "mt_spear_throwing", 0),
        (mission_tpl_entry_add_override_item, "mt_spear_throwing",0, "itm_roman_poor1"),
        (mission_tpl_entry_add_override_item, "mt_spear_throwing",0, "itm_caligea"),
        (set_jump_entry, 0),

        (try_for_range, ":entry", 8,15),
            (store_sub, ":slot", ":entry", 7),
            (troop_get_slot, ":opponent", "trp_temp_array_olympia_b", ":slot"),
            (set_visitor, ":entry", ":opponent"),
        (try_end),

        (set_visitors, 1, "trp_guest", 10),
        (set_visitors, 2, "trp_guest_female", 10),
        (set_visitors, 3, "trp_guest", 10),
        (set_visitors, 4, "trp_guest_female", 10),
        (set_visitors, 5, "trp_guest", 10),
        (set_visitors, 6, "trp_guest_female", 10),
        (set_visitors, 7, "trp_guest", 10),
        (set_visitors, 16, "trp_guest_female", 10),
        (set_visitors, 17, "trp_guest", 10),
        (try_for_range, ":entry", 28, 48),
          (store_random_in_range, ":r", 0, 2),
          (try_begin),
            (eq, ":r", 0),
            (set_visitors, ":entry", "trp_guest", 10),
          (else_try),
            (set_visitors, ":entry", "trp_guest_female", 10),
          (try_end),
        (try_end),
        (try_for_range, ":entry", 58, 76),
          (store_random_in_range, ":r", 0, 2),
          (try_begin),
            (eq, ":r", 0),
            (set_visitors, ":entry", "trp_guest", 10),
          (else_try),
            (set_visitors, ":entry", "trp_guest_female", 10),
          (try_end),
        (try_end),
#####visitors

    (jump_to_scene, "scn_horse_race_arena_olympia"),
    (change_screen_mission),

      ]),
    ("leave",[],"Show remaining opponents.",[
    (assign, "$g_next_menu", "mnu_competition_throwing"),
    (jump_to_menu, "mnu_olympia_remainging_opponents"),
      ]),

    ("leave",[],"Walk around.",[
  (modify_visitors_at_site, "scn_olympia"),
  (reset_visitors),
  (set_visitor, 2, "trp_roman_priest"),
  (set_visitor, 3, "trp_tavern_minstrel_4"),
  (set_visitor, 5, "trp_guest_female"),
  (set_visitors, 6, "trp_guest_female",3),
  (set_visitors, 7, "trp_guest",2),
  (set_visitors, 8, "trp_guest_female",2),
  (set_visitor, 9, "trp_guest"),
  (set_visitor, 10, "trp_guest_female"),
  (set_visitor, 11, "trp_guest_female"),
  (set_visitor, 12, "trp_guest"),
  (set_visitor, 13, "trp_guest"),
  (set_visitor, 14, "trp_guest_female"),
  (set_visitors, 15, "trp_guest",3),
  (set_visitors, 16, "trp_guest_female",3),
  (set_visitor, 17, "trp_guest_female"),
  (set_visitor, 18, "trp_guest"),
  (set_visitor, 19, "trp_guest"),
  (set_visitor, 20, "trp_guest_female"),
  (set_visitors, 21, "trp_guest_female",2),
  (set_visitor, 23, "trp_mercenary_swordsman"),

  (set_visitor, 24, "trp_athlet_1"),
  (set_visitor, 25, "trp_athlet_2"),
  (set_visitor, 26, "trp_athlet_3"),
  (set_visitor, 27, "trp_athlet_4"),

    (set_jump_entry, 40),
    #41-50 are gropies
    (try_for_range, ":entry", 41, 51),
        (set_visitor, ":entry", "trp_groupie"),
    (try_end),
    (store_current_hours, ":hours"),
    (troop_set_slot, "trp_organiser", rest_olympia, ":hours"),
    (troop_set_slot, "trp_organiser", olympia_auto_menu, "mnu_competition_throwing"),
    (jump_to_menu, "mnu_auto_return_map"),

	(set_jump_mission, "mt_visit_olympia"),
    (jump_to_scene, "scn_olympia"),
    (set_passage_menu,"mnu_olympia"),
    (change_screen_mission),
      ]),

    ("leave",[],"Give up.",[
    (assign, "$g_next_menu", "mnu_competition_throwing"),
    (jump_to_menu, "mnu_olympia_give_up"),
      ]),
    ]),
###############END
###5th throwing discus
    ("competition_throwing_2",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
    "The fifth competition is Discus throw. Two rounds will take place: The winners of the first round will battle each other in the second and final round."+
    " ^^You are at round {reg21} and {reg22} opponents are remaining.",
    "none",
    [(set_background_mesh, "mesh_pic_orgie"),
    (try_begin),
        (troop_slot_eq, "trp_organiser", won_throwing_2, -1),
        (try_for_range, ":participants_0", 0, 49),
            (troop_get_slot, ":guy", "trp_olympia_participants", ":participants_0"),
            (troop_set_slot, "trp_temp_array_olympia_c", ":participants_0", ":guy"),
        (try_end),
        (troop_set_slot, "trp_organiser", won_throwing_2, -2),
    (try_end),

    (str_clear, s22),
    #remove guys
    (try_begin),
        (eq, "$g_tournament_bet_win_amount", 1),#for remove of opponents
        (assign, ":guys_to_remove", 42),
        (assign, "$g_tournament_bet_win_amount", -1),#for remove of opponents
    (else_try),
        (assign, ":guys_to_remove", -1),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #first remove the people who were defeated
    (assign, ":break", 49),
    (try_for_range, ":participants", 0, ":break"),#find guys and remove them
        (ge, ":guys_to_remove", 1),
        (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
        (gt, ":guy", -1),
        (assign, ":c", 0),
        (assign, ":break_2", 9),
        (try_for_range, ":slot", 1, ":break_2"),
            (neg|troop_slot_eq, "trp_temp_array_olympia_b", ":slot", -1),
            (troop_slot_eq, "trp_temp_array_olympia_b", ":slot", ":guy"),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
            (assign, ":c", 1),
            (assign, ":break_2", -1),
        (try_end),
        (eq, ":c", 1),
        (assign, ":c", 0),
        (try_begin),
            (neq, ":guy_won", ":guy"),
            (assign, ":c", 1),
        (else_try),
            (assign, ":guy_won", -1),
        (try_end),
        (eq, ":c", 1),
        (troop_set_slot,"trp_temp_array_olympia_c", ":participants", -1),

        (val_sub, ":guys_to_remove", 1),
        (try_begin),
            (eq, ":guys_to_remove", 0),
            (assign, ":break", -1),
        (try_end),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #remove other guys
    (assign, ":break", 49),
    (try_for_range, ":unused", 0, ":guys_to_remove"),#find other guys and remove them
        (assign, ":score", -1),
        (assign, ":remove_slot", -1),
        (try_for_range, ":participants", 0, ":break"),#find other guys and remove them
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
            (gt, ":guy", -1),
            (neq, ":guy_won", ":guy"),
            (store_character_level, ":level", ":guy"),
            (store_random_in_range, ":r", 0, 2),
            (val_add, ":level", ":r"),
            (gt, ":level", ":score"),
            (assign, ":score", ":level"),
            (assign, ":remove_slot", ":participants"),
        (try_end),
        (troop_set_slot,"trp_temp_array_olympia_c", ":remove_slot", -1),
    (try_end),

    (assign, reg23, "$g_tournament_num_participants_for_fight"),#count player victories
    (assign, reg21, "$g_tournament_cur_tier"),
    (assign, reg22, 0),
    (try_for_range, ":participants_3", 0, 49),
        (neg|troop_slot_eq,"trp_temp_array_olympia_c", ":participants_3", -1),
        (val_add, reg22, 1),
    (try_end),

    (try_begin),
        (eq, reg22, 0),
        (assign, "$g_tournament_bet_placed", 1),#has player won?
        (troop_set_slot, "trp_organiser", won_throwing_2, "trp_player"),
        (jump_to_menu, "mnu_competition_won"),
    (else_try),
        (eq, "$g_tournament_bet_placed", 0),#player lost, its over
        (call_script, "script_get_random_winer"),
        (assign, "$g_tournament_player_team_won", reg0),
        (troop_set_slot, "trp_organiser", won_throwing_2,reg0),
        (jump_to_menu, "mnu_competition_won"),
    (try_end),
    ],

    [
    ("leave",[],"Throw!",[
        (assign, "$temp4_1", 1),
        (assign, "$g_tournament_player_team_won", -1),
        (assign, "$g_next_menu", "mnu_competition_throwing_2"),
        (try_for_range, ":slot", 0, 49),
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":slot"),
            (troop_set_slot, "trp_temp_array_olympia_a", ":slot", ":guy"),
        (try_end),

        (try_for_range, ":slot", 1, 8),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
        (try_end),

        (try_for_range, ":slots", 1, 8),
            (assign, ":score_to_beet", -1),
            (assign, ":opponent", -1),
            (assign, ":opponent_slot", -1),
            (try_for_range, ":participants", 0, 49),
                (troop_get_slot, ":guy", "trp_temp_array_olympia_a", ":participants"),
                (gt, ":guy", -1),
                (store_character_level, ":level", ":guy"),
                (store_random_in_range, ":r", 0, 2),
                (val_add, ":level", ":r"),
                (gt, ":level", ":score_to_beet"),
                (assign, ":opponent", ":guy"),
                (assign, ":opponent_slot", ":participants"),
            (try_end),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slots", ":opponent"),
            (troop_set_slot, "trp_temp_array_olympia_a", ":opponent_slot", -1),
        (try_end),
        (troop_set_slot, "trp_temp_array_olympia_b", 0, "trp_player"),

        (assign, "$g_tournament_bet_placed", 0),
        (modify_visitors_at_site, "scn_horse_race_arena_olympia"),
        (reset_visitors),
        (assign, "$temp4", 2),
        (set_jump_mission, "mt_spear_throwing"),

        (try_for_range, ":entry", 8, 15),
            (mission_tpl_entry_clear_override_items, "mt_spear_throwing", ":entry"),
            (mission_tpl_entry_add_override_item, "mt_spear_throwing",":entry", "itm_roman_poor1"),
            (mission_tpl_entry_add_override_item, "mt_spear_throwing",":entry", "itm_caligea"),
            (mission_tpl_entry_add_override_item, "mt_spear_throwing",":entry", "itm_discus"),
        (try_end),
        (mission_tpl_entry_clear_override_items, "mt_spear_throwing", 0),
        (mission_tpl_entry_add_override_item, "mt_spear_throwing",0, "itm_roman_poor1"),
        (mission_tpl_entry_add_override_item, "mt_spear_throwing",0, "itm_caligea"),
        (set_jump_entry, 0),

        (try_for_range, ":entry", 8,15),
            (store_sub, ":slot", ":entry", 7),
            (troop_get_slot, ":opponent", "trp_temp_array_olympia_b", ":slot"),
            (set_visitor, ":entry", ":opponent"),
        (try_end),

        (set_visitors, 1, "trp_guest", 10),
        (set_visitors, 2, "trp_guest_female", 10),
        (set_visitors, 3, "trp_guest", 10),
        (set_visitors, 4, "trp_guest_female", 10),
        (set_visitors, 5, "trp_guest", 10),
        (set_visitors, 6, "trp_guest_female", 10),
        (set_visitors, 7, "trp_guest", 10),
        (set_visitors, 16, "trp_guest_female", 10),
        (set_visitors, 17, "trp_guest", 10),
        (try_for_range, ":entry", 28, 48),
          (store_random_in_range, ":r", 0, 2),
          (try_begin),
            (eq, ":r", 0),
            (set_visitors, ":entry", "trp_guest", 10),
          (else_try),
            (set_visitors, ":entry", "trp_guest_female", 10),
          (try_end),
        (try_end),
        (try_for_range, ":entry", 58, 76),
          (store_random_in_range, ":r", 0, 2),
          (try_begin),
            (eq, ":r", 0),
            (set_visitors, ":entry", "trp_guest", 10),
          (else_try),
            (set_visitors, ":entry", "trp_guest_female", 10),
          (try_end),
        (try_end),
#####visitors

    (jump_to_scene, "scn_horse_race_arena_olympia"),
    (change_screen_mission),

      ]),
    ("leave",[],"Show remaining opponents.",[
    (assign, "$g_next_menu", "mnu_competition_throwing_2"),
    (jump_to_menu, "mnu_olympia_remainging_opponents"),
      ]),

    ("leave",[],"Walk around.",[
  (modify_visitors_at_site, "scn_olympia"),
  (reset_visitors),
  (set_visitor, 2, "trp_roman_priest"),
  (set_visitor, 3, "trp_tavern_minstrel_4"),
  (set_visitor, 5, "trp_guest_female"),
  (set_visitors, 6, "trp_guest_female",3),
  (set_visitors, 7, "trp_guest",2),
  (set_visitors, 8, "trp_guest_female",2),
  (set_visitor, 9, "trp_guest"),
  (set_visitor, 10, "trp_guest_female"),
  (set_visitor, 11, "trp_guest_female"),
  (set_visitor, 12, "trp_guest"),
  (set_visitor, 13, "trp_guest"),
  (set_visitor, 14, "trp_guest_female"),
  (set_visitors, 15, "trp_guest",3),
  (set_visitors, 16, "trp_guest_female",3),
  (set_visitor, 17, "trp_guest_female"),
  (set_visitor, 18, "trp_guest"),
  (set_visitor, 19, "trp_guest"),
  (set_visitor, 20, "trp_guest_female"),
  (set_visitors, 21, "trp_guest_female",2),
  (set_visitor, 23, "trp_mercenary_swordsman"),

  (set_visitor, 24, "trp_athlet_1"),
  (set_visitor, 25, "trp_athlet_2"),
  (set_visitor, 26, "trp_athlet_3"),
  (set_visitor, 27, "trp_athlet_4"),

    (set_jump_entry, 40),
    #41-50 are gropies
    (try_for_range, ":entry", 41, 51),
        (set_visitor, ":entry", "trp_groupie"),
    (try_end),
    (store_current_hours, ":hours"),
    (troop_set_slot, "trp_organiser", rest_olympia, ":hours"),
    (troop_set_slot, "trp_organiser", olympia_auto_menu, "mnu_competition_throwing_2"),
    (jump_to_menu, "mnu_auto_return_map"),

	(set_jump_mission, "mt_visit_olympia"),
    (jump_to_scene, "scn_olympia"),
    (set_passage_menu,"mnu_olympia"),
    (change_screen_mission),
      ]),

    ("leave",[],"Give up.",[
    (assign, "$g_next_menu", "mnu_competition_throwing_2"),
    (jump_to_menu, "mnu_olympia_give_up"),
      ]),
    ]),
###############END
###sixth horse race
    ("competition_horse",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
    "The sixth competition is the horse race. Two races will take place: The winners of the first race will battle each other in the second and final race."+
    " ^^You are at round {reg21} and {reg22} opponents are remaining.",
    "none",
    [(set_background_mesh, "mesh_pic_orgie"),
    (try_begin),
        (troop_slot_eq, "trp_organiser", won_horse, -1),
        (try_for_range, ":participants_0", 0, 49),
            (troop_get_slot, ":guy", "trp_olympia_participants", ":participants_0"),
            (troop_set_slot, "trp_temp_array_olympia_c", ":participants_0", ":guy"),
        (try_end),
        (troop_set_slot, "trp_organiser", won_horse, -2),
    (try_end),

    (str_clear, s22),
    #remove guys
    (try_begin),
        (eq, "$g_tournament_bet_win_amount", 1),#for remove of opponents
        (assign, ":guys_to_remove", 42),
        (assign, "$g_tournament_bet_win_amount", -1),#for remove of opponents
    (else_try),
        (assign, ":guys_to_remove", -1),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #first remove the people who were defeated
    (assign, ":break", 49),
    (try_for_range, ":participants", 0, ":break"),#find guys and remove them
        (ge, ":guys_to_remove", 1),
        (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
        (gt, ":guy", -1),
        (assign, ":c", 0),
        (assign, ":break_2", 9),
        (try_for_range, ":slot", 1, ":break_2"),
            (neg|troop_slot_eq, "trp_temp_array_olympia_b", ":slot", -1),
            (troop_slot_eq, "trp_temp_array_olympia_b", ":slot", ":guy"),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
            (assign, ":c", 1),
            (assign, ":break_2", -1),
        (try_end),
        (eq, ":c", 1),
        (assign, ":c", 0),
        (try_begin),
            (neq, ":guy_won", ":guy"),
            (assign, ":c", 1),
        (else_try),
            (assign, ":guy_won", -1),
        (try_end),
        (eq, ":c", 1),
        (troop_set_slot,"trp_temp_array_olympia_c", ":participants", -1),

        (val_sub, ":guys_to_remove", 1),
        (try_begin),
            (eq, ":guys_to_remove", 0),
            (assign, ":break", -1),
        (try_end),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #remove other guys
    (assign, ":break", 49),
    (try_for_range, ":unused", 0, ":guys_to_remove"),#find other guys and remove them
        (assign, ":score", -1),
        (assign, ":remove_slot", -1),
        (try_for_range, ":participants", 0, ":break"),#find other guys and remove them
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
            (gt, ":guy", -1),
            (neq, ":guy_won", ":guy"),
            (store_character_level, ":level", ":guy"),
            (store_random_in_range, ":r", 0, 2),
            (val_add, ":level", ":r"),
            (gt, ":level", ":score"),
            (assign, ":score", ":level"),
            (assign, ":remove_slot", ":participants"),
        (try_end),
        (troop_set_slot,"trp_temp_array_olympia_c", ":remove_slot", -1),
    (try_end),

    (assign, reg23, "$g_tournament_num_participants_for_fight"),#count player victories
    (assign, reg21, "$g_tournament_cur_tier"),
    (assign, reg22, 0),
    (try_for_range, ":participants_3", 0, 49),
        (neg|troop_slot_eq,"trp_temp_array_olympia_c", ":participants_3", -1),
        (val_add, reg22, 1),
    (try_end),

    (try_begin),
        (eq, reg22, 0),
        (assign, "$g_tournament_bet_placed", 1),#has player won?
        (troop_set_slot, "trp_organiser", won_horse, "trp_player"),
        (jump_to_menu, "mnu_competition_won"),
    (else_try),
        (eq, "$g_tournament_bet_placed", 0),#player lost, its over
        (call_script, "script_get_random_winer"),
        (assign, "$g_tournament_player_team_won", reg0),
        (troop_set_slot, "trp_organiser", won_horse,reg0),
        (jump_to_menu, "mnu_competition_won"),
    (try_end),
    ],

    [
    ("leave",[],"Race!",[
        (assign, "$g_tournament_player_team_won", -1),
        (assign, "$g_tournament_bet_placed", 0),
        (modify_visitors_at_site, "scn_horse_race_arena_olympia"),
        (reset_visitors),
        (assign, "$temp4_1", 0),
        (assign, "$temp4", 0),
        (set_jump_mission, "mt_horse_racing"),

        (try_for_range, ":slot", 0, 49),
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":slot"),
            (troop_set_slot, "trp_temp_array_olympia_a", ":slot", ":guy"),
        (try_end),

        (try_for_range, ":slot", 1, 8),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
        (try_end),

        (try_for_range, ":slots", 1, 8),
            (assign, ":score_to_beet", -1),
            (assign, ":opponent", -1),
            (assign, ":opponent_slot", -1),
            (try_for_range, ":participants", 0, 49),
                (troop_get_slot, ":guy", "trp_temp_array_olympia_a", ":participants"),
                (gt, ":guy", -1),
                (store_character_level, ":level", ":guy"),
                (store_random_in_range, ":r", 0, 10),
                (val_add, ":level", ":r"),
                (gt, ":level", ":score_to_beet"),
                (assign, ":opponent", ":guy"),
                (assign, ":opponent_slot", ":participants"),
            (try_end),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slots", ":opponent"),
            (troop_set_slot, "trp_temp_array_olympia_a", ":opponent_slot", -1),
        (try_end),
        (troop_set_slot, "trp_temp_array_olympia_b", 0, "trp_player"),

        (set_jump_entry, 0),

        (try_for_range, ":entry", 8,15),
            (store_sub, ":slot", ":entry", 7),
            (troop_get_slot, ":opponent", "trp_temp_array_olympia_b", ":slot"),
            (set_visitor, ":entry", ":opponent"),
        (try_end),
        (set_visitors, 1, "trp_guest", 10),
        (set_visitors, 2, "trp_guest_female", 10),
        (set_visitors, 3, "trp_guest", 10),
        (set_visitors, 4, "trp_guest_female", 10),
        (set_visitors, 5, "trp_guest", 10),
        (set_visitors, 6, "trp_guest_female", 10),
        (set_visitors, 7, "trp_guest", 10),
        (set_visitors, 16, "trp_guest_female", 10),
        (set_visitors, 17, "trp_guest", 10),
        (try_for_range, ":entry", 28, 48),
          (store_random_in_range, ":r", 0, 2),
          (try_begin),
            (eq, ":r", 0),
            (set_visitors, ":entry", "trp_guest", 10),
          (else_try),
            (set_visitors, ":entry", "trp_guest_female", 10),
          (try_end),
        (try_end),
        (try_for_range, ":entry", 58, 76),
          (store_random_in_range, ":r", 0, 2),
          (try_begin),
            (eq, ":r", 0),
            (set_visitors, ":entry", "trp_guest", 10),
          (else_try),
            (set_visitors, ":entry", "trp_guest_female", 10),
          (try_end),
        (try_end),
#####visitors

    (jump_to_scene, "scn_horse_race_arena_olympia"),
    (assign, "$g_next_menu", "mnu_competition_horse"),
    (val_add, "$g_tournament_cur_tier", 1),
    (change_screen_mission),
      ]),
    ("leave",[],"Show remaining opponents.",[
    (assign, "$g_next_menu", "mnu_competition_horse"),
    (jump_to_menu, "mnu_olympia_remainging_opponents"),
      ]),
    ("leave",[],"Walk around.",[
  (modify_visitors_at_site, "scn_olympia"),
  (reset_visitors),
  (set_visitor, 2, "trp_roman_priest"),
  (set_visitor, 3, "trp_tavern_minstrel_4"),
  (set_visitor, 5, "trp_guest_female"),
  (set_visitors, 6, "trp_guest_female",3),
  (set_visitors, 7, "trp_guest",2),
  (set_visitors, 8, "trp_guest_female",2),
  (set_visitor, 9, "trp_guest"),
  (set_visitor, 10, "trp_guest_female"),
  (set_visitor, 11, "trp_guest_female"),
  (set_visitor, 12, "trp_guest"),
  (set_visitor, 13, "trp_guest"),
  (set_visitor, 14, "trp_guest_female"),
  (set_visitors, 15, "trp_guest",3),
  (set_visitors, 16, "trp_guest_female",3),
  (set_visitor, 17, "trp_guest_female"),
  (set_visitor, 18, "trp_guest"),
  (set_visitor, 19, "trp_guest"),
  (set_visitor, 20, "trp_guest_female"),
  (set_visitors, 21, "trp_guest_female",2),
  (set_visitor, 23, "trp_mercenary_swordsman"),

  (set_visitor, 24, "trp_athlet_1"),
  (set_visitor, 25, "trp_athlet_2"),
  (set_visitor, 26, "trp_athlet_3"),
  (set_visitor, 27, "trp_athlet_4"),

    (set_jump_entry, 40),
    #41-50 are gropies
    (try_for_range, ":entry", 41, 51),
        (set_visitor, ":entry", "trp_groupie"),
    (try_end),
    (store_current_hours, ":hours"),
    (troop_set_slot, "trp_organiser", rest_olympia, ":hours"),
    (troop_set_slot, "trp_organiser", olympia_auto_menu, "mnu_competition_horse"),
    (jump_to_menu, "mnu_auto_return_map"),

	(set_jump_mission, "mt_visit_olympia"),
    (jump_to_scene, "scn_olympia"),
    (set_passage_menu,"mnu_olympia"),
    (change_screen_mission),
      ]),

    ("leave",[],"Give up.",[
    (assign, "$g_next_menu", "mnu_competition_horse"),
    (jump_to_menu, "mnu_olympia_give_up"),
      ]),
    ]),
###############END
###final mule race
    ("competition_mule",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
    "The final and most glorious competition is the mule race. Two races will take place: The winners of the first race will battle each other in the second and final race."+
    " ^^You are at round {reg21} and {reg22} opponents are remaining.",
    "none",
    [(set_background_mesh, "mesh_pic_orgie"),
    (try_begin),
        (troop_slot_eq, "trp_organiser", won_mule, -1),
        (try_for_range, ":participants_0", 0, 49),
            (troop_get_slot, ":guy", "trp_olympia_participants", ":participants_0"),
            (troop_set_slot, "trp_temp_array_olympia_c", ":participants_0", ":guy"),
        (try_end),
        (troop_set_slot, "trp_organiser", won_mule, -2),
    (try_end),

    (str_clear, s22),
    #remove guys
    (try_begin),
        (eq, "$g_tournament_bet_win_amount", 1),#for remove of opponents
        (assign, ":guys_to_remove", 42),
        (assign, "$g_tournament_bet_win_amount", -1),#for remove of opponents
    (else_try),
        (assign, ":guys_to_remove", -1),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #first remove the people who were defeated
    (assign, ":break", 49),
    (try_for_range, ":participants", 0, ":break"),#find guys and remove them
        (ge, ":guys_to_remove", 1),
        (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
        (gt, ":guy", -1),
        (assign, ":c", 0),
        (assign, ":break_2", 9),
        (try_for_range, ":slot", 1, ":break_2"),
            (neg|troop_slot_eq, "trp_temp_array_olympia_b", ":slot", -1),
            (troop_slot_eq, "trp_temp_array_olympia_b", ":slot", ":guy"),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
            (assign, ":c", 1),
            (assign, ":break_2", -1),
        (try_end),
        (eq, ":c", 1),
        (assign, ":c", 0),
        (try_begin),
            (neq, ":guy_won", ":guy"),
            (assign, ":c", 1),
        (else_try),
            (assign, ":guy_won", -1),
        (try_end),
        (eq, ":c", 1),
        (troop_set_slot,"trp_temp_array_olympia_c", ":participants", -1),

        (val_sub, ":guys_to_remove", 1),
        (try_begin),
            (eq, ":guys_to_remove", 0),
            (assign, ":break", -1),
        (try_end),
    (try_end),

    (assign, ":guy_won", "$g_tournament_player_team_won"),#not the guy who won

    #remove other guys
    (assign, ":break", 49),
    (try_for_range, ":unused", 0, ":guys_to_remove"),#find other guys and remove them
        (assign, ":score", -1),
        (assign, ":remove_slot", -1),
        (try_for_range, ":participants", 0, ":break"),#find other guys and remove them
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":participants"),
            (gt, ":guy", -1),
            (neq, ":guy_won", ":guy"),
            (store_character_level, ":level", ":guy"),
            (store_random_in_range, ":r", 0, 10),
            (val_add, ":level", ":r"),
            (gt, ":level", ":score"),
            (assign, ":score", ":level"),
            (assign, ":remove_slot", ":participants"),
        (try_end),
        (troop_set_slot,"trp_temp_array_olympia_c", ":remove_slot", -1),
    (try_end),

    (assign, reg23, "$g_tournament_num_participants_for_fight"),#count player victories
    (assign, reg21, "$g_tournament_cur_tier"),
    (assign, reg22, 0),
    (try_for_range, ":participants_3", 0, 49),
        (neg|troop_slot_eq,"trp_temp_array_olympia_c", ":participants_3", -1),
        (val_add, reg22, 1),
    (try_end),

    (try_begin),
        (eq, reg22, 0),
        (assign, "$g_tournament_bet_placed", 1),#has player won?
        (troop_set_slot, "trp_organiser", won_mule, "trp_player"),
        (jump_to_menu, "mnu_competition_won"),
    (else_try),
        (eq, "$g_tournament_bet_placed", 0),#player lost, its over
        (call_script, "script_get_random_winer"),
        (assign, "$g_tournament_player_team_won", reg0),
        (troop_set_slot, "trp_organiser", won_mule,reg0),
        (jump_to_menu, "mnu_competition_won"),
    (try_end),
    ],

    [
    ("leave",[],"Race!",[
        (assign, "$g_tournament_player_team_won", -1),
        (assign, "$g_tournament_bet_placed", 0),
        (modify_visitors_at_site, "scn_horse_race_arena_olympia"),
        (reset_visitors),
        (assign, "$temp4_1", 0),
        (assign, "$temp4", 0),
        (set_jump_mission, "mt_horse_racing"),

        (try_for_range, ":slot", 0, 49),
            (troop_get_slot,":guy", "trp_temp_array_olympia_c", ":slot"),
            (troop_set_slot, "trp_temp_array_olympia_a", ":slot", ":guy"),
        (try_end),

        (try_for_range, ":slot", 1, 8),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slot", -1),
        (try_end),

        (try_for_range, ":slots", 1, 8),
            (assign, ":score_to_beet", -1),
            (assign, ":opponent", -1),
            (assign, ":opponent_slot", -1),
            (try_for_range, ":participants", 0, 49),
                (troop_get_slot, ":guy", "trp_temp_array_olympia_a", ":participants"),
                (gt, ":guy", -1),
                (store_character_level, ":level", ":guy"),
                (store_random_in_range, ":r", 0, 10),
                (val_add, ":level", ":r"),
                (gt, ":level", ":score_to_beet"),
                (assign, ":opponent", ":guy"),
                (assign, ":opponent_slot", ":participants"),
            (try_end),
            (troop_set_slot, "trp_temp_array_olympia_b", ":slots", ":opponent"),
            (troop_set_slot, "trp_temp_array_olympia_a", ":opponent_slot", -1),
        (try_end),
        (troop_set_slot, "trp_temp_array_olympia_b", 0, "trp_player"),

        (try_for_range, ":entry", 8, 15),
            # (mission_tpl_entry_set_override_flags, "mt_horse_racing", ":entry", af_override_horse),
            (mission_tpl_entry_clear_override_items, "mt_horse_racing", ":entry"),
            (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_roman_poor1"),
            (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_caligea"),
            (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_mule"),
        (try_end),
        # (mission_tpl_entry_set_override_flags, "mt_horse_racing", 0, af_override_horse),#player
        (mission_tpl_entry_clear_override_items, "mt_horse_racing", 0),
        (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_roman_poor1"),
        (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_caligea"),
        (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_mule"),
        (set_jump_entry, 0),

        (try_for_range, ":entry", 8,15),
            (store_sub, ":slot", ":entry", 7),
            (troop_get_slot, ":opponent", "trp_temp_array_olympia_b", ":slot"),
            (set_visitor, ":entry", ":opponent"),
        (try_end),
        (set_visitors, 1, "trp_guest", 10),
        (set_visitors, 2, "trp_guest_female", 10),
        (set_visitors, 3, "trp_guest", 10),
        (set_visitors, 4, "trp_guest_female", 10),
        (set_visitors, 5, "trp_guest", 10),
        (set_visitors, 6, "trp_guest_female", 10),
        (set_visitors, 7, "trp_guest", 10),
        (set_visitors, 16, "trp_guest_female", 10),
        (set_visitors, 17, "trp_guest", 10),
        (try_for_range, ":entry", 28, 48),
          (store_random_in_range, ":r", 0, 2),
          (try_begin),
            (eq, ":r", 0),
            (set_visitors, ":entry", "trp_guest", 10),
          (else_try),
            (set_visitors, ":entry", "trp_guest_female", 10),
          (try_end),
        (try_end),
        (try_for_range, ":entry", 58, 76),
          (store_random_in_range, ":r", 0, 2),
          (try_begin),
            (eq, ":r", 0),
            (set_visitors, ":entry", "trp_guest", 10),
          (else_try),
            (set_visitors, ":entry", "trp_guest_female", 10),
          (try_end),
        (try_end),
#####visitors

    (jump_to_scene, "scn_horse_race_arena_olympia"),
    (assign, "$g_next_menu", "mnu_competition_mule"),
    (val_add, "$g_tournament_cur_tier", 1),
    (change_screen_mission),
      ]),
    ("leave",[],"Show remaining opponents.",[
    (assign, "$g_next_menu", "mnu_competition_mule"),
    (jump_to_menu, "mnu_olympia_remainging_opponents"),
      ]),

    ("leave",[],"Walk around.",[
  (modify_visitors_at_site, "scn_olympia"),
  (reset_visitors),
  (set_visitor, 2, "trp_roman_priest"),
  (set_visitor, 3, "trp_tavern_minstrel_4"),
  (set_visitor, 5, "trp_guest_female"),
  (set_visitors, 6, "trp_guest_female",3),
  (set_visitors, 7, "trp_guest",2),
  (set_visitors, 8, "trp_guest_female",2),
  (set_visitor, 9, "trp_guest"),
  (set_visitor, 10, "trp_guest_female"),
  (set_visitor, 11, "trp_guest_female"),
  (set_visitor, 12, "trp_guest"),
  (set_visitor, 13, "trp_guest"),
  (set_visitor, 14, "trp_guest_female"),
  (set_visitors, 15, "trp_guest",3),
  (set_visitors, 16, "trp_guest_female",3),
  (set_visitor, 17, "trp_guest_female"),
  (set_visitor, 18, "trp_guest"),
  (set_visitor, 19, "trp_guest"),
  (set_visitor, 20, "trp_guest_female"),
  (set_visitors, 21, "trp_guest_female",2),
  (set_visitor, 23, "trp_mercenary_swordsman"),

  (set_visitor, 24, "trp_athlet_1"),
  (set_visitor, 25, "trp_athlet_2"),
  (set_visitor, 26, "trp_athlet_3"),
  (set_visitor, 27, "trp_athlet_4"),

    (set_jump_entry, 40),
    #41-50 are gropies
    (try_for_range, ":entry", 41, 51),
        (set_visitor, ":entry", "trp_groupie"),
    (try_end),

    (store_current_hours, ":hours"),
    (troop_set_slot, "trp_organiser", rest_olympia, ":hours"),
    (troop_set_slot, "trp_organiser", olympia_auto_menu, "mnu_competition_mule"),
    (jump_to_menu, "mnu_auto_return_map"),

	(set_jump_mission, "mt_visit_olympia"),
    (jump_to_scene, "scn_olympia"),
    (set_passage_menu,"mnu_olympia"),
    (change_screen_mission),
      ]),

     ("leave",[],"Give up.",[
    (assign, "$g_next_menu", "mnu_competition_mule"),
    (jump_to_menu, "mnu_olympia_give_up"),
      ]),
    ]),
###############END

#generic remaining opponents for a competition
("olympia_remainging_opponents",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "The remaining opponents are:^{s21}",
  "none",[
    (str_clear, s21),
    (try_for_range, ":participants", 0, 49),
        (troop_get_slot, ":guy", "trp_temp_array_olympia_c", ":participants"),
        (gt, ":guy", -1),
        (str_store_troop_name, s22, ":guy"),
        (str_store_string, s21, "@{s21}^{s22}"),
    (try_end),
  ],[
    ("leave",[],"Go back.",[
      (jump_to_menu, "$g_next_menu"),
    ]),
]),
 ####END
#END OF THE GAMES
("olympia_over",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "The games are over! Here are the results:^^{s21}^^{s23}",
  "none",[
    (set_background_mesh, "mesh_pic_girls"),
    (str_clear, s21),
    (str_clear, s23),
    (try_for_range, ":slot", 0, 9),
        (troop_set_slot, "trp_temp_array_olympia_a", ":slot", -1),
    (try_end),
    (try_for_range, ":competition", won_horse, current_opponent_1),
        (troop_get_slot, ":winer", "trp_organiser", ":competition"),
        (assign, ":c", 0),
        (try_for_range, ":slot", 0, 9),
            (troop_slot_eq, "trp_temp_array_olympia_a", ":slot", ":winer"),
            (assign, ":c", 1),
        (try_end),
        (eq, ":c", 0),
        (assign, ":break", 9),
        (try_for_range, ":slot_2", 0, ":break"),
            (troop_slot_eq, "trp_temp_array_olympia_a", ":slot_2", -1),
            (troop_set_slot, "trp_temp_array_olympia_a", ":slot_2", ":winer"),
            (assign, ":break", -1),
        (try_end),
    (try_end),
    (try_for_range, ":slot_3", 0, 9),
        (troop_set_slot, "trp_temp_array_olympia_b", ":slot_3", 0),
    (try_end),

    (try_for_range, ":competition", won_horse, current_opponent_1),
        (troop_get_slot, ":winer", "trp_organiser", ":competition"),
        (str_store_troop_name, s1, ":winer"),
        (store_sub, ":name", ":competition", won_horse),
        (val_add, ":name", "str_won_horse"),
        (str_store_string, s2, ":name"),
        (str_store_string, s21, "@{s21}^{s1} has won {s2}."),

        (assign, ":break", 9),
        (assign, ":slot_found", 0),
        (try_for_range, ":slot_4", 0, ":break"),
            (troop_slot_eq, "trp_temp_array_olympia_a", ":slot_4", ":winer"),
            (assign, ":break", -1),
            (assign, ":slot_found", ":slot_4"),
        (try_end),
        (troop_get_slot, ":counter", "trp_temp_array_olympia_b", ":slot_found"),
        (val_add, ":counter", 1),
        (troop_set_slot, "trp_temp_array_olympia_b", ":slot_found", ":counter"),
    (try_end),
    (assign, ":total_winer", -1),
    (assign, ":score_to_beat", 0),
    (try_for_range, ":slot_5", 0, 9),
        (troop_get_slot, ":counter", "trp_temp_array_olympia_b", ":slot_5"),
        (gt, ":counter", ":score_to_beat"),
        (assign, ":score_to_beat",  ":counter"),
        (troop_get_slot, ":total_winer", "trp_temp_array_olympia_a", ":slot_5"),
    (try_end),
    (try_begin),
        (gt, ":total_winer", -1),
        (str_store_troop_name, s1, ":total_winer"),
        (str_store_string, s23, "@{s1} achieved most victories and wins the Olympic games"),
    (try_end),

    (try_begin),
        (eq, ":total_winer", "trp_player"),
        (troop_add_item, "trp_player", "itm_laurel_wreath", 0),
        (add_xp_as_reward, 5000),
        (call_script, "script_add_piety_culture_effect", 25, worships_jupiter),
        (call_script, "script_change_troop_renown", "trp_player", 100),
        (try_for_range, ":center", centers_begin, centers_end),
            (this_or_next|party_slot_eq, ":center", slot_center_province, p_balk_mac),
            (this_or_next|party_slot_eq, ":center", slot_center_province, p_balk_epir),
            (party_slot_eq, ":center", slot_center_province, p_balk_acha),
            (store_random_in_range, ":random", 40, 90),
            (call_script, "script_change_player_relation_with_center", ":center", ":random"),
        (try_end),
    (try_end),
  ],[
    ("leave",[],"Let's get drunk!",[
      (add_xp_as_reward, 5000),
      (change_screen_map),
    ]),
]),
 ####END
("nero_disappears",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "You spend the night together with Nero and his small group of followers. They are sons and daughters of noble origin, who left their families in pursuit of art and happiness. They all have in common that they dislike the society and its norms and rules. They feel misunderstood and different. Thus, they left society and escaped to this remote place.^^The evening processes. You enjoy Nero's art, the simple, but tasty food, the atmosphere and the conversations. Slowly the party comes to an end and you fall asleep. As you awake. Nero and his followers are gone. You only find a letter addressed to you. It reads:^^'Dear {playername}. I know I break my word by disappearing. But I have to. My wife betrayed me, my best friends in Rome betrayed me. Yet I cannot trust Romans anymore. I want to live and not to die. Hence I have to ensure that no Roman will ever see me again. Fear not that I might come back to claim your throne. I will not. I will leave the Roman world for ever. Me, my new wife Greecia and my Followers will go on a pilgrimage of arts. The destination of this journey is Elysium. Live long and may your reign be just. Nero will not forget you.'",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
  ],[
    ("leave",[],"Continue",[
      (str_store_troop_name_link, s13, "trp_kingdom_7_lord"),
      (add_quest_note_from_sreg, "qst_blank_quest_19", 14, "@You found {s13} hidding in a cave near mount Olymp. You decided to spare his life. He and his followers disappeared. There is no trace of them anymore.", 1),
      (add_xp_as_reward, 1000),
      (change_screen_map),
    ]),
]),

("neros_death",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "Nero's death!^^You cut off Nero's head. His head is then mounted on a spear and taken around Greece to be displayed to all major cities so that people know Nero is dead.",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
  ],[
    ("leave",[],"Continue",[
      (str_store_troop_name_link, s13, "trp_kingdom_7_lord"),
      (add_quest_note_from_sreg, "qst_blank_quest_19", 14, "@You found {s13} hidding in a cave near mount Olymp. You decided to kill him.", 1),
      (display_message, "@You found Nero's lyre!", color_good_news),
      (troop_add_item, "trp_player", "itm_lyre_rich", 0),
      (add_xp_as_reward, 2000),
      (change_screen_map),
    ]),
]),

("olympia",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "You reach Olympia. Every four years the olympic games are celebrated here. The next Olympic games will be held in {reg24} days. It is also a holy site, where the Greeks honor Zeus.",
  "none",
  [
    (set_background_mesh, "mesh_pic_orgie"),
    (assign, "$town_entered", 0),
	  (quest_get_slot,reg24, "qst_olympic_games", slot_quest_dont_give_again_remaining_days),
    (try_begin),
        (le, reg24, 0),
        (check_quest_active, "qst_olympic_games"),
        (call_script, "script_fill_participants_list"),
        (jump_to_menu, "mnu_olympic_games_opening"),
    (try_end),
	],[
    ("monasterio_recruitm",[
      (eq, 0, 1),
    ],"Enter the Temple of Zeus",[
      (set_passage_menu,"mnu_olympia"),
      (jump_to_scene, "scn_olympia_in"),
      (change_screen_mission),
    ],"Door to the Temple of Zeus"),

    ("monasterio_recruitm",[
      (party_slot_eq,"$g_encountered_party",slot_center_volunteer_troop_type,0),#can recruit
      (party_get_free_companions_capacity, ":free_capacity", "p_main_party"),
      (ge, ":free_capacity", 4),
    ],"Ask if somebody wants to join you.",[
      (store_random_in_range, ":rand", 0, 8),
      (try_begin),
        (eq, ":rand", 0),
        (jump_to_menu,"mnu_refugee_recruit_troops12"),
      (else_try),
        (eq, ":rand", 1),
        (jump_to_menu,"mnu_refugee_recruit_troops32"),
      (else_try),
        (eq, ":rand", 2),
        (jump_to_menu,"mnu_refugee_recruit_troops12"),
      (else_try),
        (eq, ":rand", 3),
        (jump_to_menu,"mnu_refugee_recruit_troops22"),
      (else_try),
        (eq, ":rand", 4),
        (jump_to_menu,"mnu_refugee_recruit_troops22"),
      (else_try),
        (eq, ":rand", 5),
        (jump_to_menu,"mnu_refugee_recruit_troops22"),
      (else_try),
        (eq, ":rand", 6),
        (jump_to_menu,"mnu_refugee_recruit_troops42"),
      (else_try),
        (eq, ":rand", 7),
        (jump_to_menu,"mnu_refugee_recruit_troops32"),
      (try_end),
    ]),

    ("answere_2",[],"Visit this place.",[
      (modify_visitors_at_site, "scn_olympia"),
      (reset_visitors),
      (set_visitor, 2, "trp_roman_priest"),
      (set_visitor, 3, "trp_tavern_minstrel_4"),
      (set_visitor, 4, "trp_organiser"),
      (set_visitor, 5, "trp_guest_female"),
      (set_visitors, 6, "trp_guest_female",3),
      (set_visitors, 7, "trp_guest",2),
      (set_visitors, 8, "trp_guest_female",2),
      (set_visitor, 9, "trp_guest"),
      (set_visitor, 10, "trp_guest_female"),
      (set_visitor, 11, "trp_guest_female"),
      (set_visitor, 12, "trp_guest"),
      (set_visitor, 13, "trp_guest"),
      (set_visitor, 14, "trp_guest_female"),
      (set_visitors, 15, "trp_guest",3),
      (set_visitors, 16, "trp_guest_female",3),
      (set_visitor, 17, "trp_guest_female"),
      (set_visitor, 18, "trp_guest"),
      (set_visitor, 19, "trp_guest"),
      (set_visitor, 20, "trp_guest_female"),
      (set_visitors, 21, "trp_guest_female",2),
      (set_visitor, 23, "trp_mercenary_swordsman"),

      (set_visitor, 24, "trp_athlet_1"),
      (set_visitor, 25, "trp_athlet_2"),
      (set_visitor, 26, "trp_athlet_3"),
      (set_visitor, 27, "trp_athlet_4"),
      (try_begin),
        (eq, "$town_entered", 0),
        (assign, "$town_entered", 1),
        (try_begin),
          (scene_slot_eq, "scn_olympia", slot_scene_visited, 0),
          (set_jump_entry, 0),
          (scene_set_slot, "scn_olympia", slot_scene_visited, 1),
        (else_try),
          (set_jump_entry, 40),
        (try_end),
      (try_end),
	    (set_jump_mission, "mt_visit_olympia"),
  		(jump_to_scene, "scn_olympia"),
      (set_passage_menu,"mnu_olympia"),
	    (change_screen_mission),
    ], "Leave."),
    ("camp_wait_hereho",[],"Wait here for some time.",
      [
        (assign,"$g_camp_mode", 1),
        (assign, "$g_infinite_camping", 0),
        (assign, "$g_player_icon_state", pis_camping),
        (rest_for_hours_interactive, 24 * 365, 5, 0), #rest while no attackable
        (change_screen_return),
      ]
    ),

    ("answere_1",[],"Leave.",
      [
	      (change_screen_map),
      ]
    ),
]),

("holy_lance_caves",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "The Sinahi is a mountainous and rough area. It gives additional challenges for fighting battles.",
  "none",[
    (set_background_mesh, "mesh_pic_cave"),
	],[
    ("answere_1",[],"Explore the place.",[
      (modify_visitors_at_site, "scn_holy_lance_cave"),
      (reset_visitors),
      (set_jump_mission, "mt_explore_secret_place"),
      (set_visitor, 0, "trp_player"),

      (jump_to_scene, "scn_holy_lance_cave"),
      (change_screen_mission),
    ], "Leave."),
    ("answere_3",[],"Leave.",[
	      (change_screen_map),
    ]),
]),

("mount_olymp",menu_text_color(0xFF000000)|mnf_disable_all_keys|mnf_scale_picture,
  "Ascending through the ancient forest, you emerge onto a hilltop, greeted by a panoramic view that unveils the majestic Mount Olympus."
  +" Bathed in the warm hues of the setting sun, the snow-capped peaks stand proudly against the sky, a beacon of mythical allure."
  +" The landscape below teems with ancient ruins and lush valleys, enticing you to embark on an adventure steeped in legend."
  +" With a surge of determination, you're drawn towards this iconic mountain, ready to unravel the mysteries that await on its storied slopes.",
  "none",[
    (set_background_mesh, "mesh_pic_cave"),
	],[
    ("answere_1",[],"Explore the place.",[
      (modify_visitors_at_site, "scn_mount_olymp"),
      (reset_visitors),
      (set_jump_mission, "mt_mount_olymp"),
      (set_visitor, 0, "trp_player"),

      (try_begin),
          (quest_slot_eq, "qst_amor_quest", slot_quest_current_state, 5),
          (assign, "$g_start_belligerent_drunk_fight", 0),
          (set_visitor, 1, "trp_wild_cat"),
      (try_end),

      (jump_to_scene, "scn_mount_olymp"),
      (change_screen_mission),
    ], "Leave."),
    ("answere_2",[
      (eq, 0, 1),
    ],"Enter the cave",[
      (modify_visitors_at_site, "scn_cave_olympia"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (assign, "$g_start_belligerent_drunk_fight", 0),
      (try_begin),
          (check_quest_active, "qst_neros_fate"),
          (quest_slot_eq, "qst_neros_fate", slot_quest_current_state, 3),
          (set_visitor, 1, "trp_kingdom_7_lord"),
          (set_visitor, 6,"trp_orgie_male1"),
          (set_visitor, 5,"trp_orgie_fem3"),
          (set_visitor, 3,"trp_orgie_fem2"),
          (set_visitor, 4,"trp_orgie_male1"),
      (try_end),

      (set_jump_mission, "mt_caves_of_olymp"),
      (jump_to_scene, "scn_cave_olympia"),
      (change_screen_mission),
      (set_passage_menu,"mnu_mount_olymp"),
    ],"Enter the cave"),
    ("answere_3",[],"Leave.",[
	      (change_screen_map),
    ]),
]),

("delphi",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You reach Delphi. Its the place where the Pythia, the high priestess of Apollo, predicts the future. Delphi is one of the most famous places in greece and many pilgrims come to know their fate.",
  "none",
  [
    (set_background_mesh, "mesh_pic_palast"),
    (try_begin),
        (party_slot_ge, "$g_encountered_party", slot_party_looted_left_days, 1),
        (jump_to_menu, "mnu_center_looted"),
    (try_end),
  ],[
    ("pillage_hofho",[
    ],"Raid the sanctuary.",[
      (jump_to_menu, "mnu_raid_delphi"),
    ]),
    ("monasterio_recruitm",[
      (party_slot_eq,"$g_encountered_party",slot_center_volunteer_troop_type,0),#can recruit
      (party_get_free_companions_capacity, ":free_capacity", "p_main_party"),
      (ge, ":free_capacity", 4),
    ],"Ask if somebody wants to join you.",[
      (store_random_in_range, ":rand", 0, 8),
      (try_begin),
        (eq, ":rand", 0),
        (jump_to_menu,"mnu_refugee_recruit_troops12"),
      (else_try),
        (eq, ":rand", 1),
        (jump_to_menu,"mnu_refugee_recruit_troops32"),
      (else_try),
        (eq, ":rand", 2),
        (jump_to_menu,"mnu_refugee_recruit_troops12"),
      (else_try),
        (eq, ":rand", 3),
        (jump_to_menu,"mnu_refugee_recruit_troops22"),
      (else_try),
        (eq, ":rand", 4),
        (jump_to_menu,"mnu_refugee_recruit_troops22"),
      (else_try),
        (eq, ":rand", 5),
        (jump_to_menu,"mnu_refugee_recruit_troops22"),
      (else_try),
        (eq, ":rand", 6),
        (jump_to_menu,"mnu_refugee_recruit_troops42"),
      (else_try),
        (eq, ":rand", 7),
        (jump_to_menu,"mnu_refugee_recruit_troops32"),
      (try_end),
    ]),
    ("answere_2",[],"Visit this place.",[
      (modify_visitors_at_site, "scn_delphi"),
      (reset_visitors),
      (set_visitor, 1, "trp_lykos"),
      (set_visitor, 2, "trp_guest"),
      (set_visitor, 3, "trp_guest_female"),
      (set_visitor, 4, "trp_guest"),
      (set_visitor, 5, "trp_guest_female"),
      (set_visitors, 6, "trp_guest_female",3),
      (set_visitors, 7, "trp_guest",2),
      (set_visitors, 8, "trp_guest_female",2),
      (set_visitor, 9, "trp_guest"),
      (set_visitor, 10, "trp_guest_female"),
      (set_visitor, 11, "trp_guest_female"),
      (set_visitor, 12, "trp_guest"),
      (set_visitor, 13, "trp_guest"),
      (set_visitor, 14, "trp_guest_female"),
      (set_visitors, 15, "trp_guest",3),
      (set_visitors, 16, "trp_guest_female",3),
      (set_visitor, 17, "trp_guest_female"),
      (set_visitor, 18, "trp_guest"),
      (set_visitor, 19, "trp_guest"),
      (set_visitor, 20, "trp_guest_female"),
      (set_jump_entry, 0),
      (set_jump_mission, "mt_visit_delphi"),
      (jump_to_scene, "scn_delphi"),
      (change_screen_mission),
    ]),
    ("doante",[
      (eq, "$can_sacrific", 1),
    ],"Make a donation to Delphi (1,000 denars).",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 1000),
        (troop_remove_gold, "trp_player", 1000),
        (display_message, "@The priets have sacrificed animals to appease the gods on your behalf."),
        (call_script, "script_change_player_honor",  1),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -2),
      (try_end),
      (assign, "$can_sacrific", 0),
      (change_screen_return),
    ]),
    ("doante",[
      (eq, "$can_sacrific", 1),
    ],"Make a medium donation to Delphi (5,000 denars).",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 5000),
        (troop_remove_gold, "trp_player", 5000),
        (display_message, "@The priets have sacrificed animals to appease the gods on your behalf."),
        (call_script, "script_change_player_honor",  4),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -6),
      (try_end),
      (assign, "$can_sacrific", 0),
      (change_screen_return),
    ]),
    ("doante",[
      (eq, "$can_sacrific", 1),
    ],"Make a huge donation to Delphi (10,000 denars).",[
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (ge, ":gold", 10000),
        (troop_remove_gold, "trp_player", 10000),
        (display_message, "@The priets have sacrificed animals to appease the gods on your behalf."),
        (call_script, "script_change_player_honor",  9),
      (else_try),
        (display_message, "str_not_enough_gold"),
        (call_script, "script_change_troop_renown", "trp_player", -10),
      (try_end),
      (assign, "$can_sacrific", 0),
      (change_screen_return),
    ]),
    ("camp_wait_hereho",[],"Wait here for some time.",[
      (assign,"$g_camp_mode", 1),
      (assign, "$g_infinite_camping", 0),
      (assign, "$g_player_icon_state", pis_camping),
      (rest_for_hours_interactive, 24 * 365, 5, 0), #rest while no attackable
      (change_screen_return),
    ]),
	  ("answere_1",[],"Leave.",[
	    (change_screen_map),
    ]),
]),

("pythia",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You follow Lykos. He brings you into a room. After a while a servant comes with a goat. Lykos sprinkles it with water. ^^{s30}",
  "none",
    [
	(store_random_in_range, ":r", 0, 100),
	(try_begin),
		(lt, ":r", 60),
		(str_store_string, s30, "@The goat twitches. A good omen, the oracle can be consulted today."),
		(assign, "$temp", 1),
	(else_try),
		(str_store_string, s30, "@The goat doesn't move. A bad omen, the oracle cannot be consulted today. Lykos says that you have to wait for one month till you can come back and try it again."),
		(assign, "$temp", 0),
	(try_end),

	],
    [
     ("answere_2",[(eq, "$temp", 0),],"Damn it.",
       [
	   (party_set_slot, "p_delphi", slot_donate_party, 7),
		(change_screen_map),
        ]
       ),
     ("answere_1",[(eq, "$temp", 1),],"Continue.",
       [
		(party_set_slot, "p_delphi", slot_donate_party, 7),
	    (jump_to_menu, "mnu_pythia_2"),
        ]
       ),
]),

("pythia_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The goat is sacrificed and burned on an altar. Then Lykos says:^^ \
	'Servant of the Delphian Apollo^\
	Go to the Castallian Spring^\
 Wash in its silvery eddies,^\
 And return cleansed to the temple.^\
 Guard your lips from offence^\
 To those who ask for oracles.^\
 Let the God's answer come^\
 Pure from all private fault'^^\
 Now you must wait several hours, while the Pythia baths in the Castalian Spring and drinks the holy waters of the Cassotis. ^^\
After some time, Lykos comes and informs you that the Pythia can now be consulted.",
  "none",[
    (set_background_mesh, "mesh_pic_pythia"),
	],[
    ("answere_1",[],"Visit the Pythia.",[
      (modify_visitors_at_site, "scn_pythia"),
      (reset_visitors),
      (set_visitor, 1, "trp_pythia"),
      (set_jump_entry, 0),
      (set_jump_mission, "mt_visit_pythia"),
      (jump_to_scene, "scn_pythia"),
      (change_screen_mission),
    ]),
]),
("pythia_leave",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You wake up in a flower meadow, not fare away from Delphi. You are naked and your clothes are scattered around you. You can't remember what has happend. You have a unbearable headache."
  +" You should visit her again, to find out what has happened.",
  "none",[
    (set_background_mesh, "mesh_pic_landschaft"),
	],[
    ("answere_1",[],"Damn it.",[
      (troop_set_slot, "trp_pythia", slot_lady_last_suitor, 1),
      (change_screen_map),
    ]),
]),

("hire_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Who will be successor?^^{s20}",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (store_random_in_range, ":r", 0, 2),
    (try_begin),
      (eq, ":r", 0),
      (str_store_string, s20, "@You hear about rumors which fly high through Rome who may be appointed as your successor. Some say that you won't nominate anyone, but that you are waiting for the birth of a son. Others say you may appoint one of your companions, other think that you may nominate one of your best generals."),
    (else_try),
      (str_store_string, s20, "@You have no heir and the rumors fly high whom you may assign. Some say that you won't nominate anyone, but that you are waiting for the birth of a son. The Roman nobility expect that you nominate one of their candidates, a true Roman noble."),
    (try_end),
	],[
    ("answere_1",[],"Continue.",[
      (try_begin),
        (ge, "$player_right_to_rule", 30),
        (display_message, "@People question your authority.", color_bad_news),
        (call_script, "script_change_player_right_to_rule", -5),
      (try_end),
	    (change_screen_map),
    ]),
]),

("refugee_recruit_troops12",0,
  "There are some widows and orphans interested in joining and trying to find a new life.",
  "none", [
    (set_background_mesh, "mesh_pic_payment"),
    (try_begin),
        (neg|troops_can_join, 4),
        (jump_to_menu, "mnu_refugee_recruit_troops22"),
    (try_end),
  ],[
    ("acept_themmo",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 20),
    ], "Hire them. (20 denars)",[
      (party_add_members,"p_main_party","trp_refugee",2),
      (party_add_members,"p_main_party","trp_peasant_woman",2),
      (troop_remove_gold,"trp_player", 20),
      #(assign, "$reclutar_puede_refuges", 1),
      (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
      (change_screen_map),
    ]),
    ("back_to_town_menumo",[],"Head back.",[
      #(assign, "$reclutar_puede_refuges", 1),
      (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
      (change_screen_map),
    ]),
]),

  ("refugee_recruit_troops22",0,
    "Nobody wants to join you.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
    ],
    [("back_to_town_menumo",[],"Head back.",
        [
          #(assign, "$reclutar_puede_refuges", 1),
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
           (change_screen_map),
      ]),
    ]
  ),

  ("refugee_recruit_troops32",0,
    "Some refugees volunteer to follow you.",
    "none", [
    (try_begin),
        (neg|troops_can_join, 5),
        (jump_to_menu, "mnu_refugee_recruit_troops22"),
    (try_end),
    (set_background_mesh, "mesh_pic_payment"),

    ],
    [("acept_themmo2",[ (store_troop_gold, ":gold", "trp_player"),
          (ge, ":gold", 60),], "Hire them. (60 denars)",
        [
          (party_add_members,"p_main_party","trp_refugee",5),
          (troop_remove_gold,"trp_player", 60),
          #(assign, "$reclutar_puede_refuges", 1),
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
          (change_screen_map),
      ]),
      ("back_to_town_menumo",[],"Head back.",
        [
          #(assign, "$reclutar_puede_refuges", 1),
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
          (change_screen_map),
      ]),
    ]
  ),

  ("refugee_recruit_troops42",0,
    "There is a large group of 15 women interested in joining you.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
    (try_begin),
        (neg|troops_can_join, 15),
        (jump_to_menu, "mnu_refugee_recruit_troops22"),
    (try_end),
    ],
    [("acept_themmo3",[(store_troop_gold, ":gold", "trp_player"),
          (ge, ":gold", 500),], "Hire them. (500 denars)",
        [
          (party_add_members,"p_main_party","trp_follower_woman",15),
          (troop_remove_gold,"trp_player", 500),
          #(assign, "$reclutar_puede_refuges", 1),
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
          (change_screen_map),
      ]),
      ("back_to_town_menumo",[],"Head back.",
        [
          #(assign, "$reclutar_puede_refuges", 1),
          (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,5),#5 days cooldown
           (change_screen_map),
      ]),
    ]
  ),

("ferry_encounter",0,
  "The ferry captain will carry you to the other side for {reg7} denars.",
  "none",
  [
    (set_background_mesh, "mesh_pic_ships"),
    (party_get_num_companions, "$current_dialog_cost", "p_main_party"),

    (try_begin),
        #VC-1803
        (check_quest_active, "qst_escort_merchant_caravan"),
        (quest_get_slot, ":quest_target_party", "qst_escort_merchant_caravan", slot_quest_target_party),
        (party_is_active, ":quest_target_party"),
        (eq, "$escort_merchant_caravan_mode", 0),
        (display_message, "@The trader you are escorting does not want to use a ferry.", color_bad_news),
        (change_screen_return),
      # (else_try),
      # #VC-2874
      # (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
      # (faction_slot_eq,  "$players_kingdom", slot_faction_marshall, "trp_player"),
      # (display_message, "@The ferry station is too small and can't transport a marshal and his whole army.", color_bad_news),
      # (change_screen_return),
    # (else_try),
      # (le, "$current_dialog_cost", 3),
      # (store_troop_gold, reg8, "trp_player"),
      # (ge, reg8, 1),
      # (troop_remove_gold, "trp_player", 1),

      # (try_begin),
        # (is_between, "$g_encountered_party", "p_ferry_1a", "p_ferry_1b"),
        # (store_add, ":target_ferry_station", "$g_encountered_party", 4),
      # (else_try),
        # (store_sub, ":target_ferry_station", "$g_encountered_party", 4),
      # (try_end),
      # (assign, "$travel_town", ":target_ferry_station"),
      # (party_get_slot, ":target_ferry_port", ":target_ferry_station", slot_party_port_party),
      # (enable_party, "p_transporter"),
      # (party_get_slot, ":curr_ferry_port", "$g_encountered_party", slot_party_port_party),
      # (party_get_position, pos1, ":curr_ferry_port"),
      # #(party_get_position, pos1, "p_main_party"),
      # #(call_script, "script_get_next_water_position", 1),
      # (party_set_slot, "p_transporter", slot_party_on_water, 1),
      # (party_set_flags, "p_transporter", pf_is_ship, 1),
      # (party_set_position, "p_transporter", pos1),
      # (party_get_position, pos2, ":target_ferry_port"),
      # (party_set_ai_behavior, "p_transporter", ai_bhvr_travel_to_point),
      # (party_set_ai_target_position, "p_transporter", pos2),

      # # SEA TRAVEL
      # (assign, "$auto_menu", -1),	# Have to create menu ...
      # (rest_for_hours, 10 * 24, 1, 0),
      # (set_camera_follow_party, "p_transporter"),
      # (assign, "$g_player_is_captive", 1),
      # (change_screen_return),
    (else_try),
        (assign, reg7, "$current_dialog_cost"),
        #(set_background_mesh,"mesh_pic_extra_barco"),
    (try_end),
  ],[
    ("continue",[
      (store_troop_gold, reg8, "trp_player"),
      (ge, reg8, "$current_dialog_cost"),
    ],"Continue.",
    [
      (troop_remove_gold, "trp_player", "$current_dialog_cost"),
      (change_screen_return),
      (try_begin),
          (is_between, "$g_encountered_party", "p_ferry_1a", "p_ferry_1b"),
          (store_add, ":target_ferry_station", "$g_encountered_party", 5),
      (else_try),
          (store_sub, ":target_ferry_station", "$g_encountered_party", 5),
      (try_end),
      (assign, "$travel_town", ":target_ferry_station"),
      (party_get_slot, ":target_ferry_port", ":target_ferry_station", slot_party_port_party),
      (enable_party, "p_transporter"),
      (party_get_slot, ":curr_ferry_port", "$g_encountered_party", slot_party_port_party),
      (party_get_position, pos1, ":curr_ferry_port"),
      (party_set_slot, "p_transporter", slot_party_on_water, 1),
      (party_set_flags, "p_transporter", pf_is_ship, 1),
      (party_set_position, "p_transporter", pos1),
      (party_get_position, pos2, ":target_ferry_port"),
      (party_set_ai_behavior, "p_transporter", ai_bhvr_travel_to_point),
      (party_set_ai_target_position, "p_transporter", pos2),

      # SEA TRAVEL
      (assign, "$auto_menu", -1),	# Have to create menu ...
      (rest_for_hours, 10 * 24, 1, 0),
      (set_camera_follow_party, "p_transporter"),
      (assign, "$g_player_is_captive", 1),
      (change_screen_return),
    ]),

    ("back",[],"Back.",
      [
        (change_screen_return),
    ]),
]),

("town_port",0,
  "You visit the port of {s1}."
  +" While you look around you feel the strong wind from the ocean pulling on your clothes."
  +" Many ships are anchored here and you notice that crews are already loading them with native goods, while a group of men is still discharging their cargo."
  +"^^{s22}",
  "none",[
	  (set_background_mesh,"mesh_pic_harbor"),
    (str_store_party_name,s1,"$current_town"),
    (try_begin),
      (eq, "$players_ship", -1),
      (str_store_string, s22, "@You don't own a ship."),
    (else_try),
      (eq, "$players_ship", 0),
      (str_store_string, s22, "@Your ship is currently in no town."),
    (else_try),
      (str_store_party_name, s23, "$players_ship"),
      (str_store_string, s22, "@Your ship is currently in {s23}."),
    (try_end),
    (play_sound,"snd_ambient_coast_loop"),
  ],[
    ("buy_ships",[#
    ], "Travel to another port",[
      (start_presentation, "prsnt_travel_port"),
    ]),
    ("buy_ships",[#(party_slot_eq,"$current_town",slot_party_type, spt_town),
      (party_slot_eq,"$current_town",slot_town_port, 1),
      (eq, "$players_ship", -1),
    ], "Buy a ship (40000 denars)",[
    (try_begin),
        (store_troop_gold,":money","trp_player"),
        (gt,":money",39999),
        (troop_remove_gold,"trp_player",40000),
        (assign, "$players_ship", "$current_town"),
        (display_message,"@You now own a ship and can disembark from this town."),
      (else_try),
        (display_message,"str_not_enough_gold"),
      (try_end),
    ]),
    ("sail_from_port",
    [], "Set sail from port.(Minimum crew 15 men)",[
      (try_begin),
        (party_get_num_companions, ":num", "p_main_party"),
        (ge, ":num", 15),
        (eq, "$players_ship", "$current_town"),
        (party_get_slot, ":curr_port", "$current_town", slot_party_port_party),
        (party_get_position, pos2, ":curr_port"),
        (party_set_position, "p_main_party", pos2),
		# (try_begin),
			# (gt, ":num", 200),
			# (store_sub, ":cost", ":num", 200),
			# (val_mul, ":cost", 20),
			# (store_troop_gold, ":gold", "trp_player"),
			# (try_begin),
				# (ge, ":gold", ":cost"),
				# (troop_remove_gold, "trp_player", ":cost"),
			# (else_try),
				# (display_message,"@Because your army is so huge, you must hire additional ships. But you don't have enough money to buy a ship. (costs: {reg1} denars)", color_bad_news),
				# (jump_to_menu, "mnu_town_port"),
			# (try_end),
			# (assign, reg1, ":cost"),
			# (display_message,"@Because your army is so huge, you had to hire additional ships, costs: {reg1} denars.", color_bad_news),
		# (try_end),
        (call_script, "script_switch_to_water_consequences"),
        (change_screen_map),
      (else_try),
        (display_message,"@You don't own a ship or your crew exceeds the boundaries. You need hire a ship."),
      (try_end),
      (stop_all_sounds,0),
    ]),
    ("back_to_town_menu",[],"Go back.",[
      (jump_to_menu,"mnu_town"),
	    (stop_all_sounds,0),
    ]),
]),

("jetty_encounter",0,
  "You encounter a small landing point. You see some ships in the water.",
   "none",[
    (set_background_mesh, "mesh_pic_ships"),
  ],[
    ("back",[],"Leave.",[
      (change_screen_return),
    ]),
]),

("port_encounter",0,
  "You encounter the port of {s2}. {s3}",
  "none",[
    (party_get_slot, ":curr_town", "$g_encountered_party", slot_party_port_party),
    (str_store_party_name, s2, ":curr_town"),
    (assign, "$temp", 0),
    #(party_get_slot, reg7, ":curr_town", slot_party_1_ship_type),
    (try_begin),
      #town is looted
      (party_slot_ge, ":curr_town", slot_party_looted_left_days, 1),
      (jump_to_menu, "mnu_center_looted"),
    (else_try),
      #town is enemy
      (lt, "$g_encountered_party_relation", 0),
      # (assign, "$auto_port_attack", ":curr_town"),
      # (assign, "$auto_enter_town", ":curr_town"),
      (str_store_string, s3, "@You can't enter the port because you are not welcome in this town and the harbor is protected with heavy artillery. An attack would be suicidal."),
      (assign, "$temp", 1),
    (else_try),
      #all ok - enter port
      (party_get_position, pos2, ":curr_town"),
      (party_set_position, "p_main_party", pos2),
      (call_script, "script_switch_to_land_consequences"),
      (assign, "$auto_enter_town", ":curr_town"),
      (assign, "$players_ship", ":curr_town"),
      (change_screen_return),
    (try_end),
    (set_background_mesh, "mesh_pic_harbor"),
  ],[
  ("continue",[],"Leave.",[
    (change_screen_return),
  ]),
]),

  (
    "landing_point_encounter",0,
    "Do you wish to disembark?",
    "none",
    [

      (try_begin),
        (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
        (faction_slot_eq,  "$players_kingdom", slot_faction_marshall, "trp_player"),
        (neg|faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_default),
        (neg|faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_feast),
        (jump_to_menu, "mnu_landing_point_encounter_as_marshal"),
      (else_try),
        (party_slot_eq, "p_main_party", slot_party_on_water, 1),
        (party_get_position, pos1, "p_landing_point"),
        (call_script, "script_get_next_land_position", 1),
        (set_spawn_radius, 0),
        (call_script, "script_spawn_party", "p_main_party", "pt_landet_ships"),
        (assign, ":landet_ship_party", reg0),

        (str_store_troop_name, s1, "trp_player"),
        (party_set_name, ":landet_ship_party", "@{s1}'s Ships"),
        (party_set_slot, ":landet_ship_party", slot_party_type, spt_ship),
        (party_set_position, ":landet_ship_party", pos2),
       # (call_script, "script_give_player_ships_from_party_to_party", "p_main_party", ":landet_ship_party"),
        (party_set_position, "p_main_party", pos2),
        (call_script, "script_switch_to_land_consequences"),
        (assign, "$players_ship", 0),
        (change_screen_return),
      (else_try),
        (set_background_mesh, "mesh_pic_deserters"),
      (try_end),

    ],
    [
      ("disembark_no", [], "No.",
        [
          (change_screen_return),
      ]),
    ]
  ),

  (
    "landet_ships_encounter",0,
    "Do you wish to embark?",
    "none",
    [
     # (set_background_mesh, "mesh_hacerbarco"),
      (try_begin),
         (party_slot_eq, "p_main_party", slot_party_on_water, 1),
        # (try_begin),
          # (party_slot_ge, "$g_encountered_party", slot_party_1_ship_type, 1),
          # (call_script, "script_condition_check_merging_ships", "$g_encountered_party"),
          # (try_begin),
            # # skill to low
            # (eq, reg0, 1),
            # (display_message, "@Can't merge both fleets because your sea-king skill isn't high enough."),
          # (else_try),
            # # more than 7 ships (player shouldn't see this in theory)
            # (eq, reg0, 2),
            # (display_message, "@Can't merge both fleets because this would exceed the fleet limit of seven ships."),
          # (else_try),
            # # merging possible
            # (call_script, "script_merge_ships_from_party_to_party", "$g_encountered_party", "p_main_party"),
            # (disable_party, "$g_encountered_party"),
            # (display_message, "@Fleets merged."),
          # (try_end),
        # (try_end),
         (change_screen_return),
      (else_try),
        (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
        (faction_slot_eq,  "$players_kingdom", slot_faction_marshall, "trp_player"),
        (neg|faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_default),
        (neg|faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_feast),
        (jump_to_menu, "mnu_landet_ships_encounter_as_marshal"),
      (else_try),
        # (call_script, "script_cf_crew_fit_in_ships", "$g_encountered_party"),
        # (call_script, "script_give_player_ships_from_party_to_party", "$g_encountered_party", "p_main_party"),
        (party_get_position, pos1, "$g_encountered_party"),
        (call_script, "script_get_next_water_position", 1, "$g_encountered_party"),
        (party_set_position, "p_main_party", pos2),
        (call_script, "script_switch_to_water_consequences"),
        (disable_party, "$g_encountered_party"),
        (change_screen_return),
      (else_try),
        (display_message, "@Can't set sail"),
        (change_screen_return),
      (try_end),

    ],
    [
      ("reembark_no", [], "No.",
        [(change_screen_return),
      ]),
    ]
  ),
   (
    "landing_point_encounter_as_marshal",0,
    "You are currently marshal. You attempt to disembark. {s1} {s2}^^Do you want to disembark now or wait?",
    "none",
    [
     # (set_background_mesh, "mesh_pic_fleet"),

      (str_clear, s1),
      (str_clear, s2),
      (assign, ":can_join", 0),
      (assign, ":cant_join", 0),
      (try_for_parties, ":cur_party"),
        (party_slot_eq, ":cur_party", slot_party_type, spt_kingdom_hero_party),
        (party_is_active, ":cur_party"),
        (store_faction_of_party, ":cur_party_faction", ":cur_party"),
        (eq, ":cur_party_faction", "$players_kingdom"),
        (get_party_ai_object, ":cur_party_ai_object", ":cur_party"),
        (eq, ":cur_party_ai_object", "p_main_party"),
        (party_slot_eq, ":cur_party", slot_party_on_water, 1),
        (store_distance_to_party_from_party, ":distance", "p_main_party", ":cur_party"),
        (try_begin),
          (le, ":distance", 5),
          (val_add, ":can_join", 1),
        (else_try),
          (val_add, ":cant_join", 1),
        (try_end),
      (try_end),

      (try_begin),
        (eq, ":can_join", 1),
        (str_store_string, s1, "@One commander can disembark here with you."),
      (else_try),
        (gt, ":can_join", 0),
        (assign, reg1, ":can_join"),
        (str_store_string, s1, "@{reg1} commanders can disembark here with you."),
      (try_end),
      (try_begin),
        (eq, ":can_join", 1),
        (str_store_string, s2, "@One commander will lose track of you. He must disembark at the next port and then come find you."),
      (else_try),
        (gt, ":cant_join", 0),
        (assign, reg1, ":cant_join"),
        (str_store_string, s2, "@{reg1} commanders will lose track of you. They must disembark at the next port and then come find you."),
      (try_end),

    ],
    [
      ("disembark_yeslp", [], "Disembark.",
        [
          (try_begin),
            (party_slot_eq, "p_main_party", slot_party_on_water, 1),
            (party_get_position, pos1, "p_landing_point"),
            (call_script, "script_get_next_land_position", 1),
            (set_spawn_radius, 0),
            (call_script, "script_spawn_party", "p_main_party", "pt_landet_ships"),
            (assign, ":landet_ship_party", reg0),

            (str_store_troop_name, s1, "trp_player"),
            (party_set_name, ":landet_ship_party", "@{s1}'s Ships"),
            (party_set_slot, ":landet_ship_party", slot_party_type, spt_ship),
            (party_set_position, ":landet_ship_party", pos2),
           # (call_script, "script_give_player_ships_from_party_to_party", "p_main_party", ":landet_ship_party"),
            (party_set_position, "p_main_party", pos2),
            (call_script, "script_switch_to_land_consequences"),
            (assign, "$players_ship", 0),
            (try_for_parties, ":cur_party"),
              (party_slot_eq, ":cur_party", slot_party_type, spt_kingdom_hero_party),
              (party_is_active, ":cur_party"),
              (store_faction_of_party, ":cur_party_faction", ":cur_party"),
              (eq, ":cur_party_faction", "$players_kingdom"),
              (get_party_ai_object, ":cur_party_ai_object", ":cur_party"),
              (eq, ":cur_party_ai_object", "p_main_party"),
              (party_slot_eq, ":cur_party", slot_party_on_water, 1),
              (store_distance_to_party_from_party, ":distance", "p_main_party", ":cur_party"),
              (le, ":distance", 5),
              (party_set_position, ":cur_party", pos2),
              (party_set_slot, ":cur_party", slot_party_on_water, 0),
              (party_set_flags, ":cur_party", pf_is_ship, 0),
              (call_script, "script_update_party_icon", ":cur_party"),
            (try_end),
          (try_end),
          (change_screen_return),
      ]),

      ("disembark_nolp", [], "Wait.",
        [
          (change_screen_return),
      ]),
    ]
  ),

  (
    "landet_ships_encounter_as_marshal",0,
    "You are currently marshal. You attempt to embark. {s1} {s2}^^Do you want to embark now or wait?",
    "none",
    [
      #(set_background_mesh, "mesh_pic_deserters"),

      (str_clear, s1),
      (str_clear, s2),
      (assign, ":can_join", 0),
      (assign, ":cant_join", 0),
      (try_for_parties, ":cur_party"),
        (party_slot_eq, ":cur_party", slot_party_type, spt_kingdom_hero_party),
        (party_is_active, ":cur_party"),
        (store_faction_of_party, ":cur_party_faction", ":cur_party"),
        (eq, ":cur_party_faction", "$players_kingdom"),
        (get_party_ai_object, ":cur_party_ai_object", ":cur_party"),
        (eq, ":cur_party_ai_object", "p_main_party"),
        (party_slot_eq, ":cur_party", slot_party_on_water, 0),
        (store_distance_to_party_from_party, ":distance", "p_main_party", ":cur_party"),
        (try_begin),
          (le, ":distance", 5),
          (val_add, ":can_join", 1),
        (else_try),
          (val_add, ":cant_join", 1),
        (try_end),
      (try_end),

      (try_begin),
        (eq, ":can_join", 1),
        (str_store_string, s1, "@One commander can embark here with you."),
      (else_try),
        (gt, ":can_join", 0),
        (assign, reg1, ":can_join"),
        (str_store_string, s1, "@{reg1} commanders can embark here with you."),
      (try_end),
      (try_begin),
        (eq, ":can_join", 1),
        (str_store_string, s2, "@One commander will lose track of you. He must embark at the next port and then come find you."),
      (else_try),
        (gt, ":cant_join", 0),
        (assign, reg1, ":cant_join"),
        (str_store_string, s2, "@{reg1} commanders will lose track of you. They must embark at the next port and then come find you."),
      (try_end),

    ],
    [
      ("reembark_yesls", [], "Embark.",
        [
          (try_begin),
           # (call_script, "script_cf_crew_fit_in_ships", "$g_encountered_party"),
           # (call_script, "script_give_player_ships_from_party_to_party", "$g_encountered_party", "p_main_party"),
            (party_get_position, pos1, "$g_encountered_party"),
            (call_script, "script_get_next_water_position", 1, "$g_encountered_party"),
            (party_set_position, "p_main_party", pos2),
            (call_script, "script_switch_to_water_consequences"),
            (disable_party, "$g_encountered_party"),
            (try_for_parties, ":cur_party"),
              (party_slot_eq, ":cur_party", slot_party_type, spt_kingdom_hero_party),
              (party_is_active, ":cur_party"),
              (store_faction_of_party, ":cur_party_faction", ":cur_party"),
              (eq, ":cur_party_faction", "$players_kingdom"),
              (get_party_ai_object, ":cur_party_ai_object", ":cur_party"),
              (eq, ":cur_party_ai_object", "p_main_party"),
              (party_slot_eq, ":cur_party", slot_party_on_water, 0),
              (store_distance_to_party_from_party, ":distance", "p_main_party", ":cur_party"),
              (le, ":distance", 5),
              (party_set_position, ":cur_party", pos2),
              (party_set_slot, ":cur_party", slot_party_on_water, 1),
              (party_set_flags, ":cur_party", pf_is_ship, 1),
              (call_script, "script_update_party_icon", ":cur_party"),
            (try_end),
          (else_try),
            (display_message, "@Can't set sail"),
          (try_end),
          (change_screen_return),
      ]),
      ("reembark_nols", [], "Wait.",
        [(change_screen_return),
      ]),
    ]
  ),
("start_sea_travel",0,
  "You are starting a sea travel.",
  "none",[
    (set_camera_follow_party, "p_transporter"),
    (assign, "$g_player_is_captive", 1),
    #(call_script, "script_stay_captive_for_hours", 10 * 24),
    (rest_for_hours, 10 * 24, 4, 0),
    (assign,"$auto_menu","mnu_auto_return"),
    (change_screen_return),
  ],[
    ("continue",[],"Continue.",[
      (change_screen_map),
    ]),
]),
###location based events
("event_alesia",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Alesia^^Little in the Gallo-Roman town of Alesia points to the heroic events that took place here. In his Gaul campaign, Julius Caesar's forces were greatly outnumbered by the Gaul barbarians."
  +" He chased the army of their leader, King Vercingetorix, to take shelter behind this town's walls. Before the siege could finish, though, word came that an even bigger Gaul relief army was making its way to help Vercingetorix."
  +" Caesar would be doomed to face them both. He had to retreat, but did not. Instead, his army built a second set of walls all around the city. Caesar besieged Vercingetorix and the relief force besieged him."
  +" Wave after wave of different battles took place in this strange setup, and in the end the relief army ran. King Vercingetorix was paraded through Rome in Caesar's triumph, then executed."
  +" Caesar earned fame and undying loyalty of his troops, which he later used in a civil war against Rome, ending the Republic and almost turning it into an Empire.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
  ],[
    ("choice_11_msgnor",[],"Aut Caesar aut Nihil!",[
      (add_xp_as_reward, 100),
      (display_message, "@You are inspired by the great Caesar's victories. Your own will surpass his!"),
      (troop_raise_skill, "trp_player", "skl_tactics", 1),
      (change_screen_return, 0),
    ]),
    ("choice_11_msgnor",[],"The Republic would have been better. ",[
      (add_xp_as_reward, 100),
      (call_script, "script_change_player_honor", 5),
      (str_store_string, s1, "@Caesar's successes are undeniable, but he did kill the Republic. You spend some time pondering how history would have unfolded if powerful Romans could resolve their conflicts in elections, without repeated civil wars."),
      (assign, "$temp", "mesh_pic_senatus"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("event_dova",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Cliffs of Dover^^As you entered Britannia by boat across the sea, you remember being greeted to the sight of great cliffs rising from the water, their rocks white as snow. Now you find yourself at the top of these cliffs and enjoy the sight."
  +" You can make out the opposite shore from where you stand, the mainland with roads leading all the way back to Rome. Below you flocks of birds go about their business and you observe them, towering over the world, like a god, with sea breeze blowing your hair."
  +"^^You think, this is a marvelous place for a temple.",
  "none",[
    (set_background_mesh, "mesh_pic_cliffs_dover"),
  ],[
    ("choice_11_msgnor",[
      (troop_slot_ge, "trp_player", slot_troop_religion, worships_baduhenna),
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 100000),
      (troop_get_slot, ":god", "trp_player", slot_troop_religion),
      (store_add, ":s", "str_gods_begin", ":god"),
      (str_store_string, s33, ":s"),
    ],"Order to build a large temple for {s33} (cost: 100,000 denars)",[
      (add_xp_as_reward, 100),
      (call_script, "script_add_piety", 20, 1),
      (call_script, "script_change_player_relation_with_center", "p_castle_23", 50),
      (call_script, "script_change_troop_renown", "trp_player", 70),
      (call_script, "script_change_player_honor", 15),
      (troop_remove_gold, "trp_player", 100000),
      (str_store_string, s1, "@You order a great temple for {s33} erected over the cliffs. The project is expensive, but stories of its awe-inspiring location spread, drawing piligrims from across the Empire."),
      (assign, "$temp", "mesh_pic_building_project"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_11_msgnor",[
      (troop_slot_ge, "trp_player", slot_troop_religion, worships_baduhenna),
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 20000),
      (troop_get_slot, ":god", "trp_player", slot_troop_religion),
      (store_add, ":s", "str_gods_begin", ":god"),
      (str_store_string, s33, ":s"),
    ],"Build a small shrine for {s33} (cost: 20,000 denars)",[
      (add_xp_as_reward, 100),
      (call_script, "script_add_piety", 10, 1),
      (call_script, "script_change_player_relation_with_center", "p_castle_23", 10),
      (call_script, "script_change_troop_renown", "trp_player", 15),
      (call_script, "script_change_player_honor", 4),
      (troop_remove_gold, "trp_player", 20000),
      (str_store_string, s1, "@You order a modest shrine for {s33} erected over the cliffs. After the project is complete, stories of its awe-inspiring location spread, drawing piligrims from across the Empire."),
      (assign, "$temp", "mesh_pic_building_project"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_11_msgnor",[],"Just enjoy the view",[
      (add_xp_as_reward, 100),
      (call_script, "script_change_player_party_morale", 25),
      (str_store_string, s1, "@It's a beautiful place, but you have other things to attend to. At least the troops enjoyed a brief rest."),
      (assign, "$temp", "mesh_pic_cliffs_dover"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("event_rubicon",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Rubicon^^Near Ariminum runs the famous Rubicon river. Until Augustus abolished the Cisalipine Gaul province, this was the boundry of civilized Italia, into which no campaigning troops were allowed to cross."
  +" Julius Caesar famously did exactly that. Faced with criminal prosecution in Rome and with his commander mandate running out, he took his loyal legions on what can only be described as an insane gamble into Italia,"
  +" basically making war on all of Rome. But he won, and is now worshipped. Fortuna audaces iuvat -- Fortune favors the bold.",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
  ],[
    ("choice_11_msgnor",[],"I want to be like him.",[
      (add_xp_as_reward, 100),
      (display_message, "@You offer a prayer, asking for the courage and leadership of your ancestors."),
      (troop_raise_skill, "trp_player", "skl_leadership", 1),
      (change_screen_map),
    ]),
    ("choice_11_msgnor",[],"Caesar was a traitor.",[
      (add_xp_as_reward, 100),
      (display_message, "@No matter how great a man, criminal deeds are inhexcusable. You resolve to achieve your goals honorably."),
      (call_script, "script_change_player_honor", 2),
      (change_screen_map),
    ]),
]),
("event_famous_battle",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s29}^^{s28}^{s27}^{s26}",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
    (store_add, ":title", "str_great_battles1_title", "$temp3"),
    (store_add, ":intro", "str_great_battles1_intro", "$temp3"),
    (store_add, ":body", "str_great_battles1_body", "$temp3"),
    (store_add, ":end", "str_great_battles1_ending", "$temp3"),
    (str_store_string, s29, ":title"),
    (str_store_string, s28, ":intro"),
    (str_store_string, s27, ":body"),
    (str_store_string, s26, ":end"),
  ],[
    ("choice_event_famous_battle",[],"Interesting.",[
      (add_xp_as_reward, 100),
      (try_begin),
        (eq, "$temp3", 1),
        (display_message, "@Roma invicta! The memories of the victory inspire your soldiers.", color_good_news),
        (call_script, "script_change_player_party_morale", 25),
      (else_try),
        (store_random_in_range, ":r", 0, 10),
        (le, ":r", 4),
        (display_message, "@Such a shameful defeat of a Roman army shall never happen again."),
        (display_message, "@Your tactic skill increases.", color_good_news),
        (troop_raise_skill, "trp_player", "skl_tactics", 1),
      (try_end),
      (change_screen_map),
    ]),
]),
("event_pillars_of_hercules",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Pillars of Hercules^^Two mountains flanking the narrow straight, which connects Mare Nostrum to the great ocean beyond, are called the Pillars of Hercules."
  +" The great hero is believed to have smashed this straight right through the mountains with his superhuman strength. It may be doubted that even a demi-god like Hercules could have done such a feat, but there is no denying that"
  +" Mons Calpe and her sister to the south now frame the gateway to the great blue unknown.^^When the fleet approaches it, your navigator reminds you of dangers that lie beyond. Waves and wind are often stronger than in the inner sea,"
  +" the water is colder and sometimes a different color. Those who can brave sailing here can make their way to Lusitania, western Gaul, and all the way to Britannia. But the journey is fraught with danger and seldom made."
  +"^^A plaque is engraved in a small shrine at the mouth of the straight, stating eloquently:^^'Ne plus ultra' - Nothing further beyond.^^Maybe this plaque lies. Somewhere out there beyond the Pillars is rumored to be the lost island of Atlantis,"
  +" waiting for an explorer brave enough to find it.",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
  ],[
    ("choice_event_famous_battle",[],"Someday it will be found.",[
      (add_xp_as_reward, 100),
      (change_screen_map),
    ]),
]),

###################################################################################################################
### normal random events ##########################################################################################
###################################################################################################################
("event_01_desert",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Endless sand^^The arid wasteland with an occasional patch of dry grass stretches as far as the eye can see, occasionally turning into sand dunes that shift and move at the will of the winds. An anomaly is easy to see off in the distance, since it is made of the biggest objects in sight by far. You suspect a mirage at first, but approach it to investigate.^^The objects are saddle bags, barrels, baskets and bones, partially buried in the shifting sands. It looks like they have been here for a long time, weathered by the harsh environment.^^A soldier is sent to check what's left of the caravan. He pulls a saddle bag, that's stuck in a dune at his chest level. Feeling resistance, he pulls harder, and suddenly the sands give way. The soldier stumbles, falling on his back, and the old saddle bags, complete with the polished skeleton of a draft animal falls on top of him, with the animal's skull bouncing off his helmet before coming to rest face to face with him, dead empty eye sockets looking into his.^^The startled soldier gasps, then hears one of his wiseass brothers in arms crack: 'Hey, Centurion Donkeyskull, quit making out with your girlfriend there.'^^The army laughs as the story gets conveyed up along the length of the column. Sounds like the soldier just got a new nickname.^You search what's left of the caravan and bury the bodies according to local customs to keep the gods happy. The caravan wreck is so old that little of value is left, but the men's spirits are lifted slightly.",
  "none",[
      (set_background_mesh, "mesh_pic_desert"),
  ],[
    ("choice_11_msgnor",[],"Continue.",[
      (add_xp_as_reward, 50),
      (troop_add_gold, "trp_player", 100),
      (change_screen_return, 0),
    ]),
]),
("event_02_desert",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Two-headed scorpion^^There is precious little vegetation in this land and even less wildlife, so as you notice movement, you pay attention. At first, it looks like a regular little desert critter,"
  +" but on a closer look it becomes clear the scorpion has two heads. One of them appears to be looking at you with its black beady eyes no matter how the animal turns. Weird.",
  "none",[
    (set_background_mesh, "mesh_pic_desert"),
  ],[
    ("choice_11_msgnor",[],"Ignore it.",[
      (change_screen_return, 0),
    ]),
    ("choice_11_msgnor",[],"Kill it.",[
      (add_xp_as_reward, 125),
      (call_script, "script_change_player_party_morale", -10),
      (str_store_string, s1, "@You swiftly crush the scorpion and move on, but soon murmurs spreads among your men. Scorpions turn out to be associated with a diety in these lands, and a vengeful one at that. In foreign lands, foreign gods are believed to have the power, so the implications are not good."),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_11_msgnor",[],"Pick it up.",[
      (add_xp_as_reward, 250),
      (troop_raise_attribute, "trp_player", ca_strength, -1),
      (str_store_string, s1, "@As you reach out the take the curious creature, it strikes with its tail, catching you just beyond the glove, and scurries away. The sting burns, then numbs. Over the coming days you mostly recover, but some especially strainous moves remain painful to execute."),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("event_01_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s4}",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),

    (str_clear, s4),
    (store_random_in_range, ":random", 0, 9),
    (try_begin),
      (le, ":random", 5), #positive
      (store_random_in_range, ":active_npc", "trp_kingdom_1_lord", kingdom_ladies_begin),
      (neg|troop_slot_ge, ":active_npc", slot_troop_occupation, dplmc_slto_exile),
      (call_script, "script_troop_get_player_relation",  ":active_npc"),
      (assign, ":relation", reg0),
      #                       (troop_get_slot, ":relation", ":active_npc", slot_troop_player_relation),
      (gt, ":relation", 15), #good relation = send gift

      (str_store_troop_name, s12, ":active_npc"),
      (str_store_string, s4, "@Friendly message^^A messenger sent from {s12} arrives and gives you a present of silver and jewelry in appreciation of your friendship."),
      (troop_add_gold, "trp_player", 1000),
    (else_try),
      (store_random_in_range, ":active_npc", "trp_kingdom_1_lord", kingdom_ladies_begin),
      (neg|troop_slot_ge, ":active_npc", slot_troop_occupation, dplmc_slto_exile),
      (call_script, "script_troop_get_player_relation",  ":active_npc"),
      (assign, ":relation", reg0),
      #                         (troop_get_slot, ":relation", ":active_npc", slot_troop_player_relation),
      (lt, ":relation", -15), #bad relation = send insult

      (str_store_troop_name, s12, ":active_npc"),
      (str_store_string, s4, "@Unfriendly message^^A messenger sent from {s12} arrives and gives you a message with all kinds of insults and profanities, {s12} invites you to go and look for him if you have guts which {s12} believes you don't, as you're a notorious coward."),
      (call_script, "script_change_troop_renown", "trp_player", -6),
    (else_try),
      (change_screen_return),
    (try_end),
  ],[
    ("choice_11_msgnor",[],"Continue.",[
      (change_screen_return, 0),
    ]),
]),
("event_02_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s22}",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (try_begin),
      (lt, "$player_honor", 10),
      (store_random_in_range, ":string", "str_event_01_normal_1", "str_event_01_normal_end"),
      (str_store_string, s22, ":string"),
      (assign, "$temp", 1),
	  (else_try),
      (store_random_in_range, ":string", "str_event_01_normal_1_1", "str_event_01_normal_1_end"),
      (str_store_string, s22, ":string"),
      (assign, "$temp", 2),
	  (try_end),
  ],[
    ("choice_03_0nor",[(eq, "$temp", 1),],"Such an idiot!",[
      (call_script, "script_change_troop_renown", "trp_player", 3),
      (call_script, "script_change_player_honor", -3),
      (str_clear,s1),
      (str_store_string,s1,"@Now even more people think, that you are dishonorable."),
      (display_message, "@{s1}"),
      (change_screen_map),
    ]),
    ("choice_03_1nor",[(eq, "$temp", 2),],"Excellent news!",[
      (call_script, "script_change_troop_renown", "trp_player", 3),
      (str_clear,s1),
      (str_store_string,s1,"@Your fame grows with song, but soon he replaces your name with that of another patron who pays him well."),
      (display_message, "@{s1}"),
      (change_screen_map),
    ]),
    ("choice_03_2nor",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 1000),
      (eq, "$temp", 2),
    ],"Reward him with 1,000 denars. Let this song be played across the land.",[
      (troop_remove_gold, "trp_player", 1000),
      (call_script, "script_change_troop_renown", "trp_player", 9),
      (str_clear,s1),
      (str_store_string,s1,"@Your fame grows higher."),
      (display_message, "@{s1}",message_positive),
      (change_screen_map),
    ]),
    ("choice_03_2nor",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 1000),
      (eq, "$temp", 1),
    ],"Bribe him with 1,000 denars to stop writing about you.",[
      (troop_remove_gold, "trp_player", 1000),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (str_clear,s1),
      (str_store_string,s1,"@He takes the money, but continues writing."),
      (display_message, "@{s1}",message_positive),
      (change_screen_map),
    ]),
]),
("event_03_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Trapped animal^^You are travelling through the forest and you suddenly spot a wild hare trapped in the snare. What do you do?",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("choice_08_1nor",[],"Free the animal.",[
      (display_message, "@The animal runs free without looking back."),
      (change_screen_return, 0),
    ]),
    ("choice_08_2nor",[],"Clench the snare and kill the animal!",[
      (display_message, "@You increase your meat reserves."),
      (troop_add_item, "trp_player","itm_cattle_meat",0),
      (troop_add_item, "trp_player","itm_cattle_meat",0),
      (troop_add_item, "trp_player","itm_cattle_meat",0),
      (change_screen_return, 0),
    ]),
    ("choice_08_3nor",[],"Pass by the animal and ignore it.",[
      (change_screen_return, 0),
    ]),
]),
("event_04_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "White ox^^Some of your men approach before you together with a white ox. They say that they found the ox in a nearby forest.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("choice_12_1nor",[],"Tell your men to sacrifice the ox to Jupiter!",[
      (call_script, "script_add_piety", 5, 1),
      (call_script, "script_change_player_party_morale", 5),
      (add_xp_as_reward, 250),
      (str_clear,s1),
      (str_store_string,s1,"@Only white ox, white lambs or white wethers are allowed to be sacrifice to Jupiter! A wise decision."),
      (display_message, "@{s1}"),
      (play_sound, "snd_cow_moo"),
      (change_screen_return, 0),
    ]),
    ("choice_12_2nor",[],"Set it free, it may belong to someone.",[
      (str_clear,s1),
      (str_store_string,s1,"@You set the ox free, as you think that it may belong to someone."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
    ("choice_12_3nor",[],"Slaughter the ox, we need meat.",[
      (call_script, "script_add_piety", -5, 1),
      (call_script, "script_change_player_party_morale", -5),
      (troop_add_item, "trp_player","itm_cattle_meat",0),
      (troop_add_item, "trp_player","itm_cattle_meat",0),
      (str_clear,s1),
      (str_store_string,s1,"@White ox should be sacrificed to Jupiter! Your men are angry about your decision and fear the wrath of the gods."),
      (display_message, "@{s1}"),
      (play_sound, "snd_cow_moo"),
      (change_screen_return, 0),
    ]),
]),
("event_05_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Boys are boys!^^{s2}",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
    (str_clear,s2),
	  (store_random_in_range, ":string", "str_event_05_normal_1", "str_event_05_normal_end"),
    (str_store_string, s2, ":string"),
  ],[
    ("choice_13_1nor",[],"Punish the soldier.",[
      (call_script, "script_change_player_party_morale", -5),
      (call_script, "script_change_player_honor", 2),
      (str_clear,s1),
      (str_store_string,s1,"@Your men resent the punishment, but recognize your authority. The action sets a precedent for discipline."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
    ("choice_13_3nor",[],"It is a hard world, and a man must take what he can.",[
      (call_script, "script_change_player_honor", -6),
      (str_clear,s1),
      (str_store_string,s1,"@Offended by your contempt for his request, the farmer leaves and spreads the claim of your villainy."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
]),
("event_05_normal_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Military trial^^{s2} Now the soldier demands a trial before a military court. You, as the commander in chief, are the judge. The accused peasant has been captured and brought before you."
  +" The peasant says he is not guilty and that it was the fault of the soldier. He only tried to defend himself.",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
    (str_clear,s2),
	  (store_random_in_range, ":string", "str_event_05_normal_1_1", "str_event_05_normal_1_end"),
    (str_store_string, s2, ":string"),
  ],[
    ("choice_13_1nor",[],"Punish the soldier, he is lying and an idiot.",[
      (call_script, "script_change_player_party_morale", -5),
      (call_script, "script_change_troop_renown", "trp_player", -6),
      (str_clear,s1),
      (str_store_string,s1,"@Your men resent the punishment as they think it is not according to the laws."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
	  ("choice_13_2nor",[],"The peasant is guilty, punish him.",[
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (str_clear,s1),
      (str_store_string,s1,"@According to the law you convict the peasant before a military court to death."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
]),
("event_06_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Lonely cattle^^You come across unguarded cattle from a nearby village",
  "none",[
    (set_background_mesh, "mesh_pic_cattle"),
  ],[
    ("choice_19_1nor",[],"Return the animals to the village and ask for no reward.",[
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_change_troop_renown", "trp_player", 6),
      (change_screen_return, 0),
    ]),
    ("choice_19_2nor",[],"I will return the animals and demand a reward.",[
      (call_script, "script_troop_add_gold", "trp_player", 250),
      (change_screen_return, 0),
    ]),
    ("choice_19_3nor",[],"Dinner! Round up and slaughter the animals.",[
      (call_script, "script_change_player_honor", -3),
      (call_script, "script_change_player_party_morale", 2),
      (troop_add_item, "trp_player","itm_cattle_meat",0),
      (troop_add_item, "trp_player","itm_cattle_meat",0),
		  (troop_add_item, "trp_player","itm_cattle_meat",0),
		  (troop_add_item, "trp_player","itm_cattle_meat",0),
      (str_clear,s1),
      (str_store_string,s1,"@Meat is a welcome addition to the diet of your men."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
]),
("event_07_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Drunken soldiers^^During a break, some of your men, drunk, start to fight for the last drink of wine. Both draw their weapons and appear ready to kill.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("choice_22_1nor",[],"Allow them to fight for the amusement of the rest of your men.",[
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_change_player_party_morale", 2),
      (str_clear,s1),
      (str_store_string,s1,"@Your men gather around, cheering and betting. The atmosphere is tense. Suddenly, the disputes around you become more widespread. Other men draw their weapons, and a fight on a larger scale ensues. Before you can impose order again, several men die."),
      (display_message, "@{s1}"),
      (store_random_in_range, ":p_leave", 4, 8),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
          (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
      (try_end),
      (change_screen_return, 0),
    ]),
    ("choice_22_2nor",[],"You prohibit drinking while on campaign. Punish both drunks with death.",[
      (call_script, "script_change_player_honor", 1),
      (str_clear,s1),
      (str_store_string,s1,"@Your reputation increases among your men when you return to the road, leaving behind two corpses hanging from a tree."),
      (display_message, "@{s1}"),
      (store_random_in_range, ":p_leave", 2, 4),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
          (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
      (try_end),
		  (change_screen_return, 0),
    ]),
    ("choice_22_3nor",[],"Stop the fight and punish the men with lashes.",[
      (call_script, "script_change_troop_renown", "trp_player", -6),
      (call_script, "script_change_player_party_morale", -1),
      (str_clear,s1),
      (str_store_string,s1,"@Your men complain of not being able to enjoy a good fight, seeing that drunkenness on campaign is punishable by few lashes."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
]),
("event_08_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Achilles spear^^As you travel, a man dressed in long robes approaches your army. When you grant him an audience, he says he can sell you the legendary spear of Achilles, for 8000 denars.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("choice_23_1nor",[
      (store_troop_gold,":money","trp_player"),
      (ge,":money",8000),
    ],"Buy the spear.",[
      (troop_remove_gold, "trp_player", 8000),
      (troop_add_item, "trp_player","itm_spear",0),
      (add_xp_as_reward, 500),
      (str_clear,s1),
      (str_store_string,s1,"@The merchant takes the money and gives you a heavy package wrapped in a long cloth. When you unwrap it and discover that he has sold you a normal spear, the merchant is already well away."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
    ("choice_23_2nor",[
      (store_troop_gold,":money","trp_player"),
      (lt,":money",8000),
    ],"You have no money to pay the spear.",[
      (add_xp_as_reward, 250),
      (str_clear,s1),
      (str_store_string,s1,"@The merchant takes his leave and goes back the way he came."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
    ("choice_23_3nor",[],"I'm not interested.",[
      (add_xp_as_reward, 250),
      (str_clear,s1),
      (str_store_string,s1,"@The merchant takes his leave and goes back the way he came."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
]),
("event_09_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Big bag^^One of you scouts shows up with a bag on his back. You don't want to appear suspicious, but a fight-ready soldier would never carry such a bag. It sounds like... many heavy coins. You decide to:",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("choice_26_1nor",[],"Confiscate the bag and punish the soldier.",[
      (call_script, "script_troop_add_gold", "trp_player", 250),
      (call_script, "script_change_player_party_morale", -6),
      (str_clear,s1),
      (str_store_string,s1,"@The scout, who has stolen money, spreads the rumor among your soldiers that you are greedy."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
    ("choice_26_2nor",[],"Allow him to keep it. He risks his life for you, so he deserves it.",[
      (str_clear,s1),
      (str_store_string,s1,"@The scout hides his treasure without anyone else knowing."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
    ("choice_26_3nor",[],"Force him to share the benefits with the whole army.",[
      (str_clear,s1),
      (call_script, "script_change_player_party_morale", 8),
      (str_store_string,s1,"@The distribution of the coins brings happiness to the rest of your soldiers, and they think that you are a fair leader."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
]),
("event_10_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Starving peasants^^While you camp, a delegation of people from a nearby village approach. They say they have had a bad harvest and ask you for money to feed their children.",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
  ],[
    ("choice_28_1nor",[
      (store_troop_gold,":money","trp_player"),
      (ge,":money",50000),
    ],"Give them 50,00 denars.",[
      (troop_remove_gold, "trp_player", 50000),
      (try_for_range, ":center_no", centers_begin, centers_end),
        (store_distance_to_party_from_party, ":dist", "p_main_party", ":center_no"),
        (lt, ":dist", 20), #20 km
        (call_script, "script_change_player_relation_with_center", ":center_no", 6),
      (try_end),
      (str_clear,s1),
      (str_store_string,s1,"@The farmers give you thanks and promise to name the next one of their children after you."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
    ("choice_28_2nor",[
      (store_troop_gold,":money","trp_player"),
      (ge,":money",10000),
    ],"Give them 10,000 denars.",[
      (troop_remove_gold, "trp_player", 10000),
      (try_for_range, ":center_no", centers_begin, centers_end),
        (store_distance_to_party_from_party, ":dist", "p_main_party", ":center_no"),
        (lt, ":dist", 20), #20 km
        (call_script, "script_change_player_relation_with_center", ":center_no", 3),
      (try_end),
      (str_clear,s1),
      (str_store_string,s1,"@The farmers give you thanks. They seem relieved and very happy."),
      (display_message, "@{s1}"),
      (change_screen_return, 0),
    ]),
    ("choice_28_3nor",[],"You tell them you do not have enough money to share.",[
      (change_screen_return, 0),
    ]),
    ("choice_28_4nor",[],"Ignore them.",[
      (change_screen_return, 0),
    ]),
]),
("event_11_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Fight or pay?^^While you camp, a delegation of people from nearby approach. They seem to have a problem with their landowner and want your advice. " +
  "Apparently, drought have devastated the area, so they are poor now, but must still pay taxes to their landowner. As the landwoner does not care about them, they ask whether they should not pay and prepare to fight if the landowner attacks them"
  +" or whether they should pay and let their families starve.",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
  ],[
    ("choice_29_1nor",[
      (store_troop_gold,":money","trp_player"),
      (ge,":money",10000),
    ],"Give them 10,000 denars for paying their taxes and buying food.",[
      (troop_remove_gold, "trp_player", 10000),
      (try_for_range, ":center_no", centers_begin, centers_end),
        (store_distance_to_party_from_party, ":dist", "p_main_party", ":center_no"),
        (lt, ":dist", 10), #10 km
        (call_script, "script_change_player_relation_with_center", ":center_no", 10),
      (try_end),
      (str_clear,s1),
      (str_store_string,s1,"@The farmers give you thanks and promise to name the next one of their children after you."),
      (display_message, "@{s1}"),
      (change_screen_return,0),
    ]),
    ("choice_29_2nor",[
      (store_troop_gold,":money","trp_player"),
      (ge,":money",5000),
    ],"Give them 5,000 denars for paying their taxes.",[
      (troop_remove_gold, "trp_player", 5000),
      (try_for_range, ":center_no", centers_begin, centers_end),
        (store_distance_to_party_from_party, ":dist", "p_main_party", ":center_no"),
        (lt, ":dist", 10), #10 km
        (call_script, "script_change_player_relation_with_center", ":center_no", 4),
      (try_end),
      (str_clear,s1),
      (str_store_string,s1,"@The farmers give you thanks. They seem relieved and very happy."),
      (display_message, "@{s1}"),
      (change_screen_return,0),
    ]),
    ("choice_29_3nor",[],"You tell them they should fight rather than pay.",[
      (try_for_range, ":center_no", centers_begin, centers_end),
        (store_distance_to_party_from_party, ":dist", "p_main_party", ":center_no"),
        (lt, ":dist", 10), #10 km
        (call_script, "script_change_player_relation_with_center", ":center_no", 1),
      (try_end),
      (str_clear,s1),
      (str_store_string,s1,"@The farmers thank you. Perhaps their lord will understand the situation."),
      (display_message, "@{s1}"),
      (change_screen_return,0),
    ]),
    ("choice_29_4nor",[],"They should pay, or the landowner would kill more of them than hunger.",[
      (str_clear,s1),
      (str_store_string,s1,"@The farmers thank you, although they are not happy with your counsel. It will cost the lives of many of their children next winter."),
      (display_message, "@{s1}"),
      (change_screen_return,0),
    ]),
    ("choice_29_5nor",[],"Ignore them.",[
      (call_script, "script_change_troop_renown", "trp_player", -3),
      (change_screen_return,0),#phaiak
    ]),
]),
("event_12_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Sick woman^^Along the way, you find a sick woman. Her skin has a yellow tone, and she coughs constantly. She's from a nearby village, but as no one there knows how to cure her illness, they have sent her to the roadside to see if a traveler knows a cure.",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
  ],[
    ("choice_30_1nor",[
      (store_troop_gold,":money","trp_player"),
      (ge,":money",1000),
    ],"Give her 1000 denars to hire a good physician.",[
      (troop_remove_gold, "trp_player", 1000),
      (try_for_range, ":center_no", centers_begin, centers_end),
        (store_distance_to_party_from_party, ":dist", "p_main_party", ":center_no"),
        (lt, ":dist", 10), #10 km
        (call_script, "script_change_player_relation_with_center", ":center_no", 1),
      (try_end),
      (str_clear,s1),
      (str_store_string,s1,"@She thanks you and heads for the nearest town."),
      (display_message, "@{s1}"),
      (change_screen_return,0),
    ]),
    ("choice_30_2nor",[
      (call_script, "script_get_max_skill_of_player_party", "skl_wound_treatment"),
      (assign, ":max_skill", reg0),
      (assign, ":max_skill_owner", reg1),
      (ge, ":max_skill", 4),
      (try_begin),
        (eq, ":max_skill_owner", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":max_skill_owner"),
      (try_end),
    ],"As the best physician, {reg3?you order:{s3} orders} a blood-letting.",[
      (add_xp_as_reward, 250),
      (try_for_range, ":center_no", centers_begin, centers_end),
          (store_distance_to_party_from_party, ":dist", "p_main_party", ":center_no"),
          (lt, ":dist", 10), #10 km
          (call_script, "script_change_player_relation_with_center", ":center_no", 3),
      (try_end),
      (str_clear,s1),
      (str_store_string,s1,"@She thanks you profusely and heads back to her village, a little weak from the ordeal."),
      (display_message, "@{s1}"),
      (add_xp_as_reward, 500),
      (change_screen_return,0),
    ]),
    ("choice_30_3nor",[],"Ignore her. Her illness could be contagious.",[
      (change_screen_return,0),
    ]),
]),
("event_13_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Mushrooms^^You are travelling through the forest and you suddenly spot a lot of mushrooms. Their colour is reddish-brown. They are finely reticulate on the upper portion, but smooth sometimes irregularly ridged on the lower part."
  +" The under surface of the cap has a white colour. What do you do?",
  "none",[
	  (set_background_mesh, "mesh_pic_deserters"),
	],[
    ("choice_15_1",[],"Pick them up and eat.",[
		  (add_xp_as_reward, 500),
      (change_screen_return),
      (display_message, "@The mushrooms were really tasty! You call them Boletus edulis!"),
    ]),
    ("choice_15_2",[
      (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
      (assign, ":num_men", 0),
      (try_for_range, ":i_stack", 0, ":num_stacks"),
        (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
        (val_add, ":num_men", ":stack_size"),
      (try_end),
		  (ge, ":num_men", 10),
	  ],"Pick them up and give to your men.",[
      (call_script, "script_change_player_party_morale", 1),
      (display_message, "@Your men are eating mushrooms while resting at camp. They seem to be happy."),
      (add_xp_as_reward, 250),
      (change_screen_return),
    ]),
    ("choice_15_3",[],"Pass by them.",[
      (add_xp_as_reward, 125),
      (change_screen_return),
    ]),
]),
("event_14_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Mushrooms^^You are travelling through the forest and you suddenly spot a lot of mushrooms. This mushroom has a many-branched structure, the yellow-tipped pinkish branches arising from a thick base."
  +" You pick up one and look at it, the flesh is white, with pink in the middle. You think that they look really beautiful, so you call them 'Ramaria formosa'. What do you do?",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
	],[
    ("choice_16_1",[],"Pick them up and eat.",[
      (display_message, "@The mushrooms were really tasteless. You have diarrhoea and feel very bad."),
      (troop_raise_attribute, "trp_player",ca_strength,-1),
      (troop_raise_attribute, "trp_player",ca_agility,-1),
      (change_screen_return),
      (add_xp_as_reward, 500),
    ]),
    ("choice_16_2",[
      (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
      (assign, ":num_men", 0),
      (try_for_range, ":i_stack", 0, ":num_stacks"),
        (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
        (val_add, ":num_men", ":stack_size"),
      (try_end),
		  (ge, ":num_men", 10),
	  ],"Pick them up and give to your men.",[
      (call_script, "script_change_player_party_morale", -5),
      (display_message, "@Your men are eating mushrooms while resting at camp. Some of them have diarrhoea and feel very bad. They are angry!"),
      (add_xp_as_reward, 250),
	    (change_screen_return),
    ]),
    ("choice_16_3",[],"Pass by them.",[
      (add_xp_as_reward, 125),
	    (change_screen_return),
    ]),
]),
("event_15_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Mushrooms^^You are travelling through the forest and you suddenly spot a lot of mushrooms. They have a white stalk and gills. You look at them and see that the cap is either pure white, or white at the edge and yellowish, pinkish, or tan at the center."
  +" Some have a partial veil, others have ring circling the upper stalk, and the gills are not attached to the stalk. What do you do?",
  "none",[
	  (set_background_mesh, "mesh_pic_deserters"),
	],[
    ("choice_17_1",[],"Pick them up and eat.",[
      (display_message, "@The mushrooms were really tasteless. You have diarrhoea and feel very bad. You call the mushroom 'Amanita virosa'."),
      (troop_raise_attribute, "trp_player",ca_strength,-1),
      (troop_raise_attribute, "trp_player",ca_agility,-1),
      (change_screen_return),
      (add_xp_as_reward, 500),
    ]),
    ("choice_17_2",[
      (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
      (assign, ":num_men", 0),
      (try_for_range, ":i_stack", 0, ":num_stacks"),
        (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
        (val_add, ":num_men", ":stack_size"),
      (try_end),
		  (ge, ":num_men", 10),
	  ],"Pick them up and give to your men.",[
      (call_script, "script_change_player_party_morale", -10),
      (display_message, "@Your men are eating mushrooms while resting at camp. They have diarrhoea and feel very bad. They are really angry! You call the mushroom 'Amanita virosa'."),
      (add_xp_as_reward, 250),
      (change_screen_return),
    ]),
    ("choice_17_3",[],"Pass by them.",[
      (add_xp_as_reward, 125),
	    (change_screen_return),
    ]),
]),
("event_16_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Refugees^^You come across a group of refugees: widows with their children, some orphans and some men with their families.^They have fled from pillage and war.",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
  ],[
    ("choice_21_1",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 1000),
    ],"Help them on their way with 1,000 denars",[
		  (call_script, "script_change_player_honor", 2),
      (troop_remove_gold, "trp_player", 1000),
      (change_screen_return),
    ]),
    ("choice_21_0",[],"Ignore them.",[
      (change_screen_return),
    ]),
    ("choice_21_2",[],"Kill and loot them, they have money, I am sure.",[
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (call_script, "script_change_player_honor", -3),
      (call_script, "script_troop_add_gold", "trp_player", 2000),
      (change_screen_return),
    ]),
]),
("event_17_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "A joke^^While reviewing the latest reconnaissance reports with your lieutenants, you whimsically remark that passing through the beautiful countryside makes you wish you could one day cast aside your sword settle down on your own land with"
  +" some local buxom wench and spend the rest of your days making babies and growing stuff...To which one of the more smart alec lieutenants retorts that this was hardly likely as your body odour was legendary forcing them"
  +" to pay double to each lady of the night you took a fancy to and it well known that you thought that food  was made by shops and grew in boxes and urns.",
  "none",[
	  (set_background_mesh, "mesh_pic_landschaft"),
	],[
    ("choice_35_1",[],"Laugh heartily with his witty comment, while secretly making a mental note that you must send him deep into enemy territory on an 'important mission'.",[
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_player_party_morale", 5),
	    (change_screen_return),
    ]),
    ("choice_35_2",[],"You glare at your young lieutenant and your mood suddenly turns for the worse but later on reflection you realise that he was probably right.",[
      (call_script, "script_change_player_party_morale", 5),
	    (change_screen_return),
    ]),
    ("choice_35_3",[],"You manage to force a smile while your comrades laughter surrounds you and when no one was looking, you give the secret wink to your bodyguard. This means that the young comedian's head will be impaled.",[
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_player_party_morale", -2),
		  (call_script, "script_change_troop_renown", "trp_player", 5),
      (change_screen_return),
    ]),
]),
("event_18_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Murdered son^^You are informed about an incident: One of your soldiers has killed the son of an officer while he was drunk.",
  "none",[
	  (set_background_mesh, "mesh_pic_camp"),
	],[
    ("choice_40_1",[],"Ignore the situation.",[
      (call_script, "script_change_player_honor", -15),
	    (change_screen_return),
    ]),
    ("choice_40_2",[],"Punish the soldier.",[
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_change_troop_renown", "trp_player", 3),
      (call_script, "script_change_player_party_morale", -2),
	    (change_screen_return),
    ]),
    ("choice_40_3",[],"Execute the soldier.",[
      (call_script, "script_change_player_honor", 6),
      (call_script, "script_change_player_party_morale", -5),
	    (change_screen_return),
    ]),
]),
("event_19_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Lack of discipline^^Your army seems undisciplined. It takes a long time for commands to be performed and you discover that your soldiers are always drunk.",
  "none",[
	  (set_background_mesh, "mesh_pic_camp"),
	],[
    ("choice_41_1",[],"Ignore the situation.",[
      (call_script, "script_change_player_party_morale", -15),
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_change_troop_renown", "trp_player", -6),
	    (change_screen_return),
    ]),
    ("choice_41_2",[],"Punish the soldiers.",[
      (call_script, "script_change_player_honor", 1),
			(call_script, "script_change_troop_renown", "trp_player", 3),
      (call_script, "script_change_player_party_morale", -5),
	    (change_screen_return),
    ]),
    ("choice_41_3",[],"Punish the soldiers and forbid alcohol on campaigns.",[
      (call_script, "script_change_player_honor", 2),
			(call_script, "script_change_troop_renown", "trp_player", 6),
      (call_script, "script_change_player_party_morale", -10),
	    (change_screen_return),
    ]),
]),
("event_20_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Travelling women^^While marching with your army through the land, you encounter a group of travellers. They are mainly woman with children and some old men."
  +" Your soldiers are approaching the group and one of them steps forward and grabs a women. ^One of the old men shouts: 'This is my daughter, you can't have her!'"
  +"^The soldier response: 'I can have whom I want, you old donkey.'^^The old men graps a wooden stick, he seems to be ready to defend his daughter. You shout:",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
	  (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
	],[
    ("choice_42_1",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 2000),
    ],"Soldier! You will free the woman, nobody will harm them! Here old man, take this sack full of denars. (2,000 denars)",[
      (call_script, "script_change_player_honor", 4),
      (call_script, "script_change_player_party_morale", -5),
      (str_store_string, s1, "@Your soldiers are not quite amused, but the travellers seem to be very happy about your gift and help."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
      (change_screen_return),
    ]),
    ("choice_42_2",[],"Soldier! You will free the woman, nobody will harm them! They can go and are under my protection.",[
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_player_party_morale", -5),
      (display_message, "@Your soldiers are not quite amused, but the travellers seem to be happy about your help."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
      (change_screen_return),
    ]),
    ("choice_42_3",[],"The soldier can have the girl, it is his right.",[
      (call_script, "script_change_player_honor", -4),
      (call_script, "script_change_player_party_morale", 4),
      (str_store_string, s1, "@The old man tries to attack your soldier, but is knocked down. Shocked, the other travellers watch how your soldiers beat the old man up. The girl is now the property of your soldier. Some hours later, the old man dies from his injuries. Later, during the night, you hear the girl scream."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
      (change_screen_return),
    ]),
    ("choice_42_3",[],"Lads, go get them. You can have the woman. I want the valuables.",[
      (call_script, "script_change_player_honor", -8),
      (troop_add_gold, "trp_player", 2500),
      (call_script, "script_change_player_party_morale", 16),
      (str_store_string, s1, "@After a short fight the group is defeated, the women are now properties of your men. Later, during the night, you hear them scream."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_21_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Purse^^You happen to find a purse filled with coins. You count the coins, there are 1,000 denars.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("choice_20_1",[],"You gift the purse to a hospice for abandoned children.",[
      (call_script, "script_change_player_honor", 4),
      (change_screen_return),
    ]),
    ("choice_20_2",[],"You keep the purse for yourself.",[
      (call_script, "script_troop_add_gold", "trp_player", 1000),
      (change_screen_return),
    ]),
]),
("event_22_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Trapped peasant^^You are travelling through the forest and you spot a peasant tied up a tree, probably by a bandit. What do you do?",
  "none",[
	  (set_background_mesh, "mesh_pic_deserters"),
	],[
    ("choice_10_1",[],"Free the peasant.",[
      (call_script, "script_change_player_honor", 1),
      (change_screen_return),
    ]),
    ("choice_10_2",[],"Pass by the peasant.",[
	    (change_screen_return),
    ]),
    ("choice_10_3",[],"Kill and loot the peasant",[
      (call_script, "script_change_player_honor", -1),
      (troop_add_gold, "trp_player", 250),
      (display_message, "@The peasant seemed to be rich."),
      (change_screen_return),
    ]),
]),
("event_23_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Rage of Achilles!^^Sing, Goddess, of the rage of Peleus' son Achilles,^"
  +"the accursed rage that brought great suffering to the Achaeans.^^"
  +"You also feel this 'ira' in you. It drive you on your way, it fills your heart. Achilles had this rage too. Sometimes you think that he is part of your life.",
  "none",[
	  (set_background_mesh, "mesh_pic_battle_aftermath"),
	],[
    ("choice_10_1",[],"Continue.",[
      (add_xp_as_reward, 250),
      (troop_set_health, "trp_player", 100),
      (call_script, "script_change_troop_health", "trp_player", -500),
      (change_screen_return),
    ]),
]),
("event_24_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Gigantic snake^^While travelling you see a very long snake lying next to the road. Normally, you would ignore it, but this snake is one of the biggest snakes you ever saw.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
      ("choice_12_1nor",[
        (store_troop_gold, ":g", "trp_player"),
        (ge, ":g", 2000),
      ],"Make a sacrifice to the gods! (2,000 denars)",[
        (troop_remove_gold, "trp_player", 2000),
        (call_script, "script_change_player_party_morale", 5),
        (add_xp_as_reward, 500),
        (str_clear,s1),
        (str_store_string,s1,"@Snakes can teach you how to keep death at bay, like Asclepius did. May the gods hear your call!"),
        (display_message, "@{s1}"),
        (change_screen_return, 0),
      ]),
      ("choice_12_3nor",[],"Ignore it.",[
        (call_script, "script_change_player_party_morale", -5),
        (str_clear,s1),
        (str_store_string,s1,"@Snakes can teach you how to keep death at bay, like Asclepius did. Your men are angry about your ignorance."),
        (display_message, "@{s1}"),
        (change_screen_return, 0),
      ]),
]),
("event_25_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Superstitions^^Your legion is pushing hard, marching after sunset to make a good distance for the day. Suddenly, a murmur rumbles through the column fo your tired soldiers."
  +"^^'Up there, Dominus' a centurion points to the sky.^^A steady stream of shooting stars is falling down, disappearing behind folds of the landscape ahead."
  +" Suddenly, a flock of black birds flies over the column -- in the opposite direction. This is considered a very bad omen. Birds are how Roman gods send messages, and this is clearly one."
  +"^The column has stopped in its tracks now. The men are terrified and refuse to move. Even your officers look deeply perturbed. They await your guidance.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
  ],[
    ("choice_12_1nor",[],"Turn back and find a place to camp for the night.",[
      (str_store_string, s1, "@You find a nice clearing and spend the night. Next morning your rested men are happy to continue the march."),
      (assign, "$temp", "mesh_pic_camp"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_12_3nor",[],"Order the army forward and threaten decimation.",[
      (call_script, "script_change_player_party_morale", -10),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (str_store_string, s1, "@After a brief hesitation, your officers and run up and down the column, barking orders and threats. The situation is tense, and for a time it seems like it might take an actual decimation to get them moving, but eventually the army continues its march. You've managed to maintain control in a difficult situation, but the methods didn't win any love from your men."),
      (assign, "$temp", "mesh_pic_legion_march"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_12_3nor",[],"Grab the legion's eagle and ride forward alone.",[
      (add_xp_as_reward, 250),
      (call_script, "script_change_player_party_morale", 5),
      (call_script, "script_change_troop_renown", "trp_player", 15),
      (call_script, "script_change_player_honor", 4),
      (str_store_string, s1, "@The men are terrified of losing their eagle and commander even more than they were of supernatural dangers. First your officers, then regular soldiers rush forward to join you. Before long, they find courage in each other's presence and the mood lifts. A lewd marching song starts up and flies over the column, interrupted by cheers and laughter. Nobody is tired any longer."),
      (assign, "$temp", "mesh_pic_legion_march"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("event_26_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Pirate hunting^^You encounter a group of dispirited-looking men marching down the road. Their clothes are ragged and dirty, but clearly expensive and used to look fancy not too long ago."
  +"^When questioned, they tell the story of their merchant ship getting attacked by pirates, crew slaughtered, themselves barely escaping with their lives. Their livelihood is ruined, however, and they are marching back home in shame.",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
  ],[
    ("choice_12_1nor",[],"Express your sympathy and move on. ",[
      (display_message, "@The merchants continue on their way, and disappear around the road bend."),
      (change_screen_map),
    ]),
    ("choice_12_3nor",[],"Detach a cohort to hunt down the pirates immediately. (risky)",[
      (call_script, "script_change_player_party_morale", -10),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_inflict_casualties_to_party", "p_main_party", 1),
      (str_store_string, s1, "@The merchants are elated and lead your men to the nearest port, where they hire a civilian ship to hunt for pirates. Unfortunately, your men are not skilled sailors, and in the rush, the ship is not prepared well-enough. Bad weather causes it to run aground. There are casualties."),
      (assign, "$temp", "mesh_pic_seabattle"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_12_3nor",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 10000),
    ],"Gift them enough silver to restart their business.",[
      (troop_remove_gold, "trp_player", 10000),
      (call_script, "script_change_player_honor", 4),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (str_store_string, s1, "@The unfortunate merchants are in awe of your generosity. They thank you profusely and promise to tell everyone about your deed."),
      (assign, "$temp", "mesh_pic_ships"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_12_3nor",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 50000),
    ]," Post a bounty of 50,000 denars for the heads of these pirates to be brought to Rome.",[
      (troop_remove_gold, "trp_player", 50000),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_change_troop_renown", "trp_player", 20),
      (call_script, "script_change_player_relation_with_center", "p_town_6", 5),
      (str_store_string, s1, "@The pirates are quickly hunted down and your reward claimed. Your loyalists make a very successful spectacle of mounting the heads on spikes and nailing them to the city gates, praising you throughout it. The crowds are ecstatic."),
      (assign, "$temp", "mesh_pic_kreuzigung"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("event_27_normal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Pooping birds^^As you make your way along a narrow forest path, you are surprised by a great cacophony of cawing coming from above. As the flock of startled birds leaves, you feel something run down your cheek."
  +" Scooping up the white substance, you throw it down in disgust. Birds are sacred in Rome. Their actions are messages from the gods, and there you stand now, covered head to toe in their poop."
  +"^-- 'This sign is... ambiguous... my Caesar.' Your terrified soothsayer reports and you can almost feel the rumors spreading.^Worse, you already advertised that you will make a speech to the troops today and there is no telling how it will be recieved now.",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
  ],[
    ("choice_12_1nor",[],"Give your planned speech.",[
      (add_xp_as_reward, 125),
      (display_message, "@The speech goes without a problem. There is some residual concern about what happened, but eventually everyone forgets."),
      (call_script, "script_change_player_party_morale", 5),
      (change_screen_map),
    ]),
    ("choice_12_3nor",[],"Postpone it.",[
      (call_script, "script_change_player_party_morale", -25),
      (str_store_string, s1, "@You spend the day away in your tent as rumors continue to spread. When you are finally ready to give the speech, you feel ill in your stomach. Words are slurred and the audience is disturbed by seeing you in this state. You top off the whole affair by throwing up at the end of it. The gods are surely against you, and morale plummets"),
      (assign, "$temp", "mesh_pic_legion_march"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_12_3nor",[
      (store_skill_level, ":oratory","skl_oratory", "trp_player"),
      (ge, ":oratory", 3),
    ],"Give a fiery speech, playing off what happened to you.",[
      (add_xp_as_reward, 250),
      (call_script, "script_change_player_party_morale", 25),
      (str_store_string, s1, "@Your skillful oratory art successfully twists the event in your favor. Before long, the soldiers are cheering and the soothsayer proclaims that the poop was a mark of the gods, showing their favor and blessing. You are chosen and destined for success!"),
      (assign, "$temp", "mesh_pic_legion_march"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
#Snake Island^^
("event_1_sea",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Snake island^^Due to a combination of poor planning, cracked barrels and unforeseen detours, your fleet finds itself short on water. You can probably make it to the nearest known port if you cut everyone's rations, but the crew will not be happy with that decision."
  +"^^Instead, you approach a solitary island, where a convenient beach offers an easy landing spot. You send a search party to look for streams or ponds. Before long, the soldiers return.^^"
  +"Thousands of snakes infest this island, they report. They are slithering on the ground, hanging from trees, crawling up from under the sand, ready to attack when you least expect them!"
  +" Nobody has been bitten so far, but the scouts are terrified of going back.",
  "none",[
    (set_background_mesh, "mesh_pic_ships"),
  ],[
    ("choice_12_1nor",[],"Send the scouts back into the viper nest.",[
      (add_xp_as_reward, 250),
      (call_script, "script_change_player_party_morale", 5),
      (str_store_string, s1, "@The mood is sour for some time, but the scouts eventually return both unharmed and bearing water. They are cheered for their bravery, and the victory celebrations displace any hard feelings among the crew."),
      (assign, "$temp", "mesh_pic_legion_march"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
      (change_screen_map),
    ]),
    ("choice_12_1nor",[],"Cut the water rations instead.",[
      (call_script, "script_change_player_party_morale", -5),
      (change_screen_map),
    ]),
]),
#Night Lights^^
("event_2_sea",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Night lights^^Sailing at night is always an impressive experience. Your massive ship limps along under wind power while the rowers are all asleep below decks."
  +" Barely a light is visible from other ships in your fleet, and the stars above are wholly inadequate to show the way. The ship creeps carefully through the vast and endless darkness,"
  +" like a man awakened on a moonless night desperately groping for a light source.^^Suddenly, watchmen call out a light ahead. Captain changes course to intercept it, other ships following your lead,"
  +" but the closer you get to the strange light, the less it looks like another ship. It's almost as if it is coming from underwater.^^You get very close and there is no more doubt. It is a strange amorphous blob of glowing lights,"
  +" moving beneath the waves and changing shape as it does. It heads for your ship and surrounds it. Splashes come from the darkness just beyond, like fish jumping out of the water, but bigger."
  +" The howling wind brings what sounds like cries of women and children, asking for help.^^Despite the size of the ship, it suddenly feels very small in the huge dark sea."
  +"^^Then, as if on queue, the glowing underwater blob moves away and eventually disappears from view. Only the oldest sea wolves keep their composure and tell stories of seeing this sea monster before."
  +" Stories that are undoubtedly imaginary only a little less than entirely.",
  "none",[
    (set_background_mesh, "mesh_pic_ships"),
  ],[
    ("choice_12_1nor",[],"The sea is a strange place...",[
      (add_xp_as_reward, 125),
      (change_screen_map),
    ]),
]),
#Grounded^^
("event_3_sea",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Grounded^^Roman Quinqueremes are large ships that need fairly deep water. So it is important to have a sailor with a depth-measuring line check periodically to make sure the bottom of the sea isn't coming up to become dangerously shallow."
  +" Sometimes, however, the depth changes too rapidly to detect, resulting in the ram hitting the bottom. This wouldn't usually be a big problem, since the ram is built exactly for the purpose of hitting things."
  +"^^Unfortunately, this time the rocks came up both suddenly and unevenly, letting the ram pass before cutting a gash along the side of the ship.^^Alarms blare, men run to their stations, forming bucket chains to bail out rapidly incoming water."
  +" All the while waves rock the ship's massive hulk, dragging it back and forth along the sharp rocks and ripping it apart more and more.^^After a valiant fight, the ship has to be abandoned and the crew distributed among the rest of the fleet."
  +" It won't be cheap to replace.",
  "none",[
    (set_background_mesh, "mesh_pic_ships"),
  ],[
    ("choice_12_1nor",[],"Too bad the Romans didn't invent insurance... ",[
      (add_xp_as_reward, 125),
      (troop_remove_gold, "trp_player", 10000),
      (change_screen_map),
    ]),
]),
##ghost ships
("event_4_sea",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Ghost ships^^On a clear day your watch spots a small merchant vessel with her oars stationary and what's left of her shredded sail flapping in the wind uselessly. You approach and board the merchant, finding nobody on deck."
  +"^^The search of her holds revealed no souls on board, but no signs of struggle either. The goods in her hold are untouched and her logs reveal she belonged to a Roman trader, returning home with imports. There is storm damage,"
  +" but it seems to be from leaving her sails fully deployed in high winds, as if she was already deserted when the foul weather hit.^^You may never know what happened here. The best you can do is to tow her to the nearest port to sell."
  +" The ship and her cargo should fetch a good price, even damaged.",
  "none",[
    (set_background_mesh, "mesh_pic_ships"),
  ],[
    ("choice_12_1nor",[],"A mystery.",[
      (add_xp_as_reward, 125),
      (troop_add_gold, "trp_player", 5000),
      (change_screen_map),
    ]),
]),

("event_1_games",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Boring Games^^You are attending gladiatorial games staged in your honor. The event has not been a success so far. The fighters were sad and unimpressive, the animals slow and disinterested. Even a couple of prisoners tied to stakes for a trio of fierce lions to devour have passed in a quick and unsatisfying fashion.",
  "none",[
    (set_background_mesh, "mesh_pic_gladiator"),
  ],[
    ("choice_12_1nor",[],"The games are over. Do better next time.",[
      (str_store_string, s1, "@The dissatisfied crowds boo as they file out of the amphitheater. Fights break out here and there as angry people run bump each other, but are quickly subdued."),
      (assign, "$temp", "mesh_pic_townriot"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_12_3nor",[],"Send your soldiers to fight the lions.",[
      (call_script, "script_change_player_party_morale", -20),
      (call_script, "script_change_player_relation_with_center", "$current_town", 8),
      (str_store_string, s1, "@The guards follow your commands, but they are not happy to be cast as common entertainers for the mob. They do make for an exciting spectacle, though, putting down the lions in a pitched battle. The games are saved and excited mobs will have enough to talk about for weeks."),
      (assign, "$temp", "mesh_pic_gladiator"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_12_3nor",[],"Emulate Caligula and throw spectators into the arena. (this is a bad idea) ",[
      (call_script, "script_change_player_honor", -50),
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
        (store_faction_of_troop, ":fac", ":lord"),
        (eq, ":fac", "$players_kingdom"),
        (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_benefactor),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_goodnatured),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_custodian),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_martial),
        (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_upstanding),
        (call_script, "script_change_player_relation_with_troop", ":lord", -50),
      (try_end),
      (call_script, "script_change_senate_support", -35, 0),
      (call_script, "script_change_player_relation_with_center", "$current_town", -100),
      (val_add, "$g_unrest", 10),
      (str_store_string, s1, "@You give the order and your troops surround one of the sections of the yet unsuspecting crowd. A command is barked and the soldiers advance on the crowd, pushing the horrified human mass towards the ledge and into the arena, where surprised and disturbed lions begin attacking them. The rest of the amphitheater gasps in disbelief and rushes to the exits. Before it is over, many innocents are dead.^^'ARE YOU NOT ENTERTAINED?!'^^-- seems like an appropriate thing to yell as you stand up to leave the games."),
      (assign, "$temp", "mesh_pic_gladiator"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),

("event_2_games",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "An excessive welcome^^Caesar's visit is always a great event wherever you go, but {s22} has gone all out with their reception.^As you sit in the amphitheater, watching a gladiatorial match below, the governor and other city officials in the luxury lounge with you give discreet signals that cause servants to bring out an abundance of the fanciest food and a sea of various wines and beers. Dancers and musicians file in as well, and begin to unobtrusively work their craft, without interfering with your watching of the fights below.^Lead by the governor, the occupants of the luxury box are digging into the food and surrendering to the intoxicating charms of Bachhus, enjoying themselves tremendously. Before long, the combat below is nothing but a backdrop to what is quickly turning into an orgy of excess.",
  "none",[
    (set_background_mesh, "mesh_pic_gladiator"),
    (str_store_party_name, s22, "$current_town"),
  ],[
    ("choice_12_1nor",[
    ],"Remain dignified and refuse to participate.",[
      (call_script, "script_change_player_honor", 10),
      (call_script, "script_change_troop_renown", "trp_player", -20),
      (str_store_string, s1, "@You maintain a stoic expression as the party around you develops. Naturally, participants pay close attention to the Princeps, and your silent disapproval is louder than the battle screams from below. Soon, the festive mood dies down, the music mutes, and {s22}'s finest citizens emulate you in consuming food in moderation, and in a dignified fashion."),
      (assign, "$temp", "mesh_pic_gladiator"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_12_3nor",[
    ],"Enjoy yourself along with everyone.",[
      (add_xp_as_reward, 500),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (party_get_slot, ":lord", "$current_town", slot_town_lord),
      (call_script, "script_change_player_relation_with_troop", ":lord", 5),
      (str_store_string, s1, "@The governor clearly knows how to have a good time, and is all too happy to rise in your graces. The event of excess that is a Roman orgy goes late into the night, long after the gladiators are finished. Parts of the event are missing from your memory the next morning, but there were definitely chariot races involved."),
      (assign, "$temp", "mesh_pic_gladiator"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("choice_12_3nor",[
    ],"Get very drunk and go wild!",[
      (add_xp_as_reward, 750),
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (call_script, "script_change_player_honor", -10),
      (party_get_slot, ":lord", "$current_town", slot_town_lord),
      (call_script, "script_change_player_relation_with_troop", ":lord", -4),
      (str_store_string, s1, "@You are not sure what transpired after the fifth horn of wine last night, but you wake up to the governor's wife and her servants trying to ease your enormous headache with cool wet towels. Nobody speaks of last night, let alone fault you for anything, but you can tell by the look in their eyes you behaved less than honorably."),
      (assign, "$temp", "mesh_pic_gladiator"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),

("debate_in_senat",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "After your secretaries wrote the correct law text, you must bring a proposal before the senate."
  +" The senate will vote about it. If the majority of the senators vote for the proposal, your law/edict will be issued."
  +" Currently, {reg33}% of the senators support you. But it is not sure if all sentors will vote for you, it is possible that some change the sides.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (troop_get_slot, reg33, "trp_senator_dummy", slot_senate_support),
  ],[
  ("choice_12_1nor",[],"Continue",[
    (assign, "$g_bribe", 0),
    (jump_to_menu, "mnu_debate_in_senat_2"),
  ]),
]),

("debate_in_senat_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You bring your proposal to the senate. A heated discussion starts. After some hours, {s23}^^{reg45}% of the senators voted for your proposal. {s56}",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),

    (str_clear, s56),
    (store_random_in_range, ":r", 0, 100),
    (try_begin),
      (neq, "$g_bribe", 1),
      (try_begin),
        (lt, ":r", 20),
        #(val_sub, reg45, 6),
        (set_show_messages, 0),
        (call_script, "script_change_senate_support", -2,0),
        (set_show_messages, 1),
        (str_store_string, s56, "@Two senators changed to the opposite side during the discussion!"),
      (else_try),
        (lt, ":r", 50),
        (set_show_messages, 0),
        (call_script, "script_change_senate_support", -1,0),
        (set_show_messages, 1),
        (str_store_string, s56,"@One senators changed to the opposite side during the discussion!"),
      (else_try),
        (lt, ":r", 80),
        (set_show_messages, 0),
        (call_script, "script_change_senate_support", 1,0),
        (set_show_messages, 1),
        (str_store_string, s56,"@One senator changed to your side during the discussion!"),
      (try_end),
    (try_end),
    (troop_get_slot, reg45, "trp_senator_dummy", slot_senate_support),
    # (party_get_slot, ":rome_rel", "p_town_6", slot_center_player_relation),
    # (troop_get_slot, ":renown", "trp_player", slot_troop_renown), ##renown can be something between 0 and infinity
    # (val_clamp, ":renown", 100, 1000), ##so make it that it only counts till 10000
    # (store_div, ":change", ":renown", 100),  ##max: 10, min: 1
    # (val_add, ":change", ":rome_rel"), ##rome_rel can be -100 till 100 -> min: -99, max: 110
    # (assign, ":honor", "$player_honor"),
    # (val_clamp, ":honor", -100, 100),
    # (val_add, ":change", ":honor"), #now min: -199, max: 210
    # (val_add, ":change", "$player_right_to_rule"), #right to rule from 0 to 100 -> min: -199, max: 310
    # (troop_get_slot, ":con", "trp_player", slot_troop_controversy), #is between 0, 100
    # (val_sub, ":change", ":con"), ##now min: -299, max: 310
    # (val_add, ":change", "$temp4"),
    # (try_begin),
      # (eq, "$g_bribe", 1),
      # (val_sub, reg45, 15),
    # (try_end),
    #(troop_set_slot, "trp_senator_dummy", slot_senate_support, reg45),

    (try_begin),
      (eq, "$g_bribe", 1),
      (assign, reg45, 100),
    (try_end),

    (try_begin),
      (ge, reg45, 51),
      (assign, ":continue", 1),
      (assign, "$temp3", 1),
    (else_try),
      (assign, ":continue", 0),
      (assign, "$temp3", 0),
    (try_end),

    # $edict1	##das ist die abschaffen von diesen petitionen
    # $edict2	##das ist das sitten gesetz von kaiser augustus
    # $edict3	##das ist das gesetz womit es verboten wird christen zu verfolgen
    # $edict4	##das ist das gesetz womit christenverfolgung zur staatsangelegenheit wird
    # $edict5	##das ist das gesetz womit allen freien reichsbewohnern das bugerrecht verliehen wird

    (try_begin),
      (eq, "$temp", 1),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, the Edictum de libelli."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, the Edictum de libelli."),
        (call_script, "script_abort_quest", "qst_blank_quest_4",0),
        (try_for_range, ":troop_r", active_npcs_begin, active_npcs_end),
          (store_faction_of_troop, ":fac", ":troop_r"),
          (eq, ":fac", "$players_kingdom"),
          (store_random_in_range, ":r", 0, 100),
          (is_between, ":r", 0, 15),
          (store_random, ":relation", 2, 12),
          (val_mul, ":relation", -1),
          (call_script, "script_change_player_relation_with_troop", ":troop_r", ":relation"),
        (try_end),
        (assign, "$edict1", 1),
        (try_begin),
          (eq, "$g_libelli", 1),
          (assign, "$g_libelli", 0),
          (display_log_message, "@The Libelli office has been dismissed, because it is now unnecessary."),
        (try_end),
      (try_end),
    # (else_try),##you can't issue this law again,
      # (eq, "$temp", 2),
      # (try_begin),
        # (eq, ":continue", 0),
        # (str_store_string, s23, "@The majority has voted against your proposal, the Lex Iulia et Papia."),
      # (else_try),
        # (str_store_string, s23, "@The majority has voted for your proposal, the Lex Iulia et Papia."),
        # (assign, "$edict2", 1),
      # (try_end),
    (else_try),
      (eq, "$temp", 3),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, the Edictum Christiani."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, the Edictum Christiani."),
        (assign, "$edict4", 0),
        (assign, "$edict3", 1),
        (val_add, "$g_unrest", 5),
        (display_message, "@Stability of the Empire decreases", color_bad_news),
        (try_begin),
          (check_quest_active, "qst_blank_quest_19"),
          (quest_slot_ge, "qst_blank_quest_19", slot_quest_current_state, 1),
          (quest_set_slot, "qst_blank_quest_19", slot_quest_current_state, -1),
          (str_clear, s20),
          (add_quest_note_from_sreg, "qst_blank_quest_19", 3, s20, 0),
        (try_end),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (neq, ":npc", "trp_legatus_12"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 0, 3),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 2, 5),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp", 4),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, the Edictum securitatis publica."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, the Edictum securitatis publica."),
        (assign, "$edict4", 1),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 1, 5),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 0, 4),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp", 5),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, the Constitutio {playername}."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, the Constitutio {playername}."),
        (assign, "$edict5", 1),
        (val_sub, "$g_unrest", 5),
        (display_message, "@Stability of the Empire increases", color_good_news),
        (val_max, "$g_unrest", 0),
        (call_script, "script_change_player_relation_with_center", "p_town_6", -5),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
          (else_try),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 1, 5),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp", 6),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal to expand the Constitutio {playername} and to document the mos maiorum."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal to expand the Constitutio {playername} and to document the mos maiorum."),
        (assign, "$edict6", 1),
        (val_sub, "$g_unrest", 5),
        (display_message, "@Stability of the Empire increases", color_good_news),
        (call_script, "script_change_player_right_to_rule", 10),
        (val_max, "$g_unrest", 0),
      (try_end),
    (else_try),
      (eq, "$temp", 7),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal to expand the Constitutio {playername} and grant every citizen the civitas Romana."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal to expand the Constitutio {playername} and grant every citizen the civitas Romana."),
        (assign, "$edict5", 2),
        (val_sub, "$g_unrest", 25),
        (display_message, "@Stability of the Empire increases", color_good_news),
        (call_script, "script_change_player_right_to_rule", 3),
        (call_script, "script_change_player_relation_with_center", "p_town_6", -50),
        (val_max, "$g_unrest", 0),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
          (else_try),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 15, 26),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp", 8),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, the Lex frumentaria et agraria."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal to enact the Lex frumentaria et agraria."),
        (assign, "$edict7", 1),
        (val_sub, "$g_unrest", 5),
        (display_message, "@Stability of the Empire increases", color_good_news),
        (call_script, "script_change_player_relation_with_center", "p_town_6", 10),
        (val_max, "$g_unrest", 0),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (store_random_in_range, ":rand", 1, 3),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (store_random_in_range, ":rand", 1, 3),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp", 9),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, the Lex militaris."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal to enact the Lex militaris."),
        (assign, "$edict8", 1),
        (val_sub, "$g_unrest", 5),
        (display_message, "@Stability of the Empire increases", color_good_news),
        (call_script, "script_change_player_relation_with_center", "p_town_6", 5),
        (val_max, "$g_unrest", 0),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (store_random_in_range, ":rand", 0, 3),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (store_random_in_range, ":rand", 1, 4),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp", 10),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, the Lex Alimenta."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal to enact the Lex Alimenta."),
        (assign, "$edict9", 1),
        (val_sub, "$g_unrest", 4),
        (display_message, "@Stability of the Empire increases", color_good_news),
        (call_script, "script_change_player_relation_with_center", "p_town_6", 5),
        (val_max, "$g_unrest", 0),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (store_random_in_range, ":rand", 0, 3),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (store_random_in_range, ":rand", 1, 4),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp", 11),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, the Vicesima Libertatis Vel Manumissionum."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal to enact the Vicesima Libertatis Vel Manumissionum."),
        (assign, "$edict11", 1),
        (val_add, "$g_unrest", 2),
        (display_message, "@Stability of the Empire decreases", color_bad_news),
        (val_max, "$g_unrest", 0),
        (call_script, "script_change_player_relation_with_center", "p_town_6", -5),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (is_between, ":personality", lrep_goodnatured, lrep_custodian),
          (neq, ":personality", lrep_roguish),
          (store_random_in_range, ":rand", -3, -1),
          (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp2", 1),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to revoke the Edictum de libelli."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to revoke the Edictum de libelli."),
        (assign, "$edict1", 0),
        # (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
        #   (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
        # 	(store_faction_of_troop, ":fac", ":npc"),
        # 	(eq, ":fac", "$players_kingdom"),
        # 	(troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
        # 	(try_begin),
        # 		(is_between, ":personality", lrep_goodnatured, lrep_custodian),
        # 		(neq, ":personality", lrep_roguish),
        # 		(store_random_in_range, ":rand", 1, 10),
        # 		(call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
        # 	(else_try),
        # 		(troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
        # 		(store_random_in_range, ":rand", 1, 7),
        # 		(val_mul, ":rand", -1),
        # 		(call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
        # 	(try_end),
        # (try_end),
      (try_end),
    (else_try),
      (eq, "$temp2", 2),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to revoke the Lex Iulia et Papia."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to revoke the Lex Iulia et Papia."),
        (assign, "$edict2", 0),
        (try_for_range, ":npc", heroes_begin, kingdom_ladies_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":faction", ":npc"),
          (eq, ":faction", "$players_kingdom"),
          (troop_slot_eq, ":npc", slot_lord_reputation_type, lrep_moralist),
          (call_script, "script_change_player_relation_with_troop", ":npc", -10),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp2", 3),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to revoke the Edictum Christiani."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to revoke the Edictum Christiani."),
        (assign, "$edict3", 0),
        (try_begin),
          (neg|quest_slot_eq, "qst_important_friends", slot_quest_current_state, 0),# has played main story and promised Kaeso
          (call_script, "script_change_player_relation_with_troop", "trp_legatus_12", -150),
          (display_message, "@You have broken your promise!", message_negative),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp2", 4),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to revoke the Edictum securitatis publica."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to revoke the Edictum securitatis publica."),
        (assign, "$edict4", 0),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (store_random_in_range, ":rand", 1, 3),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 0, 3),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp2", 7),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to revoke the Lex frumentaria et agraria."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to revoke the Lex frumentaria et agraria."),
        (assign, "$edict7", 0),
        (call_script, "script_change_player_relation_with_center", "p_town_6", -50),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (store_random_in_range, ":rand", 1, 3),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 0, 3),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
        (val_add, "$g_unrest", 5),
        (display_message, "@Stability of the Empire decreases", color_bad_news),
      (try_end),
    (else_try),
      (eq, "$temp2", 8),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to revoke the Lex militaris."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to revoke the Lex militaris."),
        (assign, "$edict8", 0),
        (val_add, "$g_unrest", 6),
        (display_message, "@Stability of the Empire decreases", color_bad_news),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (store_random_in_range, ":rand", 1, 3),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 0, 3),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp2", 9),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to revoke the Lex Alimenta."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to revoke the Lex Alimenta."),
        (assign, "$edict9", 0),
        (val_add, "$g_unrest", 5),
        (display_message, "@Stability of the Empire decreases", color_bad_news),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (store_random_in_range, ":rand", 1, 3),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 0, 3),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp2", 11),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to revoke the Vicesima Libertatis Vel Manumissionum."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal to revoke the Vicesima Libertatis Vel Manumissionum."),
        (assign, "$edict11", 0),
        (val_sub, "$g_unrest", 2),
        (display_message, "@Stability of the Empire decreases", color_bad_news),
        (val_max, "$g_unrest", 0),
        (call_script, "script_change_player_relation_with_center", "p_town_6", 5),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (is_between, ":personality", lrep_goodnatured, lrep_custodian),
          (neq, ":personality", lrep_roguish),
          (store_random_in_range, ":rand", 1, 4),
          (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp4_1", 1),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to increase the rights of the landowners and decrease the rights of the slaves."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to increase the rights of the landowners and decrease the rights of the slaves."),

        (faction_get_slot, ":serfdom", "fac_player_supporters_faction", dplmc_slot_faction_serfdom),
        (val_add, ":serfdom", 1),
        (faction_set_slot, "fac_player_supporters_faction", dplmc_slot_faction_serfdom ,":serfdom"),

        (val_add, "$g_unrest", 1),
        (display_message, "@Stability of the Empire decreases", color_bad_news),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (store_random_in_range, ":rand", 1, 3),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),
            (store_random_in_range, ":rand", 1, 4),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
   (else_try),
      (eq, "$temp4_1", -1),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to increase the rights of the slaves and decrease the rights of the landowners."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to increase the rights of the slaves and decrease the rights of the landowners."),

        (faction_get_slot, ":serfdom", "fac_player_supporters_faction", dplmc_slot_faction_serfdom),
        (val_sub, ":serfdom", 1),
        (faction_set_slot, "fac_player_supporters_faction", dplmc_slot_faction_serfdom ,":serfdom"),

        (val_sub, "$g_unrest", 2),
        (display_message, "@Stability of the Empire increases", color_good_news),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (store_random_in_range, ":rand", 1, 4),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (store_random_in_range, ":rand", 3, 8),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
   (else_try),
      (eq, "$temp4_1", 2),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to increase the rights of the nobles and decrease the rights of the citizens."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to increase the rights of the nobles and decrease the rights of the citizens."),

        (faction_get_slot, ":aristocraty", "fac_player_supporters_faction", dplmc_slot_faction_aristocracy),
        (val_add, ":aristocraty", 1),
        (faction_set_slot, "fac_player_supporters_faction", dplmc_slot_faction_aristocracy ,":aristocraty"),

        # (val_sub, "$g_unrest", 2),
        # (display_message, "@Stability of the Empire increases", color_good_news),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (store_random_in_range, ":rand", 0, 3),
          (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$temp4_1", 2),
      (try_begin),
        (eq, ":continue", 0),
        (str_store_string, s23, "@The majority has voted against your proposal, to increase the rights of the citizens and decrease the rights of the nobles."),
      (else_try),
        (str_store_string, s23, "@The majority has voted for your proposal, to increase the rights of the citizens and decrease the rights of the nobles."),

        (faction_get_slot, ":aristocraty", "fac_player_supporters_faction", dplmc_slot_faction_aristocracy),
        (val_sub, ":aristocraty", 1),
        (faction_set_slot, "fac_player_supporters_faction", dplmc_slot_faction_aristocracy ,":aristocraty"),

        (val_sub, "$g_unrest", 1),
        (display_message, "@Stability of the Empire increases", color_good_news),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "$players_kingdom"),
          (troop_get_slot, ":personality", ":npc", slot_lord_reputation_type),
          (try_begin),
            (is_between, ":personality", lrep_goodnatured, lrep_custodian),
            (neq, ":personality", lrep_roguish),
            (store_random_in_range, ":rand", 0, 2),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (else_try),
            (store_random_in_range, ":rand", 3, 7),
            (val_mul, ":rand", -1),
            (call_script, "script_change_player_relation_with_troop", ":npc", ":rand"),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
    (play_sound, "snd_senatus_sound_1"),
  ],[
    ("answere_1",[
      (eq, "$temp3", 0),
    ],"Damn it",[
      (assign, "$auto_enter_town", "$current_town"),
      (assign, "$g_town_visit_after_rest", 1),
      (assign, "$g_last_rest_center", "$current_town"),
      (assign, "$g_last_rest_payment_until", -1),
      (rest_for_hours, 6, 4, 0),
      (change_screen_map),
    ]),
    ("answere_2",[
      (eq, "$temp3", 1),
    ],"Very good",[
      (assign, "$auto_enter_town", "$current_town"),
      (assign, "$g_town_visit_after_rest", 1),
      (assign, "$g_last_rest_center", "$current_town"),
      (assign, "$g_last_rest_payment_until", -1),
      (rest_for_hours, 6, 4, 0),
      (change_screen_map),
    ]),
    ("answere_3",[
      (eq, "$temp3", 0),
    ],"Try to convince some senators.",[
      (jump_to_menu, "mnu_debate_in_senat_3")
    ]),
]),

("debate_in_senat_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You can talk with the senators and try to convince them or bribe them. You have {reg1} denars with you."
  +"^You can also threaten them with the Praetorian guard. But this will decrease your relation with Rome!"
  +"^^What do you want to do?",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (store_troop_gold, reg1, "trp_player"),
  ],[
    ("choice_1",[
    ],"Talk with the senators.",[
      (troop_set_slot, "trp_senator_dummy", slot_senate_backup1, "$temp"),##make a back up for temp variables here
      (troop_set_slot, "trp_senator_dummy", slot_senate_backup2, "$temp2"),
      (troop_set_slot, "trp_senator_dummy", slot_senate_backup3, "$temp3"),
      (troop_set_slot, "trp_senator_dummy", slot_senate_backup4, "$temp4"),

      (assign,"$temp",1),
      (assign,"$temp2",0),
      (assign, "$temp3", 0),
      (assign, "$temp4", 1),
      (set_jump_mission,"mt_senate_meeting"),
      (modify_visitors_at_site, "scn_senate"),
      (reset_visitors),
      (set_visitor,1, "trp_praetoriani_milites"),
      (set_visitor,2, "trp_praetoriani_milites"),
      (set_visitor,3, "trp_praetoriani_milites"),
      (set_visitor,4, "trp_praetoriani_milites"),
      (try_for_range, ":entry", 5, 45),
        (set_visitor,":entry", "trp_senator"),
      (try_end),
      (set_visitor,50, "trp_senator_dummy"),
      (set_jump_entry, 0),
      (jump_to_scene, "scn_senate"),
      (change_screen_mission),
    ]),
    ("choice_2",[(eq, "$g_speech", 0),],"Try to convince them with a speech",[
      (call_script, "script_give_a_speech", "$current_town"),
    ]),
    ("choice_4",[],"Threaten them with violence!",[
      (call_script, "script_change_player_honor", -15),
      (call_script, "script_change_player_relation_with_center", "p_town_6", -20),
      (assign, "$g_bribe", 1),
      (display_message, "@The senators fear you and will most likely vote for your proposal, but the people of Rome despise your tyranny and you lose support among the senators.", color_bad_news),
      (jump_to_menu, "mnu_debate_in_senat_2"),
    ]),
    ("choice_3",[],"Forget it",[
        (jump_to_menu, "mnu_debate_in_senat_2"),
    ]),
]),

("villa",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "What do you want to do?^^{s10}",
  "none",[
    (str_clear, s10),
    (try_begin),
        (troop_get_slot, reg10, "trp_household_villa", slot_troop_father),
        (lt, reg10, 0),
        (val_abs, reg10),
        (store_current_day, ":day"),
        (val_sub, reg10, ":day"),
        (try_begin),
            (le, reg10),
            (display_message, "@Construction of baths has finished!", message_positive),
            (troop_set_slot, "trp_household_villa", slot_troop_father, 1),
        (else_try),
            (str_store_string, s10, "@The bath will take approximately {reg10} days until its finished."),
        (try_end),
    (try_end),
    (set_background_mesh, "mesh_pic_villa_sea"),
  ],[
    ("bath",[
      (neg|troop_slot_eq, "trp_array_villa_feast", 9, 0),
      (troop_slot_eq, "trp_household_villa", slot_troop_father, 1),
    ],"Spend a day in the bath. [Improves health]",[
      (try_begin),
        (neg|troop_slot_ge, "trp_player", slot_troop_unhealth, 300),
        (store_random_in_range, ":r", 1, 10),
      (else_try),
        (neg|troop_slot_ge, "trp_player", slot_troop_unhealth, 600),
        (store_random_in_range, ":r", 50, 140),
      (else_try),
        (store_random_in_range, ":r", 140, 350),
      (try_end),
      (val_mul, ":r", -1),
      (call_script, "script_change_troop_health", "trp_player", ":r"),
      (assign, "$auto_enter_town", "$current_town"),
      (assign, "$g_town_visit_after_rest", 1),
      (assign, "$g_last_rest_center", "$current_town"),
      (assign, "$g_last_rest_payment_until", -1),
      (rest_for_hours, 6, 4, 0),
      (change_screen_map),
    ]),
    ("villa_bath",[
      (neg|troop_slot_eq, "trp_array_villa_feast", 9, 0),
      (troop_slot_eq, "trp_household_villa", slot_troop_father, 1),
    ],"Enter the bath.",[
      (try_begin),
        (troop_slot_eq, "trp_household_villa", slot_troop_father, 1),
        (set_jump_mission, "mt_baths"),
        (modify_visitors_at_site, "scn_villa_baths"),
        (reset_visitors),
        (mission_tpl_entry_set_override_flags, "mt_baths", 0, af_override_horse),
        (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_baths", 0, 0),
          (mission_tpl_entry_set_override_flags, "mt_baths", 0, af_override_outfit_1|af_override_horse),
        (try_end),
        (set_visitor, 0, "trp_player"),
        (jump_to_scene, "scn_villa_baths"),
        (change_screen_mission),
      (else_try),
        (str_store_troop_name, s10, "trp_housholder2"),
        (display_message, "@You have not build the baths yet! Talk with {s10}.", message_alert),
      (try_end),
    ], "Enter the bath."),
    ("villa",[
      (neg|troop_slot_eq, "trp_array_villa_feast", 9, 0),
    ],"Enter the villa.",[
      (set_passage_menu, "mnu_villa"),

      (troop_get_slot, ":scene", "trp_household_villa", slot_troop_spouse),
      (modify_visitors_at_site, ":scene"),
      (reset_visitors),
      (set_visitor, 11, "trp_housholder2"),
      (set_jump_mission, "mt_visit_villa"),

      (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_visit_villa", 21, 0),
          (mission_tpl_entry_set_override_flags, "mt_visit_villa", 21, af_override_outfit_1|af_override_horse),
      (try_end),

      (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_visit_villa", 36, 0),
          (mission_tpl_entry_set_override_flags, "mt_visit_villa", 36, af_override_outfit_1|af_override_horse),
      (try_end),

      (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_visit_villa", 0, 0),
          (mission_tpl_entry_set_override_flags, "mt_visit_villa", 0, af_override_outfit_1|af_override_horse),
      (else_try),
          (mission_tpl_entry_set_override_flags, "mt_visit_villa", 0, af_override_horse|af_override_weapons|af_override_head),
      (try_end),
      # (set_jump_entry, 21),

      (try_begin),
          (eq, "$g_player_rent", 1),
          (set_visitor, 30, "trp_guest"),
          (set_visitor, 31, "trp_guest_female"),
          (set_visitor, 32, "trp_guest"),
          (set_visitor, 33, "trp_guest_female"),
      (try_end),

      (try_begin),
          (gt, "$g_player_chamberlain", 0),
          (call_script, "script_dplmc_appoint_chamberlain"),  #fix for wrong troops after update
          (set_visitor, 12, "$g_player_chamberlain"),
      (try_end),

      (try_begin),
          (gt, "$g_player_constable", 0),
          (call_script, "script_dplmc_appoint_constable"),  #fix for wrong troops after update
          (set_visitor, 13, "$g_player_constable"),
      (try_end),

      (try_begin),
          (gt, "$g_player_chancellor", 0),
          (call_script, "script_dplmc_appoint_chancellor"), #fix for wrong troops after update
          (set_visitor, 14, "$g_player_chancellor"),
      (try_end),
      (jump_to_scene, ":scene"),
      (change_screen_mission),
    ],"Enter the villa"),
    ("villa",[
      (neg|troop_slot_eq, "trp_array_villa_feast", 9, 0),
    ],"Walk around.",[
      (set_passage_menu, "mnu_villa"),
      (modify_visitors_at_site, "scn_villa_player"),
      (reset_visitors),
      (set_jump_mission, "mt_visit_villa"),
      (set_visitor, 1, "trp_slave"),
      (set_visitor, 2, "trp_slave_female"),
      (set_visitor, 3, "trp_slave_female"),
      (set_visitor, 4, "trp_slave"),
      (set_visitor, 5, "trp_slave_female"),
      (set_visitor, 6, "trp_slave"),
      (set_visitors, 7, "trp_slave_female",2),
      (set_visitors, 8, "trp_slave",2),
      (set_visitor, 9, "trp_slave_female"),
      (set_visitor, 10, "trp_slave"),
      (set_visitor, 11, "trp_housholder2"),
      (try_begin),
          (eq, "$g_player_rent", 1),
          (set_visitor, 30, "trp_guest"),
          (set_visitor, 31, "trp_guest_female"),
          (set_visitor, 32, "trp_guest"),
          (set_visitor, 33, "trp_guest_female"),
      (try_end),
      (try_begin),
          (gt, "$g_player_chamberlain", 0),
          (call_script, "script_dplmc_appoint_chamberlain"),  #fix for wrong troops after update
          (set_visitor, 23, "$g_player_chamberlain"),
      (try_end),
      (try_begin),
          (gt, "$g_player_constable", 0),
          (call_script, "script_dplmc_appoint_constable"),  #fix for wrong troops after update
          (set_visitor, 24, "$g_player_constable"),
      (try_end),
      (try_begin),
          (gt, "$g_player_chancellor", 0),
          (call_script, "script_dplmc_appoint_chancellor"), #fix for wrong troops after update
          (set_visitor, 25, "$g_player_chancellor"),
      (try_end),
      (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_visit_villa", 0, 1),
          (mission_tpl_entry_set_override_flags, "mt_visit_villa", 0, af_override_outfit_1|af_override_horse),
      (try_end),
      # (set_jump_entry, 0),
      (jump_to_scene, "scn_villa_player"),
      (change_screen_mission),
    ],"Go outside."),
    ("feast",[
      (troop_slot_eq, "trp_array_villa_feast", 9, 0),
    ],"Start the feast.",[
      (assign, "$talk_context", tc_feast),
      (modify_visitors_at_site, "scn_villa_player"),
      (reset_visitors),
      (set_visitor, 1, "trp_slave"),
      (set_visitor, 2, "trp_slave_female"),
      (set_visitor, 3, "trp_slave_female"),
      (set_visitor, 4, "trp_slave"),
      (set_visitor, 5, "trp_slave_female"),
      (set_visitor, 6, "trp_slave"),
      (set_visitors, 7, "trp_slave_female",2),
      (set_visitors, 8, "trp_slave",2),
      (set_visitor, 9, "trp_slave_female"),
      (set_visitor, 10, "trp_slave"),
      (set_visitor, 11, "trp_housholder2"),
      (call_script, "script_villa_feast"),
      (troop_get_slot, ":musican", "trp_array_villa_feast", 7),
      (try_begin),
          (ge, ":musican", 1),
          (set_visitor, 22, "trp_tavern_minstrel_4"),
      (try_end),

      (set_jump_entry, 21),
      (set_jump_mission, "mt_visit_villa"),
      (try_for_range, ":guest", 0, 11),
          (troop_set_slot, "trp_array_villa_feast", ":guest", -1),
      (try_end),

      (jump_to_scene, "scn_villa_player"),
      (change_screen_mission),
    ]),

    ("wait_here",[],"Wait here for some time.",[
      (assign,"$auto_enter_town","$current_town"),
      (assign, "$g_last_rest_center", "$current_town"),
      (rest_for_hours_interactive, 24 * 7, 5, 0), #rest while attackable
      (change_screen_return),
    ]),
    ("town_leave",[],"Go back to Neapolis.",[
      (jump_to_menu, "mnu_town"),
    ]),
    ("leave",[],"Leave.",[
      (change_screen_map),
    ]),
]),

("horde",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "In the distance you see sheep and cattle grazing in the meadows. Not far away from you some nomads have build up their camp.",
  "none",[
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("attack_the_hord",
    [], "Attack them",[
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -50),
        (gt, reg0, 200),
        (party_set_morale, "$g_encountered_party", 100),##enemy has high morale
        (assign, "$g_battle_result", 0),
        (assign, "$g_engaged_enemy", 1),
        (call_script, "script_calculate_battle_advantage"),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (set_jump_mission,"mt_lead_charge"),
        (call_script, "script_setup_random_scene"),
        (assign, "$g_next_menu", "mnu_simple_encounter"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      (else_try),
        (display_message,"@You need to have at least 200 men."),
      (try_end),
	  ]),

    ("horde_horde",[],"Visit the camp.",[
			(assign, ":closest_town", -1),
			(assign, ":score_to_beat", 99999),
			(try_for_range, ":town_no", towns_begin, towns_end),
				(store_distance_to_party_from_party, ":distance", "$g_encountered_party", ":town_no"),
				(lt, ":distance", ":score_to_beat"),
				(assign, ":closest_town", ":town_no"),
				(assign, ":score_to_beat", ":distance"),
			(try_end),
      (assign, "$current_town", ":closest_town"),
      (modify_visitors_at_site, "scn_hord"),
      (reset_visitors),
      (set_visitor, 1, "trp_sarmatian_village_walker_female"),
      (set_visitor, 2, "trp_sarmatian_light_horsearcher"),
      (set_visitor, 3, "trp_sarmatian_village_walker_female"),
      (set_visitors, 4, "trp_sarmatian_light_horsearcher",2),
      (set_visitors, 5, "trp_sarmatian_light_horsearcher",2),
      (set_visitor, 6, "trp_sarmatian_light_horsearcher"),
      (set_visitors, 7, "trp_sarmatian_village_walker_female",2),
      (set_visitors, 8, "trp_sarmatian_light_horseman",2),
      (set_visitors, 9, "trp_sarmatian_village_walker_female",3),
      (set_visitor, 10, "trp_sarmatian_light_horseman"),
      (set_visitors, 11, "trp_sarmatian_village_walker_female",2),
      (set_visitors, 12, "trp_sarmatian_village_walker_female",2),
      (set_jump_entry, 0),
      (set_jump_mission, "mt_horde"),
      (jump_to_scene, "scn_hord"),
      (change_screen_mission),
    ]),
    ("leave",[],"Leave.",[
		  (change_screen_map),
    ]),
]),

("desert_victory",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You have fought your way out of Garama before the enemy could mobilize more warriors.^But you have achieved nothing. Darta is still in the hands of the Garamantian king.^Attacking Garama would be a bad idea. During the slaughter Darta could be killed. You must find another way to get her.",
  "none",[
    (set_background_mesh, "mesh_pic_desert"),
  ],[
  ("leave",[],"Continue.",[
		(change_screen_map),
  ]),
]),

("desert_wait",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "After one hour of searching you finally find the oasis. You sit under one of the three oalms and wait.^Time passes and nothing happen. After some hours you see the nurse together with Darta coming.",
  "none",[
    (set_background_mesh, "mesh_pic_desert"),
    (try_begin),
		  (eq, "$temp", 1),
		  (change_screen_map),
	  (try_end),
  ],[
  ("leave",[
    (eq, "$temp", 0),
	],"Continue.",[
    (quest_set_slot, "qst_blank_quest_20", slot_quest_temp_slot, 5),
    (assign, "$talk_context", tc_escape),
    (call_script, "script_setup_troop_meeting", "trp_garamantian_queen", -1, -1),
  ]),
]),

("desert_town_fight",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s11}",
  "none",[
    (str_clear, s11),
    (try_begin),
      (eq, "$g_battle_result", 1),
      (eq, "$g_enemy_fit_for_battle", 0),
      (str_store_string, s11, "@You were victorious!"),
      (try_begin),
        (gt, "$g_friend_fit_for_battle", 1),
        (set_background_mesh, "mesh_pic_victory"),
      (try_end),
      (assign, "$g_next_menu", "mnu_desert_town_loot"),
      (assign, "$loot_screen_shown", 0),

    (else_try),
      (eq, "$g_battle_result", -1),
      (ge, "$g_enemy_fit_for_battle",1),
      (this_or_next|le, "$g_friend_fit_for_battle",0),
      (le, "$playerparty_postbattle_regulars", 0),
      (str_store_string, s11, "@The battle was lost. Your forces were utterly crushed."), #SB : "The battle"
      (set_background_mesh, "mesh_pic_defeat"),
    (assign, "$g_next_menu", "mnu_desert_town"),

    (else_try),
      (eq, "$g_battle_result", -1),
      (str_store_string, s11, "@Your companions carry you away from the fighting."),
      (set_background_mesh, "mesh_pic_wounded"),
    (assign, "$g_next_menu", "mnu_desert_town"),

    (else_try),
      (eq, "$g_battle_result", 1),
      (str_store_string, s11, "@You have defeated the enemy."),
      (try_begin),
        (gt, "$g_friend_fit_for_battle", 1),
        (set_background_mesh, "mesh_pic_victory"),
      (try_end),
      (assign, "$g_next_menu", "mnu_desert_town_loot"),
      (assign, "$loot_screen_shown", 0),
    (else_try),
      (eq, "$g_battle_result", 0),
      (str_store_string, s11, "@You have retreated from the fight."),
      (assign, "$g_next_menu", "mnu_desert_town"),
    (try_end),
  ],[
  ("continue",[
    (jump_to_menu, "$g_next_menu"),
  ],"Continue ...",[
  ]),
]),

  (
    "attack_desert_town",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You order your troops to march towards the town. The enemy has noticed your advance and prepared a counterattack. Now you are surrounded by enemies.",
    "none",
    [
	(store_faction_of_party, ":fac", "$g_encountered_party"),
	(try_begin),
		(this_or_next|eq, ":fac", "fac_garamantes"),
		(eq, ":fac", "fac_gaetuli"),
		(set_background_mesh, "mesh_pic_numider"),
    (else_try),
        (eq, ":fac", "fac_kush"),
        (set_background_mesh, "mesh_pic_nubian"),
	(try_end),

	(str_store_faction_name, s51, ":fac"),

    ],
    [
      ("continue",
       [
           ],
       "Defend!",
       [
			(assign, "$g_battle_result", 0),
			(assign, "$g_engaged_enemy", 1),
			(call_script, "script_calculate_battle_advantage"),
			(set_battle_advantage, reg0),
			(set_party_battle_mode),

      (party_get_slot, ":exterior_scene", "$g_encountered_party", slot_town_center),

      (set_jump_mission,"mt_charge_desert_town"),
      (jump_to_scene, ":exterior_scene"),
      (assign, "$g_next_menu", "mnu_desert_town_fight"),
      (jump_to_menu, "mnu_battle_debrief"),
            (change_screen_mission),
        ]),

    ]
  ),

("desert_town",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "In the distance you see {s50}. It is the capital of the {s51}. ^^{s52}",
  "none",[
    (assign, "$current_town","$g_encountered_party"),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_party_looted_left_days, 1),
      (jump_to_menu, "mnu_center_looted"),
    (try_end),

    (store_faction_of_party, ":fac", "$g_encountered_party"),
    (str_store_faction_name, s51, ":fac"),
    (try_begin),
        (this_or_next|eq, "$g_encountered_party_faction", "fac_gaetuli"),
        (this_or_next|eq, "$g_encountered_party_faction", "fac_garamantes"),
        (this_or_next|eq, "$g_encountered_party_faction", "fac_kush"),
        (eq, "$g_encountered_party_faction", "fac_nabataea"),
        (set_background_mesh, "mesh_pic_towndes"),
    (else_try),
        (eq, "$g_encountered_party_faction", "fac_dahae"),
        (set_background_mesh, "mesh_pic_khergit"),
    (else_try),
        (set_background_mesh, "mesh_pic_townsnow"),
    (try_end),

    (str_store_party_name, s50, "$g_encountered_party"),
    (str_clear, s52),
    (try_begin),
      (store_relation, ":faction_relation", ":fac", "fac_player_supporters_faction"),
      (lt, ":faction_relation", 0),
      (str_store_string, s52, "@The {s51} are hostile to you."),
    (try_end),
    (try_begin),
      (faction_slot_eq, "$g_encountered_party_faction", slot_faction_player_tributary, 1),
      (str_store_string, s52, "@The {s51} are a tributary of you."),
    (try_end),
  ],[
  ("hunt_elpehant",[
    (check_quest_active, "qst_elephant_hunt"),
    (quest_get_slot, ":giver", "qst_elephant_hunt", slot_quest_giver_troop),
    (faction_slot_eq, "$g_encountered_party_faction", slot_faction_leader, ":giver"),
    (store_faction_of_party, ":encountered_faction", "$g_encountered_party"),
    (store_relation, ":faction_relation", ":encountered_faction", "fac_player_supporters_faction"),
    (ge, ":faction_relation", 0),
  ],"Meet the hunting party.",[
    (jump_to_menu, "mnu_desert_hunt_1"),
  ]),
  ("sneak_into",[
    (store_faction_of_party, ":encountered_faction", "$g_encountered_party"),
    (store_relation, ":faction_relation", ":encountered_faction", "fac_player_supporters_faction"),
    (lt, ":faction_relation", 0),
  ],"Sneak into the town.",[
	  (store_faction_of_party, ":fac", "$g_encountered_party"),

    (faction_get_slot, ":shooper", ":fac", slot_faction_tier_1_troop),
    (faction_get_slot, ":troop", ":fac", slot_faction_tier_2_troop),
    (faction_get_slot, ":troop2", ":fac", slot_faction_tier_3_troop),

    (faction_get_slot, ":walker1", ":fac", slot_faction_village_walker_male_troop),
    (faction_get_slot, ":walker2", ":fac", slot_faction_village_walker_female_troop),
    (faction_get_slot, ":walker3", ":fac", slot_faction_town_walker_male_troop),
    (faction_get_slot, ":walker4", ":fac", slot_faction_town_walker_female_troop),

    (faction_get_slot, ":tavern_keeper", ":fac", slot_faction_messenger_troop),
    (faction_get_slot, ":rich_merchant", ":fac", slot_faction_prison_guard_troop),
    (faction_get_slot, ":poor_merchant", ":fac", slot_faction_castle_guard_troop),
    (faction_get_slot, ":leader", ":fac", slot_faction_leader),

    #(store_add, ":queen", ":leader", 1),
    ##1 bis 12 guards, 13 bis 25 sitzende menschen, 26 bis 45 town walker, 46 special merchant 48 special merchant 47 tavernkeeper 49/50 king queen or special character
    (party_get_slot, ":scene", "$g_encountered_party",slot_town_center),
    (set_jump_mission, "mt_visit_desert_town"),
    (modify_visitors_at_site, ":scene"),
    (reset_visitors),
    (set_visitor, 1, ":troop"),
    (set_visitor, 60, ":shooper"),
    (set_visitor, 2, ":troop"),
    (set_visitor, 3, ":troop"),
    (set_visitor, 4, ":troop"),
    (set_visitor, 5, ":troop"),
    (set_visitor, 6, ":troop"),
    (set_visitor, 7, ":troop"),
    (set_visitor, 8, ":troop"),
    (set_visitor, 9, ":troop"),
    (set_visitor, 10, ":troop"),
    (set_visitor, 11, ":troop"),
    (set_visitor, 12, ":troop2"),

    (try_for_range,":entry",13,26),
        (store_random_in_range,":rand",0,10),
        (try_begin),
            (le, ":rand", 1),
            (assign, ":town_walker", ":walker4"),
        (else_try),
            (le, ":rand", 3),
            (assign, ":town_walker", ":walker3"),
        (else_try),
            (le, ":rand", 6),
            (assign, ":town_walker", ":walker2"),
        (else_try),
            (assign, ":town_walker", ":walker1"),
        (try_end),
        (mission_tpl_entry_clear_override_items,"mt_visit_desert_town",":entry"),
        (store_random_in_range,":r",0,10),
        (try_begin),
            (gt,":r",2),
            (mission_tpl_entry_add_override_item,"mt_visit_desert_town",":entry","itm_dedal_kufel"),
        (try_end),
        (set_visitor,":entry",":town_walker"),
    (try_end),

    (try_for_range,":entry",26,45),
        (store_random_in_range,":rand",0,10),
        (try_begin),
            (le, ":rand", 1),
            (assign, ":town_walker", ":walker4"),
        (else_try),
            (le, ":rand", 3),
            (assign, ":town_walker", ":walker3"),
        (else_try),
            (le, ":rand", 6),
            (assign, ":town_walker", ":walker2"),
        (else_try),
            (assign, ":town_walker", ":walker1"),
        (try_end),
        (set_visitor,":entry",":town_walker"),
    (try_end),

    (set_visitor, 46, ":poor_merchant"),
    (set_visitor, 47, ":tavern_keeper"),
    (set_visitor, 48, ":rich_merchant"),

    (troop_get_slot, ":queen", ":leader", slot_troop_spouse),
    (party_count_members_of_type, ":lady", "$g_encountered_party", ":queen"),
    (try_begin),
        (ge, ":lady", 1),
        (eq, ":queen", "trp_garamantian_queen"),
        (try_begin),
            (neg|quest_slot_ge, "qst_blank_quest_20", slot_quest_current_state, 1),
            (set_visitor, 50, ":queen"),
        (else_try),
            (set_visitor, 50, "trp_nurse_african"),
        (try_end),
        # (else_try),
        # (set_visitor, 50, ":queen"),
    (try_end),
    (assign, "$talk_context", tc_town_talk),
    (jump_to_scene, ":scene"),

  # (assign, "$sneaked_into_town", disguise_pilgrim),#priest
    (mission_tpl_entry_set_override_flags, "mt_visit_desert_town", 0, af_override_everything),
    (mission_tpl_entry_add_override_item, "mt_visit_desert_town", 0, "itm_generic_poor1"),
    (mission_tpl_entry_add_override_item, "mt_visit_desert_town", 0, "itm_simple_hood_1"),
    (mission_tpl_entry_add_override_item, "mt_visit_desert_town", 0, "itm_leather_boots"),

    (set_jump_entry, 0),
    (change_screen_mission),
	]),
  ("cheat_test",[
    (ge, "$cheat_mode", 1),
	],"Cheat: Test scene.",[
    (party_get_slot, ":scene", "$g_encountered_party",slot_town_center),
    (jump_to_scene, ":scene"),
    (change_screen_mission),
	]),
  ("cheat_test",[
    (ge, "$cheat_mode", 1),
	],"Cheat: Improve faction relation.",[
    (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", 200),
	]),
	("charge_them",[
    (neg|faction_slot_eq, "$g_encountered_party_faction", slot_faction_player_tributary, 1),
	],"Attack the town.",[
    (try_begin),
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (gt, reg0, 200),
      (party_set_morale, "$g_encountered_party", 100),##enemy has high morale
      (jump_to_menu, "mnu_attack_desert_town"),
      (faction_get_slot, ":troop", "$g_encountered_party_faction", slot_faction_leader),
      (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -120),#make sure you are at war
      (call_script, "script_change_player_relation_with_troop", ":troop", -10),
    (else_try),
      (display_message,"@You need to have at least 200 men."),
    (try_end),
	]),

  ("monasterio_recruitm2",[
    (party_slot_eq,"$g_encountered_party",slot_center_volunteer_troop_type,0),#can recruit
    (store_relation, ":relation", "fac_player_supporters_faction", "$g_encountered_party_faction"),
    (this_or_next|faction_slot_eq, "$g_encountered_party_faction", slot_faction_player_tributary, 1),
    (ge, ":relation", 50),
  ],"Recruit troops.",[
    (jump_to_menu, "mnu_barracks"),
    # (store_faction_of_party, ":fac", "$g_encountered_party"),
    # (faction_get_slot, ":troop", ":fac", slot_faction_tier_2_troop),
    # (faction_get_slot, ":troop2", ":fac", slot_faction_tier_3_troop),

    # (party_get_free_companions_capacity, ":free_capacity", "p_main_party"),

    # (try_begin),
        # (ge, ":free_capacity", 50),
        # (party_add_members, "p_main_party", ":troop", 35),
        # (party_add_members, "p_main_party", ":troop2", 15),
        # (display_message, "@You have levied 20 warriors. You can recruit again after some days."),
        # (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,1),#can recruit
    # (else_try),
        # (display_message, "str_not_enough_party_space"),
    # (try_end),
  ]),

      # ("monasterio_recruitm",
        # [
         # (party_slot_eq,"$g_encountered_party",slot_center_volunteer_troop_type,0),#can recruit

		 # (faction_slot_eq, "$g_encountered_party_faction", slot_faction_player_tributary, 1),
        # ],
        # "Recruit 20 Tribalwarriors.",
        # [
	  # (store_faction_of_party, ":fac", "$g_encountered_party"),
    # (faction_get_slot, ":troop", ":fac", slot_faction_tier_2_troop),
    # (faction_get_slot, ":troop2", ":fac", slot_faction_tier_3_troop),
		# (party_get_free_companions_capacity, ":free_capacity", "p_main_party"),
    # (try_begin),
      # (ge, ":free_capacity", 20),
      # (party_add_members, "p_main_party", ":troop", 15),
      # (party_add_members, "p_main_party", ":troop2", 5),
      # (display_message, "@You have levied 20 warriors. You can recruit again after some days."),
      # (party_set_slot,"$g_encountered_party",slot_center_volunteer_troop_type,1),#can recruit
    # (else_try),
      # (display_message, "str_not_enough_party_space"),
    # (try_end),
      # ]),

  ("king_meet",[
    (store_faction_of_party, ":encountered_faction", "$g_encountered_party"),
    (store_relation, ":faction_relation", ":encountered_faction", "fac_player_supporters_faction"),
    (lt, ":faction_relation", 0),
  ],"Request to meet their king.",[
		(call_script, "script_get_meeting_scene"),
		(assign, ":meeting_scene", reg0),
		(modify_visitors_at_site,":meeting_scene"),
		(reset_visitors),
		(set_visitor,0,"trp_player"),
		(party_stack_get_troop_id, ":siege_leader_id","$g_encountered_party",0),
		(party_stack_get_troop_dna,":siege_leader_dna","$g_encountered_party",0),
		(set_visitor,17,":siege_leader_id",":siege_leader_dna"),
		(set_jump_mission,"mt_conversation_encounter"),
		(jump_to_scene,":meeting_scene"),
		(assign, "$talk_context", tc_siege_commander),
		(change_screen_map_conversation, ":siege_leader_id"),
  ]),

  ("desert_town_visit",[
    (store_faction_of_party, ":encountered_faction", "$g_encountered_party"),
    (store_relation, ":faction_relation", ":encountered_faction", "fac_player_supporters_faction"),
    (ge, ":faction_relation", 0),
  ],"Visit the town.",[
	  (store_faction_of_party, ":fac", "$g_encountered_party"),
    (faction_get_slot, ":shooper", ":fac", slot_faction_tier_1_troop),
    (faction_get_slot, ":troop", ":fac", slot_faction_tier_2_troop),
    (faction_get_slot, ":troop2", ":fac", slot_faction_tier_3_troop),
    (faction_get_slot, ":walker1", ":fac", slot_faction_village_walker_male_troop),
    (faction_get_slot, ":walker2", ":fac", slot_faction_village_walker_female_troop),
    (faction_get_slot, ":walker3", ":fac", slot_faction_town_walker_male_troop),
    (faction_get_slot, ":walker4", ":fac", slot_faction_town_walker_female_troop),
    (faction_get_slot, ":tavern_keeper", ":fac", slot_faction_messenger_troop),
    (faction_get_slot, ":rich_merchant", ":fac", slot_faction_prison_guard_troop),
    (faction_get_slot, ":poor_merchant", ":fac", slot_faction_castle_guard_troop),
    (faction_get_slot, ":leader", ":fac", slot_faction_leader),

   ##1 bis 12 guards,
   #13 bis 25 sitzende menschen, 26 bis 45 town walker,
   #46 special merchant 48 special merchant
   #47 tavernkeeper 49/50 king queen or special character
    (party_get_slot, ":scene", "$g_encountered_party",slot_town_center),
    (set_jump_mission, "mt_visit_desert_town"),
    (modify_visitors_at_site, ":scene"),
    (reset_visitors),
    (set_visitor, 1, ":troop"),
    (set_visitor, 60, ":shooper"),
    (set_visitor, 2, ":troop"),
    (set_visitor, 3, ":troop"),
    (set_visitor, 4, ":troop"),
    (set_visitor, 5, ":troop"),
    (set_visitor, 6, ":troop"),
    (set_visitor, 7, ":troop"),
    (set_visitor, 8, ":troop"),
    (set_visitor, 9, ":troop"),
    (set_visitor, 10, ":troop"),
    (set_visitor, 11, ":troop"),
    (set_visitor, 12, ":troop2"),

    (try_for_range,":entry",13,26),
        (store_random_in_range,":rand",0,10),
        (try_begin),
            (le, ":rand", 1),
            (assign, ":town_walker", ":walker4"),
        (else_try),
            (le, ":rand", 3),
            (assign, ":town_walker", ":walker3"),
        (else_try),
            (le, ":rand", 6),
            (assign, ":town_walker", ":walker2"),
        (else_try),
            (assign, ":town_walker", ":walker1"),
        (try_end),
        (mission_tpl_entry_clear_override_items,"mt_visit_desert_town",":entry"),
        (store_random_in_range,":r",0,10),
        (try_begin),
            (gt,":r",2),
            (mission_tpl_entry_add_override_item,"mt_visit_desert_town",":entry","itm_dedal_kufel"),
        (try_end),
        (set_visitor,":entry",":town_walker"),
    (try_end),

    (try_for_range,":entry",26,45),
        (store_random_in_range,":rand",0,10),
        (try_begin),
            (le, ":rand", 1),
            (assign, ":town_walker", ":walker4"),
        (else_try),
            (le, ":rand", 3),
            (assign, ":town_walker", ":walker3"),
        (else_try),
            (le, ":rand", 6),
            (assign, ":town_walker", ":walker2"),
        (else_try),
            (assign, ":town_walker", ":walker1"),
        (try_end),
        (set_visitor,":entry",":town_walker"),
    (try_end),

    (set_visitor, 46, ":poor_merchant"),
    (set_visitor, 47, ":tavern_keeper"),
    (set_visitor, 48, ":rich_merchant"),

    (set_visitor, 49, ":leader"),

    (troop_get_slot, ":queen", ":leader", slot_troop_spouse),
		(party_count_members_of_type, ":lady", "$g_encountered_party", ":queen"),
    (try_begin),
      (ge, ":lady", 1),
      (eq, ":queen", "trp_garamantian_queen"),
      (try_begin),
        (neg|quest_slot_ge, "qst_blank_quest_20", slot_quest_current_state, 1),
        (set_visitor, 50, ":queen"),
      (else_try),
        (set_visitor, 50, "trp_nurse_african"),
      (try_end),
    # (else_try),
      # (set_visitor, 50, ":queen"),
    (try_end),

		(set_jump_entry, 0),
		(assign, "$talk_context", tc_town_talk),
		(jump_to_scene, ":scene"),
		(change_screen_mission),
  ]),
  ("castle_wait",[
    #(party_slot_eq,"$current_town",slot_party_type, spt_castle),
    (ge, "$g_encountered_party_relation", 0),

    (assign, ":can_rest", 1),
    (str_clear, s1),
    (try_begin),
      (party_get_num_companions, ":num_men", "p_main_party"),
      (store_div, reg1, ":num_men", 4),
      (val_add, reg1, 1),
      (str_store_string, s1, "@ ({reg1} denars per night)"),
      (store_troop_gold, ":gold", "trp_player"),
      (lt, ":gold", reg1),
      (assign, ":can_rest", 0),
    (try_end),
    (eq, ":can_rest", 1),
  ],"Wait here for some time{s1}.",[
    (assign, "$auto_enter_town", "$current_town"),
    (assign, "$g_town_visit_after_rest", 1),
    (assign, "$g_last_rest_center", "$current_town"),
    (assign, "$g_last_rest_payment_until", -1),
    (rest_for_hours_interactive, 24 * 7, 5, 0), #rest while not attackable
    (change_screen_return),
  ]),

  ("leave",[],"Leave.",[
		(change_screen_map),
  ]),
]),

("desert_town_loot",mnf_disable_all_keys,
  "The town is in your hand. What do you want to do?",
  "none",[
    (set_background_mesh, "mesh_pic_victory"),
  ],[
  ("continue",[],"Establish a tributary state",[
    (str_store_troop_name, s40, "trp_player"),
    (add_faction_note_from_sreg, "$g_encountered_party_faction", 3, "@They are a tributary of {s40}.", 0),
    (faction_get_slot, ":king", "$g_encountered_party_faction", slot_faction_leader),
    (call_script, "script_change_player_relation_with_troop", ":king", -20),
    (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", 0),
    (faction_set_slot, "$g_encountered_party_faction", slot_faction_player_tributary, 1),
    (change_screen_map),
  ]),
  ("continue",[],"Destroy this place and exterminate the population...",[
    (jump_to_menu, "mnu_desert_town_loot2"),
  ]),
]),

  (
    "desert_town_loot2",mnf_disable_all_keys,
    "The town is plundered. You have collected {reg7} denars.",
    "none",
    [
	#(add_faction_note_from_sreg, "$g_encountered_party_faction", 5, "@You have destroyed their capital. Their king is probably dead.", 1),

  (set_background_mesh, "mesh_pic_victory"),
  (troop_clear_inventory, "trp_temp_troop"),
  (try_begin),
      (eq, "$loot_screen_shown", 0),
      (assign, "$loot_screen_shown", 1),
      # new begin (copy of mnu_village_loot_complete)
      (assign, ":bound_town", "$g_encountered_party"),
      (store_sub, ":item_to_price_slot", slot_town_trade_good_prices_begin, trade_goods_begin),
      (reset_item_probabilities,0),
      (assign, ":total_probability", 0),
      (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
        (store_add, ":cur_price_slot", ":cur_goods", ":item_to_price_slot"),
        (party_get_slot, ":cur_price", ":bound_town", ":cur_price_slot"),
        (gt, ":cur_price", 0),
        (call_script, "script_center_get_production", ":bound_town", ":cur_goods"),
        (assign, ":cur_probability", reg0),
        (call_script, "script_center_get_consumption", ":bound_town", ":cur_goods"),
        (val_div, reg0, 3),
        (val_sub, ":cur_probability", reg0),
        (val_mul, ":cur_probability", 4),
        (val_mul, ":cur_probability", average_price_factor),
        (val_div, ":cur_probability", ":cur_price"),
        (val_max,":cur_probability",0),
        #first only simulation
        #(set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
        (val_add, ":total_probability", ":cur_probability"),
      (try_end),
      (reset_item_probabilities,0),
      (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
        (store_add, ":cur_price_slot", ":cur_goods", ":item_to_price_slot"),
        (party_get_slot, ":cur_price", ":bound_town", ":cur_price_slot"),
        (gt, ":cur_price", 0),
        (call_script, "script_center_get_production", ":bound_town", ":cur_goods"),
        (assign, ":cur_probability", reg0),
        (gt, ":cur_probability", 0),
        (call_script, "script_center_get_consumption", ":bound_town", ":cur_goods"),
        (val_div, reg0, 3),
        (val_sub, ":cur_probability", reg0),
        (val_mul, ":cur_probability", 4),
        (val_mul, ":cur_probability", average_price_factor),
        (val_div, ":cur_probability", ":cur_price"),
        (val_max, ":cur_probability", 0),
        (val_mul, ":cur_probability", num_merchandise_goods),
        (val_mul, ":cur_probability", 100),
        (val_div, ":cur_probability", ":total_probability"),
        (val_max, ":cur_probability", 5),
        (set_item_probability_in_merchandise,":cur_goods",":cur_probability"),

      (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
      (val_min, ":prosperity", 40),
      (val_div, ":prosperity", 2),
      (val_max, ":prosperity", 3),
      (party_get_skill_level, ":looting_skill", "p_main_party", "skl_looting"),
      (val_add, ":prosperity", ":looting_skill"),

      (troop_add_merchandise,"trp_temp_troop",itp_type_goods,":prosperity"),
      (assign, ":merchant_troop", "trp_temp_troop"),
      #new end
    (try_end),
    (gt, ":merchant_troop", 0),
    (troop_add_item, ":merchant_troop", "itm_temple_gold"),#this seems to work
    (troop_add_item, ":merchant_troop", "itm_jewelry"),#this seems to work
    (troop_add_item, ":merchant_troop", "itm_ivory"),#this seems to work
    (troop_add_item, ":merchant_troop", "itm_Silver"),#this seems to work
    (troop_sort_inventory, ":merchant_troop"),
    (change_screen_loot, ":merchant_troop"),
  (else_try),
    # All shown

    # 1.PLUNDER MONEY
    (party_get_slot, ":prosperity_factor", "$g_encountered_party", slot_town_prosperity),
    (party_get_slot, ":wealth", "$g_encountered_party", slot_town_wealth),
    (party_get_slot, ":wealth2", "$g_encountered_party", slot_center_capital),

    (party_get_skill_level, ":looting_skill", "p_main_party", "skl_looting"),

    (val_add, ":prosperity_factor", ":looting_skill"),##looting skill makes factor better

    (val_add, ":wealth", ":wealth2"),
    (val_add, ":prosperity_factor", 20),
    (val_mul, ":wealth", ":prosperity_factor"),
    (val_div, ":wealth", 100),

    (try_begin),
        (lt, "$player_honor", -90),
        (val_mul, ":wealth", 15),
        (val_div, ":wealth", 10),
    (else_try),
        (lt, "$player_honor", -70),
        (val_mul, ":wealth", 14),
        (val_div, ":wealth", 10),
    (else_try),
        (lt, "$player_honor", -40),
        (val_mul, ":wealth", 13),
        (val_div, ":wealth", 10),
    (else_try),
        (lt, "$player_honor", -20),
        (val_mul, ":wealth", 12),
        (val_div, ":wealth", 10),
    (try_end),

    (troop_add_gold, "trp_player", ":wealth"),
    (assign, reg7, ":wealth"),
    (call_script, "script_change_troop_renown", "trp_player", 10),
    (call_script, "script_destroy_center", "$g_encountered_party"),#destroy it
  (try_end),
    ],
    [

      ("continue",[],"Continue...",
        [
          # (assign, "$auto_enter_town", "$g_encountered_party"),
          # (change_screen_return),
          (change_screen_map),
          #(jump_to_menu, "mnu_auto_return_map"),
      ]),
    ],
  ),

("conspiracy",mnf_disable_all_keys,
  "You enter the palace. The first thing you notice is this beautiful girl standing next to the flowers. Then a fly tickles your ear.^"
  +" You look around and realize that nobody is there anymore. Suddenly you hear shouts: ^^"
  +" 'Your tyranny will end today!'^^"
  +" 'You will burn in hell!'",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
  ],[
    ("continue",[],"... What the hell ...",[
      (assign, "$talk_context", -1),
      (try_begin),
        (eq, "$temp4_1", 1),
        (assign,":scene", "scn_imperial_palace"),
      (else_try),
        (party_get_slot, ":scene", "$current_town", slot_town_castle),
      (try_end),
      # (assign, "$talk_context", tc_feast),
      (modify_visitors_at_site, ":scene"),
      (reset_visitors),
      (assign, ":entry", 16),
      (try_for_range, ":slot", 20, 35),
          (troop_get_slot, ":enemy", "trp_array_villa_feast", ":slot"),
          (gt, ":enemy", active_npcs_begin),
          (set_visitor, ":entry", ":enemy"),
          (val_add, ":entry", 1),
      (try_end),
      #entry points:
      # 1 player
      # 2 - 6 berater
      # 7 - 10 berater in sitz position
      # 11 - 13 dancers
      # 14 so ein typ der sich um die hofhaltung sorgt
      # 15 - 17 die typen von diplomacy
      # 18 minister
      # 19 die eigene ehefrau, in sitzposition
      #20 - 29 guards
      #30,31 minstrels
      #32 - 34 slaves
      #35 heir, if player has one
      (set_jump_entry, 0),
      (set_jump_mission, "mt_conspiracy_fight"),
      (jump_to_scene, ":scene"),
      (change_screen_mission),
    ]),
]),

("conspiracy_2",mnf_disable_all_keys,
  "Soon after you overwhelm the conspirators your guards appear and arrest them.^^Why hasn't the praetorian guard helped you? Who else is part of this conspiracy?",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
  ],[
  ("continue",[],"All are Traitors!",[
	  (assign, reg45, 0),
	  (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
      (troop_slot_eq, ":npc", slot_troop_legion, 12),
      (assign, reg45, 1),
      (str_store_troop_name_link, s20, ":npc"),
	  (try_end),
	  (try_begin),
      (eq, reg45, 1),
      (setup_quest_text,  "qst_conspiracy"),
      (str_store_string, s2, "@The attempt of your enemies to murder you failed. Now you should talk with the commander of the praetorian guard {s20}. You may also ask some questions to the leader of the conspiracy you captured.^\
      (Hint: To question the traitor you must talk to him while he is prisoner of your party.)"),
      (call_script, "script_start_quest", "qst_conspiracy", "trp_fortuna"),
      (call_script, "script_update_all_notes"),
      (quest_set_slot, "qst_conspiracy", slot_quest_temp_slot, 1),
	  (else_try),
      (setup_quest_text,  "qst_conspiracy"),
      (str_store_string, s2, "@The attempt of your enemies to murder you failed. You haven't assigned a commander for the praetorian guard. That could have prevented the assassination. You may also ask some questions to the leader of the conspiracy you captured.^\
      (Hint: To question the traitor you must talk to him while he is prisoner of your party.)"),
      (call_script, "script_start_quest", "qst_conspiracy", "trp_fortuna"),
      (call_script, "script_update_all_notes"),
      (quest_set_slot, "qst_conspiracy", slot_quest_temp_slot, 1),
	  (try_end),
	  (try_for_range, ":slot", 20, 500),
      (troop_get_slot, ":enemy", "trp_array_villa_feast", ":slot"),
      (ge, ":enemy", active_npcs_begin),
      (try_begin),
        (troop_get_slot, ":party_no", ":enemy", slot_troop_leaded_party),
        (ge, ":party_no", 1),
        (call_script, "script_destroy_party", ":party_no"),
        (troop_set_slot, ":enemy", slot_troop_leaded_party, -1),
      (try_end),
      (troop_join_as_prisoner, ":enemy"),
      (troop_set_slot, ":enemy", slot_troop_prisoner_of_party, "p_main_party"),
      (party_force_add_prisoners, "p_main_party", ":enemy", 1),
      (call_script, "script_event_hero_taken_prisoner_by_player", ":enemy"),
		  (try_begin),
        (neg|quest_slot_ge, "qst_conspiracy", slot_quest_target_troop, active_npcs_begin),
        (quest_set_slot, "qst_conspiracy", slot_quest_target_troop, ":enemy"),
        (str_store_troop_name, s20, ":enemy"),
        (add_quest_note_from_sreg, "qst_conspiracy", 3, "@After the interrogation of your guards {s20} was exposed as leader of the conspiracy. Now it is time to ask him some questions.", 0),
      (try_end),
      (troop_set_slot, "trp_array_villa_feast", ":slot", -1),
	  (try_end),
	  (add_quest_note_from_sreg, "qst_conspiracy", 4, "@It is up to you what happens to the other traitors. You may execute them.", 0),

    (change_screen_map),
  ]),
],),

("send_message_to_companion",0,
  "Which message do you want to send to {s6}.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (str_store_troop_name, s6, "$temp_troop")
  ],[
    ("follow_me",[
      (str_store_troop_name, s6, "$temp_troop")
    ],"{s6} shall return to me with his whole host as fast as possible",[
      (party_set_ai_object,"$temp4","p_main_party"),
      (party_set_ai_behavior,"$temp4",ai_bhvr_escort_party),
      (party_set_helpfulness, "$temp4", 10),
     	(start_presentation, "prsnt_companion_overview"),
		  (display_message, "@A messanger is sent."),
		]),
	  ("follow_me",[
      (str_store_troop_name, s6, "$temp_troop")
    ],"{s6} shall dismiss all troops and join me as fast as possible",[
	    (troop_set_slot, "$temp_troop", slot_troop_leaded_party, -1),
      (call_script, "script_destroy_party", "$temp4"),
      (start_presentation, "prsnt_companion_overview"),
     	(display_message, "@A runner is sent."),
		]),
	  ("nevermind",[],"Go back",[
		  (start_presentation, "prsnt_companion_overview"),
		]),
]),

("financial_crisis",0,
  "Signs of a crisis!^^You receive a message from the Quaestor. He seems worried about the state of the treasure. He suggest to raise taxes or try to lower costs by disbanding troops."
  +"^Whatever you do you should visit the capital and consult your advicers.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
	  ("financial_crisis_answere_1",[],"Continue",[
      (troop_set_slot, "$g_player_chamberlain", slot_troop_days_on_mission, 25),
      (change_screen_map),
    ]),
]),

("financial_crisis_2",0,
  "Financial crisis!^^Due to your high debts the people lose trust in you. Some say you will never pay anything back."
  +"^As you are not able to maintaine the high standard of Roman life, riots have started in several towns."
  +" Even your governors and legates and also other Roman nobles lose trust in your rule.",
  "none",[
    (call_script, "script_change_player_honor", -5),
    (call_script, "script_change_player_right_to_rule", -10),
    (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
        (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
        (store_faction_of_troop, ":fac", ":npc"),
        (eq, ":fac", "$players_kingdom"),
        (store_random_in_range, ":r", -10, 0),
        (call_script, "script_change_player_relation_with_troop", ":npc", ":r"),
    (try_end),
    (try_for_range, ":center", centers_begin, centers_end),
        (store_faction_of_party, ":fac", ":center"),
        (eq, ":fac", "$players_kingdom"),
        (store_random_in_range, ":r", -10, 0),
        (call_script, "script_change_player_relation_with_center", ":center", ":r"),
    (try_end),
	],[
	  ("financial_crisis2_answere_1",[],"Continue.",[
      (troop_set_slot, "$g_player_chamberlain", slot_troop_days_on_mission, 25),
      (val_add, "$g_unrest", 5),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
      (change_screen_map),
    ]),
]),

  (
    "ask_for_help",0,
    "As you walk through the streets two renowned citizens of the town give you a letter, saying it is from the magister civium. You open the letter and start reading^\
	The magister civium writes that they need your help. {s23} is a despotic governor, he embezzles funds, he judges unfair. He rules the town like his own property\
	and treats the citizens as his personal slaves. Futhermore, the magister civium pleads you to go to {s24} and ask him to remove {s23} as governor and appoint someone else.\
	As you are renowned and have a good reputation with the town, the magister civium would suggest you as new governor.\
	In addition, the magister civium says that you should not talk with him about this matter nor talk with {s23} and instead go directly to {s24},\
	as it is possible that {s23} may discover this plot. Last but not least, the magister civium outlines that the people of {s40} will always be grateful if you can help them in their needs.",
    "none",
    [
	(str_store_party_name, s40, "$current_town"),
	(set_background_mesh, "mesh_pic_townriot"),
	(party_get_slot, ":lord", "$current_town", slot_town_lord),
	(str_store_troop_name, s23, ":lord"),
	(store_faction_of_party, ":f", "$current_town"),
	(faction_get_slot, ":l", ":f", slot_faction_leader),
	(str_store_troop_name, s24, ":l"),
	],
    [
	  ("ask_for_help_answere1",[],
       "I should talk with {s24} immediately",
	[
	(party_set_slot, "$current_town", slot_party_time_service, 50),
	(setup_quest_text,  "qst_usurp_province"),
	(str_store_party_name, s30, "$current_town"),
	(store_faction_of_party, ":f", "$current_town"),
	(faction_get_slot, ":l", ":f", slot_faction_leader),
	(str_store_troop_name_link, s31, ":l"),
	(party_get_slot, ":lord", "$current_town", slot_town_lord),
	(str_store_troop_name_link, s33, ":lord"),
	(str_store_string, s2, "@The people of {s30} asked you to go and talk with {s31} about the corrupt governor {s33}. You may try to convince {s31} to appoint you as new governor."),
	(party_get_slot, ":magister", "$current_town", slot_town_elder),
	(quest_set_slot, "qst_usurp_province", slot_quest_temp_slot, 1),
	(quest_set_slot, "qst_usurp_province", slot_quest_target_troop, ":lord"),
	(quest_set_slot, "qst_usurp_province", slot_quest_target_dna, ":l"),
	(quest_set_slot, "qst_usurp_province", slot_quest_target_center, "$current_town"),
	(quest_set_slot, "qst_usurp_province", slot_quest_expiration_days, 120),
	(call_script, "script_start_quest", "qst_usurp_province", ":magister"),
	(call_script, "script_update_all_notes"),

	(change_screen_map),

	]),
  ("ask_for_help_answere1",[],
       "I don't have time for this...",
	[
	(party_set_slot, "$current_town", slot_party_time_service, 50),
  (call_script, "script_change_player_relation_with_center", "$current_town", -4),
	(change_screen_map),

	]),
    ]
  ),
  (
    "ask_for_help_senate",0,
    "As you walk through the streets two renowned citizens of the town give you a letter, saying it is from the magister civium. You open the letter and start reading^\
	The magister civium writes that they need your help. {s23} is a despotic governor, he embezzles funds, he judges unfair. He rules the town like his own property\
	and treats the citizens as his personal slaves. Futhermore, the magister civium pleads you to go to the senate (since the town is part of a senatorial province) and ask to remove {s23} as governor and appoint someone else.\
	As you are renowned and have a good reputation with the town, the magister civium would suggest you as new governor.\
	In addition, the magister civium says that you should not talk with him about this matter nor talk with {s23} and instead visit directly the senate,\
	as it is possible that {s23} may discover this plot. Last but not least, the magister civium outlines that the people of {s40} will always be grateful if you can help them in their needs.",
    "none",
    [
	(str_store_party_name, s40, "$current_town"),
	(set_background_mesh, "mesh_pic_townriot"),
	(party_get_slot, ":lord", "$current_town", slot_town_lord),
	(str_store_troop_name, s23, ":lord"),
	],
    [
	  ("ask_for_help_answere1",[],
       "I should visit the senate immediately",
	[
	(party_set_slot, "$current_town", slot_party_time_service, 50),
	(setup_quest_text,  "qst_usurp_province"),
	(str_store_party_name, s30, "$current_town"),
	(party_get_slot, ":lord", "$current_town", slot_town_lord),
	(str_store_troop_name_link, s33, ":lord"),
	(str_store_string, s2, "@The people of {s30} asked you to inform the senate about the corrupt governor {s33}. You may try to convince the senate to appoint you as new governor."),
	(party_get_slot, ":magister", "$current_town", slot_town_elder),
	(quest_set_slot, "qst_usurp_province", slot_quest_temp_slot, 1),
	(quest_set_slot, "qst_usurp_province", slot_quest_target_troop, ":lord"),
	(quest_set_slot, "qst_usurp_province", slot_quest_target_dna, -1),	##means senate
	(quest_set_slot, "qst_usurp_province", slot_quest_target_center, "$current_town"),
	(quest_set_slot, "qst_usurp_province", slot_quest_expiration_days, 120),
	(call_script, "script_start_quest", "qst_usurp_province", ":magister"),
	(call_script, "script_update_all_notes"),

	(change_screen_map),

	]),
  ("ask_for_help_answere1",[],
       "I don't have time for this...",
	[
	(party_set_slot, "$current_town", slot_party_time_service, 50),
  (call_script, "script_change_player_relation_with_center", "$current_town", -4),
	(change_screen_map),

	]),
    ]
  ),

("event_01_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Cattle judgment^^Your judgment is demanded: ^Two farmers, one very tall and lanky, the other low and stocky, were presented to you to discuss the ownership of a calf. " +
  "Apparently, their fields bordered each other, and the tall farmer had a bull that impregnated a cow belonging to the other. " +
  "The stocky farmer said the calf was his, because it was his cow giving birth. " +
  "The tall farmer claimed the calf to be his, being the offspring of his best bull. He said he should at least get stud fees.",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
  ],[
    ("choice_01_1nj",[],"The owner of the cow is right. The calf is his, just like the cow is.",[
      (call_script, "script_change_troop_renown", "trp_player", -2),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (str_clear,s1),
      (str_store_string,s1,"@The other man is not very happy and criticizes you when you leave, generating unfavorable rumors."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_01_2nj",[],"The owner of the bull is right. The bull is his and the calf too.",[
      (call_script, "script_change_troop_renown", "trp_player", -2),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (str_clear,s1),
      (str_store_string,s1,"@The other man is not very happy and criticizes you when you leave, generating unfavorable rumors."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_01_3nj",[],"The owner of the cow keeps the calf and pays compensation to the other.",[
      (display_message, "@Neither man is happy or unhappy. You seem to have found a balance."),
      (change_screen_return),
    ]),
    ("choice_01_4nj",[],"Neither is right. I'll slaughter the calf for its meat and give some to my men!",[
      (troop_add_item, "trp_player","itm_cattle_meat",0),
      (call_script, "script_change_troop_renown", "trp_player", -4),
      (call_script, "script_change_player_relation_with_center", "$current_town", -8),
      (call_script, "script_change_player_party_morale", 2),
      (str_clear,s1),
      (str_store_string,s1,"@The two men are not very happy and criticize you when you leave, generating unfavorable rumors."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_01_5nj",[],"Neither is right. Kill the calf and give the meat to both farmers!",[
      (call_script, "script_change_troop_renown", "trp_player", 2),
      (call_script, "script_change_player_relation_with_center", "$current_town", -8),
      (str_clear,s1),
      (str_store_string,s1,"@The two men are not very happy and criticize you when you leave, generating unfavorable rumors."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),

("event_02_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Murdered messenger^^The commander of the townguard approaches you:"
  +" Your highness, we captured a murderer! This is the man who attacked one of our messengers in {s4}, who is lying seriously injured in bed. "
  +" This doesn't show us in a good light, for the messenger was under your protection. However, the attacker has an interesting story, and he wishes to talk to you before his execution.^^"
  +" The prisoner's story: 'I would have never thought of attacking your messenger, but that man wished to sleep with my young daughter at night, and this offer was refused!"
  +" However, he did not accept our answer, entered my house with three friends, and raped my dear daughter, laughingly telling me all the while that you would never believe the word of a commoner. A father must protect his only child!'",
    "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (str_store_party_name, s4, "$current_town"),
  ],[
    ("choice_02_1nj",[],"Soldiers are under protection in Roman law. You and your family will be executed.",[
      (str_store_party_name, s4, "$current_town"),
      (troop_add_gold, "trp_player", 1000),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (call_script, "script_change_player_party_morale", 2),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} think that you will not guarantee their families' protection against those who abuse their power. Rumors spread that you are nothing more than a bad tyrant."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_02_2nj",[],"I will be reasonable: only you will be thrown to the beasts.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_change_player_party_morale", 2),
      (call_script, "script_change_player_relation_with_center", "$current_town", -3),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} think that you will not guarantee their families' protection because the messenger will not be punished. Rumors spread that you are unjust."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_02_3nj",[],"Even though he is under the protection of Roman law, I would have done the same. You can go.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -1),
      (call_script, "script_change_player_party_morale", -5),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} think that you will not guarantee their families' protection because the messenger will not be punished, but at least their fellow citizen will not be punished. However, your men are not happy with your generosity to a man who attacked a soldier."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_02_4nj",[],"I order to wip the messenger 50 times. No one should take advantage of their position.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_change_player_party_morale", -6),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} think that you will guarantee their families' protection, and they seem happy. However, your men are not happy that you will punish their companion."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_02_4nj",[],"I order to wip the messenger, but I will also punish the commoner, as he attacked the messanger.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", 3),
      (str_clear,s1),
      (str_store_string,s1,"@The people in {s4} and your troops are quite confused about your verdict. Luckily, none of them seems unhappy with your choice."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_03_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Abducted farmer's daughter^^Your judgment is demanded in a dispute. One is a local landowner, while the other is a farmer who rents the land of the landowner.^^" +
  "The man says his harvest was poor and cannot pay the rent, so the landowner took the farmer's daughter to his own bed and as a slave in his house. " +
  "The local landowner is an influential figure within {s4}, it is known that he is wealthy."+
  "Note, that the girl was not sold into slavery, so the taking was against the law, but the landowner claims the debt justifies it.",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
    (str_store_party_name, s4, "$current_town"),
  ],[
    ("choice_03_1nj",[],"Punish the farmer. He must pay rent to his lord.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -2),
      (call_script, "script_change_player_honor", -2),
      (jump_to_menu, "mnu_farmer_attack_lord"),
    ]),
    ("choice_03_2nj",[],"Punish the local landowner. He has no right to take the farmer's daughter.",[
      (str_store_party_name, s4, "$current_town"),
      (display_message, "@The local landowner is upset with you and talks bad about you to the elites of {s4}."),
      (call_script, "script_change_player_relation_with_center", "$current_town", -6),
      (call_script, "script_change_player_honor", 2),
      (str_clear,s1),
      (str_store_string,s1,"@The local landowner is upset with you and talks bad about you to the elites of {s4}."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_03_3nj",[],"Punish the famer, but only for a little 'pocket money' (recieve 5,000 denars) from the landowner.",[
		  (troop_add_gold, "trp_player", 5000),
		  (display_message, "@The local landowner gives you a heavy bag full of coins."),
      (call_script, "script_change_player_relation_with_center", "$current_town", -4),
		  (call_script, "script_change_player_honor", -2),
		  (jump_to_menu, "mnu_farmer_attack_lord"),
    ]),
    ("choice_03_4nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 300),
    ],"Compensate the landowner yourself for the tribute and send the girl back.",[
      (str_store_party_name, s4, "$current_town"),
      (display_message, "@Although the farmer has his daughter back, the noble didn't recieved the punishment he should have deserved. Thus the other farmers in {s4} are concerned about their daughters as you favor the powerful who take advantage of their weakness."),
      (call_script, "script_change_player_honor", 1),
      (troop_remove_gold, "trp_player", 300),
      (call_script, "script_change_player_relation_with_center", "$current_town", -4),
      (str_clear,s1),
      (str_store_string,s1,"@Although the farmer has his daughter back, the noble didn't recieved the punishment he should have deserved. Thus the other farmers in {s4} are concerned about their daughters as you favor the powerful who take advantage of their weakness."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_04_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Boys are boys^^Several complaints from local landowners are brought before you: They say that some of your soldiers abuse their position by requisition goods, boats and animals"
  +" and sometimes appropriating them by force. Even the daughter of a landowner was raped by a patrol of your men. The landowners are angry about the situation and demand justice."
  +" You should notice, that soldiers are the local representation of imperial power and therefore have a special status in Roman law.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("choice_02_1nj",[],"Boys are boys. I won't punish my men.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (call_script, "script_change_player_party_morale", 10),
      (str_clear,s1),
      (str_store_string,s1,"@The landowners are angry and people in {s4} think that you will not guarantee their families' protection against those who abuse their power. Rumors spread that you are nothing more than a bad tyrant."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_02_2nj",[],"I will be reasonable: I will punish the suldiers, but only for a little 'pocket money' (recieve 5,000 denars).",[
		  (troop_add_gold, "trp_player", 5000),
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_change_player_party_morale", -20),
      (str_clear,s1),
      (str_store_string,s1,"@That landowners of {s4} pay. They don't complain as they are glad to have protection against the abuse of your soldiers."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_02_4nj",[],"I order to punish the soldiers properly.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_change_player_party_morale", -20),
      (str_clear,s1),
      (str_store_string,s1,"@The landowners are happy and the people in {s4} think that you will guarantee their families' protection. However, your men are not happy as they think you should protect them."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_05_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Lost sons^^In {s4}, a man is brought before you. You are informed that he refuses to pay taxes. The man insists that he will not pay taxes until the Empire gives him back his boys, all of them killed in recent wars.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s4, "$current_town"),
  ],[
    ("choice_05_1nj",[],"This man has already lost enough. Forgive his taxes for life.",[
      (jump_to_menu, "mnu_nobody_want_paytax"),
    ]),
    ("choice_05_3nj",[],"Some soldiers die, others don't. Thats how it works. You will be sold into debt slavery if you don't pay your taxes, law demands it.",[
      (troop_add_gold, "trp_player", 5000),
      (call_script, "script_change_player_relation_with_center", "$current_town", -1),
      (call_script, "script_change_player_honor", -1),
      (str_store_party_name, s4, "$current_town"),
      (str_clear,s1),
      (str_store_string,s1,"@He still refuses to pay his taxes and thus, his property is seized and he is sold into slavery. There is some ill talk about you in {s4}, but an incident like this is too common whereby it won't cause any trouble for you."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_05_2nj",[],"Punish this man with death if he does not pay.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -15),
      (call_script, "script_change_player_honor", -3),
      (str_clear,s1),
      (str_store_string,s1,"@Eventually the man dies in torment while your soldiers try to force him to pay his taxes. His last words were, 'Boys, beyond, where you are, I am coming.' The city is shocked by his death, and many people complain about you in {s4}."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_06_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Ancient oaks^^Your judgment is demanded: The guards bring you two men. The guards say they are ready to kill each other. One of them has cut some old oaks that were blocking on the way, but they were actually within the borders of the estate of the other.^^" +
  "'Those trees made the passage of my cart difficult!' exclaims the first one. 'We are only talking about trees. I do not understand this suit!'^^" +
  "'Those trees were on my land, planted by my father, recently deceased,' shouts the other."+
  "The man who cut the trees would offer you a 'gift' of 2,000 denars if you punish the other.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_06_1nj",[],"The man who cut the trees must pay to the other in compensation.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", 3),
      (str_clear,s1),
      (str_store_string,s1,"@People think the measure is fair to both. Although the man who cut the trees is disappointed, that you don't took his gift but instead punished him."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_06_2nj",[],"Trees hindered the way. They had to be cut.",[
      (troop_add_gold, "trp_player", 2000),
      (call_script, "script_change_player_relation_with_center", "$current_town", -6),
      (str_clear,s1),
      (str_store_string,s1,"@The tree owner is not very happy and criticizes you when you leave, generating unfavorable rumors. On the other hand, the man who cut the trees is happy and gives you the promised 'gift'."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_06_3nj",[],"Publicly humiliate the man who cut the trees, as he wanted to bribe me. Additionally, he has to pay compensation to the other man.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", 3),
      (call_script, "script_change_player_honor", 3),
      (str_clear,s1),
      (str_store_string,s1,"@The people are surprised by your verdict, as it is very uncommon, that somebody is imprisoned for offering a bribe. Nevertheless, they seem to like your verdict."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_07_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Rising grain prices^^You are informed that a mob has gathered before the town hall. The angry citizens claim that you stockpile grain to raise the prices."
  +"^An adviser informs you that a shortage of grain recently caused an increase in prices.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_07_1nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 50000),
    ],"Import some wagons of grain from other places. (50,000 denars)",[
      (troop_remove_gold, "trp_player", 50000),
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 6),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} are happy because you responded to their needs."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_07_2nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (lt, ":gold", 50000),
    ],"I do not have enough money to buy food elsewhere.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -6),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} are unhappy with you because you don't respond to their needs."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_07_3nj",[],"Serves them right!",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_change_player_relation_with_center", "$current_town", -6),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} are unhappy with you because you don't respond to their needs."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_07_4nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 25000),
    ],"Buy some grain from the local market to alleviate the problem. (25,000 denars)",[
      (troop_remove_gold, "trp_player", 25000),
      (str_store_party_name, s4, "$current_town"),
      # (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} appreciate your help, but since you bought the grain from the local market, prices raised even more."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_08_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "A merchants gift^^An influential merchant approaches you stating that he has an illegitimate son (whom he favours) who wishes to join the army as officer."
  +" You agree to meet the boy, as it would be unseemly to reject a him outright." +
  " When you meet the boy, however, it is clear that he is a homebody, certainly not warrior material. But the merchant would offer you a 'gift' of 10,000 denars. Faced with this plump, smiling youth do you:",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_08_1nj",[],"Allow him to join your officers, he gains the rank as centurio, but refuse the gift.",[
      (str_store_party_name, s4, "$current_town"),
      (party_add_members, "p_main_party", "trp_centurio_west", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 4),
      (call_script, "script_change_player_party_morale", -15),
      (str_clear,s1),
      (str_store_string,s1,"@Although the merchant supports your position in {s4}, your men think it is a disgrace to have the boy among them."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_08_2nj",[],"Allow him to join your officers, he gains the rank as centurio and accept the gift.",[
      (party_add_members, "p_main_party", "trp_watchman", 1),
      (troop_add_gold, "trp_player", 10000),
      (call_script, "script_change_player_party_morale", -15),
      (str_clear,s1),
      (str_store_string,s1,"@Although the merchant pays you well, your men think it is a disgrace to have the boy among them."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_08_3nj",[],"Refuse. Only the best will serve as captains.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -4),
      (str_clear,s1),
      (str_store_string,s1,"@The merchant leverages his position to undermine yours in {s4} as punishment for you not accepting his son."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_08_3nj",[],"Refuse and publicly humiliate the merchant, as he wanted to bribe you. Only the best will serve as captains.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -2),
      (call_script, "script_change_player_honor", 3),
      (str_clear,s1),
      (str_store_string,s1,"@The merchant leverages his position to undermine yours in {s4} as punishment for you not accepting his son. But his ill-talk seems to have less effect, as you exposed him as being corrupt."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_09_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
 "Missing proofs^^A special case is brought before you: Two {s35} who visited the baths were robbed in the frigidarium. A lanky man and a busty girl were caught near the baths. The {s35} claim they are the thieves."
 +" The girl and the man assure their innocence. The stolen objects could not be found, which supports their claim of innocence. Meanwhile, an angry mob has gathered before the hall, shouting and screaming."
 +" They demand the blood of the thieves and insist that they be thrown to the beasts. You note the fear in the eyes of the accused. Tears are rolling down the girl's cheeks.",
  "none",[
    (store_random_in_range, ":r", "str_woman", "str_noble"),
    (str_store_string, s35, ":r"),
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s4, "$current_town"),
  ],[
    ("choice_03_1nj",[],"Throw them to the beasts, the mob demands it.",[
		  (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_change_player_honor", -5),
      (str_clear,s1),
      (str_store_string,s1,"@As you proclaim the verdict, you can see the fear of the accused. Knowing that death awaits them The girl throughs herself to your feets and begs you to spare her life. One of your guards removes her. They will be thrown to the beasts. The mob has what it wanted: A bloody spectacle. But you doubt that they are the real thieves."),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_02_1nj",[],"Let them go free as there is too little evidence.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", 5),
      (call_script, "script_change_player_relation_with_center", "$current_town", -12),
      (str_clear,s1),
      (str_store_string,s1,"@A little town riot emerged after you proclaimed the verdict. People in {s4} think that you will not guarantee their protection against thieves and robbers. Rumors spread that you are weak."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_02_2nj",[],"I will be reasonable: They will be sold as slaves.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (str_clear,s1),
      (str_store_string,s1,"@The angry mob is not happy about your verdict. But luckly a town riot was prevented. People in {s4} think that you will not guarantee their protection because the thieves lifes are spared. Rumors spread that you are unjust."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
   ]),
]),
("event_10_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Signs of doom^^A searing flash crosses the night sky. There is much talk of omens the next day. The people of {s4} generally agree that some act of sacrifice must be committed, or some divine wrath will befall the town." +
  " A message is send to consult the oracle of Delphi and it says that the people shall sacrifice a young girl."+
  " They find a germanic girl, whose father was an auxiliary, as the perfect sacrifice. A great ceremony will be hold in which the girl will be buried alive under the cattle market, but the town counsel has not enough founds."
  +" Thus they demand 5,000 denars from you to prevent any evil.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s4, "$current_town"),
  ],[
    ("choice_07_1nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 5000),
    ],"Agree with the demand. (5,000 denars)",[
      (troop_remove_gold, "trp_player", 5000),
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 6),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} are happy because you responded to their needs and you helped to prevent divine anger."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_07_2nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (lt, ":gold", 5000),
    ],"I do not have enough money...",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -6),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} are unhappy with you because you don't respond to their needs and you anger divine authorities."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_10_2nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 10000),
    ],"Take the girl into your party for safety, as she is the daughter of a soldier. But offer 10,000 denars for another sacrific.",[
      (troop_remove_gold, "trp_player", 10000),
      (call_script, "script_change_player_relation_with_center", "$current_town", 6),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (call_script, "script_change_party_morale", "p_main_party", 5),
      (party_add_members, "p_main_party", "trp_refugee", 1),
      (str_clear,s1),
      (str_store_string,s1,"@People in {s4} are happy because you responded to their needs and you helped to prevent divine anger. Your troops are also happy about you protection of their offsprings."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_10_2nj",[],"Nonsense. Forbid the sacrifice and take the girl into your party for safety.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -20),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_troop_renown", "trp_player", -50),
      (call_script, "script_change_party_morale", "p_main_party", 5),
      (party_add_members, "p_main_party", "trp_refugee", 1),
      (str_clear,s1),
      (str_store_string,s1,"@People, superstitious, are angry with you and fear the anger of divine authorities. Some time later, you find out that another girl was sacrificed. Your troops are happy that you protect their offsprings."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_11_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Sickness^^A runner arrives at your court, and after you allow it, starts to tell dire news. '{playername}, a nearby village is in great danger!"
  + " The populace has some kind of strange sickness, they can hardly move, sweat and vomit, and the priests and priestess has no cure for it."
  +" The local leader doesn't let anyone out at the moment and is expecting your orders!'",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (play_sound, "snd_disease_sound"),
  ],[
    ("choice_11_1nj",[(store_troop_gold, ":gold", "trp_player"),(ge, ":gold", 5000),],"Quarantine the place, but send the best area physicians to help! (5,000 denars)",[
      (troop_remove_gold, "trp_player", 5000),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 10),
      (str_clear,s1),
      (str_store_string,s1,"@The physician you send manages to save some lives and prevent the epidemic from spreading to other areas."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_11_2nj",[],"Quarantine the place! We will examine the survivors when the epidemic is over!",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (str_clear,s1),
      (str_store_string,s1,"@The epidemic wipes out the population of the village. Although your measures prevented anyone from spreading the disease beyond {s4}, many lost relatives who lived in the village. The rumor spreads that you are a murderer."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_12_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Stolen temple treasury^^Last day the treasury of a {s35} temple has been stolen. Today the thief was captured! The guards found the stolen treasuries in his house. He is surely guildy."
  +" As the people of {s4} hear from the capture, an angry mob gathers before the hall and demands his death. The mob wants blood. Thief's blood."
  +" Before you make the judgment, you hear the defendant: 'By the gods this is a terrible misunderstanding. I can't have stolen the treasury since I was not in town"
  +" as the crime happened. I was working on the estate of a landowner as day laborer.'",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (store_random_in_range, ":r", "str_worships_vest", "str_worships_christus"),
	  (str_store_string, s35, ":r"),
	  (str_store_party_name, s4, "$current_town"),
  ],[
    ("choice_03_1nj",[],"Throw him to the beasts, the mob demands thief's blood.",[
		  (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -4),
      (call_script, "script_change_player_honor", -5),
      (str_clear,s1),
      (str_store_string,s1,"@As you proclaim the verdict, you can see the fear of the accused. He will be thrown to the beasts. The mob has what it wanted: A bloody spectacle. But on the next day, the temple treasury was stolen again. He couldn't be the thief. The people of {s4} are angry with you, and say you have killed an innocent."),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_02_1nj",[],"Let him go free as there is too little evidence.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", 5),
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (str_clear,s1),
      (str_store_string,s1,"@A small town riot emerged after you proclaimed the verdict. People in {s4} think that you will not guarantee their protection against thieves and robbers. However, on the next day the temple treasury was stolen again. Maybe the accused man was the thief? Some days later you are informed that the accused man was murdered by a mob."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_02_2nj",[],"I will be reasonable: He will be sold as slave.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (str_clear,s1),
      (str_store_string,s1,"@The angry mob is not happy about your verdict. But luckly a town riot was prevented. However, on the next day the temple treasury was stolen again. The angry mob gathered and killed the accused man. People in {s4} think that you will not guarantee their protection against thieves and robbers."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),

("event_13_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Aunt and her nehpew^^You receive a petition of an influential woman: 'To {playername}, Prefect of {s4}. I ask you, my Lord, to give me as guardian {s35}, my nephew, in accordance with the Lex Julia et Titia."
  +" Dated in the consulship of Philippus Augustus and Philippus Caesar. Yours sincerely {s36}!' It seems that she wants to be the guardian of a little boy. Currently the father of the boy, a rich landowner, is the guardian."
  +" The slave who brought you the letter also informs you, that his Lady would offer you a 'gift' of 7,500 denars if you act in her favor.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s4, "$current_town"),
    (troop_get_slot, ":player_culture", "trp_player", slot_troop_culture),
    (call_script, "script_get_character_name_for_troop", tf_male, ":player_culture"),
    (str_store_string, s35, "@{s12}"),
    (call_script, "script_get_character_name_for_troop", tf_female, ":player_culture"),
    (str_store_string, s36, "@{s12}"),
  ],[
    ("choice_13_1nj",[],"Agree to this petition. But don't accept the gift",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (call_script, "script_change_troop_renown", "trp_player", -15),
      (call_script, "script_change_player_honor", -3),
      (str_clear,s1),
      (str_store_string,s1,"@The landowner was not happy about your decision and spreads rumors of your unjust behavior damaging your reputation and renown."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_13_1nj",[],"Agree to this petition and accept the gift.",[
      (troop_add_gold, "trp_player", 7500),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (call_script, "script_change_troop_renown", "trp_player", -15),
      (call_script, "script_change_player_honor", -3),
      (str_clear,s1),
      (str_store_string,s1,"@The landowner was not happy about your decision and spreads rumors of your unjust behavior damaging your reputation and renown."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_13_3nj",[],"Don't agree to this petition.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -2),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (call_script, "script_change_player_honor", -1),
      (str_clear,s1),
      (str_store_string,s1,"@The woman was not happy about your decision and spreads the word of your corruption."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
	  ("choice_13_3nj",[],"Don't agree to this petition, but demand a 'gift' of 15,000 denars from the landwoner",[
		  (troop_add_gold, "trp_player", 15000),
      (call_script, "script_change_player_relation_with_center", "$current_town", -2),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (call_script, "script_change_player_honor", -1),
      (str_clear,s1),
      (str_store_string,s1,"@The woman was not happy about your decision and spreads the word of your corruption."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_14_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Aged beauty^^You receive a petition of an influential woman: 'Laws have been made, my Prefect, which empower women who possess the right of three children to be mistresses of themselves"
  +" and acted without guardian in whatever business they like, especially if they know how to write. Since I am blessed with children and I am a literate woman, I"
  +" appeal your highness by this application with the object of being able to accompolish without hindrance any business I henceforth transact.'"
  +" She is known to be one of the most beautiful woman in {s4}, although her advanced age.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s4, "$current_town"),
  ],[
    ("choice_13_1nj",[],"Agree to this petition.",[
		  (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (str_clear,s1),
      (str_store_string,s1,"@The woman seems happy about your decision and spreads word that you are a honorable man."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_13_1nj",[],"Agree to this petition, but for a little pocket money (5,000 denars) from the woman.",[
      (troop_add_gold, "trp_player", 5000),
      (call_script, "script_change_player_relation_with_center", "$current_town", -1),
      (str_clear,s1),
      (str_store_string,s1,"@The woman gives you a sack full of coins. She seems a bit angry to pay for a purely bureaucratic act. She spreads the word of your greed."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_13_1nj",[],"Agree to this petition, but only if the woman ... let's say 'plays' a little bit with you.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -1),
      (call_script, "script_change_player_honor",  -2),
      (str_clear,s1),
      (str_store_string,s1,"@You personally inform the woman, by visiting her at home. As she understands what you want from her she is shocked, but since she needs this bureaucratic act to be done, she accepts your demand... The rumors were correct, the woman is indeed one of the most beautiful you ever encountered in bed."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_13_3nj",[],"Don't agree to this petition",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -4),
      (call_script, "script_change_troop_renown", "trp_player", -2),
      (str_clear,s1),
      (str_store_string,s1,"@The woman was not happy about your decision and spreads the word of your corruption."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_15_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Two mothers^^You are enjoying a bath when a messenger comes to your attentio:, 'Your highness, there is a situation in {s4} that needs your counsel.'"
  +" You dress and then walk to the town hall.^^A crowd has gathered there, arguing, but when you appear, it quickly falls silent. An elder bows to you and asks permission to speak,"
  +" which you give. He speaks: 'Your highness, we need your wisdom. Two women claim to be the mother of this child. Neither will defer.'^Two women are presented. One is in fine clothes and the other in rags.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s4, "$current_town"),
  ],[
    ("choice_15_1nj",[],"Give the child to the poor woman.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (str_clear,s1),
      (str_store_string,s1,"@The rich woman's husband, who happens to be a large landowner in {s4}, becomes very angry with you and damages your reputation."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_15_2nj",[],"Give the child to the rich woman.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (str_clear,s1),
      (str_store_string,s1,"@The poor people in {s4} get angry when you give the child to a rich woman without making a sincere determination."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_15_3nj",[],"Order to cut the child in half and give each half to one of the women.",[
      (jump_to_menu, "mnu_child_half_one"),
    ]),
]),
("event_16_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Troublemaker^^Your advisor wants to speak you: 'The poor are unhappy. Bandits have caused a grain prices to rise and due to high taxes many must starve."
  +" Now a troublemaker says that you live a life in luxus and extravagance while they starve to death. He incite the mob to a riot.' ^What will you do?",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_16_1nj",[],"And? I really don't care.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (str_clear,s1),
      (str_store_string,s1,"@The troublemaker continued to raise unrest in {s4}. Now they are openly against you and a town riot emerged but luckily your soldiers were able to restore order quickly."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_16_2nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 1000),
    ],"Bribe him with money to stop (1,000 denars).",[
      (troop_remove_gold, "trp_player", 1000),
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 4),
      (str_clear,s1),
      (str_store_string,s1,"@The troublemaker stops his spech and is happy about the money. Now he starts to praise your rule and the people of {s4} are very happy about you. The danger of a town riot is past."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_16_2nj",[],"Order your troops to make this idiot disappear.",[
      # (troop_remove_gold, "trp_player", 1000),
      # (call_script, "script_change_troop_renown", "trp_player", 3),
      (str_store_party_name, s4, "$current_town"),
      #(call_script, "script_change_player_relation_with_center", "$current_town", 8),
      (str_clear,s1),
      (str_store_string,s1,"@Without the troublemaker, the threat of a riot in {s4} has passed."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_17_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Supplies^^A peasant from a nearby village comes to you as a supplicant. He breathlessly reports that soldiers have raided his farm, carrying off women, cattle and grain."
  +" accused soldiers are brought before you. They argue, that they have confiscated goods and animals as supplies. But then the farmer has attacked them. As reaction,"
  +" the soldiers have taken his wife and daughter to punish the farmer for not obeying orders.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_17_1nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 1000),
    ],"Compensate the farmer and order to free the women (1,000 denars).",[
      (troop_remove_gold, "trp_player", 1000),
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_change_player_party_morale", -20),
      (str_clear,s1),
      (str_store_string,s1,"@The people of {s4} are very happy for your help in hard times. But your soldiers are angry since you don't protect them proper."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_17_2nj",[],"There is nothing to be done here. Away with you, mongrel!",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -7),
		  (call_script, "script_change_player_party_morale", 5),
      (str_clear,s1),
      (str_store_string,s1,"@The people of {s4} are angry that you don't care about their problems. But your soldiers are happy and have their fun with the women."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_17_2nj",[],"Goods have been confiscated, as law demands it, but the soldiers where not allowed to take the women. Hence I will release the women.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -1),
      (str_clear,s1),
      (str_store_string,s1,"@Angry with you, the farmer spreads some ill rumor in {s4}, but nothing serious. He seems to be happy to have his wife and daughter back, while your men are also happy for not being punished."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_18_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Witch^^A happy widow is accused of witchcraft after several townsmen of {s4} report pain while relieving themselves."
  +" A mob has gathered and demands the death of the witch. The happy widow is brought before you. She seems to be in her forties but still looks good."
  +" You see in their eyes all the merciless life of the lower class, all the mistreatment and torture. This woman is innocent, for sure.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s4, "$current_town"),
  ],[
    ("choice_18_1nj",[],"Order to exile her to another place.",[
      (str_clear,s1),
      (str_store_string,s1,"@The witch leaves the town for an unknown destination. The angry mob is disappointed, but luckily the mob soon dissipates."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_18_2nj",[],"Let her be. There are no witches.",[
      (str_clear,s1),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (str_store_string,s1,"@The woman thanks you, you have saved her life. But as she leaves the court, she is attacked and killed by the mob. The mob blames you, not to be able to protect them properly!"),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_18_3nj",[],"Throw her to the beasts, the mob wants a spectacle!",[
      (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      (str_clear,s1),
      (str_store_string,s1,"@The mob has what it demanded. The spectacle was a great success."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_19_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Dowry^^You judgmen is demanded: A man accuses his ex-wife to have taken more than her dowry. In Roman law a dowry has to be returned to the wife in case of divorce."
  +" The accused woman is a daughter of an influential member of the town counsel. The man is the son of a landowner, who is always short on money."
  +" The woman is using her 'female attributes' quite well and you are sure, what you can expect from her if you decide in her favor.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_13_1nj",[],"The woman must pay back the unlawfully appropriated funds.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (call_script, "script_change_troop_renown", "trp_player", -15),
      (call_script, "script_change_player_honor", -3),
      (str_clear,s1),
      (str_store_string,s1,"@The woman was not happy about your decision and her father too. He, as counsel member, spreads rumors of your unjust behavior damaging your reputation and renown."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_13_3nj",[],"The woman will not pay back anything, but there will be a 'private meeting' with the woman.",[
      (call_script, "script_change_troop_renown", "trp_player", -5),
		  (call_script, "script_change_player_honor", -1),
      (str_clear,s1),
      (str_store_string,s1,"@The man was not happy about your decision and his father, the landowner, spreads the word of your corruption. But the 'private meeting' was a total disasters. Although the woman looked good in her clothes, she looks terrible without them ... but there is no way out for you ... But the 'meeting' was not for nothing, she enjoyed it that much, that she helps to counter the rumors of the landowner."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_13_3nj",[],"The woman will not pay back anything.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -2),
      (call_script, "script_change_troop_renown", "trp_player", -10),
		  (call_script, "script_change_player_honor", -1),
      (str_clear,s1),
      (str_store_string,s1,"@The man was not happy about your decision and his father, the landowner, spreads the word of your corruption."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_13_3nj",[],"Only agree to the man's demand for a bribe of 5,000 denars!",[
      (troop_add_gold, "trp_player", 5000),
      (call_script, "script_change_player_relation_with_center", "$current_town", -4),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (call_script, "script_change_player_honor", -1),
      (str_clear,s1),
      (str_store_string,s1,"@The man pays the bribe, but was not happy about your decision and spreads bad rumors about you."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_20_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Widow^^A woman from a nearby village comes to you claiming that one of your men who died recently was her husband. She asks for assistance to take care of the remains, as she is poor and has nothing.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_20_1nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 1000),
    ],"Give her monetary assistance. (1000 denars)",[
      (troop_remove_gold, "trp_player", 1000),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_player_party_morale", 4),
      (str_clear,s1),
      (str_store_string,s1,"@Your men appreciate your concern for their families."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_20_2nj",[],"Do nothing. This isn't my problem.",[
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_change_player_party_morale", -8),
      (str_clear,s1),
      (str_store_string,s1,"@Your men are unhappy that you don't take care of their widows."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_20_3nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (lt, ":gold", 500),
    ],"Unluckily, I do not have money for this.",[
      (call_script, "script_change_player_party_morale", -4),
      (str_clear,s1),
      (str_store_string,s1,"@Your men are unhappy that you don't take care of their widows, but understand you are strapped at the moment."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),

("event_20_1_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Beautiful widow^^A woman from the town comes to you claiming that one of your men who died recently was her husband."
  +" She asks for assistance to take care of the remains. She is very beautiful and says, if you help her, you will receive a special 'gift'.",
  "none",
  [
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_20_1nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 500),
    ],"Give her monetary assistance and take the gift. (500 denars)",[
      (troop_remove_gold, "trp_player", 500),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_player_party_morale", 4),
      (str_clear,s1),
      (str_store_string,s1,"@Your men appreciate your concern for their families. The widow is happy too and shows you her 'gift': A night you won't forget so soon..."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_20_2nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 500),
    ],"Give her monetary assistance but refuse the gift. (500 denars)",[
      (troop_remove_gold, "trp_player", 500),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_player_party_morale", 4),
      (str_clear,s1),
      (str_store_string,s1,"@Your men appreciate your concern for their families. The widow seems surprised that you refused her 'gift', but is happy about the money."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_20_2nj",[],"Do nothing. This isn't my problem.",[
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_change_player_party_morale", -8),
      (str_clear,s1),
      (str_store_string,s1,"@No money, no gift and your men are unhappy that you don't take care of their widows."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_20_3nj",[
      (store_troop_gold, ":gold", "trp_player"),
      (lt, ":gold", 500),
    ],"Unluckily, I do not have money for this.",[
      (call_script, "script_change_player_party_morale", -4),
      (str_clear,s1),
      (str_store_string,s1,"@No money, no gift. Additionally, your men are unhappy that you don't take care of their widows, but understand you are strapped at the moment."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_21_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Preacher^^An angry mob gatheres before the town hall and demands your judgment in the probably most bizarre case you have ever heard:"
  +"^A preacher has angered the local people. He tells there is only one god, someone called Chrestos, who is angry about mankind and who will soon destroy everybody, who has not"
  +" yet poured water over his head (which he calls baptism) and confessed his sins. He calls the rituals and traditions of the people of {s4} barbaric and"
  +" tries to convert them to his religion.^He looks at you with eyes full of strength and resistance. It is clear that this man will never give up.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
	  (str_store_party_name, s4, "$current_town"),
  ],[
    ("choice_21_1nj",[],"He hasn't done anything wrong at all, so set him free.",[
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (str_clear,s1),
      (str_store_string,s1,"@The mob is angry and starts to through stones at you. Your guards get rid of the mob while you leave the hall through a backdoor."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_21_2nj",[],"This man is clearly dangerous, sell him as slave.",[
		  (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (str_clear,s1),
      (str_store_string,s1,"@The mob seems happy about your decision and the preacher is sold into slavery."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_21_2nj",[],"This man is clearly dangerous, crucify him.",[
      (call_script, "script_change_player_honor", 2),
		  (call_script, "script_change_player_relation_with_center", "$current_town", 10),
      (str_clear,s1),
      (str_store_string,s1,"@The mob seems happy about your decision and screams and shouts while they watch how the preacher is crucified."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_22_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Thief!^^Your judgment is demanded: It is a seemingly straightforward case. Yesterday, the accused man broke into the victim's house and removed large amounts of wealth." +
  " Many people saw him, and the missing items were discovered in his house. The victim is an influential citizen and one of your main enemies,"
  +" had actually served as a councillor in the town counsel and was known to be of doubtful loyalty."
  +" The accused, on the other hand, happens to be one of your most vocal supporters and a major donor to your cause.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_22_1nj",[],"Ignoring the evidence, you settle in your supporter's favor.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_party_morale", 2),
      (call_script, "script_change_player_relation_with_center", "$current_town", -8),
      (str_clear,s1),
      (str_store_string,s1,"@Your followers feel that you will protect them at any cost, but the people in {s4} are not very happy with your decision. They criticize you when you leave, generating unfavorable rumors. But luckily, no town riot emerged."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_2nj",[],"The evidence is clear, and the accused is found guilty.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_party_morale", -8),
      (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      (str_clear,s1),
      (str_store_string,s1,"@Your followers feel that you do not protect them as they deserve for their services, but the people in {s4} are very happy with your decision. The rumor spreads that you are just."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_3nj",[],"Both are wrong! You exile them and confiscate their wealth. (75,000 denars)",[
      (troop_add_gold, "trp_player", 75000),
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", -25),
      (call_script, "script_change_player_party_morale", -15),
      (call_script, "script_change_player_relation_with_center", "$current_town", -30),
      (str_clear,s1),
      (str_store_string,s1,"@Your followers feel that you do not protect them as they deserve for their services. The people in {s4} are not very happy with your decision. They criticize you when you leave, generating unfavorable rumors. But luckily, no town riot emerged."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_23_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Mother and her daughter^^Your judgment is demanded. A widow askes you to receive as guardian her daughter, a eighteen years old beauty, in accordance with the Lex"
  +" Julia et Titia. Dated in the consulship of Philippus Augustus and Philippus Caesar. Currently, the daughter lives by her brother."
  +" The widow is a quite old woman, but very wealthy while her brother is very poor."
  +" The woman would also offer you a 'gift' if you act in her favor.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_22_1nj",[],"Take the 'gift' and decide in her favor. (7,500 denars)",[
      (str_store_party_name, s4, "$current_town"),
      (troop_add_gold, "trp_player", 7500),
      (call_script, "script_change_player_relation_with_center", "$current_town", -1),
      (call_script, "script_change_troop_renown", "trp_player", -1),
      (str_clear,s1),
      (str_store_string,s1,"@The widow is happy and pays you well. On the other hand, her brother is angry and tries to spread ill rumor about you. But since he is not very influential, he only makes small damage."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_2nj",[],"I will decide in her favor, but as 'gift' I demand a night with her daughter.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (call_script, "script_change_player_relation_with_center", "$current_town", -8),
      (str_clear,s1),
      (str_store_string,s1,"@The widow seems to be shocked and refuses your shameful demand and spreads rumors about you, damaging your renown, reputation and relation with {s4}."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_3nj",[],"Refuse her proposal.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (str_clear,s1),
      (str_store_string,s1,"@The widow is angry and spreads rumors about you, damaging your renown and relation with {s4}"),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_3nj",[],"Refuse her proposal and humiliate her. She tried to bribe you!",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -2),
      (call_script, "script_change_player_honor", 3),
      (str_clear,s1),
      (str_store_string,s1,"@The widow is angry and spreads rumors about you, damaging your renown and relation with {s4}. But since you humiliated her, people in {s4} don't really believe her talk."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_24_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Runaway Cartel^^Craftsmen's guilds have existed for a long time in {s22}, helping professionals hone their skills, collectively solve problems and advocate for their issues."
  +" Recently, however, a very ambitious man became the head of the tailors guild and complaints of their behavior have been increasing. Any non-guildsman who tries to work in the city endures beatings, arson and sometimes murder."
  +" The guild shops, meanwhile, have been steadily raising their prices to the point where a fitting now costs ten times as much as it used to. Poorer residents have started learning how to tailor their own clothes or switched to outfits"
  +" that do not require tailoring. Richer ones complain to you incessantly about the guild's dishonest practices.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s22, "$current_town"),
  ],[
    ("choice_22_1nj",[]," Let it sort itself out.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (call_script, "script_change_center_prosperity", "$current_town", -5),
      (str_clear,s1),
      (str_store_string,s1,"@The people's business dealings are not your concern. However, the situation does not improve. After prices reach twenty times previous levels, the new guild master is found murdered with coins shoved down his throat. Prices return to normal, but the people are angry you did nothing."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_1nj",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 5000),
    ],"Bribe the guildmaster. (cost: 5000 denars)",[
      (troop_remove_gold, "trp_player", 5000),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (str_clear,s1),
      (str_store_string,s1,"@As ambitious and fierebrand as he is in public, the man makes the right choice between silver and steel. The guild's behavior becomes somewhat more reasonable and citizens applaude your negotiating skill."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_1nj",[],"Enact punitive taxes.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", 10),
      (call_script, "script_change_center_prosperity", "$current_town", 2),
      (str_clear,s1),
      (str_store_string,s1,"@You give fair warning to the ambitious leader of tailors, but he is not receptive. The next day, tax collectors and soldiers appear at the guild-affiliated businesses, notifying them that a tailoring permit is now required to operate their business in the city, at a modest price of 10000 denars each. The industry is shut down and the guild quickly announces the appointment of a new master, who negotiates reasonable terms."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_1nj",[],"Attack tailor businesses.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_change_center_prosperity", "$current_town", -10),
      (str_clear,s1),
      (str_store_string,s1,"@Your men are greeted with cheering crowds when they march down to the tailor shops all over the city and ransack them. Goods and tools are destroyed, tailors beaten and sometimes worse. The crowds had their vengence, but the city's industry has been badly damaged."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_25_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Economic Downturn^^Recent events outside of {s22} have disrupted trade, leaving many citizens with smaller or no incomes as the effects propagate through the economy."
  +" Several prominent guildmasters come to you asking to invest in upgrading the city walls, fountains, sewers and other infrastructure, arguing you will get good prices and give suffering people work.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s22, "$current_town"),
  ],[
    ("choice_22_1nj",[],"Do nothing",[
      (call_script, "script_change_center_prosperity", "$current_town", -10),
      (str_clear,s1),
      (str_store_string,s1,"@The downturn continues until outside conditions improve, but the city prosperity is damaged."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_1nj",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 50000),
    ],"Pay for the upgrades. (costs: 50,000 denars)",[
      (troop_remove_gold, "trp_player", 50000),
      (call_script, "script_change_player_relation_with_center", "$current_town", 10),
      (call_script, "script_change_center_prosperity", "$current_town", 5),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (str_clear,s1),
      (str_store_string,s1,"@The projects help tide the city over and when trade improves, the prosperity grows even further."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_26_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Prosperous Times^^{s22} finds itself in an unexpectedly advantageous position after disasters hurt your industry's usual competitors. Trade traffic is up, markets are busy,"
  +" and workshops produce late into the night to sell more of their goods at inflated prices. Your citizens are very happy with the river of silver suddenly flowing into the city.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s22, "$current_town"),
  ],[
    ("choice_22_1nj",[],"Do nothing",[
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_change_center_prosperity", "$current_town", 15),
      (str_clear,s1),
      (str_store_string,s1,"@The city is grateful for your hands-off approach, prosperity is everywhere and the mood is generally jovial."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_1nj",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 5000),
    ],"Promote charity. (cost: 5,000 denars)",[
      (troop_remove_gold, "trp_player", 5000),
      (call_script, "script_change_player_relation_with_center", "$current_town", 10),
      (call_script, "script_change_center_prosperity", "$current_town", 10),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (call_script, "script_add_piety", 5, 1),
      (call_script, "script_change_player_honor", 4),
      (str_clear,s1),
      (str_store_string,s1,"@You set an example, donating to the less fortunate and paying for temple repairs. The trend catches on among the community now flush with money and before long it is hard to find a destitute person anywhere in the city. People feel good about themselves and as the leader of this trend, your reputation is lifted sky-high."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_22_1nj",[],"Enact new taxes. (prospected income: 75,000 denars)",[
      (troop_add_gold, "trp_player", 75000),
      (call_script, "script_change_player_relation_with_center", "$current_town", -30),
      (str_clear,s1),
      (str_store_string,s1,"@While people are never happy parting with their silver, having more makes it tolerable. Now is the best time as any to put a new tax in place. Your treasury is prospering, but there is some discontent as well."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("event_27_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Is this art?^^Free entertainment is an important perk of being a Roman and theater is a popular passtime for plebs and the wealthy alike."
  +" Another is philosophy, practiced from the most esteemed noble thinkers clad in senatorial robes to the common unwashed homeless street philosophers in rags."
  +"^^One day the two collided, as a rag-clad, barrel-dwelling follower of Diogenes decided to repeat the stunt of the old Greek Cynic in front of you."
  +" He rushed to the front of the theater in the middle of a performance, bared himself and produced a large, seamy pile of fresh excrement in the middle of the stage, much to the shock of the attending public."
  +"^^Naturally, he is quickly apprehended and attention turns to you to decide his fate.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
    (str_store_party_name, s22, "$current_town"),
  ],[
    ("option_1",[],"Applaud and ask him if you could do him any favor.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (try_for_range, ":lords", lords_begin, kingdom_ladies_end),
        (neg|troop_slot_eq, ":lords", slot_troop_occupation, dplmc_slto_dead),
        (troop_slot_eq, ":lords", slot_troop_culture, "fac_culture_7"),#Roman
        (store_faction_of_troop, ":fac", ":lords"),
        (eq, ":fac", "$players_kingdom"),
        (store_attribute_level, ":int", ":lords", ca_intelligence),
        (ge, ":int", 19),
        (store_random_in_range, ":random", 0, 20),
        (eq, ":random", 1),
        (call_script, "script_change_player_relation_with_troop", ":lords", 3),
      (try_end),
      (call_script, "script_change_senate_support", 1, 0),
      (str_clear,s1),
      (str_store_string,s1,"@The philosopher grins happily, impressed by your knowledge of Diogenes' story. He completes the exchange as per the fable, asking you to stand out of his sun. ^^A few of the more educated citizens smile, recognizing the conversation between Diogenes and Alexander, but the intricacy is lost on most people who simply see you having an odd conversation with a disrespectful troublemaker instead of punishing him. The plebs do not like this, but word of your erudition spreads among nobility."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_2",[],"Have him beaten as punishment.",[
      (str_clear,s1),
      (str_store_string,s1,"@At your command the guards use sticks to administer some swift and harsh Roman justice. The crowd expected this and is happy to watch. The whole event becomes an integral part of the day's entertainment and no more than a curious talking point."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_3",[],"Crucify him on stage and continue the play.",[
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (call_script, "script_change_player_honor", -5),
      (str_clear,s1),
      (str_store_string,s1,"@Administering punishment normally reserved for grave crimes to a crazed troublemaker is seen as harsh, but not to the point of causing unrest. The crowd is split between those who cheer and revel in the inclusion of some unexpected blood in the theatrical performance and those uncomfortable watching the man's drawn-out final suffering as a backdrop to a comedy performance. ^^As for the crazy philosopher himself, his eyes burn with excitement, and he even laughs at some of the jokes performed by the actors. Whether he hoped for it or not, your actions fit well into his art, and history may remember this story."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),

("event_28_juicio", menu_text_color(0xFF000000) | mnf_disable_all_keys,
  "Public buildings are evil^^The noble {s22} has estates near the town of {s23}. A {s24} has been built near one of his estates with public funds."
  + " After the building was finished, a warehouse on {s22}'s estate collapsed. He now claims that the construction works of the public building have damaged his property."
  + " In particular, he demands compensation of 100,000 denars. The praetors have already refused his request, but {s22} has now brought the case to you.",
  "none", [
    (try_begin),
        (call_script, "script_cf_get_random_lord_of_faction", "$players_kingdom"),
        (assign, "$temp", reg0),
        (str_store_troop_name_plural, s22, "$temp"),
        (set_background_mesh, "mesh_pic_governor_judgment"),
        (str_store_party_name, s23, "$current_town"),
        (store_random_in_range, ":string", "str_building_1", "str_building_end"),
        (str_store_string, s24, ":string"),
    (else_try),
        (jump_to_menu, "mnu_auto_return_map"),
    (try_end),
  ], [
    ("option_1", [
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 100000),
    ], "{s22} is right. The {s24} should not have been built near his estate. [cost: 100,000 denars]", [
      (str_clear, s1),
      (call_script, "script_change_player_relation_with_troop", "$temp", 50),
      (troop_remove_gold, "trp_player", 100000),
      (str_store_string, s1, "@{s22} is very happy about your decision. He gladly takes the money."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_2", [
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 50000),
    ], "{s22} is right. The {s24} should not have been built near his estate. But his demand is too high. Pay him only 50,000 denars.", [
      (str_clear, s1),
      (call_script, "script_change_player_relation_with_troop", "$temp", 15),
      (troop_remove_gold, "trp_player", 50000),
      (str_store_string, s1, "@Although {s22} received only half of the demanded amount, he is still happy about your decision. He gladly takes the money."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_3", [
    ], "{s22} is right. The {s24} should not have been built near his estate. But you don't have money to pay him.", [
      (str_clear, s1),
      (call_script, "script_change_player_relation_with_troop", "$temp", -20),
      (str_store_string, s1, "@{s22} is angry about your decision. He starts spreading rumors in {s23} about your tyrannical rule and how evil the state as a whole is."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_4", [
    ], "{s22} is wrong. The {s24} was built for the good of the people.", [
      (str_clear, s1),
      (call_script, "script_change_player_relation_with_troop", "$temp", -20),
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (str_store_string, s1, "@{s22} is angry about your decision. He starts spreading rumors in {s23} about your tyrannical rule and how evil the state as a whole is."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),

("event_29_juicio", menu_text_color(0xFF000000) | mnf_disable_all_keys,
  "Renovating a temple^^The college of priests is asking for 50,000 denars to renovate an old temple, which has been build several centuries ago."
  +" The temple was once a great side of the town, but has been neglected by time.",
  "none", [
    (set_background_mesh, "mesh_pic_girls"),
  ], [
    ("option_1", [
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 50000),
    ], "Donate 50,000 denars.", [
      (str_clear, s1),
      (call_script, "script_add_piety", 10, 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (troop_remove_gold, "trp_player", 50000),
      (str_store_string, s1, "@The priests are happy about your donation and spread word of your wisdom and wealth."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_2", [
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 25000),
    ], "Donate only 25,000 denars.", [
      (str_clear, s1),
      (call_script, "script_add_piety", 5, 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      (troop_remove_gold, "trp_player", 25000),
      (str_store_string, s1, "@The priests are happy about your donation, although its less than the expected sum. They spread word of your wisdom and wealth."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_3", [
    ], "Donate nothing.", [
      (str_clear, s1),
      (call_script, "script_add_piety", -5, 1),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (str_store_string, s1, "@The priests are angry and spread word about your greed."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),

("event_30_juicio", menu_text_color(0xFF000000) | mnf_disable_all_keys,
  "The collapse of the spectacle^^The sun blazed down on the arena, where thousands of citizens had gathered to witness the grand spectacle of gladiatorial combat. The roar of the crowd echoed through the amphitheatre as fierce warriors clashed below. It was supposed to be a day of glory, a day to honor the gods and entertain the masses. Instead, it became a day of horror."
  +"^Amidst the brutal fights, a deep rumble resonated through the structure. Before anyone could react, the stone seating along the eastern side of the amphitheatre began to crack and crumble. In a matter of seconds, the entire section gave way, collapsing in a deafening roar. Hundreds of spectators were crushed under the falling debris, their screams of excitement turning into cries of terror. The dust and chaos engulfed the arena, transforming the grand celebration into a nightmare."
  +"^As the governor of the town, you are immediately summoned to assess the catastrophe.",
  "none", [
    (set_background_mesh, "mesh_pic_building_project"),
  ], [
    ("option_1", [
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 50000),
    ], "Make sacrifices to appease the gods and compensate the victims. [50,000 denars]", [
      (str_clear, s1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_change_player_honor", 5),
      (troop_remove_gold, "trp_player", 50000),
      (str_store_string, s1, "@The priesthood is pleased with the influx of additional funds, while the people commend your generosity. Your swift and decisive actions help to overshadow the tragedy, restoring a sense of stability and hope in the aftermath."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_2", [
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 25000),
    ], "Make sacrifices only. [25,000 denars]", [
      (str_clear, s1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      (call_script, "script_change_player_honor", 1),
      (troop_remove_gold, "trp_player", 25000),
      (str_store_string, s1, "@The priesthood is pleased with the additional funds, but the people had hoped for more recognition of their losses. Despite this, your actions have managed to somewhat overshadow the tragedy, bringing a measure of stability and hope in the aftermath."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_3", [
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 25000),
    ], "Compensate the victims only. [25,000 denars]", [
      (str_clear, s1),
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (call_script, "script_change_player_honor", 2),
      (troop_remove_gold, "trp_player", 25000),
      (str_store_string, s1, "@The people commend your generosity, but the priesthood is discontented by the perceived lack of pietas. Nonetheless, your actions manage to somewhat overshadow the tragedy, bringing a degree of stability and hope in the aftermath."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_4", [
    ], "Order a deep investigation.", [
      (str_clear, s1),
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (call_script, "script_change_player_honor", -2),
      (str_store_string, s1, "@Your investigation quickly spirals into a chaotic blame game, with officials pointing fingers at one another. In the end, the exact cause of the tragedy remains unclear. Worse yet, your inquiry backfires, as suspicions of corruption begin to circle around you."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("option_5", [
    ], "Do nothing.", [
      (str_clear, s1),
      (call_script, "script_change_player_relation_with_center", "$current_town", -25),
      (call_script, "script_change_player_honor", -15),
      (str_store_string, s1, "@Your decision to remain inactive sends shockwaves through the town. The lack of leadership fuels anger and unrest among the populace, who begin to see you as indifferent to their suffering. Rumors of negligence and corruption spread rapidly, undermining your authority. The tragedy that could have been managed now threatens to spiral into full-blown chaos."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),

("event_juicio_end",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s1}",
  "none",[
      (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_end_3nj",[],"Continue.",[
      (change_screen_map),
    ]),
]),

("farmer_attack_lord",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Not satisfied with your decision, the farmer pulls out his knife and pounces on the landowner, killing him before the guards can do anything. " +
  "Then he turns to you and says, 'This is justice, bastard!' Then with the same knife, he kills himself.",
  "none",[
  ],[
    ("choice_03_1attackj",[],"Continue.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -8),
      (call_script, "script_change_troop_renown", "trp_player", -6),
      (str_clear,s1),
      (str_store_string,s1,"@The outcome of the trial has seriously shaken the people of {s4} and has called into question your authority."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),
("nobody_want_paytax",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Suddenly, the room where you exercise your legal authority is crowded with people who have lost sons to war, all demanding equal treatment.",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_05_2notaxj",[
      (store_troop_gold, ":gold", "trp_player"),
      (ge, ":gold", 2000),
    ],"Distribute bags of money among the people as compensation (2000 denars).",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 8),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (troop_remove_gold, "trp_player", 2000),
      (str_clear,s1),
      (str_store_string,s1,"@Your renown with your warriors suffers, as does your money bag, but the people of {s4} seem happy with the money you have given them."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_05_3notaxj",[],"Having no money for all these people, you order your men to disperse the crowd.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -8),
      (store_random_in_range, ":p_leave", 5, 10),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
      (try_end),
      (call_script, "script_change_player_party_morale", -6),
      (str_clear,s1),
      (str_store_string,s1,"@Your men push the crowd, injuring some. Suddenly, the people turn against them, causing some casualties before being dispersed."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_05_3notaxj",[],"Run out, escorted by your men, away from the crowd.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -5),
      (call_script, "script_change_troop_renown", "trp_player", -9),
      (str_clear,s1),
      (str_store_string,s1,"@You run through the back door while the crowd calls you a coward and miser, even as they continue to beg for money."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
]),

("child_half_one",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Then the woman in rags screams and says, 'No, please my lord, let the other women have the child then.'^^Then the elder near you exclaims, 'So you are the rightful mother and this child belongs to you!'^^" +
  "The other woman seems uneasy, 'I can give that child a better life than always living in poverty.'",
  "none",[
    (set_background_mesh, "mesh_pic_governor_judgment"),
  ],[
    ("choice_half1pj",[],"Give the child to the poor woman and punish the rich woman for lying.",[
      (call_script, "script_change_player_honor", 2),
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", 15),
      (str_clear,s1),
      (str_store_string,s1,"@Everyone in {s4} thinks you've been wise and just to find the mother of the child and return the baby, while punishing the liar without being influenced by her wealth."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_half2pj",[],"Give the child to the poor woman and the rich woman to the crowd.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -15),
      (str_clear,s1),
      (str_store_string,s1,"@The crowd kills the rich woman. The rich woman's husband, who happens to be a large landowner in {s4}, becomes very angry with you and damages your reputation."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_half3pj",[],"Give the child to the rich woman.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -15),
      (store_random_in_range, ":p_leave", 4, 8),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
      (try_end),
      (str_clear,s1),
      (str_store_string,s1,"@The poor people in {s4} get angry when you give the child to a rich woman without making a sincere determination. " +
      "Some disturbances ending in violence occur. During the fighting, many citizens die before retiring, but you also lose some men."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("choice_half4pj",[],"Give the child to the rich woman and poor woman to your men.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_relation_with_center", "$current_town", -15),
      (store_random_in_range, ":p_leave", 8, 12),
      (assign, ":num_troops", ":p_leave"),
      (try_for_range, ":unused", 0, ":num_troops"),
        (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
      (try_end),
      (call_script, "script_change_player_party_morale", 5),
      (party_add_members,"p_main_party","trp_refugee",1),
      (str_clear,s1),
      (str_store_string,s1,"@The poor people in {s4} get angry when you give the child to a rich woman without making a sincere determination. " +
      "Some disturbances ending in violence occur. During the fighting, many citizens die before retiring, but you also lose some men."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
      ]),
]),
("random_juice_events",0, #final menu, load presentation to consequences
  "Events",
  "none",[
    (start_presentation, "prsnt_random_event_solution"),
  ],[
    ("leave_jui",[],"Leave.",[
      (leave_encounter),
      (jump_to_menu, "mnu_auto_return_map"),#phaiak
    ]),
]),

("riots_01",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Riot!^^Your relation with {s4} is very bad. As you walk its streets, people look at you hatefully and make gestures behind your back. " +
  "You get beyond a corner, and you're safe -- until several people begin to emerge. Ordinary citizens are tired of your government and begin to insult you. Finally, someone becomes bold enough to pull a knife and attack you.",
  "none",[
    (set_background_mesh, "mesh_pic_townriot"),
    (str_store_party_name, s4, "$current_town"),
  ],[
    ("deffend_yr",[],"Defend yourself.",[
      (try_begin),
        (party_slot_eq, "$current_town", slot_party_type, spt_village),
        (party_get_slot, ":cur_scene", "$current_town", slot_castle_exterior),
      (else_try),
        (party_get_slot, ":cur_scene", "$current_town", slot_town_center),
      (try_end),
      (modify_visitors_at_site, ":cur_scene"),
      (reset_visitors),

      (set_jump_mission, "mt_bandits_at_night"),

      (assign, ":spawn_amount", 4),
      (assign, "$num_center_bandits", 0),
      (val_add, "$num_center_bandits",  ":spawn_amount"),
      (try_begin),
        (party_slot_eq, "$current_town", slot_party_type, spt_village),
        (set_visitors, 4, "trp_peasant_woman", ":spawn_amount"),
      (else_try),
        (party_slot_eq, "$current_town", slot_party_type, spt_castle),
        (set_visitors, 33, "trp_peasant_woman", ":spawn_amount"),
      (else_try),
        (set_visitors, 28, "trp_peasant_woman", ":spawn_amount"),
      (try_end),
      (assign, ":spawn_amount", 16),
        (try_begin),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_1"),
          (assign, ":rebel_troop", "trp_dacian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2"),
          (assign, ":rebel_troop", "trp_celtic_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_2_1"),
          (assign, ":rebel_troop", "trp_celtic_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_3"),
          (assign, ":rebel_troop", "trp_sarmatian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_4"),
          (assign, ":rebel_troop", "trp_germanic_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_5"),
          (assign, ":rebel_troop", "trp_armenian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_6"),
          (assign, ":rebel_troop", "trp_parthian_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
          (assign, ":rebel_troop", "trp_roman_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_9"),
          (assign, ":rebel_troop", "trp_bosporan_village_walker"),
        (else_try),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_8"),
          (assign, ":rebel_troop", "trp_judean_village_walker"),
        (try_end),
      (try_begin),
        (party_slot_eq, "$current_town", slot_party_type, spt_village),
        (set_visitors, 32, ":rebel_troop", ":spawn_amount"),
      (else_try),
        (party_slot_eq, "$current_town", slot_party_type, spt_castle),
        (set_visitors, 42, ":rebel_troop", ":spawn_amount"),
      (else_try),
        (set_visitors, 11, ":rebel_troop", ":spawn_amount"),
      (try_end),
      (val_add, "$num_center_bandits",  ":spawn_amount"),
      (assign, ":spawn_amount", 8),
      (try_begin),
        (party_slot_eq, "$current_town", slot_party_type, spt_village),
        (set_visitors, 34, "trp_watchman", ":spawn_amount"),
      (else_try),
        (party_slot_eq, "$current_town", slot_party_type, spt_castle),
        (set_visitors, 42, "trp_watchman", ":spawn_amount"),
      (else_try),
        (set_visitors, 11, "trp_watchman", ":spawn_amount"),
      (try_end),
      (val_add, "$num_center_bandits",  ":spawn_amount"),
      (assign, "$town_entered", 1),
      (assign, "$all_doors_locked", 1),

      (display_message, "@To arms! Some citizens have revolted and try to kill you!", 0xFFFF2222),

      (jump_to_scene, ":cur_scene"),
      (change_screen_mission),
    ]),
]),

("riots_02",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Attack on garrison^^An angry mob insulted your name, blamed a group of your soldiers walking the streets for all their ills, and attacked and killed them all. " +
  "You should improve your relations with {s4} as soon as possible.^^{s44}",
  "none",[
    (set_background_mesh, "mesh_pic_townriot"),
    (str_store_party_name, s4, "$current_town"),
    (store_random_in_range, ":p_leave", 4, 12),
    (assign, ":num_troops", ":p_leave"),
    (try_for_range, ":unused", 0, ":num_troops"),
      (call_script, "script_cf_party_remove_random_regular_troop", "$current_town"),
    (try_end),
    (str_clear, s44),
    (try_begin),
      (store_party_size_wo_prisoners, ":size", "p_main_party"),
      (gt, ":size", 200),
      (str_store_string, s44,"@Note the following: Before you exterminate the population, you should take out the whole garrison, otherwise, it will be disbanded automatically."),
    (try_end),
  ],[
    ("deffend_01ri",[],"Order your men to kill the perpetrators and seize their possessions.",[
		  (party_get_slot, ":capital", "$current_town", slot_center_capital),
		  (store_mul, ":new_capital", ":capital", 2),
		  (val_div, ":new_capital", 3),
		  (store_sub, ":player_money", ":capital", ":new_capital"),
      (troop_add_gold, "trp_player", ":player_money"),
      (party_set_slot, "$current_town", slot_center_capital, ":new_capital"),
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_player_party_morale", 10),
      (call_script, "script_change_player_relation_with_center", "$current_town", -10),
      (str_clear,s1),
      (str_store_string,s1,"@Your men charge down the streets, using the sword at the slightest provocation, avenging their fallen fellows. A bloodbath ensues as the people of {s4} flee to their homes to hide."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("deffend_02ri",[],"I will not rule by fear. I have to improve relations by other means.",[
      (str_store_party_name, s4, "$current_town"),
      (call_script, "script_change_player_party_morale", -10),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (str_clear,s1),
      (str_store_string,s1,"@Your men are very angry that you have taken no action against the murder of their fellows. Meanwhile, local leaders try to quell the hatred against you in {s4}."),
      (display_message, "@{s1}"),
      (jump_to_menu, "mnu_random_juice_events"),
    ]),
    ("deffend_03ri",[
      (store_party_size_wo_prisoners, ":size", "p_main_party"),
      (gt, ":size", 200),
    ],"Exterminate the population of the entire city and settle people of your culture, loyal to you.",[
		  (try_begin),
        (party_slot_eq, "$current_town", slot_party_type, spt_village),
			  #####
			  (str_store_party_name, s4, "$current_town"),
			  (str_clear,s1),
			  (str_store_string,s1,"@Mercilessly your men kill anyone that crosses their way, then enter the houses, killing all men over 14 years of age. The fame of your cruelty travels as the wind. " +
			  "Fear seizes all who talk about you. Now {s4} is pacified, but the cost has been very high."),
			  (display_message, "@{s1}"),
			  (jump_to_menu, "mnu_random_juice_events"),
			  #########
		  (else_try),
        (assign, "$plunder_battle_shown", 0),
        (assign, "$loot_screen_shown", 0),
        (assign, "$capture_screen_shown", 0),
        (jump_to_menu, "mnu_exterminate_population"),
      (try_end),
		]),
]),

("exterminate_population",mnf_disable_all_keys,
  "Mercilessly your men kill or enslave anyone crossing their way, then enter the houses, killing or enslaving all adult men. In the unleashed bloodlust the soldiers rage through the city."
  +" Nothing can stop their warth. The fame of your cruelty travels as the wind."
  +" Fear seizes all who talk about you. Now {s4} is pacified, but the cost has been very high.",
  "none",[
	  (str_store_party_name, s4, "$current_town"),
    (set_background_mesh, "mesh_pic_victory"),
    (troop_clear_inventory, "trp_temp_troop"),
    (try_begin),
      (eq, "$plunder_battle_shown", 0),
      (assign, "$plunder_battle_shown", 1),
      (party_clear, "$current_town"),
      (party_get_slot, ":exterior_scene", "$current_town", slot_castle_exterior),
      (modify_visitors_at_site, ":exterior_scene"),
      (reset_visitors),
      (party_get_slot, ":wealthy_pop", "$current_town", slot_town_prosperity),#
      (val_add, ":wealthy_pop", 20),
      (assign, ":num_townsman", 40),
      (val_mul, ":num_townsman", ":wealthy_pop"),
      (val_div, ":num_townsman", 100),
      (store_div, ":num_of_spawns",":num_townsman",10),
      (val_clamp, ":num_of_spawns", 1, 5),
      (party_get_slot, ":culture", "$current_town", slot_center_culture),
      (try_begin),
        (eq, ":culture", "fac_culture_1"),
        (assign, ":troop_1", "trp_dacian_village_walker"),
        (assign, ":troop_2", "trp_dacian_village_walker_female"),
      (else_try),
        (eq, ":culture", "fac_culture_2"),
        (assign, ":troop_1", "trp_celtic_village_walker"),
        (assign, ":troop_2", "trp_celtic_village_walker_female"),
      (else_try),
        (eq, ":culture", "fac_culture_2_1"),
        (assign, ":troop_1", "trp_celtic_village_walker"),
        (assign, ":troop_2", "trp_celtic_village_walker_female"),
      (else_try),
        (eq, ":culture", "fac_culture_3"),
        (assign, ":troop_1", "trp_sarmatian_village_walker"),
        (assign, ":troop_2", "trp_sarmatian_village_walker_female"),
      (else_try),
        (eq, ":culture", "fac_culture_4"),
        (assign, ":troop_1", "trp_germanic_village_walker"),
        (assign, ":troop_2", "trp_germanic_village_walker_female"),
      (else_try),
        (eq, ":culture", "fac_culture_6"),
        (assign, ":troop_1", "trp_parthian_village_walker"),
        (assign, ":troop_2", "trp_parthian_village_walker_female"),
      (else_try),
        (eq, ":culture", "fac_culture_8"),
        (assign, ":troop_1", "trp_judean_village_walker"),
        (assign, ":troop_2", "trp_judean_village_walker_female"),
      (else_try),
        (eq, ":culture", "fac_culture_9"),
        (assign, ":troop_1", "trp_bosporan_village_walker"),
        (assign, ":troop_2", "trp_bosporan_village_walker_female"),
      (else_try),
        (eq, ":culture", "fac_culture_5"),
        (assign, ":troop_1", "trp_armenian_village_walker"),
        (assign, ":troop_2", "trp_armenian_village_walker_female"),
      (else_try),
        (assign, ":troop_1", "trp_roman_town_walker"),
        (assign, ":troop_2", "trp_roman_town_walker_female"),
      (try_end),
      (try_for_range, ":entry", 1, 11),	#thats entry 30-39
        (store_random_in_range, ":r", 0, 10),
        (try_begin),
          (le, ":r", 4),
          (set_visitors, ":entry", ":troop_1", ":num_of_spawns"),
        (else_try),
          (set_visitors, ":entry", ":troop_2", ":num_of_spawns"),
        (try_end),
        (set_visitors, ":entry", "trp_boy", 1),
        (set_visitors, ":entry", "trp_girl", 1),
      (try_end),
      (set_jump_mission,"mt_center_plunder"),
      (jump_to_scene, ":exterior_scene"),
      (change_screen_mission),
    (else_try),
      (eq, "$capture_screen_shown", 0),
      (assign, "$capture_screen_shown", 1),
      # (eq, "$loot_option", 2),	#new: capturing slaves only for loot option 2
      (party_clear, "p_temp_party"),
      (assign, "$g_move_heroes", 0),
      (call_script, "script_party_add_wounded_members_as_prisoners", "p_temp_party", "p_total_enemy_casualties"),
      (party_get_num_prisoners,  ":num_captured_enemies", "p_temp_party"),
      (party_get_slot, ":random_addition", "$g_encountered_party", slot_town_prosperity),
      (val_add, ":random_addition", 25),
      (val_div, ":random_addition", 10),
      (val_add, ":num_captured_enemies", ":random_addition"),
      (val_add, ":num_captured_enemies", ":random_addition"),
      (try_begin),
          (lt, "$player_honor", -90),
          (val_add, ":random_addition", 20),
      (else_try),
          (lt, "$player_honor", -70),
          (val_add, ":random_addition", 15),
      (else_try),
          (lt, "$player_honor", -40),
          (val_add, ":random_addition", 10),
      (else_try),
          (lt, "$player_honor", -20),
          (val_add, ":random_addition", 5),
      (try_end),
      (party_add_prisoners, "p_temp_party", "trp_slave", ":random_addition"),
      (party_add_prisoners, "p_temp_party", "trp_slave_female", ":random_addition"),
      (gt, ":num_captured_enemies", 0),
      (change_screen_exchange_with_party, "p_temp_party"),
    (else_try),
      (eq, "$loot_screen_shown", 0),
      (assign, "$loot_screen_shown", 1),
      (assign, ":merchant_troop", 0),
      (try_begin),
        (is_between, "$current_town", towns_begin, towns_end),
        (party_get_slot, ":merchant_troop", "$current_town", slot_town_merchant),
      (else_try),
        # new begin (copy of mnu_village_loot_complete)
        (assign, ":bound_town", "$current_town"),
        (store_sub, ":item_to_price_slot", slot_town_trade_good_prices_begin, trade_goods_begin),
        (reset_item_probabilities,0),
        (assign, ":total_probability", 0),
        (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
          (store_add, ":cur_price_slot", ":cur_goods", ":item_to_price_slot"),
          (party_get_slot, ":cur_price", ":bound_town", ":cur_price_slot"),
          (gt, ":cur_price", 0),
          (call_script, "script_center_get_production", ":bound_town", ":cur_goods"),
          (assign, ":cur_probability", reg0),
          (call_script, "script_center_get_consumption", ":bound_town", ":cur_goods"),
          (val_div, reg0, 3),
          (val_sub, ":cur_probability", reg0),
          (val_mul, ":cur_probability", 4),
          (val_mul, ":cur_probability", average_price_factor),
          (val_div, ":cur_probability", ":cur_price"),
          (val_max,":cur_probability",0),
          #first only simulation
          #(set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
          (val_add, ":total_probability", ":cur_probability"),
        (try_end),
        (reset_item_probabilities,0),
        (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
          (store_add, ":cur_price_slot", ":cur_goods", ":item_to_price_slot"),
          (party_get_slot, ":cur_price", ":bound_town", ":cur_price_slot"),
          (gt, ":cur_price", 0),
          (call_script, "script_center_get_production", ":bound_town", ":cur_goods"),
          (assign, ":cur_probability", reg0),
          (gt, ":cur_probability", 0),
          (call_script, "script_center_get_consumption", ":bound_town", ":cur_goods"),
          (val_div, reg0, 3),
          (val_sub, ":cur_probability", reg0),
          (val_mul, ":cur_probability", 4),
          (val_mul, ":cur_probability", average_price_factor),
          (val_div, ":cur_probability", ":cur_price"),
          (val_max, ":cur_probability", 0),
          (val_mul, ":cur_probability", num_merchandise_goods),
          (val_mul, ":cur_probability", 100),
          (val_div, ":cur_probability", ":total_probability"),
          (val_max, ":cur_probability", 5),
          (set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
        (try_end),

        (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
        (val_min, ":prosperity", 40),
        (val_div, ":prosperity", 2),
        (val_max, ":prosperity", 3),
        (party_get_skill_level, ":looting_skill", "p_main_party", "skl_looting"),
        (val_add, ":prosperity", ":looting_skill"),

        (troop_add_merchandise,"trp_temp_troop",itp_type_goods,":prosperity"),
        (assign, ":merchant_troop", "trp_temp_troop"),
        #new end
      (try_end),
      (gt, ":merchant_troop", 0),
      (troop_sort_inventory, ":merchant_troop"),
      (change_screen_loot, ":merchant_troop"),
    (else_try),
      (party_get_slot, ":capital", "$current_town", slot_center_capital),
      (troop_add_gold, "trp_player", ":capital"),

      (party_set_slot, "$current_town", slot_center_player_relation, 0), #relation to 0
      (party_set_slot, "$current_town", slot_center_capital, 0),
      (party_set_slot, "$current_town", slot_center_accumulated_rents, 0),
      (troop_get_slot, ":culture", "trp_player", slot_troop_culture),
      (party_set_slot, "$current_town", slot_center_culture, ":culture"),
      (call_script, "script_change_player_honor", -40),

      (party_get_slot, ":prosperity_change", "$current_town", slot_town_prosperity),
      (val_mul, ":prosperity_change", -9),
      (val_div, ":prosperity_change", 10),
      (call_script, "script_change_center_prosperity", "$current_town", ":prosperity_change"),

      (party_get_slot, ":food_stores", "$current_town", slot_party_food_store),
      (call_script, "script_center_get_food_store_limit", "$current_town"),
      (val_min, ":food_stores", reg0),
      (party_set_slot, "$current_town", slot_party_food_store, ":food_stores"),
      (try_for_range, ":walker_no", 0, num_town_walkers),
        (call_script, "script_center_set_walker_to_type", "$current_town", ":walker_no", walkert_default),
      (try_end),
      (call_script, "script_destroy_center", "$current_town"),
    (try_end),
  ],[
    ("continue",[],"Well done...",[
      (change_screen_map),
    ]),
]),

("prisoners",mnf_disable_all_keys,
  "Your guards take him prisoner and his troops are disbanded.",
  "none",[
    (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -60),

    # (try_for_range, ":parties", towns_begin, towns_end),
      # (store_faction_of_party, ":fac", ":parties"),
      # (eq, ":fac", "$players_kingdom"),
      # (store_random_in_range, ":r", 0, 100),
      # (lt, ":r", 40),
      # (call_script, "script_change_player_relation_with_center", ":parties", -2),
    # (try_end),
    (display_message, "@Rumors spread through the Empire that you are a tyrant.", message_negative),
    (try_begin),
      (lt, "$g_unrest", 110),
      (val_add, "$g_unrest", 5),
      (display_message, "@Stability of the Empire decreases", color_bad_news),
    (try_end),

    (call_script, "script_change_relation_with_family_friends_enemies", "$g_talk_troop", -1, 15, "trp_player"),
      # # # reduce the player's relationship with every hero, companion, lady, and daughter
      # (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
    # (store_faction_of_troop, ":fac", ":troop"),
    # (eq, ":fac", "$players_kingdom"),
    # (try_begin),
      # # don't make the dead any angrier than they already are!
      # (neg|troop_slot_eq, ":troop", slot_troop_occupation, dplmc_slto_dead),
      # #only for family members a relation drop
      # (this_or_next|troop_slot_eq, ":troop", slot_troop_guardian, "$g_talk_troop"),
      # (this_or_next|troop_slot_eq, ":troop", slot_troop_spouse, "$g_talk_troop"),
      # (this_or_next|troop_slot_eq, ":troop", slot_troop_father, "$g_talk_troop"),
      # (this_or_next|troop_slot_eq, ":troop", slot_troop_mother, "$g_talk_troop"),
      # (troop_slot_eq, ":troop", slot_troop_betrothed, "$g_talk_troop"),

      # (try_begin),
        # (store_random_in_range, ":impact", 25, 45),
        # (val_mul, ":impact", -1),
        # (call_script, "script_change_player_relation_with_troop", ":troop", ":impact"),
      # (try_end),
        # (else_try),#and friends
      # (call_script, "script_troop_get_relation_with_troop", ":troop", "$g_talk_troop"),
      # (try_begin),
        # (ge, reg0, 20),
        # (store_div, ":relation_lose", reg0, 2),
        # (val_mul, ":relation_lose", 3),
        # (val_sub, ":relation_lose", 5),
        # (val_clamp, ":relation_lose", 1, 70),
        # (val_mul, ":relation_lose", -1),
        # (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
        # (else_try),
        # (store_random_in_range, ":r", 1, 8),
        # (val_mul, ":r", -1),
        # (call_script, "script_change_player_relation_with_troop", ":troop", ":r"),
      # (try_end),
      # (try_end),
    # (try_end),

    (display_message, "@You are despised for your tyranny", message_negative),
    (call_script, "script_change_player_honor", -20),
    (troop_set_slot, "$g_talk_troop", slot_troop_prisoner_of_party, "p_main_party"),
    (party_force_add_prisoners, "p_main_party", "$g_talk_troop", 1),
    #(call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -30),
    #(call_script, "script_change_player_relation_with_faction_ex", "$g_talk_troop_faction", -2),
    (call_script, "script_event_hero_taken_prisoner_by_player", "$g_talk_troop"),

    (troop_get_slot, ":king_party", "$g_talk_troop", slot_troop_leaded_party),
    (call_script, "script_destroy_party", ":king_party"),
    (troop_set_slot, "$g_talk_troop", slot_troop_leaded_party, -1),

    (assign, "$cant_leave_encounter", 0),
    (assign, "$g_leave_encounter", 1),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_map),
    ]),
]),

("prisoners_legal",mnf_disable_all_keys,
  "Your guards take him prisoner and his troops are disbanded.",
  "none",[
  	(call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -60),
    (call_script, "script_change_relation_with_family_friends_enemies", "$g_talk_troop", -1, 15, "trp_player"),
		# (try_for_range, ":parties", towns_begin, towns_end),
			# (store_faction_of_party, ":fac", ":parties"),
			# (eq, ":fac", "$players_kingdom"),
			# (store_random_in_range, ":r", 0, 100),
			# (lt, ":r", 40),
			# (call_script, "script_change_player_relation_with_center", ":parties", -2),
		# (try_end),
    (display_message, "@Rumors spread through the Empire that you help the poor and supressed.", message_positive),
    (val_sub, "$g_unrest", 5),
    (val_max, "$g_unrest", 0),
    (display_message, "@Stability of the Empire increase", color_good_news),

      # # # reduce the player's relationship with every hero, companion, lady, and daughter
      # (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
		# (store_faction_of_troop, ":fac", ":troop"),
		# (eq, ":fac", "$players_kingdom"),
		# (try_begin),
			# # don't make the dead any angrier than they already are!
			# (neg|troop_slot_eq, ":troop", slot_troop_occupation, dplmc_slto_dead),
			# #only for family members a relation drop
			# (this_or_next|troop_slot_eq, ":troop", slot_troop_guardian, "$g_talk_troop"),
			# (this_or_next|troop_slot_eq, ":troop", slot_troop_spouse, "$g_talk_troop"),
			# (this_or_next|troop_slot_eq, ":troop", slot_troop_father, "$g_talk_troop"),
			# (this_or_next|troop_slot_eq, ":troop", slot_troop_mother, "$g_talk_troop"),
			# (troop_slot_eq, ":troop", slot_troop_betrothed, "$g_talk_troop"),

			# (try_begin),
			  # (store_random_in_range, ":impact", 25, 45),
			  # (val_mul, ":impact", -1),
			  # (call_script, "script_change_player_relation_with_troop", ":troop", ":impact"),
			# (try_end),
		   # (else_try),#and friends
			# (call_script, "script_troop_get_relation_with_troop", ":troop", "$g_talk_troop"),
			# (try_begin),
				# (ge, reg0, 20),
				# (store_div, ":relation_lose", reg0, 2),
				# (val_mul, ":relation_lose", 3),
				# (val_sub, ":relation_lose", 5),
				# (val_clamp, ":relation_lose", 1, 70),
				# (val_mul, ":relation_lose", -1),
				# (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
			  # (else_try),
				# (store_random_in_range, ":r", 1, 8),
				# (val_mul, ":r", -1),
				# (call_script, "script_change_player_relation_with_troop", ":troop", ":r"),
			# (try_end),
		 # (try_end),
	  # (try_end),

    (call_script, "script_change_player_honor", 15),
    (troop_set_slot, "$g_talk_troop", slot_troop_prisoner_of_party, "p_main_party"),
    (party_force_add_prisoners, "p_main_party", "$g_talk_troop", 1),
    #(call_script, "script_change_player_relation_with_troop", "$g_talk_troop", -30),
    #(call_script, "script_change_player_relation_with_faction_ex", "$g_talk_troop_faction", -2),
    (call_script, "script_event_hero_taken_prisoner_by_player", "$g_talk_troop"),
    (troop_get_slot, ":king_party", "$g_talk_troop", slot_troop_leaded_party),
    (call_script, "script_destroy_party", ":king_party"),
    (troop_set_slot, "$g_talk_troop", slot_troop_leaded_party, -1),

    (assign, "$cant_leave_encounter", 0),
    (assign, "$g_leave_encounter", 1),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_map),
    ]),
]),

("gods_judgment",mnf_disable_all_keys,
  "You start to pray: ^{s20}"
  +"^^All is silent, then you hear a thunder in the distance. All of a sudden, "
  +"you a voice whispers: '{playername}, come to the grove. It is in the south, not a mile away.'",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
    (troop_get_slot,":god", "trp_player", slot_troop_religion),
    (store_add, ":string", ":god", "str_paryers_begin"),
    (str_store_string, s20, ":string"),
  ],[
    ("continue",[],"I think I had too much wine ...",[
      (change_screen_map),
    ]),
    ("continue",[],"I will go to this grove ...",[
      (set_jump_mission,"mt_gods_judgment"),
      # (quest_get_slot, ":num" ,"qst_blank_quest_19", slot_quest_object_state),
      (modify_visitors_at_site,"scn_grove"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),

      (assign, ":hero", "trp_troops_end"),
      (try_begin),
        (eq, "$gods_judgment", 0),
        (try_begin),# germanic
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_baduhenna),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_dunraz),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_frijo),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_alcis),
          (assign, ":hero", "trp_germanic_myth_hero_1"),
        (else_try),# celtic
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_andraste),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_maponos),
          (assign, ":hero", "trp_celtic_myth_hero_1"),
        (else_try),# dacian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_gebeleizis),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_zalmoxis),
          (assign, ":hero", "trp_dacian_myth_hero_1"),
        (else_try),# sarmatian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_goitosuros),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_artimpasa),
          (assign, ":hero", "trp_sarmatian_myth_hero_1"),
        (else_try),# caucasian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_mihr),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_armazi),
          (assign, ":hero", "trp_caucasian_myth_hero_1"),
        (else_try),# persian
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_mazda),
          (assign, ":hero", "trp_persian_myth_hero_1"),
        (else_try),# arabian
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_allat),
          (assign, ":hero", "trp_arabian_myth_hero_1"),
        (else_try),# judean
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
          (assign, ":hero", "trp_jewish_myth_hero_1"),
        (else_try),# african
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_ifri),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_ammon),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_apedemak),
          (assign, ":hero", "trp_african_myth_hero_1"),
        (else_try),
          (assign, ":hero", "trp_odysseus"),
        (try_end),
      (else_try),
        (eq, "$gods_judgment", 1),
        (try_begin),# germanic
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_baduhenna),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_dunraz),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_frijo),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_alcis),
          (assign, ":hero", "trp_germanic_myth_hero_2"),
        (else_try),# celtic
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_andraste),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_maponos),
          (assign, ":hero", "trp_celtic_myth_hero_2"),
        (else_try),# dacian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_gebeleizis),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_zalmoxis),
          (assign, ":hero", "trp_dacian_myth_hero_2"),
        (else_try),# sarmatian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_goitosuros),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_artimpasa),
          (assign, ":hero", "trp_sarmatian_myth_hero_2"),
        (else_try),# caucasian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_mihr),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_armazi),
          (assign, ":hero", "trp_caucasian_myth_hero_2"),
        (else_try),# persian
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_mazda),
          (assign, ":hero", "trp_persian_myth_hero_2"),
        (else_try),# arabian
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_allat),
          (assign, ":hero", "trp_arabian_myth_hero_2"),
        (else_try),# judean
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
          (assign, ":hero", "trp_jewish_myth_hero_2"),
        (else_try),# african
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_ifri),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_ammon),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_apedemak),
          (assign, ":hero", "trp_african_myth_hero_1"),
        (else_try),
          (assign, ":hero", "trp_agamemnon"),
        (try_end),
      (else_try),
        (eq, "$gods_judgment", 2),
        (try_begin),# germanic
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_baduhenna),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_dunraz),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_frijo),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_alcis),
          (assign, ":hero", "trp_germanic_myth_hero_3"),
        (else_try),# celtic
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_andraste),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_maponos),
          (assign, ":hero", "trp_celtic_myth_hero_3"),
        (else_try),# dacian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_gebeleizis),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_zalmoxis),
          (assign, ":hero", "trp_dacian_myth_hero_3"),
        (else_try),# sarmatian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_goitosuros),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_artimpasa),
          (assign, ":hero", "trp_sarmatian_myth_hero_3"),
        (else_try),# caucasian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_mihr),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_armazi),
          (assign, ":hero", "trp_caucasian_myth_hero_3"),
        (else_try),# persian
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_mazda),
          (assign, ":hero", "trp_persian_myth_hero_3"),
        (else_try),# arabian
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_allat),
          (assign, ":hero", "trp_arabian_myth_hero_3"),
        (else_try),# judean
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
          (assign, ":hero", "trp_jewish_myth_hero_3"),
        (else_try),# african
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_ifri),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_ammon),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_apedemak),
          (assign, ":hero", "trp_african_myth_hero_3"),
        (else_try),
          (assign, ":hero", "trp_herakles"),
        (try_end),
      (else_try),
        (eq, "$gods_judgment", 3),
        (try_begin),# germanic
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_baduhenna),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_dunraz),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_frijo),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_alcis),
          (assign, ":hero", "trp_germanic_myth_hero_4"),
        (else_try),# celtic
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_andraste),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_maponos),
          (assign, ":hero", "trp_celtic_myth_hero_4"),
        (else_try),# dacian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_gebeleizis),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_zalmoxis),
          (assign, ":hero", "trp_dacian_myth_hero_4"),
        (else_try),# sarmatian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_goitosuros),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_artimpasa),
          (assign, ":hero", "trp_sarmatian_myth_hero_4"),
        (else_try),# caucasian
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_mihr),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_armazi),
          (assign, ":hero", "trp_caucasian_myth_hero_4"),
        (else_try),# persian
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_mazda),
          (assign, ":hero", "trp_persian_myth_hero_4"),
        (else_try),# arabian
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_allat),
          (assign, ":hero", "trp_arabian_myth_hero_4"),
        (else_try),# judean
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
          (assign, ":hero", "trp_jewish_myth_hero_4"),
        (else_try),# african
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_ifri),
          (this_or_next|troop_slot_eq, "trp_player", slot_troop_religion, worships_ammon),
          (troop_slot_eq, "trp_player", slot_troop_religion, worships_apedemak),
          (assign, ":hero", "trp_african_myth_hero_1"),
        (else_try),
          (assign, ":hero", "trp_achilleus"),
        (try_end),
      (try_end),

      (set_visitor, 1, ":hero"),
      (troop_set_health, ":hero", 100),

      # (quest_set_slot,"qst_blank_quest_19", slot_quest_object_state, ":num"),
      (jump_to_scene,"scn_grove"),

      (change_screen_mission),
    ]),
]),

# ("gods_judgment_yhwh",mnf_disable_all_keys,
#   "While praying and singing holy songs you make a sacrifice.^^After you finished, {s20}",
#   "none",[
#     (try_begin),
#       (ge, "$player_honor", 100),
#       (assign, "$temp2", 100),
#     (else_try),
#       (ge, "$player_honor", 90),
#       (assign, "$temp2", 90),
#     (else_try),
#       (ge, "$player_honor", 80),
#       (assign, "$temp2", 80),
#     (else_try),
#       (ge, "$player_honor", 70),
#       (assign, "$temp2", 70),
#     (else_try),
#       (ge, "$player_honor", 60),
#       (assign, "$temp2", 60),
#     (else_try),
#       (ge, "$player_honor", 50),
#       (assign, "$temp2", 50),
#     (else_try),
#       (ge, "$player_honor", 40),
#       (assign, "$temp2", 40),
#     (else_try),
#       (ge, "$player_honor", 30),
#       (assign, "$temp2", 30),
#     (else_try),
#       (ge, "$player_honor", 20),
#       (assign, "$temp2", 15),
#     (else_try),
#       (ge, "$player_honor", 10),
#       (assign, "$temp2", 5),
#     (else_try),
#       (ge, "$player_honor", 0),
#       (assign, "$temp2", 3),
#     (else_try),
#       (ge, "$player_honor", -10),
#       (assign, "$temp2", 2),
#     (else_try),
#       (ge, "$player_honor", -20),
#       (assign, "$temp2", 1),
#     (else_try),
#       (assign, "$temp2", 1),
#     (try_end),

#     (store_random_in_range, reg40, 0, 200),
#     (try_begin),
#       (le, reg40, "$temp2"),
#       (str_store_string, s20,
#         "@you see a bush burning. Then you hear a voice."
#         +" It seems that the bush speaks to you, but you can't understand a single word. Suddenly, the world starts to rotate and everything becomes black."
#         +" After an hour you awak. It seems some of your skills have improved."
#       ),
#        (set_background_mesh, "mesh_pic_bush"),
#       (assign, "$temp", 1),
#     (else_try),
#       (str_store_string, s20, "@you hear some birds sing and the rustling of the wind."),
#       (set_background_mesh, "mesh_pic_deserters"),
#       (assign, "$temp", 0),
#     (try_end),
#   ],[
#     ("continue",[(neq, "$temp", 1),],"Continue.",[
#       (change_screen_map),
#     ]),
#     ("continue",[(eq, "$temp", 1),],"YHWH has spoken to me.",[
#       (troop_raise_attribute, "trp_player", ca_agility, 1),
#       (troop_raise_attribute, "trp_player", ca_strength, 1),
#       (troop_raise_attribute, "trp_player", ca_charisma, 1),
#       (troop_raise_attribute, "trp_player", ca_intelligence, 1),
#       (add_xp_as_reward, 2500),
#       (val_add, "$gods_judgment", 1),
#       (call_script, "script_change_player_party_morale", 60),
#       (troop_add_item, "trp_player", "itm_temple_gold", 0),
#       (troop_add_item, "trp_player", "itm_temple_gold", 0),
#       (display_message, "@Wealth for the people who worship YHWH",color_good_news),
#       (change_screen_map),
#     ]),
# ]),

("gods_judgment_christus",mnf_disable_all_keys,
  "You start praying:^^{s44}.^^After you finished, {s20}",
  "none",[
    (str_store_string, s44, "str_worships_christus_prayer"),
    (try_begin),
      (ge, "$player_honor", 100),
      (assign, "$temp2", 100),
    (else_try),
      (ge, "$player_honor", 90),
      (assign, "$temp2", 90),
    (else_try),
      (ge, "$player_honor", 80),
      (assign, "$temp2", 80),
    (else_try),
      (ge, "$player_honor", 70),
      (assign, "$temp2", 70),
    (else_try),
      (ge, "$player_honor", 60),
      (assign, "$temp2", 60),
    (else_try),
      (ge, "$player_honor", 50),
      (assign, "$temp2", 50),
    (else_try),
      (ge, "$player_honor", 40),
      (assign, "$temp2", 40),
    (else_try),
      (ge, "$player_honor", 30),
      (assign, "$temp2", 30),
    (else_try),
      (ge, "$player_honor", 20),
      (assign, "$temp2", 15),
    (else_try),
      (ge, "$player_honor", 10),
      (assign, "$temp2", 5),
    (else_try),
      (ge, "$player_honor", 0),
      (assign, "$temp2", 3),
    (else_try),
      (ge, "$player_honor", -10),
      (assign, "$temp2", 2),
    (else_try),
      (ge, "$player_honor", -20),
      (assign, "$temp2", 1),
    (else_try),
      (assign, "$temp2", -1),
    (try_end),

    (store_random_in_range, reg40, 0, 200),
    (try_begin),
      (le, reg40, "$temp2"),
      (str_store_string, s20, "@you see a bush burning. Then you hear a voice. It seems that the bush speaks to you, but you can't understand a single word. Suddenly, the world starts to rotate and everything becomes black. After an hour you awak. It seems some of your skills have improved."),
       (set_background_mesh, "mesh_pic_bush"),
      (assign, "$temp", 1),
    (else_try),
      (str_store_string, s20, "@you hear some birds sing and the rustling of the wind."),
      (set_background_mesh, "mesh_pic_deserters"),
      (assign, "$temp", 0),
    (try_end),
  ],[
    ("continue",[(neq, "$temp", 1),],"Continue.",[
      (change_screen_map),
    ]),
    ("continue",[(eq, "$temp", 1),],"God has spoken to me!",[
      (troop_raise_attribute, "trp_player", ca_agility, 1),
      (troop_raise_attribute, "trp_player", ca_strength, 1),
      (troop_raise_attribute, "trp_player", ca_charisma, 1),
      (troop_raise_attribute, "trp_player", ca_intelligence, 1),
      (add_xp_as_reward, 2500),
      (val_add, "$gods_judgment", 1),
      (change_screen_map),
    ]),
]),
("won_judgment",mnf_disable_all_keys,
  "After you have defeated your opponent a voice whispers: {s30}",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
    (display_message, "@You feel more strengthend.", color_good_news),
    (troop_raise_attribute, "trp_player", ca_agility, 1),
    (troop_raise_attribute, "trp_player", ca_strength, 1),
    (troop_raise_attribute, "trp_player", ca_charisma, 1),
    (troop_raise_attribute, "trp_player", ca_intelligence, 1),
    (str_store_string, s30, "@'You have proven yourself. Wait some days and heal your wounds, then we will test you again.'"),
    # (quest_get_slot, ":num" ,"qst_blank_quest_19", slot_quest_object_state),
    (val_add, "$gods_judgment", 1),
    (try_begin),
      (eq, "$gods_judgment", 1),
      (add_xp_as_reward, 1000),
      (call_script, "script_add_piety", 50, 1),
    (else_try),
      (eq, "$gods_judgment", 2),
      (add_xp_as_reward, 2500),
      (call_script, "script_add_piety", 75, 1),
    (else_try),
      (eq, "$gods_judgment", 3),
      (add_xp_as_reward, 5000),
      (call_script, "script_add_piety", 100, 1),
    (else_try),
      (eq, "$gods_judgment", 4),
      (call_script, "script_add_piety", 125, 1),
      (troop_add_item, "trp_player", "itm_ancient_sword", imodbit_masterwork),
      (troop_add_item, "trp_player", "itm_ancient_shield", imodbit_reinforced),
      (troop_add_item, "trp_player", "itm_ancient_boots_heavy", imodbit_lordly),
      (troop_add_item, "trp_player", "itm_ancient_spear", imodbit_balanced),
      (troop_add_item, "trp_player", "itm_ancient_plate_armor2", imodbit_lordly),
      (troop_add_item, "trp_player", "itm_ancient_helm_heavy", imodbit_lordly),
      (str_store_string, s30, "@'This was you last trial of arms. Take those weapons and take this armor as your last reward, it shall guard you well during battle.'"),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_map),
    ]),
]),

("lost_judgment",mnf_disable_all_keys,
  "After you have been defeated a voice whispers: 'Oh, {playername}, are you drunk? Fight better next time.'",
  "none",[
    (set_background_mesh, "mesh_pic_bachus"),
  ],
  [
    ("continue",[],"Continue...",[
      (change_screen_map),
    ]),
]),

("funny_nights",0,
  "Time passes, and you forget the rigors and fatigue from life that had lingered upon your body and soul."
  +" For a few hours, your armor and weapons, the fear of dying in any skirmish, the punishment of the rain and wind, and the dust of the roads are all shoved under a small patch of happiness."
  +" But, in the end, it's all over too soon ...",
  "none",[
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[
      ("Continue...",[],"Continue...",[
        (add_xp_as_reward, 100),
        (store_random_in_range, ":r", -25, 25),
        (val_max, ":r", 0),
        (call_script, "script_change_troop_health", "trp_player", ":r"),
        (display_message, "@You enjoy the time", color_good_news),
        (troop_set_health, "trp_player", 100),
        (try_begin),##only if you are not freelancing, i.e. if you are part of an army
          (eq, "$enlisted_party", -1),
          (rest_for_hours, 3, 11, 0),
        (try_end),
        (change_screen_map),
    ]),
]),

("lupanar",mnf_scale_picture,
  "{s27}",
  "none", [
    (try_begin),
      (eq, "$temp3", 1),
      (str_store_string, s27, "str_event_male_penetrating"),
      (set_background_mesh, "mesh_pic_lupanar_1"),
    (else_try),
      (eq, "$temp3", 2),
      (str_store_string, s27, "str_event_male_penetrated"),
      (set_background_mesh, "mesh_pic_lupanar_2"),
    (else_try),
      (eq, "$temp3", 3),
      (str_store_string, s27, "str_event_male_blowjob"),
      (set_background_mesh, "mesh_pic_hexe_party"),
    (else_try),
      (eq, "$temp3", 4),
      (str_store_string, s27, "str_event_female_classic"),
      (set_background_mesh, "mesh_pic_lupanar_1"),
    (else_try),
      (eq, "$temp3", 5),
      (str_store_string, s27, "str_event_female_butt"),
      (set_background_mesh, "mesh_pic_lupanar_2"),
    (else_try),
      (str_store_string, s27, "str_event_female_blowjob"),
      (set_background_mesh, "mesh_pic_hexe_party"),
    (try_end),
  ],[
    ("answere_1",[],"Continue...",[
      (troop_remove_gold, "trp_player", 500),
      (add_xp_as_reward, 100),
      (store_random_in_range, ":r", -50, 15),
      (val_max, ":r", 0),
      (call_script, "script_change_troop_health", "trp_player", ":r"),
      (display_message, "@You enjoy the time", color_good_news),
      (try_begin),##only if you are not freelancing, i.e. if you are part of an army
        (eq, "$enlisted_party", -1),
        (rest_for_hours, 3, 11, 0),
      (try_end),
      (try_begin),
        (eq, "$temp3", 2),
        (call_script, "script_change_troop_renown", "trp_player", -25),
        (call_script, "script_change_player_honor", -2),
      (try_end),
      (change_screen_map),
    ]),
]),

("groupy",0,
  "Someone is knocking at the door of your room. As you open a woman stands before you, dressed in a coat. "
  +"For a moment you aren't sure who she is, but then she opens her coat under which she is completely naked. "
  +"She must be the woman to whom you talked before the competition..."
  +"Time passes while your bodies unite in love... unfortunately its all over too quickly.",
  "none",[
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[
    ("Continue...",[],"Continue...",[
      (troop_set_slot, "trp_groupie", slot_troop_mother, 0),
      (add_xp_as_reward, 250),
      (change_screen_map),
    ]),
]),

("gold_losses",0,
  "Wrong calculation?^^You check a current report about your private treasury and notice, that there are some funds missing."
  +" You recalculate everything, but then you come to a different conclusion. It must have been a mistake by yourself.",
  "none",[
    (set_background_mesh, "mesh_pic_payment"),
  ],[
    ("Continue...",[],"Continue...",[
      (store_troop_gold, ":gold", "trp_household_possessions"),
      (try_begin),
          (le, ":gold", 150000),
          (store_random_in_range, ":r2", 5000, 25001),
      (else_try),
          (le, ":gold", 250000),
          (store_random_in_range, ":r2", 25000, 40001),
      (else_try),
          (le, ":gold", 350000),
          (store_random_in_range, ":r2", 45000, 55001),
      (else_try),
          (le, ":gold", 450000),
          (store_random_in_range, ":r2", 50000, 65001),
      (else_try),
          (le, ":gold", 550000),
          (store_random_in_range, ":r2", 60000, 95001),
      (else_try),
          (le, ":gold", 750000),
          (store_random_in_range, ":r2", 70000, 98001),
      (else_try),
          (le, ":gold", 850000),
          (store_random_in_range, ":r2", 80000, 98001),
      (else_try),
          (le, ":gold", 950000),
          (store_random_in_range, ":r2", 88000, 99999),
      (else_try),
          (store_random_in_range, ":r2", 80000, 150000),
      (try_end),
      (troop_remove_gold, "trp_household_possessions", ":r2"),
      (change_screen_map),
    ]),
]),

("gold_losses_imperial_treasury",0,
  "Nonsensical numbers^^You recieved a report about spendings booked via the imperial treasury. It is a long and very confusing list."
  +" You try to make sanity checks but always come to a different conlusion. At the end, you decide to ask your advisors."
  +" They do calculations which you can't comprehend, however they get the right numbers at the end...",
  "none",[
    (set_background_mesh, "mesh_pic_payment"),
  ],[
    ("Continue...",[],"Continue...",[
      (faction_get_slot, ":gold", "$players_kingdom", slot_faction_treasury),
      (try_begin),
          (le, ":gold", 150000),
          (store_random_in_range, ":r2", 20000, 30001),
      (else_try),
          (le, ":gold", 250000),
          (store_random_in_range, ":r2", 30000, 50001),
      (else_try),
          (le, ":gold", 350000),
          (store_random_in_range, ":r2", 50000, 75001),
      (else_try),
          (le, ":gold", 450000),
          (store_random_in_range, ":r2", 76000, 100001),
      (else_try),
          (le, ":gold", 550000),
          (store_random_in_range, ":r2", 100000, 150001),
      (else_try),
          (le, ":gold", 750000),
          (store_random_in_range, ":r2", 150000, 200001),
      (else_try),
          (le, ":gold", 850000),
          (store_random_in_range, ":r2", 200000, 250001),
      (else_try),
          (le, ":gold", 950000),
          (store_random_in_range, ":r2", 250000, 300000),
      (else_try),
          (store_random_in_range, ":r2", 80000, 150000),
      (try_end),
      (val_mul, ":r2", -1),
      (call_script, "script_add_to_faction_treasury", ":r2", "$players_kingdom"),
      (change_screen_map),
    ]),
]),

("nobility_tax_protests",0,
  "Are taxes too high?^^Roman nobles are recently complaining about the high taxes. They say, that it hurts their business either directly,"
  +" by lowering their revenues and also indirectly due to riots. They all agree that your tax policy is harmfull and demand lower taxes.",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
  ],[
    ("Continue...",[],"Continue...",[
      (faction_get_slot, ":tax_rate_business", "$players_kingdom", slot_faction_tax_rate_buisness),
      (store_div, ":relation_reduction", ":tax_rate_business", -5),
      (set_show_messages, 0),
      (try_for_range, ":roman", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":roman", slot_troop_occupation, slto_kingdom_hero),
          (store_faction_of_troop, ":roman_fac", ":roman"),
          (eq, ":roman_fac", "$players_kingdom"),
          (assign, ":relation_change", ":relation_reduction"),
          (try_begin),
              (this_or_next|troop_slot_eq, ":roman", slot_lord_reputation_type, lrep_quarrelsome),
              (troop_slot_eq, ":roman", slot_lord_reputation_type, lrep_debauched),
              (val_mul, ":relation_change", 3),
              (val_div, ":relation_change", 2),
          (try_end),
          (call_script, "script_change_player_relation_with_troop", ":roman", ":relation_reduction"),
      (try_end),
      (set_show_messages, 1),
      (call_script, "script_change_player_honor", ":relation_reduction"),
      (display_message, "@Your relation with Lords of your faction decreases.", message_negative),
      (change_screen_map),
    ]),
]),

("grain_protests",0,
  "Grain protests!^^The streets of Rome are in turmoil. Your recent decision to revoke the Lex Frumentaria et Agraria - the law that guaranteed subsidized grain to the urban poor—has sparked widespread outrage. Thousands of plebs, now facing hunger and insecurity, have taken to the streets in protest.",
  "none",[
    (set_background_mesh, "mesh_pic_townriot"),
  ],[
    ("Continue...",[],"Continue...",[
      (try_begin),
          (store_num_parties_of_template, ":num_parties", "pt_rebels"),
          (lt, ":num_parties", 30),
          (call_script, "script_spawn_party","p_town_6","pt_rebels"),
      (try_end),
      (call_script, "script_change_player_relation_with_center", "p_town_6", -25),
      (call_script, "script_change_troop_renown", "trp_player", -100),
      (change_screen_map),
    ]),
]),

("customize_unit",0,
  "You can select the name and the equipment of your custom troops! They can be recruited in all towns and forts that are owned by your faction and have a barrack building.",
  "none",[
    (set_background_mesh, "mesh_pic_mb_warrior_2"),
  ],[
    ("option_1", [],"Continue.",[
      # (assign, "$temp4", 0),
      (start_presentation, "prsnt_custom_troop_tree_legion"),
    ]),
]),

("custom_unit_found",0,
  "You have choosen equipment and a name for your new custom unit.^^{s31}",
  "none",[
    (str_clear, s31),
    (try_begin),
        (this_or_next|eq, "$g_player_troop", "trp_players_infantry"),
        (this_or_next|eq, "$g_player_troop", "trp_players_skirmisher"),
        (eq, "$g_player_troop", "trp_players_cavalry"),
        (str_store_troop_name, s32, "$g_player_troop"),
        (str_store_string, s31, "@^^NO troops will be added to your party - BUT you are now able to recruit the {s32} in every town or fortress you own."),
    (else_try),
        (str_store_troop_name, s32, "$g_player_troop"),
        (str_store_string, s31, "@^^NO troops will be added to your party - BUT {s32} will be at your orders soon. You can recruit units at its headquarter, if there is a barrack built (like any other Roman unit)."),
    (try_end),
    (set_background_mesh, "mesh_pic_recruits"),
    (try_begin),
        (eq, "$g_player_troop", "trp_players_legion"),
        (neg|troop_slot_ge, "trp_players_legion", slot_troop_banner_scene_prop, 0),
        (assign, "$g_edit_banner_troop", "trp_players_legion"),
        (assign, "$g_presentation_next_presentation", -1),
        (start_presentation, "prsnt_banner_selection"),
    (try_end),
  ],[
  ("Continue...",[],"Continue...",[
    (try_begin),
        (eq, "$g_player_troop", "trp_players_legion"),
        (store_add, ":slot", slot_legion_commanders_begin, 13),
        (troop_get_slot, ":legate", "trp_province_array", ":slot"),
        (troop_get_slot, ":selected_banner", "trp_players_legion", slot_troop_banner_scene_prop),
        (troop_set_slot, ":legate", slot_troop_banner_scene_prop, ":selected_banner"),
        (call_script, "script_create_kingdom_hero_party", ":legate", "$current_town"),
    (try_end),

    (assign, "$auto_enter_town", "$current_town"),
    (assign, "$g_town_visit_after_rest", 1),
    (assign, "$g_last_rest_center", "$current_town"),
    (assign, "$g_last_rest_payment_until", -1),
    (rest_for_hours, 48, 12, 0),
    (display_message, "@The preparations take some time...", message_alert),
    (change_screen_map),
  ]),
]),

("meeting_with_antonia_civilian",0,
  "You have established a camp with your entourage to rest and recharge. As you settle down to enjoy a meal, one of your slaves enters the tent,"
  +" his demeanor urgent. He seeks to inform you of a pressing matter that requires your immediate attention.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("Continue...",[],"Continue.",[
      (assign, "$g_encountered_party", "p_main_party"),#to fix bug in dialog
      (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
      (assign, "$talk_context", 0),#to fix bug in dialog
      (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
      (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
      (assign, "$g_encountered_party_faction", "$players_kingdom"),#to fix bug in dialog
      (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
      (assign, "$temp", 0),
      (assign, "$temp1", "trp_slave"),
      (set_jump_mission, "mt_roman_story_player_tent"),
      (modify_visitors_at_site, "scn_players_tent"),
      (reset_visitors, 0),
      (set_visitor, 1, "trp_slave"),
      (set_visitor, 2, "trp_player"),
      (set_visitor, 3, "trp_antonia"),
      (jump_to_scene, "scn_players_tent"),
      (change_screen_mission),
    ]),
]),

("meal_with_antonia",0,
  "{s23}",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
    (try_begin),
        (ge, "$g_rank", 1),
        (str_store_string, s23,
          "@You take her cloak and offer her a seat. The table is laid with a variety of dishes, including venison from the recent hunt. The wine, a fine Sicilian vintage, is a gift from one of your officers."
          +"You pour the wine into a cup and offer it to Antonia. Together, you both spill a small amount on the ground as an offering to the gods.^^As the meal unfolds, you and Antonia engage in conversation, discussing various trivialities."
        ),
    (else_try),
        (str_store_string, s23,
          "@You take her cloak and gesture for her to sit. The table is adorned with a selection of dishes, including tender venison from the latest hunt. The wine, a rich Sicilian vintage, is a gift from a senator."
          +" You pour the wine into a cup and hand it to Antonia, and together, you both spill a few drops onto the ground as an offering to the gods.^^As the meal progresses, you and Antonia engage in casual conversation, touching on various trivialities."
        ),
    (try_end),
  ],[
    ("Continue...",[],"Continue.",[
      (assign, "$temp", 6),
      (assign, "$temp1", -1),
      (set_jump_mission, "mt_roman_story_player_tent"),
      (modify_visitors_at_site, "scn_players_tent"),
      (reset_visitors, 0),
      (set_visitor, 4, "trp_player"),
      (set_visitor, 5, "trp_antonia"),
      (jump_to_scene, "scn_players_tent"),
      (change_screen_mission),
      (quest_set_slot, "qst_blank_quest_5", slot_quest_current_state, 7),
    ]),
]),

("meeting_with_antonia",0,
  "A soldier enters your tent while you are eating a meal. It is about an urgent matter.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("Continue...",[],"Continue.",[
      (assign, "$g_encountered_party", "p_main_party"),#to fix bug in dialog
      (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
      (assign, "$talk_context", 0),#to fix bug in dialog
      (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
      (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
      (assign, "$g_encountered_party_faction", "$players_kingdom"),#to fix bug in dialog
      (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
      (assign, "$temp", 0),
      (assign, "$temp1", "trp_quest_miles"),
      (set_jump_mission, "mt_roman_story_player_tent"),
      (modify_visitors_at_site, "scn_players_tent"),
      (reset_visitors, 0),
      (set_visitor, 1, "trp_quest_miles"),
      (set_visitor, 2, "trp_player"),
      (set_visitor, 3, "trp_antonia"),
      (jump_to_scene, "scn_players_tent"),
      (change_screen_mission),
    ]),
]),

("meeting_with_antonia_final_good",0,
  "{s23}",
  "none",[
    (set_background_mesh, "mesh_pic_hexe_party"),
    (try_begin),
        (ge, "$g_rank", 1),
        (str_store_string, s23,
          "@Your little play starts out quite conventionally, downright boringly normal."
          +" But then Antonia turns into a she-wolf; with a bit biting and scratching."
          +" In the end she honors Aphrodite with such ecstasy that even the soldiers outside the tent can only marvel."
          +" Later, when Phoebus' journey comes to an end and Luna covers your camp with a dark cloth, Antonia makes herself on way."
          +" The Night's Watch sees her sneaking away and thinks his part about the day's events."
        ),
    (else_try),
        (str_store_string, s23,
          "@Your little play starts out quite conventionally, downright boringly normal."
          +" But then Antonia turns into a she-wolf; with a bit biting and scratching."
          +" In the end she honors Aphrodite with such ecstasy that even the slaves and companions outside the tent can only marvel."
          +" Later, when Phoebus' journey comes to an end and Luna covers your camp with a dark cloth, Antonia makes herself on way."
          +" The Night's Watch sees her sneaking away and thinks his part about the day's events."
        ),
    (try_end),
  ],[
    ("Continue...",[],"Continue.",[
      (call_script, "script_change_player_relation_with_troop", "trp_antonia", 5),
      (add_xp_as_reward, 2500),
      (display_message, "str_quest_updated"),
      (add_quest_note_from_sreg, "qst_blank_quest_19", 5, "@Meet Antonia at Tarquinii as fast as possible to discuss the further plan.", 1),
      (quest_set_slot,"qst_blank_quest_19", slot_quest_object_state, 1),
      (change_screen_map),
    ]),
]),

("meeting_with_antonia_final_angry",0,
  "{s23}",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
    (try_begin),
        (ge, "$g_rank", 1),
        (str_store_string, s23,
          "@As suddenly as she came she leaves your camp. Shouting around insults at you and your soldiers. A soldier standing next to you notes:"
          +"^'This woman has indeed the spirit and temperament of a she-wolf.'"
        ),
    (else_try),
        (str_store_string, s23,
          "@As suddenly as she came she leaves your camp. Shouting around insults at you, your companions and slaves. A slave standing next to you notes:"
          +"^'This woman has indeed the spirit and temperament of a she-wolf.'"
        ),
    (try_end),
  ],[
  ("Continue...",[],"Continue.",[
    (call_script, "script_change_player_relation_with_troop", "trp_antonia", -5),
    (display_message, "str_quest_updated"),
    (add_quest_note_from_sreg, "qst_blank_quest_19", 5, "@Meet Antonia at Tarquinii as fast as possible to discuss the further plan.", 1),
    (quest_set_slot,"qst_blank_quest_19", slot_quest_object_state, 1),
    (change_screen_map),
  ]),
]),

("thoughts_2",0,
  "As you ride on the road, you think about what {s20} has told you. It seems Kaeso Flavius is worried about something related to the fire of Rome."
  +" After the fire, the Princeps issued a decree to persecute the Christs... Maybe he is a Christ too, and that's why he is worried. He fears to be crucified, like all the other Christs.",
  "none",[
    (play_sound, "snd_message_negative_sound"),
    (set_background_mesh, "mesh_pic_deserters"),
    (quest_get_slot,  ":lady", "qst_important_friends", slot_quest_object_troop),
    (str_store_troop_name, s20, ":lady"),
  ],[
  ("Continue...",[],"Continue...",[
    (add_quest_note_from_sreg, "qst_important_friends", 3, "@Finally, you know his secret: Kaeso Flavius is a Christ and it seems he is concerned about the recent persecution of Christians. Time to talk with him!", 0),
    (quest_set_slot, "qst_important_friends", slot_quest_current_state, 2),
    (change_screen_map),
  ]),
]),

#   (
#     "rom_burns",0,
#     "You notice black smoke over the roofs, and an awful smell lies in the air. People run around screaming: Fire!^\
#  Rome burns! You try to evacuate the town. Chaos breaks out: Slaves start killing their masters, bandits come out of their holes\
#  and start looting houses, gladiators revolt and try to free themselves. People are trampled to death, suffocated, or burned.^^In all the turmoil you are attacked by three run-away gladiators.",
#     "none",
#     [(set_background_mesh, "mesh_pic_fire_of_rome"),
#     ],
#     [
#       ("Continue...",[],"Continue.",[
#       (assign, "$visited_rom_first", 2),
#       (modify_visitors_at_site,"scn_roman_burns"),
#       (reset_visitors, 0),
#       (set_jump_entry,0),
#       (set_visitor, 1, "trp_slave_rebel"), #
#       (set_visitor, 2, "trp_slave_rebel"), #
#       (set_visitor, 3, "trp_slave_rebel"), #
#       (set_jump_mission, "mt_kill_christs"),
#       (jump_to_scene, "scn_roman_burns"),
#       (change_screen_mission),
#       ]),
#   ]),

("rom_burns_2",0,
    "As the smoke is getting thicker, you decide it is the best to leave Rome as fast as possible!^^Finally, you manage to reach a gate and leave the city.",
    "none",
    [(set_background_mesh, "mesh_pic_fire_of_rome"),
    ],[
    ("Continue...",[],"Luckily, I am alive.",[

      (jump_to_menu, "mnu_fire_of_rome"),

    ]),
]),

("cutscene_1",0,
    "Execution of traitors^^You are swept away by crowds of people streaming towards the arena. ''Lions! Lions! To the lions with the traitors!'', the people shout. A grand spectacle will be held in the arena. Out of curiosity you follow the crowd.",
    "none",
    [(set_background_mesh, "mesh_pic_roma"),

    ],
    [
      ("Continue...",[],"Continue...",[
        (call_script, "script_cutscene_1"),
      ]),
]),

("cutscene_2",0,
  "The spectacle ends with a riot. People shout insults and throw stones at Nero. The Praetorians appear to disperse the mob. Some people die others are wounded. Finally the mob scatters. You wander through the streets, still dazed by the events, as a shady person appears.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
  ("Continue...",[],"Continue...",[
    (add_xp_as_reward, 250),
    (assign, "$talk_context", tc_campaign_talk),
    (call_script, "script_setup_troop_meeting", "trp_petronius", -1, "scn_rome_center"),
  ]),
]),

("continue",0,
  "You slip through the narrow passages of Rome's hidden tunnels, shadows embracing your every step. Guided by the mysterious man, you trace the ancient labyrinth, a clandestine journey leading to a concealed chapel."
  +" The flickering candlelight reveals sacred murals on stone walls, echoing hushed prayers. As you approach, the clandestine chapel unveils itself - a sanctum where faith thrives in secrecy."
  +" The air is charged with reverence, and you, an unwitting adventurer, become a witness to the clandestine devotion hidden beneath the heart of Rome's intricate tapestry.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
  ("Continue...",[], "Continue...",[
    (call_script, "script_enter_secret_christian_church", 0),
  ]),
]),

("lucias_house",0,
  "As you approach the villa, you see a man of young age leaving it. It seems he has noticed you and is now walking in your direction.",
  "none",[
    (set_background_mesh, "mesh_pic_villa"),
  ],[
  ("Continue...",[],"Talk with him",[
    (assign, "$talk_context", tc_campaign_talk),
    (call_script, "script_setup_troop_meeting", "trp_amorus", -1, "scn_rome_center"),
  ]),
]),

("lucias_house_2",0,
  "After Amorus ran away, you walk towards the villa of Lucia Sabina. You knock at the door, but nothing happens, you knock again, still nothing."
  +" After a while, a slave opens. You tell him, you want to see Lucia Sabina. He says, she is currently sitting in the garden as usual.",
  "none",[
    (set_background_mesh, "mesh_pic_villa"),
  ],[
    ("Continue...",[],"Continue...",[
      (assign, "$temp", 1),
      (modify_visitors_at_site,"scn_lucias_villa"),
      (reset_visitors),
      (set_visitor,0,"trp_player"), #player
      (set_visitor,1,"trp_lucia"), #player

      (set_jump_mission,"mt_lucias_villa"),
      (jump_to_scene, "scn_lucias_villa"),
      (change_screen_mission),
    ]),
]),

("lucias_death",0,
  "For a brief moment, you stare at the headless body and the pool of blood that slowly spreads towards you. Before it can stain your feet you leave and enter her chambers. After a thorough inspection you find a locked chest. The key fits and inside you find the 100,000 denars you were promised."+
  " Now you need to make sure not to be suspected as her murderer. After taking the money you rush to the vigilia. ",
  "none",[
    (set_background_mesh, "mesh_pic_woman"),
  ],[
  ("Continue...",[],"Tell she was murdered by her slaves. According to Roman law, all her slaves will be crucified then.",[
    (troop_add_gold, "trp_player", 100000),
    (call_script, "script_end_quest", "qst_widow"),
    (jump_to_menu, "mnu_lucia_slaves_killed"),
  ]),
  ("Continue...",[],"Tell it was some paid murderer, who escaped.",[
    (store_random_in_range, ":r", 0, 2),
    (try_begin),
        (eq, ":r",0),
        (troop_add_gold, "trp_player", 100000),
        (call_script, "script_end_quest", "qst_widow"),
        (change_screen_map),
        (add_xp_as_reward, 250),
    (else_try),
        (jump_to_menu, "mnu_lucia_arrested"),
    (try_end),
  ]),
]),

("lucia_arrested",0,
  "Due to several mistakes in your story the vigilia distrust your word. Some witnesses are found who claim to have seen you climbing over the walls of her villa. "+
  "As a consequence you are arrested and the money you took from Lucia's villa is confiscated.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[ #qst_town_trade
    ("Continue...",[],"Damn.",[
      (add_xp_as_reward, 500),
      (assign, "$g_player_is_captive", 1),
      (store_random_in_range, ":random_hours", 60, 80),
      (call_script, "script_event_player_captured_as_prisoner"),
      (call_script, "script_stay_captive_for_hours", ":random_hours"),
      (assign,"$auto_menu", "mnu_captivity_castle_check"),
      (change_screen_return),
    ]),
]),

("lucia_slaves_killed",0,
  "Since slave revolts are common the vigilia trust your word. All of her dozen slaves are crucified, though no one suspects you.",
  "none",[
    (set_background_mesh, "mesh_pic_kreuzigung"),
  ],[ #qst_town_trade
  ("Continue...",[],"Continue.",[
    (jump_to_menu, "mnu_auto_return_map"),
    (add_xp_as_reward, 250),
  ]),
]),

("slave_message",0,
  "While you walk towards the town center you are interrupted by a slave. He greets you and says he was sent by his master to bring you a message."
  +" His master wants to talk with you. He has heard from the merchant Gaius Lucarius about your skills. You will receive 1000 denars"
  +" immediately if you visit him as fast as possible. His master is the goods merchant of Rome, you can find him in his shop in the town center of Rome."
  +" What is your response?",
    "none",
  [
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("Continue...",[],"Tell your master, I will come as soon as possible.",[
      (str_store_string, s2, "@Visit the goods merchant of Rome, you can find him in his shop in the town center of Rome."),
      (quest_set_slot, "qst_town_trade", slot_quest_current_state, 0),
      (quest_set_slot, "qst_town_trade", slot_quest_gold_reward, 1000),
      (quest_set_slot, "qst_town_trade", slot_quest_object_troop, -1),
      (call_script, "script_start_quest", "qst_town_trade", "trp_town_6_merchant"),
      (quest_set_slot, "qst_town_trade", slot_quest_menu_1, 1),
      (jump_to_menu, "mnu_town_trade"),
    ]),
    ("Continue...",[],"Tell your master I am not interested at all.",[
      (quest_set_slot, "qst_town_trade", slot_quest_menu_1, 1),
      (jump_to_menu, "mnu_town_trade"),
    ]),
]),

  (
    "grove",0,
    "You discover a small hut in the distance",
    "none",
    [  (set_background_mesh, "mesh_pic_deserters"),
    ],
    [ #qst_town_trade
      ("Continue...",[(quest_slot_eq, "qst_the_eagle", slot_quest_temp_slot, 2),],"Collect the herbs.",[
        (rest_for_hours, 4, 5, 0),
        (display_message, "@You start collecting the herbs"),
        (quest_set_slot, "qst_the_eagle", slot_quest_temp_slot, 3),
        (change_screen_map),
      ]),

      ("Continue...",[],"Visit the hut.",[

			 (modify_visitors_at_site,"scn_grove_witch"),
			 (reset_visitors),
			 (set_visitor,0,"trp_player"), #player
			 (set_visitor,1,"trp_witch"), #player

			 (set_jump_mission,"mt_witch"),
			 (jump_to_scene, "scn_grove_witch"),
			 (change_screen_mission),
      ]),

      ("Continue...",[],"Leave.",[
    (change_screen_map),
      ]),

  ]),
  (
    "grove_2",0,
    "You discover a dark forest.",
    "none",
    [  (set_background_mesh, "mesh_pic_deserters"),
    ],
    [
      ("Continue...",[
      (troop_slot_ge, "trp_witch", slot_troop_wealth, 1),
      ],"Search for Arminius tomb.",[
    (modify_visitors_at_site,"scn_arminius_tomb"),
    (reset_visitors),
    (set_visitor,0,"trp_player"), #player

    (set_jump_mission,"mt_arminius_grove"),
    (jump_to_scene, "scn_arminius_tomb"),
    (change_screen_mission),
      ]),

      ("Continue...",[],"Leave.",[
    (change_screen_map),
      ]),

  ]),
  (
    "scandia",0,
    "You follow the witch to a hill, not far away from her hut. As you walk through the forest, fog appears.\
 You walk on and the fog is getting thicker. On the slope of a hill you see the silhouette of a giant. You hear a wolf howling.\
 The witch says: 'This is the warrior from Scandia. I wish you good luck.' She smiles and gives you a kiss. Then she disappears in the fog.\
 Suddenly, a javelin hits next to you the ground.",
    "none",
    [  (set_background_mesh, "mesh_pic_deserters"),
    ],
    [ #qst_town_trade

      ("Continue...",[],"Defend yourself",[
 			 (modify_visitors_at_site,"scn_grove_witch_2"),
			 (reset_visitors),
			 (set_visitor,0,"trp_player"), #player
			 (set_visitor,1,"trp_scandia"), #player

			 (set_jump_mission,"mt_witch_2"),
			 (jump_to_scene, "scn_grove_witch_2"),
			 (change_screen_mission),
      ]),

  ]),

  (
    "won_witch",0,
    "You have defeated the beast. But he still seems to be alive. As you only need his head, you take your sword and cut off his head from his shoulders.",
    "none",
    [  (set_background_mesh, "mesh_pic_deserters"),
    ],
    [ #qst_town_trade

      ("Continue...",[],"Continue",[
        (quest_set_slot, "qst_the_eagle", slot_quest_temp_slot, 5),
        (add_quest_note_from_sreg, "qst_the_eagle", 4, "@You have defeated the warrior. Bring Hunna his head.", 0),
        (change_screen_map),
      ]),

  ]),

  (
    "lucillus",0,
    "You follow the slave through the streets of Rome to a huge building. The slave says this is the warehouse of Lucillus. He laughs for a moment and then leaves you alone.\
 You are a bit confused but then you remember your mission and walk towards the door. You notice it is open.\
 As you enter the house, several armed men await you. One says: 'Our master knows about Mamertinus plan. You better fight for your life.'",
    "none",
    [  (set_background_mesh, "mesh_pic_roma"),
    ],
    [ #qst_town_trade

      ("Continue...",[],"A trap...",[
         (set_jump_mission,"mt_lucillus_1"),
         (modify_visitors_at_site, "scn_house_1"),
         (reset_visitors),
         (set_visitor, 1, "trp_bandit"),
         (set_visitor, 2, "trp_bandit"),
         (set_visitor, 3, "trp_bandit"),
         (set_visitor, 4, "trp_bandit"),
         (set_jump_entry, 0),
         (jump_to_scene, "scn_house_1"),
         (change_screen_mission),
      ]),

  ]),

  (
    "party_with_mamertinus",0,
    "When you reach the villa, the festivities seems to have already started, as you can hear the laughs and shouts of men and women.^\
  As soon as you enter the house, you have a cup of wine in one hand and something to eat in the other...^\
  ... The extravagance of the food is stunning. You notice most of the other guests are people of Roman high society: senators, sons of senators, rich merchants,\
  wifes of important persons...^\
  The evening progresses. All drink like vats. Some run off to vomit and others fight like gamecocks to attract the attention of a girl...",
    "none",
    [  (set_background_mesh, "mesh_pic_party"),
    ],
    [ #qst_town_trade

      ("Continue...",[],"It's party time! Let's get drunk!",[
        # (call_script, "script_change_troop_renown", "trp_player", 25),
        # (assign, "$auto_enter_town", "$current_town"),
        # (assign, "$g_town_visit_after_rest", 1),
        # (assign, "$g_last_rest_center", "$current_town"),
        # (assign, "$g_last_rest_payment_until", -1),
        # (rest_for_hours, 12, 4, 0),

      # (change_screen_map)
			(modify_visitors_at_site,"scn_temple_of_bacchus"),
			(reset_visitors),
			(set_visitor,1,"trp_player"), #player
			(set_visitor,6,"trp_bannerlord"),
			(set_visitor,7,"trp_diggus"),
			(set_visitor,8,"trp_orgie_male1"),
			(set_visitor,9,"trp_orgie_male1"),
			(set_visitor,10,"trp_orgie_male1"),
			(set_visitor,11,"trp_billy"),
			(set_visitor,12,"trp_orgie_male1"),
			(set_visitor,13,"trp_orgie_fem4"),
			(set_visitor,14,"trp_orgie_fem2"),
			(set_visitor,15,"trp_orgie_fem3"),
			(set_visitor,16,"trp_orgie_fem1"),

			#some music guys
			(store_random_in_range, ":music_guy", tavern_minstrels_begin, tavern_minstrels_end),
			(set_visitor,21,":music_guy"),
			(store_random_in_range, ":music_guy2", tavern_minstrels_begin, tavern_minstrels_end),
			(set_visitor,22,":music_guy2"),
			(assign, "$temp", 0),
			(set_jump_mission,"mt_orgie"),
			(jump_to_scene, "scn_temple_of_bacchus"),
			(change_screen_mission),

      ]),

  ]),
  (
    "end_party",0,
    "You awake with a terrible headache, lying in a haystack. In front of you lies an empty bottle of wine. You can't remember how you came here,\
 nore what happend during the party. It doesn't matter at all.",
    "none",
    [  (set_background_mesh, "mesh_pic_party"),
    ],
    [ #qst_town_trade

      ("Continue...",[],"I shouldn't drink so much ...",[
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (call_script, "script_change_player_honor", -5),
        # (assign, "$auto_enter_town", "$current_town"),
        # (assign, "$g_town_visit_after_rest", 1),
        # (assign, "$g_last_rest_center", "$current_town"),
        # (assign, "$g_last_rest_payment_until", -1),
        # (rest_for_hours, 12, 4, 0),
      (change_screen_map)

      ]),

  ]),

  (
    "lucillus_villa",0,
    "After a while you finally find Lucillus villa. From the distance you notice, that the place is guarded by several armed men.\
 You walk around the building and search for the best point to enter. As you walk close to the wall which seems to surround the garden, you hear some voices laughing.\
 You stand on a box that happens to be next to the wall and look over the wall: It seems Lucillus has a conversation with two other men. If you would climb over the wall you\
 could kill them and maybe even loot his villa...",
    "none",
    [  (set_background_mesh, "mesh_pic_roma"),
    ],
    [ #qst_town_trade

      ("Continue...",[],"Climb over the wall.",[
         (set_jump_mission,"mt_lucillus_2"),
         (modify_visitors_at_site, "scn_house_2"),
         (reset_visitors),
         (set_visitor, 1, "trp_lucillus"),
         (set_visitor, 2, "trp_senator"),
         (set_visitor, 3, "trp_senator"),
         (set_visitor, 4, "trp_hired_blade"),
         (set_visitor, 5, "trp_hired_blade"),
         (set_visitor, 6, "trp_hired_blade"),
         (set_visitor, 7, "trp_hired_blade"),
         (set_visitor, 8, "trp_slave"),
         (set_visitor, 9, "trp_slave_female"),
         (set_jump_entry, 0),
         (jump_to_scene, "scn_house_2"),
         (change_screen_mission),
      ]),

      ("Continue...",[],"Go back.",[
        (jump_to_menu, "mnu_temples"),
      ]),

  ]),

  (
    "luc_vic_2",0,
    "It seems you have finally killed Lucillus. You use the opportunity and search the villa for valuables. You find jewelry and denars in the value of 10000 denars.\
 It is time to claim your reward.",
    "none",
    [
    ],
    [ #qst_town_trade

      ("Continue...",[],"Continue...",[
        (add_quest_note_from_sreg, "qst_town_trade_2", 4, "@Finally you have killed Lucillus. Claim your reward!", 0),
        (add_xp_as_reward, 2000),
        (troop_add_gold, "trp_player", 10000),
        (quest_set_slot, "qst_town_trade_2", slot_quest_current_state, 2),
        (change_screen_map),
      ]),

  ]),

  (
    "luc_vic",0,
    "After you have defeated your opponents you quickly leave the warehouse. You should inform Mamertinus about this outcome.",
    "none",
    [
    ],
    [ #qst_town_trade

      ("Continue...",[],"Continue...",[
        (add_quest_note_from_sreg, "qst_town_trade_2", 3, "@It seems Lucillus was informed about the plan. Report back to Mamertinus.", 0),
        (add_xp_as_reward, 1000),
        (change_screen_map),
      ]),

  ]),
  (
    "luc_def",0,
    "You fall to the ground and everything becomes black...^^After some hours you awake with a terrible headache. It seems you are alive.",
    "none",
    [
    ],
    [ #qst_town_trade

      ("Continue...",[],"Continue...",[
        (add_quest_note_from_sreg, "qst_town_trade_2", 3, "@It seems Lucillus was informed about the plan. Report back to Mamertinus.", 0),
        (add_xp_as_reward, 1000),
        (troop_remove_gold, "trp_player", 500),
        (jump_to_menu, "mnu_town"),
      ]),

  ]),

  (
    "siege_event_test",0,
    "Select an event",
    "none",
    [

    ],
    [
      ("event04",[],"Event04",[ (jump_to_menu,"mnu_event_siege_04"),]),
      ("event04",[],"Event05",[ (jump_to_menu,"mnu_event_siege_05"),]),
      ("event04",[],"Event06",[ (jump_to_menu,"mnu_event_siege_06"),]),
      ("event04",[],"Event07",[ (jump_to_menu,"mnu_event_siege_07"),]),
      ("event04",[],"Event08",[ (jump_to_menu,"mnu_event_siege_08"),]),
      ("event04",[],"Event09",[ (jump_to_menu,"mnu_event_siege_09"),]),
      ("event04",[],"Event10",[ (jump_to_menu,"mnu_event_siege_10"),]),
      ("event04",[],"Event11",[ (jump_to_menu,"mnu_event_siege_11"),]),
      ("event04",[],"Event12",[ (jump_to_menu,"mnu_event_siege_12"),]),
      ("event04",[],"Event13",[ (jump_to_menu,"mnu_event_siege_13"),]),
      ("event04",[],"next page",[ (jump_to_menu,"mnu_siege_event_test2"),]),

  ]),
  (
    "siege_event_test2",0,
    "Select an event",
    "none",
    [    ],
    [
      ("event04",[],"Event14",[ (jump_to_menu,"mnu_event_siege_14"),]),
      ("event04",[],"Event15",[ (jump_to_menu,"mnu_event_siege_15"),]),
      ("event04",[],"Event16",[ (jump_to_menu,"mnu_event_siege_16"),]),
      ("event04",[],"Event17",[ (jump_to_menu,"mnu_event_siege_17"),]),
      ("event04",[],"Event18",[ (jump_to_menu,"mnu_event_siege_18"),]),
      ("event04",[],"Event19",[ (jump_to_menu,"mnu_event_siege_19"),]),
      ("event04",[],"Event20",[ (jump_to_menu,"mnu_event_siege_20"),]),
      ("event04",[],"Event21",[ (jump_to_menu,"mnu_event_siege_21"),]),
      ("event04",[],"Event22",[ (jump_to_menu,"mnu_event_siege_22"),]),
      ("event04",[],"Event23",[ (jump_to_menu,"mnu_event_siege_23"),]),
      ("event04",[],"next page",[ (jump_to_menu,"mnu_siege_event_test3"),]),

  ]),
  (
    "siege_event_test3",0,
    "Select an event",
    "none",
    [],
    [
      ("event04",[],"Event24",[ (jump_to_menu,"mnu_event_siege_24"),]),
      ("event04",[],"Event25",[ (jump_to_menu,"mnu_event_siege_25"),]),
      ("event04",[],"Event26",[ (jump_to_menu,"mnu_event_siege_26"),]),
      ("event04",[],"Event27",[ (jump_to_menu,"mnu_event_siege_27"),]),
      ("event04",[],"Event28",[ (jump_to_menu,"mnu_event_siege_28"),]),
      ("event04",[],"Event29",[ (jump_to_menu,"mnu_event_siege_29"),]),
  ]),

("duel_2",0,
  "You shout at the troublemaker: 'I will show you a lesson. Such childish shit must be punished.' ^^"
  +"Troublemaker: 'I will beat you to the ground.'^^^"
  +"Other soldiers who have noticed your dispute, surround you and start to cheer and shout. Now there is no way back, you must fight.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("event04",[],"Fight!",[
      (try_begin),
        (store_troop_health, ":health", "trp_player", 0), #get relative health in 1-100 range and put it into the ":health" variable
        (lt, ":health", 30),
        (val_add, ":health", 35),               #add to it the 5%
        (troop_set_health,   "trp_player", ":health"),   #set it
      (try_end),
      (assign, "$g_encountered_party", "$enlisted_party"),
      (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
      (troop_get_slot, ":legion", ":lord", slot_troop_legion),
      (store_add, ":troop", ":legion", "trp_eastern_elite_infantry_vet"),

      (assign, "$g_duel_troop", "trp_quest_miles"),
      (set_jump_mission,"mt_viking_duel_normal"),
      (modify_visitors_at_site, "scn_duel_plain_forest"),
      (reset_visitors),

      (mission_tpl_entry_set_override_flags, "mt_viking_duel_normal",0, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_viking_duel_normal", 0),
      (mission_tpl_entry_add_override_item, "mt_viking_duel_normal", 0, "itm_roman_poor1"),
      (mission_tpl_entry_add_override_item, "mt_viking_duel_normal", 0, "itm_graves_simple_2"),
      (set_visitor, 0, "trp_player"),
      (mission_tpl_entry_set_override_flags, "mt_viking_duel_normal",1, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_viking_duel_normal", 1),
      (mission_tpl_entry_add_override_item, "mt_viking_duel_normal", 1, "itm_roman_poor1"),
      (mission_tpl_entry_add_override_item, "mt_viking_duel_normal", 1, "itm_graves_simple_2"),
      (set_visitor, 1, "$g_duel_troop"),

      (try_for_range,":position",2,22),
        (mission_tpl_entry_set_override_flags, "mt_viking_duel_normal",":position", af_override_all),
        (mission_tpl_entry_clear_override_items, "mt_viking_duel_normal", ":position"),
        (mission_tpl_entry_add_override_item, "mt_viking_duel_normal", ":position", "itm_roman_poor2"),
        (mission_tpl_entry_add_override_item, "mt_viking_duel_normal", ":position", "itm_graves_simple_2"),
        (set_visitor, ":position", ":troop"),
      (try_end),

      (jump_to_scene, "scn_duel_plain_forest"),

      (change_screen_mission),
    ]),
]),

("duel",0,
  "You prepare for the duel and sharpen your weapons. You will have to fight for your life.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("event04",[],"Continue...",[
      (try_begin),
        (store_troop_health, ":health", "trp_player", 0), #get relative health in 1-100 range and put it into the ":health" variable
        (lt, ":health", 30),
        (val_add, ":health", 35),               #add to it the 5%
        (troop_set_health,   "trp_player", ":health"),   #set it
      (try_end),
      (call_script, "script_change_player_party_morale", 1),
      (set_jump_mission,"mt_viking_duel_normal"),
      (call_script, "script_duel_init_system", "scn_duel_plain_forest", "$g_talk_troop"),
      (change_screen_mission),
    ]),
]),

("duel_win",0,
  "You defeat your opponent. As Albus men see their chief falling to the ground, they start running away. Your men try to capture them, but without success. Nevertheless, you have captured Albus.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters")
  ],[
  ("event04",[],"Continue...",[
    (remove_party, "$g_encountered_party"),
    (troop_join_as_prisoner, "$g_talk_troop"),
    (call_script, "script_succeed_quest", "qst_slave_revolt"),
    (change_screen_map),
  ]),
]),

("ywhe",0,
  "You undergo the rituals and you learn quickly about the jewish faith.",
  "none",[
    (set_background_mesh, "mesh_pic_jerusalem_tempel")
  ],[
  ("event04",[],"Continue...",[
    (call_script, "script_player_change_religion", worships_yhwhe),
    (rest_for_hours, 24, 8, 0),
    (change_screen_map),
  ]),
]),

("revolt_start",0,
  "You climb on box and start to speak:^^'Brothers and Sisters of faith, we have tolerated foreign occupation for decades now and I must say: I can't stand it any longer."
  +" We should end our suppression today! Brothers and sisters, let us fight today for the glory of Judea!'",
  "none",[
    (set_background_mesh, "mesh_pic_townriot")
  ],[
  ("event04",[],"Romani ite domum!",[
    (jump_to_menu, "mnu_players_revolt"),
  ]),
  ("event04",[],"Apologize for the misunderstanding.",[
    (call_script, "script_change_player_relation_with_center", "$current_town", -5),
    (jump_to_menu, "mnu_town"),
  ]),
]),

("players_revolt",0,
  "You hold a fiery speech. More and more people gather to listen to your words. As you end, the crowd cheers!"
  +" The angry mob massacres the garrison. The high priests overtake"
  +" the command of the rebel forces.^^The great Jewish revolt has started!^^{s44}",
  "none",[
    (set_background_mesh, "mesh_pic_townriot"),
    (str_clear, s44),
    (try_begin),
      (faction_slot_eq, "fac_kingdom_6", slot_faction_state, sfs_active),
      (assign, ":count", 0),
      (try_for_range, ":center", walled_centers_begin, walled_centers_end),
        (store_faction_of_party, ":fac", ":center"),
        (eq, ":fac", "fac_kingdom_6"),
        (val_add, ":count", 1),
      (try_end),
      (ge, ":count", 1),
      (str_store_string, s44, "@It is now crucial to find a strong ally. The most reasonable candidate is Parthia. Thus, your first task is to negotiate a treaty with the Parthian king."),
      (setup_quest_text,"qst_new_hope"),
      (faction_get_slot, ":king", "fac_kingdom_6", slot_faction_leader),
      (str_store_troop_name_link, s43, ":king"),
      (str_store_string, s2, "@The only chance for the Judean kingdom to survive, is to win Parthia as an ally. Travelle to {s43} to negotiate a treaty."),
      (call_script, "script_start_quest", "qst_new_hope", "trp_fortuna"),
      (quest_set_slot, "qst_new_hope", slot_quest_expiration_days, 60),
      (quest_set_slot, "qst_new_hope", slot_quest_target_troop, ":king"),
    (try_end),
  ],[
    ("event04",[],"Continue. (as king)",[
      (display_message, "@One of the high priests gift you a beautiful bow and some gold from the temple!"),
      (troop_add_item, "trp_player", "itm_menorah"),
      (troop_add_item, "trp_player", "itm_thunder_arrows"),
      (troop_add_item, "trp_player", "itm_thunder",imodbit_masterwork),
      (troop_add_item, "trp_player", "itm_temple_gold"),
      (troop_add_item, "trp_player", "itm_temple_gold"),

      (faction_set_slot, "fac_player_supporters_faction", slot_faction_banner, "mesh_banner_kingdom_17"),
      (faction_get_slot, ":cur_faction_banner", "fac_player_supporters_faction", slot_faction_banner),
      (val_sub, ":cur_faction_banner", banner_meshes_begin),
      (store_add, ":selected_banner_map_icon", ":cur_faction_banner", banner_map_icons_begin),
      (party_set_banner_icon, "p_main_party", ":selected_banner_map_icon"),
      (val_add, ":cur_faction_banner", banner_scene_props_begin),
      (troop_set_slot, "trp_player", slot_troop_banner_scene_prop, ":cur_faction_banner"),

      (display_log_message, "@You take over the jewish culture"),
      (set_show_messages, 0),
      (call_script, "script_cf_start_jewish_revolt"),
      (set_show_messages, 1),
      (faction_set_slot, "fac_player_supporters_faction", slot_faction_has_nor_titles, 0),
      (call_script, "script_change_troop_renown", "trp_player", 100),
      (call_script, "script_activate_player_faction", "trp_player"),
      (faction_set_slot, "fac_kingdom_17", slot_faction_state, sfs_inactive),
      (call_script, "script_give_center_to_lord", "p_town_19", "trp_player", 0),
      (assign, "$g_player_court", "p_town_19"),

      (troop_get_slot, ":king_party", "trp_kingdom_17_lord", slot_troop_leaded_party),
      (call_script, "script_destroy_party", ":king_party"),
      (troop_set_slot, "trp_kingdom_17_lord", slot_troop_leaded_party, -1),
      (troop_set_slot, "trp_kingdom_17_lord", slot_troop_occupation, slto_inactive),
      (troop_set_faction,"trp_kingdom_17_lord","fac_outlaws"),
      (troop_set_slot, "trp_player", slot_troop_culture, "fac_culture_8"),

      (faction_set_slot, "fac_player_supporters_faction",  slot_faction_culture, "fac_culture_8"),
      (faction_set_slot, "fac_player_faction",  slot_faction_culture, "fac_culture_8"),

      (call_script, "script_initialize_faction_troop_types"),

      (try_for_range,":npc",active_npcs_begin,active_npcs_end),
          (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
          (store_faction_of_troop, ":fac", ":npc"),
          (eq, ":fac", "fac_kingdom_17"),
          (call_script,"script_change_troop_faction",":npc","$players_kingdom"),
          (troop_set_slot, ":npc", slot_troop_occupation, slto_kingdom_hero),
          (store_random_in_range,":new_relation",15,35),
          (call_script, "script_troop_change_relation_with_troop", "trp_player", ":npc", ":new_relation"),
      (try_end),

      (call_script, "script_update_faction_notes","$players_kingdom"),
      (call_script, "script_change_player_right_to_rule", 50),
      (call_script, "script_update_all_notes"),

      # (call_script, "script_troop_set_title_according_to_faction", "trp_player", "$players_kingdom"),

      (try_begin),
        (is_between, "$players_oath_renounced_against_kingdom", kingdoms_begin, kingdoms_end),
        (neq, "$players_oath_renounced_against_kingdom", "fac_kingdom_17"),
        (store_relation, ":relation", "fac_player_supporters_faction", "$players_oath_renounced_against_kingdom"),
        (val_min, ":relation", -40),
        (call_script, "script_set_player_relation_with_faction", "$players_oath_renounced_against_kingdom", ":relation"),
        (call_script, "script_update_all_notes"),
        (assign, "$g_recalculate_ais", 1),
      (try_end),

      (try_begin),
        (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
        (neq, "$players_kingdom", "fac_player_supporters_faction"),
        (neq, "$players_kingdom", "fac_kingdom_17"), #ie, don't leave faction if the player is already part of the same kingdom

        (faction_get_slot, ":old_leader", "$players_kingdom", slot_faction_leader),
        (call_script, "script_add_log_entry", logent_renounced_allegiance,   "trp_player",  -1, ":old_leader", "$players_kingdom"),
        (call_script, "script_player_leave_faction", 0),
      (try_end),

      # (call_script, "script_player_join_faction", "fac_kingdom_17"),

      # (call_script, "script_add_log_entry", logent_,   "trp_player",  -1, "trp_kingdom_17_lord", "fac_kingdom_17"),

      (try_begin),
        # (check_quest_active, "qst_join_faction"),
        # (eq, "$g_invite_faction_lord", "fac_kingdom_17_lord"),
        # (call_script, "script_end_quest", "qst_join_faction"),
      # (else_try),
        (check_quest_active, "qst_join_faction"),
        (call_script, "script_abort_quest", "qst_join_faction", 0),
      (try_end),
      (assign, "$player_has_homage" ,1),
      (assign, "$g_player_banner_granted", 1),
      (assign, "$g_invite_faction", 0),
      (assign, "$g_invite_faction_lord", 0),
      (assign, "$g_invite_offered_center", 0),
      #(assign, "$g_leave_encounter",1),
      (call_script, "script_diplomacy_start_war_between_kingdoms", "$players_kingdom", "fac_kingdom_7", logent_faction_declares_war_to_declare_independence),

      (call_script, "script_change_player_relation_with_faction", "fac_mountain_bandits", 200),
      (change_screen_map),
    ]),

  ("event04",[],"Continue. (as lord)",[
    (display_log_message, "@You take over the jewish culture"),
    (troop_set_slot, "trp_player", slot_troop_culture, "fac_culture_8"),
    (call_script, "script_cf_start_jewish_revolt"),

    (try_begin),
        (eq, "$players_kingdom", "fac_player_supporters_faction"),
        (call_script, "script_deactivate_player_faction"),
        (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
          (store_faction_of_troop, ":npc_faction", ":npc"),
          (eq, ":npc_faction", "fac_kingdom_7"),
          (troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_hero),
          (call_script, "script_change_troop_faction", ":npc", "fac_kingdom_17"),
        (try_end),
    (try_end),

      (try_begin),
        (is_between, "$players_oath_renounced_against_kingdom", kingdoms_begin, kingdoms_end),
        (neq, "$players_oath_renounced_against_kingdom", "fac_kingdom_17"),
        (store_relation, ":relation", "fac_player_supporters_faction", "$players_oath_renounced_against_kingdom"),
        (val_min, ":relation", -40),
        (call_script, "script_set_player_relation_with_faction", "$players_oath_renounced_against_kingdom", ":relation"),
        (call_script, "script_update_all_notes"),
        (assign, "$g_recalculate_ais", 1),
      (try_end),

      (try_begin),
        (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
        (neq, "$players_kingdom", "fac_player_supporters_faction"),
        (neq, "$players_kingdom", "fac_kingdom_17"), #ie, don't leave faction if the player is already part of the same kingdom

        (faction_get_slot, ":old_leader", "$players_kingdom", slot_faction_leader),
        (call_script, "script_add_log_entry", logent_renounced_allegiance,   "trp_player",  -1, ":old_leader", "$players_kingdom"),
        (call_script, "script_player_leave_faction", 0),
      (try_end),

      (call_script, "script_player_join_faction", "fac_kingdom_17"),

      (call_script, "script_add_log_entry", logent_pledged_allegiance,   "trp_player",  -1, "trp_kingdom_17_lord", "fac_kingdom_17"),

    (try_begin),
        # (check_quest_active, "qst_join_faction"),
        # (eq, "$g_invite_faction_lord", "fac_kingdom_17_lord"),
        # (call_script, "script_end_quest", "qst_join_faction"),
      # (else_try),
        (check_quest_active, "qst_join_faction"),
        (call_script, "script_abort_quest", "qst_join_faction", 0),
      (try_end),
      (assign, "$player_has_homage" ,1),
      (assign, "$g_player_banner_granted", 1),
      (assign, "$g_invite_faction", 0),
      (assign, "$g_invite_faction_lord", 0),
      (assign, "$g_invite_offered_center", 0),
      #(assign, "$g_leave_encounter",1),
    (call_script, "script_change_player_relation_with_faction", "fac_mountain_bandits", 200),

    (faction_set_slot, "fac_player_supporters_faction",  slot_faction_culture, "fac_culture_8"),
    (faction_set_slot, "fac_player_faction",  slot_faction_culture, "fac_culture_8"),

    (call_script, "script_initialize_faction_troop_types"),
    (change_screen_map),
  ]),
]),

("found_rebells",0,
  "By supporting the Judean people with money you can improve your relation with them and cause unrest in the Roman Empire!",
  "none",[
    (set_background_mesh, "mesh_pic_townriot")
  ],[
  ("large",[],"Found one large rebell party. (5,000 denars)",[
    (store_troop_gold, reg55, "trp_player"),
    (try_begin),
        (store_num_parties_of_template, reg54, "pt_mountain_bandits"),
        (gt, reg54, 20),
        (display_message, "@There are already too many existing rebell parties!"),
    (else_try),
        (lt, reg55, 5000),
        (display_message, "str_not_enough_gold"),
    (else_try),
        (troop_remove_gold, "trp_player", 5000),
        (try_begin),
            (lt, "$g_unrest", 75),
            (val_add, "$g_unrest", 2),
        (try_end),
        (set_spawn_radius, 3),
        (call_script, "script_spawn_party", "p_town_19", "pt_mountain_bandits"),
        (assign, ":party", reg0),
        (party_set_slot, ":party", slot_party_spawn_point, "p_town_19"),
        (party_add_members, ":party", "trp_judean_light_clubman", 10),
        (party_add_members, ":party", "trp_judean_light_spearman", 10),
        (party_add_members, ":party", "trp_judean_archer", 15),
        (call_script, "script_change_player_relation_with_faction", "fac_mountain_bandits", 4),
    (try_end),
  ]),
  ("small",[],"Found one rebell party. (2,500 denars)",[
    (store_troop_gold, reg55, "trp_player"),
    (try_begin),
        (store_num_parties_of_template, reg54, "pt_mountain_bandits"),
        (gt, reg54, 20),
        (display_message, "@There are already to many existing rebell parties!"),
    (else_try),
        (lt, reg55, 2500),
        (display_message, "str_not_enough_gold"),
    (else_try),
        (troop_remove_gold, "trp_player", 2500),
        (try_begin),
            (lt, "$g_unrest", 75),
            (val_add, "$g_unrest", 1),
        (try_end),

        (set_spawn_radius, 3),
        (call_script, "script_spawn_party", "p_town_19", "pt_mountain_bandits"),
        (assign, ":party", reg0),
        (party_set_slot, ":party", slot_party_spawn_point, "p_town_19"),
        (call_script, "script_change_player_relation_with_faction", "fac_mountain_bandits", 2),
    (try_end),
  ]),
  ("leave",[],"Go back.",[
    (jump_to_menu, "mnu_temple_jerusalem")
  ]),
]),

("host_games",0,
  "You can choose between various options. The more magnificent the spectacle is, the more your relation with the town, your renown and reputation will improve.^"
  +" But even if you spend hundred thounsands of denars, don't expect you can improve your relation that much. People usually forget such events quite fast.",
  "none",[
    (set_background_mesh, "mesh_pic_gladiator")
  ],[
    ("event04",[
      (str_store_party_name, s10, "$g_encountered_party"),
    ],"The greatest spectacle {s10} has ever seen, with free food and drinks (300,000 denars)",[
      (store_troop_gold, ":gold", "trp_player"),
      (assign, "$g_triumph", 1),
      (try_begin),
        (lt, ":gold", 300000),
        (display_message, "@You need more money!"),
      (else_try),
        (ge, ":gold", 300000),
        (troop_remove_gold, "trp_player", 300000),
        (call_script, "script_change_player_relation_with_center", "$current_town", 25),
        (call_script, "script_change_troop_renown", "trp_player", 60),
        (call_script, "script_change_player_honor", 15),
        (call_script, "script_add_piety", 10, 1),
        (call_script, "script_fill_tournament_participants_troop", "$current_town", 1),
        (assign, "$g_tournament_cur_tier", 0),
        (assign, "$g_tournament_player_team_won", -1),
        (assign, "$g_tournament_bet_placed", 0),
        (assign, "$g_tournament_bet_win_amount", 0),
        (assign, "$g_tournament_last_bet_tier", -1),
        (assign, "$g_tournament_next_num_teams", 0),
        (assign, "$g_tournament_next_team_size", 0),
        (try_begin),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
          (jump_to_menu, "mnu_decide_game"),
        (else_try),
          (jump_to_menu, "mnu_town_tournament"),
        (try_end),
      (try_end),
    ]),
    ("event04",[],"An extravagante Game, with free food and drinks (100,000 denars)",[
      (store_troop_gold, ":gold", "trp_player"),
      (assign, "$g_triumph", 1),
      (try_begin),
        (lt, ":gold", 100000),
        (display_message, "@You need more money!"),
      (else_try),
        (ge, ":gold", 100000),
        (troop_remove_gold, "trp_player", 100000),
        (call_script, "script_change_player_relation_with_center", "$current_town", 10),
        (call_script, "script_change_troop_renown", "trp_player", 20),
        (call_script, "script_change_player_honor", 4),
        (call_script, "script_add_piety", 4, 1),
        (call_script, "script_fill_tournament_participants_troop", "$current_town", 1),
        (assign, "$g_tournament_cur_tier", 0),
        (assign, "$g_tournament_player_team_won", -1),
        (assign, "$g_tournament_bet_placed", 0),
        (assign, "$g_tournament_bet_win_amount", 0),
        (assign, "$g_tournament_last_bet_tier", -1),
        (assign, "$g_tournament_next_num_teams", 0),
        (assign, "$g_tournament_next_team_size", 0),
        (try_begin),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
          (jump_to_menu, "mnu_decide_game"),
        (else_try),
          (jump_to_menu, "mnu_town_tournament"),
        (try_end),
      (try_end),
    ]),
    ("event04",[],"Normal Games, with free food and drinks (50,000 denars)",[
      (store_troop_gold, ":gold", "trp_player"),
      (assign, "$g_triumph", 1),
      (try_begin),
        (lt, ":gold", 50000),
        (display_message, "@You need more money!"),
      (else_try),
        (ge, ":gold", 50000),
        (troop_remove_gold, "trp_player", 50000),
        (call_script, "script_change_player_relation_with_center", "$current_town", 8),
        (call_script, "script_change_troop_renown", "trp_player", 10),
        (call_script, "script_change_player_honor", 2),
        (call_script, "script_add_piety", 2, 1),
        (call_script, "script_fill_tournament_participants_troop", "$current_town", 1),
        (assign, "$g_tournament_cur_tier", 0),
        (assign, "$g_tournament_player_team_won", -1),
        (assign, "$g_tournament_bet_placed", 0),
        (assign, "$g_tournament_bet_win_amount", 0),
        (assign, "$g_tournament_last_bet_tier", -1),
        (assign, "$g_tournament_next_num_teams", 0),
        (assign, "$g_tournament_next_team_size", 0),
        (try_begin),
        (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
        (jump_to_menu, "mnu_decide_game"),
        (else_try),
        (jump_to_menu, "mnu_town_tournament"),
        (try_end),
      (try_end),
    ]),
    ("event04",[],"Normal Games, without any addition (25,000 denars)",[
      (store_troop_gold, ":gold", "trp_player"),
      (assign, "$g_triumph", 1),
      (try_begin),
        (lt, ":gold", 25000),
        (display_message, "@You need more money!"),
      (else_try),
        (ge, ":gold", 25000),
        (troop_remove_gold, "trp_player", 25000),
        (call_script, "script_change_player_relation_with_center", "$current_town", 4),
        (call_script, "script_fill_tournament_participants_troop", "$current_town", 1),
        (assign, "$g_tournament_cur_tier", 0),
        (assign, "$g_tournament_player_team_won", -1),
        (assign, "$g_tournament_bet_placed", 0),
        (assign, "$g_tournament_bet_win_amount", 0),
        (assign, "$g_tournament_last_bet_tier", -1),
        (assign, "$g_tournament_next_num_teams", 0),
        (assign, "$g_tournament_next_team_size", 0),
        (try_begin),
          (party_slot_eq, "$current_town", slot_center_culture, "fac_culture_7"),
          (jump_to_menu, "mnu_decide_game"),
        (else_try),
          (jump_to_menu, "mnu_town_tournament"),
        (try_end),
      (try_end),
    ]),
    ("event04",[],"Go back.",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

### events for the senate
("event_senate_01",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "A favour for a friend^^As you enter the Curia Julia, a senator approaches you. He introduces himself as one of your supporters and asks you for a favor:^^"
  +"'Dominus, I have a urgent problem in which you probably can help me. I am in dire need of money for a lawyer since I'm in a legal dispute with a rich citizen. If you could gift me 10,000 denars as a token of our friendship?'",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, "$temp3", "mesh_pic_senators"),
    (store_troop_gold,"$temp4", "trp_player"),
  ],[
    ("choice_1",[(ge, "$temp4", 10000),],"Give him the money.",[
      (troop_remove_gold, "trp_player", 10000),
      (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (str_store_string, s44, "@Happy about your decision, the senator tells the people how reliable you are."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_2",[],"I am sorry, but there is nothing I can do for you.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -4),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (call_script, "script_change_senate_support", -1, 0),
      (str_store_string, s44, "@Disappointed about your decision, the senator tells, that you are not reliable!"),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_3",[
      (store_party_size_wo_prisoners, ":size", "p_main_party"),
      (ge, ":size", 10),
    ],"I can help you in other ways. I will let my troops visit this man. I am sure he will drop his lawsuit.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (call_script, "script_change_troop_renown", "trp_player", 3),
      (call_script, "script_change_player_honor", -4),
      (str_store_string, s44, "@Happy about your decision, the senator tells the people how reliable you are."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
]),

("event_senate_02",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Lazy Patron^^As you enter the Curia Julia, a young man approaches you. He looks poor and dirty and at first you think he is a beggar. But he introduces himself as a client of one of the senators supporting you. He says:^^"
  +"'Dominus, I asked my patron to protect me. I was attacked by robbers while I visited a tavern. They stole me 500 denars! This is a large sum for a poor man like me."
  +" I know exactly who has stolen my money and I asked my patron if he could take over the matter and take revenge. But he send me away and told me I should ask you for support instead.'",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, "$temp3", "mesh_pic_senators"),
    (store_troop_gold,"$temp4", "trp_player"),
  ],[
    ("choice_1",[(ge, "$temp4", 1000),],"Here take 1,000 denars. You can use half of the money to hire some thugs, the rest is for you.",[
      (troop_remove_gold, "trp_player", 1000),
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (call_script, "script_change_troop_renown", "trp_player", 2),
      (str_store_string, s44, "@Happy about your decision, the man tells the people of Rome how reliable you are as patron."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_2",[],"I am sorry, but there is nothing I can do for you.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -2),
      (str_store_string, s44, "@Disappointed about your decision, the men tells the people of Rome about your unreliability"),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_3",[
      (store_party_size_wo_prisoners, ":size", "p_main_party"),
      (ge, ":size", 10),
    ],"I will let my troops visit the trouble makers.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (call_script, "script_change_troop_renown", "trp_player", 4),
      (call_script, "script_change_player_honor", -1),
      (str_store_string, s44, "@Happy about your decision, the men tells the people of Rome how reliable you are as patron."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
]),
("event_senate_03",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Fake witness^^As you enter the Curia Julia, a young man approaches you. He introduces himself as a runner of one of the senators supporting you. He brings the following message from the senator:^^"
  +"'Dominus, I ask you to testify as a witness in a lawsuit. Although you have nothing to do with the case your statement could change the trial in my favor, as you are well known in Rome, .'^^"
  +" Accepting such a request would hit your reputation, as it would be a false statement. But rejecting the request, upset your supporters.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, "$temp3", "mesh_pic_senators"),
    (store_troop_gold,"$temp4", "trp_player"),
  ],[
    ("choice_1",[(ge, "$temp4", 15000),],"Here take 15,000 denars to bribe enough witnesses. Then I am sure you will win.",[
      (troop_remove_gold, "trp_player", 15000),
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (call_script, "script_change_troop_renown", "trp_player", 2),
      (str_store_string, s44, "@The senator has won the trial and is grateful for your support, thus praising your name under the roman population."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_2",[],"I am sorry, but there is nothing I can do for you.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", -2),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (call_script, "script_change_senate_support", -1, 0),
      (str_store_string, s44, "@The senator has lost the trial and as revenge smears your reputation in Rome."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_3",[
      (store_party_size_wo_prisoners, ":size", "p_main_party"),
      (ge, ":size", 10),
    ],"I will let my troops visit the prosecutor. This should help.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (call_script, "script_change_player_honor", -2),
      (str_store_string, s44, "@The prosecutor dropped the lawsuit. Happy about this outcome the senator praises your name. But your reputation suffered."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_4",[],"Very well. I will make a statement as witness.",[
      (call_script, "script_change_player_relation_with_center", "$current_town", 2),
      (call_script, "script_change_troop_renown", "trp_player", 6),
      (call_script, "script_change_player_honor", -5),
      (str_store_string, s44, "@The senator has won the trial and is grateful for your support."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
]),
("event_senate_04",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Loss of virginity^^You hear rumors that one of the Vestal virgins was caught 'in flagrante delicto'."
  +" She had sleeped with a young Roman senator! It is clear she must lose the priesthood, but some troublemakers now demand that she should be buried alive, since it is an old custom."
  +" But since republican times, the act of 'human sacrifices' has been banned. Now a discussion started in the senate, if the sacrifice should be allowed or not."
  +" Your supporters, mostly populists, are on the side of the mob and say that the sacrifice should be allowed.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, "$temp3", "mesh_pic_senators"),
  ],[
    ("choice_1",[],"I also think the sacrifice should be allowed. The people demand it.",[
      (str_store_string, s44, "@The discussion continues, but it soon becomes clear that the girl will not be buried."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_2",[],"Nonsense. If we disregard the law, chaos will rule.",[
      (call_script, "script_change_senate_support", -1, 0),
      (str_store_string, s44, "@Angered about your opinion, one of the senators supporting you changed sides! Meanwhile, the discussion continues, but it soon becomes clear that the girl will not be buried"),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_3",[],"Try to stay out of the discussion.",[
      (str_store_string, s44, "@You managed to stay out of the discussion, thus avoiding to be blamed for having a controversial opinion."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
]),
("event_senate_05",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Holy animals^^After you have entered the Curia Julia, you are informed about a matter, which is currently attracting the attention of the senate:^^"
  +" The augurs are currently quarrelling about the meaning of an omen. Basically, there are two groups."
  +" One claims, a omen was sided which demands to sacrifice a white ox in favor of Jupiter, while the other group says, a white heifer must be sacrificed in favor of Juno.^^"
  +" Also some senators atarted to take sides in the dispute. Most of your supporters are favoring the white ox. But you should consider that taking position in such a discussion could anger the priests.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, "$temp3", "mesh_pic_senators"),
  ],[
    ("choice_1",[],"It must be the white ox, since it is always a good idea to sacrifice to Jupiter.",[
      (store_random_in_range, reg59, 0, 10),
      (str_store_string, s44, "@The discussion continues, but it soon becomes clear that the heifer will be sacrificed."),
      (try_begin),
        (lt, reg59, 4),
        (call_script, "script_change_player_relation_with_center", "$current_town", -1),
        (call_script, "script_change_player_honor", -2),
        (str_store_string, s44, "@{s44}^^Some of the priests seems not very happy about you interfering into their matters and smear your reputation."),
      (try_end),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_2",[],"The last sacrifice to Juno is too long ago, so we should sacrifice the white heifer.",[
      (call_script, "script_change_senate_support", -1, 0),
      (str_store_string, s44, "@Angered about your lack of support, one of the senators supporting you changed sides!  But it soon becomes clear that the heifer will be sacrificed."),
      (store_random_in_range, reg59, 0, 10),
      (try_begin),
        (lt, reg59, 4),
        (call_script, "script_change_player_relation_with_center", "$current_town", -1),
        (call_script, "script_change_player_honor", -2),
        (str_store_string, s44, "@{s44}^^Some of the priests seems not very happy about you interfering into their matters and smear your reputation."),
      (try_end),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_3",[],"Try to stay out of the discussion.",[
      (str_store_string, s44, "@You managed to stay out of the discussion, thus avoiding to be blamed for having a controversial opinion. It soon becomes clear that the heifer will be sacrificed."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
]),
("event_senate_06",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Senators and love^^On your way to the Curia Julia, you notice a man, dressed like a senator, and a girl, with only light clothing and much make up, loving each other in the corner of a side-street.^^"
  +" The young girl is probably a whore. But if she is a married woman, blackmailing the senator would be an option to increase your support, since adultery is against Roman law.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, "$temp3", "mesh_pic_girls"),
    (store_troop_gold,"$temp4", "trp_player"),
  ],[
    ("choice_1",[],"Blackmail the senator.",[
      (str_store_string, s44, "@The girl and the senator seem quite annoyed about your interruption. You tell the senator, if he doesn't support you, you will expose his secret to the publicity. But the senator and the girl only start laughing.^^It seems the girl is a simple slut."),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_3",[],"Whatever...",[
      (jump_to_menu, "mnu_senatus"),
    ]),
]),
("event_senate_07",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Temple project^^While entering the Curia Julia, you notice a group of senators talking. You try to follow the conversation unobtrusively, and find out,"
  +" that they talk about the restoration of small temple near the forum romanum. You hear, that there are still something like 50,000 denars missing. ^^You could use this opportunity to improve your renown and relation with Rome.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, "$temp3", "mesh_pic_building_project"),
    (store_troop_gold,"$temp4", "trp_player"),
  ],[
    ("choice_1",[(ge, "$temp4", 75000),],"Support the building project with 75,000 denars!",[
      (call_script, "script_add_piety", 15, 1),
      (troop_remove_gold, "trp_player", 75000),
      (str_store_string, s44, "@The people hear about your generosity and praise your name."),
      (call_script, "script_change_player_relation_with_center", "$current_town", 5),
      (call_script, "script_change_player_honor", 8),
      (call_script, "script_change_troop_renown", "trp_player", 16),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_2",[(ge, "$temp4", 50000),],"Support the building project with 50,000 denars.",[
      (call_script, "script_add_piety", 10, 1),
      (troop_remove_gold, "trp_player", 50000),
      (str_store_string, s44, "@The people hear about your generosity and praise your name."),
      (call_script, "script_change_player_relation_with_center", "$current_town", 3),
      (call_script, "script_change_player_honor", 6),
      (call_script, "script_change_troop_renown", "trp_player", 12),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_3",[(ge, "$temp4", 25000),],"Support the building project with 25,000 denars.",[
      (call_script, "script_add_piety", 5, 1),
      (troop_remove_gold, "trp_player", 25000),
      (str_store_string, s44, "@The people hear about your generosity and praise your name."),
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_troop_renown", "trp_player", 6),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_4",[],"Do nothing.",[
      (jump_to_menu, "mnu_senatus"),
    ]),
]),
("event_senate_08",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Thugs^^On your way to the Curia Julia, you notice a man, dressed like a senator, who is attacked by two thugs.^^It would probably be a good idea to help him.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, "$temp3", "mesh_pic_bandits"),
    (store_troop_gold,"$temp4", "trp_player"),
  ],[
    ("choice_1",[],"Attack the thugs and help the senator.",[
      (str_store_string, s44, "@With ease you rout the thugs. The senator is very grateful for your help and praises your name. He also pledges to support you from now on in the senate."),
      (call_script, "script_change_player_relation_with_center", "$current_town", 3),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_senate_support", 1, 0),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_3",[],"Do nothing.",[
      (jump_to_menu, "mnu_senatus"),
    ]),
]),
("event_senate_09",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Guilty or not?^^After you have entered the Curia Julia, you are involved in a conversation about a legal process taking place currently.^The process is about a man who is accused to have murdered his father."
  +" At first glance, it seems that all facts, based on testimonies, stands against him. But his lawyer gave a speech in which he managed to present all facts in such a way that only one conclusion can be taken: he is innocent.^^"
  +" The senators are now discussing, whether he is innocent or not.",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (assign, "$temp3", "mesh_pic_senators"),
    (store_troop_gold,"$temp4", "trp_player"),
  ],[
    ("choice_1",[],"I am sure he is guilty, the facts are against him.",[
      (str_store_string, s44, "@Some of the senators agree with you, others not and the discussion continues."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_2",[],"I am sure he is not guilty. The facts seem to have been misinterpreted by the prosecution.",[
      (str_store_string, s44, "@Some of the senators agree with you, others not and the discussion continues."),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_3",[
      (store_attribute_level, ":int", "trp_player", ca_intelligence),
      (ge, ":int", 18),
    ],"This case shows the weakness of our legal system ...",[
      (str_store_string, s44, "@In detail you explain, what the problems are with facts based only on testimonies. Witnesses can not only unintentionally testify wrongly, for example because they simply cannot remember correctly, but they can also deliberately testify incorrectly by being bribed. Thus, in this case, the principle 'in dubio pro reo' hold!^^You seem to have impressed the senators with your knowledge."),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_senate_support", 1, 0),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("choice_4",[],"Stay out of the discussion.",[
      (jump_to_menu, "mnu_senatus"),
    ]),
]),

("event_senate_end",0, #final menu, load presentation to consequences
  "{s44}",
  "none",[
    (set_background_mesh, "$temp3"),
  ],[
    ("leave_jui",[],"Continue.",[
      (jump_to_menu, "mnu_senatus"),
    ]),
]),

##biggus dickus
  ("event_senate_digus_reveange",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A slave approaches with a message from an influential Roman noble. The message goes as follows:^ '{playername}, I never forgot what happened on Mamertinus party. I would like to invite you to a dinner party at my villa. ^^Sincerely Biggus Dickus'",
    "none",
    [(set_background_mesh, "mesh_pic_senators"),
    ],
    [
      ("choice_1",[],"Tell your master I will come.",
        [
        (setup_quest_text,"qst_amor_quest"),
        (str_store_party_name_link, s23, "p_town_34"),
        (str_store_string, s2, "@You are invited to a feast at 'Biggus Dickus' villa in {s23}."),
        (call_script, "script_start_quest", "qst_amor_quest", "trp_diggus"),
        (quest_set_slot, "qst_amor_quest", slot_quest_current_state, 1),
        (jump_to_menu, "mnu_senatus"),
        ]),
      ("choice_2",[],"Tell your master I refuse.",
        [
          (quest_set_slot, "qst_amor_quest", slot_quest_current_state, -1),
          (jump_to_menu, "mnu_senatus"),
        ]),
    ]),

  (
    "rename",0, #final menu, load presentation to consequences
    "In this menu you can rename the companion party.",
    "none",
    [

    ],
    [
      ("leave_rename",[],"Rename the party.",[
        (assign, "$g_presentation_state", rename_party),
        (start_presentation, "prsnt_name_kingdom"),
      ]),

      ("leave_jui",[],"Continue.",[
            (change_screen_map),
      ]),
    ]
  ),

  (
    "senate_discussion",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "{s49}^^{s48}",
    "none",
    [(set_background_mesh, "mesh_pic_senators"),
    (str_store_string, s49, "@The senators are discussing various different topics, non of real importance. You can propose your own discussion topic.\
 Depending on your support, you may have success."),
    (try_begin),
      (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_grain),
      (str_store_string, s49, "@The senators are discussing to import additional grain, in order to feed the population properly.\
 Since there is already enough grain in the town, it is clear, that the plan of senators is to offend the Praefectus annonae, the responsible offical elected by Caesar Augustus."),
     # (store_random_in_range, "$temp", 0, 2),#0,1
    (else_try),
      (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_nobles),
      (str_store_string, s49, "@The senators are discussing wether the rights of the nobility should be increased or decreased. In particular, giving people of noble origins more rights\
 would reduce the rights of commoners at the same time."),
      #(store_random_in_range, "$temp", -2, 2),#-1,0,1
    (else_try),
      (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_slaves),
      (str_store_string, s49, "@The senators are discussing wether the rights of the slaves should be increased or decreased. This means for example,\
 if the punishments that slaves could suffer should be more limited or not."),
     # (store_random_in_range, "$temp", -2, 2),#-1,0,1
    (try_end),
    (str_clear, s48),
    (troop_get_slot, "$temp", "trp_senator_dummy", slot_senate_topic_opinion),

    (try_begin),
      (neq, "$g_is_emperor", 1),
      (try_begin),
        (eq, "$temp", 0),
        (str_store_string, s48, "@It seems that the senators can't agree on a common approach"),
      (else_try),
        (eq, "$temp", 1),
        (try_begin),
          (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_nobles),
          (str_store_string, s48, "@It seems that the majority of the senators support a law change in favor of the nobility."),
        (else_try),
          (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_slaves),
          (str_store_string, s48, "@It seems that the majority of the senators support a law change in favor of the masters. The limits to punishments should be reduced."),
        (else_try),
          (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_grain),
          (str_store_string, s48, "@It seems that the majority of the senators support an order, to buy additional grain."),
        (try_end),
      (else_try),
        (eq, "$temp", -1),
        (try_begin),
          (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_nobles),
          (str_store_string, s48, "@It seems that the majority of the senators support a law change in favor of the commoners, the rights of the nobility should be reduced."),
        (else_try),
          (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_slaves),
          (str_store_string, s48, "@It seems that the senators support a law change in favor of the slaves. The limits to punishments should be increased."),
        (else_try),
          (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_grain),
          (str_store_string, s48, "@It seems that the majority of the senators don't support an order, to buy additional grain."),
        (try_end),
      (try_end),
    (try_end),
    ],
    [
      ("grain",[
      (neg|troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_grain),
      (neg|troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_nobles),
      (neg|troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_slaves),
      (neg|check_quest_active, "qst_talk_with_the_emperor"),
      (neg|check_quest_active, "qst_grain_supply"),
      (neq, "$g_is_emperor", 1),
      ],
      "Propose a topic",[
            (jump_to_menu, "mnu_propose_topic"),
      ]),
      ("grain",[
      (neq, "$g_is_emperor", 1),
      (eq, "$temp", 1),
      (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_grain),
      (neg|check_quest_active, "qst_grain_supply"),
      ],
      "Propose to organize the grain supply with your own funds",[
            (jump_to_menu, "mnu_organize_grain"),
      ]),

      ("laws",[
      (neq, "$g_is_emperor", 1),
      (this_or_next|eq, "$temp", -1),
      (eq, "$temp", 1),
      (this_or_next|troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_slaves),
      (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_nobles),
      (neg|check_quest_active, "qst_talk_with_the_emperor"),
      ],
      "Propose to talk with Caesar Augustus in favor of the senate",[
            (jump_to_menu, "mnu_talk_with_emperor"),
      ]),

      ("leave_jui",[],"Go back.",[
            (jump_to_menu, "mnu_senatus"),
      ]),
    ]
  ),

  (
    "organize_grain",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The senators seem quite interested in your offer, as it would be a good way to expose {s12} in the publicity. You would have to deliver the grain in 30 days. If you manage to bring the promised amount, you will for sure improve your renown and relation with Rome and in the senate.",
    "none",
    [
      (faction_get_slot, ":leader", "$g_encountered_party_faction", slot_faction_leader),
      (str_store_troop_name, s12, ":leader"),
    ],[

      ("leave_jui",[],"Promise to bring 25 ship full of grain.",[
      (assign, reg25, 25),
       (quest_set_slot, "qst_grain_supply", slot_quest_expiration_days, 30),
   (str_store_string, s2, "str_grain_quest"),
   (call_script, "script_start_quest", "qst_grain_supply", "trp_fortuna"),
   (troop_set_slot, "trp_senator_dummy", slot_senate_topic_opinion, -11),
   (quest_set_slot, "qst_grain_supply", slot_quest_target_amount, 25),

   (quest_set_slot, "qst_grain_supply", slot_quest_target_party, -1),
   (quest_set_slot, "qst_grain_supply", slot_quest_current_state, 0),

            (jump_to_menu, "mnu_senate_discussion"),
      ]),

      ("leave_jui",[],"Promise to bring 20 ship full of grain.",[
       (quest_set_slot, "qst_grain_supply", slot_quest_expiration_days, 30),
        (assign, reg25, 20),
   (str_store_string, s2, "str_grain_quest"),
   (call_script, "script_start_quest", "qst_grain_supply", "trp_fortuna"),
   (quest_set_slot, "qst_grain_supply", slot_quest_target_amount, 20),

   (quest_set_slot, "qst_grain_supply", slot_quest_target_party, -1),
   (quest_set_slot, "qst_grain_supply", slot_quest_current_state, 0),

            (jump_to_menu, "mnu_senate_discussion"),
      ]),

      ("leave_jui",[],"Promise to bring 15 ship full of grain.",[
       (quest_set_slot, "qst_grain_supply", slot_quest_expiration_days, 30),
        (assign, reg25, 15),
   (str_store_string, s2, "str_grain_quest"),
   (call_script, "script_start_quest", "qst_grain_supply", "trp_fortuna"),
   (quest_set_slot, "qst_grain_supply", slot_quest_target_amount, 15),

   (quest_set_slot, "qst_grain_supply", slot_quest_target_party, -1),
   (quest_set_slot, "qst_grain_supply", slot_quest_current_state, 0),

            (jump_to_menu, "mnu_senate_discussion"),
      ]),
      ("leave_jui",[],"Promise to bring at least 10 ship full of grain.",[
       (quest_set_slot, "qst_grain_supply", slot_quest_expiration_days, 30),
        (assign, reg25, 10),
   (str_store_string, s2, "str_grain_quest"),
   (call_script, "script_start_quest", "qst_grain_supply", "trp_fortuna"),
   (quest_set_slot, "qst_grain_supply", slot_quest_target_amount, 10),

   (quest_set_slot, "qst_grain_supply", slot_quest_target_party, -1),
   (quest_set_slot, "qst_grain_supply", slot_quest_current_state, 0),

            (jump_to_menu, "mnu_senate_discussion"),
      ]),
      ("leave_jui",[],"Promise to bring 5 ship full of grain.",[
       (quest_set_slot, "qst_grain_supply", slot_quest_expiration_days, 30),
        (assign, reg25, 5),
    (str_store_string, s2, "str_grain_quest"),
   (call_script, "script_start_quest", "qst_grain_supply", "trp_fortuna"),
   (quest_set_slot, "qst_grain_supply", slot_quest_target_amount, 5),

   (quest_set_slot, "qst_grain_supply", slot_quest_target_party, -1),
   (quest_set_slot, "qst_grain_supply", slot_quest_current_state, 0),

            (jump_to_menu, "mnu_senate_discussion"),
      ]),
      ("leave_jui",[],"Promise to bring at least 1 ship full of grain.",[
       (quest_set_slot, "qst_grain_supply", slot_quest_expiration_days, 30),
        (assign, reg25, 1),
   (str_store_string, s2, "str_grain_quest"),
   (call_script, "script_start_quest", "qst_grain_supply", "trp_fortuna"),
   (quest_set_slot, "qst_grain_supply", slot_quest_target_amount, 1),

   (quest_set_slot, "qst_grain_supply", slot_quest_target_party, -1),
   (quest_set_slot, "qst_grain_supply", slot_quest_current_state, 0),

            (jump_to_menu, "mnu_senate_discussion"),
      ]),

      ("leave_jui",[],"Go back.",[
            (jump_to_menu, "mnu_senate_discussion"),
      ]),
    ]
  ),

  (
    "finish_grain",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The senators are satisfied and the grain is distributed to the people on the Mars field.\
 But the Princeps seems not very amused to hear about your actions.",
    "none",
    [
    (set_background_mesh, "mesh_pic_grain"),
    (quest_get_slot, reg44, "qst_grain_supply", slot_quest_target_amount),

    (call_script, "script_change_troop_renown", "trp_player", reg44),
    (assign, ":honor", reg44),
    (set_fixed_point_multiplier, 1),
    (convert_to_fixed_point, ":honor"),
    (store_sqrt, ":honor", ":honor"),
    (convert_from_fixed_point, ":honor"),
    (call_script, "script_change_player_honor", ":honor"),
    (call_script, "script_change_center_prosperity", "p_town_6", ":honor"),
    (call_script, "script_change_senate_support", 1, 0),
    (try_begin),
      (eq, reg44, 1),
      (call_script, "script_change_player_relation_with_center","$current_town", 2),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lord", -3),
    (else_try),
      (eq, reg44, 5),
      (call_script, "script_change_player_relation_with_center","$current_town", 4),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lord", -6),
    (else_try),
      (eq, reg44, 10),
      (call_script, "script_change_player_relation_with_center","$current_town", 6),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lord", -8),
    (else_try),
      (eq, reg44, 15),
      (call_script, "script_change_player_relation_with_center","$current_town", 7),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lord", -10),
    (else_try),
      (eq, reg44, 20),
      (call_script, "script_change_player_relation_with_center","$current_town", 8),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lord", -12),
    (else_try),
      (call_script, "script_change_player_relation_with_center", "$current_town", 10),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lord", -15),
    (try_end),
    (quest_get_slot, ":target", "qst_grain_supply", slot_quest_target_party),
    (party_set_ai_behavior, ":target", ai_bhvr_travel_to_party),
    (party_set_ai_object, ":target", "p_town_6"),
    (party_set_flags, ":target", pf_default_behavior, 0),

    (add_xp_as_reward, 2000),
    (call_script, "script_succeed_quest", "qst_grain_supply"),
    (call_script, "script_end_quest", "qst_grain_supply"),
    ],[

      ("leave_jui",[],"Very good!",[

            (jump_to_menu, "mnu_senatus"),
      ]),

    ]
  ),

(
  "talk_with_emperor",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The senators are very happy about your proposal. You could try to convenience Caesar Augustus to change the law in favor of the senate. You would have 30 days to finish this quest.",
  "none",[
  ],[
    ("leave_jui",[],"I will talk with the Princeps.",[
      (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_expiration_days, 30),
      (faction_get_slot, ":leader", "$g_encountered_party_faction", slot_faction_leader),
      (str_store_troop_name_link, s12, ":leader"),
      (try_begin),
        (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_nobles),
        (try_begin),
          (eq, "$temp", 1),
          (str_store_string, s2, "@Talk with {s12} about a law change in favor of the nobility."),
        (else_try),
          (eq, "$temp", -1),
          (str_store_string, s2, "@Talk with {s12} about a law change in favor of the commoners, the rights of the nobility should be reduced."),
        (try_end),
      (else_try),
        (troop_slot_eq, "trp_senator_dummy", slot_senate_topic, topic_slaves),
        (try_begin),
          (eq, "$temp", 1),
          (str_store_string, s2, "@Talk with {s12} about a law change in favor of the masters. The limits to punishments should be reduced."),
        (else_try),
          (eq, "$temp", -1),
          (str_store_string, s2, "@Talk with {s12} about a law change in favor of the slaves. The limits to punishments should be increased."),
        (try_end),
      (try_end),
      (call_script, "script_start_quest", "qst_talk_with_the_emperor", "trp_fortuna"),
      (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_current_state, 0),
      (troop_get_slot, ":topic", "trp_senator_dummy", slot_senate_topic),
      (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_object_state, ":topic"),
      (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_target_state, "$temp"),
      (store_random_in_range, ":r", 6, 12),
      (troop_set_slot, "trp_senator_dummy",slot_senate_next_meeting, ":r"),
      (display_message, "str_senate_meeting_over"),
      (jump_to_menu, "mnu_senate_discussion"),
    ]),
    ("leave_jui",[],"Go back.",[

      (jump_to_menu, "mnu_senate_discussion"),
    ]),
]),

("propose_topic",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Which topic do you wish to discuss?^^If your proposal is accepted, the senate meeting will be concluded.",
  "none",
  [

  ],[
      ("grain",[
      (neg|check_quest_active, "qst_grain_supply"),
      ],
      "Propose to bring additional grain supplies",[
           (troop_set_slot, "trp_senator_dummy", slot_senate_topic, topic_grain),
           (troop_set_slot, "trp_senator_dummy", slot_senate_topic_opinion, 1),
            (jump_to_menu, "mnu_organize_grain"),
      ]),

      ("leave_jui",[(eq, "$edict8",1)],"Propose to revoke the lex militaris.",[

      (store_random_in_range, reg26, -3, 2),

      (call_script, "script_change_senate_support", reg26, 0),
      (try_begin),
        (eq, reg26, -2),
        (str_store_string, s41, "@two senators changed to the opposite side."),
      (else_try),
        (eq, reg26, -1),
        (str_store_string, s41, "@one senator changed to the opposite side."),
      (else_try),
        (eq, reg26, 0),
        (str_store_string, s41, "@no senator changed side."),
      (else_try),
        (eq, reg26, 1),
        (str_store_string, s41, "@one senator changed to your side."),
      # (else_try),
        # (eq, reg26, 2),
        # (str_store_string, s41, "@two senators changed to your side."),
      (try_end),
      (display_message, s41),
      (troop_get_slot, reg55, "trp_senator_dummy", slot_senate_support),
      (try_begin),
        (gt, reg55, 50),
        (str_store_string, s44, "@During the discussion, {s41}.^^The senate accepted your proposal. Now you must convince the Princeps to issue the change of law."),
        (faction_get_slot, ":leader", "$g_encountered_party_faction", slot_faction_leader),
        (str_store_troop_name_link, s12, ":leader"),
        (str_store_string, s2, "str_convince_emperor"),
        (display_message, s44,color_good_news),
        (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_expiration_days, 30),
        (call_script, "script_start_quest", "qst_talk_with_the_emperor", "trp_fortuna"),
        (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_current_state, 0),
        (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_object_state, topic_lex_militaris),
        (store_random_in_range, ":r", 6, 12),
        (troop_set_slot, "trp_senator_dummy",slot_senate_next_meeting, ":r"),
        (display_message, "str_senate_meeting_over"),
        (assign, "$temp3", "mesh_pic_senators"),
        (jump_to_menu, "mnu_event_senate_end"),
      (else_try),
        (display_message, "@The senate refused your proposal.",color_bad_news),
        (jump_to_menu, "mnu_senate_discussion"),
      (try_end),
      (play_sound, "snd_senatus_sound_1"),

      ]),
      ("leave_jui",[(eq, "$edict2",1)],"Propose to revoke the lex Julia et Papia.",[
      (store_random_in_range, reg26, -3, 2),

      (call_script, "script_change_senate_support", reg26, 0),
      (try_begin),
        (eq, reg26, -2),
        (str_store_string, s41, "@two senators changed to the opposite side."),
      (else_try),
        (eq, reg26, -1),
        (str_store_string, s41, "@one senator changed to the opposite side."),
      (else_try),
        (eq, reg26, 0),
        (str_store_string, s41, "@no senator changed side."),
      (else_try),
        (eq, reg26, 1),
        (str_store_string, s41, "@one senator changed to your side."),
      # (else_try),
        # (eq, reg26, 2),
        # (str_store_string, s41, "@two senators changed to your side."),
      (try_end),
      (display_message, s41),
      (troop_get_slot, reg55, "trp_senator_dummy", slot_senate_support),
      (try_begin),
        (gt, reg55, 50),
        (str_store_string, s44, "@During the discussion, {s41}.^^The senate accepted your proposal. Now you must convince the Princeps to issue the change of law."),
        (faction_get_slot, ":leader", "$g_encountered_party_faction", slot_faction_leader),
        (str_store_troop_name_link, s12, ":leader"),
        (str_store_string, s2, "str_convince_emperor"),
        (display_message, s44,color_good_news),
        (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_expiration_days, 30),
        (call_script, "script_start_quest", "qst_talk_with_the_emperor", "trp_fortuna"),
        (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_current_state, 0),
        (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_object_state, topic_lex_julia),
        (store_random_in_range, ":r", 6, 12),
        (troop_set_slot, "trp_senator_dummy",slot_senate_next_meeting, ":r"),
        (display_message, "str_senate_meeting_over"),
        (assign, "$temp3", "mesh_pic_senators"),
        (jump_to_menu, "mnu_event_senate_end"),
      (else_try),
        (display_message, "@The senate refused your proposal.",color_bad_news),
        (jump_to_menu, "mnu_senate_discussion"),
      (try_end),
      (play_sound, "snd_senatus_sound_1"),
    ]),
    ("leave_jui",[(eq, "$edict7",1)],"Propose to revoke the lex frumentaria et agraria.",[
      (store_random_in_range, reg26, -3, 2),

      (call_script, "script_change_senate_support", reg26, 0),
      (try_begin),
        (eq, reg26, -2),
        (str_store_string, s41, "@two senators changed to the opposite side."),
      (else_try),
        (eq, reg26, -1),
        (str_store_string, s41, "@one senator changed to the opposite side."),
      (else_try),
        (eq, reg26, 0),
        (str_store_string, s41, "@no senator changed side."),
      (else_try),
        (eq, reg26, 1),
        (str_store_string, s41, "@one senator changed to your side."),
      # (else_try),
        # (eq, reg26, 2),
        # (str_store_string, s41, "@two senators changed to your side."),
      (try_end),
      (display_message, s41),
      (troop_get_slot, reg55, "trp_senator_dummy", slot_senate_support),
      (try_begin),
        (gt, reg55, 50),
        (str_store_string, s44, "@During the discussion, {s41}.^^The senate accepted your proposal. Now you must convince the Princeps to issue the change of law."),
        (faction_get_slot, ":leader", "$g_encountered_party_faction", slot_faction_leader),
        (str_store_troop_name_link, s12, ":leader"),
        (str_store_string, s2, "str_convince_emperor"),
        (display_message,s44,color_good_news),
        (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_expiration_days, 30),
        (call_script, "script_start_quest", "qst_talk_with_the_emperor", "trp_fortuna"),
        (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_current_state, 0),
        (quest_set_slot, "qst_talk_with_the_emperor", slot_quest_object_state, topic_lex_agra),
        (store_random_in_range, ":r", 6, 12),
        (troop_set_slot, "trp_senator_dummy",slot_senate_next_meeting, ":r"),
        (display_message, "str_senate_meeting_over"),
        (assign, "$temp3", "mesh_pic_senators"),
        (jump_to_menu, "mnu_event_senate_end"),
      (else_try),
        (display_message, "@The senate refused your proposal.",color_bad_news),
        (jump_to_menu, "mnu_senate_discussion"),
      (try_end),
      (play_sound, "snd_senatus_sound_1"),
    ]),
    ("leave_jui",[],"Go back.",[
      (jump_to_menu, "mnu_senate_discussion"),
    ]),
]),

  (
    "statue_finished",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Statues^^Indeed, the statues are finished and the magister civium together with the praefectus are very proud to present them to you.\
 You take a look at them:^{s33}",
    "none",
    [
    (try_begin),
     (party_slot_eq, "$current_town", slot_center_statues_days, 3),
     (str_store_string, s33, "@The statues don't look very impressive. In fact, they are pretty ugly. Your nose is too long, your belly too big. You find many things, which you don't like."),
    (else_try),
     (party_slot_eq, "$current_town", slot_center_statues_days, 6),
     (str_store_string, s33, "@The statues look quite impressive. You find only minor mistakes here and there. But in total, they are well made."),
    (else_try),
     (party_slot_eq, "$current_town", slot_center_statues_days, 9),
     (str_store_string, s33, "@The statues look very impressive. You were portrayed as a god triumphing over his enemies. Truly a worthy representation of a Caesar."),
    (else_try),
     (str_store_string, s33, "@Error: Report this bug."),
    (try_end),
    (set_background_mesh, "mesh_pic_statue"),
    (str_store_party_name, s20, "$current_town"),
    ],[

     ("leave_jui",[],"Those statues are ugly as hell! Destroy them and crucify the artists!",[
      (party_set_slot, "$current_town", slot_center_statues, 0),
      (call_script, "script_change_player_honor", -3),
              (call_script, "script_change_player_relation_with_center", "$current_town", -6),
          (str_clear,s1),

          (str_store_string,s1,"@The magister civium and the praefectus, fearing also to get punished, blame the artists for this failure. Shocked by your order, the people of {s20} see you as a selfish tyrant."),

          (jump_to_menu, "mnu_random_juice_events"),
      ]),
      ("leave_jui",[],"Those statues are ugly as hell! Destroy them!",[
      (party_set_slot, "$current_town", slot_center_statues, 0),
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_change_player_relation_with_center", "$current_town", -3),
          (str_clear,s1),
          (str_store_string,s1,"@The magister civium and the praefectus, fearing to get punished, blame the artists for this failure. The people of {s20} laugh about you for being so selfish and superficial."),

          (jump_to_menu, "mnu_random_juice_events"),
      ]),

      ("leave_jui",[],"Very good. Exactly as I wanted.",[
      (party_set_slot, "$current_town", slot_center_statues, -1),
      (call_script, "script_change_player_relation_with_center", "$current_town", -1),
      (call_script, "script_change_player_honor", -1),
          (str_clear,s1),
          (str_store_string,s1,"@The magister civium and the praefectus seem very happy and praise your name. On the other side,\
 the people of {s20} don't seem to be very pleased to see your face in every corner of the streets now."),
      (try_begin),
        (party_slot_eq, "$current_town", slot_center_statues_days, 3),
        (call_script, "script_change_troop_renown", "trp_player", 15),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_statues_days, 6),
        (call_script, "script_change_troop_renown", "trp_player", 30),
      (else_try),
        (party_slot_eq, "$current_town", slot_center_statues_days, 9),
        (call_script, "script_change_troop_renown", "trp_player", 60),
      (try_end),
          (jump_to_menu, "mnu_random_juice_events"),
      ]),

    ]
  ),

("rename_month",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You propose an edict, edictum mensum, to rename a month after you. You need a simple majority for this edict to be justified. {reg33}% of the senators voted for your proposal.^^"
  +" Additionally, it will cost you 250,000 denars to rename everything. The money will be taken from your treasury. (You have currently {reg34} denars)^^"
  +" But careful, you can't change the name later on.",
  "none",[
    (troop_get_slot, reg33, "trp_senator_dummy", slot_senate_support),
    (store_troop_gold, reg34, "trp_household_possessions"),
    (store_troop_gold, ":g", "trp_player"),
    (val_add, reg34, ":g"),
    (try_begin),
      (ge, "$edict10", 1),
      (jump_to_menu, "mnu_senatus"),
    (try_end),
  ],
   [
      ("month_"+str(month),[
        (ge, reg33, 51),
        (ge, reg34, 250000),
        (store_add, ":string", "str_january", month),
        (str_store_string, s5, ":string"),
      ],"Rename {s5}.",[
        (store_add, "$edict10", month, 1),
        (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", 250000,"trp_player"),
        (call_script, "script_change_troop_renown", "trp_player", 50),
        (assign, "$g_presentation_state", rename_month),
        (assign, "$g_player_troop", "trp_bard_end"),
        (start_presentation, "prsnt_name_kingdom"),
      ])
      for month in range(0, 12)
  ] + [

    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"Ianuarius",[
    #   (assign, "$edict10", 1),
    #   (display_log_message, "@You decided to rename the Ianuarius."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"Februarius",[
    #   (assign, "$edict10", 2),
    #   (display_log_message, "@You decided to rename the Februarius."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"Martius",[
    #   (assign, "$edict10", 3),
    #   (display_log_message, "@You decided to rename the Martius."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"Aprilis",[
    #   (assign, "$edict10", 4),
    #   (display_log_message, "@You decided to rename the Aprilis."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"Maius",[
    #   (assign, "$edict10", 5),
    #   (display_log_message, "@You decided to rename the Maius."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"Iunius",[
    #   (assign, "$edict10", 6),
    #   (display_log_message, "@You decided to rename the Iunius."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"Iulius",[
    #   (assign, "$edict10", 7),
    #   (display_log_message, "@You decided to rename the Iulius."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"Augustus",[
    #   (assign, "$edict10", 8),
    #   (display_log_message, "@You decided to rename the Augustus."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"September",[
    #   (assign, "$edict10", 9),
    #   (display_log_message, "@You decided to rename the September."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"October",[
    #   (assign, "$edict10", 10),
    #   (display_log_message, "@You decided to rename the October."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    # ],"November",[
    #   (assign, "$edict10", 11),
    #   (display_log_message, "@You decided to rename the November."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    # ("month",[
    #   (ge, reg33, 51),
    #   (ge, reg34, 250000),
    #  ],"December",[
    #   (assign, "$edict10", 12),
    #   (display_log_message, "@You decided to rename the December."),
    #   (call_script, "script_dplmc_withdraw_from_treasury", 250000),
    #   (call_script, "script_change_troop_renown", "trp_player", 50),
    #   (assign, "$g_presentation_state", rename_month),
    #   (assign, "$g_player_troop", "trp_bard_end"),
    #   (start_presentation, "prsnt_name_kingdom"),
    # ]),
    ("leave",[],"Forget it.",[
      (jump_to_menu, "mnu_senatus"),
    ]),
]),

("golgotha",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You climb on the hill called Golgotha where decades ago Christus was crucified. It is very hot and as you reach the top you have an impressive view over the town of Hierosolyma."
  +" You let your gaze wander over the city. After a while you start to pray ... but you are interrupted buy a voice. As you look around the only thing you see is a burning bush."
  +" In front of the bush, a lance stucks in the ground. A voice says: 'Take this lance and victory will always be on your side!'",
  "none",[
    (set_background_mesh, "mesh_pic_bush"),
  ],[
    ("leave",[],"Take the lance. Glory to God!",[
      (troop_add_item, "trp_player", "itm_holy_lance"),
      (troop_set_slot, "trp_global_variables", g_player_visit_golgotha, 1),
      (jump_to_menu, "mnu_town"),
    ]),
]),

("petition",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You start checking the petitions ...",
  "none",[
    (set_background_mesh, "mesh_pic_senatus"),
    (try_begin),
        (store_random_in_range, ":center", towns_begin, towns_end),
        (faction_get_slot, ":chance", "$players_kingdom", slot_faction_tax_rate),
        (val_mul, ":chance", ":chance"),

        (try_begin),
            (eq, "$control_tax", 1),  #tax control active
            (val_mul, ":chance", 2),
            (val_div, ":chance", 3),
        (try_end),
        (val_add, ":chance", "$g_unrest"),
        (store_random_in_range, ":rand", 0, 10100),
        (val_sub, ":rand", "$g_unrest"),
        (lt, ":rand", ":chance"),

        (store_faction_of_party, ":fac", ":center"),
        (eq, ":fac", "$players_kingdom"),
        (party_get_slot, ":lord", ":center", slot_town_lord),
        (gt, ":lord", 0),
        (neg|troop_slot_eq, ":lord", slot_troop_recently_blamed, 1),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_quarrelsome),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_cunning),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_selfrighteous),
        (this_or_next|troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_roguish),
        (troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
        (str_store_party_name, s40, ":center"),
        (str_store_troop_name, s44, ":lord"),
        (setup_quest_text,"qst_blank_quest_21"),
        (quest_set_slot, "qst_blank_quest_21", slot_quest_target_center, ":center"),
        (quest_set_slot, "qst_blank_quest_21", slot_quest_target_troop, ":lord"),
        (quest_set_slot, "qst_blank_quest_21", slot_quest_target_dna, 0),
        (quest_set_slot, "qst_blank_quest_21", slot_quest_expiration_days, 40),
        (str_store_string, s2, "@Rumors say {s44} has evaded taxes of {s40}."),
        (call_script, "script_start_quest", "qst_blank_quest_21", "trp_player"),
        (display_message, "@Rumors say {s44} has evaded taxes of {s40}."),
        (troop_set_slot, ":lord", slot_troop_recently_blamed, 1),
        (jump_to_menu, "mnu_event_corruption"),
    (else_try),
        (store_random_in_range, ":center", castles_begin, castles_end),
        (store_faction_of_party, ":fac", ":center"),
        (eq, ":fac", "$players_kingdom"),
        (party_get_slot, ":lord", ":center", slot_town_lord),
        (gt, ":lord", 0),
        (neg|troop_slot_eq, ":lord", slot_troop_recently_blamed, 1),
        (store_skill_level, ":trade","skl_trade", ":lord"),
        (le, ":trade", 6),
        (assign, "$g_notification_menu_var1", ":center"),
        (assign, "$g_notification_menu_var2", ":lord"),
        (jump_to_menu, "mnu_miss_managment"),
        (troop_set_slot, ":lord", slot_troop_recently_blamed, 1),
    (else_try),
        (jump_to_menu, "mnu_event_temple"),
    (try_end),
  ],[
    ("leave",[],"Continue",[
		  (change_screen_map),
    ]),
]),

("christian",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Since the first time you heard about Christus and Christians, you were not sure what to think about it. However, you started feeling quite comfortable with the beliefs the Christians have."
  +"Maybe it is time to worship their God? Maybe this God is the really true God!",
  "none",[
    (set_background_mesh, "mesh_pic_bush"),
  ],[
  ("leave",[],"I believe! I believe in the resurrection of Christ!",[
    (display_log_message, "@You worship the Christian god now!"),
    (troop_set_slot, "trp_player", slot_troop_religion, worships_christus),
		(change_screen_map),
  ]),
  ("leave",[],"Forget it.",[
		(jump_to_menu, "mnu_camp_action"),
  ]),
]),

("senate_decide",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You bring the petition to remove {s22} before the senate. You supporters immediately demand, that you should be nominated as new governor."
  +" You need a two-thirds majority to pass this important decision. You are currently supported by {reg20}% of the senators.",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
    (troop_get_slot, reg20, "trp_senator_dummy", slot_senate_support),
  ],[
    ("leave",[],"Start the vote.",[
      (assign, "$temp3", "mesh_pic_senators"),
      (store_random_in_range, reg26, -3, 2),

      (quest_get_slot, ":governor", "qst_usurp_province", slot_quest_target_troop),
      (quest_get_slot, ":town", "qst_usurp_province", slot_quest_target_center),
      (str_store_party_name, s57, ":town"),
      (call_script, "script_change_senate_support", reg26, 0),
      (try_begin),
        (eq, reg26, -2),
        (str_store_string, s41, "@two senators changed to the opposite side."),
      (else_try),
        (eq, reg26, -1),
        (str_store_string, s41, "@one senator changed to the opposite side."),
      (else_try),
        (eq, reg26, 0),
        (str_store_string, s41, "@no senator changed side."),
      (else_try),
        (eq, reg26, 1),
        (str_store_string, s41, "@one senator changed to your side."),
      # (else_try),
        # (eq, reg26, 2),
        # (str_store_string, s41, "@two senators changed to your side."),
      (try_end),
      (troop_get_slot, reg27, "trp_senator_dummy", slot_senate_support),
      (try_begin),
        (ge, reg27, 67),
        (str_store_string, s49, "@You won the vote! {reg27}% of the senators voted for your proposal. Now you are the new governor of {s57}."),

        (call_script, "script_change_player_honor", -10),
        (display_message, "@Intrigues and plots are a dishonorable business."),

        (call_script, "script_change_troop_controversy", "trp_player", 80),
        (party_get_slot, ":province", ":town", slot_center_province),
        (try_for_range, ":fiefs", walled_centers_begin, walled_centers_end),
            (store_faction_of_party, ":fac", ":fiefs"),
            (eq, ":fac", "$players_kingdom"),
            (party_slot_eq, ":fiefs", slot_center_province, ":province"),
            (call_script, "script_give_center_to_lord2", ":fiefs", "trp_player", 0),
        (try_end),
        #set all slots properly
        (call_script, "script_troop_set_rank", ":governor",slot_troop_govern, -1),
        (call_script, "script_troop_set_rank", "trp_player",slot_troop_govern, ":province"),
        (assign, "$g_dont_give_fief_to_player_days", 30),
        (troop_set_slot, "trp_province_array", ":province", "trp_player"),
        #update his party
        (call_script, "script_change_lord_party_to_fit_rank", ":governor"),
        #update timer
        (store_current_day, ":day"),
        (val_add, ":day", 84),
        (store_add, ":slot", slot_province_senatorial_begin, ":province"),
        (troop_set_slot, "trp_province_array", ":slot", ":day"),
        (call_script, "script_change_relation_with_family_friends_enemies", ":governor", -1, 11, "trp_player"),
        (call_script, "script_end_quest", "qst_usurp_province"),
        (call_script, "script_change_player_relation_with_center", ":town", 10),
        (call_script, "script_change_troop_renown", "trp_player", 5),
      (else_try),
        (str_store_string, s49, "@You lost the vote! {reg27}% of the senators voted for your proposal. The people of {s57} don't seem happy about the outcome."),
        (call_script, "script_cancel_quest", "qst_usurp_province"),
        (call_script, "script_change_player_relation_with_center", ":town", -5),
      (try_end),
      (str_store_string, s44, "@During the discussion, {s41}.^{s49}"),
      (jump_to_menu, "mnu_event_senate_end"),
    ]),
    ("leave",[],"Forget it.",[
      (jump_to_menu, "mnu_senatus"),
    ]),
]),

("senate_decide_bacchus",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You bring the petition to revoke the law 'Senatus consultum de Bacchanalibus' before the senate."
  +" You need a simple majority to revoke the law. You are currently supported by {reg20}% of the senators.",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
    (troop_get_slot, reg20, "trp_senator_dummy", slot_senate_support),
  ],[
    ("leave",[],"Start the vote.",[
      (assign, "$temp3", "mesh_pic_senators"),
      (store_random_in_range, reg26, -3, 2),

      (call_script, "script_change_senate_support", reg26, 0),
      (try_begin),
        (eq, reg26, -2),
        (str_store_string, s41, "@two senators changed to the opposite side."),
      (else_try),
        (eq, reg26, -1),
        (str_store_string, s41, "@one senator changed to the opposite side."),
      (else_try),
        (eq, reg26, 0),
        (str_store_string, s41, "@no senator changed side."),
      (else_try),
        (eq, reg26, 1),
        (str_store_string, s41, "@one senator changed to your side."),
      (try_end),
      (troop_get_slot, reg27, "trp_senator_dummy", slot_senate_support),

      (try_begin),
        (ge, reg27, 51),
        (str_store_string, s49, "@You won the vote! The law 'Senatus consultum de Bacchanalibus' has been revoked."),
      (else_try),
        (str_store_string, s49, "@You lost the vote! {reg27}% of the senators voted for you."),
      (try_end),
      (str_store_string, s44, "@During the discussion, {s41}.^{s49}"),
      (jump_to_menu, "mnu_senate_decide_bacchus2"),
    ]),
    ("leave",[],"Forget it.",[
      (jump_to_menu, "mnu_senatus"),
    ]),
]),

("senate_decide_bacchus2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s44}",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
  ],[
    ("leave",[],"Continue.",[
      (try_begin),
        (ge, reg27, 51),
        (jump_to_menu, "mnu_senate_decide_bacchus3"),
      (else_try),
        (jump_to_menu, "mnu_senatus"),
      (try_end),
    ]),
]),

("senate_decide_bacchus3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The law is revoked and you leave the Curia Julia. It is time to claim your reward!^^You make your way towards the Eastern gate of Rome, but on the way you are stopped by a horde of drunken party-goers. All around you, dancers and musicians appear. Slaves run around and distribute delicious and expensive foods and wine to the people of Rome. This must be the surprise, he mentioned before: drunkards and party-goers from all over the Empire seem to storm Rome. In all the sudden chaos, you see him riding on a golden chariot through the streets, surrounded by thousands of naked dancers. You follow the procession. After a while, you manage to reach him at the Forum Romanum.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
  ("leave",[],"Continue.",[
    (call_script, "script_setup_troop_meeting", "trp_bacchus", -1, "scn_rome_center"),
  ]),
]),

("horse_race",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You can place a bet on yourself. The money you will receive depends on your rank in the race.^You have set a bet of {reg20} denars on yourself.",
  "none",[
    (set_background_mesh, "mesh_pic_race"),
    (assign, reg20, "$g_tournament_bet_placed"),
    (party_set_slot, "$current_town", slot_town_has_tournament, 0), #No way to return back if this menu is left
   ],[
    ("leave",[],"Start the race.",[
      (try_begin),
        (gt, "$g_tournament_bet_placed", 0),
        (troop_remove_gold, "trp_player", "$g_tournament_bet_placed"),
      (try_end),

      (assign, "$temp4_1", 1),
      (assign, "$temp4", 1),

      (modify_visitors_at_site, "scn_horse_race_arena"),
      (reset_visitors),
      (set_jump_mission, "mt_horse_racing"),

      # (try_for_range, ":entry", 8, 15),
          # # (mission_tpl_entry_set_override_flags, "mt_horse_racing", ":entry", af_override_horse),
          # (mission_tpl_entry_clear_override_items, "mt_horse_racing", ":entry"),
          # (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_roman_poor1"),
          # (mission_tpl_entry_add_override_item, "mt_horse_racing",":entry", "itm_caligea"),
      # (try_end),
      # # (mission_tpl_entry_set_override_flags, "mt_horse_racing", 0, af_override_horse),#player
      # (mission_tpl_entry_clear_override_items, "mt_horse_racing", 0),
      # (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_roman_poor1"),
      # (mission_tpl_entry_add_override_item, "mt_horse_racing",0, "itm_caligea"),

      (set_jump_entry, 0),

      # (call_script, "script_sort_tournament_participant_troops"),
      # (call_script, "script_get_num_tournament_participants"),
      # (assign, ":num_participants", reg0),
      # (assign, ":slot", 1),
      # (assign, ":entry", 8),
      # (try_for_range, ":cur_slot", 0, ":num_participants"),
        # (troop_get_slot, ":troop_no", "trp_tournament_participants", ":cur_slot"),
        # (troop_set_slot, "trp_temp_array_b", ":entry", ":troop_no"),
        # (set_visitor, ":entry", ":troop_no"),
        # (val_add, ":slot", 1),
        # (val_add, ":entry", 1),
        # (eq, ":slot", 8),
        # (assign, ":num_participants", -1),
      # (try_end),

      (troop_set_slot, "trp_temp_array_olympia_b", 0, "trp_player"),
      (troop_set_slot, "trp_temp_array_olympia_b", 1, "trp_Xerina"),
      (troop_set_slot, "trp_temp_array_olympia_b", 2, "trp_Dranton"),
      (troop_set_slot, "trp_temp_array_olympia_b", 3, "trp_Kradus"),
      (troop_set_slot, "trp_temp_array_olympia_b", 4, "trp_Flamma"),
      (troop_set_slot, "trp_temp_array_olympia_b", 5, "trp_Marcus_Attilius"),
      (troop_set_slot, "trp_temp_array_olympia_b", 6, "trp_Scorpius"),
      (troop_set_slot, "trp_temp_array_olympia_b", 7, "trp_champion_fighter"),
      (troop_set_slot, "trp_temp_array_olympia_b", 8, "trp_Diocles"),

      (set_visitor, 8, "trp_Xerina"),
      (set_visitor, 9, "trp_Dranton"),
      (set_visitor, 10, "trp_Kradus"),
      (set_visitor, 11, "trp_Flamma"),
      (set_visitor, 12, "trp_Marcus_Attilius"),
      (set_visitor, 13, "trp_Scorpius"),
      (set_visitor, 14, "trp_Diocles"),
      #(set_visitor, 15, "trp_mercenary_horseman"),
      ##spawn visitors
      (set_visitors, 1, "trp_guest", 10),
      (set_visitors, 2, "trp_guest_female", 10),
      (set_visitors, 3, "trp_guest", 10),
      (set_visitors, 4, "trp_guest_female", 10),
      (set_visitors, 5, "trp_guest", 10),
      (set_visitors, 6, "trp_guest_female", 10),
      (set_visitors, 7, "trp_guest", 10),
      (set_visitors, 16, "trp_guest_female", 10),
      (set_visitors, 17, "trp_guest", 10),
      (try_for_range, ":entry", 28, 48),
        (store_random_in_range, ":r", 0, 2),
        (try_begin),
          (eq, ":r", 0),
          (set_visitors, ":entry", "trp_guest", 10),
        (else_try),
          (set_visitors, ":entry", "trp_guest_female", 10),
        (try_end),
      (try_end),
      (try_for_range, ":entry", 58, 76),
        (store_random_in_range, ":r", 0, 2),
        (try_begin),
          (eq, ":r", 0),
          (set_visitors, ":entry", "trp_guest", 10),
        (else_try),
          (set_visitors, ":entry", "trp_guest_female", 10),
        (try_end),
      (try_end),
      #####visitors
      (jump_to_scene, "scn_horse_race_arena"),
      (change_screen_mission),
    ]),
    ("leave",[(eq, "$g_tournament_bet_placed", 0),
      (store_troop_gold,":g", "trp_player"),
      (ge, ":g", 100),
    ],"Bet 100 denars.",[
      (assign, "$g_tournament_bet_placed", 100),
      (jump_to_menu, "mnu_horse_race"),
    ]),
    ("leave",[
      (eq, "$g_tournament_bet_placed", 0),
      (store_troop_gold,":g", "trp_player"),
      (ge, ":g", 250),
    ],"Bet 250 denars.",[
      (assign, "$g_tournament_bet_placed",250),
		  (jump_to_menu, "mnu_horse_race"),
    ]),
    ("leave",[
      (eq, "$g_tournament_bet_placed", 0),
      (store_troop_gold,":g", "trp_player"),
      (ge, ":g", 500),
    ],"Bet 500 denars.",[
      (assign, "$g_tournament_bet_placed",500),
      (jump_to_menu, "mnu_horse_race"),
    ]),
    ("leave",[
      (eq, "$g_tournament_bet_placed", 0),
      (store_troop_gold,":g", "trp_player"),
      (ge, ":g", 1000),
     ],"Bet 1000 denars.",[
      (assign, "$g_tournament_bet_placed",1000),
		  (jump_to_menu, "mnu_horse_race"),
    ]),
    ("leave",[],"Withdraw.",[
		  (jump_to_menu, "mnu_town_tournament_won_by_another"),
    ]),
]),

("decide_game",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You can either join the gladiator fights in the arena or participate in an horse race!^^"
  +" The horse race is quite challenging and only true masters participate it.^^You can also watch the beast fights: Criminals are thrown to the beasts between the gladiator fights.",
  "none",[
    (set_background_mesh, "mesh_pic_girls"),
  ],[
    ("op1",[],"Participate in the horse race.",[
      (try_begin),
          (store_skill_level, ":skill", "skl_riding", "trp_player", ),
          (lt, ":skill", 3),
          (display_message, "@You need a riding skill of at least 3! Otherwise you are not able to ride the horse"),
      (else_try),
          (assign, "$temp1",0),
          (jump_to_menu, "mnu_horse_race"),
      (try_end),
    ]),
    ("op2",[],"Participate in the gladiator games.",[
      (jump_to_menu, "mnu_town_tournament"),
    ]),

    ("op3",[],"Watch the beast fight.",[
      (assign, "$temp4", 1),
      (set_jump_mission, "mt_cutscene_start"),

      (assign, ":scene", "scn_collusseum"),
      (try_begin),
          (party_slot_ge, "$g_encountered_party", slot_center_rome_rebuild, 1),
          (eq, "$g_encountered_party", "p_town_6"),
          (ge, "$g_fire", 1),
          (assign, ":scene", "scn_colosseum_2"),
      (try_end),
      (modify_visitors_at_site, ":scene"),
      (reset_visitors),

      (set_visitor, 50, "trp_wild_cat"),
      (set_visitor, 51, "trp_wild_cat"),

      (try_for_range, ":entry", 34, 50),
          (set_visitors, ":entry", "trp_prisoner", 1),
      (try_end),

      (try_for_range, ":entry", 3, 34),
          (set_visitors, ":entry", "trp_guest_female", 8),
          (set_visitors, ":entry", "trp_guest", 8),
      (try_end),

      (assign, ":entry", 0),
      (try_begin),
          (eq, "$g_is_emperor", 1),
          (assign, ":entry", 2),
          (troop_get_slot, ":spouse", "trp_player",slot_troop_spouse),
          (try_begin),
              (gt, ":spouse", -1),
              (set_visitor, 1, ":spouse"),
          (try_end),
      (else_try),
          (eq, "$current_town", "p_town_6"),
          (set_visitor, 1, "trp_kingdom_7_lady_1"),
          (set_visitor, 2, "trp_kingdom_7_lord"),
      (try_end),

      (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_cutscene_start", ":entry", 0),
          (mission_tpl_entry_set_override_flags, "mt_cutscene_start", ":entry", af_override_outfit_1 | af_override_horse),
      (try_end),
      (set_visitor, ":entry", "trp_player"),

      (store_sub, ":town_id", "$current_town", towns_begin),
      (store_add, ":auctor", ":town_id", arena_masters_begin),
      (set_visitor, 66, ":auctor"),

      (set_visitor, 67, "trp_cornicen"),
      (set_visitor, 68, "trp_cornicen"),
      (set_visitor, 69, "trp_cornicen"),

      (set_visitor, 70, "trp_praetoriani_milites_exp"),
      (set_visitor, 71, "trp_praetoriani_milites_exp"),
      (jump_to_scene, ":scene"),
      (change_screen_mission),
    ]),
    ("leave",[],"Go back.",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

("latifundium",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You visit your estate near {s22}.^You have {reg22} slaves working here, while you need at least {reg30} for efficient production.^^"
 +" The estate has the following buildings constructed: {s10}.^^"
 +" The following buildings are under construction: {s11}.^^{s44}",
  "none",[
    (str_clear, s44),
    (party_get_slot, ":disease", "$current_town", slot_center_disease),
    (try_begin),
        (ge, ":disease", 1),
        (call_script, "script_get_event_details", ":disease"),
        (str_store_string, s44, "@The region is haunted by an outbreak of {s0}."),
    (try_end),
    (party_get_slot, ":event", "$current_town", slot_center_event),
    (try_begin),
        (ge, ":event", 1),
        (call_script, "script_get_event_details", ":event"),
        (try_begin),
            (lt, reg1, 0),
            (str_store_string, s44, "@The region has recently suffered from {s0}.^^{s44}"),
        (else_try),
            (str_store_string, s44, "@The region has recently been blessed by a {s0}.^^{s44}"),
        (try_end),
    (try_end),

    (assign, "$current_town", "$g_encountered_party"),
    (str_store_string, s10, "@Grain fields"),
    (str_clear, s11),
    (assign, reg30, 30),
    (assign, ":counter_const", 0),
    (assign, ":counter_done", 0),
    (try_for_range, ":building", slot_lat_silk, slot_lat_building_end),
        (party_get_slot, ":time", "$g_encountered_party", ":building"),
        (neq, ":time", 0),
        (call_script, "script_get_building_details_lat",  ":building"),
        (try_begin),
            (ge, ":time", 1),
            (try_begin),
            #     (eq, ":counter", 0),
            #     (str_store_string, s10, "@{s20}"),
            # (else_try),
                (eq, ":counter_done", 0),
                (str_store_string, s10, "@{s20} and {s10}"),
            (else_try),
                (str_store_string, s10, "@{s20}, {s10}"),
            (try_end),
            (val_add, ":counter_done", 1),
            (val_add, reg30, reg22),
        (else_try),
            (le, ":time", -1),
            (val_abs, ":time"),
            (assign, reg10, ":time"),
            (str_store_string, s20, "@{s20} will finish in {reg10} days"),
            (try_begin),
                (eq, ":counter_const", 0),
                (str_store_string, s11, "@{s20}"),
            (else_try),
                (eq, ":counter_const", 1),
                (str_store_string, s11, "@{s20} and {s11}"),
            (else_try),
                (str_store_string, s11, "@{s20}, {s11}"),
            (try_end),
             (val_add, ":counter_const", 1),
        (try_end),
    (try_end),
    (try_begin),
        (str_is_empty, s11),
        (str_store_string, s11, "@None"),
    (try_end),

    (party_get_num_prisoners, reg22, "$g_encountered_party"),

    (set_background_mesh, "mesh_pic_villa_rustica"),
    (party_get_slot, ":village", "$g_encountered_party", slot_village_bound_center),
    (str_store_party_name, s22, ":village"),

    #remove hero prisoners
    (party_get_num_prisoner_stacks, ":num_stacks", "$g_encountered_party"),
    (try_for_range_backwards, ":troop_iterator", 0, ":num_stacks"),
        (party_prisoner_stack_get_troop_id, ":cur_troop_id", "$g_encountered_party", ":troop_iterator"),
        (troop_is_hero, ":cur_troop_id"),
        (call_script, "script_remove_troop_from_prison", ":cur_troop_id"),
        (party_remove_prisoners, "$g_encountered_party", ":cur_troop_id", 1),
        (str_store_troop_name, s1, ":cur_troop_id"),
        (display_log_message, "@{s1} escaped from prison!"),
    (try_end),
  ],[
  ("village_garrison",[
    (try_begin),
        (party_slot_ge, "$g_encountered_party", slot_lat_guards, 1),
        (str_store_string, s1, "@Manage guards and slaves"),
    (else_try),
        (str_store_string, s1, "@Manage slaves"),
    (try_end),
  ],"{s1}",[
    (change_screen_exchange_members,1),
  ]),
  ("visit",[],"Visit the villa.",[
    (assign, "$current_town", "$g_encountered_party"),
    ##3 oil bress
    ##4 wine press
    ##5 smith
    ##6 butcher
    ##7 cattle
    ##8 mill bakery
    ##9 fish
    ##10 vineyard
    ##11 fruits
    ##12 olives
    ##13 priest
    ##14 - 40 slaves
    ##41-44 guards
    ##45 master potter
    ##47 mule and horse breeder
    ##48 shepherd
    ##49 weavery
    ##50 cheeser
    ##51 tanner
    ##52 inn keeper
    ##53 some random guest
    ##54 - 56 normal guests sitting
    ##57 master_merchant
    ##58 master_silk
    ##59 master_grain
    ##60 physician
    ##61 mercenary in tavern

    (party_get_num_prisoners, ":slaves", "$g_encountered_party"),
    (party_count_prisoners_of_type, ":female_count", "$g_encountered_party", "trp_slave_female"),
    (party_count_prisoners_of_type, ":male_count", "$g_encountered_party", "trp_slave"),
    (store_mul, ":ratio", ":female_count", 100),
    (val_div, ":ratio", ":slaves"),
    (party_get_slot, ":scene", "$g_encountered_party",  slot_castle_exterior),
    (modify_visitors_at_site,":scene"),
    (set_jump_mission,"mt_latifundium"),
    (reset_visitors, 0),

    (set_visitor,59,"trp_grain_master"),

    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_inn, 1),
      (party_slot_ge, "$g_encountered_party", slot_lat_mercenary_type, 1),
      (party_get_slot,":mercenary", "$g_encountered_party", slot_lat_mercenary_type),
      (set_visitor, 61, ":mercenary"),
    (try_end),

    (try_for_range, ":entry", 14, 41),
      (store_random_in_range, ":r", 1, 101),
      (try_begin),
        (gt, ":female_count", 0),
        (le, ":r", ":ratio"),
        (set_visitors, ":entry", "trp_slave_female", 1),
        (val_sub, ":female_count", 1),
      (else_try),
        (gt, ":male_count", 0),
        (set_visitors, ":entry", "trp_slave", 1),
        (val_sub, ":male_count", 1),
      (try_end),
    (try_end),

    (try_begin),
      (this_or_next|key_is_down, key_left_shift),
      (key_is_down, key_right_shift),
      (scene_slot_ge, ":scene", slot_scene_visited, 1),
      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_latifundium", 1, 0),
        (mission_tpl_entry_set_override_flags, "mt_latifundium", 1, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor,1,"trp_player"),
    (else_try),
      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_latifundium", 0, 1),
        (mission_tpl_entry_set_override_flags, "mt_latifundium", 0, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor,0,"trp_player"),
    (try_end),
    (try_begin),
      (party_slot_eq, "$g_encountered_party", slot_center_culture, "fac_culture_2"),
      (mission_tpl_entry_set_override_flags, "mt_pret_event_12",2, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_pret_event_12", 2),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_celtic_light1"),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_celtic_boots"),
    (else_try),
      (party_slot_eq, "$g_encountered_party", slot_center_culture, "fac_culture_2_1"),
      (mission_tpl_entry_set_override_flags, "mt_pret_event_12",2, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_pret_event_12", 2),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_celtic_light3"),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_celtic_boots"),
    (else_try),
      (party_slot_eq, "$g_encountered_party", slot_center_culture, "fac_culture_1"),
      (mission_tpl_entry_set_override_flags, "mt_pret_event_12",2, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_pret_event_12", 2),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_dacian_light5"),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_leather_boots"),
    (else_try),
      (party_slot_eq, "$g_encountered_party", slot_center_culture, "fac_culture_3"),
      (mission_tpl_entry_set_override_flags, "mt_pret_event_12",2, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_pret_event_12", 2),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_scythian_light2"),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_leather_boots"),
    (else_try),
      (party_slot_eq, "$g_encountered_party", slot_center_culture, "fac_culture_9"),
      (mission_tpl_entry_set_override_flags, "mt_pret_event_12",2, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_pret_event_12", 2),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_bosporan_light2"),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_leather_boots"),
    (else_try),
      (party_slot_eq, "$g_encountered_party", slot_center_culture, "fac_culture_4"),
      (mission_tpl_entry_set_override_flags, "mt_pret_event_12",2, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_pret_event_12", 2),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_germanic_light4"),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_celtic_boots"),
    (else_try),
      (this_or_next|party_slot_eq, "$g_encountered_party", slot_center_culture, "fac_culture_5"),
      (this_or_next|party_slot_eq, "$g_encountered_party", slot_center_culture, "fac_culture_6"),
      (party_slot_eq, "$g_encountered_party", slot_center_culture, "fac_culture_8"),
      (mission_tpl_entry_set_override_flags, "mt_pret_event_12",2, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_pret_event_12", 2),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_persian_tunic_3"),
      (mission_tpl_entry_add_override_item, "mt_town_default",2, "itm_eastern_shoe"),
    (try_end),
    (try_begin),
      (gt, "$g_player_chamberlain", 0),
      (call_script, "script_dplmc_appoint_chamberlain"),  #fix for wrong troops after update
      (set_visitor, 2, "$g_player_chamberlain"),
    (try_end),
    (set_visitor,2,"trp_administrator"),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_inn, 1),
      (set_visitor,52,"trp_master_inn"),
      (store_random_in_range, ":r", 0, 6),
      (try_begin),
        (eq, ":r", 0),
        (set_visitor,53,"trp_whore"),
      (else_try),
        (eq, ":r", 1),
        (store_random_in_range, ":troop", tavern_booksellers_begin, tavern_booksellers_end),
        (set_visitor,53,":troop"),
      (else_try),
        (eq, ":r", 2),
        (store_random_in_range, ":troop", tavern_travelers_begin, tavern_travelers_end),
        (set_visitor,53,":troop"),
      (else_try),
        (eq, ":r", 3),
        (store_random_in_range, ":troop", ransom_brokers_begin, ransom_brokers_end),
        (set_visitor,53,":troop"),
      (else_try),
        (eq, ":r", 4),
        (store_random_in_range, ":troop", tavern_minstrels_begin, tavern_minstrels_end),
        (set_visitor,53,":troop"),
      (try_end),
      (set_visitor,54,"trp_guest"),
      (set_visitor,55,"trp_guest_female"),
      (set_visitor,56,"trp_guest"),
    (try_end),

    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_vineyard, 1),
      (set_visitor,10,"trp_grape_master"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_winepress, 1),
      (set_visitor,4,"trp_wine_master"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_oilpress, 1),
      (set_visitor,3,"trp_oil_master"),
    (try_end),

    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_silk, 1),
      (set_visitor,58,"trp_master_silk"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_oilgrove, 1),
      (set_visitor,12,"trp_olives_master"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_pottery, 1),
      (set_visitor,45,"trp_master_pottery"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_weaver, 1),
      (set_visitor,49,"trp_master_weaver"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_merchant, 1),
      (set_visitor,57,"trp_master_merchant"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_cheeser, 1),
      (set_visitor,50,"trp_master_cheeser"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_tanner, 1),
      (set_visitor,51,"trp_master_tanner"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_smith, 1),
      (set_visitor,5,"trp_smith_master"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_cattle, 1),
      (set_visitor,7,"trp_cattle_master"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_butcher, 1),
      (set_visitor,6,"trp_butcher_master"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_fishery, 1),
      (set_visitor,9,"trp_fish_master"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_fruits, 1),
      (set_visitor,11,"trp_fruit_master"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_bakery, 1),
      (set_visitor,8,"trp_master_baker"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_teacher, 1),
      (set_visitor,46,"trp_teacher"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_sheep, 1),
      (set_visitor,48,"trp_master_sheep"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_horse, 1),
      (set_visitor,47,"trp_master_breeder"),
    (try_end),

    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_doctor, 1),
      (set_visitor,60,"trp_healer_2"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_temple, 1),
      (party_get_slot, ":god", "$g_encountered_party", slot_lat_deity),
      (call_script, "script_get_priest_for_god", ":god"),
      (set_visitor,13, reg0),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_encountered_party", slot_lat_guards, 1),
      (assign, ":guard_no", 41),
      (party_get_num_companion_stacks, ":num_stacks", "$g_encountered_party"),
      (try_for_range, ":troop_iterator", 0, ":num_stacks"),
          (lt, ":guard_no", 45),
          (party_stack_get_troop_id, ":cur_troop_id", "$g_encountered_party", ":troop_iterator"),
          (neg|troop_is_hero, ":cur_troop_id"),
          (party_stack_get_size, ":stack_size","$g_encountered_party",":troop_iterator"),
          (party_stack_get_num_wounded, ":num_wounded","$g_encountered_party",":troop_iterator"),
          (val_sub, ":stack_size", ":num_wounded"),
          (try_for_range, ":unused", 0, ":stack_size"),
            (lt, ":guard_no", 45),
            (party_stack_get_troop_dna,":troop_dna","$g_encountered_party",":troop_iterator"),
            (set_visitor, ":guard_no", ":cur_troop_id", ":troop_dna"),
            (val_add, ":guard_no", 1),
        (try_end),
      (try_end),

      # (set_visitor,41,"trp_vigilia"),
      # (set_visitor,42,"trp_vigilia"),
      # (set_visitor,43,"trp_vigilia"),
      # (set_visitor,44,"trp_vigilia"),
    (try_end),

    (jump_to_scene, ":scene"),
    (change_screen_mission),
  ]),
  ("visit",[],"Rename your estate.",[
    (assign, "$g_presentation_state", rename_party),
    (start_presentation, "prsnt_name_kingdom"),
  ]),
  ("visit",[
    (ge, "$cheat_mode", 1),
  ],"Test the scene.",[
    (party_get_slot, ":scene", "$g_encountered_party",  slot_castle_exterior),
    (jump_to_scene, ":scene"),
    (change_screen_mission),
  ]),
  ("castle_wait",[
    (party_slot_ge, "$g_encountered_party", slot_lat_camp, 1),
  ],"Rest here for some time.",[
    (assign, "$auto_enter_town", "$g_encountered_party"),
    (assign, "$g_town_visit_after_rest", 1),
    (assign, "$g_last_rest_center", "$g_encountered_party"),
    (assign, "$g_last_rest_payment_until", -1),
    (rest_for_hours_interactive, 24 * 86, 12, 0), #rest while not attackable
    (change_screen_return),
  ]),
  ("leave",[],"Leave.",[
		(change_screen_map),
  ]),
]),

("inspect_treasury",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "As censor you are allowed to oversee the whole imperial budget: Everything from the imperial taxes Alexandria paid to the bills of Nero.^^^"
  +"You are surrounded by other officials. After some time they leave you alone, a good moment to make some changes...",
    "none",[
    (set_background_mesh, "mesh_pic_payment"),
  ],[
  ("visit",[
  ],
  "The townwatch ordered 10,000 denars for new spears, I am sure it was 20,000 (embezzle 10,000 denars)",[
    (assign, "$temp", 10000),
    (jump_to_menu, "mnu_reaction_embezzle"),
  ]),
  ("visit",[
  ],"Alexandria paid 100,000 denars taxes in the last months. I am sure it was only 50,000 denars (embezzle 50,000 denars)",[
    (assign, "$temp", 50000),
    (jump_to_menu, "mnu_reaction_embezzle"),
  ]),
  ("visit",[
  ],"The Augusta is known to be piggish, I am sure she has spend 100,000 denars not 10,000 denars for her last meal... (embezzle 90,000 denars)",[
    (assign, "$temp", 90000),
    (jump_to_menu, "mnu_reaction_embezzle"),
  ]),
  ("visit",[
  ],"The Princeps likes parties, I am sure for last one he spend 250,000 denars not 120,000... (embezzle 130,000 denars)",[
    (assign, "$temp", 130000),
    (jump_to_menu, "mnu_reaction_embezzle"),
  ]),
  ("leave",[],"Go back.",[
    (jump_to_menu, "mnu_senatus"),
  ]),
]),

("reaction_embezzle",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s1}",
  "none",[
    (set_background_mesh, "mesh_pic_payment"),
    (troop_get_slot, ":embezzled_founds_amount", "trp_player", slot_player_embezzeled_founds),
    (store_div, ":change", "$temp", 1000),
    (val_add, ":embezzled_founds_amount", ":change"),
    (troop_set_slot, "trp_player", slot_player_embezzeled_founds, ":embezzled_founds_amount"),
    (store_random_in_range, ":rand", 0, 4000),#was 5000
    (assign, reg33, 0),
    (try_begin),
       (le, ":rand", ":embezzled_founds_amount"),
       (str_store_string, s1, "@You were caught! An official who crosschecked the documents you modified noticed your changes. A major investigation is now about to be initiated. It is also possible, that other misdeeds you committed will be discovered!"),
    (else_try),
       (assign, reg33, "$temp"),
       (str_store_string, s1, "@You successfully embezzled founds worth {reg33} denars without anybody noting."),
    (try_end),
  ],[
    ("leave",[
      (neq, reg33, "$temp"),
    ],"Damn it.",[
      (add_xp_as_reward, 50),
      (call_script, "script_change_player_honor", -3),
      (jump_to_menu, "mnu_caught_embezzle"),
    ]),
    ("leave",[
      (eq, reg33, "$temp"),
    ],"Very good.",[
      (add_xp_as_reward, 250),
      (call_script, "script_change_player_honor", -1),
      (troop_add_gold, "trp_player", "$temp"),
      (store_div, ":imperial_debts", "$temp", 2),
      (call_script, "script_add_to_faction_bugdet", slot_faction_debts, "fac_kingdom_7", ":imperial_debts"),

      (rest_for_hours, 12, 14, 0),
      (change_screen_map),
    ]),
]),

("caught_embezzle",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You manage to find out who is responsible for the investigation. You can bribe him to make sure it will stop now. The responsible official demands {reg33} denars as a bribe.",
    "none",
    [
    (troop_get_slot, ":embezzled_founds_amount", "trp_player", slot_player_embezzeled_founds),
    (val_mul, ":embezzled_founds_amount", 1000),
    (val_div, ":embezzled_founds_amount", 2),

    (val_div, ":embezzled_founds_amount", 1000),
    (val_mul, ":embezzled_founds_amount", 1000),
    (assign, reg33, ":embezzled_founds_amount"),
    ],[
    ("leave",[(store_troop_gold, ":g", "trp_player"),
    (ge, ":g", reg33),
    ],"Give him the money...",[
      (add_xp_as_reward, 500),
      (call_script, "script_change_player_honor", -3),
      (troop_remove_gold, "trp_player", reg33),
      (jump_to_menu, "mnu_caught_embezzle_bribed"),
    ]),
    ("leave",[],"I don't have that much...",[
      (jump_to_menu, "mnu_caught_embezzle_punished"),
    ]),
]),

("caught_embezzle_bribed",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The official seems to be happy about your 'gift' and the case goes ad acta.",
  "none",
  [(set_background_mesh, "mesh_pic_senators"),
  ],[

  ("leave",[
  ],"Very good.",[
    (add_xp_as_reward, 50),
    (troop_set_slot, "trp_player", slot_player_embezzeled_founds, 0),
    (jump_to_menu, "mnu_town"),
   ]),
]),

("caught_embezzle_punished",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "A major investigation takes place and the officials discovered that you have embezzled {reg33} denars over the time! Caesar Nero was informed about this incident and acts accordingly. You are forced to repay the embezzled founds.",
  "none",
  [
    (troop_get_slot, ":embezzled_founds_amount", "trp_player", slot_player_embezzeled_founds),

    (store_mul, ":relation_lose", ":embezzled_founds_amount", -1),
    (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lord", ":relation_lose"),

    (store_troop_faction, ":faction1", "trp_kingdom_7_lord"),
    (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
      (neg|troop_slot_eq, ":troop", slot_troop_occupation, dplmc_slto_dead),
      (store_troop_faction,":faction", ":troop"),
      (eq, ":faction", ":faction1"),
      (call_script, "script_troop_get_relation_with_troop", ":troop", "trp_kingdom_7_lord"),
      (ge, reg0, 10),
      (store_div, ":relation_lose", reg0, 2),
      (val_abs, ":relation_lose"),
      (val_sub, ":relation_lose", 5),
      (val_clamp, ":relation_lose", 1, 20),
      (val_mul, ":relation_lose", -1),
      (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
    (try_end),
    (val_mul, ":embezzled_founds_amount", 1000),
    (assign, reg33, ":embezzled_founds_amount"),
    (try_begin),
      (ge, reg33, 600000),
      (call_script, "script_change_player_honor", -300),
      (call_script, "script_change_troop_renown","trp_player", -450),
    (else_try),
      (ge, reg33, 500000),
      (call_script, "script_change_player_honor", -250),
      (call_script, "script_change_troop_renown","trp_player", -400),
    (else_try),
      (ge, reg33, 400000),
      (call_script, "script_change_player_honor", -220),
      (call_script, "script_change_troop_renown","trp_player", -375),
    (else_try),
      (ge, reg33, 300000),
      (call_script, "script_change_player_honor", -160),
      (call_script, "script_change_troop_renown","trp_player", -350),
    (else_try),
      (ge, reg33, 200000),
      (call_script, "script_change_player_honor", -120),
      (call_script, "script_change_troop_renown","trp_player", -300),
    (else_try),
      (ge, reg33, 150000),
      (call_script, "script_change_player_honor", -100),
      (call_script, "script_change_troop_renown","trp_player", -250),
    (else_try),
      (ge, reg33, 100000),
      (call_script, "script_change_player_honor", -80),
      (call_script, "script_change_troop_renown","trp_player", -200),
    (else_try),
      (ge, reg33, 75000),
      (call_script, "script_change_player_honor", -60),
      (call_script, "script_change_troop_renown","trp_player", -100),
    (else_try),
      (ge, reg33, 50000),
      (call_script, "script_change_player_honor", -30),
      (call_script, "script_change_troop_renown","trp_player", -75),
    (else_try),
      (ge, reg33, 25000),
      (call_script, "script_change_player_honor", -15),
      (call_script, "script_change_troop_renown","trp_player", -60),
    (else_try),
      (ge, reg33, 15000),
      (call_script, "script_change_player_honor", -10),
      (call_script, "script_change_troop_renown","trp_player", -50),
    (else_try),
      (call_script, "script_change_player_honor", -5),
      (call_script, "script_change_troop_renown","trp_player", -50),
    (try_end),
  ],[

      ("leave",[
      ],"Damn it.",[
        (troop_set_slot, "trp_player", slot_player_embezzeled_founds, 0),
        (val_add, "$g_player_debt_to_party_members", reg33),
        (jump_to_menu, "mnu_town"),
      ]),

]),

  # (
    # "center_improve_temple",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    # "To which deity do you wish to dedicate the temple?",
    # "none",
    # [
    # ],[

      # ("leave",[	(neq, "$current_town", "p_town_6"),
      # ],"Jupiter.",[
    # (assign, "$temp4_1", worships_jupiter),
    # (jump_to_menu, "mnu_center_improve"),
      # ]),
      # ("leave",[(neq, "$current_town", "p_town_6"),
      # ],"Aphrodite.",[
    # (assign, "$temp4_1", worships_aphrodite),
    # (jump_to_menu, "mnu_center_improve"),

      # ]),
      # ("leave",[(neq, "$current_town", "p_town_6"),
      # ],"Vesta.",[
    # (assign, "$temp4_1", worships_vest),
    # (jump_to_menu, "mnu_center_improve"),
      # ]),
      # ("leave",[(neq, "$current_town", "p_town_6"),
      # ],"Mars.",[
    # (assign, "$temp4_1", worships_mars),
    # (jump_to_menu, "mnu_center_improve"),
      # ]),
      # ("leave",[(neq, "$current_town", "p_town_6"),
      # ],"Saturn.",[
    # (assign, "$temp4_1", worships_saturn),
    # (jump_to_menu, "mnu_center_improve"),
      # ]),
      # ("leave",[(neq, "$current_town", "p_town_6"),
      # ],"Kastor and Pollux.",[
    # (assign, "$temp4_1", worships_castor_pollux),
    # (jump_to_menu, "mnu_center_improve"),
      # ]),
      # ("leave",[(neq, "$current_town", "p_town_6"),
      # (quest_slot_ge, "qst_wlodowiecus_adventure_1", slot_quest_current_state,6),
      # ],"Mithras.",[
    # (assign, "$temp4_1", worships_mithras),
    # (jump_to_menu, "mnu_center_improve"),
      # ]),

      # ("leave",[	(eq, "$current_town", "p_town_6"),
      # (disable_menu_option),
      # ],"Jupiter. (already built)",[
    # (assign, "$temp4_1", worships_jupiter),
    # (jump_to_menu, "mnu_center_improve"),
    # (disable_menu_option),
      # ]),
      # ("leave",[(eq, "$current_town", "p_town_6"),
       # (disable_menu_option),
      # ],"Aphrodite. (already built)",[
    # (assign, "$temp4_1", worships_aphrodite),
    # (jump_to_menu, "mnu_center_improve"),

      # ]),
      # ("leave",[(eq, "$current_town", "p_town_6"),
       # (disable_menu_option),
      # ],"Vesta. (already built)",[
    # (assign, "$temp4_1", worships_vest),
    # (jump_to_menu, "mnu_center_improve"),

      # ]),
      # ("leave",[(eq, "$current_town", "p_town_6"),
       # (disable_menu_option),
      # ],"Mars. (already built)",[
    # (assign, "$temp4_1", worships_mars),
    # (jump_to_menu, "mnu_center_improve"),

      # ]),
      # ("leave",[(eq, "$current_town", "p_town_6"),
       # (disable_menu_option),
      # ],"Saturn. (already built)",[
    # (assign, "$temp4_1", worships_saturn),
    # (jump_to_menu, "mnu_center_improve"),

      # ]),
      # ("leave",[(eq, "$current_town", "p_town_6"),
       # (disable_menu_option),
      # ],"Kastor and Pollux. (already built)",[
    # (assign, "$temp4_1", worships_castor_pollux),
    # (jump_to_menu, "mnu_center_improve"),

      # ]),
     # ("leave",[(eq, "$current_town", "p_town_6"),
    # (disable_menu_option),
    # (quest_slot_ge, "qst_wlodowiecus_adventure_1", slot_quest_current_state,6),
      # ],"Mithras. (already built)",[
    # (assign, "$temp4_1", worships_mithras),
    # (jump_to_menu, "mnu_center_improve"),

      # ]),

      # ("leave",[
    # (troop_slot_eq, "trp_player", slot_troop_religion, worships_christus),
      # ],"The only true God and his son Christus.",[
    # (assign, "$temp4_1", worships_christus),
    # (jump_to_menu, "mnu_center_improve"),
      # ]),
      # ("leave",[
         # (troop_slot_eq, "trp_player", slot_troop_religion, worships_yhwhe),
      # ],"The only true God, YHWH.",[
    # (assign, "$temp4_1", worships_yhwhe),
    # (jump_to_menu, "mnu_center_improve"),
      # ]),

      # ("leave",[
      # ],"Go back.",[
    # (jump_to_menu, "mnu_center_manage_2"),
      # ]),

    # ]
  # ),

("parthian_expedition",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Parthian rebellion!^^The Parthians revolt against the foreign conquerers! A rebellion started in {s2}.",
  "none",
  [
    (str_store_party_name, s2, "p_town_51"),
    (set_background_mesh, "mesh_pic_sarranid_encounter"),
  ],[
    ("continue",[
    ],"Continue.",[
      (store_faction_of_party, ":fac", "p_town_51"),
      (call_script, "script_diplomacy_start_war_between_kingdoms", ":fac", "fac_kingdom_6", logent_faction_declares_war_to_declare_independence),
      (faction_set_slot, "fac_kingdom_6", slot_faction_parthian_expedition, 1),

      (set_spawn_radius, 5),
      (call_script, "script_spawn_party", "p_town_51", "pt_parthian_exp"),
      (assign, ":rebel_party", reg0),
      (party_add_members, ":rebel_party", "trp_eastern_light_axeman", 400),
      (party_add_members, ":rebel_party", "trp_eastern_medium_horseman", 300),
      (party_add_members, ":rebel_party", "trp_eastern_slinger", 100),
      (party_upgrade_with_xp, ":rebel_party", 450000,0),
      (try_begin),
          (le, ":rebel_party", last_static_party),
          (display_log_message, "@ERROR ERROR ERROR: Wrong party", message_negative),
      (try_end),

      (party_set_faction, ":rebel_party", "fac_kingdom_6"),

      (call_script, "script_party_set_ai_state", ":rebel_party", spai_besieging_center, "p_town_51"),

      (party_set_ai_behavior, ":rebel_party", ai_bhvr_attack_party),
      (party_set_ai_object, ":rebel_party", "p_town_51"),
      (party_set_flags, ":rebel_party", pf_default_behavior, 1),
      (party_set_slot, ":rebel_party", slot_party_ai_substate, 1),

      (party_set_slot, ":rebel_party", slot_party_type, spt_rebellion),
      (party_set_slot, ":rebel_party", slot_rebellion_target, "p_town_51"),
      (party_set_slot, "p_town_51", slot_center_ongoing_rebellion, 1),
      (party_set_slot, "p_town_51", slot_center_is_besieged_by, ":rebel_party"),
      (change_screen_map),
    ]),
]),

("cheat_menu2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "More cheats",
  "none",[
  ],[

      # ("options",[(ge, "$cheat_mode", 1),(troop_slot_eq, "trp_global_variables", g_is_dev, 1),],"Show all bandits lairs",[
      #   (try_for_parties, ":party_no"),
      #       (party_get_template_id, ":party_template", ":party_no"),
      #       (this_or_next|eq, ":party_template", "pt_slave_hideout"),
      #       (this_or_next|eq, ":party_template", "pt_grove"),
      #       (is_between, ":party_template", "pt_steppe_bandit_lair", "pt_looter_lair"),
      #       (party_set_flags, ":party_no", pf_disabled, 0),
      #       (party_set_flags, ":party_no", pf_always_visible, 1),
      #   (try_end),
      # ]),
      # ("options",[
      # ],"war Rome Parthia",[
      #   (call_script, "script_diplomacy_start_war_between_kingdoms", "fac_kingdom_7", "fac_kingdom_6", logent_faction_declares_war_to_respond_to_provocation),#to make britannia more active
      #   (change_screen_map),
      # ]),
      # ("options",[
      # ],"Rome provokes osrohne",[
      #   (store_add, ":slot_provocation_days", "$players_kingdom", slot_faction_provocation_days_with_factions_begin),
      #   (val_sub, ":slot_provocation_days", kingdoms_begin),
      #   (faction_set_slot, "fac_kingdom_23", ":slot_provocation_days", 1),

      #   (store_add, ":slot_provocation_days", "fac_kingdom_7", slot_faction_provocation_days_with_factions_begin),
      #   (val_sub, ":slot_provocation_days", kingdoms_begin),
      #   (faction_set_slot, "fac_kingdom_23", ":slot_provocation_days", 1),

      #   (change_screen_map),
      # ]),

    ("options",[
    ],"Osrohne provokes Parthia",[

      (store_add, ":slot_provocation_days", "fac_kingdom_23", slot_faction_provocation_days_with_factions_begin),
      (val_sub, ":slot_provocation_days", kingdoms_begin),
      (faction_set_slot, "fac_kingdom_6", ":slot_provocation_days", 1),

      (change_screen_map),
    ]),

      # ("options",[
      # ],"Osrohne provokes Rome",[
      #   (store_add, ":slot_provocation_days", "fac_kingdom_23", slot_faction_provocation_days_with_factions_begin),
      #   (val_sub, ":slot_provocation_days", kingdoms_begin),
      #   (faction_set_slot, "$players_kingdom", ":slot_provocation_days", 1),

      #   (store_add, ":slot_provocation_days", "fac_kingdom_23", slot_faction_provocation_days_with_factions_begin),
      #   (val_sub, ":slot_provocation_days", kingdoms_begin),
      #   (faction_set_slot, "fac_kingdom_7", ":slot_provocation_days", 1),

      #   (change_screen_map),
      # ]),

      # ("options",[
      # ],"player provokes Rome",[
      #   # (store_add, ":slot_provocation_days", "fac_kingdom_23", slot_faction_provocation_days_with_factions_begin),
      #   # (val_sub, ":slot_provocation_days", kingdoms_begin),
      #   # (faction_set_slot, "$players_kingdom", ":slot_provocation_days", 1),

      #   (store_add, ":slot_provocation_days", "$players_kingdom", slot_faction_provocation_days_with_factions_begin),
      #   (val_sub, ":slot_provocation_days", kingdoms_begin),
      #   (faction_set_slot, "fac_kingdom_7", ":slot_provocation_days", 1),

      #   (change_screen_map),
      # ]),

      # ("options",[
      # ],"Rome provokes player",[
      #   # (store_add, ":slot_provocation_days", "fac_kingdom_23", slot_faction_provocation_days_with_factions_begin),
      #   # (val_sub, ":slot_provocation_days", kingdoms_begin),
      #   # (faction_set_slot, "$players_kingdom", ":slot_provocation_days", 1),

      #   (store_add, ":slot_provocation_days", "fac_kingdom_7", slot_faction_provocation_days_with_factions_begin),
      #   (val_sub, ":slot_provocation_days", kingdoms_begin),
      #   (faction_set_slot, "$players_kingdom", ":slot_provocation_days", 1),

      #   (change_screen_map),
      # ]),

      # ("options",[
      # ],"Transform",[
      #   (store_add, ":truce_slot", "fac_kingdom_23", slot_faction_truce_days_with_factions_begin),
      #   (val_sub, ":truce_slot", kingdoms_begin),
      #   (faction_set_slot, "$players_kingdom", ":truce_slot", 86),


      #   (store_add, ":truce_slot", "$players_kingdom", slot_faction_truce_days_with_factions_begin),
      #   (val_sub, ":truce_slot", kingdoms_begin),
      #   (faction_set_slot, "fac_kingdom_23", ":truce_slot", 86),
      # ]),

    ("options",[
      (ge, "$cheat_mode", 1),
      (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
    ],"Scene testing (talk with fortuna)",[
      (assign, "$talk_context", 0),
      (modify_visitors_at_site, "scn_camp_scene_plain"),
      (reset_visitors),
      (set_jump_entry, 0),
      (set_visitor, 1, "trp_fortuna"),
      (jump_to_scene, "scn_camp_scene_plain"),
      (set_jump_mission, "mt_fortuna_scene_testing2"),
      (change_screen_mission),
      ]
    ),
    # ("cheat_slots",[
    #   (check_quest_active, "qst_important_friends"),
    # ],"{!}CHEAT! - End Important friends quest",[
    #   (jump_to_menu, "mnu_emperor_event_fake_nero"),
    #   (call_script, "script_succeed_quest", "qst_important_friends"),
    #   (call_script, "script_end_quest", "qst_important_friends"),
    # ]),


    # ("options",[(ge, "$cheat_mode", 1),(troop_slot_eq, "trp_global_variables", g_is_dev, 1),],"Randomly start wars",[
    #   (try_for_range, ":unused", 0, 100),
    #       (call_script, "script_randomly_start_war_peace_new", 1),
    #   (try_end),
    # ]),
    ("cheat_slots",[
      (ge, "$g_talk_troop", 0),
    ],"{!}CHEAT! - Access slots, modify inventory and rename all troops",[
	   # (assign, "$g_talk_troop", "trp_player"),
	    (jump_to_menu, "mnu_display_troop_slots"),
    ]),

     # ("options",[

      # ],"Spring",
        # [
    # (try_for_range, ":selected_faction", kingdoms_begin, kingdoms_end),
        # (try_for_range, ":except_faction_no", kingdoms_begin, kingdoms_end),
            # (store_add, ":slot", slot_faction_neighbors_begin, ":selected_faction"),
            # (val_sub, ":slot", kingdoms_begin),
            # (faction_slot_eq, ":except_faction_no", ":slot", 1),
            # (str_store_faction_name, s1, ":except_faction_no"),
            # (str_store_faction_name, s2, ":selected_faction"),
            # (display_message, "@{s2} and {s1} are neighbors!"),
        # (try_end),
    # (try_end),
        # ]
      # ),
      # ("options",[

      # ],"Winter",
        # [
        # (jump_to_menu, "mnu_winter"),
        # ]
      # ),

      # ("options",[
    # (troop_slot_eq, "trp_global_variables", g_is_dev, 1),
      # ],"Test slot_center_original_faction",
        # [
      # (try_for_range, ":village", centers_begin, centers_end),
        # (party_get_slot, reg4, ":village", slot_center_original_faction),
        # (party_get_slot, reg5, ":village", slot_center_ex_faction),
        # (str_store_party_name, s1, ":village"),
        # (str_store_faction_name, s2, reg4),
        # (str_store_faction_name, s3, reg5),
        # (display_message,"@{s1}: slot_center_original_faction {s2}, slot_center_ex_faction {s3}"),
      # (try_end),
        # ]
      # ),

      # ("options",[

      # ],"Test Names",
      # [
      # (try_for_range, ":village", villages_begin, villages_end),
        # (party_get_slot, reg4, ":village", slot_castle_exterior),
        # (party_set_name, ":village", "@Scene_ {reg4}"),
      # (try_end),
        # ]
      # ),
    ("camp_cheat_find_item",[], "Add unhealth.",[
      (call_script, "script_change_troop_health", "trp_player", 200),
    ]),
    ("camp_cheat_find_item",[], "Change weather.",[
      (jump_to_menu, "mnu_cheat_change_weather"),
    ]),
    ("camp_cheat_find_item",[], "Search for issues with governors",[
        (try_for_range, ":province", slot_province_governor_begin, p_provinces_end),
            (troop_get_slot, ":governor", "trp_province_array", ":province"),
            (gt, ":governor", -1),
            (str_store_troop_name_link, s10, ":governor"),
            (try_begin),
              (troop_get_slot, reg10, ":governor", slot_troop_legion),
              (ge, reg10, 1),
              (display_message, "@{s10} has legion {reg10}"),
            (try_end),
            (try_begin),
              (troop_get_slot, reg10, ":governor", slot_troop_govern),
              (neq, reg10, ":province"),
              (assign, reg11, ":province"),
              (display_message, "@{s10} has other province: {reg10} ({reg11})"),
            (try_end),
            (try_begin),
              (troop_get_slot, reg10, ":governor", slot_troop_aux),
              (ge, reg10, 1),
              (display_message, "@{s10} has auxiliar {reg10}"),
            (try_end),
        (try_end),
    ]),

      # ("options",[],"Set Civil war variable -1",
        # [
      # (assign, "$g_civil_war", -1),##set it -1, otherwise features wont be available
        # ]
      # ),
      # ("options",[],"Display lord wealth and trade skill.",
        # [
        # (try_for_range, ":troop", active_npcs_begin, active_npcs_end),
          # (this_or_next|troop_slot_eq, ":troop", slot_troop_occupation, slto_kingdom_hero),
          # (troop_slot_eq, ":troop", slot_troop_occupation, slto_kingdom_lady),
          # (troop_get_slot, reg33, ":troop", slot_troop_wealth),
          # (str_store_troop_name, s22, ":troop"),
          # (store_skill_level,reg34, "skl_trade", ":troop"),
          # (display_message, "@{s22} has wealth {reg33} and trade skill {reg34}"),
        # (try_end),
        # ]
      # ),
      # ("options",[],"Display buildings in centers.",[
      #   (assign, ":num_centers_buildings", 0),
      #   (assign, ":num_latifundia", 0),
      #   (try_for_range, ":party", centers_begin, centers_end),
      #     # (call_script, "script_dplmc_estimate_center_weekly_income", ":party"),
      #     # (display_message, "@estimated centers wealth: {reg0}"),
      #     (party_get_slot, ":lord", ":party", slot_town_lord),
      #     (str_store_string, s59, "str_none"),
      #     (try_begin),
      #       (ge, ":lord", 0),
      #       (str_store_troop_name, s59, ":lord"),
      #     (try_end),
      #     (str_store_party_name, s60, ":party"),
      #     (try_begin),
      #       (party_get_slot, reg22, ":party", slot_center_has_latifundium),
      #       (ge, reg22, 1),
      #       (display_message,"@{s60} has latifundium {reg22}"),
      #       (val_add, ":num_latifundia", 1),
      #       (party_is_active, reg22),
      #       (display_message,"@latifundium is active in {s60}"),
      #     (try_end),
      #     (try_for_range, ":building", slot_center_has_silver_mine, slot_center_has_temple_god),
      #       (party_slot_ge,  ":party", ":building", 1),
      #       (call_script, "script_get_improvement_details", ":building", ":party"),
      #       (display_log_message, "@{s60} has a {s0} (lord: {s59})"),
      #       (val_add, ":num_centers_buildings", 1),
      #     (try_end),
      #   (try_end),
      #   (assign, reg0, ":num_centers_buildings"),
      #   (assign, reg1, ":num_latifundia"),
      #   (store_sub, reg2, centers_end, centers_begin),
      #   (store_div, reg3, reg0, reg2),
      #   (display_message, "@Number latifundia: {reg1}. Number of buildings: {reg0}. Total number of centers: {reg2}. Average number of buildings per center: {reg3}")
      # ]),

      # ("options",[(troop_slot_eq, "trp_global_variables", g_is_dev, 1),],"Display possible corrupt slots and set them 0 for troops.",
      #   [
      #   (try_for_range, ":troop", "trp_player", "trp_plinius_elder"),
      #     (neq, ":troop","trp_banner_background_color_array"),
      #     (neq, ":troop","trp_player"),
      #     (neq, ":troop","trp_temp_troop"),
      #    # (neq, ":troop", "trp_knight_1_2"),
      #     (try_for_range, ":slots", 0, 700),
      #       (troop_get_slot, ":value", ":troop", ":slots"),
      #       (try_begin),
      #         (ge, ":value", 50000000),#100 MIO
      #         (str_store_troop_name, s22, ":troop"),
      #         (assign, reg34, ":slots"),
      #         (assign, reg33, ":value"),
      #         (display_message, "@{s22} has slot {reg34} with value {reg33}, set 0"),
      #         (troop_set_slot, ":troop", ":slots", 0),
      #       (else_try),
      #         (le, ":value", -50000000),#50 MIO
      #         (str_store_troop_name, s22, ":troop"),
      #         (assign, reg34, ":slots"),
      #         (assign, reg33, ":value"),
      #         (display_message, "@{s22} has slot {reg34} with value {reg33}, set 0"),
      #         (troop_set_slot, ":troop", ":slots", 0),
      #       (try_end),
      #       (assign, ":value", 0),
      #     (try_end),
      #   (try_end),
      #   (try_for_parties, ":party"),
      #     (party_is_active, ":party"),
      #     (try_for_range, ":slots", 0, 700),
      #       (party_get_slot, reg33, ":party", ":slots"),
      #       (try_begin),
      #         (ge, reg33, 100000000),#100 MIO
      #         (str_store_party_name, s22, ":party"),
      #         (assign, reg34, ":slots"),
      #         (display_message, "@{s22} has slot {reg34} with value {reg33}"),
      #       (else_try),
      #         (le, reg33, -100000000),#100 MIO
      #         (str_store_party_name, s22, ":party"),
      #         (assign, reg34, ":slots"),
      #         (display_message, "@{s22} has slot {reg34} with value {reg33}"),
      #       (try_end),
      #       (assign, reg33, 0),
      #     (try_end),
      #   (try_end),
      #   (try_for_range, ":faction", "fac_no_faction", "fac_gladiators"),
      #     (try_for_range, ":slots", 0, 700),
      #       (faction_get_slot, reg33, ":faction", ":slots"),
      #       (try_begin),
      #         (ge, reg33, 100000000),#100 MIO
      #         (str_store_faction_name, s22, ":faction"),
      #         (assign, reg34, ":slots"),
      #         (display_message, "@{s22} has slot {reg34} with value {reg33}"),
      #       (else_try),
      #         (le, reg33, -100000000),#100 MIO
      #         (str_store_faction_name, s22, ":faction"),
      #         (assign, reg34, ":slots"),
      #         (display_message, "@{s22} has slot {reg34} with value {reg33}"),
      #       (try_end),
      #       (assign, reg33, 0),
      #     (try_end),
      #   (try_end),
      #   ]
      # ),

    # ("options",[(ge, "$cheat_mode", 1),],"Add everything needed for jewish revolt.",[
    #   (troop_set_slot, "trp_player", slot_troop_renown, 800),
    #   (troop_raise_skill,"trp_player", "skl_leadership", 10),
    #   (troop_raise_skill,"trp_player", "skl_tactics", 10),
    #   (troop_set_slot, "trp_player", slot_troop_religion, worships_yhwhe),
    #   (party_add_template, "p_main_party", "pt_mountain_bandits"),
    #   (party_add_template, "p_main_party", "pt_mountain_bandits"),
    #   (party_add_template, "p_main_party", "pt_mountain_bandits"),
    #   (party_add_template, "p_main_party", "pt_mountain_bandits"),
    #   (party_add_template, "p_main_party", "pt_mountain_bandits"),
    #   (party_add_template, "p_main_party", "pt_mountain_bandits"),
    #   (party_add_template, "p_main_party", "pt_mountain_bandits"),
    #   (party_add_template, "p_main_party", "pt_mountain_bandits"),
    #   (party_add_template, "p_main_party", "pt_mountain_bandits"),
    #   (party_add_template, "p_main_party", "pt_mountain_bandits"),
    #   (troop_add_gold, "trp_player", 100000),
    # ]),

    # ("options",[(ge, "$cheat_mode", 1)],"Cheat ALEXANDER.",
        # [
    # (troop_set_slot, "trp_player", slot_troop_renown, 800),
    # (troop_raise_skill,"trp_player", "skl_leadership", 10),
    # (troop_raise_skill,"trp_player", "skl_tactics", 10),
    # (troop_raise_skill,"trp_player", "skl_engineer", 10),
    # (troop_add_gold, "trp_player", 1000000),
    # (party_add_members, "p_main_party", "trp_phalanx", 500),
    # (party_add_members, "p_main_party", "trp_hoplit", 250),
    # (party_add_members, "p_main_party", "trp_hoplit_2", 250),
    # (party_add_members, "p_main_party", "trp_kreta_archer", 125),
    # (party_add_members, "p_main_party", "trp_slinger_rhodos", 250),
    # ]),

      # ("options",[],"Debug slot_center_pursue and slot_crucified_slave_icon",[
      #   (try_for_range, ":towns", centers_begin, centers_end),
      #     (party_get_slot, reg1, ":towns", slot_center_pursue),
      #     (party_get_slot, reg2, ":towns", slot_crucified_slave_icon),
      #     (str_store_party_name, s1, ":towns"),
      #     (try_begin),
      #       (neq, reg1, 0),
      #       (display_message, "@slot_center_pursue : {reg1} for {s1}"),
      #     (try_end),
      #     (try_begin),
      #       (neq, reg2, -1),
      #       (display_message, "@slot_crucified_slave_icon : {reg2} for {s1}"),
      #     (try_end),
      #   (try_end),
      # ]),

    ("options",[],"Randomly improve relation with Roman lords by 10 to 80 points.",[
      (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
        (neg|troop_slot_eq, ":npc", slot_troop_occupation, dplmc_slto_dead),#alive
        (troop_slot_eq, ":npc", slot_troop_culture, "fac_culture_7"),#Roman
        (store_random_in_range, ":r", 0, 20),
        (le, ":r", 5),
        (store_random_in_range, ":r", 10, 81),
        (call_script, "script_change_player_relation_with_troop", ":npc", ":r"),
      (try_end),
    ]),

    ("options",[
      (check_quest_active, "qst_freelancing")
    ],"Add 100 promotion points.",[
      (call_script, "script_freelancer_add_progress", 100),
    ]),

    ("options",[
      (check_quest_active, "qst_freelancing")
    ],"Remove 50 promotion points.",[
      (call_script, "script_freelancer_add_progress", -50),
    ]),

      # ("options",[ (ge, "$cheat_mode", 1),

      # ],"Display Info for troop upgrade exp.",
        # [
      # (try_for_range, ":troop", soldiers_begin, soldiers_end),
        # (str_store_troop_name, s2, ":troop"),
        # (call_script, "script_game_get_upgrade_xp", ":troop"),
        # (display_message, "@{s2}: {reg0} exp for upgrade"),
      # (try_end),
        # ]
      # ),
    ("options",[
      (ge, "$cheat_mode", 1)
    ],"Add 100 slaves.",[
      (party_force_add_prisoners, "p_main_party", "trp_slave", 100),
    ]),
    ("options",[
      (ge, "$cheat_mode", 1),
    ],"Add 10,000 influence.",[
      (call_script, "script_change_influence", "trp_player", 10000),
    ]),
    ("options",[
      (ge, "$cheat_mode", 1),
    ],"Add 50,000 denars.",[
      (troop_add_gold, "trp_player", 50000),
    ]),
    ("faction_debug", [
      (ge, "$cheat_mode", 1),(troop_slot_eq, "trp_global_variables", g_is_dev, 1),
    ],"Debug faction slots",[
      (assign, "$diplomacy_var"),
      (jump_to_menu, "mnu_display_faction_slots"),
    ]),
    ("continue",[],"Go back.",[
      (jump_to_menu, "mnu_camp"),
    ]),
]),

("player_attach",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Your service in {s20} starts.^^{s33}",
  "none",[
    (str_store_party_name, s20, "$g_encountered_party"),
    (str_clear, s33),
    (call_script, "script_start_freelancing", "$g_encountered_party"),
    (try_begin),
      (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_state, 1),
      (str_store_string, s33, "@After the quartermaster has given you the equipment, a centurio orders you to follow him. You and other recruits await the order of the centurio."),
    (try_end),
  ],[
    ("continue",[
      (neg|quest_slot_eq, "qst_freelancing", slot_quest_freelancer_state, 1),
    ],"Continue...",[
      (change_screen_map),
    ]),
    ("continue",[
      (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_state, 1),
    ],"Continue...",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 2),
      (modify_visitors_at_site,"scn_follower_camp"),
      (reset_visitors),
      (set_visitor, 42, "trp_centurio_west"),
      (set_visitor, 43, "trp_player"),
      (set_visitor, 44, "trp_superbus"),
      (set_visitor, 45, "trp_legio_i_adjutrix"),
      (set_visitor, 46, "trp_legio_i_adjutrix"),
      (assign, "$talk_context", tc_camp_training),
      (jump_to_scene, "scn_follower_camp"),
      (set_jump_mission,"mt_first_training"),
      (change_screen_mission),
    ]),
]),
("training",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You follow the centurio to a small training field. You and the recruit who has been punished before will have to train together."
  +" You receive the proper training equipment, then the centurio approaches.",
    "none",[
      (set_background_mesh, "mesh_pic_mb_warrior_2"),
    ],[
    ("continue",[],"Continue...",[
      (modify_visitors_at_site,"scn_training_ground"),
      (reset_visitors),
      (set_visitor,0,"trp_player"),
      (set_visitor,1,"trp_centurio_west"),
      (set_visitor,2,"trp_superbus"),

      (try_for_range, ":entries", 3, 34),
        (set_visitor,":entries","trp_legio_i_adjutrix"),
      (try_end),
      (assign, "$temp", 0),
      (assign, "$temp2", 0),
      (assign, "$talk_context", tc_camp_training_2),
      (jump_to_scene, "scn_training_ground"),
      (set_jump_mission,"mt_training_centurio"),
      (change_screen_mission),
    ]),
]),
("training_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "After the centurio leaves, you and your training partner continue to fight until nightfall. Exhausted, you march back to the camp.",
  "none",[
    (set_background_mesh, "mesh_pic_mb_warrior_2"),
  ],[
  ("continue",[],"Continue...",[
    (store_skill_level, ":throwing", "skl_power_throw", "trp_player"),
    # (lt, ":throwing", 3),
    (store_sub, ":addition", 3, ":throwing"),
    (try_begin),
      (ge, ":addition", 1),
      (troop_raise_skill, "trp_player","skl_power_throw", ":addition"),
    (try_end),
    (store_proficiency_level, ":throwing_prof","trp_player", wpt_throwing),
    (store_sub, ":addition", 100, ":throwing_prof"),
    (try_begin),
      (ge, ":addition", 1),
      (troop_raise_proficiency, "trp_player", wpt_throwing, ":addition"),
    (try_end),
    (store_proficiency_level, ":throwing_prof","trp_player", wpt_one_handed_weapon),
    (store_sub, ":addition", 100, ":throwing_prof"),
    (try_begin),
      (ge, ":addition", 1),
      (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, ":addition"),
    (try_end),
    (add_xp_as_reward, 2000),

    (call_script, "script_freelancer_add_progress", 15),
    (change_screen_map),
  ]),
]),
("freelancer_event_pret_1",0,
  "Grain riots^^{s15} has recieved a message, from Tigellinus, the praefectus urbi. He needs a detachment of soldiers in the capital. It seems some riots broke out because Nero used a fraction of the funds"
  +" for procurement of grain for the building of a new palace. Rumors say the state treasury is almost empty. Now the plebs are angry and Princeps Nero ordered to send the army to crush the riots.^^You are part of this detachment."
  +" You prepare yourself and soon the march to Rome starts.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (quest_get_slot, ":giver", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s15, ":giver"),
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_1_2"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 3),
    ]),
]),
("freelancer_event_pret_1_2",0,
  "You finally reach Rome with your detachment. The centuriones deploy their troops and the tribunus urbanae gives a short speech in which he explains the orders of Tigellinus:^^"
  +" 'Soldiers, Princeps Nero has ordered us to crush this revolt with violence. Our commander Tigellinus said we shall show no mercy, as the troublemakers doesn't deserve it."
  +"  If one of you may now say: This are Roman citizens, we can't kill them. Tigellinus and our Caesar said: They are traitors. Keep that in mind.'",
  "none",[
    (set_background_mesh, "mesh_pic_townriot"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"The clash can start",[
      (modify_visitors_at_site,"scn_town_riot_rome"),
      (reset_visitors),
      (set_visitors, 1, "trp_praetoriani_milites", 9),
      (set_visitors, 2, "trp_praetoriani_milites", 9),
      (set_visitors, 3, "trp_praetoriani_milites", 9),
      (set_visitors, 4, "trp_praetoriani_milites", 9),
      (set_visitor, 0, "trp_player"),
      (try_for_range, ":entry", 5, 20),
         (set_visitors, ":entry", "trp_slave", 5),
         (set_visitors, ":entry", "trp_roman_village_walker", 10),
         (set_visitors, ":entry", "trp_roman_town_walker_female", 2),
         (set_visitors, ":entry", "trp_roman_village_walker_female", 1),
      (try_end),
      (jump_to_scene, "scn_town_riot_rome"),
      (set_jump_mission,"mt_street_fight"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_1_vitory",0,
  "The riot is crushed by the praetorian guard. Some praetorians have been wounded but there has been no casualties. The troublemakers are either dead or seriously wounded. The street is colored red from their blood."
  +" You notice, that not all troops are happy about slaughtering Roman citizens. You hear ill-talk about Nero.^^After a short rest, your detachment marches back to meet the rest of the praetorian guard.",
  "none",[
    (set_background_mesh, "mesh_pic_townriot"),
    (try_begin),
      (eq, "$temp4", 1),
      (call_script, "script_freelancer_add_progress", 15),
    (else_try),
      (eq, "$temp4", -1),
      (call_script, "script_freelancer_add_progress", 7),
    (try_end),
  ],[
    ("continue",[],"Continue.",[
      (change_screen_map),
    ]),
]),
("freelancer_event_pret_2",0,
  "A meeting in Pandateria^^You are part of a small detachment which shall march to Rome. The praefectus urbi Tigellinus needs additional troops for a certain task Nero ordered. Before the detachment starts the march, {s22} meets the troops to explain the situation:^^"
  +"'Soldiers, in what will follow, you will find yourself in a situation in which you may hesitate. But do not hesitate, just act as ordered and don't think much about it.'",
  "none",[
    (set_background_mesh, "mesh_pic_villa_sea"),
    (quest_get_slot, ":giver", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s22, ":giver"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog

    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_2_2"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 4),
    ]),
]),

("freelancer_event_pret_2_2",0,
  "You thought you would march to Rome, but your journey continues. In Ostia the detachment enter a ship which brings it to the island of Pandateria, near the Italian coast.^^"
  + "On the island you receive your orders from a centurio: ^^'Soldiers, Octavia, the ex-wife of Nero, has committed crimes for which she must be punished. Princeps Nero ordered: She shall watch how her maids are tortured to death.'^^"
  + "The detachment marshes to her villa. There, the soldiers force Octavia and her maids to go into the garden.",
  "none",[
    (set_background_mesh, "mesh_pic_villa_sea"),
  ],[
    ("continue",[],"Continue...",[
      (modify_visitors_at_site,"scn_pandateria"),
      (reset_visitors),
      (set_jump_mission,"mt_pandateria"),

      (assign, "$temp", 0),
      (assign, "$temp1", 0),
      (assign, "$talk_context", tc_octavia_event_1),

      (set_visitor, 1, "trp_centurio_preatoriani"),
      (set_visitor, 2, "trp_praetoriani_milites"),
      (set_visitor, 3, "trp_praetoriani_milites"),
      (set_visitor, 4, "trp_praetoriani_milites"),
      (set_visitor, 5, "trp_praetoriani_milites"),
      (set_visitor, 0, "trp_player"),

      (set_visitor, 6, "trp_octavia"),

      (set_visitor, 7, "trp_slave_female"),
      (set_visitor, 8, "trp_slave_female"),
      (set_visitor, 9, "trp_slave_female"),
      (set_visitor, 10, "trp_slave_female"),
      (jump_to_scene, "scn_pandateria"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_2_end",0,
  "The Centurio forced Octavia to watch the brutal execution. As your bloody job is done, you hear her crying quietly. All are silent and nobody dare to say anything."
  +" The detachment leaves the villa without buring the dead. The last you remember is how Octavia kneels next to her dead servants and cries.^^The march back begins.",
  "none",[
    (set_background_mesh, "mesh_pic_woman"),
  ],[
    ("continue",[],"Continue...",[
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_freelancer_add_progress", 15),
      (change_screen_map),
    ]),
]),
("freelancer_event_pret_2_end2",0,
  "Since you refused to do the job yourself, the Centurio flogs the maids to death. You think you will never forget the excruciating screams of the dying women."
  +" As the bloody job is done, you hear Octavia crying quietly. All are silent and nobody tells a word."
  +" The detachment leaves the villa without buring the death. The last you remember is how Octavia kneels next to her dead servants and cries. After the other soldiers finish the mission you are punished.",
  "none",[
    (set_background_mesh, "mesh_pic_punishment_roman"),
  ],[
    ("continue",[],"Continue...",[
      (call_script, "script_change_player_honor", 10),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (change_screen_map),
    ]),
]),
("freelancer_event_pret_3",0,
  "Octavia's supporter^^Octavia is very popular among the population of Rome. Rumors of her banishment and the cruelties which have been committed against her maids spread through Rome and cause unrest."
  +" Her supporters carry statues of her through Rome decked with flowers and calling for her return. Nero wants to play the 'strong man' and ordered to crush the riot.^"
  +" {s22} is ordered to send a detachment of troops to Rome. You are part of this detachment.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (quest_get_slot, ":giver", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s22, ":giver"),

    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_3_2"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 5),
    ]),
]),
("freelancer_event_pret_3_2",0,
  "As you arrive in Rome you have to play the same game as before: The troops are deployed, the tribunus urbanae gives his speech and shortly later the rioters appear on the street.^^The clash can start.",
  "none",[
    (set_background_mesh, "mesh_pic_townriot"),
  ],[
    ("continue",[],"Here we go again...",[
      (modify_visitors_at_site,"scn_town_riot_rome"),
      (reset_visitors),

      (set_visitors, 1, "trp_praetoriani_milites", 9),
      (set_visitors, 2, "trp_praetoriani_milites", 9),
      (set_visitors, 3, "trp_praetoriani_milites", 9),
      (set_visitors, 4, "trp_praetoriani_milites", 9),
      (set_visitor, 0, "trp_player"),

      (try_for_range, ":entry", 5, 20),
         (set_visitors, ":entry", "trp_slave", 5),
         (set_visitors, ":entry", "trp_roman_village_walker", 10),
         (set_visitors, ":entry", "trp_roman_town_walker_female", 2),
         (set_visitors, ":entry", "trp_roman_village_walker_female", 1),
      (try_end),
      (jump_to_scene, "scn_town_riot_rome"),
      (set_jump_mission,"mt_street_fight"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_4",0,
  "A woman's head^^The riots continue and Nero sees himself in a dangerous position. His plans to crush the revolt have failed. People ask themselves why he is waging war against Romans instead of conquering barbarian lands."
  +" Nero seems to have only two solutions: remarry Octavia or murder her. Under the influence of Poppaea Sabina and Tigellinus, he finally decides for the latter.^^The praetorian guard shall do the job."
  +" You are selected to sail with a small detachment to the island Pandateria.",
  "none",[
    (set_background_mesh, "mesh_pic_villa_sea"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_4_2"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 6),
    ]),
]),
("freelancer_event_pret_4_2",0,
  "The plan is as follows: You shall force her to commit suicide. The people will think she voluntarily put an end to her life.^^As you reach Octavia's villa on Pandateria she is already awaiting you in the garden.",
  "none",[
    (set_background_mesh, "mesh_pic_villa_sea"),
  ],[
    ("continue",[],"Continue...",[
      (modify_visitors_at_site,"scn_pandateria"),
      (reset_visitors),
      (assign, "$temp", 0),
      (assign, "$temp1", 0),
      (assign, "$talk_context", tc_octavia_event_2),
      (set_visitor, 1, "trp_centurio_preatoriani"),
      (set_visitor, 2, "trp_praetoriani_milites"),
      (set_visitor, 3, "trp_praetoriani_milites"),
      (set_visitor, 4, "trp_praetoriani_milites"),
      (set_visitor, 5, "trp_praetoriani_milites"),
      (set_visitor, 7, "trp_praetoriani_milites"),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 6, "trp_octavia"),
      (jump_to_scene, "scn_pandateria"),
      (set_jump_mission,"mt_pandateria"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_death_of_octavia",0,
  "After her death, the Centurio cuts of her head from her shoulders. You, standing next to him, look surprised and shocked. The Centurio says:^'Poppaea Sabina wants her head, to make sure she's really dead.'^^"
  +" You travel back to your legate, while Octavia's head makes its way to the Imperial palace.",
  "none",[
    (set_background_mesh, "mesh_pic_woman"),
  ],[
    ("continue",[],"Continue...",[
      (call_script, "script_freelancer_add_progress", 15),
      (change_screen_map),
    ]),
]),
("freelancer_event_pret_5",0,
  "A play^^Nero wants to perform a musical play. The rehearsal will be performed with a detachment of Praetorians as audience. Unfortunately, you are part of this detachment. ^^Your march to Rome starts.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_5_2"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 7),
    ]),
]),
("freelancer_event_pret_5_2",0,
  "Before the performance of the Princeps starts, you receive your orders: Never fall asleep and never yawn. You shall make it appear as if you like the play."
  +"^^As Caesar starts his performance, you realize that this will be a hard task. In your whole life, you never saw and heard something more boring.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("continue",[]," Never fall asleep and never yawn... I try my best...",[
      (jump_to_menu, "mnu_freelancer_event_pret_5_3"),
    ]),
]),
("freelancer_event_pret_5_3",0,
  "{s23}",
  "none",[
    (store_random_in_range, "$temp4_1", 1, 3),
    (try_begin),
      (eq, "$temp4_1", 1),
      (str_store_string, s23, "@You tried your best but you yawned several times and after an hour you fall asleep. Princeps Nero is angry and orders to flog the ones who yawned or fell asleep. Like many others, you will be punished..."),
      (call_script, "script_freelancer_add_progress", -5),
      (set_background_mesh, "mesh_pic_punishment_roman"),
    (else_try),
      (eq, "$temp4_1", 2),
      (str_store_string, s23, "@You managed to stay awake. You yawned here and there but nobody noticed. As the performance is over you cheer and applause as loud as you can. Hopefully, this waste of time helps you in your progress towards promotion."),
      (call_script, "script_freelancer_add_progress", 15),
      (set_background_mesh, "mesh_pic_roma"),
    (try_end),
  ],[
    ("continue",[],"Continue",[
      (change_screen_map),
    ]),
]),
("freelancer_event_pret_6",0,
  "Knocking at Sulla's door^^While Nero was busy dealing with Octavia, Faustus Sulla Felix, a descendant of the Dictator Sulla has build up support among the Roman nobility."
  +"^Nero thinks he could become dangerous and ordered the praetorian guard to psychological terrorize him, maybe he commits suicide then.^^You are ordered to march to Rome with a detachment.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_6_2"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 8),
    ]),
]),
("freelancer_event_pret_6_2",0,
  "As you reach Rome you receive your orders: Stand guard in front of his house and talk about the various ways one could kill him. Your shift starts and you make your way towards Faustus' house."
  +"^^As you reach it, the soldiers from the previous shift are still there and talking. They seem to be a bit drunk.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("continue",[],"Continue...",[
      (assign, "$temp1", 0),
      (assign, "$talk_context", tc_pret_event_1),
      (modify_visitors_at_site,"scn_lucias_villa"),
      (reset_visitors),
      (set_visitor,7,"trp_player"), #player
      (set_visitor,8,"trp_praetoriani_milites_exp"),
      (set_visitor,9,"trp_quest_tiro"),

      (set_jump_mission,"mt_event_pret_talk"),
      (jump_to_scene, "scn_lucias_villa"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_terror_end",0,
  "Your shift starts and you have decided to {s11} However, {s23}",
  "none",[
    (call_script, "script_freelancer_add_progress", "$temp4"),
    (set_background_mesh, "mesh_pic_roma"),
    (try_begin),
      (eq, "$temp4_1", 1),
      (str_store_string, s11, "@help Faustus, who you should actually terrorize."),
      (str_store_string, s23, "@you will make no progress towards promotion. In fact, the higher rank officers are angry about your help. They even warn you: If Nero should get informed about your actions you may get crucified."),
      (call_script, "script_change_player_honor", 5),
    (else_try),
      (eq, "$temp4_1", 2),
      (str_store_string, s11, "@terrorize Faustus even more."),
      (str_store_string, s23, "@you will make more progress towards promotion. But your reputation suffers."),
      (call_script, "script_change_player_honor", -5),
    (else_try),
      (eq, "$temp4_1", 3),
      (str_store_string, s11, "@just stand guard."),
      (str_store_string, s23, "@you will make no progress towards promotion. But at least, nobody can claim that you didn't do your job properly."),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
			(change_screen_map),
    ]),
]),
("freelancer_event_pret_7",0,
  "A fire in Sulla's house^^Faustus Sulla Felix is still resisting the terror of the Praetorian guard. Nero is getting quite nervous. Faustus influence seems to raise.^Again you are part of a detachment that shall terrorize him. Again you march to Rome.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Here we go again.",[
      (jump_to_menu, "mnu_freelancer_event_pret_7_2"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 9),
    ]),
]),
("freelancer_event_pret_7_2",0,
  "After you reach Rome you have time for a short rest. Then your shift starts. You shall again stand guard in front of his house and talk about the various ways one could kill him."
  +"^^As you reach Faustus' house, the soldiers from the previous shift are still there and talking.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("continue",[],"Continue...",[
      (assign, "$temp1", 0),
      (assign, "$talk_context", tc_pret_event_2),
      (modify_visitors_at_site,"scn_lucias_villa"),
      (reset_visitors),
      (set_visitor,7,"trp_player"), #player
      (set_visitor,8,"trp_praetoriani_milites_exp"),
      (set_visitor,9,"trp_quest_tiro"),

      (set_jump_mission,"mt_event_pret_talk"),
      (jump_to_scene, "scn_lucias_villa"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_8",0,
  "Sulla's nightmare^^Faustus Sulla Felix still resists all attempts to terrorize him and he is still getting stronger. Nero is now nervous. He wants to see him dead soon. Now the Praetorians are following Faustus whereever he goes, and talk about how he could die."
  +"^Again you are part of a detachment that shall terrorize him. Again you march to Rome.",
    "none",
    [(set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_8_2"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 10),
    ]),
]),
("freelancer_event_pret_8_2",0,
  "Soon after you reach Rome your shift starts. You shall again stand guard in front of his house and talk about the various ways he could get murdered or die.^^You walk towards his house to replace the soldiers from the previous shift.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("continue",[],"Continue...",[
      (assign, "$temp1", 0),
      (assign, "$talk_context", tc_pret_event_3),
      (modify_visitors_at_site,"scn_lucias_villa"),
      (reset_visitors),
      (set_visitor,7,"trp_player"), #player
      (set_visitor,8,"trp_praetoriani_milites_exp"),
      (set_visitor,9,"trp_quest_tiro"),

      (set_jump_mission,"mt_event_pret_talk"),
      (jump_to_scene, "scn_lucias_villa"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_9",0,
  "Sulla's last stand^^Faustus Sulla Felix still has not committed suicide. Nero is losing his patience and orders his death. The plan is to poison him during a banquet."
  +" The plan is executed and fails. Not Faustus but his wife drunk the poisoned wine and she died shortly after.^^"
  +" Faustus is aware that he is in great danger and fled from Rome to his villa on the countryside. He also hired a band of mercenaries to defend it.^"
  +" Nero wants this episode to be finished and declares Faustus the murderer of his own wife!"
  +" Now the Praetorian guard is ordered to imprison him.^^You happen to find yourself part of a detachment marching to Rome.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_9_2"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 11),
    ]),
]),
("freelancer_event_pret_9_2",0,
  "Your detachment reaches Faustus villa. The verdict of his imprisonment is proclaimed and Faustus is told to surrender. But he refuses.^^The Praetorians prepare for an assault."
  +" Faustus has hired many mercenaries and it will be a harsh battle.^^The plan: Break the door and kill all who resist.",
  "none",[
    (set_background_mesh, "mesh_pic_villa_rustica"),
  ],[
    ("continue",[],"Continue...",[
      #0 player
      #1 pret
      #2 7 8 9 10 enemy inf
      #3 4 5 6 enemy archer
      (assign, "$talk_context", 0),#fix a possible bug
      (assign, "$temp", 0),
      (modify_visitors_at_site,"scn_faustus_villa"),
      (reset_visitors),
      (set_visitor,0,"trp_player"), #player
      (set_visitors,1,"trp_praetoriani_milites_exp", 90),
      (set_visitors,1,"trp_signifer", 1),
      (set_visitors,1,"trp_centurio_preatoriani", 1),
      (set_visitors,2,"trp_hired_blade", 25),
      (set_visitors,7,"trp_watchman", 25),
      (set_visitors,8,"trp_mercenary_swordsman", 20),
      (set_visitors,9,"trp_illyrian_infantry", 20),
      (set_visitors,10,"trp_hispanic_heavy_infantry", 20),
      (set_visitors,3,"trp_watchman", 5),
      (set_visitors,4,"trp_kreta_archer", 5),
      (set_visitors,5,"trp_meroe_archers", 5),
      (set_visitors,6,"trp_mercenary_crossbowman", 5),
      (set_jump_mission,"mt_faustus_last_battle"),
      (jump_to_scene, "scn_faustus_villa"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_9_lost",0,
  "Although you fall the Praetorians win the battle.^Faustus was killed during the combat. All Praetorians who participated in the assault receive 5,000 denars as gift."
  +"^^The job is done and your detachment marches back to meet the rest of the guard.",
  "none",[
    (set_background_mesh, "mesh_pic_battle_aftermath"),
  ],[
    ("continue",[],"Continue",[
      (troop_add_gold, "trp_player", 5000),
      (call_script, "script_change_troop_renown", "trp_player", 10),

      (val_div, "$temp", 2),
      (call_script, "script_freelancer_add_progress", "$temp"),
      (change_screen_map),
    ]),
]),
("freelancer_event_pret_9_vic",0,
  "Victory is yours! The Praetorians won the battle.^Faustus was killed during the combat. All Praetorians who participated in the assault receive 5,000 denars as gift."
  +"^Additional you managed to loot spoils worth 2,500 denars.^^The job is done and your detachment marches back to meet the rest of the guard.",
  "none",[
    (set_background_mesh, "mesh_pic_battle_aftermath"),
  ],[
    ("continue",[],"Continue",[
      (troop_add_gold, "trp_player", 7500),
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (call_script, "script_freelancer_add_progress", "$temp"),
      (change_screen_map),
    ]),
]),
("freelancer_event_pret_10",0,
  "Seneca^^Voices whisper of purges which are prepared by Nero under the influence of Tigellinus. Rumors become facts: Several small detachments of the Praetorian guard are send to Rome to help the praefectus urbi to accompolish this task."
  +"^You lead a detachment which shall force the philosopher Seneca to commit suicide.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue.",[
      (jump_to_menu, "mnu_freelancer_event_pret_10_1"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 12),
    ]),
]),
("freelancer_event_pret_10_1",0,
  "After a lengthy journey you reach Rome. Seneca lives in a villa near Rome.^^You receive detailed instructions from Nero himself on how to proceed:^"
  +" Seneca shall commit suicide without your help. You shall not kill him. You shall not fulfill him any last wish. His wife shall not die.^^"
  +" As you reach the villa, a slave tells you his master is awaiting you in a room.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("continue",[],"Continue.",[
      (assign, "$talk_context", 0),#fix a possible bug
      (assign, "$temp2", 0),
      (assign, "$temp1", 0),
      (modify_visitors_at_site,"scn_londinium_castle"),
      (reset_visitors),
      (set_visitor,0,"trp_player"), #player
      (set_visitor,1,"trp_seneca"), #seneca
      (set_visitor,2,"trp_paulina"), #Pompeia Paulina
      (set_visitor,3,"trp_praetoriani_milites_exp"), #Psoldiers
      (set_visitor,4,"trp_praetoriani_milites_exp"), #Psoldiers

      (jump_to_scene, "scn_londinium_castle"),
      (set_jump_mission, "mt_seneca_talk"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_10_final",0,
  "You march back to Rome. Your task is completed. Seneca is dead now. {s10} {s11}",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
    (assign, ":addition", 15),
    (str_store_string, s10, "@Nero is glad that Senecas wife, Pompeia Paulina, has survived although she tried to kill herself."),
    (try_begin),
       (eq, "$temp1", 2),
       (str_store_string, s10, "@Nero was not amused to find out that Senecas wife, Pompeia Paulina, has commited suicide too. You wasn't able to stop her."),
       (val_sub, ":addition", 15),
    (try_end),
    (str_store_string, s11, "@Nero is not amused to hear that Seneca has formulated his finally wish."),
    (try_begin),
       (eq, "$temp2", 1),
       (str_store_string, s11, "@Nero is glad that no final wish was granted to Seneca."),
       (val_add, ":addition", 10),
    (try_end),
    (call_script, "script_freelancer_add_progress", ":addition"),
  ],[
    ("continue",[],"Continue.",[
      (change_screen_map),
    ]),
]),

("freelancer_event_pret_11",0,
  "Expedition to the Nile^^The treasuries of the Empire are almost empty and Nero is looking for a new source of income."
  +" There are tales about a land south of the Nile: It is said this land has vast gold mines and other riches.^^"
  +" The Princeps heard this rumors and orders an expedition to gather intel for an invasion of this lands."
  +" The expedition shall travel along the Nile southwards. It will be a dangerous task."
  +" ^Unfortunately, you are selected to lead the expedition!",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue.",[
      (jump_to_menu, "mnu_freelancer_event_pret_11_1"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 13),
    ]),
]),
("freelancer_event_pret_11_1",0,
  "Together with a larger detachment you travel to Alexandria. From there you travel to Thebae. In Thebae you gather slaves and supply. The journey begins.^^"
  +" After a boring travel, your expedition finally leaves Roman territory. While the travel continues you start to write a detailed logbook.^^"
  +" You see enormous crocodiles lying on the shore. You see gigantic hippos. Soon you notice that your fleet is watched from the shore by warriors."
  +" They must belong to local tribes. As you land on the shore to build up a camp for the night, your forces are ambushed by warriors.^^"
  +" You have just enough time to grap your weapons as an arrow hits next to you the ground.",
  "none",[
    (set_background_mesh, "mesh_pic_nile"),
  ],[
    ("continue",[],"Soldiers, defend!",[
      (enable_party, "p_main_party"),
      (party_relocate_near_party, "p_main_party","p_town_20", 0),
      (disable_party, "p_main_party"),

      (troop_set_health, "trp_player", 100),
      (assign, "$temp4", 1),
      #0 player 1,2,3,4 pretorians, 5,6 archers 7,8 warriors
      (modify_visitors_at_site,"scn_nile_attack"),
      (reset_visitors),
      (set_visitor,0,"trp_player"), #player
      (set_visitors,1,"trp_praetoriani_milites_exp", 10),
      (set_visitors,2,"trp_praetoriani_milites_exp", 10),
      (set_visitors,3,"trp_praetoriani_milites_exp", 10),
      (set_visitors,4,"trp_praetoriani_milites_exp", 10),
      (set_visitors,5,"trp_meroe_archers", 10),
      (set_visitors,6,"trp_meroe_archers", 10),
      (set_visitors,7,"trp_meroe_infantry", 10),
      (set_visitors,8,"trp_meroe_axemen", 10),

      (jump_to_scene, "scn_nile_attack"),
      (set_jump_mission, "mt_nile_fight"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_11_2",0,
  "{s11}^^After the battle, the wounds of your troops are treated. One of your soldiers ask: 'Dominus, will we continue the journey or sail back?"
  +" The other men are getting nervous. They think this was an omen of the gods. We better should go back.'",
  "none",[
    (set_background_mesh, "mesh_pic_nile"),
    (try_begin),
      (eq, "$temp", 2),
      (str_store_string, s11, "str_defeated_enemy"),
    (else_try),
      (eq, "$temp", 1),
      (str_store_string, s11, "str_defeated_enemy_death"),
    (try_end),
  ],[
    ("continue",[],"Sail forward!",[
      (try_begin),
        (eq, "$temp4", 1),
        (jump_to_menu, "mnu_freelancer_event_pret_11_3"),
      (else_try),
        (eq, "$temp4", 2),
        (jump_to_menu, "mnu_freelancer_event_pret_11_4"),
      (else_try),
        (eq, "$temp4", 3),
        (jump_to_menu, "mnu_freelancer_event_pret_11_5"),
      (try_end),
    ]),
    ("continue",[],"I have enough. Sail back!",[
      (jump_to_menu, "mnu_freelancer_event_pret_11_end"),
    ]),
]),
("freelancer_event_pret_11_3",0,
  "Your exhausting journey continues. The heat is unbearable, nearly everyday you lose men due to crocodiles and hippos."
  +" To make it even worse, some of the slaves have caught diseases nobody knows.^^But somehow you enjoy this journey."
  +" The things you see are beautiful and impressive. You discover many plants and animals you never saw before, you also start to document the disease.^^"
  +" After a long travel you see a city in the distance. It must be Meroe. The relation between the Nubians and the Romans are not good, as the recent attack has shown."
  +" You decide to be careful and set up a camp."
  +" While building the camp you are attacked by a group of warriors!",
  "none",[
    (set_background_mesh, "mesh_pic_nile"),
  ],[
    ("continue",[],"Defend!",[
      (enable_party, "p_main_party"),
      (party_relocate_near_party, "p_main_party","p_town_20", 0),
      (disable_party, "p_main_party"),

      (troop_set_health, "trp_player", 100),
      (assign, "$temp4", 2),
      #0 player 1,2,3,4 pretorians, 5,6 archers 7,8 warriors
      (modify_visitors_at_site,"scn_nile_attack"),
      (reset_visitors),
      (set_visitor,0,"trp_player"), #player
      (set_visitors,1,"trp_praetoriani_milites_exp", 8),
      (set_visitors,2,"trp_praetoriani_milites_exp", 8),
      (set_visitors,3,"trp_praetoriani_milites_exp", 8),
      (set_visitors,4,"trp_praetoriani_milites_exp", 8),
      (set_visitors,5,"trp_meroe_archers", 5),
      (set_visitors,6,"trp_meroe_archers", 5),
      (set_visitors,7,"trp_meroe_infantry", 10),
      (set_visitors,8,"trp_meroe_axemen", 10),

      (jump_to_scene, "scn_nile_attack"),
      (set_jump_mission, "mt_nile_fight"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_11_4",0,
  "Your exhausting journey continues. At night you sneak past Meroe.^^"
  +" Everyday you are losing more and more men due to diseases, crocodiles, or other creatures."
  +" But still something forces you to continue. You are so curious and exited. Everyday brings new interesting things to discover...^^"
  +" After a long and exhausting journey you reach a gigantic marsh. It is not possible to continue with your boats, the water is not deep enough. You need to build lighter boats.^^"
  +" Your troops are exhausted and you setup camp. But soon, you are attacked by enemies. They seem to be warriors of Meroe and have followed you secretly until here.",
  "none",[
    (set_background_mesh, "mesh_pic_nile"),
  ],[
    ("continue",[],"Defend!",[
      (enable_party, "p_main_party"),
      (party_relocate_near_party, "p_main_party","p_town_20", 0),
      (disable_party, "p_main_party"),

      (assign, "$talk_context", 0),#fix a possible bug
      (troop_set_health, "trp_player", 100),
      (assign, "$temp4", 3),
      #0 player 1,2,3,4 pretorians, 5,6 archers 7,8 warriors
      (modify_visitors_at_site,"scn_lair_jungle"),
      (reset_visitors),
      (set_visitor,0,"trp_player"), #player
      (set_visitors,1,"trp_praetoriani_milites_exp", 9),
      (set_visitors,2,"trp_praetoriani_milites_exp", 5),
      (set_visitors,3,"trp_praetoriani_milites_exp", 5),
      # (set_visitors,4,"trp_praetoriani_milites_exp", 5),
      (set_visitors,5,"trp_meroe_archers", 4),
      (set_visitors,6,"trp_meroe_archers", 4),
      (set_visitors,7,"trp_meroe_infantry", 6),
      (set_visitors,8,"trp_meroe_axemen", 6),

      (jump_to_scene, "scn_lair_jungle"),
      (set_jump_mission, "mt_nile_fight"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_11_5",0,
  "The boats are build and the journey continues. The day passes but the march seems to be endless. Maybe this is the source of the Nile?"
  +" You notice that if you continue you will probably never find the way back. You give the order to return. After days of travelling you reach the Nile again."
  +" ^^You manage to sneak through Nubia without getting ambushed. After months you finally see Thebae in the distance! But the cost was high: Only a handful of your expedition is still alive.",
  "none",[
    (set_background_mesh, "mesh_pic_nile"),
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_11_end"),
    ]),
]),
("freelancer_event_pret_11_end",0,
  "After your return Nero seems to have forgotten that he even ordered to launch this expedition. You hand him over your detailed report but he just throw it way.^^At least, {s11} noticed your efforts.",
  "none",[
    (set_background_mesh, "mesh_pic_nile"),
    (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s11, ":lord"),
    (store_mul, ":addition", "$temp4", 10),
    (val_add, ":addition", 10),
    (call_script, "script_freelancer_add_progress", ":addition"),
    (call_script, "script_change_player_relation_with_troop", ":lord", 10),
    (store_mul, ":exp", "$temp4", 1000),
    (add_xp_as_reward, ":exp"),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_map),
    ]),
]),
("freelancer_event_pret_12",0,
  "Unlucky poet^^Lampoons are circulating in Greek and Latin. Fortuitously, Tigellinus found the composers. They belong to a minor Roman family. Tigellinus encourages Nero to slaughter the whole family, as a warning example.^^"
  +" Nero agrees and Tigellinus orders more troops to accomplish the task. You shall lead a detachment of Praetorians to finish the job.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_12_1"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 14),
    ]),
]),
("freelancer_event_pret_12_1",0,
  "They know they are in great danger and want to leave Rome as fast as possible. In their villa on the Palatine, they make the last preparations to leave the town.^ Unfortunately, you arrived at Rome faster than they expected. You march with your troops to the villa and break the door.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("continue",[],"Soldiers, attack!",[
      (modify_visitors_at_site,"scn_house_2"),
      (reset_visitors),
      (set_visitors,1,"trp_senator", 2),
      (set_visitors,2,"trp_guest_female", 2),
      (set_visitors,3,"trp_senator", 2),
      (set_visitors,4,"trp_guest_female", 4),
      (set_visitors,5,"trp_slave", 2),
      (set_visitors,9,"trp_slave_female", 2),
      (set_visitors,8,"trp_slave", 4),
      (set_visitor,6,"trp_player"),
      (set_visitors,7,"trp_praetoriani_milites_exp", 6),
      (jump_to_scene, "scn_house_2"),
      (set_jump_mission, "mt_pret_event_12"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_12_vic",0,
  "{s11}^^The job is done. You and your troops are rewarded with 2,000 denars.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
    (try_begin),
      (eq, "$temp", 1),
      (str_store_string, s11, "str_defeated_enemy_death"),
    (else_try),
      (eq, "$temp", 2),
      (str_store_string, s11, "str_defeated_enemy"),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (call_script, "script_freelancer_add_progress", 15),
      (troop_add_gold, "trp_player", 2000),
      (change_screen_map),
    ]),
]),
("freelancer_event_pret_13",0,
  "Unlucky debtors^^The treasury is in a horrible state. Neros debts with several families are high. To get rid of the issue, he claimed that on of his major debtors is a traitor and ordered to imprison him and his family."
  +" The idea is to frighten his other debtors to convince them to forgive him his debts.^^You are send with a detachment of soldiers to Rome.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue...",[
      (jump_to_menu, "mnu_freelancer_event_pret_13_1"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 15),
    ]),
]),
("freelancer_event_pret_13_1",0,
  "As you reach Rome you receive your orders: A family, living on the Aventine, shall get imprisoned as they are traitors.^^You lead your men to the villa and order them to use staffs to knock them down if they should refuse to surrender."
  +" You break the door and proclaim the verdict. But they refuse to surrender...",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("continue",[],"Soldiers, Knock them down!",[
      (modify_visitors_at_site,"scn_house_2"),
      (reset_visitors),
      (set_jump_mission, "mt_pret_event_12"),
      (set_visitors,1,"trp_senator", 2),
      (set_visitors,2,"trp_guest_female", 2),
      (set_visitors,3,"trp_senator", 2),
      (set_visitors,4,"trp_guest_female", 4),
      (set_visitors,5,"trp_slave", 2),
      (set_visitors,9,"trp_slave_female", 2),
      (set_visitors,8,"trp_slave", 4),

      (mission_tpl_entry_set_override_flags, "mt_pret_event_12",6, af_override_weapons|af_override_horse),
      (mission_tpl_entry_clear_override_items, "mt_pret_event_12", 6),
      (mission_tpl_entry_add_override_item, "mt_pret_event_12", 6, "itm_staff"),

      (set_visitor,6,"trp_player"),

      (mission_tpl_entry_set_override_flags, "mt_pret_event_12",7, af_override_weapons|af_override_horse),
      (mission_tpl_entry_clear_override_items, "mt_pret_event_12", 7),
      (mission_tpl_entry_add_override_item, "mt_pret_event_12", 7, "itm_staff"),

      (set_visitors,7,"trp_praetoriani_milites_exp", 6),

      (jump_to_scene, "scn_house_2"),

      (change_screen_mission),
  ]),
]),
("freelancer_event_pret_14",0,
  "Envious Augusta^^A small group of travelers approaches the camp. It turns out to be Poppaea Sabina. She wants to talk with {s11} best soldier. Of course, {s11} says you are the best one. You are called.^^She awaits you.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s11, ":lord"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Talk with her.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 16),
      (assign, "$temp4", 0),
      (assign, "$talk_context", tc_pret_event_14),
      (call_script, "script_get_meeting_scene"),
      (assign, ":meeting_scene", reg0),
      (set_jump_mission,"mt_conversation_encounter"),
      (modify_visitors_at_site,":meeting_scene"),
      (reset_visitors),

      (set_visitor,17,"trp_player"),

      (set_visitor,0,"trp_kingdom_7_lady_1"),

      (jump_to_scene,":meeting_scene"),
      #(assign, "$talk_context", tc_siege_commander),
      (change_screen_map_conversation, "trp_kingdom_7_lady_1"),
    ]),
]),
("freelancer_event_pret_14_1",0,
  "The party in your honor has begun. Poppaea Sabina already started to distract Nero. Now you need to find Invidia and talk with her.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("continue",[],"Continue...",[
      (assign, "$temp4", 0),
      (set_jump_mission,"mt_palace"),
      (modify_visitors_at_site,"scn_imperial_palace"),
      (assign, "$talk_context", tc_pret_event_14),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_palace", 0, af_override_horse|af_override_weapons|af_override_head),
      (set_visitor,0,"trp_player"),
      (set_visitor,2,"trp_guest"),
      (set_visitor,3,"trp_guest_female"),
      (set_visitor,4,"trp_guest"),
      (set_visitor,5,"trp_guest_female"),
      (set_visitor,6,"trp_guest"),
      (set_visitor,7,"trp_guest_female"),
      (set_visitor,8,"trp_guest"),
      (set_visitor,9,"trp_guest_female"),
      (set_visitor,10,"trp_guest_female"),

      (set_visitor, 15, "trp_invidia"),

      (set_visitor, 16, "trp_guest_female"),

      (set_visitor,20,"trp_praetoriani_milites"),
      (set_visitor,21,"trp_praetoriani_milites"),
      (set_visitor,22,"trp_praetoriani_milites"),
      (set_visitor,23,"trp_praetoriani_milites"),
      (set_visitor,24,"trp_praetoriani_milites"),
      (set_visitor,25,"trp_praetoriani_milites"),
      (set_visitor,26,"trp_praetoriani_milites"),
      (set_visitor,27,"trp_praetoriani_milites"),
      (set_visitor,28,"trp_praetoriani_milites"),
      (set_visitor,29,"trp_praetoriani_milites"),

      (set_visitor,30,"trp_tavern_minstrel_4"),
      (set_visitor,31,"trp_tavern_minstrel_3"),
      (set_visitor,32,"trp_slave"),
      (set_visitor,33,"trp_slave"),
      (set_visitor,34,"trp_slave"),

      (jump_to_scene, "scn_imperial_palace"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_14_end",0,
  "For a short time you can enjoy the party. Then Invidias dead body is discovered. People think she has committed suicide. Nero orders to conclude the feast.^^You travel back.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("continue",[],"Continue.",[
      (call_script, "script_freelancer_add_progress", 15),
      (change_screen_map),
    ]),
]),

("freelancer_event_pret_15",0,
  "Sporus^^{s11} orders you to his tent. As you approach he tells you, Poppaea Sabina wants the best Praetorian soldiers for a special mission."
  +" You are the best. You shall travel immediately to Rome and visit the Domus Agusuts, where she awaits you.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s11, ":lord"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Continue.",[
      (assign, "$temp4", 5),
      (jump_to_menu, "mnu_freelancer_event_pret_15_2"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 17),
    ]),
]),

("freelancer_event_pret_15_2",0,
  "{s1}",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
    (str_store_string, s1, "str_party_1"),
    (try_begin),
        (eq, "$temp4", 9),
        (str_store_string, s1, "str_party_2"),
    (try_end),
  ],[
    ("continue",[],"Continue.",[
      (set_jump_mission,"mt_palace"),
      (modify_visitors_at_site,"scn_imperial_palace"),
      (assign, "$talk_context", tc_pret_event_14),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_palace", 0, af_override_horse|af_override_weapons|af_override_head),
      (set_visitor,0,"trp_player"),
      (try_begin),
        (eq, "$temp4", 5),
        (set_visitor,2,"trp_sporus"),
      (try_end),
      (set_visitor,3,"trp_guest_female"),
      (set_visitor,4,"trp_guest"),
      (set_visitor,5,"trp_guest_female"),
      (set_visitor,6,"trp_guest"),
      (set_visitor,7,"trp_guest_female"),
      (set_visitor,8,"trp_guest"),
      (set_visitor,9,"trp_guest_female"),
      (set_visitor,10,"trp_guest_female"),

      (set_visitor, 15, "trp_kingdom_7_lady_1"),

      (set_visitor, 16, "trp_guest_female"),

      (set_visitor,20,"trp_praetoriani_milites"),
      (set_visitor,21,"trp_praetoriani_milites"),
      (set_visitor,22,"trp_praetoriani_milites"),
      (set_visitor,23,"trp_praetoriani_milites"),
      (set_visitor,24,"trp_praetoriani_milites"),
      (set_visitor,25,"trp_praetoriani_milites"),
      (set_visitor,26,"trp_praetoriani_milites"),
      (set_visitor,27,"trp_praetoriani_milites"),
      (set_visitor,28,"trp_praetoriani_milites"),
      (set_visitor,29,"trp_praetoriani_milites"),

      (set_visitor,30,"trp_tavern_minstrel_4"),
      (set_visitor,31,"trp_tavern_minstrel_3"),
      (set_visitor,32,"trp_slave"),
      (set_visitor,33,"trp_slave"),
      (set_visitor,34,"trp_slave"),
      (jump_to_scene, "scn_imperial_palace"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_pret_15_end",0,
  "You travel back.^^Soon you hear rumors about the events: The old merchant died shortly after he heard his lover Sporus was kidnapped."
  +" In his testament he wrote all his wealth shall go to the state. After the death of the merchant Poppaea Sabina released Sporus. By chance, "
  +" Nero met Sporus and thought he would be a nice addition to his palace...",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("continue",[],"Continue.",[
      (call_script, "script_freelancer_add_progress", 15),
      (change_screen_map),
    ]),
]),

("freelancer_event_1",0,
  "Soldier's dinner^^Finally you can take a break from your exhausting travels. The troops set up a marching camp. One group of soldiers dig the trenches to protect the camp,"
  +" one group of soldiers dig the wholes for the latrines and the rest of the soldiers setup camps or cook meals together with the follower women.^^"
  +" Since you are a new recruit, you are ordered to dig the latrines. After the work is done you sit together at a camp fire with two other soldiers and a follower woman.",
  "none",[
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("continue",[],"Continue...",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 3),

      (modify_visitors_at_site,"scn_follower_camp"),
      (reset_visitors),

      (party_get_num_companion_stacks, ":num_stacks", "$enlisted_party"),
      (assign, ":cur_entry", 1),
      (try_for_range, ":troop_iterator", 0, ":num_stacks"),
        (try_begin),
          (eq, ":cur_entry", 10),
          (assign, ":cur_entry", 17),
        (try_end),
        (party_stack_get_troop_id, ":cur_troop_id", "$enlisted_party", ":troop_iterator"),
        (neq, ":cur_troop_id", "trp_player"),
        (neg|troop_is_hero, ":cur_troop_id"),
        (try_begin),
          (gt, ":cur_entry", 40),
          (assign, ":num_stacks", -1), #break the loop
        (else_try),
          (party_stack_get_size, ":stack_size","$enlisted_party",":troop_iterator"),
          (party_stack_get_num_wounded, ":num_wounded","$enlisted_party",":troop_iterator"),
          (val_sub, ":stack_size", ":num_wounded"),
          (gt, ":stack_size", 0),
          (assign, ":counter", 1),
          (try_for_range, ":unused", 0, ":stack_size"), #nested loop ayy lmao
            (try_begin),
              (eq, ":cur_entry", 10),
              (assign, ":cur_entry", 17),
            (try_end),
            (try_begin),
              (this_or_next|ge, ":cur_entry", 40),
              (eq, ":counter", 10),
              (assign, ":stack_size", -1), #break the loop
            (else_try),
              (set_visitor, ":cur_entry", ":cur_troop_id"),
              (val_add, ":cur_entry", 1),
              (val_add, ":counter", 1),
            (try_end),
          (try_end),
        (try_end),
      (try_end),
      (set_visitor, 14, "trp_avaritia"),
      (set_visitor, 15, "trp_player"),
      (set_visitor, 16, "trp_superbus"),
      (set_visitor, 0, "trp_quest_miles"),
      (assign, "$talk_context", tc_freelancer_event_1),
      (assign, "$temp1", 0),
      (assign, "$temp2", 0),
      (jump_to_scene, "scn_follower_camp"),
      (set_jump_mission,"mt_event1_talk"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_1_wine",0,
  "Stolen wine^^Today was literally a shit-day. As you walked past the latrine someone pushed you into the pit full of excrements. You are still stinking awfully.^"
  +" To make the day even worse you hear, that the purse and the wine from the Centurio has been stolen. He said, he will punish the whole centuria if the person who stole it won't give it back.^^"
  +" Meanwhile you and a small group of soldiers are ordered to search for firewood. Somehow you got lost in the forest."
  +" While you are trying to find your group, you happen to see Avaritia and another person drinking wine and enjoying a meal...",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Investigate this...",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 4),
      # (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
      (modify_visitors_at_site,"scn_small_forest"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 1, "trp_superbus"),
      (set_visitor, 2, "trp_avaritia"),
      # (set_visitor, 0, "trp_quest_miles"),
      # (assign, "$talk_context", tc_freelancer_event_1),
      (assign, "$temp1", 0),
      # (assign, "$temp2", 0),
      (jump_to_scene, "scn_small_forest"),
      (assign, "$talk_context", tc_freelancer_event_2),
      (set_jump_mission,"mt_event3_talk"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_1_wine_vic",0,
  "After you have defeated them you treat their wounds and bring them back to the camp. You explain the situation to the centurio. He lauds you. Once Avaritia and Superbus are whipped fifty times, they are nailed to the cross."
  +" You take a last look at them. The Centurio, standing next to you, says: 'This happens to people who violate the law. Rome brings law and order.'",
  "none",[
    (set_background_mesh, "mesh_pic_kreuzigung"),
  ],[
    ("continue",[],"Continue...",[
      (add_xp_as_reward, 250),
      (call_script, "script_freelancer_add_progress", 15),
      (change_screen_map),
    ]),
]),
("freelancer_event_2",0,
  "Sleep^^One of the soldiers on guard fell asleep. You are the only one who has noticed it so far. If one of the Optios or centuriones notice, he will get punished. If you wake him up you could save him from punishment."
  +" On the other hand, if you tell the Centurio he fell asleep, you may make some progress towards promotion...",
  "none",[
    (set_background_mesh, "mesh_pic_mb_warrior_3"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Wake him up.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 6),

      (call_script, "script_change_player_honor", 1),
      (display_message, "@The soldier is happy about your help", color_good_news),
      (change_screen_map),
    ]),
    ("continue",[],"Tell it the centurio.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 6),

      (add_xp_as_reward, 150),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_freelancer_add_progress", 15),
      (str_store_string, s1, "@The Centurio lauds you for your sense of duty and order. The soldier gets punished with the stick for falling asleep during guard.^However, you feel guilty of betraying him."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
    ("continue",[],"Do nothing.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 6),

      (change_screen_map),
    ]),
]),
("freelancer_event_punishment",0,
  "{s1}",
  "none",[
    (set_background_mesh, "mesh_pic_punishment_roman"),
  ],[
    ("continue",[],"Continue...",[
      (change_screen_map),
    ]),
]),
("freelancer_event_1_2",0,
  "Later Avaritia informes you that the Centurio has heard from your fight and seems quite impressed that you stood up for your lad.",
  "none",[
  ],[
    ("continue",[],"Continue...",[
      (add_xp_as_reward, 150),
      (call_script, "script_freelancer_add_progress", 25),
      (change_screen_map),
    ]),
]),
("freelancer_event_3",0,
  "Night bandits^^During night, while you are currently on watch, you notice shadowy figures running out of the camp. You hear them talking and they seem to be quite in a hurry."
  +" Probably bandits have sneaked into the camp to steal supplies. Its your duty to stop them...",
  "none",[
    (set_background_mesh, "mesh_pic_bandits"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Try to stop them from escaping alone. (risky)",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 8),
      (jump_to_scene, "scn_bandit_camp"),
      (assign, "$talk_context", 0),#fix a possible bug
      (modify_visitors_at_site,"scn_bandit_camp"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      # (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
      # (troop_get_slot, ":legion", ":lord", slot_troop_legion),
      # (store_add, ":troop", ":legion", "trp_eastern_elite_infantry_vet"),
      # (set_visitors, 0, ":troop", 4),
      (set_visitor, 1, "trp_bandit"),
      (set_visitor, 2, "trp_looter"),
      (set_visitor, 3, "trp_bandit"),
      (set_visitor, 4, "trp_brigand"),
      (set_visitor, 5, "trp_bandit"),
      (set_visitor, 6, "trp_brigand"),
      (set_jump_mission,"mt_bandit_fight"),
      (change_screen_mission),
    ]),
    ("continue",[],"Give alarm and then chase them.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 8),
      (jump_to_scene, "scn_bandit_camp"),
      (modify_visitors_at_site,"scn_bandit_camp"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
      (troop_get_slot, ":legion", ":lord", slot_troop_legion),
      (store_add, ":troop", ":legion", "trp_eastern_elite_infantry_vet"),
      (set_visitors, 8, ":troop", 4),
      (set_visitor, 1, "trp_bandit"),
      (set_visitor, 2, "trp_looter"),
      (set_visitor, 3, "trp_bandit"),
      (set_visitor, 4, "trp_brigand"),
      (set_visitor, 5, "trp_bandit"),
      (set_visitor, 6, "trp_brigand"),
      (set_jump_mission,"mt_bandit_fight"),
      (change_screen_mission),
    ]),
    ("continue",[],"Do nothing and risk getting punished.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 8),
      (str_store_string, s1, "@On the next day, a large amount of supplies is missing. All soldiers who where on watch get punished, you included."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
]),
("freelancer_event_3_victory",0,
  "You have defeated the bandits and returned all the supplies they looted. {s1}, after he was informed about your deed, gifts you 1,000 denars. You made for sure a huge advance towards promotion.",
  "none",[
    (set_background_mesh, "mesh_pic_sally_out"),
    (party_stack_get_troop_id, ":lord", "$enlisted_party", 0),
    (str_store_troop_name, s1, ":lord"),
  ],[
    ("continue",[],"Continue.",[
      (call_script, "script_freelancer_add_progress", 35),
      (troop_add_gold, "trp_player", 1000),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (change_screen_map),
    ]),
]),
("freelancer_event_3_defeat",0,
  "You have been defeated by the bandits. The bandits can escape with the stolen supplies. You are responsible for the falure and are punished with the stick...",
  "none",[
    (set_background_mesh, "mesh_pic_punishment_roman"),
  ],[
    ("continue",[],"Continue.",[
      (change_screen_map),
    ]),
]),
("freelancer_event_4",0,
  "Drunkards^^After a long march you sit around a camp fire together with the other soldiers and some follower women."
  +" While you eat, you notice that some of the soldiers are drunk, although the centurio has forbidden to consume alcohol."
  +" You ask around and find out, that the drunk soldiers, while they were on a patrol, confiscated wine from a merchant."
  +" Such shameful abuses of office are the reason why most of the commoners hate soldiers...",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Tell it the Centurio. They have abused their position and brought shame onto Caesar!",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 9),
      (add_xp_as_reward, 50),
      (call_script, "script_change_troop_renown", "trp_player", 1),
      (str_store_string, s1, "@The centurio lauds you for your exemplary behavior. The soldiers get punished. They will now think twice before they will abuse their position again. On the other hand, nobody likes telltales and your relation with the other soldiers suffer..."),
      (call_script, "script_freelancer_add_progress", 30),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
    ("continue",[],"Ignore the situation.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 9),
      (change_screen_map),
    ]),
]),
("freelancer_event_5",0,
  "Goods for supply^^You and several other soldiers are ordered to confiscate a dozend cows from a local farmer as supplies for the legion. The farmer has a very beautiful daughter and seems to be quite rich."
  +" The men use the opportunity to take not only the cattle, but also his daughter and other goods. The farmer grabs an axe and is ready to attack the soldiers.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Order the soldiers to release the girl and the unlawfully taken goods. We only take the cattle not more!",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 11),
      (call_script, "script_change_troop_renown", "trp_player", 7),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_freelancer_add_progress", 10),
      (str_store_string, s1, "@The farmer and his daughter are glad and praise your name. What was unlawfully taken has been returned. After you come back to the marching camp, you punish the soldiers."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
    ("continue",[],"Order to punish the farmer for attacking representatives of the Princeps.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 11),
      (call_script, "script_change_player_honor", -2),
      (str_store_string, s1, "@The farmer is punished with his stick and the girl will now serve as follower woman."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
    ("continue",[],"Order not only to punish the farmer for attacking representatives of the Princeps but take also all his other goods and gold.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 11),
      (troop_add_gold, "trp_player", 2500),
      (call_script, "script_change_player_honor", -5),
      (str_store_string, s1, "@The farmer is punished with his stick and the girl will now serve as follower woman.^You loot the homestead of the farmer and find 2,500 denars."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
]),
("freelancer_event_5_1",0,
  "Weapon maintenance^^One of your duties is to check the equipment of your soldiers to ensure they maintain it properly. "+
  "^Some soldiers have neglected their weapons and their gladii got rusty. A proper punishment is required.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Whip them one hundred times! Such laziness needs a proper punishment.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 10),
      (call_script, "script_change_troop_renown", "trp_player", -1),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_freelancer_add_progress", -2),
      (str_store_string, s1, "@The first evildoer is brought in. You take your whip and strike. When you have reached one hundred strikes he collapses lifeless. He did not survive the punishment. Your superiors are angry because the punishment was too severe."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
    ("continue",[],"Whip them twenty times. That's enough.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 10),
      (call_script, "script_freelancer_add_progress", 5),
      (str_store_string, s1, "@You punish all soldiers who neglected their weapons. The punishment was proper."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
    ("continue",[],"Don't punish them at all.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 10),
      (call_script, "script_freelancer_add_progress", -5),
      (str_store_string, s1, "@As your superiors hear about it they order to punish you and your soldiers."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
]),
("freelancer_event_6",0,
  "Officer meeting^^As you want to deliver a report to your Centurio, you are informed that he is currently in a meeting with {s1} and other officers in the commander tent.^You walk towards the commanders tent.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
    (quest_get_slot, "$temp2", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s1, "$temp2"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Enter the tent.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 12),
      (modify_visitors_at_site,"scn_commander_camp"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 1, "$temp2"),
      (set_visitor, 2, "trp_centurio_west"),
      (set_visitor, 3, "trp_quest_primus_pilus"),
      (set_visitor, 4, "trp_quest_centurio_primus"),
      (assign, "$temp1", 0),
      (assign, "$talk_context", tc_freelancer_event_2),
      (set_jump_mission,"mt_event2_talk"),
      (jump_to_scene, "scn_commander_camp"),
      (change_screen_mission),
    ]),
    ("continue",[],"Wait outside...",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 12),
      (display_message, "@After the meeting is over you deliver the report."),
      (change_screen_map),
    ]),
]),
("freelancer_event_7",0,
  "Forced march^^After hours of marching the soldiers are exhausted and decide to make a break. Although {s1} insists on continuing the march they ignore his orders and threaten him with mutiny."
  +" Also his officers suggest that they have marched enough for today. But {s1} still insists to march on and is threatening them with decimation. But the soldiers stay stubborn and refuse to march on...",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (quest_get_slot, "$temp2", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s1, "$temp2"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Walk towards the aquilifer, tear out the aquila of his hands and RUN!",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 13),
      (jump_to_menu, "mnu_freelancer_event_7_reaction"),
    ]),
    ("continue",[],"A rest sounds fine...",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 13),
      (display_message, "@As {s1} doesn't want a mutiny he finally agrees to set up a camp..."),
      (change_screen_map),
    ]),
]),
("freelancer_event_7_reaction",0,
  "The aquilifer calls you a fool and starts chasing you. But you run faster than him. After a moment the other soldeirs realise that the aquiler is moving and start to follow you as they fear disgrace."
  +" Your plan works: The whole army is marching again.^^ {s1} catches up with you on his horse and lauds you for your bold plan. ^ As you reach your destination, you give the aquila back to the aquilifer.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
  ],[
    ("continue",[],"Continue",[
      (add_xp_as_reward, 150),
      (call_script, "script_freelancer_add_progress", 35),
      (call_script, "script_change_troop_renown", "trp_player", 2),
      (change_screen_map),
    ]),
]),
("freelancer_event_8",0,
  "Building roads^^Occasionally legionaries helped out building roads. Unfortunately, today is such a day. You are ordered to lead a detachment to help building a road. Luckily, as you have a officer rank, you must not do any hard work."
  +" But sitting around in the sun and watching the soldiers digging is incredible boring. After a while, a group of women from a nearby homestead approaches."
  +" They thank you and your soldiers for the hard work they are doing and  offer food, wine and company for free.^^If you accept the offer, you will probably not meet the deadline...",
  "none",[
    (set_background_mesh, "mesh_pic_road_building"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Accept the offer. The soldiers deserve it.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 14),
      (add_xp_as_reward, 50),
      (call_script, "script_freelancer_add_progress", -5),
      (call_script, "script_change_player_honor", 3),
      (str_store_string, s1, "@You didn't managed to meet the deadline, which will probably negatively impact your career. But your reputation increased."),
      (assign, "$temp", "mesh_pic_girls"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("continue",[],"Reject the offer. We have a strict deadline to finish the road.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 14),
      (add_xp_as_reward, 50),
      (call_script, "script_freelancer_add_progress", 5),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_change_troop_renown", "trp_player", 2),
      (str_store_string, s1, "@Everything went as planned: You made exactly the expected progress. On the other hand, your reputation suffer slightly."),
      (assign, "$temp", "mesh_pic_road_building"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("continue",[],"Reject the offer and use the whip more often to force the soldiers to work harder.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 14),
      (add_xp_as_reward, 50),
      (call_script, "script_freelancer_add_progress", 15),
      (call_script, "script_change_player_honor", -3),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (str_store_string, s1, "@Due to your harsh treatment you managed to make even more progress than expected. You are lauded for your good leadership. On the other hand, your reputation suffer."),
      (assign, "$temp", "mesh_pic_road_building"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("continue",[],"The soldiers must work, but I could need some company...",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 14),
      (call_script, "script_freelancer_add_progress", 5),
      (call_script, "script_change_troop_renown", "trp_player", 2),
      (add_xp_as_reward, 500),
      (troop_set_health, "trp_player", 100),
      (call_script, "script_change_player_honor", -6),
      (str_store_string, s1, "@Everything went as planned: You made exactly the expected progress. Additionally, you had a nice time with the girls... On the other hand, the soldiers were angry and your reputation suffers a lot."),
      (assign, "$temp", "mesh_pic_hexe_party"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("freelancer_event_8_reaction",0,
  "{s1}",
  "none",[
    (set_background_mesh, "$temp"),
  ],[
    ("continue",[],"Continue",[
      (change_screen_map),
    ]),
]),
("freelancer_event_9",0,
  "Raid^^Rumours are spreading about a bandit raid in a nearby homestead. Then you are informed that {s1} is awaiting you in his tent. You shall visit him immediately.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
    (quest_get_slot, "$temp2", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s1, "$temp2"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Go to the commanders tent.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 15),
      (modify_visitors_at_site,"scn_commander_camp"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 1, "$temp2"),
      (assign, "$temp1", 1),
      (assign, "$talk_context", tc_freelancer_event_4),
      (set_jump_mission,"mt_event2_talk"),
      (jump_to_scene, "scn_commander_camp"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_9_defeat",0,
  "After you have fallen, the remaining enmies defeat your troops. They think you are dead and finish their raid. After an hour you wake up with an incredible headache. ^^Alone you find the way back to the marching camp. {s1} is angry about your failure...",
  "none",[
    (set_background_mesh, "mesh_pic_escape_1"),
    (quest_get_slot, "$temp2", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s1, "$temp2"),
  ],[
    ("continue",[],"Continue.",[
      (call_script, "script_change_player_relation_with_troop", "$temp2", -5),
      (change_screen_map),
    ]),
]),
("freelancer_event_9_victory",0,
  "You manage to defeat the bandits and the deserters. ^{s22}^ You gather loot from the deserters and bandits worth 1,000 denars.^^When you reach the marching camp again, {s1} lauds you and you receive 2,000 denars.",
  "none",[
    (str_clear, s22),
    ##40 peasants
    (try_begin),
      (eq, "$temp1", 40),
      (str_store_string, s22, "@Unfortunately, all peasants died during the battle."),
    (else_try),
      (ge, "$temp1", 1),
      (store_sub, reg1, 40, "$temp1"),
      (str_store_string, s22, "@{reg1} of 40 peasants survived the battle."),
    (else_try),
      (eq, "$temp1", 0),
      (str_store_string, s22, "@All peasants survived the battle."),
    (try_end),
    (set_background_mesh, "mesh_pic_escape_1"),
    (quest_get_slot, "$temp2", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s1, "$temp2"),
  ],[
    ("continue",[],"Continue.",[
      (troop_add_gold, "trp_player", 3000),
      (assign, ":change", 5),
      (store_sub, ":addition", 40, "$temp1"),
      (val_add, ":change", ":addition"),
      (call_script, "script_change_troop_renown","trp_player", ":change"),
      (call_script, "script_freelancer_add_progress", ":change"),
      (call_script, "script_change_player_relation_with_troop", "$temp2", 5),
      (change_screen_map),
    ]),
]),
("freelancer_event_9_1",0,
  "You inspect your troops and make everything ready.^^After an hour of marching you see smoke in the distance."
  +" As you approach the farmstead you see most of its houses burning. You see Roman soldiers fighting with peasants equipment with tools and sticks."
  +" This must be the deserters. But you also see common bandits fighting with the inhabitants and the deserters."
  +" It seems that the raid of the deserters was interrupted by a group of bandits.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
    (troop_set_health, "trp_player", 100),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Attack now. Hopefully we can save some peasants.",[
      (assign, "$temp1", 0),
      (jump_to_scene, "scn_homestead_raid"),
      (modify_visitors_at_site,"scn_homestead_raid"),
      (reset_visitors),
      (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
      (troop_get_slot, ":legion", ":lord", slot_troop_legion),
      (store_add, ":troop", ":legion", "trp_eastern_elite_infantry_vet"),
      (set_visitors, 0, ":troop", 20),
      (set_visitors, 0, "trp_signifer", 1),
      (set_visitor, 0, "trp_player"),
      (set_visitors, 1, "trp_peasant_woman", 10),
      (set_visitors, 1, "trp_roman_village_walker", 10),
      (set_visitors, 1, "trp_slave", 10),
      (set_visitors, 1, "trp_slave_female", 10),
      (set_visitors, 3, "trp_looter", 20),
      (set_visitors, 3, "trp_bandit", 15),
      (set_visitors, 3, "trp_brigand", 10),
      (set_visitors, 2, ":troop", 10),
      (set_visitors, 2, "trp_vigilia", 10),
      (set_jump_mission, "mt_bandit_fight_farmestead"),
      (change_screen_mission),
    ]),
    ("continue",[],"Wait till the fight is over and then attack the survivors.",[
      (assign, "$temp1", 40),
      (jump_to_scene, "scn_homestead_raid"),
      (modify_visitors_at_site,"scn_homestead_raid"),
      (reset_visitors),
      (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
      (troop_get_slot, ":legion", ":lord", slot_troop_legion),
      (store_add, ":troop", ":legion", "trp_eastern_elite_infantry_vet"),
      (set_visitors, 0, ":troop", 20),
      (set_visitors, 0, "trp_signifer", 1),
      (set_visitor, 0, "trp_player"),
      (display_message, "@The deserters have defeated the bandits and killed all inhabitants. But only few survived."),
      (display_message, "@You will have an easy time killing them."),
      (set_visitors, 2, ":troop", 5),
      (set_visitors, 2, "trp_vigilia", 2),
      (set_jump_mission, "mt_bandit_fight_farmestead"),
      (change_screen_mission),
    ]),
]),
("freelancer_event_10",0,
  "Trouble^^You are currently urinating as someone pushes you from behind. Unfortunately you stumble and fall into the latrine.^^As you climb out of the hole, the troublemaker is standing there and laughing about you.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
    (quest_get_slot, "$temp2", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s1, "$temp2"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"I'll show that bastard a lesson...",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 7),
      (jump_to_menu, "mnu_duel_2"),
    ]),
    ("continue",[],"Temperance is a virtue.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 7),
      (call_script, "script_freelancer_add_progress", 5),
      (change_screen_map),
    ]),
]),
("freelancer_event_10_defeat",0,
  "With a heavy blow you are knocked down. ^^The other soldiers cheer and celebrate the victory of your opponent.",
  "none",[
  ],[
    ("continue",[],"Continue...",[
      (change_screen_map),
    ]),
]),
("freelancer_event_10_victory",0,
  "With a heavy blow you knock down your opponent. He lies on the ground with broken ribs and a bleeding nose.^The other soldiers cheer and celebrate your victory.^^You walk towards him, grab him by his head and shout:^^"
  +" 'Silence!'^^"
  +" All fall silent. You continue:^^"
  +" 'See soldiers, what happens with those, who, out of sheer boredom and stupidity, disturb the peace by bullying others."
  +" You will get punished. Rome punishes those who disturb peace. Rome brings order and peace!'",
  "none",[
  ],[
    ("continue",[],"Continue...",[
      (add_xp_as_reward, 150),
      (call_script, "script_freelancer_add_progress", 10),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (change_screen_map),
    ]),
]),
("freelancer_event_11",0,
  "Risk of mutiny^^Due to payment difficulties and supply problems the troops are restless and there is danger of mutiny.^^To resolve the issue, {s31} seeks advice from his high-rank officers.^^You can make suggestions too.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (quest_get_slot, "$temp2", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s31, "$temp2"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Suggest decimation: This harsh treatment will guarantee discipline.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 17),
      (add_xp_as_reward, 150),
      (call_script,"script_change_player_relation_with_troop", "$temp2", 2),
      (call_script, "script_change_troop_renown", "trp_player", 2),
      (call_script, "script_freelancer_add_progress", 5),
      (str_store_string, s1, "@{s31} finds your idea quite interesting. But he don't want to lose men and he also fears, that such an action could be the trigger for a mutiny.^^He decides to systematically punish the troublemakers and finally discipline is restored."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
    ("continue",[],"Suggest to search for the main troublemaker and punish them.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 17),
      (add_xp_as_reward, 150),
      (call_script,"script_change_player_relation_with_troop", "$temp2", 4),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_freelancer_add_progress", 15),
      (str_store_string, s1, "@{s31} likes your idea. He orders to act as you suggested: The main troublemakers are systematically punished which finally restores discipline."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
    ("continue",[],"Suggest to pay some women from nearby villages to entertain the troops.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 17),
      (add_xp_as_reward, 150),
      (str_store_string, s1, "@After you made your suggestion {s31} laughs and says, you only suggested that to get the most prettiest woman for yourself. ^^To resolve the issue, {s31} decides to systematically punish the troublemakers and finally discipline is restored."),
      (jump_to_menu, "mnu_freelancer_event_punishment"),
    ]),
    ("continue",[],"Make no suggestion.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 17),
      (display_message, "@{s31} decides to systematically punish the troublemakers and finally discipline is restored."),
      (change_screen_map),
    ]),
]),
("freelancer_event_12",0,
  "Ritues^^By chance you become witness of a very disturbing event. A group of soldiers is gang-raping one of the new recruits in a tent...",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
    (quest_get_slot, "$temp2", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s31, "$temp2"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Intervene immediately.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 19),
      (jump_to_menu, "mnu_freelancer_event_12_1"),
    ]),
    ("continue",[],"Ingore it and do nothing.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 19),
      (change_screen_map),
    ]),
]),
("freelancer_event_12_1",0,
  "You stop this nonsens immediately. Then you start interrogations of all involved soldiers. It seems, that what they did is some kind of initiation rite of the Centuria they belong to. "
  +"Every new recruit has to undergo this ritual to be accepted as new mate. "
  +"You also discovered, that the Centurio of this Centuria and his Optios were aware of this situation. When asked about this, the Centurio tells you he thinks this is a good way "
  +"to integrate the new soldiers into the unit.",
  "none",[
    (set_background_mesh, "mesh_pic_centurio"),
    (quest_get_slot, "$temp2", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s31, "$temp2"),
    (call_script, "script_get_current_rank_to_s21"),
  ],[
    ("continue",[],"As {s21}, I will not tolerate such barbaric rituals!",[
      (jump_to_menu, "mnu_freelancer_event_12_2"),
    ]),
    ("continue",[],"Well, whatever.",[
      (change_screen_map),
    ]),
]),
("freelancer_event_12_2",0,
  "{s33}",
  "none",[
    (str_clear, s33),
    (try_begin),
      (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_treatment, 1),
      (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
      (str_store_troop_name, s31, ":lord"),
      (str_store_string, s33, "@You order the whole centuria to show up. Then you climb on a box and start a talk^^In a rousing speech you tell the soldiers, how they have brought"
      +" shame on themselves, on {s31}, on the Princeps and, finally, shame on Rome. You would have expected such behavior from smelly Barbarians but not Romans!^"
      +" During your speech, you name some soldiers directly by their names and look into their eyes."
      +" All is silent, only you speek and nobody dares to interrupt you. You can see how some of them start to cry.^^"
      +" After you finished you order to punish the whole Centuria, even the Centurio. ^As {s31} hears about those events, he is quite surprised and lauds you for your good speech."),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_player_relation_with_troop", ":lord", 3),
      (call_script, "script_freelancer_add_progress", 15),
      (add_xp_as_reward, 150),
    (else_try),
      (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_treatment, -1),
      (str_store_string, s33, "@You order the whole centuria to show up. In a short speech you tell them how barbaric and stupid they acted and how they brought shame on themselves.^^"
      +" After your finished you order to punish the whole Centuria, even the Centurio."),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_change_troop_renown", "trp_player", 3),
      (call_script, "script_freelancer_add_progress", 7),
      (add_xp_as_reward, 50),
    (try_end),
  ],[
    ("continue",[],"I hope they have learned something...",[
      (change_screen_map),
    ]),
]),
("freelancer_event_13",0,
  "{s11}",
  "none",[
    (str_clear, s33),
    (set_background_mesh, "mesh_pic_centurio"),
    (try_begin),
      (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_treatment, 1),
      (str_store_string, s11, "@You strive to remember each soldier's name and to act with fairness in every decision."
      + " Your dedication has borne fruit: the soldiers hold you in higher regard than any other officer."
      + " When a soldier meets you, he bows—not out of obligation to your rank, but"
      + " out of genuine respect for you. As you walk past, the soldiers greet you warmly."
      + " They call you fair and a true Roman."),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (call_script, "script_change_player_honor", 4),
      (call_script, "script_freelancer_add_progress", 15),
      (add_xp_as_reward, 150),
    (else_try),
      (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_treatment, -1),
      (str_store_string, s11,"@You treat your soldiers no differently than any other officer. You don't invest much care in them, knowing well"
      + " they are likely to die soon anyway. You perform your duties as expected."
      + " The soldiers respect you and bow before you, but not out of admiration or loyalty."
      + " They do so purely out of fear of your whip."
),
      (call_script, "script_freelancer_add_progress", 3),
      (add_xp_as_reward, 50),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 16),
      (change_screen_map),
    ]),
]),

("freelancer_event_marsh",0,
  "Roma invicta!^^While marching, the Centurio starts to sing: 'Roma Roma oh Roma!'^"
  +"And a group of soldiers join in: 'Roma Roma oh Roma!'^"
  +"Another group sings: Legio! Aeterna! Aeterna! Victrix!^^...",
  "none",
  [
    (play_track, "track_legio_aeterna", 1),
    (set_background_mesh, "mesh_pic_legion_march"),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
    (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
    (assign, "$g_encountered_party_faction", "fac_kingdom_7"),#to fix bug in dialog
    (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
    (assign, "$talk_context", 0),#to fix bug in dialog
  ],[
    ("continue",[],"Legio! Aeterna! Aeterna! Victrix!",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 5),
      (assign, reg50, 1),
      (set_jump_mission,"mt_legion_marsh"),
      (modify_visitors_at_site,"scn_marsh_with_the_legion"),
      (reset_visitors),
      (jump_to_scene, "scn_marsh_with_the_legion"),
      (set_jump_entry, 0),
      (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
      (troop_get_slot, ":legion", ":lord", slot_troop_legion),
      (store_add, "$temp", ":legion", "trp_eastern_elite_infantry_vet"),
      (store_add, "$temp2", ":legion", "trp_praetoriani_milites"),#aquila
      (store_add, "$temp3", ":legion", "trp_aquilifer_praetoriani"),#vexilum
      (assign, "$temp1", "trp_centurio_west"),
      (try_begin),
          (eq, ":legion", 12),
          (assign, "$temp1", "trp_centurio_preatoriani"),
      (try_end),
      (change_screen_mission),
    ]),
]),
("freelancer_event_14",0,
  "Omens^^The soldiers are restless. A series of bad omens have caused them to believe that the gods are angry and soon an inevitable evil will struck the legion."
  +" The morale of the troops is low and discipline suffers. If nothing is done, some will probably desert.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
  ],[
    ("continue",[],"I should do something. I will make a sacrifice.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 18),
      (jump_to_menu, "mnu_freelancer_event_14_reaction"),
    ]),
    ("continue",[],"There is nothing to be done if the gods are angry.",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 18),
      (display_message, "@No evil struck the legion, but still some soldiers desert as they think the legion is doomed.", color_bad_news),
      (change_screen_map),
    ]),
]),
("freelancer_event_14_reaction",0,
  "You gather as many soldiers as possible and tell them you will perform a sacrific in your tent. You go into your tent and perform the sacrific.^^{s1}",
  "none",[
    (store_random_in_range, "$temp", 0, 10),
    (try_begin),
      (le, "$temp", 4),
      (str_store_string, s1, "@The sacrific was a success!"),
      (assign, "$temp2", 1),
    (else_try),
      (str_store_string, s1, "@The sacrific was a failure!"),
      (assign, "$temp2", 2),
    (try_end),
    (quest_get_slot, "$temp3", "qst_freelancing", slot_quest_giver_troop),
  ],[
    ("continue",[(eq, "$temp2", 1),],"Very good!",[
      (call_script,"script_change_player_relation_with_troop", "$temp3", 4),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_freelancer_add_progress", 15),
      (str_store_troop_name, s31, "$temp3"),
      (display_message, "@The troops are happy about the outcome. No evil will destroy them. {s31} is too satisfied, discipline is restored."),
      (change_screen_map),
    ]),
    ("continue",[(eq, "$temp2", 2),],"Damn it. I'll have to tell them that the gods are still angry.",[
      (call_script,"script_change_player_relation_with_troop", "$temp3", -2),
      (call_script, "script_change_troop_renown", "trp_player", -5),
      (str_store_troop_name, s31, "$temp3"),
      (display_message, "@The troops are now in even greater fear. {s31} is too angry."),
      (change_screen_map),
    ]),
    ("continue",[(eq, "$temp2", 2),],"I will tell them, that the sacrific was a success... they didn't saw it at all.",[
      (add_xp_as_reward, 150),
      (call_script,"script_change_player_relation_with_troop", "$temp3", 4),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_freelancer_add_progress", 10),
      (str_store_troop_name, s31, "$temp3"),
      (display_message, "@The troops are happy about the outcome. No evil will destroy them. {s31} is too satisfied, discipline is restored."),
      (change_screen_map),
    ]),
]),
("freelancer_event_0",0,
  "Campfire song^^While sitting at the camp fire, a soldier starts to sing with a deep and sad voice. Soon the others join in:^^"+
  "'Hardship times for legionary, one two three! Fate harasses him like cholera, one two three! To work much and eat little, march as ordered, one two, one two three!' ^^"+
  "'Friend-pilum overcomes the hand, one two three! Scutum hits the knee, one two three! And at belt a gladius and your pack with private things, one two, one two three!' ^^"+
  "'Before there were better times, one two three! Because you could eat what you like, one two three! Before such times will arrive again, you will fall die long ago, one two, one two three!'^^"+
  "'Centuriones wake up early, one two three! Legionaries can't wake up later, one two three! Just you could wear your armor! Go to training field, brother! One two, one two three!'",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
  ],[
    ("continue",[],"Continue...",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_state, 20),
      (call_script, "script_freelancer_add_progress", 5),
      (change_screen_map),
    ]),
]),

("freelancing_battle_event",0,
  "{s46}.",
  "none",[
    (assign, "$temp1", -1),
    (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
    (str_store_troop_name, s47, ":lord"),
    (try_begin),
      (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_kill, 15),
      (str_store_string, s46, "@{s47} recognized your noble deeds in battle and gifts you 2,000 denars.^^You have shown real Roman values: virtue and courage in battle."),
      (troop_add_gold, "trp_player", 2000),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script,"script_change_player_relation_with_troop", ":lord", 2),
    (else_try),
      (is_between, "$g_enemy_party", towns_begin, castles_end),
      (store_random_in_range, ":r", 0, 2),
      (str_store_party_name, s48, "$g_enemy_party"),
      (try_begin),
        (eq, ":r", 0),
        (str_store_string, s46, "@After {s48} has fallen, the men start to pillage the place. Although {s47} has forbidden to loot.^^The men roam through the streets. You see children getting killed, women getting raped, houses are set on fire ..."),
        (assign, "$temp1", 1),
      (else_try),
        (str_store_string, s46, "@After {s48} has fallen, {s47} allows to loot and pillage the place. The men roam freely through the streets. You see children getting killed, women getting raped, houses are set on fire ... business as usual."),
        (assign, "$temp1", 0),
      (try_end),
    (else_try),
      (store_random_in_range, reg46, 100, 500),
      (str_store_string, s46, "@After battle, the loot is shared among the soldiers. You managed to get {reg46} denars."),
      (troop_add_gold, "trp_player", reg46),
      (call_script, "script_change_troop_renown", "trp_player", 2),
    (try_end),
    (set_background_mesh, "mesh_pic_victory"),
  ],[
    ("continue",[(eq, "$temp1", -1),],"Continue.",[
      (jump_to_menu, "$temp4_1"),
    ]),
    ("continue",[(eq, "$temp1", 1),],"Try to stop them.",[
      (add_xp_as_reward, 150),
      (display_message, "@You try your best to stop the soldiers, but without success. At least, {s47} recognizes your efforts."),
      (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
      (call_script,"script_change_player_relation_with_troop", ":lord", 2),
      (call_script, "script_change_player_honor", 1),
      (jump_to_menu, "$temp4_1"),
    ]),
    ("continue",[(neq, "$temp1", -1),],"Loot and pillage too.",[
      (add_xp_as_reward, 150),
      (store_random_in_range, reg46, 500, 2000),
      (troop_add_gold, "trp_player", reg46),
      (call_script, "script_change_player_honor", -2),
      (call_script, "script_change_troop_renown", "trp_player", 3),
      (display_message, "@You managed to get {reg46} denars."),
      (jump_to_menu, "$temp4_1"),
    ]),
    ("continue",[(neq, "$temp1", -1),],"Do nothing.",[
      (jump_to_menu, "$temp4_1"),
    ]),
]),
("matters_of_life",0,
  "{s46}",
  "none",[
    (try_begin),
      (troop_slot_eq, "trp_player", slot_player_battle_event, 1),
      (str_store_string, s46, "@After the battle, a somber elegy envelops you. Amidst the silent expanse of the battlefield, you traverse, bearing witness to the fallen warriors, their bodies a testament to the harsh toll of war. Death, a familiar companion, now looms larger than ever before, casting a shadow over your existence. In this moment, life's purpose feels fleeting and insubstantial. What if the next skirmish claims your life? Will your deeds be etched into the annals of memory, or shall you fade into oblivion like the countless souls who met their demise this day?"),
    (else_try),
      (troop_slot_eq, "trp_player", slot_player_battle_event, 2),
      (str_store_string, s46, "@After the battle's fury wanes, you roam the desolate field, bearing witness to the fallen strewn across the earth. The weight of taking lives now burdens your soul, a grim reminder of the path fate has laid before you. Amidst the carnage, empathy for the fallen stirs within, yet questions gnaw at your conscience. Are you culpable for the perilous state of the world, where even the privileged must face the specter of death? The uncertainty of existence lingers, yet amidst it all, a steadfast conviction emerges: the certainty that your own mortality remains distant, for now."),
    (try_end),
    (set_background_mesh, "mesh_pic_battle_aftermath"),
  ],[
    ("continue",[],"Continue...",[
      (add_xp_as_reward, 150),
      (jump_to_menu, "$temp4_1"),
    ]),
]),

("world_map_soldier",menu_text_color(0xFF000000)|mnf_enable_hot_keys,
  "What do you want, soldier?",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
    (assign, "$g_encountered_party", "$enlisted_party"),
    (assign, "$g_encountered_party_type", spt_kingdom_hero_party),
  ],[
    ("enter_town",[
      (party_get_battle_opponent, ":commander_opponent", "$enlisted_party"),
      (lt, ":commander_opponent", 0),
      (party_get_attached_to, ":town", "$enlisted_party"),
      (is_between, ":town", centers_begin, centers_end),
    ],"Enter stationed town.",[
      (party_get_attached_to, ":town", "$enlisted_party"),
      (is_between, ":town", centers_begin, centers_end),
      (start_encounter, ":town"),
      (change_screen_map),
    ]),
    ("commander",[
      (party_get_battle_opponent, ":commander_opponent", "$enlisted_party"),
      (lt, ":commander_opponent", 0),
    ],"Request audience with your commander.",
    [
      (jump_to_menu, "mnu_commander_aud"),
    ]),
    ("commander",[
      (party_get_battle_opponent, ":commander_opponent", "$enlisted_party"),
      (lt, ":commander_opponent", 0),
      (store_party_size, ":size", "$enlisted_party"),
      (ge, ":size", 20),
    ],"Talk with the Immune responsible for treating wounds.",[
      (assign, "$talk_context", 0),#fix a possible bug
      (try_begin),
          (party_get_current_terrain, ":terrain", "p_main_party"),
          (this_or_next|eq, ":terrain", rt_desert),
          (eq, ":terrain", rt_desert_forest),
          (assign, ":scene", "scn_follower_camp_desert"),
      (else_try),
          (assign, ":scene", "scn_follower_camp"),
      (try_end),
      (set_jump_mission,"mt_conversation_encounter"),
      (modify_visitors_at_site,":scene"),
      (reset_visitors),
      (set_visitor,15,"trp_player"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_encounter",0, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_conversation_encounter", 0),
      (mission_tpl_entry_add_override_item, "mt_conversation_encounter", 0, "itm_legion_segmentata_1"),
      (set_visitor,0,"trp_healer_2"),

      (jump_to_scene,":scene"),
      #(assign, "$talk_context", tc_siege_commander),
      (change_screen_map_conversation, "trp_healer_2")
    ]),
    ("commander",[
      (party_get_battle_opponent, ":commander_opponent", "$enlisted_party"),
      (lt, ":commander_opponent", 0),
      (store_party_size, ":size", "$enlisted_party"),
      (ge, ":size", 20),
    ],"Talk with the Immune responsible for weapon maintaince.",[
      (assign, "$talk_context", 0),#fix a possible bug
      (try_begin),
          (party_get_current_terrain, ":terrain", "p_main_party"),
          (this_or_next|eq, ":terrain", rt_desert),
          (eq, ":terrain", rt_desert_forest),
          (assign, ":scene", "scn_follower_camp_desert"),
      (else_try),
          (assign, ":scene", "scn_follower_camp"),
      (try_end),
      (set_jump_mission,"mt_conversation_encounter"),
      (modify_visitors_at_site,":scene"),
      (reset_visitors),
      (set_visitor,15,"trp_player"),
      (mission_tpl_entry_set_override_flags, "mt_conversation_encounter",0, af_override_all),
      (mission_tpl_entry_clear_override_items, "mt_conversation_encounter", 0),
      (mission_tpl_entry_add_override_item, "mt_conversation_encounter", 0, "itm_legion_segmentata_1"),
      (set_visitor,0,"trp_smith_master"),
      (jump_to_scene,":scene"),
      #(assign, "$talk_context", tc_siege_commander),
      (change_screen_map_conversation, "trp_smith_master")
    ]),
	  ("join_wounded",[
      (neg|party_slot_eq, "$enlisted_party", slot_party_on_water, 1),#not on water
      (party_get_battle_opponent, ":commander_opponent", "$enlisted_party"),
      (lt, ":commander_opponent", 0),
      (party_get_attached_to, ":town", "$enlisted_party"),
      (neg|is_between, ":town", centers_begin, centers_end),#not in town
	  ],"Visit the marching camp.",[
      #1-9 guards
      #10-16 static people
      #17-40 walking people
      (set_jump_mission,"mt_marshing_camp"),
      (try_begin),
          (party_get_current_terrain, ":terrain", "p_main_party"),
          (this_or_next|eq, ":terrain", rt_desert),
          (eq, ":terrain", rt_desert_forest),
          (assign, ":scene", "scn_follower_camp_desert"),
      (else_try),
          (assign, ":scene", "scn_follower_camp"),
      (try_end),
      (modify_visitors_at_site,":scene"),
      (reset_visitors),

      (party_get_num_companion_stacks, ":num_stacks", "$enlisted_party"),
      (assign, ":cur_entry", 1),
      (try_for_range, ":troop_iterator", 0, ":num_stacks"),
          (try_begin),
              (eq, ":cur_entry", 10),
              (assign, ":cur_entry", 17),
          (try_end),
          (party_stack_get_troop_id, ":cur_troop_id", "$enlisted_party", ":troop_iterator"),
          (neq, ":cur_troop_id", "trp_player"),
          (neg|troop_is_hero, ":cur_troop_id"),
          (try_begin),
              (gt, ":cur_entry", 40),
              (assign, ":num_stacks", -1), #break the loop
          (else_try),
              (party_stack_get_size, ":stack_size","$enlisted_party",":troop_iterator"),
              (party_stack_get_num_wounded, ":num_wounded","$enlisted_party",":troop_iterator"),
              (val_sub, ":stack_size", ":num_wounded"),
              (gt, ":stack_size", 0),
              (assign, ":counter", 1),
              (try_for_range, ":unused", 0, ":stack_size"), #nested loop ayy lmao
                  (try_begin),
                      (eq, ":cur_entry", 10),
                      (assign, ":cur_entry", 17),
                  (try_end),
                  (try_begin),
                      (this_or_next|ge, ":cur_entry", 40),
                      (eq, ":counter", 10),
                      (assign, ":stack_size", -1), #break the loop
                  (else_try),
                      (set_visitor, ":cur_entry", ":cur_troop_id"),
                      (val_add, ":cur_entry", 1),
                      (val_add, ":counter", 1),
                  (try_end),
              (try_end),
          (try_end),
      (try_end),
      (set_visitor, 10, "trp_healer_2"),
      (set_visitor, 11, "trp_smith_master"),
      (set_visitor, 12, "trp_sword_sister"),
      (set_visitor, 13, "trp_follower_woman"),
      (set_visitor, 14, "trp_sword_sister"),
      (set_visitor, 15, "trp_follower_woman"),
      (set_visitor, 16, "trp_sword_sister"),
      (set_visitor, 0, "trp_player"),

      (party_stack_get_troop_id, ":lord", "$enlisted_party", 0),
      (set_visitor, 41, ":lord"),
      (assign, "$talk_context", tc_marshing_camp),
      (jump_to_scene, ":scene"),
      (change_screen_mission),
    ]),
    ("join_wounded",[
      (party_get_battle_opponent, ":commander_opponent", "$enlisted_party"),
      (gt, ":commander_opponent", 0),
      (troop_is_wounded, "trp_player"),
	  ],"You are too wounded to fight.",[
      (change_screen_map),
    ]),
 		("report",[
      (party_get_battle_opponent, ":commander_opponent", "$enlisted_party"),
      (lt, ":commander_opponent", 0),
    ],"Commander's Report",[
      (start_presentation, "prsnt_taragoth_lords_report"),
    ]),

    ("return_to_duty",[
      (neg|is_currently_night),
      (ge, "$cheat_mode", 1),
		],"March with the soldiers.",[
      (jump_to_menu, "mnu_freelancer_event_marsh"),
		]),
    ("return_to_duty",[
      (ge, "$cheat_mode", 1),
		],"Skip freelancing: Last promotion to tribune.",[
      (jump_to_menu, "mnu_last_promotion"),
		]),
    ("return_to_duty",[],"Continue.",[
      (change_screen_map),
    ]),
]),
("commander_aud",0,
  "Your request for a meeting is relayed to your commander, and finally {s6} appears from his tent to speak with you.",
  "none",[
    (set_background_mesh, "mesh_pic_camp"),
    (party_stack_get_troop_id, ":lord", "$enlisted_party", 0),
    (str_store_troop_name, s6, ":lord"),
  ],[
  ("continue",[],"Continue...",[
		(try_begin),
      (party_get_attached_to, ":town", "$enlisted_party"),
      (neg|is_between, ":town", centers_begin, centers_end),
			(start_encounter, "$enlisted_party"),
			(change_screen_map),
		(else_try),
			#Fake that it is a party encounter when enlisted party in a town (lines taken from script_game_event_party_encounter)
			(assign, "$g_encountered_party", "$enlisted_party"),
			(store_faction_of_party, "$g_encountered_party_faction","$g_encountered_party"),
			(store_relation, "$g_encountered_party_relation", "$g_encountered_party_faction", "fac_player_faction"),
			(party_get_slot, "$g_encountered_party_type", "$g_encountered_party", slot_party_type),
			(party_get_template_id,"$g_encountered_party_template","$g_encountered_party"),
			(assign, "$talk_context", tc_party_encounter),
			(call_script, "script_setup_party_meeting", "$g_encountered_party"),
		(try_end),
  ]),
	("reject_talk_lord",[],"Nevermind.",[
    (change_screen_map),
  ]),
]),
("freelancer_defeated",0,
  "After the battle the enemies loot and enslave every survivor. Luckily, they hold you for dead. Several hours later, they stop looting and move on. Finally, you can get up.",
  "none",[
    (set_background_mesh, "mesh_pic_escape_1"),
  ],[
    ("continue",[],"Gather some left overs and continue...",[
      (call_script, "script_end_freelancing"),
      (call_script, "script_update_troop_location_notes", "trp_player", 1),
      (change_screen_map),
      (add_xp_as_reward, 50),
      (try_begin),#work around to avoid companions disappearing
        (store_party_size, ":size", "p_underworld"),
        (gt, ":size",0),
        (assign, "$g_move_heroes", 1),
        (call_script, "script_party_add_party_companions","p_main_party", "p_underworld"),
        (assign, "$g_move_heroes", 0),
        (party_clear, "p_underworld"),
      (try_end),
    ]),
]),

("promotion_freelancer",0,
  "Congratulations, you have been promoted to {s21}. {reg0?With this rank you will command {reg4} soldiers during battle.:You will not command any troops during battle.}^^{s50}",
  "none",[
    (add_xp_as_reward, 500),
    (assign, "$g_encountered_party", "$enlisted_party"),
    (assign, "$temp4_1", 0),
    (str_clear, s50),
    (set_background_mesh, "mesh_pic_legion_march"),
    (quest_get_slot,":rank", "qst_freelancing", slot_quest_freelancer_rank),
    (val_add, ":rank", 1),
    (try_begin),
        (ge, ":rank", 8),
        (jump_to_menu, "mnu_last_promotion"),
    (else_try),
        (call_script, "script_freelancer_remove_player_items"),#remove old stuff
        (quest_set_slot, "qst_freelancing", slot_quest_freelancer_rank,":rank"),
        (call_script, "script_freelancer_add_player_items"),#add new stuff
        (try_begin),
            (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_rank, 2),
            (quest_set_slot, "qst_freelancing", slot_quest_freelancer_progress_limit, 200),
            (call_script, "script_change_troop_renown", "trp_player", 2),
        (else_try),
            (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_rank, 3),
            (quest_set_slot, "qst_freelancing", slot_quest_freelancer_progress_limit, 300),
            (call_script, "script_change_troop_renown", "trp_player", 4),
            (try_begin),
                (party_stack_get_troop_id, ":lord", "$enlisted_party", 0),
                (neg|troop_slot_eq, ":lord", slot_troop_legion, 12),
                (assign, "$talk_context", tc_promotion_optio),
                (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_pretorian, 1),
                (call_script, "script_setup_troop_meeting", "trp_centurio_west", -1, -1),
            (try_end),
        (else_try),
            (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_rank, 4),
            (quest_set_slot, "qst_freelancing", slot_quest_freelancer_progress_limit, 400),
            (call_script, "script_change_troop_renown", "trp_player", 7),
            (set_background_mesh, "mesh_pic_centurio"),
            (assign, "$temp4_1", 1),
            (str_store_string, s50, "@As Centurio, you now receive your own whip. You have now to decide how you will use it? Will you act lawful and just?"
            +" ^You also encounter many new faces. As Optio, it was easy to recognise and remember your soldiers and lads, but now there are so many. Does it even matter"
            +" to recognise their names? Most of them will probably be dead soon anyways."),
        (else_try),
            (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_rank, 5),
            (quest_set_slot, "qst_freelancing", slot_quest_freelancer_progress_limit, 500),
            (call_script, "script_change_troop_renown", "trp_player", 10),
        (else_try),
            (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_rank, 6),
            (quest_set_slot, "qst_freelancing", slot_quest_freelancer_progress_limit, 600),
            (call_script, "script_change_troop_renown", "trp_player", 13),
        (else_try),
            (quest_slot_eq, "qst_freelancing", slot_quest_freelancer_rank, 7),
            (quest_set_slot, "qst_freelancing", slot_quest_freelancer_progress_limit, 700),
            (call_script, "script_change_troop_renown", "trp_player", 18),
        (try_end),
        (call_script, "script_get_current_rank_to_s21"),
        (quest_get_slot, reg4, "qst_freelancing", slot_quest_freelancer_agent_limit),
        (assign, reg0, 0),
        (try_begin),
            (gt, reg4, 1),
            (assign, reg0, 1),
        (try_end),
    (try_end),
  ],[
    ("continue",[
      (eq, "$temp4_1", 0),
    ],"Continue...",[
      (change_screen_map),
    ]),
    ("continue",[
      (eq, "$temp4_1", 1),
    ],"I will lead by example and try to remember every name and to use the whip only if necessary...",[
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_treatment, 1),
      (change_screen_map),
    ]),
    ("continue",[
      (eq, "$temp4_1", 1),
    ],"They will die anyways. I will do it like the other officers...",[
      (change_screen_map),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_treatment, -1),
    ]),
]),

("last_promotion",0,
  "A soldier informs you that {s6} wants to speak you. You follow him to the commander tent, where {s6} awaits you.",
  "none",[
    (try_begin),
        (eq, "$g_rank", 0),
        (set_background_mesh, "mesh_pic_camp"),
        (party_stack_get_troop_id, ":lord", "$enlisted_party", 0),
        (str_store_troop_name, s6, ":lord"),
    (else_try),
        (ge, "$g_rank", 1),
        (change_screen_map),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (set_show_messages, 0),
      (try_for_range, ":slot", ek_item_0, ek_food),##to avoid duplication of items
          (this_or_next|eq, ":slot", ek_item_0),
          (this_or_next|eq, ":slot", ek_item_1),
          (this_or_next|eq, ":slot", ek_head),
          (this_or_next|eq, ":slot", ek_body),
          (this_or_next|eq, ":slot", ek_foot),
          (eq, ":slot", ek_horse),
          (troop_get_inventory_slot, ":item", "trp_player", ":slot"),
          (try_begin),
            (ge, ":item", 1),
            (troop_set_inventory_slot, "trp_player", ":slot", -1),
            (troop_get_inventory_slot_modifier,":modifier", "trp_player", ":slot"),
            (troop_add_item, "trp_player", ":item", ":modifier"),
          (try_end),
          # (troop_remove_item, "trp_player", ":item"),
          # (str_store_item_name, s3, ":item"),
          # (display_message, "@Removed: {s3}"),
          (try_begin),
            (eq, ":slot", ek_head),
            (troop_set_inventory_slot, "trp_player", ":slot", "itm_roman_legatus_helm"),
          (else_try),
            (eq, ":slot", ek_body),
            (troop_set_inventory_slot, "trp_player", ":slot", "itm_musculata_legatus_6"),
          (else_try),
            (eq, ":slot", ek_foot),
            (troop_set_inventory_slot, "trp_player", ":slot", "itm_graves_simple_2"),
          (else_try),
            (eq, ":slot", ek_horse),
            (troop_set_inventory_slot, "trp_player", ":slot", "itm_horse_3"),
          (else_try),
            (eq, ":slot", ek_item_0),
            (troop_set_inventory_slot, "trp_player", ":slot", "itm_officer_shield"),
          (else_try),
            (eq, ":slot", ek_item_1),
            (troop_set_inventory_slot, "trp_player", ":slot", "itm_roman_spatha"),
          (try_end),
      (try_end),
      (add_xp_as_reward, 1500),
      (set_show_messages, 1),
      (assign, "$talk_context", tc_last_promotion),
		  (call_script, "script_setup_party_meeting", "$g_encountered_party"),
    ]),
]),

("deliver_bribe",0,
  "After a while of searching you find the villa on one of the seven hills of Rome.^^You are standing in front of the entrance. Shall you enter it or simply keep the money for yourself?",
  "none",[
    (set_background_mesh, "mesh_pic_villa"),
  ],[
    ("continue",[
    ],"Deliver the bribe.",[
      (quest_get_slot, ":bribe", "qst_deliver_bribe", slot_quest_target_amount),
      (troop_remove_gold, "trp_player", ":bribe"),
      (call_script, "script_finish_quest", "qst_deliver_bribe", 100),
      (display_message, "@You deliver the 'gift' and receive your reward from the senator."),
      (jump_to_menu, "mnu_town"),
    ]),
    ("continue",[
    ],"Go back.",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

("attack_thunder_god",0,
  "After a short travel you reach your destination: The camp of the Thundergod cultists! The Parthian spy says he wait here while you attack the cultists camp.",
  "none",[
    (set_background_mesh, "mesh_pic_desert"),
  ],[
    ("continue",[
    ],"Smash the bastards!",[
      #0 player, 1 troops of player, 2 - 5 guards, 5-9 peasants/guards
      (set_jump_mission,"mt_thunder_god_fight"),
      (modify_visitors_at_site,"scn_attack_thundergod"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      #(set_visitor, 0, "trp_agent_parthian"),#the parthian is helping the player
      (set_visitors, 2, "trp_mercenary_crossbowman",5),
      (set_visitors, 3, "trp_mercenary_crossbowman",5),
      (set_visitors, 4, "trp_mercenary_crossbowman",5),
      (set_visitors, 5, "trp_mercenary_crossbowman",5),
      (set_visitors, 6, "trp_mercenary_swordsman",5),
      (set_visitors, 7, "trp_peasant_woman",5),
      (set_visitors, 7, "trp_roman_village_walker",5),
      (set_visitors, 8, "trp_peasant_woman",5),
      (set_visitors, 8, "trp_roman_village_walker",5),
      (set_visitors, 9, "trp_mercenary_swordsman",5),
      (assign, "$temp_3", 1),
      (jump_to_scene, "scn_attack_thundergod"),
      (change_screen_mission),
    ]),
]),

  (
    "attack_thunder_god_win",0,
    "{s12}^^{s11}",
    "none",
    [(set_background_mesh, "mesh_pic_desert"),
    (str_clear, s11),
    (str_clear, s12),
    (try_begin),
      (eq, "$temp_3",1),
      (str_store_string, s11,"str_thunder_god_text"),
      (try_begin),
        (eq, "$temp",1),
        (str_store_string, s12,"str_thunder_god_text_lost"),
      (try_end),
     (else_try),
       (eq, "$temp_3",2),
       (str_store_string, s11,"str_thunder_god_text2"),
       (try_begin),
         (eq, "$temp",1),
         (str_store_string, s12,"str_thunder_god_text_lost2"),
       (try_end),
     (try_end),
    ],
    [
      ("continue",[],
       "Continue",
       [
       (try_begin),
         (eq, "$temp_3",1),
         (call_script, "script_get_meeting_scene"),
         (assign, ":meeting_scene", reg0),
         (modify_visitors_at_site,":meeting_scene"),
         (reset_visitors),
         (set_visitor,0,"trp_player"),
         (set_visitor,17,"trp_agent_parthian"),
         (set_jump_mission,"mt_conversation_encounter"),
         (jump_to_scene,":meeting_scene"),
         (assign, "$talk_context", tc_thunder_god_talk),
         (change_screen_map_conversation, "trp_agent_parthian"),
       (else_try),
         (eq, "$temp_3",2),
         (quest_set_slot, "qst_thunder", slot_quest_current_state, 9),
         (display_message, "str_quest_updated"),
         (add_quest_note_from_sreg, "qst_thunder", 7, "@You have slain the great Thundergod and destroyed a Parthian spy cell in Alexandria. You should report Nero.", 0),
         (change_screen_map),
       (try_end),
        ]),

    ]
  ),

  (
    "spy_last_charge",0,
    "Some Cataphracts appear in the distance, You prepare for a battle.",
    "none",
    [(set_background_mesh, "mesh_pic_desert"),

    ],
    [
      ("continue",[],
       "Smash the bastards!",
       [
        (set_jump_mission,"mt_thunder_god_fight"),
        (modify_visitors_at_site,"scn_attack_thundergod"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),

        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (assign, ":size", reg0),
        (val_div, ":size", 7),#80 men player - 10 cataphracts to fight
        (val_clamp, ":size", 1, 18),
        (set_visitors, 11, "trp_eastern_cataphract", ":size"),

        (val_add, ":size", 4), #additional troops
        (set_visitors, 11, "trp_eastern_light_axeman", ":size"),
        (assign, "$temp_3", 2),
        (jump_to_scene, "scn_attack_thundergod"),
        (change_screen_mission),
        ]),

    ]
  ),
##for new quests
  (
    "pick_up_gold",0,
    "You have picked up a load of gold bars for {s15}.",
    "none",
    [(set_background_mesh, "mesh_pic_messenger"),
    (quest_get_slot, ":giver","qst_elusive_bandits", slot_quest_giver_center),
    (str_store_party_name, s15, ":giver"),
    ],
    [
      ("continue",[],
       "Continue.",
       [
        (change_screen_map),
        ]),

    ]
  ),
  (
    "looby_for_water_rights",0,
    "{s25}",
    "none",
    [(set_background_mesh, "mesh_pic_senators"),
    (quest_get_slot, ":giver", "qst_water_dispute", slot_quest_giver_center),
    (str_store_party_name, s3, ":giver"),
    (store_skill_level, ":oratory", "skl_oratory", "trp_player"),
    (troop_get_slot, ":support", "trp_senator_dummy", slot_senate_support),
    (assign, ":c", 0),
    (try_begin),
      (this_or_next|eq, "$g_is_emperor", 1),
      (ge, ":support", 60),
      (assign, ":c", 1),
    (else_try),
      (ge, ":support", 25),
      (is_between, ":oratory", 3, 6),
      (store_random_in_range, ":r", 0, 10),
      (le, ":r", 4),
      (assign, ":c", 1),
    (else_try),
      (ge, ":oratory", 6),
      (store_random_in_range, ":r", 0, 10),
      (le, ":r", 8),
      (assign, ":c", 1),
    (try_end),
    (try_begin),
      (eq, ":c", 1),
      (str_store_string, s25, "str_water_dispute_success_s3"),
      (call_script, "script_succeed_quest", "qst_water_dispute"),
    (else_try),
      (str_store_string, s25, "str_water_dispute_fail_s3"),
      (call_script, "script_change_center_prosperity", ":giver", -5),
      #(call_script, "script_fail_quest", "qst_water_dispute"),
      (call_script, "script_abort_quest", "qst_water_dispute", 1),
    (try_end),
    ],
    [
      ("continue",[],
       "Continue.",
       [
        (add_xp_as_reward, 150),
        (jump_to_menu, "mnu_senatus"),
        ]),

    ]
  ),

  (
    "crushed_revolt",0,
    "The troublemakers are defeated. All enemies who survived will be crucified.",
    "none",
    [(set_background_mesh, "mesh_pic_victory"),

    ],
    [
      ("continue",[],
       "Continue.",
       [
        (jump_to_menu, "mnu_town"),
        ]),
    ]
  ),

("town_action",0,
  "Choose an action:",
  "none",[
    (call_script, "script_set_town_picture"),
  ],[
    ("visit_lady",[
      (eq, "$current_town", "p_town_28"),
    ],"Visit the ruins of Ancient Punic Carthage.",[
      (jump_to_scene, "scn_ruins_of_carthage"),
      (modify_visitors_at_site,"scn_ruins_of_carthage"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (try_begin),
        (neg|is_currently_night),
        (check_quest_active, "qst_prophecy_of_caeselius_bassus"),
        (quest_slot_eq, "qst_prophecy_of_caeselius_bassus", slot_quest_current_state, 1),
        (set_visitor, 1, "trp_statthalter_new_12"),
      (else_try),
        (neg|is_currently_night),
        (check_quest_active, "qst_prophecy_of_caeselius_bassus"),
        (quest_slot_ge, "qst_prophecy_of_caeselius_bassus", slot_quest_current_state, 2),
        (set_visitor, 2, "trp_statthalter_new_12"),
      (try_end),
      (try_begin),
        (neg|is_currently_night),
        (check_quest_active, "qst_prophecy_of_caeselius_bassus"),
        (quest_slot_ge, "qst_prophecy_of_caeselius_bassus", slot_quest_current_state, 7),
        (set_visitor, 3, "trp_slave_mine"),
        (set_visitor, 4, "trp_slave_mine"),
        (set_visitor, 5, "trp_slave_mine"),
        (set_visitor, 6, "trp_slave_mine"),
        (set_visitor, 7, "trp_slave_mine"),
        # (set_visitor, 8, "trp_slave"),
        # (set_visitor, 9, "trp_slave"),
      (try_end),
      (set_jump_mission, "mt_explore_carthage"),
      (change_screen_mission),
    ]),
    ("visit_lady",[
      (eq, "$current_town", "p_town_20"),
      (check_quest_active, "qst_wlodowiecus_adventure_4"),
      (this_or_next|quest_slot_eq, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 1),
      (quest_slot_eq, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 11),
    ],"Visit the villa of The Lybian.",[
      (assign,"$talk_context", tc_town_talk),
      (try_begin),
        (quest_slot_eq, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 11),
        (jump_to_menu, "mnu_wlodowiecus_adventure_1_4_lybicus_final"),
        (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 12),
      (else_try),
        (quest_slot_eq, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 1),
        (jump_to_menu, "mnu_wlodowiecus_adventure_1_4_lybicus_feast"),
        (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 2),
      (else_try),
        (display_message, "str_door_locked"),
      (try_end),
    ]),
    # ("visit_lady",[
    #   (assign, "$love_interest_in_town", 0),
    #   (assign, "$love_interest_in_town_2", 0),
    #   (assign, "$love_interest_in_town_3", 0),
    #   (assign, "$love_interest_in_town_4", 0),
    #   (assign, "$love_interest_in_town_5", 0),
    #   (assign, "$love_interest_in_town_6", 0),
    #   (assign, "$love_interest_in_town_7", 0),
    #   (assign, "$love_interest_in_town_8", 0),
    #   (try_for_range, ":lady_no", kingdom_ladies_begin, kingdom_ladies_end),
    #     (troop_slot_eq, ":lady_no", slot_troop_cur_center, "$current_town"),
    #     (call_script, "script_get_kingdom_lady_social_determinants", ":lady_no"),
    #     (assign, ":lady_guardian", reg0),

    #     (troop_slot_eq, ":lady_no", slot_troop_spouse, -1),
    #     (ge, ":lady_guardian", 0), #not sure when this would not be the case

    #     #must have spoken to either father or lady
    #     (this_or_next|troop_slot_ge, ":lady_no", slot_troop_met, 2),
    #     (troop_slot_eq, ":lady_guardian", slot_lord_granted_courtship_permission, 1),

    #     (neg|troop_slot_eq, ":lady_no", slot_troop_met, 4),
    #     (try_begin),
    #       (eq, "$love_interest_in_town", 0),
    #       (assign, "$love_interest_in_town", ":lady_no"),
    #     (else_try),
    #       (eq, "$love_interest_in_town_2", 0),
    #       (assign, "$love_interest_in_town_2", ":lady_no"),
    #     (else_try),
    #       (eq, "$love_interest_in_town_3", 0),
    #       (assign, "$love_interest_in_town_3", ":lady_no"),
    #     (else_try),
    #       (eq, "$love_interest_in_town_4", 0),
    #       (assign, "$love_interest_in_town_4", ":lady_no"),
    #     (else_try),
    #       (eq, "$love_interest_in_town_5", 0),
    #       (assign, "$love_interest_in_town_5", ":lady_no"),
    #     (else_try),
    #       (eq, "$love_interest_in_town_6", 0),
    #       (assign, "$love_interest_in_town_6", ":lady_no"),
    #     (else_try),
    #       (eq, "$love_interest_in_town_7", 0),
    #       (assign, "$love_interest_in_town_7", ":lady_no"),
    #     (else_try),
    #       (eq, "$love_interest_in_town_8", 0),
    #       (assign, "$love_interest_in_town_8", ":lady_no"),
    #     (try_end),
    #   (try_end),
    #   (gt, "$love_interest_in_town", 0),
    # ],"Attempt to visit a lady",[
    #   (jump_to_menu, "mnu_lady_visit"),
    # ], "Door to the garden."),
		("set_sail",[
      (party_slot_eq, "$current_town", slot_town_port, 1),
      (eq, "$enlisted_party", -1),#not freelancing
    ],"Visit the port",[
		  (jump_to_menu, "mnu_town_port"),
		]),
    ("collect_taxes_qst",[
      (check_quest_active, "qst_collect_taxes"),
      (quest_slot_eq, "qst_collect_taxes", slot_quest_target_center, "$current_town"),
      (neg|quest_slot_eq, "qst_collect_taxes", slot_quest_current_state, 4),
      (quest_get_slot, ":quest_giver_troop", "qst_collect_taxes", slot_quest_giver_troop),
      (str_store_troop_name, s1, ":quest_giver_troop"),
      (quest_get_slot, reg5, "qst_collect_taxes", slot_quest_current_state),
    ],"{reg5?Continue collecting taxes:Collect taxes} due to {s1}.",[
      (jump_to_menu, "mnu_collect_taxes"),
    ]),
    ("werdheri_quest",[
      (check_quest_active, "qst_werdheri"),
      (quest_slot_eq, "qst_werdheri", slot_quest_current_state, 5),
    ],"Meet Werdheri.",[
      (jump_to_menu,"mnu_werdheri_fight"),
    ]),
    ("town_donation",[
      (eq,"$entry_to_town_forbidden",0),
      (troop_slot_ge, "trp_player", slot_troop_renown, 200), #beggars do not donate money
      (neg|party_slot_eq, "$current_town", slot_village_state, svs_under_siege),
      (neg|party_slot_eq, "$current_town", slot_donate_party, 1),
    ],"Donate 10,000 denars to town officials.",[
      (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
      (store_troop_gold, ":gold", "trp_player"),
      (try_begin),
        (neg|party_slot_eq, "$current_town", slot_donate_party, 1),
        (try_begin),
          (ge, ":gold", 10000),
          (troop_remove_gold, "trp_player", 10000),
          (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", 2),
          (display_message,"@You donated 10000 denars.",color_good_news),
          (try_begin),
            (is_between, ":prosperity", 0, 20),
            (call_script, "script_change_player_relation_with_center", "$current_town", 15),
            (call_script, "script_change_center_prosperity", "$current_town", 6),
            (display_message,"@Due to the low prosperity of the town, the people are very happy."),
          (else_try),
            (is_between, ":prosperity", 20, 40),
            (call_script, "script_change_player_relation_with_center", "$current_town", 8),
            (call_script, "script_change_center_prosperity", "$current_town", 4),
            (display_message,"@Due to the low prosperity of the town, the people are very happy."),
          (else_try),
            (is_between, ":prosperity", 40, 60),
            (call_script, "script_change_player_relation_with_center", "$current_town", 4),
            (call_script, "script_change_center_prosperity", "$current_town", 2),
          (else_try),
            (is_between, ":prosperity", 60, 80),
            (call_script, "script_change_player_relation_with_center", "$current_town", 3),
            (call_script, "script_change_center_prosperity", "$current_town", 1),
            (display_message,"@Due to the high prosperity of the town, your relation improves only small."),
          (else_try),
            (call_script, "script_change_player_relation_with_center", "$current_town", 1),
            (display_message,"@Due to the high prosperity of the town, your relation improves only small."),
          (try_end),
          (party_set_slot, "$current_town", slot_donate_party, 1),
          (call_script, "script_change_troop_renown", "trp_player", 10),
        (else_try),
          (display_message,"str_not_enough_gold",0x888888), # Gray. You can change the colour what you want.
          (call_script, "script_change_troop_renown", "trp_player", -20),
        (try_end),
      (else_try),
        (display_message,"@They didn't accept your donation. You can ask them after some days again.",0xAA0000), #I said "one week". This is controlling by a simple trigger. You must match words with digits. Simple trigger has given at bottom of codes. # Dark red. You can change the colour what you want.
        (call_script, "script_change_troop_renown", "trp_player", -20),
      (try_end),
    ]),
    ("triumph_1",[
      # (neg|is_currently_night),
      (eq, "$g_is_emperor", 1),
      # (troop_slot_eq, "trp_player", slot_troop_honorary_title, ht_consul),
      (eq, "$current_town", "p_town_6"),
      (eq, "$g_triumph", 0),
      (eq, "$g_encountered_party_faction", "$players_kingdom"),
    ],"Hold a triumph.",[
      (jump_to_menu, "mnu_triumph_hold"),
    ]),
    ("host_tournament",[
      (eq, "$g_encountered_party_faction", "$players_kingdom"),
      (neg|is_currently_night),
      (neg|party_slot_ge, "$current_town", slot_town_has_tournament, 1),
      (eq,"$entry_to_town_forbidden",0), #SB : can't participate while disguised
      (party_slot_eq, "$current_town", slot_party_type, spt_town),

      (party_get_slot, ":lord", "$current_town", slot_town_lord),
      (this_or_next|eq, ":lord", "trp_player"),
      (this_or_next|faction_slot_eq, "$g_encountered_party_faction", slot_faction_leader, "trp_player"),
      (this_or_next|troop_slot_eq, "trp_player", slot_troop_honorary_title, ht_censor),
      (this_or_next|troop_slot_eq, "trp_player", slot_troop_honorary_title, ht_aedil),
      (troop_slot_eq, "trp_player", slot_troop_honorary_title, ht_consul),

      (eq, "$g_triumph", 0),
      # (troop_slot_eq, "trp_player", slot_troop_culture, "fac_culture_7"),
	  ],"Host games.",[
      (jump_to_menu, "mnu_host_games"),
    ]),
    ##diplomacy begin
    ("dplmc_guild_master_meeting",[
      (party_slot_eq,"$current_town",slot_party_type, spt_town),
        #nested diplomacy start+
      #rubik had a good idea: only enable this after meeting the guild master
      (assign, ":can_meet_guild_master", 0),
      (try_begin),
        #Always can jump to guild master in cheat mode.
        (eq, "$cheat_mode", 1),
        (assign, ":can_meet_guild_master", 1),
      (else_try),
        #SB : can jump when part of faction
        (eq, "$players_kingdom", "$g_encountered_party_faction"),
        (assign, ":can_meet_guild_master", 1),
      (else_try),
        #Can jump to guild master after meeting him once.
        (party_get_slot, ":guild_master_troop", "$current_town",slot_town_elder),
        (ge, ":guild_master_troop", 1),
        (neg|troop_slot_eq, ":guild_master_troop", slot_troop_met, 0),
        (assign, ":can_meet_guild_master", 1),
      (else_try),
        #Always enable this in Praven for the sake of playability, since
        #the guild master there is weirdly hard to find.
        (this_or_next|eq, "$current_town", "p_town_6"),
        #Also enable in the starting town, to avoid confusing players into
        #thinking the menu item doesn't exist.
        (eq, "$g_starting_town", "$current_town"),
        (assign, ":can_meet_guild_master", 1),
      (try_end),
      (neq, ":can_meet_guild_master", 0),
      #nested diplomacy end+
      (this_or_next|eq,"$entry_to_town_forbidden",0),
      (gt, "$sneaked_into_town", disguise_none),
    ],"Meet the Magister civium.",[
      (try_begin),
        (call_script, "script_cf_enter_center_location_bandit_check"),
      (else_try), #SB : unified script call
        (call_script, "script_start_town_conversation", slot_town_elder, 11),
      (try_end),
    ]),
    ("dplmc_guild_master_meeting_denied",[
      #Only show this when the player would get the rest of the town menu
      (party_slot_eq,"$current_town",slot_party_type, spt_town),
      (this_or_next|eq,"$entry_to_town_forbidden",0),
          (gt, "$sneaked_into_town", disguise_none),
        #There is a valid guild master, and you haven't met him,
      #and there isn't another condition that enables the jump.
      (party_get_slot, ":guild_master_troop", "$current_town",slot_town_elder),
      (gt, ":guild_master_troop", 0),
      (eq, "$cheat_mode", 0),
      (neq, "$g_starting_town", "$current_town"),
      (neq, "$current_town", "p_town_6"),
      (troop_slot_eq, ":guild_master_troop", slot_troop_met, 0),
      (neq, "$players_kingdom", "$g_encountered_party_faction"),
      (disable_menu_option),
    ],"You have not met the Magister civium yet.",[
    ]),
    ("auto_buy_food",[
      (neg|party_slot_eq,"$current_town",slot_party_type, spt_castle),
    ],"Buy food automatically.",[
      (assign, "$g_next_menu", "mnu_town"),
      (jump_to_menu,"mnu_dplmc_trade_auto_buy_food_begin"),
    ]),
    ("auto_sell",[
      (neg|party_slot_eq,"$current_town",slot_party_type, spt_castle),
    ],"Sell items automatically.",[
      (assign, "$g_next_menu", "mnu_town"),
      (jump_to_menu,"mnu_dplmc_trade_auto_sell_begin"),
    ]),
    ("continue",[
    ],"Go back.",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

###event chain regarding Avaritia and Superbus
  (
    "avaritia_end",0,
    "{s22}",
    "none",
    [
    (try_begin),
      (eq, "$temp1", 1),
      (str_store_string, s22, "str_avaritia_dead"),
      (set_background_mesh, "mesh_pic_kreuzigung"),
    (else_try),
      (eq, "$temp1", 2),
      (str_store_string, s22, "str_avaritia_banished"),
      (set_background_mesh, "mesh_pic_deserters"),
    (try_end),
     ],
    [

        ("continue",[],
       "Continue.",
       [
       (troop_add_gold, "trp_player", 50000),
       (try_begin),
         (troop_slot_eq, "trp_avaritia", slot_troop_spouse, 5),
         (troop_add_gold, "trp_player", 200000),
       (try_end),
       (display_message,"@All their properties are seized!"),
        (troop_set_slot, "trp_avaritia", slot_troop_spouse, -1),
        (troop_set_slot, "trp_avaritia", slot_troop_lover, -1),
        (troop_set_slot, "trp_avaritia", slot_troop_father, -1),
        (jump_to_menu, "mnu_town"),
        ]),

    ]
  ),
###event chain regarding Avaritia and Superbus
("criminal_activities_rome",0,
  "From your servants and advisors you hear about a gang raising to power in Rome. The gang seems to be related to Avaritia and Superbus. The raise to power was mainly possible because the vigilia seems to ignore them.^^"
  +"Rome is in turmoil. It is said you are involved into this matter. Many people are shocked that common criminals are protected by the Princeps.^^It is clear you must do something against this gang.",
  "none",
  [
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("continue",[],
      "Continue.",
    [
      (setup_quest_text, "qst_avaritia"),
      (str_store_string, s2, "@Avaritia and Superbus have found a gang which is gaining influence. Talk with Avaritia at your earliest convenience."),
      (call_script, "script_start_quest", "qst_avaritia", "trp_fortuna"),
      (troop_set_slot, "trp_avaritia", slot_troop_mother, 1),
      (change_screen_map),
    ]),
]),

###event chain regarding Avaritia and Superbus
  (
    "avaritia_trial",0,
    "This episode has become the largest scandal Rome has seen for a long time. Avaritia and Superbus are brought before court.\
 All of the rumors about their gang business turn out to be true. Although Avaritia spread all the stories about your origin, nobody believes her.\
 In the end, both are sentenced to death.",
    "none",
    [(set_background_mesh, "mesh_pic_senatus"),

     ],
    [
        ("continue",[],
       "Continue.",
       [
        (add_xp_as_reward, 1500),
        (call_script, "script_end_quest", "qst_avaritia"),
        (jump_to_menu, "mnu_town"),
        ]),
    ]
  ),
###event chain regarding Avaritia and Superbus
  (
    "avaritia_died",0,
    "The events caused some rumors and talk about your origin but nothing serious that could hurt you.^^At the end, the events are quickly forgotten by other scandals of the Roman high society.",
    "none",
    [(set_background_mesh, "mesh_pic_roma"),

     ],
    [
        ("continue",[],
       "Continue.",
       [(add_xp_as_reward, 1500),
        (call_script, "script_end_quest", "qst_avaritia"),
        (jump_to_menu, "mnu_town"),
        ]),
    ]
  ),
###event chain regarding Avaritia and Superbus
("notification_event_emperor_avaritia",0,
  "Your minister {s11} send word that there are problems brewing in Rome, if left untreated, could sap your authority."
  +" You should consult with {reg4?her:him} at your earliest convenience.",
  "none",
  [
    (set_background_mesh, "mesh_pic_messenger"),
    (play_sound, "snd_message_negative_sound"),
    (str_store_troop_name, s11, "$g_player_minister"),
		(assign, reg4, 0),
		(try_begin),
        (call_script, "script_cf_dplmc_troop_is_female", "$g_player_minister"),
        (assign, reg4, 1),
		(try_end),
  ],[
    ("continue",[],"Continue...",[

	    (change_screen_map),
    ]),
]),

("freelancer_weekly_duty",0,
  "Press K while on the world map to view available mission.^^You can volunteer for one of the available tasks or participate in a training session.^^Press K while on the world map to view available mission.",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("continue",[
      (quest_get_slot, ":cur_timer", "qst_freelancing", slot_quest_freelancer_mission_1),
      (store_current_hours, ":cur_time"),
      (val_div, ":cur_timer", 24),
      (val_div, ":cur_time", 24),
      (val_sub, ":cur_time", ":cur_timer"),
      (ge, ":cur_time", 2),#every two days
      (assign, ":min_distance", 9999999),
      (assign, ":closest_center", -1),
      (try_for_range, ":center_no", villages_begin, villages_end),
        (store_distance_to_party_from_party, ":party_distance", "$enlisted_party", ":center_no"),
        (lt, ":party_distance", ":min_distance"),
        (assign, ":min_distance", ":party_distance"),
        (assign, ":closest_center", ":center_no"),
      (try_end),
      (le, ":min_distance", 18),
      (neg|party_slot_eq, ":closest_center", slot_center_culture, "fac_culture_7"),#not roman culture
      (store_faction_of_party, ":fac", ":closest_center"),
      (eq, ":fac", "fac_kingdom_7"),#roman
    ],"Collect tributes.",[
      (store_current_hours, ":cur_time"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_mission_1, ":cur_time"),
      (jump_to_menu, "mnu_freelancer_task_tribute"),
    ]),
    ("continue",[
      (quest_get_slot, ":cur_timer", "qst_freelancing", slot_quest_freelancer_mission_1),
      (store_current_hours, ":cur_time"),
      (val_div, ":cur_timer", 24),
      (val_div, ":cur_time", 24),
      (val_sub, ":cur_time", ":cur_timer"),
      (ge, ":cur_time", 2),#every two days
    ],"Patrol.",[
      (store_current_hours, ":cur_time"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_mission_1, ":cur_time"),
	    (jump_to_menu, "mnu_freelancer_task_patrol_1"),
    ]),
    ("continue",[
      (quest_get_slot, ":cur_timer", "qst_freelancing", slot_quest_freelancer_mission_1),
      (store_current_hours, ":cur_time"),
      (val_div, ":cur_timer", 24),
      (val_div, ":cur_time", 24),
      (val_sub, ":cur_time", ":cur_timer"),
      (ge, ":cur_time", 2),#every two days
      ##hunting not in deserts
      (party_get_current_terrain,":terrain", "p_main_party"),
      (neq, ":terrain", rt_desert),
      (neq, ":terrain", rt_desert_forest),
    ],"Forage. (Hunting)",[
      (store_current_hours, ":cur_time"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_mission_1, ":cur_time"),
	    (jump_to_menu, "mnu_freelancer_task_hunt"),
    ]),
    ("continue",[
      (quest_get_slot, ":cur_timer", "qst_freelancing", slot_quest_freelancer_mission_2),
      (store_current_hours, ":cur_time"),
      (val_div, ":cur_timer", 24),
      (val_div, ":cur_time", 24),
      (val_sub, ":cur_time", ":cur_timer"),
      (ge, ":cur_time", 1),#every days
    ],"Daily training session.",[
      (store_current_hours, ":cur_time"),
      (quest_set_slot, "qst_freelancing", slot_quest_freelancer_mission_2, ":cur_time"),
      (jump_to_menu, "mnu_freelancer_task_training"),
    ]),
    ("continue",[],"Continue...",[
	    (change_screen_map),
    ]),
]),

(
    "freelancer_task_tribute",0,
    "Today, a group of soldiers leaves the marching camp to visit the nearby villages of {s22} to collect tributes.^^"+
    "{s1}",
    "none",
    [
    (assign, ":min_distance", 9999999),
    (assign, ":center", -1),
    (try_for_range, ":center_no", villages_begin, villages_end),
        (store_distance_to_party_from_party, ":party_distance", "$enlisted_party", ":center_no"),
        (lt, ":party_distance", ":min_distance"),
        (assign, ":min_distance", ":party_distance"),
        (assign, ":center", ":center_no"),
    (try_end),
    (str_store_party_name, s22, ":center"),
    (str_clear, s1),
    (str_clear, s3),
    (try_begin),
        (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
        (str_store_string, s3, "@As your detachment enters the village the women grab their children and flee into their houses. Only some men appear. Their elder steps forward and asks in broken Latin why you have come. Your centurio explains that you came to collect tributes for Rome. The elder talks with the other men in their native language. "),
    (else_try),
        (str_store_string, s3, "@As your detachment enters the village the women grab their children and flee into their houses. Only some men appear. Their elder steps forward and asks in broken Latin why you have come. You explains that you came to collect tributes for Rome. The elder talks with the other men in their native language. "),
    (try_end),

    (store_random_in_range, "$temp1", 0, 4),
    (try_begin),
      (eq, "$temp1", 0),
      (str_store_string, s1, "@As your force enters the village an arrow hits your shield! The villagers are armed and ready to fight!"),
    (else_try),
      (eq, "$temp1", 1),
      (str_store_string, s1, "@{s3}^Then he says that they have nothing to spare as the tributes are already too high."),
    (else_try),
      (eq, "$temp1", 2),
      (str_store_string, s1, "@{s3}^Then he says they will pay the tribute as demanded."),
    (else_try),
      (eq, "$temp1", 3),
      (str_store_string, s1, "@{s3}^Then he says they can only pay a fraction of the demanded tribute."),
      (assign, "$temp1", 1),
    (else_try),##fall back
      (str_store_string, s1, "@{s3}^Then he says that they have nothing to spare as the tributes are already too high."),
      (assign, "$temp1", 1),
    (try_end),
    (set_background_mesh, "mesh_pic_deserters"),
      ],
    [
      ("continue",[(eq, "$temp1", 0),
    (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
      ],"Your centurio orders to attack them!",
       [
       (jump_to_menu, "mnu_freelancer_task_tribute_fight"),
        ]),
       ("continue",[(eq, "$temp1", 0),
    (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
      ],"Order to attack them!",
       [
       (jump_to_menu, "mnu_freelancer_task_tribute_fight"),
        ]),
      ("continue",[(eq, "$temp1", 0),
    (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3), ],"Order to retreat!",
       [
       (jump_to_menu, "mnu_freelancer_task_tribute_retreat"),
        ]),

        ("continue",[(eq, "$temp1", 1),
    (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3), ],"The centurio orders to force them to pay the tribute.",
       [
       (jump_to_menu, "mnu_freelancer_task_tribute_force"),
        ]),
    ("continue",[(eq, "$temp1", 1),
    (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3), ],"They have to pay the tribute! Otherwise we enslave some of their women and children.",
       [
       (jump_to_menu, "mnu_freelancer_task_tribute_force"),
        ]),
        ("continue",[(eq, "$temp1", 1),
    (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3), ],"That is fine.",
       [
       (jump_to_menu, "mnu_freelancer_task_tribute_no"),
        ]),

    ("continue",[(eq, "$temp1", 2),],"Continue.",
       [
       (jump_to_menu, "mnu_freelancer_task_tribute_collected"),
        ]),
     ]
),
 (
    "freelancer_task_tribute_force",0,
    "{s1}",
    "none",
    [
    (store_random_in_range, "$temp1", 0, 2),
    (try_begin),
        (eq, "$temp1", 0),
        (store_random_in_range, ":rand", "str_tribute_force_1", "str_tribute_force_end"),
        (str_store_string, s1, ":rand"),
        (set_background_mesh, "mesh_pic_punishment_roman"),
    (else_try),
        (eq, "$temp1", 1),
        (str_store_string, s1, "@The angry villages grab their tools and say they would rather die than agreeing to such demands!"),
        (set_background_mesh, "mesh_pic_townriot"),
    (try_end),
      ],
    [
      ("continue",[ (eq, "$temp1", 0),],"Continue.",
       [
      (add_xp_as_reward, 150),
      (try_begin),
        (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
        (gt, "$player_honor", -20),
        (call_script, "script_change_player_honor", -1),
      (try_end),
      (call_script, "script_freelancer_add_progress", 25),
      (change_screen_map),
        ]),
        ("continue",[ (eq, "$temp1", 1),],"Continue.",
       [
        (add_xp_as_reward, 50),
        (try_begin),
            (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
            (gt, "$player_honor", -20),
            (call_script, "script_change_player_honor", -1),
        (try_end),
        (jump_to_menu, "mnu_freelancer_task_tribute_fight"),
        ]),

     ]
),
(
    "freelancer_task_tribute_collected",0,
    "The demanded tribute is collected. As sign of submission the villagers are forced to kiss the eagle of the legion.",
    "none",
    [ (set_background_mesh, "mesh_pic_payment"),
      ],
    [
      ("continue",[],"Continue.",
       [
      (add_xp_as_reward, 150),
      (try_begin),
        (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
        (gt, "$player_honor", -20),
        (call_script, "script_change_player_honor", -1),
      (try_end),
      (try_begin),
        (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
        (call_script, "script_freelancer_add_progress", 5),
      (else_try),
        (call_script, "script_freelancer_add_progress", 25),
      (try_end),
      (change_screen_map),
        ]),
     ]
),

(
    "freelancer_task_tribute_no",0,
    "You return to the legion camp without any tribute. You and your men are punished as you failed your task. On the next day another group leaves the camp and visits the village again. "+
    "This time they force the villagers to pay the tribute, enslave some of their women and children and force them to kiss the eagle.",
    "none",
    [
    (set_background_mesh, "mesh_pic_punishment_roman"),
      ],
    [
      ("continue",[],"Continue.",
       [
      (add_xp_as_reward, 150),
      (call_script, "script_change_player_honor", 1),
      (call_script, "script_freelancer_add_progress", -5),
      (change_screen_map),
        ]),

     ]
),

("freelancer_task_patrol_1",0,
  "{s1}",
  "none",
    [
      (str_clear, s1),
      (store_random_in_range, "$temp1", 0, 5),
      (try_begin),
          (eq, "$temp1", 0),
          (str_clear, s2),
          (try_begin),
              (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
              (str_store_string, s2, "@The unit commander proceeds with caution, keeping the force together. As the patrol slowly advances, the enemies return with more troops and attack."),
          (try_end),
          (str_store_string, s1, "@A small group of armed men suddenly turned around as your unit approached and moved briskly, putting more distance between you until they disappeared from view.^^{s2}"),
        # (jump_to_menu, "mnu_freelancer_task_patrol"),
      (else_try),
          (eq, "$temp1", 1),
          (store_random_in_range, ":string", "str_patrol_nothing_vignette0", "str_patrol_end"),
          (str_store_string, s2, ":string"),
          (str_store_string, s1, "str_patrol_text_peaceful"),
      (else_try),
          (eq, "$temp1", 2),
          (str_store_string, s1, "@While patrolling the area, your patrol spots a lonely rider on the horizon, who seems to be watching your advance. He could either be a scout for rebels or bandits, or just a common peasant."),
      (else_try),
          (eq, "$temp1", 3),
          (str_store_string, s1, "@While patrolling the area, local peasants approach and tell that they where raided by bandits recently. They also inform you about the exact location of the bandit party."),
      (else_try),
          (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
          (store_random_in_range, ":r", 0, 2),
          (try_begin),
              (eq, ":r", 0),
              (jump_to_menu, "mnu_freelancer_task_patrol_peasant"),
          (else_try),
              (jump_to_menu, "mnu_freelancer_task_patrol_cattle"),
          (try_end),
      (else_try),##fall back
          (str_store_string, s1, "@While patrolling the area, local peasants approach and tell that they where raided by bandits recently. They also inform you about the exact location of the bandit party."),
          (assign, "$temp1", 3),
      (try_end),
      (set_background_mesh, "mesh_pic_deserters"),
    ],[
      ("continue",[(eq, "$temp1", 0),
        (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
      ],"Continue.",
      [
        (jump_to_menu, "mnu_freelancer_task_patrol"),
      ]),
   ("continue",[(eq, "$temp1", 0),
      (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
      ],"Try to avoid them.",
       [
       (store_random_in_range, ":r", 0, 10),
       (try_begin),
         (le, ":r", 3),
         (jump_to_menu, "mnu_freelancer_task_patrol"),
       (else_try),
         (jump_to_menu, "mnu_freelancer_task_patrol_avoided"),
       (try_end),
        ]),
  ("continue",[(eq, "$temp1", 0),
      (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
      ],"Try to engage them.",
       [
       (store_random_in_range, ":r", 0, 10),
       (try_begin),
         (eq, ":r", 0),
         (jump_to_menu, "mnu_freelancer_task_patrol_nothing"),
       (else_try),
         (le, ":r", 8),
         (jump_to_menu, "mnu_freelancer_task_patrol"),
       (else_try),
         (jump_to_menu, "mnu_freelancer_task_patrol_avoided"),
       (try_end),
        ]),

      ("continue",[(eq, "$temp1", 3),
      (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
      ],"Your commander decides to attack them...",
       [
       (jump_to_menu, "mnu_freelancer_task_patrol"),
        ]),
      ("continue",[(eq, "$temp1", 3),
    (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
    ],"We will hunt them down...",
       [
      (call_script, "script_get_closest_center", "$enlisted_party"),
      (assign, ":center", reg0),
      (try_begin),
        (is_between, ":center", centers_begin, centers_end),
        (call_script, "script_change_player_relation_with_center", ":center", 1),
      (try_end),
       (jump_to_menu, "mnu_freelancer_task_patrol"),
        ]),

      ("continue",[(eq, "$temp1", 3),
    (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
    ],"Well, the bandits are too far away...",
       [
      # (call_script, "script_freelancer_add_progress", 2),
       (jump_to_menu, "mnu_freelancer_task_patrol_peasant_ignored"),
        ]),

      ("continue",[(eq, "$temp1", 1),],"Continue.",
       [
       (call_script, "script_freelancer_add_progress", 5),
       (change_screen_map),
        ]),
      ("continue",[(eq, "$temp1", 2),
    (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
    ],"Interrogate him.",
       [
       (jump_to_menu, "mnu_freelancer_task_patrol_rider_interrogate"),
        ]),
      ("continue",[(eq, "$temp1", 2),
    (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
    ],"Ignore him.",
       [
      (store_random_in_range, ":r", 0, 10),
      (try_begin),
        (le, ":r", 6),
        (display_message, "@The rider was probably an enemy scout. The patrol is ambushed.", color_bad_news),
        (jump_to_menu, "mnu_freelancer_task_patrol"),
      (else_try),
        (jump_to_menu, "mnu_freelancer_task_patrol_rider_ignored"),
      (try_end),
        ]),

    ("continue",[(eq, "$temp1", 2),
    (neg|quest_slot_ge, "qst_freelancing", slot_quest_freelancer_rank, 3),
    ],"Your commander decides to ignore him...",
       [
      (store_random_in_range, ":r", 0, 10),
      (try_begin),
        (le, ":r", 6),
        (display_message, "@The rider was probably an enemy scout. The patrol is ambushed.", color_bad_news),
        (jump_to_menu, "mnu_freelancer_task_patrol"),
      (else_try),
        (jump_to_menu, "mnu_freelancer_task_patrol_rider_ignored"),
      (try_end),
        ]),
]),

(
    "freelancer_task_patrol_cattle",0,
    "Earlier on the patrol, you passed through a village that complained about their cattle getting stolen overnight. Now your unit catches up to a couple of shady characters herding cattle, who run at the sight of you. ^^The thieves escaped, but you do have the cattle now.",
    "none",
    [  (set_background_mesh, "mesh_pic_cattle"),
      ],
    [
      ("continue",[],"Bring it back to the legion's camp. ",
       [
      (try_begin),
        (gt, "$player_honor", -10),
        (call_script, "script_change_player_honor", -1),
      (try_end),
      (call_script, "script_freelancer_add_progress", 25),
      (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
      (call_script, "script_change_player_relation_with_troop", ":lord", 2),
       (str_store_string, s1, "@You detach a couple of equites and have them herd the cattle back to camp, while the rest of the unit completes the patrol. Your commander is impressed by your flexibility and taking emerging opportunities without compromising your mission. It doesn't hurt that the commander will save thousands of coins on legion provisions now either."),
       (assign, "$temp", "mesh_pic_camp"),
       (jump_to_menu, "mnu_freelancer_event_8_reaction"),
        ]),
      ("continue",[],"Return it to the village.",
       [
      (try_begin),
        (lt, "$player_honor", 10),
        (call_script, "script_change_player_honor", 1),
      (try_end),
      (call_script, "script_freelancer_add_progress", 5),
       (str_store_string, s1, "@You take a detour to bring the cattle back to the village. The peasants are grateful for your help."),
       (assign, "$temp", "mesh_pic_villa"),
       (jump_to_menu, "mnu_freelancer_event_8_reaction"),
        ]),
      ("continue",[],"Sell it at the nearest market and divide up the money with your soldiers.",
       [
      (try_begin),
        (lt, "$player_honor", -10),
        (call_script, "script_change_player_honor", -1),
      (try_end),
      (troop_add_gold, "trp_player", 5000),
      (call_script, "script_freelancer_add_progress", 5),
       (str_store_string, s1, "@After selling off the animals, all of you are slightly heavier with silver. You make up a story to explain the delay in completing your mission and the denarii in your soldiers' pockets helps everyone back it up. Cattle? What cattle? We didn't see any cattle."),
       (assign, "$temp", "mesh_pic_cattle"),
       (jump_to_menu, "mnu_freelancer_event_8_reaction"),
        ]),

     ]
),
(
    "freelancer_task_patrol_peasant",0,
    "The patrol is uneventful, until a fellow soldier points to a man, hiding in the shrubs along your route. He tries to flee, almost getting to his nearby horse before your soldiers apprehend him. ^^When questioned, he claims to be a peasant from the nearby village, just out collecting firewood. No firewood is found, which he explains by saying he just got here when he heard you marching and wanted to look.",
    "none",
    [  (set_background_mesh, "mesh_pic_deserters"),
      ],
    [
      ("continue",[]," Let the peasant go.",
       [
      (store_random_in_range, ":r", 0, 2),
      (try_begin),
        (eq, ":r", 0),
        (display_message, "@The peasant was probably an enemy scout. The patrol is ambushed.", color_bad_news),
        (jump_to_menu, "mnu_freelancer_task_patrol"),
      (else_try),
        (jump_to_menu, "mnu_freelancer_task_patrol_peasant_innocent"),
      (try_end),
        ]),
      ("continue",[],"He is clearly a spy, torture him until he gives up the ambush location.",
       [
      (store_random_in_range, ":r", 0, 2),
      (try_begin),
        (eq, ":r", 0),
        (jump_to_menu, "mnu_freelancer_task_patrol_peasant_torture"),
      (else_try),
        (jump_to_menu, "mnu_freelancer_task_patrol_peasant_bandit"),
      (try_end),
        ]),

     ]
),
 (
    "freelancer_task_patrol_peasant_bandit",0,
    "The fake peasant is actually an enemy scout and confesses everything after enough pain. Once you know the location of their ambush, you carefully flank it and attack them unexpectedly from behind. Before the battle can really get underway, the entire bandit contingent surrenders in horror. Your unit is given a hero's welcome back at camp, as you parade the captives along the castra's main street.",
    "none",
    [
      ],
    [
      ("continue",[],"Continue.",
       [
      (add_xp_as_reward, 150),
      (try_begin),
        (gt, "$player_honor", -20),
        (call_script, "script_change_player_honor", -1),
      (try_end),
      (call_script, "script_freelancer_add_progress", 25),
      (change_screen_map),
        ]),

     ]
),
(
    "freelancer_task_patrol_peasant_innocent",0,
    "The peasant thanks you and offers endless apologies for behaving suspiciously without realizing it. Your patrol finishes without further incident.",
    "none",
    [  (set_background_mesh, "mesh_pic_deserters"),
      ],
    [
      ("continue",[],"Continue.",
       [
      (add_xp_as_reward, 150),
      (try_begin),
        (lt, "$player_honor", 10),
        (call_script, "script_change_player_honor", 1),
      (try_end),
      (call_script, "script_freelancer_add_progress", 5),
      (change_screen_map),
        ]),

     ]
),
(
    "freelancer_task_patrol_peasant_torture",0,
    "The peasant cries in pain for hours as you do disturbing things to him, and it eventually becomes clear he has nothing to give up. You release him and finish the patrol. ^^The commander gives you a thorough chewing out for taking too long to complete your task, but it is nothing compared to the shitstorm you must face the next day when the village representatives tell your commander the rest of the story.",
    "none",
    [  (set_background_mesh, "mesh_pic_deserters"),
      ],
    [
      ("continue",[],"Continue.",
       [
      (add_xp_as_reward, 150),
      (try_begin),
        (gt, "$player_honor", -20),
        (call_script, "script_change_player_honor", -1),
      (try_end),
      (call_script, "script_freelancer_add_progress", -3),
      (change_screen_map),
        ]),

     ]
),

(
    "freelancer_task_patrol_peasant_ignored",0,
    "You send the peasants away. They seem to be angry about your laziness. Your boring patrol continues and soon you march back to the legion.",
    "none",
    [  (set_background_mesh, "mesh_pic_deserters"),
      ],
    [
      ("continue",[],"Continue.",
       [
      (call_script, "script_get_closest_center", "$enlisted_party"),
      (assign, ":center", reg0),
      (try_begin),
        (is_between, ":center", centers_begin, centers_end),
        (call_script, "script_change_player_relation_with_center", ":center", -1),
      (try_end),
      (call_script, "script_freelancer_add_progress", 5),
      (change_screen_map),
        ]),

     ]
),
(
    "freelancer_task_patrol_rider_ignored",0,
    "Either the rider was just a common traveler, or the enemies consider your force as to strong to ambush it. In any case, after hours of marching around in the wilderness your patrol task comes to an end.",
    "none",
    [  (set_background_mesh, "mesh_pic_deserters"),
      ],
    [
      ("continue",[],"Continue.",
       [
      (call_script, "script_freelancer_add_progress", 5),
      (change_screen_map),
        ]),

     ]
),
(   "freelancer_task_patrol_rider_interrogate",0,
    "As you approach the rider {s1}",
    "none",
    [
    (set_background_mesh, "mesh_pic_deserters"),
    (store_random_in_range, "$temp1", 0, 3),
    (try_begin),
      (eq, "$temp1", 0),
      (str_store_string, s1, "@he greets you. He can answer all questions: where he comes from, where he travels to etc. He seems to be on the way from his village to the a near town."),
    (else_try),
      (eq, "$temp1", 1),
      (str_store_string, s1, "@he greets you. He seems to be nervous while answering the questions. He quickly hides in contradictions."),
    (else_try),
      (eq, "$temp1", 2),
      (str_store_string, s1, "@he gallops away. You can only watch him disappear at the horizon."),
    (try_end),
      ],
    [
      ("continue",[(eq, "$temp1", 2),],"Hopefully he wasn't an enemy scout.",
       [
      (store_random_in_range, ":r", 0, 10),
      (try_begin),
        (le, ":r", 7),
        (display_message, "@The rider was probably an enemy scout. Your patrol is ambushed.", color_bad_news),
        (jump_to_menu, "mnu_freelancer_task_patrol"),
      (else_try),
        (jump_to_menu, "mnu_freelancer_task_patrol_rider_ignored"),
      (try_end),
        ]),
      ("continue",[(neq, "$temp1", 2),],"Let him go, he seems to be a commoner.",
       [
     (try_begin),
      (eq, "$temp1", 1),
      (store_random_in_range, ":r", 0, 10),
      (try_begin),
        (le, ":r", 7),
        (display_message, "@The rider was probably an enemy scout. Your patrol is ambushed.", color_bad_news),
        (jump_to_menu, "mnu_freelancer_task_patrol"),
      (else_try),
        (jump_to_menu, "mnu_freelancer_task_patrol_rider_ignored"),
      (try_end),
    (else_try),
      (eq, "$temp1", 0),
      (store_random_in_range, ":r", 0, 10),
      (try_begin),
        (le, ":r", 1),
        (display_message, "@Nevertheless, the rider seems to have been an enemy scout!", color_bad_news),
        (jump_to_menu, "mnu_freelancer_task_patrol"),
      (else_try),
        (jump_to_menu, "mnu_freelancer_task_patrol_rider_ignored"),
      (try_end),
    (try_end),
        ]),
     ("continue",[(neq, "$temp1", 2),],"Imprison him. He is clearly a bandit.",
       [
    (try_begin),
      (eq, "$temp1", 1),
      (store_random_in_range, ":r", 0, 10),
      (try_begin),
        (le, ":r", 1),
        (jump_to_menu, "mnu_freelancer_task_patrol_rider_commoner"),
      (else_try),
        (jump_to_menu, "mnu_freelancer_task_patrol_rider_bandit"),
      (try_end),
    (else_try),
      (eq, "$temp1", 0),
      (store_random_in_range, ":r", 0, 10),
      (try_begin),
        (le, ":r", 8),
        (jump_to_menu, "mnu_freelancer_task_patrol_rider_commoner"),
      (else_try),
        (jump_to_menu, "mnu_freelancer_task_patrol_rider_ignored"),
      (try_end),
    (try_end),
        ]),

     ]
),

("freelancer_task_patrol_avoided",0,
    "Either due to your caution or the fact that the hostile party don't want to fight today you manage to avoid an encounter. No fight means no wounds and no risk to die. But you also lose a chance to proof yourself.",
    "none",
    [
    (set_background_mesh, "mesh_pic_deserters"),

      ],
    [
      ("continue",[],"Continue.",
       [
       (call_script, "script_freelancer_add_progress", 6),
       (change_screen_map),
        ]),

     ]
),
("freelancer_task_patrol_nothing",0,
    "As you catch up, the armed men lay down their weapons and submit to your inspection. There is nothing to suggest they are bandits or otherwise engaged in anything illegal, so you let them go.",
    "none",
    [
    (set_background_mesh, "mesh_pic_deserters"),

      ],
    [
      ("continue",[],"Continue.",
       [
       (add_xp_as_reward, 150),
       (call_script, "script_freelancer_add_progress", 6),
       (change_screen_map),
        ]),

     ]
),
(
    "freelancer_task_patrol",0,
    "As the patrol round a bend in the path, you see an opposing party lined up to meet you. It is too late to retreat. Missiles rain down around you. It's time for a fight.",
    "none",
    [

    (set_background_mesh, "mesh_pic_charge"),

    (try_begin),
      (call_script, "script_get_closest_center", "p_main_party"),
      (assign, ":town", reg0),
      (store_distance_to_party_from_party,":distance", ":town", "p_main_party"),
      (lt, ":distance", 20),
      (try_begin),
        (party_slot_eq, ":town", slot_center_culture, "fac_culture_2"),
        (assign, "$temp1", "trp_celtic_freeman"),
      (else_try),
        (party_slot_eq, ":town", slot_center_culture, "fac_culture_2_1"),
        (assign, "$temp1", "trp_caledonian_light_clubman"),
      (else_try),
        (party_slot_eq, ":town", slot_center_culture, "fac_culture_4"),
        (assign, "$temp1", "trp_germanic_free_spearman"),
      (else_try),
        (this_or_next|party_slot_eq, ":town", slot_center_culture, "fac_culture_1"),
        (this_or_next|party_slot_eq, ":town", slot_center_culture, "fac_culture_9"),
        (party_slot_eq, ":town", slot_center_culture, "fac_culture_3"),
        (assign, "$temp1", "trp_steppe_bandit"),
      (else_try),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_asia_arab),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_asia_jude),
        (party_slot_eq, ":town", slot_center_province, p_asia_syr),
        (assign, "$temp1", "trp_mountain_bandit"),
      (else_try),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_balk_thrac),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_balk_moesia_sup),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_balk_epir),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_balk_mac),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_balk_dalm),
        (party_slot_eq, ":town", slot_center_province, p_balk_moesia_inf),
        (assign, "$temp1", "trp_taiga_bandit"),
      (else_try),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_hisp_tarraco),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_hisp_lusit),
        (party_slot_eq, ":town", slot_center_province, p_hisp_baetica),
        (assign, "$temp1", "trp_forest_bandit"),
      (else_try),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_afrc_maur),
        (party_slot_eq, ":town", slot_center_province, p_afrc_afrc),
        (assign, "$temp1", "trp_gaetuli_horseman"),
      (else_try),
        (party_slot_eq, ":town", slot_center_province, p_afrc_cyre),
        (assign, "$temp1", "trp_sarranid_horseman"),
      (else_try),
        (party_slot_eq, ":town", slot_center_province, p_afrc_egyp),
        (store_random_in_range, ":r", 0, 3),
        (try_begin),
            (eq, ":r", 1),
            (assign, "$temp1", "trp_egyptian_infantry_heavy"),
        (else_try),
            (eq, ":r", 0),
            (assign, "$temp1", "trp_meroe_infantry"),
        (else_try),
            (assign, "$temp1", "trp_meroe_axemen"),
        (try_end),
      (else_try),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_asia_minor),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_asia_pontus),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_asia_capa),
        (this_or_next|party_slot_eq, ":town", slot_center_province, p_asia_cili),
        (party_slot_eq, ":town", slot_center_province, p_balk_acha),
        (assign, "$temp1", "trp_sea_raider"),
      (else_try),
        (party_slot_eq, ":town", slot_center_culture, "fac_culture_7"),
        (assign, "$temp1", "trp_slave_rebel"),
      (else_try),
        (this_or_next|party_slot_eq, ":town", slot_center_culture, "fac_culture_5"),
        (party_slot_eq, ":town", slot_center_culture, "fac_culture_6"),
        (assign, "$temp1", "trp_bandit"),
      (else_try),
        (party_get_current_terrain,":terrain", "p_main_party"),
        (this_or_next|eq, ":terrain", rt_desert),
        (eq, ":terrain", rt_desert_forest),
        (assign, "$temp1", "trp_desert_bandit"),
      (else_try),
        (assign, "$temp1", "trp_looter"),
      (try_end),
    (else_try),
      (store_random_in_range, ":r", 1, 4),
      (try_begin),
        (eq, ":r", 1),
        (assign, "$temp1", "trp_looter"),
      (else_try),
        (eq, ":r", 2),
        (assign, "$temp1", "trp_bandit"),
      (else_try),
        (eq, ":r", 3),
        (assign, "$temp1", "trp_brigand"),
      (try_end),
    (try_end),
   # (str_store_troop_name_plural, s2, "$temp1"),
    (store_random_in_range, "$temp2", 20, 31),
      ],
    [
      ("continue",[],"Fight.",
      [
        (assign, "$g_arena_training_kills", 0),
        (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
        (assign, "$talk_context", 0),#fix a possible bug
        (call_script, "script_setup_random_scene_native"),
        (assign,":scene_to_use", reg0),
        (jump_to_scene, ":scene_to_use"),
        (modify_visitors_at_site,":scene_to_use"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
        (troop_get_slot, ":legion", ":lord", slot_troop_legion),
        (store_add, ":troop", ":legion", "trp_eastern_elite_infantry_vet"),
        (set_visitors, 0, ":troop", 21),
        (set_visitors, 3, "$temp1", "$temp2"),
        (set_jump_mission, "mt_freelancer_mission_bandit"),
        (change_screen_mission),
      ]),
]),

("freelancer_task_tribute_fight",0,
    "Now it is too late to retreat. Missiles rain down around you. It's time for a fight and crush this small uprising.",
    "none",
    [

    (set_background_mesh, "mesh_pic_charge"),

      ],
    [
      ("continue",[],"Fight.",
       [
    (assign, ":min_distance", 9999999),
    (assign, ":center", -1),
    (try_for_range, ":center_no", villages_begin, villages_end),
        (store_distance_to_party_from_party, ":party_distance", "$enlisted_party", ":center_no"),
        (lt, ":party_distance", ":min_distance"),
        (assign, ":min_distance", ":party_distance"),
        (assign, ":center", ":center_no"),
    (try_end),

    (party_get_slot, ":fac", ":center", slot_center_culture),
    (faction_get_slot, ":enemy", ":fac", slot_faction_tier_1_troop),
    (store_random_in_range, ":number", 20, 31),

    (assign, "$g_arena_training_kills", 0),
    (assign, "$g_encountered_party", "$enlisted_party"),#to fix bug in dialog
    (assign, "$talk_context", 0),#fix a possible bug

    (party_get_slot,":scene_to_use", ":center", slot_castle_exterior),
    (jump_to_scene, ":scene_to_use"),
    (modify_visitors_at_site,":scene_to_use"),
    (reset_visitors),
    (set_visitor, 0, "trp_player"),
    (quest_get_slot, ":lord", "qst_freelancing", slot_quest_giver_troop),
    (troop_get_slot, ":legion", ":lord", slot_troop_legion),
    (store_add, ":troop", ":legion", "trp_eastern_elite_infantry_vet"),
    (set_visitors, 0, ":troop", 21),
    (set_visitors, 3, ":enemy", ":number"),
    (set_jump_mission, "mt_freelancer_mission_bandit"),
    (change_screen_mission),
        ]),

     ]
),
(
    "freelancer_task_patrol_rider_commoner",0,
    "You imprison the rider. It turns out he is indeed a local commoner. He seems to have a wealthy patron, who is angry about your abuse of office.",
    "none",
    [
    (set_background_mesh, "mesh_pic_deserters"),
      ],
    [
      ("continue",[],"Continue.",
       [
      (add_xp_as_reward, 150),
      (call_script, "script_freelancer_add_progress", -3),
      (change_screen_map),
        ]),

     ]
),
(
    "freelancer_task_patrol_rider_bandit",0,
    "You imprison the rider. It turns out the rider is a local bandit, who is accused for many crimes. He is crucified next to the road.",
    "none",
    [
    (set_background_mesh, "mesh_pic_kreuzigung"),
      ],
    [
      ("continue",[],"Continue.",
       [
      (add_xp_as_reward, 150),
      (call_script, "script_freelancer_add_progress", 25),
      (change_screen_map),
        ]),

     ]
),

(
    "go_hunting",0,
    "You can try your luck and search for animals in a nearby grove.",
    "none",
    [
    (set_background_mesh, "mesh_pic_deserters"),
      ],
    [
      ("continue",[],"Continue...",
       [
        (call_script, "script_start_hunting"),
        ]),
      ("continue",[],"Go back.",
       [
        (jump_to_menu, "mnu_camp"),
        ]),

     ]
),

(
    "freelancer_task_hunt",0,
    "Food supplies are low and you are ordered to hunt animals in a nearby forest.^^You recieve a bow, arrows and a boar spear as weapons.",
    "none",
    [
    (set_background_mesh, "mesh_pic_deserters"),
      ],
    [
      ("continue",[],"Continue...",
       [
        (call_script, "script_start_hunting"),
        ]),

     ]
),
("after_hunt",0,
  "{!}{s1}",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
    (try_begin),
      (neg|check_quest_active, "qst_freelancing"),
      (eq, "$loot_screen_shown", 0),
      (assign, "$loot_screen_shown", 1),
      (gt, "$hunted_animals", 0),
      (change_screen_loot, "trp_temp_troop"),
    (else_try),
      (gt, "$hunted_animals", 0),
      (assign, reg6, "$hunted_animals"),
      (try_begin),
        (check_quest_active, "qst_freelancing"),
        (store_mul, reg11, 6, "$hunted_animals"),
        (call_script, "script_freelancer_add_progress", reg11),
        (str_store_string, s1, "@You complete your task. You successfully hunted {reg6} animals. You gain {reg11} progress points."),
      (else_try),
        (str_store_string, s1, "@You successfully hunted {reg6} animals."),
      (try_end),
    (else_try),
      (try_begin),
        (check_quest_active, "qst_freelancing"),
        #(store_mul, reg1, "$hunted_animals"),
        (str_store_string, s1, "@You failed your task and have lost track of the animals. You lose 2 progress points."),
        (call_script, "script_freelancer_add_progress", -2),
      (else_try),
        (str_store_string, s1, "@You have lost track of the animals."),
      (try_end),
    (try_end),
  ],[
    ("continue",[],"Continue.",[
      (party_clear, "p_dhorak_keep"),
      (change_screen_map),
    ]),
]),

("desert_hunt_end",0,
  "{!}{s22}",
  "none",[
    (try_begin),
      (party_get_current_terrain, ":terrain", "p_main_party"),
      (this_or_next|eq, ":terrain", rt_desert),
      (eq, ":terrain", rt_desert_forest),
      (set_background_mesh, "mesh_pic_desert"),
    (else_try),
      (set_background_mesh, "mesh_pic_deserters"),
    (try_end),
    (quest_get_slot, ":lord", "qst_elephant_hunt", slot_quest_giver_troop),
    (try_begin),
      (eq, "$loot_screen_shown", 0),
      (assign, "$loot_screen_shown", 1),
      (gt, "$hunted_animals", 0),
      (change_screen_loot, "trp_temp_troop"),
      (display_message, "@Your recieve your reward."),
    (else_try),
      (gt, "$hunted_animals", 0),
      (assign, reg6, "$hunted_animals"),

      (quest_get_slot, ":animal", "qst_elephant_hunt", slot_quest_target_troop),
      (str_store_troop_name_plural, s34, ":animal"),

      (str_store_string, s22, "@You successfully hunted {reg6} {s34}! Your hunting party returns to the settlement. The people cheer and celebrate the successful hunt. A small feast is hosted to honor and praise the gods."),
      (call_script, "script_change_player_relation_with_troop", ":lord", 5),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (store_faction_of_troop, ":fac", ":lord"),
      (call_script, "script_change_player_relation_with_faction", ":fac", 3),
      (call_script, "script_succeed_quest", "qst_elephant_hunt"),
      (call_script, "script_end_quest", "qst_elephant_hunt"),
    (else_try),
      (str_store_string, s22, "@You failed your task and have lost track of the animals. Your comrades claim it was your fault that the hunt failed. The king clearly isn't happy about the outcome."),
      (call_script, "script_change_player_relation_with_troop", ":lord", -4),
      (call_script, "script_fail_quest", "qst_elephant_hunt"),
      (call_script, "script_end_quest", "qst_elephant_hunt"),
    (try_end),
  ],[
    ("continue",[],"Continue.",[
      (party_clear, "p_dhorak_keep"),
      (change_screen_map),
    ]),
]),

("desert_hunt_1",0,
    "The hunting party leaves the settlement. After a while, you spot {s34} in the distance.",
    "none",
    [
      (quest_get_slot, ":animal", "qst_elephant_hunt", slot_quest_target_troop),
      (str_store_troop_name_plural, s34, ":animal"),
      (try_begin),
        (party_get_current_terrain, ":terrain", "p_main_party"),
        (this_or_next|eq, ":terrain", rt_desert),
        (eq, ":terrain", rt_desert_forest),
        (set_background_mesh, "mesh_pic_desert"),
      (else_try),
        (set_background_mesh, "mesh_pic_deserters"),
      (try_end),
    ],
    [
      ("continue",[],"Continue.",
        [
        (troop_clear_inventory, "trp_temp_troop"),
        (assign, "$loot_screen_shown", 0),
        (call_script, "script_setup_random_scene_native"),
        (jump_to_scene, reg0),
        (modify_visitors_at_site, reg0),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_jump_mission,"mt_hunting_elephants"),
        (change_screen_mission),
        ]
      ),

    ]
  ),
(
    "freelancer_task_training",0,
    "Every day a training session is held, where two groups of soldiers fight with each other.",
    "none",
    [
    (set_background_mesh, "mesh_pic_mb_warrior_2"),
    (call_script, "script_party_count_members_with_full_health", "$enlisted_party"),
    (assign, "$temp", reg0),
      ],
    [
      ("op1",[(ge, "$temp", 1),

      ],"Fight alone against one opponent.",
       [
       (call_script, "script_training_freelancer", 0, 1),
        ]),
     ("op1",[(ge, "$temp", 2),

      ],"Fight alone against two opponents.",
       [
       (call_script, "script_training_freelancer", 0, 2),
        ]),
      ("op1",[(ge, "$temp", 4),

      ],"Fight alone against four opponents.",
       [
       (call_script, "script_training_freelancer", 0, 4),
        ]),
      ("op1",[(ge, "$temp", 6),

      ],"Fight alone against six opponents.",
       [
       (call_script, "script_training_freelancer", 0, 6),
        ]),

      ("op1",[(ge, "$temp", 20),

      ],"Participate in the 10 vs 10 fight.",
       [
       (call_script, "script_training_freelancer", 9, 10),
        ]),

      ("op2",[(ge, "$temp", 40),],"Participate in the 20 vs 20 fight.",
       [
       (call_script, "script_training_freelancer", 19, 20),
        ]),
      ("op3",[(ge, "$temp", 80),],"Participate in the 40 vs 40 fight.",
       [
       (call_script, "script_training_freelancer", 39, 40),
        ]),
      ("op4",[(ge, "$temp", 160),],"Participate in the 80 vs 80 fight.",
       [
       (call_script, "script_training_freelancer", 79, 80),
        ]),
      ("op5",[],"Go back.",
       [
        (jump_to_menu, "mnu_freelancer_weekly_duty"),
        ]),

     ]
),

(
    "freelancer_task_training_debrief",0,
    "The training is over. You defeated {reg1} opponents.",
    "none",
    [
    (set_background_mesh, "mesh_pic_mb_warrior_2"),
    (assign, reg1, "$g_arena_training_kills"),
      ],
    [
      ("continue",[],"Continue...",
       [
        (add_xp_as_reward, 250),
        (val_add, "$g_arena_training_kills", 1),
        (call_script, "script_freelancer_add_progress", "$g_arena_training_kills"),
        (change_screen_map),
        ]),

     ]
),

(
    "freelancer_task_tribute_retreat",0,
    "Your force retreats back to the legion camp. The other officers call you a coward because you ran away from peasants.^More troops are send to the village to punish them properly."+
    " As the peasants see the overwhelming force approaching they surrender.^As punishment they are forced to kiss the eagle of the legion. Double the amount of the tribute is taking from them."+
    " Half of their wives and children is enslaved and their elder is crucified.",
    "none",
    [
      ],
    [
      ("continue",[],"Continue...",
       [
        (call_script, "script_change_troop_renown", "trp_player", -2),
        (add_xp_as_reward, 50),
        (change_screen_map),
        ]),

     ]
),
(
    "freelancer_task_failed",0,
    "You managed to defeat {reg24} enemies, but it wasn't enough. Your patrol was defeated, but luckily you survived. As punishment you get less rations for the next days.",
    "none",
    [
    (assign, reg24, "$g_arena_training_kills"),
    (set_background_mesh, "mesh_pic_defeat"),
    #(val_sub, "$g_arena_training_kills", 3),
    (call_script, "script_freelancer_add_progress", "$g_arena_training_kills"),
      ],
    [
      ("continue",[],"Continue...",
       [
        (add_xp_as_reward, 50),
        (change_screen_map),
        ]),

     ]
),

(
    "freelancer_task_completed",0,
    "You managed to defeat {reg24} enemies and the ambush was defeated. As a reward, you get a bag of denars and extra rations for today.",
    "none",
    [
    (assign, reg24, "$g_arena_training_kills"),
    (set_background_mesh, "mesh_pic_victory"),
    (val_add, "$g_arena_training_kills", 7),
    (call_script, "script_freelancer_add_progress", "$g_arena_training_kills"),
    (troop_add_gold, "trp_player", 250),
    (add_xp_as_reward, 250),
      ],
    [
      ("continue",[],"Continue...",
       [
        (change_screen_map),
        ]),

     ]
),

##pharaoh ceremony events
("pharaoh_event_1",0,
  "The whole of Egypt is shocked by such blatant disregard of their traditions. News of your insulting behavior spreads and your numerous enemies are quick to jump on the opportunity, adding oil into the fire and stirring unrest."
  +"^^Before long, there are rebellions breaking out all over the province. Troops loyal to you are tied up in the fighting, thousands are slaughtered, villages razed and crops burned down."
  +" {s25}",
  "none",[
    (try_begin),
        (ge, "$g_is_emperor", 1),
        (str_store_string, s25,
        "@Rome's precious supply of grain is disrupted and difficult to replace, causing unrest in the eternal city itself. Soon, Rome's streets are filled with riotous mobs and awash in blood."
        +"^^None of this helps anyone see you as a true Caesar, a true Augustus, a true Princeps."),
    (else_try),
        (str_store_string, s25, "@This is a disastrous day for your rule."),
    (try_end),
    (set_background_mesh, "mesh_pic_pyramid"),
  ],[
  ("continue",[],"Continue...",[
    (call_script, "script_change_player_relation_with_center", "p_town_48", -25),#theben
    (call_script, "script_change_player_relation_with_center", "p_town_20", -25),#alexandria

    (try_begin),
        (ge, "$g_is_emperor", 1),
        (call_script, "script_change_player_relation_with_center", "p_town_6", -12),#Rome
    (try_end),
    (set_spawn_radius, 10),

    (try_begin),
        (store_num_parties_of_template, ":num_parties", "pt_rebels"),
        (lt, ":num_parties", 30),
        (call_script, "script_spawn_party","p_town_20","pt_rebels"),
    (try_end),

    (call_script, "script_spawn_party","p_town_48","pt_egyptian_rebels"),
    (call_script, "script_spawn_party","p_town_48","pt_egyptian_rebels"),
    (call_script, "script_spawn_party","p_town_48","pt_egyptian_rebels"),

    (try_begin),
        (store_num_parties_of_template, ":num_parties", "pt_rebels"),
        (lt, ":num_parties", 30),
        (call_script, "script_spawn_party","p_town_20","pt_rebels"),
    (try_end),

    (call_script, "script_spawn_party","p_town_20","pt_egyptian_rebels"),
    (call_script, "script_spawn_party","p_town_20","pt_egyptian_rebels"),
    (call_script, "script_spawn_party","p_town_20","pt_egyptian_rebels"),
    (val_add, "$g_unrest", 5),
    (display_message, "@Stability of the Empire decreases", color_bad_news),
    (call_script, "script_change_center_prosperity", "p_town_20", -5),
    (call_script, "script_end_quest", "qst_become_pharao"),
    (call_script, "script_change_player_right_to_rule", -15),
    (change_screen_map),
  ]),
]),

("pharaoh_event_2",0,
  "You finance a lavish festival while the best of Egypt's priests and scholars find elaborate ways to absolutely minimize the time necessary to conduct all ceremonies without offending traditions too much."
  +" Your haste raises a few eyebrows and there is a disgruntled minority of traditionalists, but overall the ceremony is a success. You presented before the people of Egypt wearing the double crown and they have recognized you as a god."
  +" {s25}",
  "none",[
    (set_background_mesh, "mesh_pic_pyramid"),
    (try_begin),
        (ge, "$g_is_emperor", 1),
        (str_store_string, s25, "@The province is at peace and steady supplies of grain flow to Rome, buying the loyalty of its people."),
    (else_try),
        (str_store_string, s25, "@The land of Egypt is at peace."),
    (try_end),
    (set_background_mesh, "mesh_pic_pyramid"),
  ],[
  ("continue",[],"Continue...",[
    (add_xp_as_reward, 250),
    (call_script, "script_change_player_relation_with_center", "p_town_48", 10),#theben
    (call_script, "script_change_player_relation_with_center", "p_town_20", 10),#alexandria
    (val_sub, "$g_unrest", 2),
    (display_message, "@Stability of the Empire increases", color_good_news),
    (call_script, "script_change_center_prosperity", "p_town_20", 2),
    (call_script, "script_end_quest", "qst_become_pharao"),
    (quest_set_slot, "qst_become_pharao", slot_quest_target_state, 1),
    (troop_add_item, "trp_player", "itm_pharaoh_crown", 0),
    (call_script, "script_change_player_right_to_rule", 2),
    (call_script, "script_change_senate_support", 2, 0),
    (call_script, "script_change_troop_renown", "trp_player", 100),
    (call_script, "script_start_ceremnoy_pharao"),
  ]),
]),

("pharaoh_event_3",0,
  "The Egyptian nobility resents having to pay for your celebration, but they have little choice. Egypt's priests and scholars find elaborate ways to absolutely minimize the time necessary to conduct all ceremonies without offending traditions too much."
  +" Your haste raises a few eyebrows and there is a disgruntled minority of traditionalists, but overall the ceremony is a success. You presented before the people of Egypt wearing the double crown and they have recognized you as a god."
  +" {s25}",
  "none",[
    (set_background_mesh, "mesh_pic_pyramid"),
    (try_begin),
        (ge, "$g_is_emperor", 1),
        (str_store_string, s25, "@The province is at peace and steady supplies of grain flow to Rome, buying the loyalty of its people."),
    (else_try),
        (str_store_string, s25, "@The land of Egypt is at peace."),
    (try_end),
  ],[
  ("continue",[],"Continue...",[
    (add_xp_as_reward, 250),
    (call_script, "script_change_player_relation_with_center", "p_town_48", -5),#theben
    (call_script, "script_change_player_relation_with_center", "p_town_20", -5),#alexandria
    (val_sub, "$g_unrest", 2),
    (display_message, "@Stability of the Empire increases", color_good_news),
    (call_script, "script_change_center_prosperity", "p_town_20", 2),
    (call_script, "script_end_quest", "qst_become_pharao"),
    (troop_add_item, "trp_player", "itm_pharaoh_crown", 0),
    (call_script, "script_change_player_right_to_rule", 2),
    (call_script, "script_change_senate_support", 2, 0),
    (call_script, "script_change_troop_renown", "trp_player", 100),
    (call_script, "script_start_ceremnoy_pharao"),
  ]),
]),

("pharaoh_event_4",0,
  "The festival richly predisposes all involved towards you with fancy food and drinks, musicians play, dancers perform."
  +" Finally, it is time for the ceremony to begin.^^{s1}",
  "none",[
    (set_background_mesh, "mesh_pic_pyramid"),
    (quest_get_slot, ":stage", "qst_become_pharao", slot_quest_current_state),
    (store_add, ":new_stage", ":stage", 1),
    (quest_set_slot, "qst_become_pharao", slot_quest_current_state, ":new_stage"),
    (store_sub, ":new_stage", ":stage", 2),
    (val_add, ":new_stage", "str_become_pharaoh_ceremony_text2"),
    (str_store_string, s1, ":new_stage"),
  ],[
  ("continue",[],"Continue...",[
    (add_xp_as_reward, 100),
    (try_begin),
      (quest_slot_ge, "qst_become_pharao", slot_quest_current_state, 7),
      (quest_set_slot, "qst_become_pharao", slot_quest_target_state, 1),
      (call_script, "script_end_quest", "qst_become_pharao"),
      (try_for_range, ":village", villages_begin, villages_end),
        (this_or_next|eq, ":village", "p_village_202"),
        (this_or_next|eq, ":village", "p_village_203"),
        (this_or_next|eq, ":village", "p_village_95"),
        (this_or_next|eq, ":village", "p_village_205"),
        (this_or_next|eq, ":village", "p_village_207"),
        (eq, ":village", "p_village_206"),
        (call_script, "script_change_player_relation_with_center", ":village", 5),
      (try_end),
    (try_end),
    (call_script, "script_change_player_relation_with_center", "p_town_48", 3),#theben
    (call_script, "script_change_player_relation_with_center", "p_town_20", 3),#alexandria
    (val_sub, "$g_unrest", 1),
    (display_message, "@Stability of the Empire increases", color_good_news),
    (call_script, "script_change_center_prosperity", "p_town_20", 1),
    (call_script, "script_change_player_right_to_rule", 1),
    (call_script, "script_change_senate_support", 1, 0),
    (call_script, "script_change_troop_renown", "trp_player", 30),

    (try_begin),
      (quest_slot_ge, "qst_become_pharao", slot_quest_current_state, 7),
      (call_script, "script_start_ceremnoy_pharao"),
      (troop_add_item, "trp_player", "itm_pharaoh_crown", 0),
    (else_try),
      (change_screen_map),
    (try_end),
  ]),
]),
###Disaster events for Latifundium
("event_latifundium_fire_damage",0,
  "Wildfires threaten {s11}^^Summer is the season of wild fires and every year thousands of estates are devastated by the flames. This year, fires burning near {s12} have approached close enough to threaten your {s11}."
  +"^^The flames could not be stopped and your latifundium has suffered expensive damage, as did other agricultural estates nearby. {s13} did manage to protect some of his own property with a private fire brigade, but not yours.",
  "none",[
    (str_store_party_name, s11, "$temp1"),
    (str_store_party_name, s12, "$temp2"),
    (party_get_slot, "$temp3", "$temp2", slot_town_lord),
    (str_store_troop_name_link, s13, "$temp3"),
    (set_background_mesh, "mesh_pic_wildfire"),
  ],[
    ("answere_1",[],"Pay for your own repairs. (pay 50,000 denars)",[
      (troop_remove_gold, "trp_player", 50000),
      (try_begin),
        (eq, "$g_is_emperor", 1),
        (str_store_string, s1, "@Your choice is appreciated by most, and reinforces the popular idea that the Princeps is not a king, but a first among equals."),
        (jump_to_menu, "mnu_event_juicio_end"),
      (else_try),
        (change_screen_map),
      (try_end),
    ]),
    ("answere_2",[  ],"Demand the governor pays for your repairs.",[
      (try_begin),
        (eq, "$g_is_emperor", 1),
        (call_script, "script_add_to_troop_wealth", "$temp3", -50000),
        (call_script, "script_change_player_relation_with_troop", "$temp3", -8),
        (str_store_string, s1, "@The governor protests, but is too smart to do so too loudly. The message sent is clear and the situation costs you nothing, at least not in silver."),
        (jump_to_menu, "mnu_event_juicio_end"),
      (else_try),
        (call_script, "script_change_player_relation_with_troop", "$temp3", -5),
        (troop_remove_gold, "trp_player", 50000),
        (str_store_string, s1, "@You try your best to lobby for your case but it seems you will never see a denar from {s13}. At the end, you have to repair the latifundium by yourself."),
        (jump_to_menu, "mnu_event_juicio_end"),
      (try_end),
    ]),
    ("answere_3",[(eq, "$g_is_emperor", 1),],"Remove the governor and make him pay a punitive amount. (gain 15,000 denars)",[
      (troop_add_gold, "trp_player", 15000),
      (call_script, "script_add_to_troop_wealth", "$temp3", -65000),
      (call_script, "script_change_player_relation_with_troop", "$temp3", -45),
      (call_script, "script_change_senate_support", -2, 0),

      (party_set_slot, "$temp2", slot_town_lord, -1),
      (call_script, "script_update_all_notes"),

      (call_script, "script_change_relation_with_family_friends_enemies", "$temp3", -1, 10, "trp_player"),
      # # # reduce the player's relationship with every hero, companion, lady, and daughter
      # (try_for_range, ":troop", heroes_begin, kingdom_ladies_end),
        # # don't make the dead any angrier than they already are!
        # (neg|troop_slot_eq, ":troop", slot_troop_occupation, dplmc_slto_dead),
      # #only for family members a relation drop
        # (try_begin),
          # (call_script, "script_dplmc_troop_get_family_relation_to_troop", ":troop", "$temp3"),
          # (gt, reg0, 0),
          # (assign, ":family_relation", reg0),
          # (val_mul, ":family_relation", -1),
          # (call_script, "script_change_player_relation_with_troop", ":troop", ":family_relation"),
        # (else_try),#and friends
          # (call_script, "script_troop_get_relation_with_troop", ":troop", "$temp3"),
          # (try_begin),
            # (ge, reg0, 10),
            # (store_div, ":relation_lose", reg0, 2),
            # (val_sub, ":relation_lose", 3),
            # (val_clamp, ":relation_lose", 1, 9),
            # (val_mul, ":relation_lose", -1),
            # (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_lose"),
          # (else_try),#enemies of him like you
            # (lt, reg0, 0),
            # (assign, ":relation_gain", reg0),
            # (val_abs, ":relation_gain"),
            # (val_div, ":relation_gain", 2),
            # (val_sub, ":relation_gain", 3),
            # (val_clamp, ":relation_gain", 1, 9),
            # (call_script, "script_change_player_relation_with_troop", ":troop", ":relation_gain"),
         # (try_end),
       # (try_end),
     # (try_end),
     # (str_store_troop_name, s44, "$temp3"),
     # (display_message, "@The enemies of {s44} like you for your support."),
      (str_store_string, s1, "@The governor has failed in his most basic duty. He is forced to resign and pay such a high sum to you that it more than covers the cost of repairs. ^^This is not particularly popular among other noble families, who can see themselves easily being in this governor's shoes some day."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),

("event_latifundium_fire_nodamage",0,
  "Wildfires threaten {s11}^^ Summer is the season of wild fires and every year thousands of estates are devastated by the flames. This year, fires burning near {s12} have approached close enough to threaten your {s11}."
  +"^^Through the actions of a fire crew comprised mostly of men organized by {s13} to protect the village and surrounding areas, major damage to your property was avoided."
  +"^^This seems a good opportunity to build goodwill with the governor by sending him a gift for his help.",
  "none",[
    (str_store_party_name, s11, "$temp1"),
    (str_store_party_name, s12, "$temp2"),
    (party_get_slot, "$temp3", "$temp2", slot_town_lord),
    (str_store_troop_name_link, s13, "$temp3"),
    (set_background_mesh, "mesh_pic_wildfire"),
  ],[
    ("answere_1",[],"Send a letter to the governor, expressing your appreciation.",[
      (call_script, "script_change_player_relation_with_troop", "$temp3", 2),
      (str_store_string, s1, "@The governor is thankful for your recognition and replies humbly. Though he would not admit it, it is clear that your property was handled with the greatest care and protected at all costs, while others had to be abandoned to burn."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_2",[  ],"Send a gift to the governor. (25,000 denars)",[
      (troop_remove_gold, "trp_player", 25000),
      (call_script, "script_change_player_relation_with_troop", "$temp3", 10),
      (str_store_string, s1, "@The damages could have been devastating, as they were to some neighbouring latifundia. The governor's actions have saved you much money in repairs, so it would be reasonable to expect some reward. However, your generosity is not expected and the governor is delighted by the expensive gifts."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("continue",[],"Do nothing.",[
      (change_screen_map),
    ]),
]),
##end latifundium

##event for disasters in cities
("event_city_desaster_1",0,
  "Invasion of the Beetles^^The countryside around {s12} is being devastated by a previously unseen beetle. The insect hordes reproduce rapidly and leave nothing but devoured leaf skeletons behind them."
  +" This caused many commercially important crops to fail, hitting tax revenue, and worse yet, for many who farmed on the edge of subsistence, a season of starvation and death is on the horizon."
  +"^^The situation in the province is getting tense. There have been riots and robbers have gotten more common and brazen on the roads, including several attacks on military messengers and supply convoys.",
  "none",[
    (str_store_party_name, s12, "$temp1"),
    (set_background_mesh, "mesh_pic_wildfire"),
  ],[
    ("answere_1",[],"Do not get involved.",[
      (call_script, "script_change_center_prosperity", "$temp1", -85),
      (call_script, "script_change_player_relation_with_center", "$temp1", -20),
      (call_script, "script_spawn_looters", "$temp1", 6),
      (str_store_string, s1, "@The matter is left for the local authorities to handle. Whether from lack of resources or through mismanagement, the local response to this crisis proves insufficient. Many farmers are wiped out, and people facing starvation turn to violence, further demolishing what's left of the economy in the area. ^^Inside the city, food prices spike and hungry riots are repeatedly put down by the sword. ^^The citizens' trust in Rome and the Princeps is eroded, tax revenue drops, but somehow, the noble families in favor with the local governor end up owning even more land, having bought it at low prices during the crisis."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_2",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 75000),
    ],"Send food aid to the city. (75,000 denars)",[
      (call_script, "script_change_center_prosperity", "$temp1", -35),
      (call_script, "script_change_player_relation_with_center", "$temp1", 10),
      (call_script, "script_spawn_looters", "$temp1", 3),
      (troop_remove_gold, "trp_player", 75000),
      (str_store_string, s1, "@You order to pay food from nearby provinces and bring it into the city and distribute it to the needy. This helps blunt the impact of the crisis, at least inside the city walls, which swells with refugees from the countryside. ^^Your assistance is greatly appreciated by all, but the countryside is still devastated, and without it much of the province's economy is gone."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_2",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 250000),
    ],"Buy as much cheap farmland as possible. (250,000 denars)",[
      (call_script, "script_change_center_prosperity", "$temp1", -85),
      (call_script, "script_change_player_relation_with_center", "$temp1", -90),
      (call_script, "script_spawn_looters", "$temp1", 5),
      (set_spawn_radius, 2),
      (try_begin),
          (store_num_parties_of_template, ":num_parties", "pt_rebels"),
          (lt, ":num_parties", 30),
          (call_script, "script_spawn_party", "$temp1", "pt_rebels"),
      (try_end),
      (try_begin),
          (store_num_parties_of_template, ":num_parties", "pt_rebels"),
          (lt, ":num_parties", 30),
          (call_script, "script_spawn_party", "$temp1", "pt_rebels"),
      (try_end),
      (troop_remove_gold, "trp_player", 250000),
      (troop_add_gold, "trp_player", 400000),
      (str_store_string, s1, "@You let the disaster unfold as it will. Many farmers are wiped out, and people facing starvation turn to violence, further demolishing what's left of the economy in the area. ^^Inside the city, food prices spike and hungry riots are repeatedly put down by the sword.^^Your involvement buying up cheap land does not go unnoticed, and exactly nobody sees your actions as supporting falling land prices, so that people selling would make more money when selling. Instead, it is seen as marauding, profiteering, and behavior unworthy of a Caesar Augustus. ^^You make a lot of money by reselling the land after the crisis passes, but the whole province is now united in its hate of you."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("answere_2",[
      (store_troop_gold, ":g", "trp_player"),
      (ge, ":g", 300000),
    ],"Send enough aid. (300,000 denars)",[
      (call_script, "script_change_center_prosperity", "$temp1", -5),
      (call_script, "script_change_player_relation_with_center", "$temp1", 50),
      (troop_remove_gold, "trp_player", 300000),
      (str_store_string, s1, "@You use the funds to blunt the effects of the crisis with success.^^This helps soften the suffering, at least inside the city walls, which swells with refugees from the countryside. ^^Your assistance is greatly appreciated by all. The countryside is still devastated, and without it much of the province's economy is gone, but due to your efforts the city will soon recover and nobody was driven into banditry."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),

###minor faction incidents begin
("minor_faction_event_1",0,
  "Eat sheep and die^^The frontier between {s23} and {s11} always has some tension, but the current events are threatening to erupt into a full-scale war."
  +"^{s11} traders are occasionally allowed into village markets, and one came recently to sell mutton, which was good quality and promptly eaten by many villagers."
  +"^{s11}'s leaders now come to you with a diplomatic mission, explaining that this particular sheep was a holy animal, stolen from the tribe's priest. To partake its meat is the greatest sin imaginable."
  +" The thief has already been found and killed in the most painful fashion, but the {s11} leaders now demand to go into the village and track down every peasant who ate the mutton, then similarly execute them."
  +" If this is not done, the leaders themself risks being killed by his own angry people. This can easily lead to war.^^(current relation: {reg29})",
  "none",[
    (store_relation, reg29, "$players_kingdom", "$g_notification_menu_var1"),
    (str_store_faction_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_desert"),

    (faction_get_slot, ":culture", "$players_kingdom", slot_faction_culture),
    (str_store_faction_name, s23, "$players_kingdom"),
    (str_store_faction_name, s24, ":culture"),
    (str_store_party_name, s25, "$g_player_court"),
    (call_script, "script_print_culture_word", s26, ":culture", DPLMC_CULTURAL_TERM_KING),
  ],[
    ("answere_1",[],"Protect the {s24} subjects.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -50),
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (call_script, "script_change_player_relation_with_center", "$g_player_court", 2),
      (str_store_string, s1, "@You refuse the outrageous demands and explain that the full might of your forces will come crashing down on the {s11} camps if they choose to attack your subjects."
      +" The leader leaves solemn, forced to choose between two very bad outcomes."),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Sacrifice villagers to the nomads.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 60),
      (call_script, "script_change_troop_renown", "trp_player", -50),
      (call_script, "script_change_player_honor", -25),
      (call_script, "script_change_player_relation_with_center", "$g_player_court", -15),
      (str_store_string, s1, "@Your decision is met with disbelief all over {s25}. The choice to surrender {s24} villagers to a minor tribe is seen as a great humiliation and a sign of your weakness. The nomad leader appreciates your understanding, however."),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_3",[],"Execute the {s11}'s leaders.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -200),
      (call_script, "script_change_troop_renown", "trp_player", 75),
      (call_script, "script_change_player_relation_with_center", "$g_player_court", 4),
      (str_store_string, s1, "@No minor tribe gets to dictate such outrageous demands to a {s26}! The leader and his party are rounded up and killed on your command in front of the cheering crowd in {s25}. This means war."),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("minor_faction_event_2",0,
  "Tribal infighting at the borders of {s23}^^Reports indicate that beyond our frontier {s11} tribes are fighting among themselves for the position of leadership, following an unexpected shift in established power structures."
  +" Several sides have appealed to {s25} for assistance, which would likely ensure their victory.^^(current relation: {reg29})",
  "none",[
    (store_relation, reg29, "$players_kingdom", "$g_notification_menu_var1"),
    (str_store_faction_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_desert"),

    (faction_get_slot, ":culture", "$players_kingdom", slot_faction_culture),
    (str_store_faction_name, s23, "$players_kingdom"),
    (str_store_faction_name, s24, ":culture"),
    (str_store_party_name, s25, "$g_player_court"),
    (call_script, "script_print_culture_word", s26, ":culture", DPLMC_CULTURAL_TERM_KING),
  ],[
    ("answere_1",[
      (store_troop_gold,":g", "trp_player"),
      (ge,":g",10000),
    ],"Discretely help one side. (10,000 denars)",[
      (troop_remove_gold, "trp_player", 10000),
      (store_random_in_range, ":r", 0, 100),
      (try_begin),
        (le, ":r", 33),
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 50),
        (str_store_string, s1, "str_nomad_event_outcome_1"),
      (else_try),
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -10),
        (str_store_string, s1, "str_nomad_event_outcome_2"),
      (try_end),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Stay neutral, {s26} does not care.",[
      (store_random_in_range, ":r", 0, 100),
      (try_begin),
        (le, ":r", 33),
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -5),
        (str_store_string, s1, "str_nomad_event_outcome_3"),
      (else_try),
        (le, ":r", 66),
        (str_store_string, s1, "str_nomad_event_outcome_4"),
      (else_try),
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 5),
        (str_store_string, s1, "str_nomad_event_outcome_5"),
      (try_end),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_3",[
      (store_troop_gold,":g", "trp_player"),
      (ge,":g",50000),
    ],"Back {s25}'s friends with overwhelming force (50,000 denari)",[
      (troop_remove_gold, "trp_player", 50000),
      (store_random_in_range, ":r", 0, 100),
      (try_begin),
        (le, ":r", 94),
        (call_script, "script_change_troop_renown", "trp_player", 10),
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 120),
        (str_store_string, s1, "str_nomad_event_outcome_6"),
      (else_try),
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -90),
        (call_script, "script_change_troop_renown", "trp_player", -20),
        (str_store_string, s1, "str_nomad_event_outcome_7"),
      (try_end),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),

("minor_faction_event_3",0,
  "Coup opportunity^^Our relations with the {s11} have been strained recently. Now, sources among the nomads report that there is some discontent brewing with the current leadership."
  +" Your experts have studied the situation and believe a few well-placed donkeys loaded with gold can help install more friendly forces to power. Of course, the plan is not without risk."
  +" They ask for your permission to proceed.^^(current relation: {reg29})",
  "none",[
    (store_relation, reg29, "$players_kingdom", "$g_notification_menu_var1"),
    (str_store_faction_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_desert"),

    (faction_get_slot, ":culture", "$players_kingdom", slot_faction_culture),
    (str_store_faction_name, s24, ":culture"),
    (str_store_party_name, s25, "$g_player_court"),
    (call_script, "script_print_culture_word", s26, ":culture", DPLMC_CULTURAL_TERM_KING),
  ],[
    ("answere_1",[]," Install a friendly despot. (25,000 denars)",[
      (troop_remove_gold, "trp_player", 25000),
      (store_random_in_range, ":r", 0, 100),
      (try_begin),
        (le, ":r", 33),
        (call_script, "script_change_troop_renown", "trp_player", 10),
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -10),
        (str_store_string, s1, "str_nomad_event_outcome_8"),
      (else_try),
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 60),
        (call_script, "script_change_troop_renown", "trp_player", -20),
        (str_store_string, s1, "str_nomad_event_outcome_9"),
      (try_end),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Do not get involved, {s26} does not care.",[
      (change_screen_map),
    ]),
]),

("minor_faction_event_4",0,
  "Nomads bearing gifts^^A mission from the {s11} nomad tribes has arrived to see you. They send their utmost respect to the great {s26}, and bring expensive gifts, thoughtfully tailored to your tastes."
  +" It is a friendly gesture, apparently aiming to improve relations with you.^^(current relation: {reg29})",
  "none",[
    (store_relation, reg29, "$players_kingdom", "$g_notification_menu_var1"),
    (str_store_faction_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_desert"),

    (faction_get_slot, ":culture", "$players_kingdom", slot_faction_culture),
    (str_store_party_name, s25, "$g_player_court"),
    (call_script, "script_print_culture_word", s26, ":culture", DPLMC_CULTURAL_TERM_KING_PRAISE),
  ],[
    ("answere_1",[],"Accept the gifts.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 10),
      (str_store_string, s1, "@You accept the {s11} offerings and send back the mission with your thanks. It's nice to be recognized."),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Reject the gifts.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -30),
      (str_store_string, s1, "@The {s11} ambassador leaves, angered. War may not be far."),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_3",[],"Accept and send your own gifts.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 30),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (call_script, "script_change_player_relation_with_center", "$g_player_court", -5),
      (str_store_string, s1, "@The {s11} ambassador is delighted at your friendly gesture. Relations with these nomads are sure to improve, but some in {s25} question the appearance of putting yourself on the same level as their tribal leaders."),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),

("minor_faction_event_5",0,
  "Famine on the frontier^^Messages from the {s11} frontier have long indicated that the nomad tribes are suffering from hunger, caused by disease wiping out most animals in the region."
  +" The {s24} settled communities have also been suffering, and all spare grain has already been diverted to help them.^The {s11} nomads are now begging for urgent help to prevent mass starvation of their people,"
  +" as they have no one else to turn to. It is help, which you can only provide at the expense of grain shipments destined for {s25}. Although the people of {s25} will not die if you do so, the effects will be felt by the public,"
  +" and there will be political consequences.^^(current relation: {reg29})",
  "none",[
    (store_relation, reg29, "$players_kingdom", "$g_notification_menu_var1"),
    (str_store_faction_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_desert"),
    (play_sound, "snd_disease_sound"),

    (faction_get_slot, ":culture", "$players_kingdom", slot_faction_culture),
    (str_store_faction_name, s24, ":culture"),
    (str_store_party_name, s25, "$g_player_court"),
    (call_script, "script_print_culture_word", s26, ":culture", DPLMC_CULTURAL_TERM_GUARD),
  ],[
    ("answere_1",[],"Divert the grain to save {s11}",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 100),
      (call_script, "script_change_player_relation_with_center", "$g_player_court", -15),
      (call_script, "script_change_senate_support", -5, 0),

      (str_store_string, s1, "str_nomad_event_outcome_10"),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Keep all grain for {s25}.",[
      (str_store_string, s1, "str_nomad_event_outcome_11"),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),

("minor_faction_event_6",0,
  "Diplomatic insult^^An ambassador of {s11} has killed a {s24} soothsayer's chicken, which was meant to predict the future at the nightly ritual."
  +" The ambassador has reportedly kicked the holy chicken after it escaped and ran into the streets. This is clearly a grave offense and it's hard to believe he would have done this knowingly,"
  +" unless his mission was to purposefully offend you. The ambassador is new and may not be aware of all {s24} traditions."
  +" He claims the kicking was accidental, but several witnesses allege he acted deliberately, and the public agrees."
  +"^Crowds of angry plebs demand the offender's immediate execution, but the ambassador is a close relative of one of the {s11} leaders and such an act would surely anger the nomads.^^(current relation: {reg29})",
  "none",[
    (store_relation, reg29, "$players_kingdom", "$g_notification_menu_var1"),
    (str_store_faction_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_desert"),

    (faction_get_slot, ":culture", "$players_kingdom", slot_faction_culture),
    (str_store_faction_name, s23, "$players_kingdom"),
    (str_store_faction_name, s24, ":culture"),
    (str_store_party_name, s25, "$g_player_court"),
    (call_script, "script_print_culture_word", s26, ":culture", DPLMC_CULTURAL_TERM_KING),
  ],[
    ("answere_1",[],"Kill the ambassador of {s11}",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -50),
      (call_script, "script_change_player_relation_with_center", "$g_player_court", 5),
      (str_store_string, s1, "str_nomad_event_outcome_12"),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Expel the ambassador.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 5),
      (call_script, "script_change_player_relation_with_center", "$g_player_court", -10),
      (str_store_string, s1, "str_nomad_event_outcome_13"),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("minor_faction_event_7",0,
  "Trouble on the frontier of {s23}^^The {s24} subjects living on the edge of settled lands have been seeing increased tensions with the {s11}.^^{s12}^^(current relation: {reg29})",
  "none",[
    (store_relation, reg29, "$players_kingdom", "$g_notification_menu_var1"),
    (faction_get_slot, ":culture", "$players_kingdom", slot_faction_culture),
    (str_store_faction_name, s23, "$players_kingdom"),
    (str_store_faction_name, s24, ":culture"),
    (str_store_party_name, s25, "$g_player_court"),
    (call_script, "script_print_culture_word", s26, ":culture", DPLMC_CULTURAL_TERM_ARMY_PLURAL),
    (call_script, "script_print_culture_word", s27, ":culture", DPLMC_CULTURAL_TERM_KING),
    (store_random_in_range, ":string", "str_nomad_conflict_text1", "str_nomad_event_outcome_1"),
    (str_store_string, s12, ":string"),
    (str_store_faction_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_desert"),
  ],[
    ("answere_1",[],"Resolve the dispute in favor of settled {s24} subjects.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -30),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (call_script, "script_change_player_relation_with_center", "$g_player_court", 2),
      (str_store_string, s1, "str_nomad_event_outcome_14"),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Resolve the dispute in favor of the border nomad tribes.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 30),
      (call_script, "script_change_troop_renown", "trp_player", -20),
      (call_script, "script_change_player_relation_with_center", "$g_player_court", -5),
      (str_store_string, s1, "str_nomad_event_outcome_15"),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),

("minor_faction_event_8",0,
  "Minor request from a border tribe^^The {s11} nomad tribe has sent a petition for a relatively simple request, in the spirit of fostering ties and goodwill between you."
  +"^^{s12}^^(current relation: {reg29})",
  "none",[
    (store_relation, reg29, "$players_kingdom", "$g_notification_menu_var1"),
    (faction_get_slot, ":culture", "$players_kingdom", slot_faction_culture),
    (str_store_faction_name, s23, "$players_kingdom"),
    (str_store_faction_name, s24, ":culture"),
    (str_store_party_name, s25, "$g_player_court"),
    (store_random_in_range, ":rand", 0, 6),
    (try_begin),
        (eq, ":rand", 0),
        (try_begin),
            (eq, ":culture", "fac_culture_7"),
            (assign, ":string", "str_nomad_request_text1"),
        (else_try),
            (assign, ":string", "str_nomad_request_text1_1"),
        (try_end),
    (else_try),
        (eq, ":rand", 1),
        (assign, ":string", "str_nomad_request_text2"),
    (else_try),
        (eq, ":rand", 2),
        (assign, ":string", "str_nomad_request_text3"),
    (else_try),
        (eq, ":rand", 3),
        (assign, ":string", "str_nomad_request_text4"),
    (else_try),
        (eq, ":rand", 4),
        (try_begin),
            (eq, ":culture", "fac_culture_7"),
            (assign, ":string", "str_nomad_request_text5"),
        (else_try),
            (assign, ":string", "str_nomad_request_text5_1"),
        (try_end),
    (else_try),
        (try_begin),
            (eq, ":culture", "fac_culture_7"),
            (assign, ":string", "str_nomad_request_text6"),
        (else_try),
            (assign, ":string", "str_nomad_request_text6_1"),
        (try_end),
    (try_end),
    (str_store_string, s12, ":string"),
    (str_store_faction_name, s11, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_desert"),
  ],[
    ("answere_1",[],"Grant the request.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", 5),
      (str_store_string, s1, "@You accept the {s11}'s request. It isn't difficult and earns you their gratitude."),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("answere_2",[],"Deny the request.",[
      (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -5),
      (str_store_string, s1, "@The {s11} are disappointed that you would reject such a simple ask. They question {s24} respect for their people."),
      (assign, "$temp", "mesh_pic_desert"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
###minor faction incidents end
##Money doesnt stink quest
("puppius_meet",0,
  "You walk towards the Curia Julia as a person dressed in a fine toga approaches you.",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
  ],[
    ("continue",[],"Continue...",[
      (quest_set_slot, "qst_money_stinks", slot_quest_object_state, 1),
      (call_script, "script_setup_troop_meeting", "trp_pupienus", -1, "scn_rome_center"),
    ]),
]),

 ("poop_message",0,
  "A Messenger from the Princeps approaches:^^'Caesar Augustus demands your immediate presence in Rome.'",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("continue",[],"Continue...",[
      (quest_set_slot, "qst_money_stinks", slot_quest_current_state, -1),
      (display_message, "str_quest_updated"),
      (add_quest_note_from_sreg, "qst_money_stinks", 2, "@The Princeps has called you to Rome immediately. Speak to Nero at the palace.", 0),
      (change_screen_map),
    ]),
]),
##end pop quest

##farbius the painter quest
("farbius_the_painter_quest_1",0,
  "The ship painter^^The crew of hardened sailors serving on your ships have been invaluable to make sea passages faster and smoother."
  +" As they periodically insist on, the fleet is temporarily laid up at a small uninhabited island for ship maintenance. Divers go under the massive ship's hull, holding their breath"
  +" as they work and periodically coming up for air.^"
  +"'Barnacles, Dominus,' a sailor explains. 'They grow on the bottom of the ship, and make her slower, so we have to scrape them off."
  +" Still, she will never be as fast as ships painted by Farbius, that man is a legend. I served on one of the ships he did, back in the day. What a fast beauty she was!"
  +" Anyone who saw our red-painted hull knew they couldn't run. Haha, those were the days!",
  "none",[
    (set_background_mesh, "mesh_pic_ships"),
  ],[
    ("op1",[],"Where can I find this Farbius?",[
      (quest_set_slot, "qst_pirates", slot_quest_current_state, -1),
      (jump_to_menu, "mnu_farbius_the_painter_quest_2"),
    ]),
    ("op2",[],"I have no time for your tales. Just get the ships ready fast. ",[
      (quest_set_slot, "qst_pirates", slot_quest_current_state, -1),
      (change_screen_map),
    ]),
]),

("farbius_the_painter_quest_2",0,
  "The sailor continues:^^'You want to find the great craftsman? For our ships? Dominus, if you can get him to paint our bottoms, we'll fly through the waves like an albatross!"
  +" But, you should know, it's not cheap. He mostly works on pirates, only they can afford the best. ^^It's been a while and I don't have many connections in the pirate world, you understand,"
  +" but I know they are still strong on the fringes of the empire, and some are still active in the former strongholds. Let's ask around in {s4}, {s5} and {s6}.'",
  "none",[
    (set_background_mesh, "mesh_pic_ships"),
    (str_store_party_name, s4, "p_town_10"),
    (str_store_party_name, s5, "p_town_14"),
    (str_store_party_name, s6, "p_town_13"),
  ],[
    ("op1",[],"We will get him.",[
      (str_store_party_name_link, s1, "p_town_10"),
      (str_store_party_name_link, s2, "p_town_14"),
      (str_store_party_name_link, s3, "p_town_13"),
      (str_store_string, s2, "@Ask about legendary craftsman Farbius in taverns of {s1}, {s2} and {s3}."),
      (display_message, "str_quest_updated"),
      (call_script, "script_start_quest", "qst_pirates", "trp_fortuna"),
      (quest_set_slot, "qst_pirates", slot_quest_current_state, 1),
      (change_screen_map),
    ]),
]),

 ("barbarus_defeated",0,
  "You defeated the fleet. Fabius has been freed. He has an interesting deal to offer:^^"
  +"'Thank you, {playername}. Barbarus Rufus kept me on his ship as little more than a slave. I suppose that's what I get for trading with outlaws.^I am getting too old for this and want to retire."
  +" I assume you sought me out to make your ships faster, so I want to offer you a deal. Most of the secret is my hull paint, and I have enough hidden away to keep your ships maintained for years."
  +" Your crew can apply it just as well as I can. Take the paint, and buy me a nice latifundium to settle down in as a rich man. What do you say?'",
  "none",[
    (set_background_mesh, "mesh_pic_seabattle"),
    (quest_get_slot, ":quest_party","qst_pirates", slot_quest_target_party),
    (try_begin),
      (party_is_active, ":quest_party"),
      (remove_party, ":quest_party"),
    (try_end),
  ],[
      ("op1",[
        (store_troop_gold, ":g", "trp_player"),
        (ge, ":g", 50000),
      ],"You have a deal (50,000 denari)",[
        (troop_remove_gold, "trp_player", 50000),
        (call_script, "script_change_player_honor", 5),
        (troop_add_item, "trp_player", "itm_anti_fooling_paint", 0),
        (call_script, "script_end_quest", "qst_pirates"),
        (change_screen_map),
      ]),
      ("op2",[
      ],"I saved your life and giving you freedom. It's a fair trade for your paint.",[
        (troop_add_item, "trp_player", "itm_anti_fooling_paint", 0),
        (call_script, "script_end_quest", "qst_pirates"),
        (change_screen_map),
      ]),
      ("op3",[
      ],"A slave of your skills is worth his weight in gold, and a torturer will get your stash location just fine.",[
        (troop_add_gold, "trp_player", 50000),
        (call_script, "script_change_player_honor", -5),
        (troop_add_item, "trp_player", "itm_anti_fooling_paint", 0),
        (call_script, "script_end_quest", "qst_pirates"),
        (change_screen_map),
      ]),
]),

("kurgan_enter",0,
  "You see a burial mound in the distance.",
  "none",[
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("op3",[
      (scene_slot_eq, "scn_kurgan_enter", slot_scene_visited, 1),
    ],"Enter the kurgan",[
      (assign, "$temp1", 0),
      (assign, "$temp2", 0),
      (modify_visitors_at_site, "scn_kurgan_enter"),
      (reset_visitors),
      (set_jump_mission, "mt_explore_kurgan"),
      (set_visitor, 0, "trp_player"),
      (try_begin),
        (troop_slot_eq, "trp_zarinaia", slot_troop_occupation, 0),
        (set_visitor, 1, "trp_zarinaia"),
      (try_end),
      (jump_to_scene, "scn_kurgan_enter"),
      (change_screen_mission),
      (set_passage_menu,"mnu_kurgan_enter"),
    ],"Enter the kurgan."),
    ("op3",[
    ],"Explore.",[
      (set_jump_mission, "mt_explore_secret_place"),
      (set_jump_entry, 0),
      (jump_to_scene, "scn_kurgan"),
      (change_screen_mission),
    ],"Leave the kurgan."),
    ("op2",[
    ],"Leave.",[
      (change_screen_map),
    ]),
]),

("kurgan_leave",0,
  "You leave the burial mound. The expedition to the burial mound was pretty much pointless. You couldn't gather any new informations. The scrolls you took contain only the same stories you already heard from the Saka king."
  "^^However, not far from the burial mound you are interupted by a group of Saka warriors. They look angry.",
  "none",[
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("op2",[
    ],"Continue.",[
      (jump_to_menu, "mnu_kurgan_battle"),
    ]),
]),

("kurgan_battle",0,
  "You want to talk with them but they greet you with arrows. You must fight!",
  "none",[
    (set_background_mesh, "mesh_pic_khergit"),
    (assign, "$g_enemy_party", "$g_encountered_party"),
    (call_script, "script_party_count_fit_for_battle", "$g_encountered_party"),
    (call_script, "script_encounter_calculate_fit"),
    (try_begin),
        (eq, "$g_enemy_fit_for_battle", 0),
        (jump_to_menu, "mnu_amazones_defeated"),
    (else_try),
        (eq, "$g_friend_fit_for_battle", 0),
        (assign, "$temp", 0),
        (jump_to_menu, "mnu_death_waits"),
    (try_end),
  ],[
    ("op2",[
    ],"Continue.",[
      (set_party_battle_mode),
      (set_jump_mission,"mt_lead_charge"),
      (jump_to_scene, "scn_kurgan"),
      (assign, "$g_next_menu", "mnu_kurgan_battle"),
      (jump_to_menu, "mnu_battle_debrief"),
      (change_screen_mission),
    ]),
]),

("amazones_defeated",0,
  "You defeated the Saka warriors. They don't have much valueable loot and you decide to leave quickly, in fear of Saka reinforcements appearing."
  +" You are unsrue if the Saka noticed what you did inside the burial mounds. Later this day you spot a patrol of Saka warriors, who greeted you friendly."
  +" As it seems, the warband that attacked you was the only group of Saka warriors who noticed your crime. Likely that's why they attacked."
  +" ^^Now it's time to return to Pamphile to claim your reward.",
  "none",[
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("op2",[
    ],"Continue.",[
      (add_xp_as_reward, 2500),
      (display_message, "str_quest_updated"),
      (quest_set_slot, "qst_zarinaia", slot_quest_current_state, 6),
      (party_set_flags, "p_kurgan", pf_disabled, 1),
      (party_set_flags, "p_kurgan", pf_always_visible, 0),
      (add_quest_note_from_sreg, "qst_zarinaia", 5, "@You investigated Zarinaia's burial mound. Return to Pamphile.", 0),
      (change_screen_map),
    ]),
]),

("bacchus_entrance",0,
  "The following legend is told by village elders in the area:^^After the victory of the Achaeans over Troy, a party was celebrate at Mount Olympus. During the merriment, a drunk Dionysus mistook the shield of Zeus, Aegis, for a plate."
  +" When the festivities came to a close, Dionysus simply departed with the device, as he was still unaware of what it truly was. Zeus was quickly angered upon discovering that his shield was missing, and he was adamant in finding the culprit."
  +" Fearing the wrath of Zeus, Dionysus hid the shield deep within this cave.^^It is said that Aegis was never found by Zeus, and remains in this cave to this day.",
  "none",[
    (set_background_mesh, "mesh_pic_cave"),
  ],[
    ("op3",[
    ],"Explore.",[
      (modify_visitors_at_site, "scn_cave_outside"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (set_jump_mission, "mt_outor_of_bacchus"),
      (jump_to_scene, "scn_cave_outside"),
      (change_screen_mission),
      (set_passage_menu,"mnu_bacchus_entrance"),
    ],"Leave the cave."),
    ("op3",[
      (scene_slot_eq, "scn_cave", slot_scene_visited, 1),
    ],"Enter the cave",[
      (modify_visitors_at_site, "scn_cave"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (assign, "$g_start_belligerent_drunk_fight", 0),
      (try_begin),
      ##1-4 sitting
      #5 6 kissing
      #7 dancer
      #8 god
          (neg|quest_slot_ge, "qst_bacchhus_quest", slot_quest_current_state, 2),

          (set_visitor, 8, "trp_bacchus"),

          (set_visitor,1,"trp_orgie_male1"),
          (set_visitor,2,"trp_orgie_fem3"),
          (set_visitor,3,"trp_orgie_fem2"),
          (set_visitor,4,"trp_orgie_male1"),
      (try_end),
      (try_begin),
          (quest_slot_eq, "qst_bacchhus_quest", slot_quest_current_state, 3),
          (set_visitor, 10, "trp_bacchus"),
      (try_end),

      (set_jump_mission, "mt_caves_of_bacchus"),
      (jump_to_scene, "scn_cave"),
      (change_screen_mission),
      (set_passage_menu,"mnu_bacchus_entrance"),
    ],"Enter the cave."),
    ("op2",[
    ],"Leave.",[
      (change_screen_map),
    ]),
]),

("old_mine",0,
  "You spot an old abandoned mine in the distance.",
  "none",
  [
    (set_background_mesh, "mesh_pic_cave"),
  ],[
    ("op3",[],
      "Explore.",
    [
        (try_begin),
            (quest_slot_eq, "qst_four_emperors", slot_quest_target_state, 2),
            (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 2),
            (jump_to_menu, "mnu_ambush_wixnix"),
        (else_try),
            (set_jump_mission, "mt_explore_secret_place"),
            (set_jump_entry, 0),
            (jump_to_scene, "scn_old_mine"),
            (change_screen_mission),
        (try_end),
    ]),

    ("op2",[],
      "Leave.",
      [
      (change_screen_map),
    ]),
]),

("ambush_wixnix",0,
  "You make your way towards the road through a long forest. Always watching out, in fear of ambushes. Suddenly an arrow hits the ground next to you. Indeed, an ambush!",
  "none",[
    (assign, "$g_enemy_party", "$g_encountered_party"),
    (call_script, "script_party_count_fit_for_battle", "$g_encountered_party"),
    (call_script, "script_encounter_calculate_fit"),
    (try_begin),
        (eq, "$g_enemy_fit_for_battle", 0),
        (jump_to_menu, "mnu_wixnix_won"),
    (else_try),
        (eq, "$g_friend_fit_for_battle", 0),
        (assign, "$temp", 1),
        (jump_to_menu, "mnu_death_waits"),
    (try_end),
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("continue",[],
      "Defend!",
    [
      (set_party_battle_mode),
      (set_jump_mission,"mt_lead_charge"),
      (jump_to_scene, "scn_old_mine"),
      (assign, "$g_next_menu", "mnu_ambush_wixnix"),
      (jump_to_menu, "mnu_battle_debrief"),
      (change_screen_mission),
    ]),
]),

("wixnix_won",0,
  "You defeated the enemy. Among the dead you find a man fitting the description of Wixnix. You loot his body and find among his valuables a small mirror. The mirror is made out of gold and silver, richly decorated with gemstones. On the back is a picture of a beautiful blond woman. You recognise her. It is Poppaea. This must be the 'important artefact' the tavernkeeper mentioned.",
  "none",[
    (set_background_mesh, "mesh_pic_victory"),
  ],[
    ("continue",[],"Continue.",[
      (troop_add_item, "trp_player", "itm_mirror_poppaea"),
      (quest_set_slot, "qst_four_emperors", slot_quest_target_state, 3),
      (str_store_party_name_link, s22, "p_town_3"),
      (add_quest_note_from_sreg, "qst_four_emperors", 5, "@You killed the Gallic rebel Wixnix. Report back.", 1),
      (add_xp_as_reward, 5000),
      (change_screen_map),
    ]),
]),

("enter_royal_tombs",0,
  "You ignite a torch and follow Antonia inside the tomb. All sorts of pictures of people, animals and landscapes can still be seen very faintly on the walls. Once upon a time the tomb must have been richly decorated.",
  "none",
  [
    (set_background_mesh, "mesh_pic_cave"),
  ],[
    ("enter",[],"Continue.",[
      (quest_get_slot, "$temp", "qst_four_emperors", slot_quest_target_troop),
      (modify_visitors_at_site, "scn_royal_tombs_interior"),
      (reset_visitors),
      (set_jump_mission, "mt_visit_royal_tombs"),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 1, "trp_antonia"),
      (set_visitor, 2, "$temp"),
      (jump_to_scene, "scn_royal_tombs_interior"),
      (change_screen_mission),
    ]),
]),

("fun_at_tomb",0,
  "She responses your kiss with passion. You and Antonia make your way towards some bushes and disappear behind them... ^^A wondrous bird takes flight. Its feathers, a brilliant tapestry of vibrant hues, shimmeres like fragments of a distant celestial realm. This bird possesses an elegance and grace that would befitted a divine origin. As the bird perches on a tree, you and Antonia leave the tomb.",
  "none",[
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[
    ("enter",[],"Continue.",[
      (add_xp_as_reward, 1500),
      (change_screen_map),
    ]),
]),

#main_story_final_phase
("main_story_final_phase",0,
  "You leave the tomb. Each one in a different direction. Wind sweeps through fields of wildflowers. The sky is darkening in the East, thunders are roaming and lightnings are striking. A storm is coming.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
    (play_sound, "snd_thunder_close"),
  ],[
    ("Continue",[],"Leave.",[
      (quest_set_slot, "qst_four_emperors", slot_quest_current_state, 5),
      (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
      (str_store_troop_name_link, s22, ":goy"),
      (str_store_party_name, s10, "p_town_20"),
      (try_begin),
          (eq, "$temp", "trp_legatus_11"),
          (add_quest_note_from_sreg, "qst_four_emperors", 5, "@Increase your wealth and influence as preparation for the upcoming events. You will be informed when the time has come to strike.^(Hint: 10 days must have past, you have 500,000 denars and 1,500 influence.)", 1),
          (add_quest_note_from_sreg, "qst_blank_quest_19", 7, "@You allied with {s22}. Now you have to increase your wealth as preparation for the upcoming events.^(Hint: 10 days must have past, you have 500,000 denars and 1,500 influence.)", 1),
          (store_current_day, reg1),
          (val_max, reg1, 1),
          (quest_set_slot, "qst_four_emperors", slot_quest_timer, reg1),
      (else_try),
          (str_store_troop_name_link, s32, "trp_legatus_12"),
          (str_store_troop_name_link, s13, "trp_kingdom_7_lady_12"),# mother
          (str_store_troop_name_link, s12, "trp_kingdom_7_lady_25"),# sister
          (add_quest_note_from_sreg, "qst_four_emperors", 5, "@Gain the support of {s32}, the commander of the Praetorian guard. Once you finished meet Antonia at the tomb of Megas Alexandros near {s10}.", 1),
          (add_quest_note_from_sreg, "qst_blank_quest_19", 7, "@You allied with {s22}. Now you have to find out the secret of {s32} in order to gain support from the Praetorian guard. Either improve your relation or win the favor of his sister {s12} or mother {s13}. Once you found the secret, blackmail {s32}. Once you finished meet Antonia at the tomb of Megas Alexandros near {s10}.", 1),

          (str_store_string, s2, "@Find out the secret of {s32} in order to gain support from the Praetorian guard. Either improve your relation or win the favor of his sister {s12} or mother {s13}. Once you found the secret, blackmail {s32} by talking with him."),
          (quest_set_slot, "qst_important_friends", slot_quest_current_state, 0),
          (quest_set_slot, "qst_important_friends", slot_quest_object_troop, -1),
          (call_script, "script_start_quest", "qst_important_friends", "trp_fortuna"),
      (try_end),
      (add_xp_as_reward, 1500),
      (change_screen_map),
    ]),
]),

("goy_purge",0,
  "Purges and chaos!^^{s12} has been declared Caesar Augustus by the Praetorian guard. Any moment might be our last. Yet {s13} has reached this last moment.^{s14}",
  "none",
  [
    (set_background_mesh, "mesh_pic_triumph"),
    (str_store_troop_name_plural, s12, "$g_notification_menu_var1"),
    (str_store_troop_name_plural, s13, "$g_notification_menu_var2"),
    (str_clear, s14),
    (try_begin),
        (eq, "$g_notification_menu_var2", "trp_kingdom_7_lord"),
        (str_store_string, s14, "@Though rumors say that {s13} is still alive and has escaped towards Greece."),
        (call_script, "script_activate_main_story_civil_war", "trp_legatus_11"),
    (else_try),
        (eq, "$g_notification_menu_var2", "trp_senator_1"),
        (str_store_string, s14, "@{s12} should have been adopted by {s13} and then be declared heir. But he broke his promise and thus {s12} took the opportunity and murdered {s13}."),
        (add_quest_note_from_sreg, "qst_blank_quest_19", 9, "@Due to broken promises, {s12} has murdered {s13}. {s12} was declared Caesar Augustus by the Praetorian guard.", 1),
    (else_try),
        (eq, "$g_notification_menu_var2", "trp_statthalter_9"),
        (str_store_string, s14, "@{s12} marched with his legions from Gaul and the Rhine border towards Italy and defeated {s13} in the battle of Bedriacum. After the defeat, {s13} committed suicide."),
        (add_quest_note_from_sreg, "qst_blank_quest_19", 10, "@{s12} was declared Caesar Augustus by the Rhine legions and marched towards Rome. He defeated {s13} in the battle of Bedriacum.", 1),
    (try_end),
  ],[
    ("Continue",[],"Continue.",[
      #  # kill NERO and usurp Rome
      (call_script, "script_usurp_faction", "$g_notification_menu_var1", "fac_kingdom_7"),
      (change_screen_map),
    ]),
]),

("the_fleet_landing",0,
  "The fleet lands near Arretium. The legions disembark. Messengers and scouts are sent around and report that Vitellius' forces are gathering near Bedriacum. They are already engaging with the Danube legions. ^^The march towards Bedriacum begins.",
  "none",[
    (set_background_mesh, "mesh_pic_emperor"),
  ],[
    ("Continue",[],"Continue.",[
      (jump_to_menu, "mnu_second_battle_of_bedriacum"),
    ]),
    # ("Continue",[],
    #   "test scene.",
    # [
    #   (jump_to_scene, "scn_second_battle_of_bedriacum"),
    #   (change_screen_mission),
    # ]),
]),

("first_battle_of_bedriacum_decide",mnf_disable_all_keys,
  "The troops are assembled and ready to march North to defeat the enemy at the field of battle before they reach Roma.",
  "none",[
    (set_background_mesh, "mesh_pic_charge"),
   ],
  [
    ("attack", [], "Give orders to march North.", [
      (assign, "$auto_menu", "mnu_first_battle_of_bedriacum_1"),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("defend", [], "Go back.", [
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("first_battle_of_bedriacum_1",mnf_disable_all_keys,
  "As the legions unfurl their banners and set forth on their journey Northward, the heavens above betray a foreboding omen. Like the brooding countenance of Jupiter himself, dark clouds converge upon the firmament, casting a pall over the earth below. And lo, as if stirred by the fury of Neptune's trident, the heavens weep, their tears cascading down in a torrential downpour.",
  "none",[
    (set_background_mesh, "mesh_pic_legion_march"),
   ],
  [
    ("attack", [], "Continue.", [
      (jump_to_menu, "mnu_first_battle_of_bedriacum"),
    ]),
]),

("first_battle_of_bedriacum",mnf_disable_all_keys,
  "Your forces reach Bedriacum. {s20} has noticed your advances and ordered to attack."
  +" {s20} has the legions {s14}. Your side has the legions {s15}."
  +"^^{s21}",
  "none",[
    (set_background_mesh, "mesh_pic_emperor"),

    (str_store_string, s21, "str_bedriacum_description"),
    (call_script, "script_get_list_of_legions_s1", "$players_kingdom"),
    (str_store_string_reg, s15, s1),
    (call_script, "script_get_list_of_legions_s1", "fac_kingdom_7"),
    (str_store_string_reg, s14, s1),

    (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
    (try_begin),
      (eq, ":goy", "trp_senator_2"),
      (assign, ":other_goy", "trp_statthalter_9"),
    (else_try),
      (eq, ":goy", "trp_statthalter_9"),
      (assign, ":other_goy", "trp_senator_2"),
    (try_end),
    (str_store_troop_name, s20, ":other_goy"),

  ],[
    # ("Continue",[],
    #   "Battle Scene.",
    # [
    #   (set_global_haze_amount, 0),
    #   (set_global_cloud_amount, 0),
    #   (jump_to_scene, "scn_camp_second_battle_of_bedriacum"),
    #   (change_screen_mission),
    # ]),
    ("Continue",[],"Continue.",[
      #(leave_encounter), # leave any encounter
      (set_fixed_point_multiplier, 1),
      (init_position, pos32),
      (position_set_x, pos32, -133),
      (position_set_y, pos32, 49),

      # detach legion parties and start battle
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
          (this_or_next|troop_slot_ge, ":lord", slot_troop_aux, 1),
          (troop_slot_ge, ":lord", slot_troop_legion, 1),
          (store_faction_of_troop, ":lord_faction", ":lord"),
          (this_or_next|eq, ":lord_faction", "fac_kingdom_7"),
          (eq, ":lord_faction", "$players_kingdom"),
          (troop_get_slot, ":lord_party", ":lord", slot_troop_leaded_party),
          (party_is_active, ":lord_party"),
          (party_get_attached_to, ":cur_town", ":lord_party"),
          (this_or_next|eq, ":cur_town", "p_town_6"),# troops gathered in Rome
          (eq, ":cur_town", "p_town_5"),# troops gathered in Mediolanum
          (party_detach, ":lord_party"),
          (party_set_position, ":lord_party", pos32),
          # # start battle
          # (try_begin),
          #     (eq, ":lord_faction", "fac_kingdom_7"),
          #     (party_quick_attach_to_current_battle, ":lord_party", 1),
          # (else_try),
          #     (party_quick_attach_to_current_battle, ":lord_party", 0),
          # (try_end),
      (try_end),

      (quest_get_slot, ":goy", "qst_four_emperors", slot_quest_target_troop),
      (try_begin),
          (eq, ":goy", "trp_senator_2"),
          (assign, ":other_goy", "trp_statthalter_9"),
      (else_try),
          (eq, ":goy", "trp_statthalter_9"),
          (assign, ":other_goy", "trp_senator_2"),
      (try_end),

      (quest_set_slot, "qst_four_emperors", slot_quest_current_state, 13),

      (troop_get_slot, ":other_goy_party", ":other_goy", slot_troop_leaded_party),

      (try_begin),
          (party_get_attached_to, ":cur_town", "p_main_party"),
          (gt, ":cur_town", 1),
          (party_detach, "p_main_party"),
      (try_end),
      (party_set_position, "p_main_party", pos32),
      # (party_is_active, ":vitellius"),
      (try_begin),
          (party_get_attached_to, ":cur_town", ":other_goy_party"),
          (gt, ":cur_town", 1),
          (party_detach, ":other_goy_party"),
      (try_end),
      (party_set_position, ":other_goy_party", pos32),

      (troop_get_slot, ":other_goy_party", ":other_goy", slot_troop_leaded_party),
      (start_encounter, ":other_goy_party"),
      (change_screen_map),
    ]),
]),

("second_battle_of_bedriacum",mnf_disable_all_keys,
  "Your forces reach Bedriacum. Vitellius has noticed your advances. Being attack from two directions he performs a tactical retreat."
  +" Your forces join the Danubian legions. One the next day, Vitellius dispatches Aulus Caecina together with the legions {s14}, to meet your forces. Your side has the legions {s15}.^^{s21}",
  "none",[

    (set_background_mesh, "mesh_pic_emperor"),

    (str_store_string, s21, "str_bedriacum_description"),
    # switch side of danube legions 1 and 3:
    (call_script, "script_switch_legion_to_faction", 1, "$players_kingdom"),
    (call_script, "script_switch_legion_to_faction", 3, "$players_kingdom"),

    # Aulus Alienus Caecina switches to Vitellius, if not already
    (try_begin),
        (faction_slot_eq, "fac_kingdom_7", slot_faction_leader, "trp_senator_2"),
        (store_faction_of_troop, ":faction_1", "trp_senator_2"),
        (store_faction_of_troop, ":faction_2", "trp_legatus_4"),
        (neq, ":faction_1", ":faction_2"),
        (call_script, "script_change_troop_faction", "trp_legatus_4", ":faction_1"),
        (troop_set_slot, "trp_legatus_4", slot_troop_occupation, slto_kingdom_hero),
        # handle offices
        (try_begin),
            (troop_get_slot, ":auxiliar", "trp_legatus_4", slot_troop_aux),
            (ge, ":auxiliar", 1),
            (call_script, "script_find_new_commander_for_aux", ":auxiliar", ":faction_2"),
        (try_end),
        (try_begin),
            (troop_get_slot, ":legion", "trp_legatus_4", slot_troop_legion),
            (ge, ":legion", 1),
            (call_script, "script_find_new_commander_for_legion", ":legion", ":faction_2"),
        (try_end),
    (try_end),

    (call_script, "script_get_list_of_legions_s1", "$players_kingdom"),
    (str_store_string_reg, s15, s1),
    (call_script, "script_get_list_of_legions_s1", "fac_kingdom_7"),
    (str_store_string_reg, s14, s1),
  ],[

    # ("Continue",[],
    #   "Battle Scene.",
    # [
    #   (set_global_haze_amount, 0),
    #   (set_global_cloud_amount, 0),
    #   (jump_to_scene, "scn_camp_second_battle_of_bedriacum"),
    #   (change_screen_mission),
    # ]),
    ("Continue",[],"Continue.",[
      #(leave_encounter), # leave any encounter
      (set_fixed_point_multiplier, 1),
      (init_position, pos32),
      (position_set_x, pos32, -133),
      (position_set_y, pos32, 49),

      # detach legion parties and start battle
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
          (this_or_next|troop_slot_ge, ":lord", slot_troop_aux, 1),
          (troop_slot_ge, ":lord", slot_troop_legion, 1),
          (store_faction_of_troop, ":lord_faction", ":lord"),
          (this_or_next|eq, ":lord_faction", "fac_kingdom_7"),
          (eq, ":lord_faction", "$players_kingdom"),
          (troop_get_slot, ":lord_party", ":lord", slot_troop_leaded_party),
          (party_is_active, ":lord_party"),
          (party_get_attached_to, ":cur_town", ":lord_party"),
          (this_or_next|eq, ":cur_town", "p_town_6"),# troops gathered in Rome
          (this_or_next|eq, ":cur_town", "p_town_20"),# troops gathered in Alexandria
          (eq, ":cur_town", "p_town_5"),# troops gathered in Mediolanum
          (party_detach, ":lord_party"),
          (party_set_position, ":lord_party", pos32),
          # # start battle
          # (try_begin),
          #     (eq, ":lord_faction", "fac_kingdom_7"),
          #     (party_quick_attach_to_current_battle, ":lord_party", 1),
          # (else_try),
          #     (party_quick_attach_to_current_battle, ":lord_party", 0),
          # (try_end),
      (try_end),

      (troop_get_slot, ":vitellius_party", "trp_senator_2", slot_troop_leaded_party),
      # (party_is_active, ":vitellius"),
      (try_begin),
          (party_get_attached_to, ":cur_town", ":vitellius_party"),
          (gt, ":cur_town", 1),
          (party_detach, ":vitellius_party"),
      (try_end),
      (party_set_position, ":vitellius_party", pos32),
      (start_encounter, ":vitellius_party"),
      (change_screen_map),
    ]),
]),

("the_final_speech",0,
  "Wrapped into a red cloak and dressed in a white tunic, {s16} approaches to give a final speech before the battle starts.",
  "none",[
    (quest_get_slot, ":poppaea_or_antonia", "qst_four_emperors", slot_quest_main_antonia_or_poppaea),
    (str_store_troop_name, s16, ":poppaea_or_antonia"),
    (set_background_mesh, "mesh_pic_mb_warrior_3"),
  ],[
    ("Continue",[],"Continue.",[
      (play_track, "track_cutscene_battle", 2),
      # legions on player side:
      # Danube: Alaudae (1), Adiutrix (3), all other legions of player realm

      # legions on enemy side:
      # all other legions and praetorians

      (set_global_haze_amount, 0),
      (set_global_cloud_amount, 0),
      (add_xp_as_reward, 250),
      (set_jump_mission, "mt_give_speech_story"),
      (modify_visitors_at_site, "scn_speech_second_battle_of_bedriacum"),
      (reset_visitors),

      # 1-3 player, antonia, vespasian
      (set_visitor, 1, "trp_player"),
      (quest_get_slot, ":poppaea_or_antonia", "qst_four_emperors", slot_quest_main_antonia_or_poppaea),
      (set_visitor, 2, ":poppaea_or_antonia"),

      (try_begin),
        (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_legatus_11"),
        (assign, ":commander", "trp_legatus_11"),
      (else_try),
        (assign, ":commander", "trp_legatus_12"),
      (try_end),
      (set_visitor, 3, ":commander"),

      # 4 to 11 troops
      (troop_set_slot, "trp_temp_array_c", 4, 1),
      (troop_set_slot, "trp_temp_array_c", 5, 1),
      (troop_set_slot, "trp_temp_array_c", 6, 3),
      (troop_set_slot, "trp_temp_array_c", 7, 3),
      (troop_set_slot, "trp_temp_array_c", 8, 7),
      (troop_set_slot, "trp_temp_array_c", 9, 7),
      (troop_set_slot, "trp_temp_array_c", 10, 11),
      (troop_set_slot, "trp_temp_array_c", 11, 11),
      (try_for_range, ":entry", 4, 12),
          (troop_get_slot, ":legion", "trp_temp_array_c", ":entry"),
          (val_add, ":legion", "trp_ballistarii"),
          (set_visitors, ":entry", ":legion", 30),
      (try_end),
      (try_for_range, ":entry", 20, 28),
          (set_visitor, ":entry", "trp_centurio_west"),
          (set_visitor, ":entry", "trp_signifer"),
          (set_visitor, ":entry", "trp_cornicen"),
      (try_end),

      # 12,13: aquilifer and vexilarius legion 1
      # ...
      # 18 19: aquilifer and vexilarius legion 4
      (set_visitor, 12, "trp_aquilifer_v_alaudae"),
      (set_visitor, 13, "trp_vexilarius_v_alaudae"),
      (set_visitor, 14, "trp_aquilifer_i"),
      (set_visitor, 15, "trp_vexilarius_i"),
      (set_visitor, 16, "trp_aquilifer_xi"),
      (set_visitor, 17, "trp_vexilarius_xi"),
      (set_visitor, 18, "trp_aquilifer_x"),
      (set_visitor, 19, "trp_vexilarius_x"),

      (assign, "$g_empieza_discurso", 1),
      (jump_to_scene, "scn_speech_second_battle_of_bedriacum"),
      (change_screen_mission),
    ]),
]),

("the_fleet_decide",0,
  "The ships and soldiers are ready. Do you wish to embark?",
  "none",
  [
    (set_background_mesh, "mesh_pic_ships"),
  ],[
    ("Continue",[],
      "Continue.",
    [
      (jump_to_menu, "mnu_the_fleet_conversation"),
    ]),
    ("Continue",[],
      "Go back.",
    [
      (change_screen_map),
    ]),
]),

("the_fleet_conversation",0,
  "You are welcomed by Vespasian and Antonia. A great fleet is waiting in the harbor. Supplies and troops are ready to embark. ^^The fleet sets sail. Dark clouds cover the sky and the wind is howling. Thunders are roaming."
  +"^^Some days pass. Antonia and {s15} call you for a meeting.",
  "none",[
    (str_store_troop_name_plural, s15, "trp_legatus_11"),
    (set_background_mesh, "mesh_pic_seabattle"),
  ],[
    ("Continue",[],"Continue.",[
      (assign, "$talk_context", tc_main_story_fleet),
      (add_xp_as_reward, 250),
      (assign, "$g_next_menu", "mnu_the_fleet_embarks"),

      (set_jump_mission, "mt_conversation_encounter"),

      (modify_visitors_at_site, "scn_meeting_scene_water"),
      (reset_visitors),

      (mission_tpl_entry_set_override_flags, "mt_conversation_encounter", 0, af_override_horse),
      (set_visitor, 0, "trp_player"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_encounter", 1, af_override_everything),
      (mission_tpl_entry_clear_override_items),
      (mission_tpl_entry_add_override_item, "mt_conversation_encounter", 1, itm_caligea),#itm_caligea,itm_roman_lupa_dress_2,itm_cloak_5
      (mission_tpl_entry_add_override_item, "mt_conversation_encounter", 1, itm_roman_lupa_dress_2),#itm_caligea,itm_roman_lupa_dress_2,itm_cloak_5
      (mission_tpl_entry_add_override_item, "mt_conversation_encounter", 1, itm_cloak_5),#itm_caligea,itm_roman_lupa_dress_2,itm_cloak_5
      (set_visitor, 1, "trp_antonia"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_encounter", 2, af_override_horse),
      (set_visitor, 2, "trp_legatus_11"),

      (jump_to_scene, "scn_meeting_scene_water"),
      (change_screen_map_conversation, "trp_antonia"),
    ]),
]),

# Coordinates: x=-106916 y=37857 z=1771.
("the_fleet_travels",0,
  "And the journey continues...",
  "none",[
    (set_background_mesh, "mesh_pic_seabattle"),
  ],[
    ("Continue",[],"Continue...",[
      # detache player party
      (try_begin),
          (party_get_attached_to, ":cur_town", "p_main_party"),
          (ge, ":cur_town", 1),
          (party_detach, "p_main_party"),
          (party_relocate_near_party, "p_main_party", "p_village_153", 5),
          (party_set_position, "p_main_party", pos32),
      (try_end),
      (leave_encounter),
      (change_screen_map),

      (assign, "$travel_town", -1),
      (enable_party, "p_transporter"),
      (party_get_slot, ":port", "p_town_20", slot_party_port_party),
      (party_get_position, pos1, ":port"),
      (party_set_slot, "p_transporter", slot_party_on_water, 1),
      (party_set_flags, "p_transporter", pf_is_ship, 1),
      (party_set_position, "p_transporter", pos1),

      (set_fixed_point_multiplier, 1),
      (init_position, pos32),
      (position_set_x, pos32, -106),
      (position_set_y, pos32, 37),

      (party_set_ai_behavior, "p_transporter", ai_bhvr_travel_to_point),
      (party_set_ai_target_position, "p_transporter", pos32),

      # SEA TRAVEL
      (assign, "$auto_menu", "mnu_the_fleet_landing"),
      (rest_for_hours, 10 * 24, 1, 0),
      (set_camera_follow_party, "p_transporter"),
      (assign, "$g_player_is_captive", 1),
      (change_screen_return),
    ]),
]),

("the_fleet_embarks",0,
  "Antonia takes on a red cloak and walks on the platform towards the bow. She raises her arms towards the skies, invoking their help and gaining the attention of the legionaries. She waits for the right moment."
  +" Suddenly, a thunder roams in the distance.",
  "none",[
    (set_background_mesh, "mesh_pic_seabattle"),
    # declare war
    (call_script, "script_diplomacy_start_war_between_kingdoms", "fac_kingdom_7", "fac_player_supporters_faction", logent_faction_declares_war_to_end_civil_war),
  ],[
    ("Continue",[
      (ge, "$cheat_mode", 1)
    ],"Test scene.",[
      (jump_to_scene, "scn_cutscene_fleet"),
      (change_screen_mission),
    ]),

    ("Continue",[],"Continue.",[
      (play_track, "track_cutscene_fleet", 2),
      (assign, "$beaufort", 3), # waves
      (add_xp_as_reward, 1500),
      (assign, "$g_next_menu", "mnu_the_fleet_travels"),
      (assign, "$tutorial_state", 0),
      (set_jump_mission, "mt_fleet_cutscene"),
      (modify_visitors_at_site, "scn_cutscene_fleet"),
      (reset_visitors),

      (try_begin),
          (eq,"$character_gender", tf_female),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_female),
      (else_try),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_male),
      (try_end),
      (str_store_troop_face_keys, s1, "trp_player"),
      (troop_set_face_keys, "trp_multiplayer_profile_troop_male", s1),
      (call_script, "script_dplmc_copy_inventory", "trp_player", "trp_multiplayer_profile_troop_male"),

      (set_visitor, 0, "trp_player"),
      (set_visitor, 1, "trp_antonia"),
      (set_visitor, 2, "trp_legatus_11"),
      (set_visitor, 3, "trp_multiplayer_profile_troop_male"),

      (try_for_range, ":entry", 4, 75),
          (set_visitors, ":entry", "trp_custom_legionary", 2),
          (set_visitors, ":entry", "trp_custom_legionary", 1),
      (try_end),

      (jump_to_scene, "scn_cutscene_fleet"),
      (change_screen_mission),
    ]),
]),

("the_fleet_message",0,
  "A messenger approaches brings a letter from Antonia, it states:"
  +"^^'Time has come, {playername}. Travel to Alexandria as fast as possible and bring as many soldiers as possible. {s12} has assembled a fleet and many troops. We will embark as soon as you arrive.'",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (str_store_troop_name_plural, s12, "trp_legatus_11"),
  ],[
    ("Continue",[],"Continue.",[
      (str_store_party_name, s10, "p_town_20"),
      (add_quest_note_from_sreg, "qst_blank_quest_19", 11, "@Travel to {s10} as fast as possible.", 1),
      (add_quest_note_from_sreg, "qst_four_emperors", 5, "@Travel to {s10} as fast as possible.", 1),

      (quest_set_slot, "qst_four_emperors", slot_quest_current_state, 8),
      (add_xp_as_reward, 1500),
      (change_screen_map),
    ]),
]),

("assassination_of_antonia",0,
  "{s24}",
  "none",[
    (str_store_troop_name, s25, "trp_kingdom_7_lady_1"),
    (str_store_troop_name, s26, "trp_antonia"),
    (store_random_in_range, ":string", "str_poppaea_assassination_1", "str_poppaea_assassination_end"),
    (str_store_string, s24, ":string"),
    (set_background_mesh, "mesh_pic_palast"),

    (set_fixed_point_multiplier,100),
    (position_set_x,pos0,65),			#left/right movement ( 0 = left edge of screen)
    (position_set_y,pos0,3),			#up/down movement ( 0 = bottom edge of screen)
    (position_set_z,pos0,80),			#in/out movement  (0 = no image, higher #'s make it larger)
    (set_game_menu_tableau_mesh,"tableau_troop_note_mesh","trp_kingdom_7_lady_1",pos0),
  ],[
    ("Continue",[],"Continue.",[
      (call_script, "script_kill_lord_lady", "trp_kingdom_7_lady_1", "trp_antonia", 0),
      (str_store_troop_name_link, s25, "trp_kingdom_7_lady_1"),
      (str_store_troop_name_link, s26, "trp_antonia"),
      (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@Rumors say that {s26} ordered the murder of {s25}.", 1),
      (change_screen_map),
    ]),
]),

("poppaea_fate",0,
  "{s5}",
  "none",[
    (set_fixed_point_multiplier,100),
    (position_set_x,pos0,65),			#left/right movement ( 0 = left edge of screen)
    (position_set_y,pos0,3),			#up/down movement ( 0 = bottom edge of screen)
    (position_set_z,pos0,80),			#in/out movement  (0 = no image, higher #'s make it larger)
    (set_game_menu_tableau_mesh,"tableau_troop_note_mesh","trp_kingdom_7_lady_1",pos0),

    (set_background_mesh, "mesh_pic_palast"),
    (str_clear, s5),
    (try_begin),
        (eq, "$g_notification_menu_var1", 4),
        (str_store_string, s5, "str_poppaea_killed"),
        (str_store_troop_name_link, s20, "trp_kingdom_7_lady_1"),
        (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@You killed {s20} with your gladius.", 1),
        (quest_set_slot, "qst_blank_quest_19", slot_quest_main_poppaea_fate, 4),
        (call_script, "script_kill_lord_lady", "trp_kingdom_7_lady_1", "trp_player", 0),
    (else_try),
        (eq, "$g_notification_menu_var1", 3),
        (str_store_string, s5, "str_poppaea_banned"),
        (str_store_troop_name_link, s20, "trp_kingdom_7_lady_1"),
        (str_store_troop_name_link, s21, "trp_antonia"),
        (try_begin),
            (eq, "$g_notification_menu_var2", 1),
            (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On your orders, {s20} was banished from Rome.", 1),
        (else_try),
            (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On your orders, {s20} was banished from Rome.", 1),
        (try_end),

        (troop_set_inventory_slot, "trp_kingdom_7_lady_1", ek_foot, -1),
        (troop_set_inventory_slot, "trp_kingdom_7_lady_1", ek_head, -1),
        (troop_set_inventory_slot, "trp_kingdom_7_lady_1", ek_body, -1),

        (troop_clear_inventory, "trp_kingdom_7_lady_1"),

        (troop_add_item, "trp_kingdom_7_lady_1", "itm_caligea"),
        (troop_add_item, "trp_kingdom_7_lady_1", "itm_roman_noble_dress_2"),
        (troop_equip_items, "trp_kingdom_7_lady_1"),

        (store_current_day, ":day"),
        (quest_set_slot, "qst_blank_quest_19", slot_quest_main_poppaea_timer, ":day"),
        (quest_set_slot, "qst_blank_quest_19", slot_quest_main_poppaea_fate, 3),
    (else_try),
        (eq, "$g_notification_menu_var1", 2),
        (call_script, "script_kill_lord_lady", "trp_kingdom_7_lady_1", "trp_antonia", 0),
        (str_store_string, s5, "str_poppaea_dead_honorable"),
        (str_store_troop_name_link, s20, "trp_kingdom_7_lady_1"),
        (str_store_troop_name_link, s21, "trp_antonia"),
        (try_begin),
            (eq, "$g_notification_menu_var2", 1),
            (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On your orders, {s20} was forced to commit suicide.", 1),
        (else_try),
            (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On orders of {s21}, {s20} was forced to commit suicide.", 1),
        (try_end),
        (quest_set_slot, "qst_blank_quest_19", slot_quest_main_poppaea_fate, 2),
    (else_try),
        (call_script, "script_kill_lord_lady", "trp_kingdom_7_lady_1", "trp_antonia", 0),
        (str_store_string, s5, "str_poppaea_dead_brutal"),
        (str_store_troop_name_link, s20, "trp_kingdom_7_lady_1"),
        (str_store_troop_name_link, s21, "trp_antonia"),
        (try_begin),
            (eq, "$g_notification_menu_var2", 1),
            (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On your orders, {s20} was killed by the beasts.", 1),
        (else_try),
            (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On orders of {s21}, {s20} was killed by the beasts.", 1),
        (try_end),
        (quest_set_slot, "qst_blank_quest_19", slot_quest_main_poppaea_fate, 1),
    (try_end),
  ],[
    ("Continue",[],"Continue.",[
      (rest_for_hours, 72, 20, 0),
      (change_screen_map),
    ]),
]),

("antonia_fate",0,
  "{s5}",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
    (str_clear, s5),
    (try_begin),
        (eq, "$g_notification_menu_var1", 2),
        (str_store_string, s5, "str_antonia_killed_brutal"),
        (str_store_troop_name_link, s21, "trp_antonia"),
        (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On your orders, {s21} was killed by the beasts.", 1),
        (call_script, "script_kill_lord_lady", "trp_antonia", "trp_player", 0),
    (else_try),
        (str_store_string, s5, "str_antonia_killed_suicide"),
        (str_store_troop_name_link, s21, "trp_antonia"),
        (add_quest_note_from_sreg, "qst_blank_quest_19", 12, "@On your orders, {s21} was forced to commit suicide.", 1),
        (call_script, "script_kill_lord_lady", "trp_antonia", "trp_player", 0),
    (try_end),
    (set_fixed_point_multiplier,100),
    (position_set_x,pos0,65),			#left/right movement ( 0 = left edge of screen)
    (position_set_y,pos0,3),			#up/down movement ( 0 = bottom edge of screen)
    (position_set_z,pos0,80),			#in/out movement  (0 = no image, higher #'s make it larger)
    (set_game_menu_tableau_mesh,"tableau_troop_note_mesh","trp_antonia",pos0),
  ],[
    ("Continue",[],"Continue.",[
      (try_begin),# clear slot if its antonia
        (quest_slot_eq, "qst_four_emperors", slot_quest_main_antonia_or_poppaea, "trp_antonia"),
        (quest_set_slot, "qst_four_emperors", slot_quest_main_antonia_or_poppaea, -1),
      (try_end),
      (rest_for_hours, 72, 20, 0),
      (change_screen_map),
    ]),
]),

("vespasian_enter_palace",0,
  "You leave the circus with Antonia, celebrated by the people. Fragrant rose petals are scattered, incense is burned, and hymns of praise are sung in your name."
  +" People speak of the prophecy that a great ruler will appear in the East, which is fulfilled today. Especially among the poor, these rumors have gained significant popularity, as it is said that the great leader is a humanitarian who takes from the rich and gives to the poor."
  +"^^Your retinue reaches the Domus Augustus. You and Antonia enter. The Praefectus Urbi is awaiting you.",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
    (call_script, "script_kill_lord_lady", "trp_senator_2", "trp_player", 0),
  ],[
    ("Continue",[],"Continue.",[
      (quest_set_slot,"qst_blank_quest_19", slot_quest_object_state, 6),
      (str_store_troop_name_link, s20, "trp_senator_2"),
      (str_store_troop_name_link, s21, "trp_antonia"),
      (add_quest_note_from_sreg, "qst_blank_quest_19", 13, "@On orders of {s21}, {s20} was roasted alive and eaten by the lions.", 1),

      (assign, "$temp1", 0), # antonias fate
      (assign, "$temp2", 0), # poppaeas fate
      (assign, "$temp4", 0), # state of situation
      (assign, "$temp3", -1), # poppaea agent number

      (assign, "$praefectus_urbani", -1), # he is killed during fight
      (troop_set_slot, "trp_tigellinus", slot_troop_occupation, dplmc_slto_dead), # he is killed during fight

      (set_jump_mission, "mt_vespasian_final_dialogue"),
      (modify_visitors_at_site, "scn_imperial_palace"),
      (reset_visitors),
      (set_visitor, 43, "trp_player"),
      (set_visitor, 39, "trp_antonia"),
      (set_visitor, 42, "trp_tigellinus"),
      (set_visitor, 37, "trp_kingdom_7_lady_1"),
      # 43 player
      # 39 Antonia
      # 42 tigellinius
      # 37 Poppaea
      (set_visitor,20,"trp_praetoriani_milites"),
      (set_visitor,21,"trp_praetoriani_milites"),
      (set_visitor,22,"trp_praetoriani_milites"),
      (set_visitor,23,"trp_praetoriani_milites"),
      (set_visitor,24,"trp_praetoriani_milites"),
      (set_visitor,25,"trp_praetoriani_milites"),
      (set_visitor,26,"trp_praetoriani_milites"),
      (set_visitor,27,"trp_praetoriani_milites"),
      (set_visitor,28,"trp_praetoriani_milites"),
      (set_visitor,29,"trp_praetoriani_milites"),

      (jump_to_scene, "scn_imperial_palace"),
      (change_screen_mission),
    ]),
]),

("vespasian_death_of_vitellius",0,
  "The crowds gather in front of the Circus to watch the execution of {s10}. On orders of Antonia, he will be roasted alive and his flesh will be feed to wild dogs."
  "^^Vitellius is led into the Circus by gladiators. Afterwards, he is tied to an iron rod and placed over a fire. While he is being roasted, the gladiators engage in combat."
  +" Finally, the victorious gladiators depart and wild dogs are released into the Circus. As the grilling fire dies out, the dogs pounce upon Vitellius.",
  "none",
  [
    (set_background_mesh, "mesh_pic_gladiator"),
    (str_store_troop_name_plural, s10, "trp_senator_2"),
  ],[
    ("Continue",[],
      "Continue.",
    [
      (jump_to_menu, "mnu_vespasian_enter_palace"),
    ]),
]),

("death_of_other_goy",0,
  "{s23}",
  "none",[
    (set_background_mesh, "mesh_pic_gladiator"),
    (try_begin),
      (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_senator_2"),
      (assign, ":enemy_goy", "trp_statthalter_9"),
    (else_try),
      (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_statthalter_9"),
      (assign, ":enemy_goy", "trp_senator_2"),
    (try_end),
    (str_store_troop_name, s10, ":enemy_goy"),
    (try_begin),
      (quest_slot_eq, "qst_four_emperors", slot_quest_failure_consequence, 1),
      (str_store_string, s23, "str_goy_burn_alive"),
      (str_store_string, s22, "@burned alive and eaten by lions"),
    (else_try),
      (quest_slot_eq, "qst_four_emperors", slot_quest_failure_consequence, 2),
      (str_store_string, s23, "str_goy_crucified"),
      (str_store_string, s22, "@crucified"),
    (else_try),
      (quest_slot_eq, "qst_four_emperors", slot_quest_failure_consequence, 3),
      (str_store_string, s23, "str_goy_suicide"),
      (str_store_string, s22, "@forced to commit suicide"),
    (try_end),
    (call_script, "script_kill_lord_lady", ":enemy_goy", "trp_player", 0),
    (str_store_troop_name_link, s21, "trp_player"),
    (str_store_troop_name_link, s11, ":enemy_goy"),
    (add_quest_note_from_sreg, "qst_blank_quest_19", 13, "@On orders of {s21}, {s11} was {s22}.", 1),
  ],[
    ("Continue",[],"Continue.",[
      (call_script, "script_add_notification_menu", "mnu_end_civil_war", "$players_kingdom", -1),
      (party_relocate_near_party, "p_main_party", "p_town_6"),
      (add_xp_as_reward, 5000),
      (jump_to_menu, "mnu_auto_return_map"),
      (rest_for_hours, 72, 16, 0),
    ]),
]),

("player_enter_rome",0,
  "The sun was beginning to set over the horizon, casting a warm and golden glow over the eternal city."
  +" The once-distant roar of the cheering crowds grew louder with each step as your retinue approaches Rome."
  +" Their outburst of joy heralds your imminent entry into the heart of the empire.",
  "none",[
    (set_background_mesh, "mesh_pic_triumph"),
    (party_relocate_near_party, "p_main_party", "p_town_6", 1),
  ],[
    ("Continue",[],"Continue.",[
      (play_track, "track_trailer_2", 2),

      (set_jump_mission, "mt_cutscene_rome_triumph"),
      (modify_visitors_at_site, "scn_cutscene_rome_victory"),
      (reset_visitors),

      (set_visitor, 0, "trp_player"),
      (try_begin),
          (eq,"$character_gender", tf_female),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_female),
      (else_try),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_male),
      (try_end),
      (str_store_troop_face_keys, s1, "trp_player"),
      (troop_set_face_keys, "trp_multiplayer_profile_troop_male", s1),
      (call_script, "script_dplmc_copy_inventory", "trp_player", "trp_multiplayer_profile_troop_male"),

      (set_visitor, 1, "trp_multiplayer_profile_troop_male"),
      (set_visitor, 2, "trp_antonia"),
      (set_visitor, 3, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 4, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 5, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 6, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 7, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 8, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 9, "trp_aux_cav_praetoriani_2"),
      (set_visitor, 10, "trp_aux_cav_praetoriani_2"),
      (try_for_range, ":entry", 11, 25),
          (set_visitors, ":entry", "trp_roman_town_walker_female", 6),
          (set_visitors, ":entry", "trp_roman_town_walker", 7),
      (try_end),

      (try_for_range, ":entry", 28, 32),
          (set_visitors, ":entry", "trp_roman_town_walker_female", 6),
          (set_visitors, ":entry", "trp_roman_town_walker", 7),
      (try_end),

      (troop_raise_skill, "trp_antonia", skl_riding, 10),

      (assign, "$tutorial_state", 0),
      (try_begin),
          (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_legatus_11"),
          (assign, "$g_next_menu", "mnu_vespasian_death_of_vitellius"),
      (else_try),
          (this_or_next|quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_senator_2"),
          (quest_slot_eq, "qst_four_emperors", slot_quest_target_troop, "trp_statthalter_9"),
          (assign, "$g_next_menu", "mnu_death_of_other_goy"),
      (else_try),
          (display_message, "@BUG HAPPENS, you die!"),
          (assign, "$temp", 2),
          (assign, "$g_next_menu", "mnu_death_waits"),
      (try_end),
      # # 0 original player
      # # 1 fake player
      # # 2 antonia
      # # 3 - 10 player troops
      # # 11 to 24 spectators
      # # 25 target entry
      (jump_to_scene, "scn_cutscene_rome_victory"),
      (change_screen_mission),
    ]),
]),

("time_with_antonia",0,
  "You spend hours chatting with Antonia about Rome, life as soldier and your hardest battles. Antonias eyes are sparkling with affection whenever you meet her gaze. The sunlight filteres through the trees, casting a golden hue upon her face, illuminating the tresses cascading down her graceful frame.^After you have end your report, she slowly comes closer to you. Her voice is a soft melody that resonated with longing and tenderness. You feel her breath on your cheek. Two bodies merge in love.^^Later, Antonia leaves your camp secretly.",
  "none",
  [
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[

    ("Continue",[],
      "Continue.",
    [
      (add_xp_as_reward, 1500),
      (change_screen_map),
    ]),
]),

("antonia_meeting_before_alexandria",0,
  "Thunders are roaming in the distance. Your soldiers report that a woman is approaching your party. It is Antonia. She wants to speak with you.^^You welcome her inside your tent.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
    (play_sound, "snd_thunder_close"),
  ],[
    ("Continue",[],"Continue.",[
      (quest_set_slot, "qst_four_emperors", slot_quest_timer, -1),
      (assign, "$g_encountered_party", "p_main_party"),#to fix bug in dialog
      (assign, "$g_encountered_party_template", -1),#to fix bug in dialog
      (assign, "$talk_context", 0),#to fix bug in dialog
      (assign, "$g_encountered_party_type", spt_kingdom_hero_party),#to fix bug in dialog
      (assign, "$g_encountered_party_2", -1),#to fix bug in dialog
      (assign, "$g_encountered_party_faction", "$players_kingdom"),#to fix bug in dialog
      (assign, "$g_encountered_party_relation", 10),#to fix bug in dialog
      (assign, "$temp", 1),
      (assign, "$temp1", -1),
      (set_jump_mission, "mt_roman_story_player_tent"),
      (modify_visitors_at_site, "scn_players_tent"),
      (reset_visitors, 0),
      (set_visitor, 4, "trp_player"),
      (set_visitor, 5, "trp_antonia"),
      (jump_to_scene, "scn_players_tent"),
      (change_screen_mission),
    ]),
]),

("royal_tombs",0,
  "Somewhere in this forest one can find the tombs of the Macedonian kings.",
  "none",
  [
    (set_background_mesh, "mesh_pic_cave"),
  ],[
    ("enter",[
        (eq, 0, 1),
    ],
        "Enter the tomb.",
    [
      (try_begin),
          (check_quest_active, "qst_four_emperors"),
          (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 3),
          (display_message, "str_door_locked", message_alert),
      (else_try),
          (set_jump_mission, "mt_explore_secret_place"),
          (set_jump_entry, 0),
          (jump_to_scene, "scn_royal_tombs_interior"),
          (change_screen_mission),
      (try_end),
    ], "Enter the tomb."),

    ("op3",[],
      "Explore.",
    [
      (try_begin),
          (check_quest_active, "qst_four_emperors"),
          (quest_slot_eq, "qst_four_emperors", slot_quest_current_state, 3),
          (quest_get_slot, "$temp", "qst_four_emperors", slot_quest_target_troop),

          (modify_visitors_at_site, "scn_royal_tombs"),
          (reset_visitors),
          (set_jump_mission, "mt_visit_royal_tombs"),
          (set_visitor, 0, "trp_player"),
          (set_visitor, 1, "trp_antonia"),
          (set_visitor, 2, "$temp"),
          (jump_to_scene, "scn_royal_tombs"),
          (change_screen_mission),
      (else_try),
          (set_jump_mission, "mt_explore_secret_place"),
          (set_jump_entry, 0),
          (jump_to_scene, "scn_royal_tombs"),
          (change_screen_mission),
      (try_end),
    ],"Leave."),

    ("op2",[],
      "Leave.",
      [
      (change_screen_map),
    ]),
]),

("sacred_grove",0,
  "It is said that Olyndicus, an Celtiberian war chief who led a rebellion against Rome a century ago, is buried here.",
  "none",
  [
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("op3",[],
      "Explore.",
    [
      (modify_visitors_at_site, "scn_sacred_grove"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (set_jump_mission, "mt_outor_of_bacchus"),
      (jump_to_scene, "scn_sacred_grove"),
      (change_screen_mission),
    ],"Leave the cave."),

    ("op2",[],
      "Leave.",
      [
      (change_screen_map),
    ]),

]),

 ("bacchus_escape",0,
    "You awake in the middle of a small grove. Except from a headache, you seem to be fine.",
    "none",
    [(set_background_mesh, "mesh_pic_deserters"),
    ],

    [

      ("op3",[],
       "Get up.",
       [(add_xp_as_reward, 100),
       (change_screen_map),
        ]),

    ]
 ),

 ("solus_end",0,
    "You reach Ctesiphon. Solus thanks you for your support and teaches you his vast knowledge. You have difficulties to understand most of what he says but at least you tried your best.\
 After his last lecture he thanks you again and says goodbye. He joins a caravan to the lands behind the river of Indus. You will never see him again.",
    "none",
    [(set_background_mesh, "mesh_pic_desert"),
    ],

    [

      ("op3",[],
       "Continue.",
       [
       (add_xp_as_reward, 5000),
       (troop_raise_attribute, "trp_player", ca_intelligence, 1),
       (call_script, "script_succeed_quest", "qst_philosopher"),
       (call_script, "script_end_quest", "qst_philosopher"),
       (remove_member_from_party,"trp_solus", "p_main_party"),
       (change_screen_map),
        ]),

    ]
 ),

##event for governor asking player caesar for help
("governor_event_1",0,
  "Criminal officials^^A messenger comes bearing a scroll from one of your provincial governors, {s12}. He seeks advice regarding an event that happened near {s13}."
  +" Following the lengthy respectful address enumerating your many glorious titles, the subject matter on which the governor seeks guidance is explained."
  +"^^In the course of investigating a dispute between two settlements stemming from the theft of donkeys, the governor's investigator and his party were"
  +" themselves arrested at sword point and imprisoned for weeks by the guards from the village which has been accused of harboring the thieves."
  +" They were ultimately released with apologies after their identity was proven, but by then the suspected thieves have vanished."
  +" The investigator believes he was arrested to help the thieves get away, but the village guards claim a simple misunderstanding and there is nothing to contradict that they truly were concerned the investigators themselves were bandits impersonating imperial officials."
  +" Strictly speaking, the guards acted within their rights, but there is a pattern of frequent similar behavior from this village's officials, suggesting they are actively covering for criminals of their village."
  +"^^The situation has long been a thorn in the governor's side, and he wishes to punish the allegedly corrupt village as a whole, frustrated that apparently no specific law can be applied to the situation.",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
    (str_store_troop_name, s12, "$g_notification_menu_var2"),
    (str_store_party_name, s13, "$g_notification_menu_var1"),
  ],[
    ("op1",[],
      "Recommend harsh punishment for the whole village to make an example. ",[
      (add_xp_as_reward, 50),
      (call_script, "script_troop_add_gold", "trp_player", 15000),
      (call_script, "script_change_troop_renown", "trp_player", -15),
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", 15),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", -15),
      (str_store_string, s1, "str_collective_punishment_opt1"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("op2",[
      (assign, ":c", 0),
      (try_begin),
          (store_troop_gold, ":g", "trp_player"),
          (ge, ":g", 25000),
          (assign, ":c", 1),
      (else_try),
          (faction_slot_eq, "$players_kingdom", slot_faction_leader, "trp_player"),
          (neg|faction_slot_ge, "$players_kingdom", slot_faction_debts, 500000),
          (assign, ":c", 1),
      (try_end),
      (eq, ":c", 1),
    ],"Play similar tricks to punish the town while technically following the law. (cost: 15,000 denars)",[
      (add_xp_as_reward, 100),
      (try_begin),
          (faction_slot_eq, "$players_kingdom", slot_faction_leader, "trp_player"),
          (neg|faction_slot_ge, "$players_kingdom", slot_faction_debts, 500000),
          (call_script, "script_add_to_faction_bugdet", slot_faction_spending_admin, "$players_kingdom", 15000),
      (else_try),
          (call_script, "script_troop_add_gold", "trp_player", -15000),
      (try_end),
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", 15),
      (str_store_string, s1, "str_collective_punishment_opt2"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),

    ("op3",[],
    "Do no such thing.",[
      (add_xp_as_reward, 25),
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", -5),
      (str_store_string, s1, "str_collective_punishment_opt3"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),

("governor_event_2",0,
  "Secret cult^^A messenger comes bearing a scroll from one of your provincial governors, {s12}. He seeks advice regarding an event that happened in {s13}."
  +" Following the lengthy respectful address enumerating your many glorious titles, the subject matter on which the governor seeks guidance is explained.^^The governor explains that his town is plagued by a secret cult that most of its residents find offensive."
  +" While occult societies are nothing new and most are benign, in this case rumors and accusations of particularly gruesome and offensive practices have spread and the populace is organizing gangs in order to find and kill cultists in their midst."
  +" Naturally, such gangs do not follow any form of legal process, and a thrown accusation happily picked up by the howling mob is usually all the proof required.^^{s12} is unsure what to do, as any course of action carries great risks in this explosive situation.",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
    (str_store_troop_name, s12, "$g_notification_menu_var2"),
    (str_store_party_name, s13, "$g_notification_menu_var1"),
  ],[
    ("op1",[
      (assign, ":c", 0),
      (try_begin),
          (store_troop_gold, ":g", "trp_player"),
          (ge, ":g", 25000),
          (assign, ":c", 1),
      (else_try),
          (faction_slot_eq, "$players_kingdom", slot_faction_leader, "trp_player"),
          (neg|faction_slot_ge, "$players_kingdom", slot_faction_debts, 500000),
          (assign, ":c", 1),
      (try_end),
      (eq, ":c", 1),
    ],
      "Establish an imperial inquisition to destroy the cult in {s13}. (cost: 25,000 denars)",[
      (add_xp_as_reward, 100),
      (try_begin),
          (faction_slot_eq, "$players_kingdom", slot_faction_leader, "trp_player"),
          (neg|faction_slot_ge, "$players_kingdom", slot_faction_debts, 500000),
          (call_script, "script_add_to_faction_bugdet", slot_faction_spending_admin, "$players_kingdom", 25000),
      (else_try),
          (call_script, "script_troop_add_gold", "trp_player", -25000),
      (try_end),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", 8),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", 8),

      (call_script, "script_spawn_party", "$g_notification_menu_var1", "pt_generic_bandits"),
      (str_store_string, s1, "str_offensive_cult_opt1"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("op2",[],
      "Focus on breaking up the vigilante gangs. ",[
      (add_xp_as_reward, 50),
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", 4),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", -4),
      (str_store_string, s1, "str_offensive_cult_opt2"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("op3",[],
      "Stand back and let the gangs hunt cultists.",[
      (add_xp_as_reward, 50),
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", -4),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", -16),
      (call_script, "script_change_center_prosperity", "$g_notification_menu_var1", -25),

      (store_random_in_range, ":rand", 1, 4),
      (val_add, "$g_unrest", ":rand"),
      (display_message, "@Stability of the Empire decreases", color_bad_news),

      (call_script, "script_spawn_party", "$g_notification_menu_var1", "pt_generic_bandits"),
      (call_script, "script_spawn_party", "$g_notification_menu_var1", "pt_generic_bandits"),
      (call_script, "script_spawn_party", "$g_notification_menu_var1", "pt_generic_bandits"),
      (call_script, "script_spawn_party", "$g_notification_menu_var1", "pt_generic_bandits"),
      (str_store_string, s1, "str_offensive_cult_opt3"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),

("governor_event_3",0,
  "Provincial gifts^^A messenger comes bearing a scroll from one of your provincial governors, {s12}. Following the lengthy respectful address enumerating your many glorious titles, the subject matter on which the governor seeks guidance is explained."
  +"^^Clearly, the message is nothing more than an excuse to send you gifts. Accompanying it is a {s29} and a {s30}. {s12} is asking your opinion on which one is better. Naturally, {s12} also insists that you keep both options.",
  "none",[
    (set_background_mesh, "mesh_pic_senators"),
    (str_store_troop_name, s12, "$g_notification_menu_var2"),
    (store_random_in_range, ":string1", "str_present_option_1", "str_present_option_6"),
    (store_random_in_range, ":string2", "str_present_option_6", "str_present_option_end"),
    (str_store_string, s29, ":string1"),
    (str_store_string, s30, ":string2"),
  ],[
    ("op1",[],"I want both!",[
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", 1),
      (str_store_string, s1, "str_disguised_present_opt1"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("op1",[],"I like the first.",[
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", 1),
      (str_store_string, s1, "str_disguised_present_opt1"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("op2",[],"I prefer the second. ",[
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var2", 1),
      (str_store_string, s1, "str_disguised_present_opt1"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("op3",[],"Stop bothering me with this and govern your province.",[
      (troop_set_slot, "trp_global_variables", g_firer_event_not, 1),
      (str_store_string, s1, "str_disguised_present_opt2"),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),

("girl_fire_talk",0,
  "Lamentations of a girl^^As you ride toward the Forum Romanum, your gaze falls upon a beautiful girl, clothed in tattered rags, weeping bitterly. Though you cannot fathom the reason for her sorrow, something in this fragile creature stirs a deep well of pity within you.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("op1",[],"Talk with her.",[
      (assign, "$talk_context", tc_girl_talk),
      (call_script, "script_get_meeting_scene"),
      (assign, ":meeting_scene", reg0),
      (set_jump_mission,"mt_conversation_encounter"),
      (modify_visitors_at_site,":meeting_scene"),
      (reset_visitors),

      (set_visitor,17,"trp_player"),

      (set_visitor,0,"trp_christ_fem"),

      (jump_to_scene,":meeting_scene"),
      (change_screen_map_conversation, "trp_christ_fem"),
      (troop_set_slot, "trp_global_variables", g_fire_talk_girl, 1),
    ]),
      ("op1",[],"Bah, I don't care.",[
      (jump_to_menu, "mnu_town"),
      (troop_set_slot, "trp_global_variables", g_fire_talk_girl, 1),
    ]),
]),
("intro_to_court",0,
  "You walk your way towards the main hall where Nero awaits his guests when a woman dressed in fine clothes approaches you. She says:^"
  +" 'You are not familar to me so I assume you will be introduced to Nero the first time. Just in the case you don't know the order which has developed here,"
  +" I want to give you a view tips, otherwise not even the gods can protect you from the warth of a Caesar. So listen:"
  +" Firstly, if Nero makes a joke, laugh about it. Secondly, never upset him. Thirdly, never do anything which could make him envious about you. Lastly and most importantly, if Nero performs any kind of art, be it a dance, a song, reading a verse; always"
  +" laud him. Remember this!'^^She walks away quickly.",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
    (try_begin),
      (troop_slot_ge, "trp_global_variables", g_nero_intro, 1),
      (jump_to_menu, "mnu_town"),
    (try_end),
  ],[
  ("op1",[],"Continue...",[
    (add_xp_as_reward, 150),
    (troop_set_slot, "trp_global_variables", g_nero_intro, 1),
    (call_script, "script_enter_court", "$current_town", -1),
  ]),
]),
("nero_special_quest_1",0,
  "A messenger approaches:^^'Ave {s43}! I bring message from our Divine Caesar. The Princeps wants to talk you at your earliest convenience!'",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
    (call_script, "script_get_player_rank_string_s43"),
  ],[
    ("op1",[],"Continue...",[
      (quest_get_slot,":state", "qst_nero_special_quest", slot_quest_target_dna),
      (val_add, ":state", 1),
      (quest_set_slot, "qst_nero_special_quest", slot_quest_target_dna,":state"),
      (setup_quest_text,  "qst_nero_special_quest"),
      (str_store_string, s2, "@Visit Nero at your earliest convenience. Don't disappoint Caesar!"),
      (quest_set_slot, "qst_nero_special_quest", slot_quest_expiration_days, 30),
      (quest_set_slot, "qst_nero_special_quest", slot_quest_current_state, 0),
      (call_script, "script_start_quest", "qst_nero_special_quest", "trp_kingdom_7_lord"),
      (call_script, "script_update_all_notes"),
      (change_screen_map),
  ]),
]),
("abduction_nero",0,
  "You wait until evening. The sun sets and night begins.^You make your way towards the shop. On your way, you notice"
  +" fewer and fewer soldiers standing guard. Tigellinus must have ordered them to avoid the area around the shop."
  +" As you reach your target, Nero and Tigellinus approach.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("op1",[],"Continue...",[
      # scn_rome_center
      # spawn at 37
      # she spawns at 5
      # 54
      (set_jump_mission,"mt_abduction_nero_1"),
      (modify_visitors_at_site,"scn_rome_center"),
      (reset_visitors, 0),
      (set_visitor, 37, "trp_kingdom_7_lord"),
      (set_visitor, 37, "trp_tigellinus"),
      (set_visitor, 37, "trp_player"),
      (set_visitor, 5, "trp_guest_female"),
      (jump_to_scene,"scn_rome_center"),
      (change_screen_mission),
    ]),
]),
("abduction_return_fail",0,
  "You return to the palace, without the woman!^^Nero doesn't want to speak you again and you are notified, that you should better leave now.^^"
  +"Tigellinus also informs you to better not tell anyone about what has happened this night, or you will recieve a 'present' from him.",
  "none",[
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("op1",[],"Continue...",[
      (add_xp_as_reward, 1000),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lord", -30),
      (call_script, "script_fail_quest", "qst_nero_special_quest"),
      (call_script, "script_end_quest", "qst_nero_special_quest"),
      (call_script, "script_change_player_honor", 3),
      (jump_to_menu, "mnu_town"),
    ]),
]),
("abduction_return_suc",0,
  "You return to the palace in company of the woman!^^Nero immediately pays all his attention to the woman you kidnapped."
  +" Tigellinus informs you Caesar is happy and gives you a sack full of gold coins.^^Tigellinus also informs you to better not tell anyone about what has happened this night, or you will recieve a 'present' from him.",
  "none",[
    (set_background_mesh, "mesh_pic_palast"),
  ],[
    ("op1",[],"Continue...",[
      (troop_add_gold, "trp_player", 5000),
      (add_xp_as_reward, 1000),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lord", 10),
      (call_script, "script_change_player_relation_with_troop", "trp_tigellinus", 4),
      (call_script, "script_succeed_quest", "qst_nero_special_quest"),
      (call_script, "script_end_quest", "qst_nero_special_quest"),
      (call_script, "script_change_player_honor", -10),
      (jump_to_menu, "mnu_town"),
    ]),
]),
("gaius_villa",0,
  "A slave informs you, that there is currently a feast in progress and his master Petronius has no time now. Though, you tell the slave you have important orders from Caesar himself to speak Petronius immediately."
  +" Thus the slave allows you to enter.^^ You go to the triclinium, where the feast is in progress. Many important courtiers and people are participating.",
  "none",[
    (set_background_mesh, "mesh_pic_villa"),
  ],[
    ("op1",[],"Continue...",[
      (jump_to_scene, "scn_carnuntum_in"),
      (assign, "$auto_speak_troop", -1),
      (set_jump_mission,"mt_visit_town_castle"),
      (modify_visitors_at_site,"scn_carnuntum_in"),
      (reset_visitors, 0),
      (set_jump_entry,0),
      (try_for_range, ":entry", 17, 32),
        (store_random_in_range, ":number", 0, 2),
        (try_begin),
          (eq, ":number", 1),
          (set_visitor, ":entry", "trp_guest"),
        (else_try),
          (set_visitor, ":entry", "trp_guest_female"),
        (try_end),
      (try_end),
      (set_visitor, 16, "trp_gaius_petronius"),
      (change_screen_mission),
    ]),
]),
("biggus_dickus_villa",0,
  "On the way to the villa you come over a group of drunkards fighting each other with their fists. You try to stay out of this nonsense but some of them attack you. Though they are in majority you manage to defeat them. Unfortunately due to the time lose you are now too late. When you arrive at the villa, only two of guests are still remaining.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("op1",[],"Continue...",[
      (add_xp_as_reward, 150),
      (assign, "$g_start_belligerent_drunk_fight", 0),#used for dialogue to trigger
      (jump_to_scene, "scn_antiochia_castle"),
      (set_jump_mission,"mt_diggus_event_1"),
      (modify_visitors_at_site,"scn_antiochia_castle"),
      (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_diggus_event_1", 0, 0),
          (mission_tpl_entry_set_override_flags, "mt_diggus_event_1", 0, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 17, "trp_diggus"),
      (set_visitor, 16, "trp_orgie_fem4"),
      (set_visitor, 19, "trp_desperatius"),
      (set_visitor, 21, "trp_tristitia"),
      (change_screen_mission),
    ]),
]),
  ("biggus_event_end",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "What started with some drinks and nice conversations soon escalates into a full scale orgy. You and the others drink like vats, eat unhealthy amounts of food and make love with each other. It slowly becomes night. Then 'Biggus' suggests to tour the neighboring towns and villages. Everyone welcomes the idea.^^You three reach a small village. In a state of extreme drunkenness 'Biggus' thinks it would be a nice idea to set a stable on fire. You scream: 'You want fire! Who wants fire?' 'Biggus' and 'Incontinentia' shout: 'Fire! Fire! Fire!' You scream: 'Yeah, lets have some fire!' And you set the stable on fire. Some of the villagers wake up and notice the trouble. They grab their tools and attack you.  Luckily, you can elude. On the way back to the villa, your group encounters a lonely traveler. Though he seems to be harmless, 'Biggus' thinks it would be funny to beat him up. You join the fight. While the two men beat the traveler half to death, 'Incontinentia' stands by and cheers.^^On the next day, you have an insane headache and can only hardly remember what had happened.",
    "none",
    [(set_background_mesh, "mesh_pic_party"),],
    [
      ("op1",[],
       "Damn, I should never drink again...",
       [
    (add_xp_as_reward, 150),
    (call_script, "script_change_player_honor", -4),
    (change_screen_map),
       ]),

    ]),

 ("nero_performance",0,
    "You are invited to the palace. There you are told Caesar will be performing his Troyad, a play about the destruction of Troy. You have to attend.^^\
 Beautiful slaves are dressing you in a fine toga. You are perfumed and beautifully prepared.^^Then you are called to the Triclinium, were the feast will progress.\
 You are assigned a seat next to Caesar. The hall fills up with the guests. You recognize Sulpicius Galba, Aulus Vitellius, Tigellinus and of course Poppaea. \
 Caesar enters the room with a lyre in his hands. Everyone falls silent and the performance begins.",
    "none",
    [(set_background_mesh, "mesh_pic_party"),
    ],
    [
      ("op1",[],
       "Continue...",
       [
    (add_xp_as_reward, 150),
    (jump_to_scene, "scn_imperial_dinning_room"),
    (set_jump_mission,"mt_palace_nero_play"),
    (modify_visitors_at_site,"scn_imperial_dinning_room"),
    (reset_visitors, 0),
    #add guests
    (set_visitor, 40, "trp_tigellinus"),
    (set_visitor, 16, "trp_player"),
    (set_visitor, 17, "trp_kingdom_7_lady_2"),
    (set_visitor, 18, "trp_senator_2"),
    (set_visitor, 19, "trp_senator_7"),
    (set_visitor, 20, "trp_legatus_12"),
    (set_visitor, 21, "trp_kingdom_7_lady_24"),
    (set_visitor, 22, "trp_kingdom_7_lady_13"),
    (set_visitor, 23, "trp_kingdom_7_lady_6"),
    (set_visitor, 24, "trp_senator_4"),
    (set_visitor, 25, "trp_senator_3"),
    (set_visitor, 26, "trp_kingdom_7_lady_19"),
    (set_visitor, 27, "trp_kingdom_7_lady_18"),
    (set_visitor, 28, "trp_aux_commander_15"),
    (set_visitor, 29, "trp_aux_commander_10"),
    (set_visitor, 30, "trp_statthalter_11"),
    (set_visitor, 31, "trp_statthalter_6"),
    (set_visitor, 11, "trp_kingdom_7_lord"),
    (set_visitor, 10, "trp_kingdom_7_lady_1"),
    (change_screen_mission),
       ]),
 ]),

("feast_nero_end",0,
  "Slaves bring new courses, and fill the goblets unceasingly with wine. Before the table appear two athletes to give the guests a spectacle of wrestling. Then, beautiful dancers give an excellent performance. More courses are brought by slaves, dressed as Satyrs, mythological creatures and animals.^^"
  +"The feast progresses and you can take the chance to improve your relation with other guests.",
  "none",[
      (set_background_mesh, "mesh_pic_party"),
  ],[
    ("op1",[],"Focus on the male guests...",[
      (add_xp_as_reward, 150),
      (store_attribute_level, ":charisma", "trp_player", ca_charisma),
      (val_div, ":charisma", 5),
      (try_begin),
        (ge, ":charisma", 1),
        (call_script, "script_change_player_relation_with_troop", "trp_senator_2", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_senator_7", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_senator_4", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_senator_3", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_aux_commander_15", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_aux_commander_10", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_statthalter_11", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_statthalter_6", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_tigellinus", ":charisma"),
      (try_end),
      (change_screen_map),
    ]),

    ("op2",[],"Focus on the female guests...",[
      (add_xp_as_reward, 150),
      (store_attribute_level, ":charisma", "trp_player", ca_charisma),
      (val_div, ":charisma", 5),
      (try_begin),
        (ge, ":charisma", 1),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_2", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_24", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_13", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_6", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_19", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_18", ":charisma"),
      (try_end),
      (change_screen_map),
    ]),

     ("op3",[],"Try to speak with everyone...",[
      (add_xp_as_reward, 150),
      (store_attribute_level, ":charisma", "trp_player", ca_charisma),
      (val_div, ":charisma", 8),
      (try_begin),
        (ge, ":charisma", 1),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_2", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_24", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_13", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_6", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_19", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_18", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_senator_2", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_senator_7", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_senator_4", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_senator_3", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_aux_commander_15", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_aux_commander_10", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_statthalter_11", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_statthalter_6", ":charisma"),
        (call_script, "script_change_player_relation_with_troop", "trp_tigellinus", ":charisma"),
      (try_end),
      (change_screen_map),
    ]),
    ("op4",[],"Just enjoy yourself and get drunk...",[
      (call_script, "script_change_troop_health", "trp_player", 25),
      (add_xp_as_reward, 500),
      (change_screen_map),
    ]),
 ]),

 ("poppaea_event_1",0,
    "You open the door and enter a narrow corridor. The corridor goes from the left to the right. Water is flowing in one direction.\
 You decide to follow the stream. After a while you see a light in the distance. You reach a grid through which the water flows and light falls.\
 You look through it and discover a beautiful garden on the other side. You never saw something more beautiful before. Then you hear a woman crying.\
 Looking around you discover a woman sitting on a meadow next to the stream. You recognize the Augusta, Poppaea; Nero's wife. She seems to be talking with herself.",
    "none",
    [(set_background_mesh, "mesh_pic_woman"),
    ],
    [
      ("op1",[],
       "Listen...",
       [
       (assign, "$talk_context", tc_poppaea_event_2),
       (troop_set_slot, "trp_global_variables", g_poppaea_event, 1),
       (call_script, "script_setup_troop_meeting", "trp_kingdom_7_lady_1", -1, "scn_imperial_garden"),
       ]),

 ]),
 ("poppaea_event_2",0,
    "Poppaea is carried away by the servant. You decide it's time to go and make your way back.^^\
 Later that day you hear rumors about the stillbirth of Poppaea:\
 During the celebrations of Neronia, she quarrelled fiercely with Nero over his spending too much time at the races. In a fit of rage, Nero kicked her in the abdomen.\
 She survived and Nero forgave her. But the son she had carried is dead.",
    "none",
    [(set_background_mesh, "mesh_pic_woman"),
    ],
    [
      ("op1",[],
       "Continue...",
       [
    (add_xp_as_reward, 500),
    (jump_to_menu, "mnu_town"),
       ]),

 ]),

 ("poppaea_event_3",0,
    "While leaving the palace, Poppaea approaches you.",
    "none",
    [(set_background_mesh, "mesh_pic_palast"),
    ],
    [
      ("op1",[],
       "Continue...",
       [
       (assign, "$talk_context", tc_poppaea_event_1),
       (call_script, "script_setup_troop_meeting", "trp_kingdom_7_lady_1", -1, "scn_londinium_castle"),
       ]),

 ]),

 ("claudia_event",0,
  "Today, Nero will present a poem he wrote for his daughter Claudia Augusta, who died four months after her birth. The performance takes place in the dining room of the palace.^^"
  +"You enter the room and are assigned a seat next to Caesar. After all the guest have arrived, Nero strokes the harp.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("op1",[],"Continue...",[
      (add_xp_as_reward, 150),
      (jump_to_scene, "scn_imperial_dinning_room"),
      (set_jump_mission,"mt_palace_nero_play"),
      (modify_visitors_at_site,"scn_imperial_dinning_room"),
      (reset_visitors, 0),
      #add guests
      (set_visitor, 40, "trp_tigellinus"),
      (set_visitor, 16, "trp_player"),
      (set_visitor, 17, "trp_kingdom_7_lady_2"),
      (set_visitor, 18, "trp_senator_2"),
      (set_visitor, 19, "trp_senator_7"),
      (set_visitor, 20, "trp_legatus_12"),
      (set_visitor, 21, "trp_kingdom_7_lady_24"),
      (set_visitor, 22, "trp_kingdom_7_lady_13"),
      (set_visitor, 23, "trp_kingdom_7_lady_6"),
      (set_visitor, 24, "trp_senator_4"),
      (set_visitor, 25, "trp_senator_3"),
      (set_visitor, 26, "trp_kingdom_7_lady_19"),
      (set_visitor, 27, "trp_kingdom_7_lady_18"),
      (set_visitor, 28, "trp_aux_commander_15"),
      (set_visitor, 29, "trp_aux_commander_10"),
      (set_visitor, 30, "trp_statthalter_11"),
      (set_visitor, 31, "trp_statthalter_6"),
      (set_visitor, 11, "trp_kingdom_7_lord"),
      (set_visitor, 10, "trp_kingdom_7_lady_1"),
      (change_screen_mission),
    ]),
]),

 ("tiggelinius_event_1",0,
    "A slaves informs you Nero is awaiting you for a special dinner to your honors in the Triclinium of the palace.^^You make your way towards the palace. As you enter, a woman approaches. You recognize her. She was the one who informed you about the palace 'routines' earlier.^\
 She says:^^\
 'Either you angered him, you made him envious or you have an influential enemy in the palace. Either way, you are in great danger! Be careful.'^^As quickly as she approached she leaves before you could say anything.\
 You notice an increase of guards in the palace. There doesn't seem to be a turning back. If you leave the palace now, you will surely be imprisoned. You have no choice than entering the Triclinium.^^\
 Nero, Poppaea and Tigellinus are awaiting you there. Expensive dishes are served. You are carefully in what you eat as you suspect poison.",
 "none",
    [(set_background_mesh, "mesh_pic_palast"),
    ],
    [
      ("op1",[],
       "Continue...",
       [
    (add_xp_as_reward, 150),
    (jump_to_scene, "scn_imperial_dinning_room"),
    (set_jump_mission,"mt_palace_nero_play"),
    (modify_visitors_at_site,"scn_imperial_dinning_room"),
    (reset_visitors, 0),
    #add guests
    (set_visitor, 40, "trp_tigellinus"),
    (set_visitor, 16, "trp_player"),
    (set_visitor, 17, "trp_kingdom_7_lady_2"),
    (set_visitor, 18, "trp_senator_2"),
    (set_visitor, 11, "trp_kingdom_7_lord"),
    (set_visitor, 10, "trp_kingdom_7_lady_1"),
    (change_screen_mission),
       ]),

 ]),

 ("akademeia",0,
    "The Akademia of Athenae was founded by Plato centuries ago. Unfortunately, the dictator Sulla ordered it's destruction. The place has been abandoned ever since. Rebuilding it would cost you 150,000 denars.",
 "none",
    [(set_background_mesh, "mesh_pic_library"),
    ],
    [
      ("op1",[],
       "Rebuild it.",
       [
      (store_troop_gold, reg20, "trp_player"),
      (try_begin),
        (lt, reg20, 150000),
        (display_message, "str_not_enough_gold"),
      (else_try),
        (this_or_next|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
        (eq, "$g_is_emperor", 1),
        (troop_remove_gold, "trp_player", 150000),
        (troop_set_slot, "trp_director_akademia", slot_troop_wealth, 1),
        (display_log_message, "@The Akademeia in Athen has been rebuild by {playername}."),
        (call_script, "script_change_troop_renown", "trp_player", 15),
        (change_screen_map),
        (add_xp_as_reward, 150),
      (else_try),
        (display_message, "@You need to be either owner of Athen or Divine Caesar!"),
      (try_end),
       ]),

       ("op1",[],
       "Go back.",
       [
      (jump_to_menu, "mnu_town"),
       ]),

 ]),

("financial_event",0,
  "Through careful monitoring of rumors and other sources, you find yourself in possession of valuable information regarding the financial interests of "+
  "{s24} who is known to be {s63} towards you. How will you use it?",
  "none",[
    (try_begin),
        (troop_slot_eq, "trp_global_variables",g_province_event,0),
        #check is player is governor
        (assign, ":loop", towns_end),
        (assign, ":town_fond", -1),
        (try_for_range, ":towns", towns_begin, ":loop"),
            (party_slot_eq, ":towns", slot_town_lord, "trp_player"),
            (assign, ":town_fond", ":towns"),
            (assign, ":loop", -1),#end loop
        (try_end),
        (is_between, ":town_fond",towns_begin,towns_end),#player is governor
        (assign, ":c", 0),
        (assign, ":loop", towns_end),
        (try_for_range, ":centers", walled_centers_begin, ":loop"),#check if the lord has a fief with an issue
            (party_slot_eq, ":centers", slot_town_lord, "$g_notification_menu_var1"),
            (store_random_in_range, ":r", 0, 6),
            (try_begin),
                (eq, ":r",0),
                (party_slot_ge, ":centers", slot_town_port, 1),
                (troop_set_slot, "trp_global_variables", g_province_event, "str_governor_asks_governor_help_pirates"),
                (assign, ":c", 1),
            (else_try),
                (eq, ":r",1),
                (troop_set_slot, "trp_global_variables", g_province_event, "str_governor_asks_governor_help_bandits"),
                (assign, ":c", 1),
            (else_try),
                (eq, ":r",2),
                (troop_set_slot, "trp_global_variables", g_province_event, "str_governor_asks_governor_help_famine"),
                (assign, ":c", 1),
            (else_try),
                (eq, ":r",3),
                (troop_set_slot, "trp_global_variables", g_province_event, "str_governor_asks_governor_help_industry"),
                (assign, ":c", 1),
            (else_try),
                (this_or_next|troop_slot_eq, "$g_notification_menu_var1",slot_lord_reputation_type, lrep_debauched),
                (this_or_next|troop_slot_eq, "$g_notification_menu_var1",slot_lord_reputation_type, lrep_quarrelsome),
                (this_or_next|troop_slot_eq, "$g_notification_menu_var1",slot_lord_reputation_type, lrep_cunning),
                (troop_slot_eq, "$g_notification_menu_var1",slot_lord_reputation_type, lrep_roguish),
                (eq, ":r",4),
                (troop_set_slot, "trp_global_variables", g_province_event, "str_governor_asks_governor_help_fugitive"),
                (assign, ":c", 1),
            (try_end),
            (try_begin),
                (eq, ":c", 1),
                (assign, ":loop", -1),#end loop
                (assign, "$temp4_1", ":centers"),
            (try_end),
        (try_end),
        (try_begin),
            (eq, ":c", 1),
            (jump_to_menu, "mnu_provincial_event"),
        (try_end),
    (try_end),
    (set_background_mesh, "mesh_pic_senators"),
    (str_store_troop_name, s24, "$g_notification_menu_var1"),
    (call_script, "script_troop_get_player_relation", "$g_notification_menu_var1"),
    (call_script, "script_describe_relation_to_s63", reg0),
  # (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
    # (assign, reg30, reg0),

    (party_get_skill_level, reg30, "p_main_party", "skl_trade"),
    # (assign, reg2, reg0),
    # (assign, ":max_skill_owner", reg1),
    # (try_begin),
      # (eq, ":max_skill_owner", "trp_player"),
      # (assign, reg3, 1),
    # (else_try),
      # (assign, reg3, 0),
      # (str_store_troop_name, s1, ":max_skill_owner"),
    # (try_end),

    # (store_skill_level, reg30, "skl_trade", "trp_player"),
    (val_mul, reg30, 5),
    (val_add, reg30, 10),
  ],[
    ("op5",[(neq, "$g_is_emperor", 1),#not caesar
    ],
      "Force {s24} to help you increasing your standing in the realm in exchange for gold. [cost: 20,000 denars, gain 300 influence]",
    [
      (call_script, "script_troop_change_relation_with_troop", "trp_kingdom_7_lord", "trp_player", -1),
      (display_message, "@Your little intrigue generated minor rumours.", color_bad_news),
      (call_script, "script_change_troop_renown", "trp_player", -10),
      (call_script, "script_change_player_honor", -1),
      (call_script, "script_change_troop_controversy", "$g_notification_menu_var1", 25),
      (call_script, "script_change_troop_controversy", "trp_player", 25),
      (add_xp_as_reward, 150),
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var1", -6),
      (troop_remove_gold, "trp_player", 20000),
      (call_script, "script_add_to_troop_wealth", "$g_notification_menu_var1", 20000),
      (call_script, "script_change_influence", "trp_player", 300),
      (str_store_string, s1, "@Except minor rumours nobody noticed your scheme."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),

    ("op3",[],
      "Discreetly benefit your own finances. [success depends on trade skill, chance: {reg30}%]",
    [
      (add_xp_as_reward, 150),
      (store_random_in_range, ":r", 0, 100),
      (try_begin),
          (le, ":r", reg30),
          (troop_add_gold, "trp_player", 10000),
          (str_store_string, s1, "@You instruct your associates to take advantage of the knowledge without arousing suspicion. This benefits their business, while keeping your knowledge and its sources secret."),
          (jump_to_menu, "mnu_event_juicio_end"),
      (else_try),
          (str_store_string, s1, "@Although you and your associates tried their best, they didn't manage to gain any benefit from the situation. At least, nobody suspects you behind the scheme."),
          (jump_to_menu, "mnu_event_juicio_end"),
      (try_end),
    ]),
    ("op1",[],
      "Provide {s24} valuable help and strengthen your political ties. [cost: 15,000 denars]",
    [
      (add_xp_as_reward, 150),
      (call_script, "script_add_log_entry", logent_player_helped_buisness, "trp_player",  -1, "$g_notification_menu_var1", "$g_notification_menu_var2"),
      (troop_remove_gold, "trp_player", 15000),
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var1", 5),
      (call_script, "script_add_to_troop_wealth", "$g_notification_menu_var1", 15000),
      (str_store_string, s1, "@By exploiting the knowledge you are able to line up your own associates' business interests with the fellow nobleman, provide help and make very lucrative offers where {s24} needs them most. This exercise does cost you some coin, but having loyal friends in high places can sometimes be worth more than gold."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("op4",[],
      "Ruthlessly ravage {s24}'s business for your own gain.",
    [
      (add_xp_as_reward, 150),
      (call_script, "script_add_log_entry", logent_player_attacked_buisness, "trp_player",  -1, "$g_notification_menu_var1", "$g_notification_menu_var2"),
      (troop_add_gold, "trp_player", 20000),
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var1", -15),
      (call_script, "script_add_to_troop_wealth", "$g_notification_menu_var1", -20000),
      (str_store_string, s1, "@You instruct your associates to obviously and ruthlessly exploit the knowledge for maximum gain. Some of {s24}'s associates are financially ruined as a result, while your own benefit and prosper. {s24} will not easily forget that you made this gold at his expense."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),

    ("op2",[],
      "Do nothing.",
    [(change_screen_map),]),
]),

("provincial_event",0,
  "{s24}, governor of {s23}, who is said to be {s63} towards you is requesting your assistance in the following matter.^^{s25}",
  "none",[
    (str_store_party_name, s23, "$temp4_1"),
    (str_store_troop_name, s24, "$g_notification_menu_var1"),
    (troop_get_slot, ":string", "trp_global_variables",g_province_event),
    (str_store_string, s25, ":string"),

    (set_background_mesh, "mesh_pic_senators"),

    (call_script, "script_troop_get_player_relation", "$g_notification_menu_var1"),
    (call_script, "script_describe_relation_to_s63", reg0),
  ],[
    ("op1",[
      (assign, ":c", 0),
      (try_begin),
          (store_troop_gold, ":g", "trp_player"),
          (ge, ":g", 25000),
          (assign, ":c", 1),
      (else_try),
          (faction_slot_eq, "$players_kingdom", slot_faction_leader, "trp_player"),
          (neg|faction_slot_ge, "$players_kingdom", slot_faction_debts, 500000),
          (assign, ":c", 1),
      (try_end),
      (eq, ":c", 1),
    ],"Assist {s24}. [costs: 10,000 denars]",[
      (add_xp_as_reward, 150),
      (try_begin),
          (faction_slot_eq, "$players_kingdom", slot_faction_leader, "trp_player"),
          (neg|faction_slot_ge, "$players_kingdom", slot_faction_debts, 500000),
          (call_script, "script_add_to_faction_bugdet", slot_faction_spending_admin, "$players_kingdom", 10000),
      (else_try),
          (call_script, "script_troop_add_gold", "trp_player", -10000),
      (try_end),
      (call_script, "script_change_player_relation_with_center","$temp4_1",1),
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var1", 3),
      (call_script, "script_add_to_troop_wealth", "$g_notification_menu_var1", 5000),
      (str_store_string, s1, "@{s24} appreciates your help. A well-worded letter arrives to thank for your contribution and assure that it will not be forgotten."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
    ("op2",[],"Decline the request",[
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var1", -2),
      (str_store_string, s1, "@{s24} is not happy with your response and will remember your refusal to help in time of need."),
      (jump_to_menu, "mnu_event_juicio_end"),
    ]),
]),

("recruit_refugees",0,
  "Because you are not renowned enough the local leader doesn't allow you to hire skilled men.^^(You need more than 100 renown for access to such troops.)^^^^Nevertheless, you can ask around if some shepherds or poor farmers volunteer to join your party.",
  "none",[
  ],[
    ("op1",[],"Ask around.",[
      (store_random_in_range, ":rand", 0, 8),
      (store_random_in_range, ":rand", 0, 8),
      (try_begin),
        (eq, ":rand", 0),
        (jump_to_menu,"mnu_refugee_recruit_troops32"),
      (else_try),
        (eq, ":rand", 1),
        (jump_to_menu,"mnu_refugee_recruit_troops32"),
      (else_try),
        (eq, ":rand", 2),
        (jump_to_menu,"mnu_refugee_recruit_troops22"),
      (else_try),
        (eq, ":rand", 3),
        (jump_to_menu,"mnu_refugee_recruit_troops32"),
      (else_try),
        (eq, ":rand", 4),
        (jump_to_menu,"mnu_refugee_recruit_troops32"),
      (else_try),
        (eq, ":rand", 5),
        (jump_to_menu,"mnu_refugee_recruit_troops22"),
      (else_try),
        (eq, ":rand", 6),
        (jump_to_menu,"mnu_refugee_recruit_troops32"),
      (else_try),
        (jump_to_menu,"mnu_refugee_recruit_troops22"),
      (try_end),
      (party_set_slot, "$current_town", slot_center_volunteer_troop_amount, -1),
    ]),
    ("op2",[],"Go back.",[
      (jump_to_menu, "mnu_village"),
    ]),
]),

("minotau_defeated",0,
  "You defeated the 'Minotaur'. It seems this creature was just a mentally ill bandit. You search for loot, but the only valueable object is the axe the Minotaur used to fight."
  +" It seems, there is no other treasure hidden in this labyrinth",
  "none",
  [],[
    ("op1",[],"Continue.",[
      (add_xp_as_reward, 500),
      (scene_set_slot, "scn_labyrinth", slot_scene_visited, 2),
      (troop_add_item, "trp_player", "itm_ancient_axe", imodbit_heavy),
      (troop_add_item, "trp_player", "itm_minotaur_armor", 0),
      (change_screen_map),
    ]),
]),

("event_werewolf",0,
  "Werewolf?^^For multiple nights now, the woods around your encampments have been lively. Eyes staring at you from the darkness, something frequently moving just beyond the dim light of campfires and sentries' torches, leaving broken branches and strange unhuman tracks to be found in the morning. A pack of wolves howling nearby keeps your soldiers from getting good sleep. The men are exhausted and on edge."+
  "^^Tonight the sentries report an incident. An Optio, small man in stature, who is said to have been drinking, got into a fist fight with another sentry. The Optio was losing, when suddenly he howled like a wolf, ripped his own clothes off and threw his much bigger adversary like a rag doll. Witnesses swear the big soldier flew at least ten paces before striking the back of his head on a rock, which bent his helmet and killed him. The Optio then scowled at the remaining soldiers and ran off naked into the dark woods."+
  "^^Rumors are already spreading that he is a Versipellis, a turnskin, who can become a wolf, just like the beast described in Satyricon stories."+
  "^^The Optio killed a fellow soldier and must answer for his crime. Immediate pursuit is technically possible thanks to ample light from a full moon, but your troops look positively terrified by the prospect.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("option_1",[],"Send a party after the killer.",[
      (add_xp_as_reward, 250),
      (call_script, "script_change_player_party_morale", -15),
      (call_script, "script_inflict_casualties_to_party", "p_main_party", 1),
      (str_store_string, s1, "@There are no volunteers for this mission. It takes direct orders and threat of punishment to organize a party for pursuit. The soldiers disappear into the midnight woods, never to be seen again. The morning search turns up nothing but tracks, some blood and a few discarded pieces of military hardware. Your search party either deserted or perished in the night.^^Your casualties: {s8}"),
      (assign, "$temp", "mesh_pic_deserters"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("option_2",[],"Wait until morning.",[
      (add_xp_as_reward, 250),
      (call_script, "script_change_player_party_morale", -10),
      (str_store_string, s1, "@By morning, all your search party finds is some blood and broken branches. Tracks are hard to follow and eventually even the dogs howl in confusion. Whether he is man or beast, the optio is long gone."),
      (assign, "$temp", "mesh_pic_deserters"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("event_witch",0,
  "Witch?^^In the middle of the forest stands an anciet moss-covered hut, its dark half-rotten logs held together by nothing short of a miracle. Around it grows a large orchard of trees with slightly unusual-looking, but undoubtedly juicy yellow pears. Your foragers immediately detach to start collecting the fruit, when they are interrupted by an old woman's voice, sounding like the crunch of broken glass."+
  "^^--'I wouldn't eat that if I were you', the hag drops as she peeks out of the hut's window. She is even more ancient than the hut, with a single remaining tooth.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("option_1",[]," Leave the fruit alone.",[
      (str_store_string, s1, "@--'Safe travels, boys,' the hag waves as you leave, her orchard still untouched."),
      (assign, "$temp", "mesh_pic_pythia"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("option_2",[],"Ignore the hag, take the fruit.",[
      (troop_add_gold, "trp_player", 500),
      (troop_add_items, "trp_player", "itm_apples", 5),
      (str_store_string, s1, "@--'You should not have done that, boys,' the hag sighs as she disappears in the hut. 'The price is not worth it. Not worth it...' ^^The old woman might be unhappy, but you got the supplies you needed. Although shortly after some of the supply train mules broke their legs and had to be put down, but this can't possibly be connected to the fruit. Or can it?"),
      (assign, "$temp", "mesh_pic_pythia"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
    ("option_3",[],"Offer her gold for the fruit.",[
      (troop_add_gold, "trp_player", -500),
      (troop_add_items, "trp_player", "itm_apples", 5),
      (call_script, "script_change_player_party_morale", 5),
      (str_store_string, s1, "@The negotiated price is higher than the fruit is worth in town, as the old woman argues she would need to hire someone to deliver replacement fruit into the middle of the forest. Still, the produce is good and soldiers enjoy it without ill effects"),
      (assign, "$temp", "mesh_pic_pythia"),
      (jump_to_menu, "mnu_freelancer_event_8_reaction"),
    ]),
]),
("event_good_omen",0,
  "Good Omen!^^{s20}",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
    (store_random_in_range, ":string", "str_good_omen_1", "str_good_omen_end"),
    (str_store_string, s20, ":string"),
  ],[
    ("option_1",[],"Continue.",[
      (call_script, "script_change_player_party_morale", 5),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),
("event_bad_omen",0,
  "Bad Omen!^^{s20}^^Hint: This event is caused by your low pietas. Make sacrifices to the gods!",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
    (store_random_in_range, ":string", "str_bad_omen_1", "str_bad_omen_end"),
    (str_store_string, s20, ":string"),
  ],[
    ("option_1",[],"Continue.",[
      (call_script, "script_change_player_party_morale", -5),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("desperatius_villa",0,
  "You follow the description and finally find his villa near the marketplace. It is more a small house then a villa. "+
  "You knock at the door. Desperatius himself opens. He directs you towards a small garden behind the house. Overall, his 'villa' seems to be "+
  "more a larger house, neglected over the years. You can't see a single slave, most likely he has none.",
  "none", [
      (set_background_mesh, "mesh_pic_villa"),
  ],[
    ("option_1",[],"Continue.",[
      (call_script, "script_setup_troop_meeting", "trp_desperatius", -1, "scn_castle_1_interior"),
    ]),
  ],
),

("aslan_end",0,
  "{s15}",
  "none", [
    (try_begin),
        (quest_slot_eq, "qst_amor_quest", slot_quest_gold_reward, -1),
        (str_store_string,s15, "str_aslan_fight"),
        (troop_add_item, "trp_player", "itm_aslans_fur"),
    (else_try),
        (quest_slot_eq, "qst_amor_quest", slot_quest_gold_reward, 1),
        (str_store_string,s15, "str_aslan_help"),
    (try_end),
    (set_background_mesh, "mesh_pic_deserters"),
    (quest_set_slot, "qst_amor_quest", slot_quest_current_state, 6),
    (str_store_party_name_link, s23, "p_village_155"),
    (add_quest_note_from_sreg, "qst_amor_quest", 2, "@Return to the local leader of {s23} to obtain the arrow of Cupid.", 0),
    (display_message, "str_quest_updated"),
    (play_sound, "snd_quest_concluded"),
  ],[
  ("option_1",[],"Continue.",[
    (add_xp_as_reward, 5000),
    (change_screen_map),
  ]),
]),

("tristitia_watching",0,
  "Tristitia prepares the meal, with the help of two slaves. The slaves work with pleasure and without compulsion. She never uses a stick or threatens the whip, as is customary with others. Obviously, the slaves like their masters.^Then she collects flowers and sets up a table in the garden. A little later her husband arrives. He has a flower with him that he sticks in her hair. Then they take seat and start their meal. You continue to observe until they finished their dinner.^^They seem to love each other very much. For you, a man who has seen all kinds of cruelty their relationship seems to be perfect: They live in a peaceful village, have a decent amount of wealth, love each other and treat their slaves well. The horrors of poverty, violence and war are as remote as anywhere else in the Roman Empire.^You could find nothing that hints to what Desperatius claimed. Overall, they seem to be happy together."+
  "^^To proceed with Desperatius plan would mean to destroy this peaceful place. After a while of thinking you come to the following conclusions:^"+
  "If you should refuse to help Desperatius, he will for sure destroy their relationship on his own, and on top of that you wont see any reward.^"+
  "On the other hand, the only way to claim your reward would be to destroy their relationship.^A possible third way would be to find another woman for Desperatius, but he seems to be too stubborn.^^In any case, it is the best to return to him and explain the situation.",
  "none", [
    (set_background_mesh, "mesh_pic_woman"),
    (quest_set_slot, "qst_amor_quest", slot_quest_current_state, 9),
    (str_store_party_name_link, s23, "p_town_3"),
    (add_quest_note_from_sreg, "qst_amor_quest", 2, "@Return to {s23} and confront Desperatius with the information you collected.", 0),
    (display_message, "str_quest_updated"),
    (play_sound, "snd_quest_concluded"),
  ],[
    ("option_1",[],"Continue...",[
      (add_xp_as_reward, 500),
      (change_screen_map),
    ]),
]),

("amor_quest_fin",0,
  "You should now travel to Patrae and inform Tristitia about Desperatius scheme. Otherwise misfortune will happen.",
  "none", [
    (set_background_mesh, "mesh_pic_villa"),

    (quest_set_slot, "qst_amor_quest", slot_quest_current_state, 10),
    (quest_set_slot, "qst_amor_quest", slot_quest_expiration_days, 30),

    (str_store_party_name_link, s23, "p_village_162"),
    (add_quest_note_from_sreg, "qst_amor_quest", 2, "@Travel to {s23} and inform Tristitia about Desperatius scheme.^^(Hint: Walk around the village and find Tristitia.)", 0),
    (assign, reg0, 2),
    (add_quest_note_from_sreg, "qst_amor_quest", 7, "@You have {reg0} days to finish this quest.", 0),
    (display_message, "str_quest_updated"),
    (play_sound, "snd_quest_concluded"),
  ],[
  ("option_1",[],"Continue...",[
    (add_xp_as_reward, 500),
    (change_screen_map),
  ]),
]),

  ("tristitia_goat",0,
    "You hear the following rumors about a woman living in the village of Patrae in Greece:\
A man stung her with an arrow of Cupid. The first thing she saw was a goat, thus she immediately fell in love with it. \
In rage, her husband killed the man who stung her with the arrow. The husband was imprisoned and will be crucified. \
She divorced and wanted to marry the goat. The priests of course disallowed such a marriage. \
Meanwhile, knowing that death awaits him, her former husband suicides in the prison. \
It is said, that she lives now together with the goat.",
    "none", [
    (set_background_mesh, "mesh_pic_woman"),

    ],

    [("option_1",[],"Continue...",
        [
        (add_xp_as_reward, 500),
        (change_screen_map),
      ]),
    ],
  ),

  ("tristitia_kill",0,
    "Dressed as bandits, you and your men set some houses near Tristitia's villa on fire. Then you approach her home.\
 Your men break the door. Her husband attacks you, armed with a gladius, but one of your soldiers quickly decapitate him. Tristitia, frozen in fear, looks apathetically at her husband's dead body.\
 The bloody task is done, you retreat.^^\
 On a hill near the village you meet Desperatius.",
    "none", [
    (set_background_mesh, "mesh_pic_victory"),

    ],

    [("option_1",[],"Continue...",
        [
    (add_xp_as_reward, 500),
    (quest_set_slot, "qst_amor_quest", slot_quest_current_state, 12),
    (assign, "$g_start_belligerent_drunk_fight", 0),
    (set_jump_mission,"mt_desperatius_final"),
    (modify_visitors_at_site,"scn_village_patrae"),
    (reset_visitors, 0),
    (set_visitor, 26, "trp_player"),
    (set_visitor, 27, "trp_desperatius"),
    (jump_to_scene,"scn_village_patrae"),
    (change_screen_mission),
      ]),
    ],
  ),

("sad_final",0,
  "Some days later you are informed about the following events:^^"
  +"Soon after you left the village, Tristitia, tormented with suffering, jumped from the cliff next to her house. Once Desperatius heard from her death, he followed her into the underworld.^^Three lives have been faded away and rest now in Erebos.",
  "none", [
    (set_background_mesh, "mesh_pic_woman"),
  ],[
    ("option_1",[],"Continue...",[
      (add_xp_as_reward, 2500),
      (call_script, "script_succeed_quest", "qst_amor_quest"),
      (call_script, "script_end_quest", "qst_amor_quest"),
      (change_screen_map),
    ]),
]),

("travel_to_sagala",0,
  "You arrived at the foreign camp. It's leader, Phamanus, allows you to join the caravan.^^A lengthy journey begins. The caravan cross over mountains and through deserts you've never seen before, the travel continues through the eastern regions of the realm of the Parthians until you reach the river of Hindus. There, the caravan follows the river North until they reach a town called Taxilia from where they head East in direction of Sagala.",
  "none", [
    (set_background_mesh, "mesh_pic_desert"),
    (call_script, "script_dplmc_remove_disguise"),
  ],[
  ("option_1",[],"Continue...",[
    (add_xp_as_reward, 1500),

    (assign, "$g_next_menu", "mnu_travel_to_sagala_2"),
    (assign, "$tutorial_state", 0),
    (assign, "$temp3", 1),
    (set_jump_mission, "mt_desert_cutscene"),
    (modify_visitors_at_site, "scn_cutscene_parthia"),
    (reset_visitors),

    (set_visitor, 1, "trp_player"),
    (troop_set_slot, "trp_temp_array_a", 1, "trp_caravan_guard"),
    (troop_set_slot, "trp_temp_array_a", 2, "trp_eastern_horsearcher_vet"),
    (troop_set_slot, "trp_temp_array_a", 3, "trp_eastern_horsearcher_exp"),
    (troop_set_slot, "trp_temp_array_a", 4, "trp_eastern_horsearcher"),
    (troop_set_slot, "trp_temp_array_a", 5, "trp_eastern_medium_horseman_exp"),
    (troop_set_slot, "trp_temp_array_a", 6, "trp_eastern_medium_horseman"),

    (try_begin),
        (eq,"$character_gender", tf_female),
        (troop_set_type,"trp_multiplayer_profile_troop_male", tf_female),
    (else_try),
        (troop_set_type,"trp_multiplayer_profile_troop_male", tf_male),
    (try_end),
    (str_store_troop_face_keys, s1, "trp_player"),
    (troop_set_face_keys, "trp_multiplayer_profile_troop_male", s1),
    (call_script, "script_dplmc_copy_inventory", "trp_player", "trp_multiplayer_profile_troop_male"),

    (troop_set_slot, "trp_temp_array_a", 7, "trp_multiplayer_profile_troop_male"),

    (jump_to_scene, "scn_cutscene_parthia"),
    (change_screen_mission),
  ]),
]),
("travel_to_sagala_2",0,
  "The people you see are dressed in colorful clothing and some wear a colored dot on their forehead. The various foods you taste are surprisingly spicy and colorful. Some people use elephants for transportation. And you see strange little hairy people with tails walking around on all fours. You watched helplessly as a group of these little creatures tries to steal your food and when you wanted to scare them away you are told by the locals that they are holy animals and it is not allowed to hurt them.^^After a long journey through dense forests you finally reach the city of Sagala. You were told by Phamanus that the great Emperor Kujula Kadphises of the Kushan Empire is currently in a campaign to conquer these lands. Yet, the town of Sangala continues to resist. You are then told by a local that Sagala is ruled by Queen Karishma, who took a pale-skinned man, speaking a foreign language, as lover. Could this foreigner be Wlodowiecus? You should try find Karishma.",
  "none", [
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
  ("option_1",[],"Continue...",[
    (add_xp_as_reward, 2500),
    (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_1", 3, "@You arrived at Sagala. Try to find Wlodowiecus.", 0),
    (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_1", 4, "@Ask a guard for an audience with Queen Karishma. She probably knows more about Wlodowiecus.", 0),
    (display_message, "str_quest_updated"),
    (play_sound, "snd_quest_concluded"),

    (assign, "$talk_context", -1),
    (assign, "$g_start_belligerent_drunk_fight", 3),
    (set_jump_mission,"mt_visit_sagala"),
    (modify_visitors_at_site,"scn_sagala"),
    (reset_visitors, 0),
    (set_visitor, 2, "trp_hadrianus"),
    (set_visitor, 3, "trp_wlodowiecus"),
    (set_visitor, 52, "trp_merchant8"),
    (try_begin),
        (scene_slot_eq, "scn_sagala", slot_scene_visited, 0),
        (set_visitor, 0, "trp_player"),
    (else_try),
        (set_visitor, 1, "trp_player"),
    (try_end),
    (try_for_range, ":entry", 4, 50),
        (store_random_in_range, ":r", 0, 2),
        (try_begin),
            (eq, ":r", 0),
            (set_visitor, ":entry", "trp_indian_spearman"),
        (else_try),
            (set_visitor, ":entry", "trp_indian_archer"),
        (try_end),
    (try_end),
    (jump_to_scene,"scn_sagala"),
    (change_screen_mission),
    #entry 0 player
    #entry 1 player
    #2 hadrian
    #3 wlodowicus
    #4-9 castle guards with info
    ##other guards
    #10-26
    #27-49 walker
  ]),
]),
  # ("visit_to_sagala",0,
    # "You are inside Sagala",
    # "none", [
    # (set_background_mesh, "mesh_pic_deserters"),
    # ],

    # [

    # ("option_1",[],"Walk around.",
        # [
        # #entry 0 player
        # #entry 1 player
        # #2 hadrian
        # #3 wlodowicus
        # #4-9 castle guards with info

        # ##other guards
        # #10-26
    # (assign, "$talk_context", -1),
    # (set_jump_mission,"mt_visit_sagala"),
    # (modify_visitors_at_site,"scn_sagala"),
    # (reset_visitors, 0),
    # (set_visitor, 2, "trp_hadrianus"),
    # (set_visitor, 3, "trp_wlodowiecus"),
    # (set_visitor, 52, "trp_merchant8"),
    # (try_begin),
        # (scene_slot_eq, "scn_sagala", slot_scene_visited, 0),
        # (set_visitor, 0, "trp_player"),
    # (else_try),
        # (set_visitor, 1, "trp_player"),
    # (try_end),
    # (try_for_range, ":entry", 4, 50),
        # (store_random_in_range, ":r", 0, 2),
        # (try_begin),
            # (eq, ":r", 0),
            # (set_visitor, ":entry", "trp_indian_spearman"),
        # (else_try),
            # (set_visitor, ":entry", "trp_indian_archer"),
        # (try_end),
    # (try_end),
    # (jump_to_scene,"scn_sagala"),
    # (change_screen_mission),
        # #27-49 walker
      # ]),
    # ],
  # ),

("escaped_sagala",0,
  "The guards soon give up on chasing you and return to their town. You managed to escape from Sagala with Hadrianus and Wlodowiecus."
  +"^^You wander through thick forests until you come across a cave next to a waterfall. You decide to set up camp there and try to find a way back west. But eventually,"
  +" several days pass and you can't find a way out of the jungle. If no divine miracle happens, you will probably die out starvation. Out of despair Hadrianus starts to pray to Christus,"
  +" while Wlodowiecus makes small sacrifices to his Germanic gods. You are also making prayers and sacrifices to the deities you believe in.^^"
  +"One day, something rustles in the bushes outside the cave, fearing the wrath of Sagala's army or worse, a hungry beast, you and your friends prepare for a fight until a man dressed in Roman arms enters the cave, giving you all a sly smile.",
  "none", [
    (set_background_mesh, "mesh_pic_cave"),
  ],[
    ("option_1",[],"Continue.",[
      (add_xp_as_reward, 1500),
      (quest_set_slot, "qst_wlodowiecus_adventure_1", slot_quest_current_state, 5),
      (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_1", 3, "@You found Wlodowiecus and escaped from Sagala.", 0),
      (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_1", 4, "@Now you need to find the special marble and a way back.", 0),
      (display_message, "str_quest_updated"),
      (play_sound, "snd_quest_concluded"),
      (assign, "$g_start_belligerent_drunk_fight", 0),

      (assign, "$talk_context", -1),
      (set_jump_mission,"mt_jungle_lair_final"),
      (modify_visitors_at_site,"scn_jungle_camp"),
      (reset_visitors, 0),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_hadrianus"),
      (set_visitor, 3, "trp_wlodowiecus"),
      (set_visitor, 4, "trp_mancinellus"),
      (jump_to_scene,"scn_jungle_camp"),
      (change_screen_mission),
    ]),
]),

("jungle_final",0,
  "Outside of the cave a group of Kushan soldiers is already waiting for you. You and your new friends then travel back to Sagala, now in Kushan control, where Mancinellus divides the spices equally between the four of you. Now with the Kushan caravan assembled, the group leaves Sagala and then the travel back to Ctesiphon begins.^^One again you travel through the jungles of India over the mountains and deserts of Persia until you finally reach Ctesiphon. You and your new friends decide to part ways head back to Rome on their own. It's time to return to Olivarius with the marble!",
  "none", [
    (set_background_mesh, "mesh_pic_cave"),
  ],[
    ("option_1",[],"Continue.",[
      (quest_set_slot, "qst_wlodowiecus_adventure_1", slot_quest_current_state, 6),
      (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_1", 3, "@You returned from the lands East of the river Indus.", 0),

      (call_script, "script_change_player_relation_with_troop", "trp_mancinellus", 100),
      (call_script, "script_change_player_relation_with_troop", "trp_hadrianus", 100),
      (call_script, "script_change_player_relation_with_troop", "trp_wlodowiecus", 100),

      (str_store_party_name, s22, "p_town_6"),
      (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_1", 4, "@Travel to {s22} and meet Olivarius to claim your reward.", 0),
      (display_message, "str_quest_updated"),
      (play_sound, "snd_quest_concluded"),
      (troop_add_items, "trp_player", "itm_spice", 10),
      (assign, "$auto_menu", -1),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("bacchus_feast",0,
  "You witness as extravagant dishes are brought onto the table: They consist of various exotic animal meats, fruits and spices from far-away lands. These delicious plates were unlike anything you've seen or eaten before. After having a lavish meal, copious amounts of wine is served for everyone in the party. Not even in Nero's palace would people eat and drink such delicacies as the ones being served right now. While you continued eating, you noticed that one of the plates on which the food was served is not an ordinary plate, but a shield. The shield looks strong and of high quality. Why would someone use such a beautiful shield as plate? You think about it for a few minutes but you are then distracted by a beautiful dancer who catches your attention. ^As the feast progresses, you get more and more drunk. Due to the darkness of the cave and your inebriated state, the people around you start to slowly blur. You can only see colorful silhouettes dancing, kissing and making love under the dim light of the torches. The music and the conversations become a gentle whisper in your ears. ^You are touched, but you don't know by whom. You touch, but you don't know who and what you actually touched. You feel things you never experienced before. ^You smell the smoke of the torches mixed with the intoxicating perfumes and the sweet sweat of the people. ^Slowly everything becomes black.^^Hours later, you awake with a terrible headache.",
  "none", [
    (set_background_mesh, "mesh_pic_bacchus_feast_cave"),
  ],[
    ("option_1",[],"Continue.",[
      (quest_set_slot, "qst_bacchhus_quest", slot_quest_current_state, 1),
      (add_xp_as_reward, 1500),
      (modify_visitors_at_site, "scn_cave"),
      (reset_visitors),
      (set_visitor, 9, "trp_player"),
      (set_visitor, 8, "trp_bacchus"),
      (set_visitor,1,"trp_orgie_male1"),
      (set_visitor,2,"trp_orgie_fem3"),
      (set_visitor,3,"trp_orgie_fem2"),
      (set_visitor,4,"trp_orgie_male1"),
      (replace_scene_props, "spr_chest_a", "spr_empty"),
      (set_jump_mission, "mt_caves_of_bacchus"),
      (jump_to_scene, "scn_cave"),
      (change_screen_mission),
    ]),
]),

("bacchus_feast_rome",0,
  "You try your best to search for Dionysus.^^Meanwhile the party continues: The streets of Rome are crowded by millions of people partying."
  +" You see people vomiting and urinating next to temples, statues and other public buildings with little regard for it's sanctity or importance."
  +" Soon enough, various members of the debauched horde start making love with each other. The streets are now a cacophony of decadence, with melodious moans mixed with delirious laughter."
  +" Some drunkards and other degenerates start forcing themselves onto animals. You witness a senator riding donkey upside down."
  +" You see various noble women getting groped and engaging in lascivious orgies in the backstreets like common whores."
  +" The most devious of people are using this opportunity and start raping and killing their enemies and looting their houses. The chaos is getting worse and worse by the minute."
  +" Luckily, some of the senators that dodn't participate in the orgy or are sober through it pass an emergency law that prohibits this party and gives the order to the Praetorian Guard to stop this chaos immediately."
  +" It takes four days for this mess to be cleared. Thousands of people have died either due to murder or alcohol abuse.^^You were not able to find Dionysus. It appears that he fled back to the cave.",
  "none", [
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("option_1",[],"Continue.",[
      (call_script, "script_add_piety", -50, 1),
      (display_message, "@The gods are displeased with your actions, their wrath stirring ominous signs across the heavens.", message_negative),
      (quest_set_slot, "qst_bacchhus_quest", slot_quest_current_state, 3),
      (add_quest_note_from_sreg, "qst_bacchhus_quest", 2, "@It seems Dionysius fooled you and fled back to the cave.", 0),
      (add_quest_note_from_sreg, "qst_bacchhus_quest", 3, "@Return to the cave and confront him.", 0),
      (display_message, "str_quest_updated"),
      (play_sound, "snd_quest_concluded"),
      (change_screen_map),
    ]),
]),

("event_petrus",0,
  "Quo vadis?^^You spot a small group of people gathered before the entrance of a small cave. Nothing special at all, nevertheless you decide to stop and approach them.",
  "none", [
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
  ("option_1",[],"Approach.",[
    (assign, "$temp2", 250),
    (assign, "$temp", 0),
    #(troop_set_slot, "trp_petrus", slot_troop_occupation, 0),
    (modify_visitors_at_site, "scn_petrus_event"),
    (reset_visitors),
    (set_visitor, 0, "trp_player"),

    (set_visitor, 1, "trp_petrus"),

    (set_visitor,2,"trp_christ"),
    (set_visitor,3,"trp_christ_fem"),
    (set_visitor,4,"trp_christ"),
    (set_visitor,5,"trp_christ_fem"),
    (set_visitor,6,"trp_christ_fem"),

    (set_jump_mission, "mt_visit_petrus"),
    (jump_to_scene, "scn_petrus_event"),
    (change_screen_mission),
  ]),
  ("option_1",[],"Leave.",[
    (troop_set_slot, "trp_paulus", slot_troop_met, 1),
    (change_screen_map),
  ]),
]),

("cythnus",0,
  "You reach the island Cythnus. It is a small and rocky place, only a handful of your companions can follow you.",
  "none", [
    (set_background_mesh, "mesh_pic_ships"),
  ],[
    ("option_1",[
      (check_quest_active, "qst_nero_reborn"),
    ],"Go ashore.",[
      #0 player
      #1 enemies
      #4-3-2 archers
      #5 fake nero
      #6-10 enemies
      (modify_visitors_at_site, "scn_cythnus"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),

      (set_visitors, 1, "trp_looter", 10),
      (set_visitors, 2, "trp_mercenary_crossbowman", 2),
      (set_visitors, 3, "trp_looter", 2),
      (set_visitors, 4, "trp_mercenary_crossbowman", 2),
      (set_visitor, 5, "trp_fake_nero"),
      (set_visitors, 6, "trp_roman_deserter", 7),
      (set_visitors, 7, "trp_roman_deserter", 7),
      (set_visitors, 8, "trp_roman_deserter", 7),
      (set_visitors, 9, "trp_roman_deserter", 6),
      (set_visitors, 10, "trp_roman_deserter", 6),

      (set_jump_mission, "mt_fake_nero_fight"),
      (jump_to_scene, "scn_cythnus"),
      (change_screen_mission),
    ]),
    ("option_1",[
      (neg|check_quest_active, "qst_nero_reborn"),
      (troop_slot_eq, "trp_global_variables", g_cythus_3, 0),
    ],"Go ashore.",[
      (modify_visitors_at_site, "scn_cythnus"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (assign, "$temp", 0),
      # (set_visitors, 1, "trp_sea_raider", 10),
      (set_visitors, 2, "trp_looter", 2),
      (set_visitors, 3, "trp_sea_raider", 2),
      (set_visitors, 3, "trp_bandit", 1),
      (set_visitors, 4, "trp_mercenary_crossbowman", 2),
      (set_visitor, 5, "trp_sussus_amogus"),
      (set_visitors, 6, "trp_sea_raider", 2),
      (set_visitors, 6, "trp_looter", 5),
      (set_visitors, 7, "trp_sea_raider", 2),
      (set_visitors, 7, "trp_looter", 5),
      (set_visitors, 8, "trp_sea_raider", 2),
      (set_visitors, 8, "trp_looter", 4),
      (set_visitors, 9, "trp_looter", 10),
      (set_visitors, 9, "trp_brigand", 1),
      (set_visitors, 10, "trp_sea_raider", 2),
      (set_visitors, 10, "trp_looter", 8),

      (set_jump_mission, "mt_island_cythnus"),
      (jump_to_scene, "scn_cythnus"),
      (change_screen_mission),
    ]),

    ("option_1",[
      (neg|check_quest_active, "qst_nero_reborn"),
      (troop_slot_eq, "trp_global_variables", g_cythus_3, 1),
    ],"Go ashore.",[
      (set_jump_mission, "mt_explore_secret_place"),
      (set_jump_entry, 0),
      (jump_to_scene, "scn_cythnus"),
      (change_screen_mission),
    ]),

    ("option_1",[],"Leave.",[
      (change_screen_map),
    ]),
]),

("fake_nero_defeated",0,
  "You defeated the false Nero!^^You gain all the unlawfully taken items back. Among them is the decorated breastplate of Augustus and a decorated spatha. Fake-Nero probably found it while raiding his Mausoleum.",
  "none", [
    (set_background_mesh, "mesh_pic_seabattle"),
  ],[
    ("option_1",[],"Leave.",[
      (add_xp_as_reward, 1000),
      (troop_add_item, "trp_player", "itm_augustus_armor"),
      (troop_add_item, "trp_player", "itm_ancient_spatha"),
      (call_script, "script_succeed_quest", "qst_nero_reborn"),
      (call_script, "script_end_quest", "qst_nero_reborn"),
      (change_screen_map),
    ]),
]),

("greek_game_defeat",0,
  "The game is over. You have been defeated. Talk to the Greek philosopher if you want to try it again.",
  "none", [
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
  ("option_1",[],"Continue.",[
    (change_screen_map),
  ]),
]),

("greek_game_no",0,
  "The game is over. You decided not to ascend to the final floor. Your modesty shows humility, but you are denied a look at the secrets of the world.",
  "none", [
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
  ("option_1",[],"Continue.",[
    (troop_set_slot, "$g_talk_troop", slot_troop_party_template,1),
    (call_script, "script_raise_level", "trp_player", 2),
    (change_screen_map),
  ]),
]),

("greek_game_won",0,
  "You ascended to the final floor. Your new knowledge will hopefully help you being a better ruler.",
  "none", [
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
  ("option_1",[],"Continue.",[
    (troop_set_slot, "$g_talk_troop", slot_troop_party_template,1),
    (call_script, "script_raise_level", "trp_player", 3),
    (change_screen_map),
  ]),
]),

("wait_storm",0,
  "You order your ships to hold. A small boat is let into the water. You enter it and order your other ships to travel to Athens.^^The hours pass and the sun is burning you. In the distance you spot clouds. The wind is getting stronger. As evening falls, a strong storm starts. A large wave capsizes your boat. With effort you try to stay afloat, but you fail. You lose consciousness.",
  "none", [
    (set_background_mesh, "mesh_pic_seabattle"),
  ],[
    ("option_1",[],"Continue.",[
      (modify_visitors_at_site, "scn_elysium"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),

      (set_visitor, 1, "trp_desiderius"),
      (set_visitor, 2, "trp_odius"),
      (set_visitor, 3, "trp_amalia"),
      (set_visitor, 4, "trp_fiducia"),
      (set_visitor, 5, "trp_herakles"),
      (set_visitor, 6, "trp_aeneas"),

      (set_jump_mission, "mt_elysium"),
      (jump_to_scene, "scn_elysium"),
      (change_screen_mission),
    ]),
]),

("elysium_reached",mnf_scale_picture,
  "'He who binds to himself a joy^Does the winged life destroy^He who kisses the joy as it flies^Lives in eternity's sunrise '^^^^Days, weeks, years pass by and you do not notice. Empires rise and fall, mankind fades away. Yet, you found joy and happiness. You found Elysium. ",
  "none", [
    (set_background_mesh, "mesh_pic_elysium"),
  ],[
  ("option_1",[],"Continue.",[
    (call_script, "script_end_quest", "qst_elysium"),
    (change_screen_quit),
  ]),
]),

("elysium_refused",mnf_scale_picture,
  "You wake up on a beach not far from Byzantium. Your head hurts. Soon your soldiers, who have been searching for you for days, spot you."
  +"^^Now you know Elysium exist, a place where neither hunger nor winter, neither wolves nor lions, neither war nor death exist. Alas you will never be able to return.",
  "none", [
    (set_background_mesh, "mesh_pic_roma"),
  ],[

  ("option_1",[],"Continue.",[
    (call_script, "script_end_quest", "qst_elysium"),
    (add_xp_as_reward, 2000),
    (party_relocate_near_party, "p_main_party", "p_town_13",2),
    (change_screen_map),
  ]),
]),

("flavor_event_1",mnf_scale_picture,
  "The Lupanar is a dilapidated building on a secluded side street.^When you enter it a hideous stench hits you. Though you are too drunken to really perceive it."
  +" You and the soldiers sit down and some dancers appear.",
  "none", [
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[
    ("answere_1",[],"Continue...",[
      (assign, "$temp1", 12),
      (assign, "$temp2", -1),
      (assign,"$talk_context", tc_tavern_talk),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_luparnium"),
      (reset_visitors),

      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_conversation_generic", 1, 0),
        (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_outfit_1|af_override_horse),
      (else_try),
        (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_weapons|af_override_horse|af_override_head),
      (try_end),
      (set_visitor, 1, "trp_player"),

      (try_for_range, ":entry", 2, 4),
        (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_weapons|af_override_horse|af_override_head),
      (try_end),
      (set_visitor, 2, "trp_aux_inf"),
      (set_visitor, 3, "trp_vigilia"),

      (try_for_range, ":entry", 4, 10),
        (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_everything),
      (try_end),

      (set_visitor, 4, "trp_slave"),
      (set_visitor, 5, "trp_slave_female"),
      (set_visitor, 6, "trp_slave"),
      (set_visitor, 7, "trp_slave_female"),
      (set_visitor, 8, "trp_slave_female"),
      (set_visitor, 9, "trp_slave_female"),

      (jump_to_scene, "scn_luparnium"),
      (change_screen_mission),
    ]),
]),
("flavor_event_1_end",mnf_scale_picture,
  "You share several cups of wine with him, the evening growing hazy with laughter and stories, until he takes the hand of a dancer and vanishes into an alcove. You are left alone with a dancer."
  +" Like a she-wolf, she slowly approaches you. She quickly relieved you of your gold that you are carrying with you and before you can do anything she has already disappeared."
  +" A moment later a strong man appears. This must be Gaius. He grabs you by both shoulders and throws you out of the house. You stagger back to the tavern and quickly fall asleep.",
  "none", [
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[
    ("option_1",[],"Continue.",[
      (add_xp_as_reward, 1000),
      (troop_remove_gold, "trp_player", 500),
      (change_screen_map),
    ]),
]),


("flavor_event_3",mnf_scale_picture,
  "You follow the Sarmatians to the hut of Wlodarnoxarthos.^ His wife welcomes you amicably. She looks strong and healthy although she has given birth to many children she still looks beautiful.^ You sit down and continue smoking with the others, while his wife prepares the meal. His daughters appear and wash your hands and feet. Then they bring the food. They serve many different dishes on silver plates that clearly testify to the wealth of the host. Now also Wlodarnoxarthos sons appear and join the meal. After the meal is finished, Wlodarnoxarthos orders his children to leave them. He tells only his wife to stay with him.^You continue smoking. While Kentaskros falls a sleep and Wlodarnoxarthos cuddling with his wife, the eldest daughter appears to bring some fruits and more weed. She accidentally pours the bowl over and kneels next to you to collect the fruit. Thereby she touches you several times. After she finished, she remains sitting next to you and slowly starts stroking your legs, arms and chest. She takes a quick glances at her parents. They are already in an advanced progress of making love. Then she looks at you, smiles and kisses you. Now the real fun starts...^^^^On the next day, you awake in the soft arms of a Wlodarnoxarthos' daughter. He, his wife and Kentaskros are still sleeping. In the middle of the hut stands the bong. Golden and beautiful.",
  "none", [
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[
  ("option_1",[],"Just quickly leave.",[
    (add_xp_as_reward, 1000),
    (change_screen_map),
  ]),
  ("option_1",[],"Take the bong and then leave.",[
    (troop_add_item, "trp_player", "itm_scythian_bong"),
    (add_xp_as_reward, 2000),
    (change_screen_map),
  ]),
]),

("flavor_event_4",mnf_scale_picture,
  "Everyone runs out of the tavern into the street to see what happened. Women are screaming, the street is full of blood. You see a dead body laying under a cart. "+
  "It is {s2}! Witnesses say that he stormed out of the tavern and was caught by a passing cart. He died immediately.^The tavernkeeper, standing next to you notes:^"+
  "'I am very happy that I never sacrificed to Sol, as it seems he is killing his followers.'^The vigilia appears to remove the dead body. You want to take a last look at him but"+
  " the sun is blinding you.",
  "none", [
    (set_background_mesh, "mesh_pic_roma"),
    (str_store_troop_name, s2, "trp_random_idiot"),
  ],[
    ("option_1",[],"Continue.",[
      (add_xp_as_reward, 1000),
      (jump_to_menu, "mnu_town"),
    ]),
]),

("flavor_event_5",mnf_scale_picture,
  "The man turns around and looks at Kashamir. He has the build of a true Herakles! He grabs Kashamir at his throat and throws him onto the floor. "+
  "Then he beats into his face several times. You think it will be over quickly but the man doesn't stop. He keeps beating his face. The tavernkeeper "+
  "and other guests try to stop him, but its too late ... Kashamir has already died. The man quickly escapes through the door before the guard can catch him.",
  "none", [
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("option_1",[],"Continue.",[
      (troop_set_slot, "trp_global_variables", g_flavor_event_4, 3),
      (add_xp_as_reward, 1000),
      (jump_to_menu, "mnu_town"),
    ]),
]),

("flavor_event_5_2",mnf_scale_picture,
  "The tavernkeeper noticed Kashamir and told him he has many unpaid bills. He says he will call the guard to make sure his bills get paid! "+
  "Kashamir quickly pushes you away and runs in direction of the door. "+
  "The man turns around and looks at Kashamir. He has the build of a true Herakles! He grabs Kashamir at his throat and throws him onto the floor. "+
  "Then he beats into his face several times. You think it will be over quickly but the man doesn't stop. He keeps beating his face. You, the tavernkeeper "+
  "and other guests try to stop him, but its too late ... Kashamir has already died. The man quickly escapes through the door before the guard can catch him. ",
  "none", [
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("option_1",[],"Continue.",[
      (troop_set_slot, "trp_global_variables", g_flavor_event_4, 3),
      (add_xp_as_reward, 1000),
      (jump_to_menu, "mnu_town"),
    ]),
]),

("phamanus_travel",mnf_scale_picture,
  "{s25}",
  "none", [
    (try_begin),
      (eq, "$temp1", "scn_sagala"),
      (set_background_mesh, "mesh_pic_deserters"),
      (str_store_string, s25, "str_event_caravan_sagala"),
    (else_try),
      (eq, "$temp1", "scn_baltic_town"),
      (set_background_mesh, "mesh_pic_castlesnow"),
      (str_store_string, s25, "str_event_caravan_sciri"),
    (else_try),
      (eq, "$temp1", "scn_subsaharan_african_village"),
      (set_background_mesh, "mesh_pic_village_p"),
      (str_store_string, s25, "str_event_caravan_djenne"),
    (else_try),
      (eq, "$temp1", "scn_kashar"),
      (set_background_mesh, "mesh_pic_castledes"),
      (str_store_string, s25, "str_event_caravan_karsahr"),
    (try_end),
  ],[
    ("option_1",[],"Enter.",[
      (try_begin),
          (eq, "$temp1", "scn_sagala"),
          (assign, "$talk_context", -1),
          (assign, "$g_start_belligerent_drunk_fight", -1),
          (set_jump_mission,"mt_visit_sagala"),
          (modify_visitors_at_site,"scn_sagala"),
          (reset_visitors, 0),
          (set_visitor, 2, "trp_slave"),
          (set_visitor, 3, "trp_slave"),
          (set_visitor, 52, "trp_merchant8"),
          (try_begin),
              (scene_slot_eq, "scn_sagala", slot_scene_visited, 0),
              (set_visitor, 0, "trp_player"),
          (else_try),
              (set_visitor, 1, "trp_player"),
          (try_end),
          (try_for_range, ":entry", 4, 50),
              (store_random_in_range, ":r", 0, 2),
              (try_begin),
                  (eq, ":r", 0),
                  (set_visitor, ":entry", "trp_indian_spearman"),
              (else_try),
                  (set_visitor, ":entry", "trp_indian_archer"),
              (try_end),
          (try_end),
          (jump_to_scene,"scn_sagala"),
          (change_screen_mission),
          #entry 0 player
          #entry 1 player
          #2 hadrian
          #3 wlodowicus
          #4-9 castle guards with info
          ##other guards
          #10-26
          #27-49 walker
      (else_try),
          (eq, "$temp1", "scn_baltic_town"),
          (assign, "$temp1", 13),
          (assign, "$temp2", -1),
          (set_jump_mission, "mt_conversation_generic"),
          (modify_visitors_at_site, "scn_baltic_town"),
          (reset_visitors),
          (set_visitor, 1, "trp_player"),

          (set_visitor, 45, "trp_germanic_richmerchant"),
          (set_visitor, 46, "trp_germanic_poormerchant"),

          (try_begin),
              (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 11), ## not looted
              (set_visitor, 8, "trp_ekkebert"),
          (else_try),# looted
              (set_visitor, 8, "trp_egino"),
          (try_end),

          (try_for_range, ":entry", 12, 25),
              (set_visitor, ":entry", "trp_baltic_hunter"),
          (try_end),
          (jump_to_scene, "scn_baltic_town"),
          (change_screen_mission),
      (else_try),
          (eq, "$temp1", "scn_subsaharan_african_village"),
          (assign, "$current_town", "p_nubian_town_1"),
          (assign, "$g_encountered_party", "p_nubian_town_1"),
          (assign, "$temp1", 13),
          (assign, "$temp2", -1),
          (assign, "$talk_context", 0),
          (set_jump_mission, "mt_conversation_generic"),
          (modify_visitors_at_site, "scn_subsaharan_african_village"),
          (reset_visitors),

          (try_for_range, ":entry", 1, 31),
              (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_horse),
          (try_end),
          (set_visitor, 1, "trp_player"),
          (set_visitor, 7, "trp_african_richmerchant"),
          (set_visitor, 8, "trp_african_poormerchant"),
          (set_visitor, 9, "trp_sarranid_horseman"),
          (set_visitor, 10, "trp_sarranid_horseman"),
          (set_visitor, 11, "trp_sarranid_horseman"),
          (set_visitor, 12, "trp_sarranid_horseman"),
          (set_visitor, 13, "trp_sarranid_horseman"),
          (set_visitor, 14, "trp_sarranid_horseman"),
          (set_visitor, 15, "trp_african_man"),
          (set_visitor, 16, "trp_african_woman"),
          (set_visitor, 17, "trp_african_man"),
          (set_visitor, 18, "trp_african_woman"),
          (set_visitor, 19, "trp_african_woman"),
          (set_visitor, 20, "trp_african_woman"),
          (set_visitor, 21, "trp_african_woman"),
          (set_visitor, 22, "trp_african_man"),
          (set_visitor, 23, "trp_african_woman"),
          (set_visitor, 24, "trp_african_man"),
          (set_visitor, 25, "trp_african_woman"),
          (set_visitor, 26, "trp_african_woman"),
          (set_visitor, 27, "trp_african_woman"),
          (set_visitor, 28, "trp_african_woman"),
          (set_visitor, 29, "trp_african_man"),
          (set_visitor, 30, "trp_african_woman"),

          (jump_to_scene, "scn_subsaharan_african_village"),
          (change_screen_mission),
      (else_try),
          (eq, "$temp1", "scn_kashar"),

          (assign, "$temp1", 13),
          (assign, "$temp2", -1),
          (assign, "$talk_context", 0),
          (assign, "$current_town", "p_dahae_town_1"),
          (assign, "$g_encountered_party", "p_dahae_town_1"),

          (set_jump_mission, "mt_conversation_generic"),
          (modify_visitors_at_site, "scn_kashar"),
          (reset_visitors),
          (try_for_range, ":entry", 1, 43),
              (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_horse),
          (try_end),
          (set_visitor, 1, "trp_player"),
          (set_visitor, 2, "trp_saka_richmerchant"),
          (set_visitor, 3, "trp_saka_poormerchant"),
          (set_visitor, 4, "trp_merchant8"),
          (set_visitor, 5, "trp_merchant5"),
          (set_visitor, 6, "trp_merchant6"),

          # (set_visitor, 8, "trp_xingnu_barbarian"),
          # (set_visitor, 9, "trp_xingnu_barbarian"),
          # (set_visitor, 10, "trp_xingnu_barbarian"),
          # (set_visitor, 11, "trp_xingnu_barbarian"),
          # (set_visitor, 12, "trp_xingnu_barbarian"),
          # (set_visitor, 13, "trp_gaetuli_horseman"),
          # (set_visitor, 14, "trp_lombard_vetran"),
          # (set_visitor, 15, "trp_old_mercenary"),

          (set_visitor, 21, "trp_saka_horse_archer"),
          (set_visitor, 22, "trp_saka_horse_archer"),
          (set_visitor, 23, "trp_saka_horse_archer"),
          (set_visitor, 24, "trp_saka_horse_archer"),
          (set_visitor, 25, "trp_saka_horse_archer"),
          (set_visitor, 26, "trp_saka_horse_archer"),
          (set_visitor, 27, "trp_judean_village_walker_female"),
          (set_visitor, 28, "trp_judean_village_walker_female"),
          (set_visitor, 29, "trp_judean_village_walker"),
          (set_visitors, 30, "trp_judean_village_walker", 2),
          (set_visitors, 31, "trp_judean_village_walker_female", 2),
          (set_visitors, 32, "trp_judean_village_walker", 2),
          (set_visitors, 33, "trp_judean_village_walker_female", 2),
          (set_visitors, 34, "trp_saka_man", 2),
          (set_visitors, 35, "trp_saka_woman", 2),
          (set_visitors, 36, "trp_saka_man", 2),
          (set_visitors, 37, "trp_saka_woman", 2),
          (set_visitors, 38, "trp_saka_man", 2),
          (set_visitors, 39, "trp_saka_woman", 2),
          (set_visitors, 40, "trp_saka_man", 2),
          (set_visitors, 41, "trp_saka_woman", 2),
          (set_visitors, 42, "trp_saka_man", 2),
          (jump_to_scene, "scn_kashar"),
          (change_screen_mission),
      (try_end),
    ]),
    ("option_1",[],"Travel back to Rome.",[
      (rest_for_hours, 72, 16, 0),
      (jump_to_menu, "mnu_auto_return_map"),
      (add_xp_as_reward, 1000),
    ]),
]),

("wlodowiecus_adventure_1_4_journey_starts",mnf_scale_picture,
  "After meeting with the Alanic guide recommended by The Lybian, you gather with the rest of the caravan before setting off for Chersonesus."
  +" You're struck by the diversity of the group: Winnili mercenaries, some familiar faces from your journey through the Barbaricum and others new;"
  +" Garamantian horsemen, including members of the same tribe that led you to the Gao River in the Sahara; and Alan warriors assembled by Wlodowiecus,"
  +" including the guide you hired in Byzantion. The journey by ship is calm and uneventful.",
  "none", [
    (set_background_mesh, "mesh_pic_ships"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$talk_context", tc_town_talk),
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_4_journey_1")
    ]),
]),
("wlodowiecus_adventure_1_4_journey_1",mnf_scale_picture,
  "You arrive in the city of Chersonesus. The Alanic guide quickly reunites with his tribesmen at a local tavern, where they eagerly gather,"
  +" likely drawn by the promise of coin as they join your caravan as guards. With their ranks bolstered, you depart the Bosporan city and"
  +" begin your journey eastward.",
  "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    (troop_set_inventory_slot, "trp_wlodowiecus", ek_horse, "itm_horse_3"),
    (troop_set_inventory_slot, "trp_hadrianus",  ek_horse, "itm_horse_3"),
    (troop_set_inventory_slot, "trp_mancinellus",  ek_horse, "itm_horse_3"),
    (troop_set_inventory_slot, "trp_ali",  ek_horse, "itm_horse_3"),
    (troop_set_inventory_slot, "trp_old_mercenary",  ek_horse, "itm_horse_3"),
  ],[
    ("option_1",[],"Continue.",[
      (add_xp_as_reward, 2000),

      (assign, "$g_next_menu", "mnu_wlodowiecus_adventure_1_4_journey_temple"),
      (assign, "$tutorial_state", 0),
      (assign, "$temp3", 1),
      (set_jump_mission, "mt_desert_cutscene"),
      (modify_visitors_at_site, "scn_cutscene_steppe"),
      (reset_visitors),

      (set_visitor, 1, "trp_player"),
      (troop_set_slot, "trp_temp_array_a", 1, "trp_mancinellus"),
      (troop_set_slot, "trp_temp_array_a", 2, "trp_wlodowiecus"),
      (troop_set_slot, "trp_temp_array_a", 3, "trp_hadrianus"),
      (troop_set_slot, "trp_temp_array_a", 4, "trp_old_mercenary"),
      (troop_set_slot, "trp_temp_array_a", 5, "trp_ali"),
      (troop_set_slot, "trp_temp_array_a", 6, "trp_alan_horse_archer"),

      (try_begin),
          (eq,"$character_gender", tf_female),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_female),
      (else_try),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_male),
      (try_end),
      (str_store_troop_face_keys, s1, "trp_player"),
      (troop_set_face_keys, "trp_multiplayer_profile_troop_male", s1),
      (call_script, "script_dplmc_copy_inventory", "trp_player", "trp_multiplayer_profile_troop_male"),

      (troop_set_slot, "trp_temp_array_a", 7, "trp_multiplayer_profile_troop_male"),

      # have them walking
      # (troop_set_inventory_slot, "trp_wlodowiecus", ek_horse, -1),
      # (troop_set_inventory_slot, "trp_hadrianus",  ek_horse, -1),
      # (troop_set_inventory_slot, "trp_mancinellus",  ek_horse, -1),
      # (troop_set_inventory_slot, "trp_ali",  ek_horse, -1),
      # (troop_set_inventory_slot, "trp_old_mercenary",  ek_horse, -1),
      # (troop_set_inventory_slot, "trp_multiplayer_profile_troop_male",  ek_horse, -1),

      (jump_to_scene, "scn_cutscene_steppe"),
      (change_screen_mission),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_temple",mnf_scale_picture,
  "After several days of travel, you come across a temple dedicated to the Scythian goddess Artimpasa."
  +" With the help of your Alanic guide, you manage to communicate with one of the Enaree, male priests who dress and live as women, serving alongside the female priestesses."
  +" The Enaree explains that this temple belongs to one of the last significant Scythian tribes and warns you to show proper respect to the temple and its people, or face severe consequences."
  +" Just then, your conversation is interrupted as Mancilleus turns abruptly and speaks to you.",
  "none", [
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("option_1",[],"Talk with Mancinellus.",[
      (call_script, "script_setup_troop_meeting", "trp_mancinellus", -1, -1),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_temple_outcome",mnf_scale_picture|mnf_enable_hot_keys,
  "{s15}",
  "none", [
    (str_clear, s15),
    (try_begin),
        (quest_slot_eq, "qst_wlodowiecus_adventure_4", slot_quest_target_dna, 1),
        (str_store_string, s15, "str_wlod_4_temple_1"),
    (else_try),
        (quest_slot_eq, "qst_wlodowiecus_adventure_4", slot_quest_target_dna, 2),
        (str_store_string, s15, "str_wlod_4_temple_2"),
    (else_try),
        (quest_slot_eq, "qst_wlodowiecus_adventure_4", slot_quest_target_dna, 3),
        (str_store_string, s15, "str_wlod_4_temple_3"),
    (try_end),
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("option_1",[],"Fight your way out!",[
      (assign, "$temp3", 1),
      (assign, "$temp1", "mnu_wlodowiecus_adventure_1_4_fight_1_victory"),
      (assign, "$temp2", "mnu_wlodowiecus_adventure_1_4_fight_1_die"),

      (set_jump_mission, "mt_wlods_advantures_fight"),
      (modify_visitors_at_site, "scn_random_scene_new_steppe_custom_10"),
      (reset_visitors),

      (set_visitor, 1, "trp_player"),
      (set_visitors, 1, "trp_lombard_vetran", 20),
      (set_visitors, 1, "trp_alan_horse_archer", 30),
      (set_visitors, 1, "trp_gaetuli_horseman", 20),

      (set_visitor, 1, "trp_wlodowiecus"),
      (set_visitor, 1, "trp_hadrianus"),
      (set_visitor, 1, "trp_mancinellus"),
      (set_visitor, 1, "trp_ali"),
      (set_visitor, 1, "trp_old_mercenary"),

      (set_visitors, 4, "trp_steppe_bandit", 20),
      (set_visitors, 4, "trp_alan_horse_archer", 20),
      (set_visitors, 4, "trp_alan_heavy_horse_archer", 20),
      (jump_to_scene, "scn_random_scene_new_steppe_custom_10"),
      (change_screen_mission),
    ]),
]),
("wlodowiecus_adventure_1_4_fight_1_die",mnf_scale_picture,
  "The battle is lost. The realization hits you like a cold blade—raiders swarm, chaos echoes, and the steppe feels endless, empty. Bodies—your comrades—lie strewn,"
  +" faces you know turned to lifeless masks. Mancilleus falls clutching the golden bracelet he never claimed, the Old Man's sword drops, his strength gone."
  +" Wlodowiecus's shouts fade to silence, Ali's mocking grin is no more. And Hadrianus—his eyes, once burning, now stare blankly at the sky."
  +"^^You're alone. The weight of it all settles—defeat, death, and the emptiness of the steppe swallowing everything.",
  "none", [
    (set_background_mesh, "mesh_pic_defeat"),
  ],[
    ("option_1",[],"Epiphany...",[
      (assign, "$temp", 0),
      (jump_to_menu, "mnu_death_waits"),
    ]),
]),
("wlodowiecus_adventure_1_4_fight_1_victory",mnf_scale_picture,
  "With great effort, you fend off the attackers. Some of the surviving raiders, gripped by panic, scatter in all directions, desperately trying to lose themselves in the vast, open steppe surrounding you."
  +" You spot Mancilleus looting a fallen chieftain, prying a golden bracelet from his arm, while the Old Man wipes sweat from his brow, finishing off one of the raiders with grim efficiency."
  +" Wlodowiecus, distraught and furious, is shouting like a madman, while Ali, sauntering arrogantly across the battlefield, makes snarky remarks about the fallen enemies."
  +" Curiously, there is a dark, grim expression in Hadrianus's eyes as he seems to struggle with suppressed anger."
  +"^^Taking a moment to catch your breath, you join in the looting, pocketing some golden jewelry from the dead—valuables worth a hefty sum of denarii."
  +" Once the spoils are gathered, Wlodowiecus, in a commanding voice, orders everyone to regroup and set up camp. You instruct the others to tend to the wounded and bury the dead,"
  +" and Hadrianus, eager to keep himself occupied, volunteers for the task.",
  "none", [
    (set_background_mesh, "mesh_pic_victory"),
  ],[
    ("option_1",[],"Set camp and wait for the next day.",[
      (troop_add_gold, "trp_player", 10000),
      (troop_add_item, "trp_player", "itm_jewelry", 0),
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_4_journey_camp"),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_camp",mnf_scale_picture,
  "The camp took most of the afternoon to set up, but it was completed just before sunset."
  +" Several fires flicker around the camp, with small groups of warriors gathered around, murmuring and exchanging quiet words."
  +" You and your companions, along with the Alan guide, settle around the central fire. In the distance, some of the Alani play an unfamiliar instrument, their voices rising in a song sung in a tongue different from their own."
  +" You cast a weary gaze at the group. You have survived this battle, but as you look into each of their eyes, you sense a shared, unspoken understanding: there will be more battles to come.",
  "none", [
    (set_background_mesh, "mesh_pic_camp"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$temp1", 1),
      (assign, "$temp2", "trp_wlodowiecus"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_cutscene_steppe"),
      (reset_visitors),
      (try_for_range, ":entry", 1, 21),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_weapons|af_override_horse|af_override_head),
      (try_end),
      (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_conversation_generic", 1, 0),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_outfit_1 | af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 3, "trp_alan_guide"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      (set_visitor, 6, "trp_ali"),
      (set_visitor, 7, "trp_old_mercenary"),

      (set_visitor, 8, "trp_lombard_vetran"),
      (set_visitor, 9, "trp_gaetuli_horseman"),
      (set_visitor, 10, "trp_alan_horse_archer"),
      (set_visitor, 11, "trp_alan_horse_archer"),
      (set_visitor, 12, "trp_alan_horse_archer"),
      (set_visitor, 13, "trp_alan_horse_archer"),
      (set_visitor, 14, "trp_alan_horse_archer"),
      (set_visitor, 15, "trp_gaetuli_horseman"),
      (set_visitor, 16, "trp_lombard_vetran"),
      (set_visitor, 17, "trp_gaetuli_horseman"),
      (set_visitor, 18, "trp_lombard_vetran"),
      (set_visitor, 19, "trp_alan_horse_archer"),
      (set_visitor, 20, "trp_alan_horse_archer"),
      (jump_to_scene, "scn_cutscene_steppe"),
      (change_screen_mission),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_wide",mnf_scale_picture,
  "The next day you pack your camp on your horses — including the ones captured from raiders — and gather your caravan through endless steppe."
  +" At one point, your guide leads you southwest, now traveling through the desert towards the nearby sea, which locals call the Aral Sea."
  +" Then you turn southeast again, traveling around the river which flows into it and which Hadrianus recognizes as Oxus river."
  +" You pass by the city of Gurganj and the Alan guides lead you northeast, crossing the Oxus river, going into Sogdiana.",
  "none", [
    (set_background_mesh, "mesh_pic_desert"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_4_journey_sogdia"),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_sogdia",mnf_scale_picture|mnf_enable_hot_keys,
  "You arrive at the nearest Sogdian town and secure lodging at a tavern, allowing you and your companions a much-needed rest."
  +" However, the next morning, chaos erupts as panic spreads throughout the city. Word quickly reaches you: a horde, said to be the distant Xiongnu — though"
  +" the locals aren't certain — has encircled the town, led by an unknown chieftain. The city's inhabitants, including their own king, plead for your assistance,"
  +" fearing that without your aid, everyone within the walls—yourselves included—will be slaughtered. Without hesitation, you rally your men to the town walls,"
  +" preparing to defend against the oncoming assault.",
  "none", [
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$temp3", 1),#used for current mission state
      (assign, "$temp1", "trp_wlodowiecus"),# starts conversation during battle
      (assign, "$temp4", "trp_alan_guide"),
      (assign, "$temp2", "mnu_wlodowiecus_adventure_1_4_fight_1_die"),
      (assign, "$tutorial_state", 0),
      (set_jump_mission, "mt_wlods_advantures_sogdia_siege"),
      (modify_visitors_at_site, "scn_sogdian_town"),
      (reset_visitors),
      #1,2,3,4 enemy archer positions
      #5,6,7,8 enemy spawns
      (set_visitors, 5, "trp_xingnu_barbarian", 38),
      (set_visitors, 6, "trp_xingnu_barbarian", 38),
      (set_visitors, 7, "trp_xingnu_barbarian", 38),
      (set_visitors, 8, "trp_xingnu_barbarian", 38),
      #10 player
      (set_visitor, 10, "trp_player"),
      #11 companion spawn
      (set_visitor, 11, "trp_wlodowiecus"),
      # (set_visitor, 11, "trp_alan_guide"),
      (set_visitor, 11, "trp_hadrianus"),
      (set_visitor, 11, "trp_mancinellus"),
      (set_visitor, 11, "trp_ali"),
      (set_visitor, 11, "trp_old_mercenary"),
      #12, 13,14,15 defenders reinforcements
      #16, 17, 18, 19, defender gathering points
      (set_visitors, 16, "trp_lombard_vetran", 15),
      (set_visitors, 17, "trp_alan_horse_archer", 20),
      (set_visitors, 18, "trp_gaetuli_horseman", 15),
      (set_visitors, 19, "trp_saka_heavy_cavalry", 10),

      (set_visitor, 30, "$temp4"),#neutral spawn for alan guide
      #40-47 defender archer positions, 35 troops
      (set_visitors, 40, "trp_saka_horse_archer", 10),
      (set_visitors, 41, "trp_saka_horse_archer", 10),
      (set_visitors, 42, "trp_saka_horse_archer", 10),
      (set_visitors, 43, "trp_saka_horse_archer", 5),
      (set_visitors, 44, "trp_saka_horse_archer", 5),
      (set_visitors, 45, "trp_saka_horse_archer", 5),
      (set_visitors, 46, "trp_saka_horse_archer", 5),
      (set_visitors, 47, "trp_saka_horse_archer", 5),
      (jump_to_scene, "scn_sogdian_town"),
      (change_screen_mission),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_sogdia_end",mnf_scale_picture,
  "You finally lead your group to what you hope is safety. Ensuring everyone—Mancilleus, Hadrianus, the Old Mercenary, Ali, Wlodowiecus, and any others who joined you—has made it inside,"
  +" you push forward through a dim cellar where the Sogdians once stored salt and meat. The air is thick with fear, and the scent of it is palpable as you hurry,"
  +" panting with each step. Above, the sounds of slaughter echo—agonized screams, the clash of steel, and the triumphant shouts and cruel laughter of the Xiongnu warriors."
  +"^^Pressing onward, you discover a small door that opens into what appears to be a cave system, moonlight filtering faintly through an opening ahead."
  +" You barricade the cellar door behind you, and then follow Wlodowiecus into the narrow passage. The cave leads deeper until Wlodo spots an exit—a sizable hole"
  +" that opens to the outside of the city. You gather your strength and climb out, relief flooding you for a brief moment—until you see the spears and arrows aimed directly at you."
  +" Fear grips you, and your stomach knots as realization sets in: the Xiongnu knew about the cave entrance all along. They had been waiting for you to emerge.",
  "none", [
    (set_background_mesh, "mesh_pic_prisoner_man"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_4_journey_xongnu_prisoner"),
      (add_xp_as_reward, 5000),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_xongnu_prisoner",mnf_scale_picture,
  "You are herded into a holding pen, destined either for slavery or some other grim fate at the hands of the horde."
  +" Just as hope begins to slip away, you notice a figure who appears to be the leader—the Khan of the horde."
  +" You watch as Mancilleus steps forward, attempting to speak with him. To your surprise, the Khan, looking amused, engages him in conversation.",
  "none", [
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("text_scene",[
      (ge, "$cheat_mode", 1),
    ],"Test Scene.",[
      (jump_to_scene, "scn_xiongnu_camp"),
      (change_screen_mission),
    ]),
    ("option_1",[],"Continue.",[
      (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 7),
      (assign, "$temp1", 2),
      (assign, "$temp2", "trp_temur"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_xiongnu_camp"),
      (reset_visitors),
      (try_for_range, ":entry", 1, 9),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_everything),
      (try_end),
      (try_for_range, ":entry", 9, 38),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 3, "trp_old_mercenary"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      (set_visitor, 6, "trp_ali"),
      (set_visitor, 7, "trp_alan_guide"),

      (set_visitor, 8, "trp_lombard_vetran"),
      (set_visitor, 9, "trp_temur"),
      (set_visitor, 10, "trp_xingnu_barbarian"),
      (set_visitor, 11, "trp_xingnu_barbarian"),
      (set_visitor, 12, "trp_xingnu_barbarian"),
      (set_visitor, 13, "trp_xingnu_barbarian"),
      (set_visitor, 14, "trp_xingnu_barbarian"),
      (set_visitor, 15, "trp_xingnu_barbarian"),
      (set_visitor, 16, "trp_xingnu_barbarian"),
      (set_visitor, 17, "trp_xingnu_barbarian"),
      (set_visitor, 18, "trp_xingnu_barbarian"),
      (set_visitor, 19, "trp_xingnu_barbarian"),
      (set_visitor, 20, "trp_xingnu_barbarian"),
      (set_visitor, 21, "trp_xingnu_barbarian"),
      (set_visitor, 22, "trp_xingnu_barbarian"),
      (set_visitor, 23, "trp_xingnu_barbarian"),
      (set_visitor, 24, "trp_xingnu_barbarian"),
      (set_visitor, 25, "trp_xingnu_barbarian"),
      (set_visitor, 26, "trp_xingnu_barbarian"),
      (set_visitor, 27, "trp_xingnu_barbarian"),
      (set_visitor, 28, "trp_xingnu_barbarian"),
      (set_visitor, 29, "trp_xingnu_barbarian"),
      (set_visitor, 30, "trp_xingnu_barbarian"),
      (set_visitor, 31, "trp_xingnu_barbarian"),
      (set_visitor, 32, "trp_xingnu_barbarian"),
      (set_visitor, 33, "trp_xingnu_barbarian"),
      (set_visitor, 34, "trp_xingnu_barbarian"),
      (set_visitor, 35, "trp_xingnu_barbarian"),
      (set_visitor, 36, "trp_xingnu_barbarian"),
      (set_visitor, 37, "trp_xingnu_barbarian"),
      (jump_to_scene, "scn_xiongnu_camp"),
      (change_screen_mission),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_great_wall_1",mnf_scale_picture,
  "You and the rest of the caravan are freed from your bindings and invited to stay in a yurt prepared for you."
  +" A few hours later, several of your men who had been trapped inside the city are dragged out—some did not survive, but the remaining ones are allowed to join you."
  +" The Sogdian citizens and warriors, on the other hand, are enslaved. That night, a grand feast is held to celebrate the victory, and the Tuqi King requests Mancinellus's presence."
  +" He is escorted away while you are ordered to remain inside the yurt for the night."
  +"^^As you sit alone, memories of India flood back. Why does he always manage to impress leaders? He causes trouble for everyone, yet somehow manages to save the group every time."
  +" Why him? Why not you? But as you think further, you realize that each person here is unique in their own way; Mancinellus is no exception."
  +"^^The following morning, Mancinellus returns, grinning from ear to ear with two Xiongnu standing behind him. Apparently,"
  +" his stories and jokes had such an effect on the Tuqi King that he now wants to keep in contact with Mancinellus."
  +" The King even offered him a share of gold, silver, and other luxuries, along with assigning him Xiongnu bodyguards and guides.",
  "none", [
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_4_journey_great_wall_2"),
      (add_xp_as_reward, 1500),
      (troop_add_items, "trp_player", "itm_silver", 2),
      (troop_add_items, "trp_player", "itm_temple_gold", 2),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_great_wall_2",mnf_scale_picture|mnf_enable_hot_keys,
  "Reassured and back on track, you follow your new Xiongnu guides northeast, journeying into the mysterious Ferghana Valley."
  +" You pass a large town that Hadrianus identifies as Alexandria Eschate, or Alexandria Ultima as it is known in Rome, still displaying traces of the Greek character left by the settlers of Alexander the Great."
  +" You continue through the lands of the Dayuan, the local name for the Ferghana Valley given by the Ionian Greeks. Here, Hadrianus exchanges news with the locals about events from across the world."
  +" Your guides eventually lead you to the city of Shule, the gateway to the enigmatic Tarim Basin, which you must traverse to reach the mysterious realm of Seres."
  +"^^The journey stretches on for weeks, possibly even months. As you begin to lose track of time, you carve a primitive calendar into a wooden club, counting each day and night as they blur together."
  +" The passage of time feels slow, each day marked by the rhythm of travel and survival. Finally, after countless days, you reach the outskirts of a a fortress, guarded by soldiers."
  +" Your Xiongnu guides say, that this fortress is the Western part of a system of fortifications to protect what they call the Han Empire from raids from the North."
  +" If you want to pass into the Han lands, you have to ask the guards for permission to enter. The guards have already spotted you. You signal your intent to communicate, relying on your Xiongnu companions as translators to speak with them.",
  "none", [
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("text_scene",[
      (ge, "$cheat_mode", 1),
    ],"Test Scene.",[
      (jump_to_scene, "scn_jilu_fortress"),
      (change_screen_mission),
    ]),
    ("option_1",[],"Start negotations.",[
      (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 9),
      #1-15 player and companions
      #16 enemy commander
      #17 to 30 enemy troops
      (assign, "$temp1", "trp_chinese_commander"),
      (assign, "$temp2", "mnu_wlodowiecus_adventure_1_4_fight_1_die"),
      (assign, "$temp3", 1),
      (set_jump_mission, "mt_wlods_advantures_jilu_siege"),
      (modify_visitors_at_site, "scn_jilu_fortress"),
      (reset_visitors),
      #1,2,3,4 enemy archer positions
      #5,6,7,8 enemy spawns
      #10 player
      (set_visitor, 1, "trp_player"),
      #11 companion spawn
      (set_visitor, 2, "trp_wlodowiecus"),
      # (set_visitor, 11, "trp_alan_guide"),
      (set_visitor, 3, "trp_hadrianus"),
      (set_visitor, 4, "trp_mancinellus"),
      (set_visitor, 5, "trp_ali"),
      (set_visitor, 6, "trp_old_mercenary"),
      #12, 13,14,15 defenders reinforcements
      #16, 17, 18, 19, defender gathering points
      (set_visitors, 7, "trp_lombard_vetran", 5),
      (set_visitors, 8, "trp_alan_horse_archer", 10),
      (set_visitors, 9, "trp_gaetuli_horseman", 5),
      (set_visitors, 10, "trp_xingnu_barbarian", 10),
      (set_visitors, 11, "trp_xingnu_barbarian", 10),
      (set_visitors, 12, "trp_xingnu_barbarian", 10),
      (set_visitors, 13, "trp_xingnu_barbarian", 10),
      (set_visitors, 14, "trp_xingnu_barbarian", 10),
      (set_visitors, 15, "trp_xingnu_barbarian", 10),

      (set_visitor, 16, "trp_chinese_commander"),
      (set_visitors, 17, "trp_han_footman", 5),
      (set_visitors, 18, "trp_han_footman", 5),
      (set_visitors, 19, "trp_han_footman", 5),
      (set_visitors, 20, "trp_han_footman", 5),
      (set_visitors, 21, "trp_han_footman", 5),
      (set_visitors, 22, "trp_han_hallbard_man", 10),
      (set_visitors, 23, "trp_han_hallbard_man", 10),
      (set_visitors, 24, "trp_han_hallbard_man", 10),
      (set_visitors, 25, "trp_han_heavy_hallbard_man", 10),
      (set_visitors, 26, "trp_han_heavy_hallbard_man", 10),
      (set_visitors, 27, "trp_han_hallbard_man", 10),
      (set_visitors, 28, "trp_han_hallbard_man", 10),
      (set_visitors, 29, "trp_han_heavy_hallbard_man", 10),
      (set_visitors, 30, "trp_han_footman", 5),
      (jump_to_scene, "scn_jilu_fortress"),
      (change_screen_mission),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_end_1",mnf_scale_picture|mnf_enable_hot_keys,
  "{s25}^^You travel for a few weeks back through Tarim Basin and then the Ferghana Valley before turning southeast until you enter the city of Karsahr.",
  "none", [
    (try_begin),
      (quest_slot_eq, "qst_wlodowiecus_adventure_4", slot_quest_target_faction, 1),
      (set_background_mesh, "mesh_pic_looted_village"),
      (str_store_string, s25, "str_fortress_jilu_looted"),
      (troop_add_gold, "trp_player", 500),
    (else_try),
      (quest_slot_eq, "qst_wlodowiecus_adventure_4", slot_quest_target_faction, 2),
      (set_background_mesh, "mesh_pic_defeat"),
      (str_store_string, s25, "str_fortress_jilu_retreat"),
    (try_end),
    (add_xp_as_reward, 5000),
  ],[
    ("option_1",[],"Walk around Karsahr.",[
      #1 player
      #2-6 merchants
      #7 manci
      # 8-12 xiongnu, 13 berber, 14 winnili
      # 15 old mercenar, 16 ali
      # 17 hadrian, 18 wlodowiecus
      # 19 chinese merchant, 20 chinese whore
      #21-26 guards
      #27-42 town walkers
      (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 10),
      (assign, "$temp1", 10),
      (assign, "$temp2", -1),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_kashar"),
      (reset_visitors),
      (try_for_range, ":entry", 1, 43),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_saka_richmerchant"),
      (set_visitor, 3, "trp_saka_poormerchant"),
      (set_visitor, 4, "trp_merchant8"),
      (set_visitor, 5, "trp_merchant5"),
      (set_visitor, 6, "trp_merchant6"),
      (set_visitor, 7, "trp_mancinellus"),
      (set_visitor, 8, "trp_xingnu_barbarian"),
      (set_visitor, 9, "trp_xingnu_barbarian"),
      (set_visitor, 10, "trp_xingnu_barbarian"),
      (set_visitor, 11, "trp_xingnu_barbarian"),
      (set_visitor, 12, "trp_xingnu_barbarian"),
      (set_visitor, 13, "trp_gaetuli_horseman"),
      (set_visitor, 14, "trp_lombard_vetran"),
      (set_visitor, 15, "trp_old_mercenary"),
      (set_visitor, 16, "trp_ali"),
      (set_visitor, 17, "trp_hadrianus"),
      (set_visitor, 18, "trp_wlodowiecus"),
      (set_visitor, 19, "trp_xiao"),
      (set_visitor, 20, "trp_turakina"),
      (set_visitor, 21, "trp_saka_horse_archer"),
      (set_visitor, 22, "trp_saka_horse_archer"),
      (set_visitor, 23, "trp_saka_horse_archer"),
      (set_visitor, 24, "trp_saka_horse_archer"),
      (set_visitor, 25, "trp_saka_horse_archer"),
      (set_visitor, 26, "trp_saka_horse_archer"),
      (set_visitor, 27, "trp_judean_village_walker_female"),
      (set_visitor, 28, "trp_judean_village_walker_female"),
      (set_visitor, 29, "trp_judean_village_walker"),
      (set_visitors, 30, "trp_judean_village_walker", 2),
      (set_visitors, 31, "trp_judean_village_walker_female", 2),
      (set_visitors, 32, "trp_judean_village_walker", 2),
      (set_visitors, 33, "trp_judean_village_walker_female", 2),
      (set_visitors, 34, "trp_saka_man", 2),
      (set_visitors, 35, "trp_saka_woman", 2),
      (set_visitors, 36, "trp_saka_man", 2),
      (set_visitors, 37, "trp_saka_woman", 2),
      (set_visitors, 38, "trp_saka_man", 2),
      (set_visitors, 39, "trp_saka_woman", 2),
      (set_visitors, 40, "trp_saka_man", 2),
      (set_visitors, 41, "trp_saka_woman", 2),
      (set_visitors, 42, "trp_saka_man", 2),
      (jump_to_scene, "scn_kashar"),
      (change_screen_mission),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_end_2",mnf_scale_picture|mnf_enable_hot_keys,
  "Led by Lei Li, you and your group reunite with Phamanus, the Parthian caravan master from your journey to India."
  +" Phamanus greets you with genuine enthusiasm and agrees to guide you back to Alexandria. In return, he requests to accompany you when you meet with The Lybian,"
  +" as he has a personal proposal he believes will interest both of you."
  +"^^During the journey, you spend time conversing with Eamane and Lei Li. Eamaneshares her story, explaining how she came under Lei Li's care."
  +" You exchange tales of your homelands and adventures, and she listens with fascination. As you introduce her to the rest of the group, you primarily speak in Greek,"
  +" though you soon realize that both Lei Li and Eamanehave a solid understanding of Latin. Though they speak it hesitantly, they comprehend much more than they let on.",
  "none", [
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("option_1",[],"Continue.",[
      (call_script, "script_change_player_relation_with_troop", "trp_turakina", 100),
      (call_script, "script_recruit_troop_as_companion", "trp_turakina"),
      (troop_add_item, "trp_player", "itm_chinese_sword_rich", 0),
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_4_journey_end_3"),
    ]),
]),
("wlodowiecus_adventure_1_4_journey_end_3",mnf_scale_picture|mnf_enable_hot_keys,
  "After several weeks of uneventful yet exhausting travel, you finally arrive in Alexandria. The long journey, though tiring, passed without any significant incidents."
  +" Now, it's time to meet with The Lybian once more and deliver the long-awaited news about the expedition.",
  "none", [
    (set_background_mesh, "mesh_pic_alexandria"),
  ],[
    ("option_1",[],"Continue.",[
      (rest_for_hours, 72, 16, 0),
      (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 11),
      (party_relocate_near_party, "p_main_party", "p_town_20", 1),
      (jump_to_menu, "mnu_auto_return_map"),
      (str_store_party_name_link, s20, "p_town_20"),
      (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_4", 4, "@After several weeks of tiring travel, you finally reach {s20}. Now it's time to meet The Libyan again, bring him news about the expedition.", 0),
    ]),
]),

("wlodowiecus_adventure_1_phamanus",mnf_scale_picture,
  "You recieve a message from Phamanus. He informs you that his caravan business is now open.",
  "none", [
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("option_1",[],"Continue",[
      (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_object_faction, 2),
      (change_screen_map),
    ]),
]),

("wlodowiecus_adventure_1_4_intro",mnf_scale_picture,
  "While on your travels, you met a courier with a missive from Olivarius. After paying a coin to a young man for his job as a sign of gratitude, you thank him, take a note from him and read it."
  +"^The missive goes as follows:"
  +"^^To our friend {playername}, I hope to find you in good health. A lot of things changed since our last, unfortunate expedition to the northern lands of the Barbaricum."
  +" To be brief, the famous merchant magnate Caius Antonius Geta, also known by his cognomen Libycus or The Libyan, is organizing a grand convivium or private party, in his villa near Alexandria."
  +" He sent a missive to me inviting you and other members of Wlodowiecus' crew to this banquet. Apparently he has some expedition to the East in mind and since your fame as explorers grew beyond Rome, he seeks to employ you to do his one."
  +" I have to warn you though. The Libyan is a very powerful, wealthy and influential man. I strive for ties to him, to expand my own trade venues to Egypt and Africa in general."
  +" For that reason, I urge you to ensure that members of the company won't annoy the host and that he will get the impression of a rather professional host of explorers."
  +" For this reason, I urge you and Wlodowiecus to keep an eye on others, Mancilleus in particular, as we can't allow that meeting to go naught."
  +" Likewise, the expedition also has to succeed in its goals, whatever The Libyan wishes it to achieve."
  +"^^Sincerely,"
  +"^Olivarius",
  "none", [
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("option_1",[],"To Alexandria! New adventures await!",[
      (setup_quest_text,"qst_wlodowiecus_adventure_4"),
      (str_store_party_name, s22, "p_town_20"),
      (str_store_string, s2, "@You received a letter from Olivarius about another assignment for Wlodowiecus and his party. Apparently, a merchant magnate known as The Libyan wishes to see us at his villa in {s22}. You should hurry up to {s22} as soon as possible."),
      (call_script, "script_start_quest", "qst_wlodowiecus_adventure_4", "trp_fortuna"),
      (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 1),
      (change_screen_map),
    ]),
]),

("wlodowiecus_adventure_1_3_intro",mnf_scale_picture,
  "A young courier approached you this morning carrying a message for you. It's from Oliverius, the famous sculptor that sent you to India and funded an expedition to Africa."
  +" It's short and clearly written by a man in a bad mood:"
  +"^^'{playername}, please come to Mancinellus home as soon as possible.'",
  "none", [
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("option_1",[],"Continue.",[
      (setup_quest_text,"qst_wlodowiecus_adventure_3"),
      (str_store_party_name, s22, "p_town_6"),
      (str_store_string, s2, "@Travel to {s22} and talk with Mancinellus. He can be found in the backstreets."),
      (call_script, "script_start_quest", "qst_wlodowiecus_adventure_3", "trp_fortuna"),
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 1),
      (change_screen_map),
    ]),
]),

("wlodowiecus_adventure_1_2_intro",mnf_scale_picture,
  "A young courier approached you this morning carrying a message for you. It's from Mancinellus, the ex-soldier that you met in India while searching for Wlodowiecus and Hadrianus for Oliverus.^^"+
  " 'To the brave {playername}, I hope whatever gods you believe in are guarding you, my good friend! I wanted gather everyone from our last adventure in India, what an adventure that was! Come to my house in Roma, located near the entrance to the western-most wall, I might have found something you'll be interested in!'",
  "none", [
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("option_1",[],"Continue.",[
      (setup_quest_text,"qst_wlodowiecus_adventure_2"),

      (str_store_party_name, s22, "p_town_6"),
      (str_store_string, s2, "@Travel to {s22} and talk with Mancinellus. He can be found in the backstreets."),
      (call_script, "script_start_quest", "qst_wlodowiecus_adventure_2", "trp_fortuna"),
      (quest_set_slot, "qst_wlodowiecus_adventure_2", slot_quest_current_state, 1),
      (change_screen_map),
    ]),
]),

("wlodowiecus_adventure_1_4_lybicus_final",mnf_scale_picture,
  "The first thing you notice is that all traces of the fire have been meticulously repaired. Not a single mark of damage remains."
  +" You are greeted by attentive slaves, who present you with a finely woven toga and assist you in donning it."
  +" Once properly dressed, they inform you that a meal will be served in the villa's garden."
  +"^^Upon entering the garden, you find a lavish banquet laid out, the air fragrant with the scent of freshly prepared dishes."
  +" Pharmanus, the old mercenary, Ali, Hadrianus, Wlodowiecus, Lei Li, and Eamane are all gathered around the table, waiting for you to join them."
  +" After you take your seat, the meal begins—a feast accompanied by quiet conversation and the occasional clink of cups."
  +"^^As the meal comes to an end, the air grows quieter, and the anticipation for what comes next lingers in the garden's evening stillness. It is agreed to take a leisurely stroll through the garden.",
  "none", [
    (set_background_mesh, "mesh_pic_villa"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$temp1", 11),
      (assign, "$temp2", -1),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_lybian_villa"),
      (reset_visitors),
      (try_for_range, ":entry", 30, 45),
          (neq, ":entry", 30),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_everything),
          (mission_tpl_entry_clear_override_items, "mt_conversation_generic", ":entry"),
          (try_begin),
              (eq, ":entry", 38),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", ":entry", "itm_new_dress_3"),
          (else_try),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", ":entry", "itm_roman_toga"),
          (try_end),
          (mission_tpl_entry_add_override_item, "mt_conversation_generic", ":entry", "itm_female_caligea_gold"),
      (try_end),
      (set_visitor, 30, "trp_lybian"),
      (set_visitor, 31, "trp_player"),
      (set_visitor, 32, "trp_wlodowiecus"),
      (set_visitor, 33, "trp_mancinellus"),
      (set_visitor, 34, "trp_old_mercenary"),
      (set_visitor, 35, "trp_hadrianus"),
      (set_visitor, 36, "trp_ali"),
      (set_visitor, 37, "trp_phamanus"),
      (set_visitor, 38, "trp_turakina"),
      (set_visitor, 39, "trp_xiao"),
      (jump_to_scene, "scn_lybian_villa"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_4_end",mnf_scale_picture,
  "The evening concludes with wine and music, though it remains far more subdued than the last chaotic orgy with Biggus Dickus."
  +"^^With a sense of satisfaction, you leave The Libyan's villa, expressing your thanks for his hospitality."
  +" Hadrianus, Lei Li, and Phamanus set off for Rome, eager to establish their shops and organize the caravan guild."
  +" Meanwhile, you are left to pursue your own path, carrying with you a hefty reward—The Libyan's generous token of gratitude.",
  "none", [
    (set_background_mesh, "mesh_pic_villa"),
  ],[
    ("option_1",[],"Continue.",[
      (add_xp_as_reward, 10000),
      (troop_add_gold, "trp_player", 20000),
      (store_current_day, ":day"),
      (val_max, ":day", 1),
      (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_timer, ":day"),
      (quest_set_slot, "qst_wlodowiecus_adventure_4", slot_quest_current_state, 13),
      (call_script, "script_end_quest", "qst_wlodowiecus_adventure_4"),
      (jump_to_menu, "mnu_auto_return_map"),
      (rest_for_hours, 24, 16, 0),
    ]),
]),

("wlodowiecus_adventure_1_4_lybicus_feast",mnf_scale_picture,
  "As you step through the grand entrance of the villa you are given fine toga, which you are supposed to wear. Then you enter the garden and you are wonderstruck by the opulence of The Lybian's residence."
  +" Rich tapestries line the walls, and the air is filled with the scent of exotic spices. The chatter of influential guests fills the halls—merchants, scholars, and nobles alike."
  +" Hadrianus, ever poised, exchanges words with Wlodowiecus, whose stoic demeanor reveals little."
  +" Mancinellus gestures animatedly by a marble column, deep in debate with Old Briton, who listens with a knowing smirk."
  +" All eyes occasionally flicker toward The Lybian, the host of the evening, whose reputation precedes him.",
  "none", [
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("option_1",[],"Continue.",[
      # player
      # 1 lybian
      # 2 wlod
      # 3 manci
      # 4 old briton
      # 5 hadrian
      # 6 ali
      # 7- 20 other guests
      (assign, "$temp1", 7),
      (assign, "$temp2", "trp_lybian"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_lybian_villa"),
      (reset_visitors),
      (try_for_range, ":entry", 0, 8),
          (neq, ":entry", 1),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_everything),
          (mission_tpl_entry_clear_override_items, "mt_conversation_generic", ":entry"),
          (mission_tpl_entry_add_override_item, "mt_conversation_generic", ":entry", "itm_roman_toga"),
          (mission_tpl_entry_add_override_item, "mt_conversation_generic", ":entry", "itm_female_caligea_gold"),
      (try_end),
      (try_for_range, ":entry", 8, 21),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_horse|af_override_weapons|af_require_civilian),
      (try_end),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 1, "trp_lybian"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 3, "trp_mancinellus"),
      (set_visitor, 4, "trp_old_mercenary"),
      (set_visitor, 5, "trp_hadrianus"),
      (set_visitor, 6, "trp_ali"),
      (set_visitor, 7, "trp_olivarius"),
      (try_begin),
          (this_or_next|eq, "$praefectus_urbani", "trp_tigellinus"),
          (is_between, "$praefectus_urbani", active_npcs_begin,active_npcs_end),
          (set_visitor, 8, "$praefectus_urbani"),
      (try_end),
      (assign, ":entry", 0),
      (try_for_range, ":entry", 0, 5),
          (troop_set_slot, "trp_temp_troop", ":entry", -1),
      (try_end),
      (try_for_range, ":entry", 0, 5),
          (assign, ":score_to_beat", 9999),
          (try_for_range, ":lady", kingdom_ladies_begin, kingdom_ladies_end),
              (neq, ":lady", "trp_kingdom_7_lady_1"),
              (store_faction_of_troop, ":lady_fac", ":lady"),
              (faction_slot_eq, ":lady_fac", slot_faction_culture, "fac_culture_7"),
              (assign, ":break", 5),
              (try_for_range, ":slot", 0, ":break"),
                  (troop_slot_eq, "trp_temp_troop", ":slot", ":lady"),
                  (assign, ":break", -1),
              (try_end),
              (eq, ":break", 5),
              (neg|troop_slot_ge, ":lady", slot_troop_occupation, dplmc_slto_exile),
              (neg|troop_slot_eq, ":lady", slot_troop_spouse, "trp_player"),
              (neg|troop_slot_eq, ":lady", slot_troop_mother, "trp_player"),
              (neg|troop_slot_eq, ":lady", slot_troop_father, "trp_player"),
              (neg|troop_slot_eq, ":lady", slot_troop_lover, "trp_player"),
              (troop_get_slot, ":score", ":lady", slot_troop_age),
              (try_begin),
                  (troop_slot_eq, ":lady", slot_troop_met, 1),
                  (val_mul, ":score", 2),
              (try_end),
              (try_begin),
                  (troop_slot_eq, "$g_talk_troop", slot_lord_reputation_type, lrep_ambitious),
                  (val_mul, ":score", 2),
                  (val_div, ":score", 3),
              (else_try),
                  (troop_slot_eq, "$g_talk_troop", slot_lord_reputation_type, lrep_moralist),
                  (val_div, ":score", 4),
              (else_try),
                  (troop_slot_eq, "$g_talk_troop", slot_lord_reputation_type, lrep_adventurous),
                  (val_mul, ":score", 3),
                  (val_div, ":score", 2),
              (else_try),
                  (troop_slot_eq, "$g_talk_troop", slot_lord_reputation_type, lrep_otherworldly),
                  (val_mul, ":score", 3),
                  (val_div, ":score", 2),
              (try_end),
              (lt, ":score", ":score_to_beat"),
              (assign, ":score_to_beat", ":score"),
              (troop_set_slot, "trp_temp_troop", ":entry", ":lady"),
          (try_end),
          (troop_get_slot, ":lady", "trp_temp_troop", ":entry"),
          (gt, ":lady", -1),
          (try_begin),
              (eq, ":entry", 0),
              (set_visitor, 15, ":lady"),
          (else_try),
              (eq, ":entry", 1),
              (set_visitor, 10, ":lady"),
          (else_try),
              (eq, ":entry", 2),
              (set_visitor, 17, ":lady"),
          (else_try),
              (eq, ":entry", 3),
              (set_visitor, 12, ":lady"),
          (else_try),
              (eq, ":entry", 4),
              (set_visitor, 19, ":lady"),
          (try_end),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_statthalter_1", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 14, "trp_statthalter_1"),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_statthalter_11", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 9, "trp_statthalter_11"),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_senator_4", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 16, "trp_senator_4"),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_senator_6", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 11, "trp_senator_6"),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_senator_1", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 18, "trp_senator_1"),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_senator_2", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 13, "trp_senator_2"),#vitellius
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_statthalter_new_1", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 20, "trp_statthalter_new_1"),
      (try_end),
      (set_visitor, 21, "trp_diggus"),
      (set_visitor, 22, "trp_orgie_fem4"),
      (jump_to_scene, "scn_lybian_villa"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_4_lybicus_feast_2",mnf_scale_picture,
  "Servants glide through the crowd, offering golden, bejeweled cups brimming with rich, spiced wine. The air fills with the aroma of roasted meats, honeyed fruits,"
  +" and exotic spices as dishes are presented on gleaming silver platters. Plates shimmer under the warm glow of lanterns, piled high with delicacies—stuffed quails, figs drizzled with honey,"
  +" and fragrant cheeses. One by one, the guests indulge, their laughter growing louder and movements looser. Faces flush, and conversations grow more fervent as the intoxicating effects of the wine and"
  +" the decadent feast begin to take hold, drawing everyone into a haze of pleasure and indulgence.",
  "none", [
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("option_1",[],"Continue.",[
      # player
      # 1 lybian
      # 2 wlod
      # 3 manci
      # 4 old briton
      # 5 hadrian
      # 6 ali
      # 7- 20 other guests
      (assign, "$temp1", 8),
      (assign, "$temp2", "trp_lybian"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_lybian_villa"),
      (reset_visitors),
      (try_for_range, ":entry", 0, 8),
          (neq, ":entry", 1),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_everything),
          (mission_tpl_entry_clear_override_items, "mt_conversation_generic", ":entry"),
          (mission_tpl_entry_add_override_item, "mt_conversation_generic", ":entry", "itm_roman_toga"),
          (mission_tpl_entry_add_override_item, "mt_conversation_generic", ":entry", "itm_female_caligea_gold"),
      (try_end),
      (try_for_range, ":entry", 8, 21),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_horse|af_override_weapons|af_require_civilian),
      (try_end),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 1, "trp_lybian"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 3, "trp_mancinellus"),
      (set_visitor, 4, "trp_old_mercenary"),
      (set_visitor, 5, "trp_hadrianus"),
      (set_visitor, 6, "trp_ali"),
      (set_visitor, 7, "trp_olivarius"),
      (try_begin),
          (this_or_next|eq, "$praefectus_urbani", "trp_tigellinus"),
          (is_between, "$praefectus_urbani", active_npcs_begin,active_npcs_end),
          (set_visitor, 8, "$praefectus_urbani"),
      (try_end),
      (assign, ":entry", 0),
      (try_for_range, ":entry", 0, 5),
          (troop_set_slot, "trp_temp_troop", ":entry", -1),
      (try_end),
      (try_for_range, ":entry", 0, 5),
          (assign, ":score_to_beat", 9999),
          (try_for_range, ":lady", kingdom_ladies_begin, kingdom_ladies_end),
              (neq, ":lady", "trp_kingdom_7_lady_1"),
              (store_faction_of_troop, ":lady_fac", ":lady"),
              (faction_slot_eq, ":lady_fac", slot_faction_culture, "fac_culture_7"),
              (assign, ":break", 5),
              (try_for_range, ":slot", 0, ":break"),
                  (troop_slot_eq, "trp_temp_troop", ":slot", ":lady"),
                  (assign, ":break", -1),
              (try_end),
              (eq, ":break", 5),
              (neg|troop_slot_ge, ":lady", slot_troop_occupation, dplmc_slto_exile),
              (neg|troop_slot_eq, ":lady", slot_troop_spouse, "trp_player"),
              (neg|troop_slot_eq, ":lady", slot_troop_mother, "trp_player"),
              (neg|troop_slot_eq, ":lady", slot_troop_father, "trp_player"),
              (neg|troop_slot_eq, ":lady", slot_troop_lover, "trp_player"),
              (troop_get_slot, ":score", ":lady", slot_troop_age),
              (try_begin),
                  (troop_slot_eq, ":lady", slot_troop_met, 1),
                  (val_mul, ":score", 2),
              (try_end),
              (lt, ":score", ":score_to_beat"),
              (assign, ":score_to_beat", ":score"),
              (troop_set_slot, "trp_temp_troop", ":entry", ":lady"),
          (try_end),
          (troop_get_slot, ":lady", "trp_temp_troop", ":entry"),
          (gt, ":lady", -1),
          (try_begin),
              (eq, ":entry", 0),
              (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 15, af_override_everything),
              (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 15),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", 15, "itm_female_caligea_gold"),
              (store_random_in_range, ":dress", "itm_new_dress_1","itm_german_femal_rich_1"),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", 15, ":dress"),
              (set_visitor, 15, ":lady"),
          (else_try),
              (eq, ":entry", 1),
              (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 10, af_override_everything),
              (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 10),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", 10, "itm_female_caligea_gold"),
              (store_random_in_range, ":dress", "itm_new_dress_1","itm_german_femal_rich_1"),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", 10, ":dress"),
              (set_visitor, 10, ":lady"),
          (else_try),
              (eq, ":entry", 2),
              (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 17, af_override_everything),
              (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 17),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", 17, "itm_female_caligea_gold"),
              (store_random_in_range, ":dress", "itm_new_dress_1","itm_german_femal_rich_1"),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", 17, ":dress"),
              (set_visitor, 17, ":lady"),
          (else_try),
              (eq, ":entry", 3),
              (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 12, af_override_everything),
              (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 12),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", 12, "itm_female_caligea_gold"),
              (store_random_in_range, ":dress", "itm_new_dress_1","itm_german_femal_rich_1"),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", 12, ":dress"),
              (set_visitor, 12, ":lady"),
          (else_try),
              (eq, ":entry", 4),
              (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 19, af_override_everything),
              (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 19),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", 19, "itm_female_caligea_gold"),
              (store_random_in_range, ":dress", "itm_new_dress_1","itm_german_femal_rich_1"),
              (mission_tpl_entry_add_override_item, "mt_conversation_generic", 19, ":dress"),
              (set_visitor, 19, ":lady"),
          (try_end),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_statthalter_1", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 14, "trp_statthalter_1"),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_statthalter_11", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 9, "trp_statthalter_11"),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_senator_4", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 16, "trp_senator_4"),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_senator_6", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 11, "trp_senator_6"),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_senator_1", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 18, "trp_senator_1"),
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_senator_2", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 13, "trp_senator_2"),#vitellius
      (try_end),
      (try_begin),
          (neg|troop_slot_ge, "trp_statthalter_new_1", slot_troop_occupation, dplmc_slto_exile),
          (set_visitor, 20, "trp_statthalter_new_1"),
      (try_end),
      (set_visitor, 21, "trp_diggus"),
      (set_visitor, 22, "trp_orgie_fem4"),
      (jump_to_scene, "scn_lybian_villa"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_4_lybicus_feast_lady",mnf_scale_picture,
  "You run with her, as fast as you can, leaving behind the guests and the noise. Away from Hadrianus, who's still desperately avoiding Incontinentia."
  +" Away from The Lybian, caught in conversation with an overly drunken Mancinellus. She whispers, 'Love is a fragile little flame, it could burn out."
  +" But I know places where they won't find us.' You follow her through the bustling streets of Alexandria, her hand firmly in yours as she weaves through the crowd, making you both disappear in the sea of faces."
  +"^^Finally, you arrive at a secluded garden, with a statue of Alexander the Great at its center. Her cheeks are flushed as she says, 'This garden is rarely visited. Let's nurture this fragile flame of love."
  +" Even if the flowers we grow soon wither, they will forever live in our memories.'^^Under the watchful gaze of Alexander, you come together."
  +" For a moment, time stands still, and the world fades into a timeless eternity.",
  "none", [
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[
    ("option_1",[],"Continue.",[
      (add_xp_as_reward, 1500),
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_4_lybicus_feast_end_2"),
    ]),
]),

("wlodowiecus_adventure_1_3_intro_end",mnf_scale_picture,
  "You accompany Wlodowiecus through the streets of Rome down to a popina where his Winnili contacts were last seen. The popina is filthy and full of mostly foreigners and non-Roman citizens, non-zealous Jews, Germans, Celts and even Aethiopians."
  +" It doesn't take long for your friend to find his contacts, and you let him handle the negotiations, by the end of the talk, you were sharing some wine with these rowdy Scandians.",
  "none", [
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("wlodowiecus_adventure_1_3_visit_manc",mnf_scale_picture,
  "As you walked through the impoverished areas of Rome, you could hear the loud shouting from both Oliverius and Mancinellus."
  +" Suddenly you hear Oliverius scream right as you were approaching Mancinellus' house. As you were about to knock on the door, Furaha, the current wife of Mancinellus, opened the door revealing her bloodied fist."
  +" 'My lovely and stupid husband is inside. Tell that moustachioed Roman to never touch him again.' When you enter the home, you see Oliverius holding his nose, Mancinellus holding his jaw and Wlodowiecus laughing hysterically."
  +" All while Hadrianus, Varus and the Old Mercenary watch the scene in utter confusion.",
  "none", [
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$temp1", 1),
      (assign, "$temp2", "trp_olivarius"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_manc_house"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_weapons|af_override_horse),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 2, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 2),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_subarmalis_1"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 4, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 4),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_roman_poor7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 5, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 5),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_roman_poor6"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 6, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 6),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",6, "itm_roman_poor5"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",6, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 7, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 7),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_celtic_light7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_caligea"),

      (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_conversation_generic", 1, 0),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_outfit_1 | af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 3, "trp_olivarius"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      (set_visitor, 6, "trp_varus"),
      (set_visitor, 7, "trp_old_mercenary"),
      (jump_to_scene, "scn_manc_house"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_2_visit_manc",mnf_scale_picture,
  "Mancinellus' home looks old and rundown; however, it looks better than the other houses surrounding it. Right as you were about to knock on the main door, it opens revealing a rather pretty but fierce looking woman with dark skin. It must be Fuhara, his new wife.^'My lovely and useless husband is inside. Please, get comfortable.' She says before walking away from the house. The inside of the house doesn't look as bad as the outside; still, it's clear that Mancinellus and his wife don't earn a lot of money. Mancinellus and five other men were sitting around a round table and when he notices you, he welcomes you with a friendly smile and a hug.",
  "none", [
    (set_background_mesh, "mesh_pic_roma"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$temp1", 1),
      (assign, "$temp2", "trp_mancinellus"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_manc_house"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_weapons|af_override_horse),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 2, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 2),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_subarmalis_1"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 4, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 4),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_roman_poor7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 5, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 5),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_roman_poor6"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 6, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 6),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",6, "itm_roman_poor5"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",6, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 7, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 7),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_celtic_light7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_caligea"),

      (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_conversation_generic", 1, 0),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_outfit_1 | af_override_horse),
      (try_end),

      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 3, "trp_olivarius"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      (set_visitor, 6, "trp_varus"),
      (set_visitor, 7, "trp_old_mercenary"),
      (jump_to_scene, "scn_manc_house"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_start_1",mnf_scale_picture,
  "The adventurers have setup their camp near Carnuntum. You are welcomed by everone. Do you want to start the journey?",
  "none", [
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("option_1",[],"Yes. Let us go.",[
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 3),
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_start"),
    ]),

    ("option_1",[],"I am not ready yet.",[
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("wlodowiecus_adventure_1_3_start",mnf_scale_picture,
  "You reached the Danube, the border between civilized Roman lands and the wild Germanic forests, Wlodowiecus was the first man to cross it, and led the rest of the party north.",
  "none", [
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("option_1",[(ge, "$cheat_mode", 1)],"Test scene.",[
      (jump_to_scene, "scn_scene_camp_forest"),
      (change_screen_mission),
    ]),

    ("option_1",[],"Continue.",[
      (add_xp_as_reward, 2000),

      (assign, "$g_next_menu", "mnu_wlodowiecus_adventure_1_3_raid_1"),
      (assign, "$tutorial_state", 0),
      (assign, "$temp3", 1),
      (set_jump_mission, "mt_desert_cutscene"),
      (modify_visitors_at_site, "scn_scene_camp_forest"),
      (reset_visitors),

      (set_visitor, 1, "trp_player"),
      (troop_set_slot, "trp_temp_array_a", 1, "trp_mancinellus"),
      (troop_set_slot, "trp_temp_array_a", 2, "trp_wlodowiecus"),
      (troop_set_slot, "trp_temp_array_a", 3, "trp_hadrianus"),
      (troop_set_slot, "trp_temp_array_a", 4, "trp_old_mercenary"),
      (troop_set_slot, "trp_temp_array_a", 5, "trp_varus"),
      (troop_set_slot, "trp_temp_array_a", 6, "trp_lombard_vetran"),

      (try_begin),
          (eq,"$character_gender", tf_female),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_female),
      (else_try),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_male),
      (try_end),
      (str_store_troop_face_keys, s1, "trp_player"),
      (troop_set_face_keys, "trp_multiplayer_profile_troop_male", s1),
      (call_script, "script_dplmc_copy_inventory", "trp_player", "trp_multiplayer_profile_troop_male"),

      (troop_set_slot, "trp_temp_array_a", 7, "trp_multiplayer_profile_troop_male"),

      # have them walking
      (troop_set_inventory_slot, "trp_wlodowiecus", ek_horse, -1),
      (troop_set_inventory_slot, "trp_hadrianus",  ek_horse, -1),
      (troop_set_inventory_slot, "trp_mancinellus",  ek_horse, -1),
      (troop_set_inventory_slot, "trp_varus",  ek_horse, -1),
      (troop_set_inventory_slot, "trp_old_mercenary",  ek_horse, -1),
      (troop_set_inventory_slot, "trp_multiplayer_profile_troop_male",  ek_horse, -1),

      (jump_to_scene, "scn_scene_camp_forest"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_raid_1",mnf_scale_picture,
  "The journey north through Roman territory is uneventful, the only trouble you experienced was crossing the alps, it was an exhausting trek, but once you were through the lands of the Cotti, the rest of the journey was through plains and forest."
  +" Eventually you reached the Rhine, the border between civilized Roman lands and the wild Germanic forests, Wlodowiecus was the first man to cross it, and led the rest of the party north."
  +" As the party is moving northward, they feel rustling through the trees and then hear shouting from the woods, men howling and growling like beasts, until a man shouts something in Germanic."
  +"^^Harigasti teiva! Tawol apodu ek erilaz owlpupewaz niwajemariz Sawilagaz haite'ka Harja!^^"
  +"You make a signal for everyone to prepare for battle. You are ambushed by a warband of Germanic fanatics.",
  "none", [
    (set_background_mesh, "mesh_pic_mb_warrior_1"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$temp3", 1),
      (assign, "$temp1", "mnu_wlodowiecus_adventure_1_3_continue_1"),
      (assign, "$temp2", "mnu_wlodowiecus_adventure_1_3_raid_1_died"),

      (set_jump_mission, "mt_wlods_advantures_fight"),
      (modify_visitors_at_site, "scn_random_scene_plain_forest_custom_12"),
      (reset_visitors),

      (set_visitor, 1, "trp_player"),
      (set_visitors, 1, "trp_lombard_vetran", 40),

      (set_visitor, 1, "trp_wlodowiecus"),
      (set_visitor, 1, "trp_hadrianus"),
      (set_visitor, 1, "trp_mancinellus"),
      (set_visitor, 1, "trp_varus"),
      (set_visitor, 1, "trp_old_mercenary"),

      (set_visitors, 4, "trp_germanic_berserker", 10),
      (set_visitors, 4, "trp_germanic_light_spearman", 20),
      (set_visitors, 4, "trp_germanic_light_clubman", 20),
      (jump_to_scene, "scn_random_scene_plain_forest_custom_12"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_4_lybicus_feast_end_1",mnf_scale_picture,
  "The lechery of the party guests was kept hidden until it erupted into an orgy of ignominy, when, with all shame and fear removed by Bacchus sweat wine, they simply followed their own inclinations."
  +"^^It seems that a woman named Incontinentia Buttocks was caught in a passionate embrace with you on a sofa. Meanwhile, a man called Biggus Dickus rallied the other guests, and they left The Lybian's villa,"
  +" parading through the streets of Alexandria while carrying the sofa - with you and Incontinentia still upon it - like a trophy. Leading the chaotic procession were a nude, drunken Hispanic and a nude,"
  +" drunken Germanic man.^^The spectacle drew the attention of the townspeople, and the crowd swelled, turning the streets into a scene reminiscent of a wild Bacchanal. Suddenly, an elderly, nude Celt appeared,"
  +" riding a lion - an animal said to belong to The Lybian. The lion knocked over several braziers, igniting the villa and triggering mass panic. Amidst the chaos, you and Incontinentia remained undisturbed,"
  +" lost in each other's embrace, as the vigiles frantically tried to capture the lion, quell the rioters, and put out the spreading fire.",
  "none", [
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_auto_return_map"),
      (add_xp_as_reward, 3000),
      (rest_for_hours, 24, 16, 0),
    ]),
]),

("wlodowiecus_adventure_1_4_lybicus_feast_end_2",mnf_scale_picture,
  "It's all over too soon. She departs swiftly, giving you one last kiss and whispering: 'Don't forget your promise. Remember me, at least in your wildest dreams!'"
  +"^^As you make your way back to The Lybian's villa, the scent of smoke fills the air, and the distant sound of shouting grows louder. You soon see the cause: a fire has broken out at the villa."
  +" People are running wildly, looting nearby shops and homes. It's complete chaos - a full-scale riot. Feeling the effects of the wine, you decide it's best to retreat to your tavern, safely located in a different quarter, unaffected by the turmoil."
  +"^^The next day, the innkeeper recounts the cause of the riot. It seems that a woman named Incontinentia Buttocks was caught in a passionate embrace with a man dressed in Ancient Greek fashion on a sofa."
  +" Meanwhile, a man called Biggus Dickus rallied other guests, and they left The Lybian's villa, parading through the streets of Alexandria while carrying the sofa, with the lovers on it, like a trophy. Leading the chaotic procession were a nude, drunken Hispanic and a nude, drunken Germanic man."
  +"^^The spectacle drew the attention of the townspeople, and the crowd grew, resembling a wild Bacchanal. Suddenly, an elderly, nude Celt appeared riding a lion - an animal said to belong to The Lybian."
  +" The lion knocked over several braziers, setting the villa ablaze and sparking mass panic. Amidst the chaos, the lovers on the sofa remained undisturbed, continuing their affair as the vigiles struggled to capture the lion, control the rioters, and extinguish the flames.",
  "none", [
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_auto_return_map"),
      (add_xp_as_reward, 1500),
      (rest_for_hours, 24, 16, 0),
    ]),
]),

("wlodowiecus_adventure_1_3_continue_1",mnf_scale_picture,
  "After the last of the enemy are dead, your companions start to loot the corpses. Varus is spitting on a dead German zealot, muttering something under his breath."
  +" Hadrian is sitting silently on the ground with his eyes closed while making a prayer, the rest are busy looking around the battlefield."
  +" When you asked Wlodowiecus what were these zealots shouting, he smiles and says: 'They wanted to sacrifice us to Tiwaz, guess we sacrificed them instead!'",
  "none", [
    (set_background_mesh, "mesh_pic_victory"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_continue_2"),
    ]),
]),

("wlodowiecus_adventure_1_3_continue_2",mnf_scale_picture,
  "When you and the rest of the company arrive to Kalissa, Hadrianus leads the party to the tavern. He orders food, drink and then you all rest for a day. While you were sleeping, Wlodowiecus heads out to buy some supplies. You and your friends all decide to have a briefing the next morning.",
  "none", [
    (set_background_mesh, "mesh_pic_townsnow"),
  ],[
    ("option_1",[],"Continue.",[

      (display_message, "str_quest_updated"),
      (str_store_party_name_link, s33, "p_castle_12"),
      (str_store_party_name_link, s34, "p_town_49"),
      (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_3", 3, "@Your party travelled from {s33} and finally reached {s34}.", 0),
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 4),

      (assign, "$temp1", 1),
      (assign, "$temp2", "trp_hadrianus"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_castle_germanic_sea_1_in"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_weapons|af_override_horse),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 2, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 2),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_subarmalis_1"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 4, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 4),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_roman_poor7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 5, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 5),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_roman_poor6"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 6, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 6),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",6, "itm_roman_poor5"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",6, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 7, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 7),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_celtic_light7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_caligea"),

      (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_conversation_generic", 1, 0),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_outfit_1 | af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      (set_visitor, 6, "trp_varus"),
      (set_visitor, 7, "trp_old_mercenary"),
      (jump_to_scene, "scn_castle_germanic_sea_1_in"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_continue_3",mnf_scale_picture,
  "After a day of travel, the party reaches the village. It is structured like a typical Germanic village: one could see some small farmland and a wooden palisade surrounds the village."
  +" The homes are long thatched-roof huts. The families live in one end and the animals lived in the other end in stalls. They enter the village and meet Hadrianus cousin. He welcomes everyone and they enter his house.",
  "none", [
    (set_background_mesh, "mesh_pic_townsnow"),
  ],[
    ("option_1",[],"Continue.",[

      (display_message, "str_quest_updated"),
      (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_3", 4, "@Your party reached the village were Hadrianus' cousin Alwisus lives.", 0),
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 5),

      (assign, "$temp1", 1),
      (assign, "$temp2", "trp_alwisus"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_castle_germanic_sea_1_in"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_weapons|af_override_horse),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 2, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 2),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_subarmalis_1"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 4, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 4),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_roman_poor7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 5, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 5),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_roman_poor6"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 6, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 6),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",6, "itm_roman_poor5"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",6, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 7, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 7),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_celtic_light7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_caligea"),

      (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_conversation_generic", 1, 0),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_outfit_1 | af_override_horse),
      (try_end),

      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      (set_visitor, 6, "trp_varus"),
      (set_visitor, 7, "trp_old_mercenary"),
      (set_visitor, 8, "trp_alwisus"),
      (jump_to_scene, "scn_castle_germanic_sea_1_in"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_continue_4",mnf_scale_picture,
  "After bidding farewell to Hadrianus' cousin, you and your companions leave Alwisus' village and continue your trek towards the land of the Balthae. Truth be told, you only heard mythical tales about those distant lands, where monsters roam the swamps and forests, hopefully they are just tales told to scare children.",
  "none", [
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_continue_5"),
    ]),
]),

("wlodowiecus_adventure_1_3_continue_5",mnf_scale_picture,
  "You and the rest of the company decide to camp for the night, it felt that regardless of the current season, this region was unreasonably cold, as if the wild gods of nature were making your travel harder. You and Mancinellus scavenge some kindling for the fires while the rest set up the camp.",
  "none", [
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$temp1", 1),
      (assign, "$temp2", "trp_mancinellus"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_scene_camp_forest"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_weapons|af_override_horse),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 2, af_override_weapons|af_override_horse),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 4, af_override_weapons|af_override_horse),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 5, af_override_weapons|af_override_horse),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 6, af_override_weapons|af_override_horse),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 7, af_override_weapons|af_override_horse),

      (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_conversation_generic", 1, 0),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_outfit_1 | af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      (set_visitor, 6, "trp_varus"),
      (set_visitor, 7, "trp_old_mercenary"),
      (jump_to_scene, "scn_scene_camp_forest"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_raid_2",mnf_scale_picture,
  "Suddenly, eerie war cries can be heard in the distance, the company steels themselves as they're attacked by Germanic tribesmen.",
  "none", [
    (set_background_mesh, "mesh_pic_mb_warrior_1"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$temp3", 2),
      (assign, "$temp1", "mnu_wlodowiecus_adventure_1_3_continue_6"),
      (assign, "$temp2", "mnu_wlodowiecus_adventure_1_3_raid_1_died"),

      (set_jump_mission, "mt_wlods_advantures_fight"),
      (modify_visitors_at_site, "scn_random_scene_plain_forest_custom_13"),
      (reset_visitors),

      (set_visitor, 1, "trp_player"),
      (set_visitors, 1, "trp_lombard_vetran", 40),

      (set_visitor, 1, "trp_wlodowiecus"),
      (set_visitor, 1, "trp_hadrianus"),
      (set_visitor, 1, "trp_mancinellus"),
      (set_visitor, 1, "trp_varus"),
      (set_visitor, 1, "trp_old_mercenary"),

      (set_visitors, 4, "trp_germanic_berserker", 5),
      (set_visitors, 4, "trp_germanic_nightwarrior", 45),
      (jump_to_scene, "scn_random_scene_plain_forest_custom_13"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_continue_6",mnf_scale_picture,
  "The battle ends with Wlodowiecus stabbing the last Harii warrior. You let out a war cry fueled by rage and anger, Mancinellus looks around disoriented and confused, his blade and armor coated in blood, Hadrianus is walking around, looking in horror as a Winnili warrior is screaming as he's trying to contain his spilling guts, the old mercenary is looking around for other ambushers."
  +" Suddenly, Wlodowiceus shouts and everyone comes over. On top of the chief of the marauding Harii warriors, Varus lies, as Mancinellus slowly flips him over, he discovers that he's dead."
  +" Everyone is looking in silence.",
  "none", [
    (set_background_mesh, "mesh_pic_victory"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_continue_7"),
    ]),
]),

("wlodowiecus_adventure_1_3_continue_7",mnf_scale_picture,
  "The party take their time preparing the dead and mourning. The Winnili burn their dead in a separate ceremony while you and your friends prepare a proper Roman funeral for Varus."
  +" He is washed and then placed on a funeral pyre. His sword is placed on his chest with both hands holding it. Then Mancinellus places a coin into Varus mouth, so he could pass on to the afterlife."
  +" Hadrianus then lights the funeral pyre after he and Mancinellus recite a few ritualistic words, which are customary to be recited for deceased soldiers."
  +" Mancinellus then prays to Mars and Mercury, while Hadrianus, standing beside him prays to his one God in the Christian way. Varus is cremated and the party slowly march north in silence.",
  "none", [
    (set_background_mesh, "mesh_pic_wounded"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_continue_8"),
    ]),
]),

("wlodowiecus_adventure_1_3_continue_8",mnf_scale_picture,
  "The marching resumes, mostly in silence at first. The death of Varus has still shaken the party. He was a survivor of many battles, and yet one ambush took him out as well as several Winnili mercenaries who accompanied them."
  +" The men burn another who collapsed from malnutrition and exhaustion. After a while, Mancinellus and you start making japes and telling stories to pass the time and lift the men's spirits."
  +" The party then arrives at a frozen lake. Hadrianus, who usually is calm and stoic, curses their luck. They will now have to either circumvent the lake or cross it without the ice breaking under them."
  +" He seems to be suffering from the cold, as does Wlodowiecus.^^Just as things seem hopeless, they spot a couple of hunters who take them to the settlement inhabited by the Sciri tribe."
  +" The men huddle near the hearth of the main hall and are offered warm mushroom soup which they greedily and quickly consume. Furs are wrapped around their shoulders and backs."
  +" A few hours pass, and the door to the main hall is opened. The chief of the Sciri alongside his sons and bodyguards arrive, welcoming the men and asking what brought them here.",
  "none", [
    (set_background_mesh, "mesh_pic_castlesnow"),
  ],[
    ("option_1",[],"Continue.",[
      (display_message, "str_quest_updated"),
      (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_3", 5, "@Your party reached the village of the Sciri.", 0),
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 6),

      (assign, "$temp1", 5),
      (assign, "$temp2", -1),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_baltic_town"),
      (reset_visitors),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      # (set_visitor, 6, "trp_varus"), # dead now

      (set_visitor, 7, "trp_old_mercenary"),

      (set_visitor, 8, "trp_hludwig"),
      (set_visitor, 9, "trp_ekkebert"),
      (set_visitor, 10, "trp_egino"),
      (set_visitor, 11, "trp_mathildiz"),

      (try_for_range, ":entry", 12, 25),
          (set_visitor, ":entry", "trp_baltic_hunter"),
      (try_end),
      (jump_to_scene, "scn_baltic_town"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_sciri_1",mnf_scale_picture,
  "The feast takes place in and around the main hall. Hludwig and Wlodowiecus are drinking together, you and Ekkebert are engaged in a game of arm wrestling, and the beautiful daughter of Hludwig who personally serves mead and meat to you introduces herself as Mahtildiz."
  +" She tells you that she has been promised to someone she does not want to marry and is searching a way out. During the conversation she comes closer and closer to you, until you can feel her warm breath and body on yours."
  +" However, Hludwig notices before she can kiss you and orders her to go somewhere else. He instructs someone to keep an eye on her.^^Hadrianus, who is usually quiet, seem to enjoy himself drinking and making a bet with a Sciri warrior."
  +" Uncharacteristically of him, it also becomes apparent that he has eyes for a serving woman, and he goes away for a while. Mancinellus also disappears for a while."
  +"^^Everyone is drunk except for a few, as the hours pass however, a servant quickly beckons you to come. As you do, you notice Mancinellus is standing behind one of the huts, a huge grin across his face with a beautiful dagger with amber decorating its pommel.",
  "none", [
    (set_background_mesh, "mesh_pic_castlesnow"),
  ],[
    ("option_1",[],"Continue.",[
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 7),
      (assign, "$temp1", 1),
      (assign, "$temp2", "trp_mancinellus"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_baltic_town"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 8, af_override_weapons|af_override_horse),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 5, af_override_weapons|af_override_horse),
      (set_visitor, 8, "trp_player"),
      (set_visitor, 5, "trp_mancinellus"),
      (jump_to_scene, "scn_baltic_town"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_sciri_no_sex",mnf_scale_picture,
  "You tell Mancinellus that this is dangerous. You beg him to stop this and return the dagger. While he seems a bit reluctant, your friend agrees and promises you that he will return the dagger and tell Mahtildiz to stop pestering you.",
  "none", [
    (set_background_mesh, "mesh_pic_castlesnow"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_sciri_2"),
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 8),
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_temp_slot, -1), # daughter choice
    ]),
]),

("wlodowiecus_adventure_1_3_sciri_sex",mnf_scale_picture,
  "You tells Mancinellus that he is a crazy bastard, but that he is a good friend. You then enter the hut behind Mancinellus and see the beautiful Mahtildiz standing in front of a fireplace, she was only wearing a fur, upon seeing you, she takes it off revealing her curvaceous form."
  +" You are amazed by her beauty, and kiss her tenderly. The two of you make sweet love all night and sleep in each others arms.",
  "none", [
    (set_background_mesh, "mesh_pic_hexe_party"),
  ],[
    ("option_1",[],"Continue.",[
      (add_xp_as_reward, 5000),
      (call_script, "script_change_player_relation_with_troop", "trp_mathildiz", 10),
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_sciri_2"),
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 8),
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_temp_slot, 1), # daughter choice
    ]),
]),

("wlodowiecus_adventure_1_3_sciri_2",mnf_scale_picture,
  "After many hours, you open your eyes after hearing many footsteps and people speaking loudly, you quickly get up when the door is kicked open and several Sciri warriors rush inside, while you try to fight back, you are overwhelmed rather quickly."
  +" You are then repeatedly punched and eventually dragged outside in the cold. There are a few corpses on the ground near the center of the settlement, warriors are lining up, the men and women scream insults at you as you are dragged towards the middle,"
  +" there are several Sciri warriors standing in a circle, as they parts away, they reveal your companions bounded in the center of the circle."
  +" Mancinellus is among them, beaten and bruised. Hadrianus looks miserable and several of the Winnili mercenaries look like they've wounded, but Wlodowiecus and the Old Mercenary are not among those captured."
  +" Could it be that one of the corpses at the outskirts of the settlement belong to them? You then remember Varus and fear for you and your companions.",
  "none", [
    (set_background_mesh, "mesh_pic_castlesnow"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_sciri_3"),
    ]),
]),

("wlodowiecus_adventure_1_3_sciri_3",mnf_scale_picture,
  "Hludwig and his son Ekkebert looks down upon you, Ekkebert's face displaying rage while his father displays both anger and sadness. The chieftain closes his eyes, draws a breath, before opening them again and directing his speech to the bound men, who are sitting down.",
  "none", [
    (set_background_mesh, "mesh_pic_castlesnow"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$temp1", 1),
      (assign, "$temp2", "trp_hludwig"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_baltic_town"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 3, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 3),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",3, "itm_roman_poor6"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",3, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 4, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 4),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_roman_poor7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 5, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 5),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_roman_poor6"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_caligea"),

      (set_visitor, 3, "trp_player"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),

      (set_visitor, 8, "trp_hludwig"),
      (set_visitor, 9, "trp_ekkebert"),

      (try_for_range, ":entry", 10, 25),
          (set_visitor, ":entry", "trp_baltic_hunter"),
      (try_end),

      (jump_to_scene, "scn_baltic_town"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_sciri_4",mnf_scale_picture,
  "Hludwig leaves, his Sciri warriors seem to spread around the settlement, but some of them remain nearby to watch over you, alongside Ekkebert."
  +" Your muscles start to ache due to the cold and you look around to see your friends are all in horrible condition. Soon you'll die, may the gods give you strength."
  +" Due to your exhaustion, sleep overtakes you and you close your eyes...",
  "none", [
    (set_background_mesh, "mesh_pic_prisoner_man"),
  ],[
    ("option_1",[],"Continue.",[
      (jump_to_menu, "mnu_wlodowiecus_adventure_1_3_sciri_final_battle"),
    ]),
]),

("wlodowiecus_adventure_1_3_sciri_final_battle",mnf_scale_picture,
  "Hours later you dream of battle, the noise however is becoming intense, it feels real, and you smell blood. You feel warmth and suddenly you open your eyes in terror to witness:"
  +"^Winnili warriors, led by Wlodowiecus, the Old Mercenary and the son of Hludwig, Egino, alongside some Sciri who seem to be on your side are fighting against Hludwigs scattered men, a hut is burning, and you hear Mathildiz screaming for help."
  +" Hadrianus seems to have been cut loose, he grabs a knife and quickly cuts off the ropes which bind you. Mancinellus and the others quickly grab weapons, and you do the same."
  +" A Sciri warrior spots you and points his spear towards you.^^The battle for survival has begun. ",
  "none", [
    (set_background_mesh, "mesh_pic_mb_warrior_1"),
  ],[
    ("option_1",[],"Continue.",[
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 9),

      (assign, "$temp1", "mnu_wlodowiecus_adventure_1_3_sciri_end"),
      (assign, "$temp2", "mnu_wlodowiecus_adventure_1_3_raid_1_died"),

      (set_jump_mission, "mt_wlods_advantures_3_sciri_battle"),
      (modify_visitors_at_site, "scn_baltic_town"),
      (reset_visitors),

      (set_visitor, 41, "trp_mancinellus"),
      (set_visitor, 42, "trp_hadrianus"),
      (mission_tpl_entry_set_override_flags, "mt_wlods_advantures_3_sciri_battle", 43, af_override_horse),
      (set_visitor, 43, "trp_player"),
      (set_visitors, 44, "trp_lombard_vetran", 1),
      (set_visitor, 26, "trp_wlodowiecus"),
      (set_visitor, 27, "trp_old_mercenary"),
      (set_visitor, 28, "trp_egino"),

      (set_visitor, 8, "trp_hludwig"),
      (set_visitor, 9, "trp_ekkebert"),

      (try_for_range, ":entry", 1, 25),
          (set_visitors, ":entry", "trp_baltic_hunter", 1),
      (try_end),

      (try_for_range, ":entry", 20, 25),
          (set_visitors, ":entry", "trp_baltic_hunter", 3),
      (try_end),

      (try_for_range, ":entry", 25, 40),
          (set_visitors, ":entry", "trp_baltic_hunter", 2),
          (set_visitors, ":entry", "trp_lombard_vetran", 1),
      (try_end),

      (jump_to_scene, "scn_baltic_town"),
      (change_screen_mission),

    ]),
]),

("wlodowiecus_adventure_1_3_sciri_end",mnf_scale_picture,
  "You defeated the enemies.^^{s20} Hludwig has not survived the battle. His son Ekkebert was captured alive.",
  "none", [
    (set_background_mesh, "mesh_pic_victory"),
    (str_store_string, s20, "@Mathildiz is dead. She was imprisoned in the house of Hludwig. It catched fire and she burned alive."),
    (try_begin),
        (quest_slot_eq, "qst_wlodowiecus_adventure_3", slot_quest_object_center, 1),
        (str_store_string, s20, "@Mathildiz is alive. She was imprisoned in the house of Hludwig. It catched fire, but you managed to rescue."),
    (try_end),
  ],[
    ("option_1",[],"Continue.",[
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 10),

      (assign, "$temp1", 2),
      (assign, "$temp2", "trp_wlodowiecus"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_baltic_town"),
      (reset_visitors),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      (set_visitor, 7, "trp_old_mercenary"),

      (set_visitor, 8, "trp_player"),
      (set_visitor, 9, "trp_ekkebert"),
      (set_visitor, 10, "trp_egino"),
      (try_begin),
          (quest_slot_eq, "qst_wlodowiecus_adventure_3", slot_quest_object_center, 1),
          (set_visitor, 11, "trp_mathildiz"),
      (try_end),
      (try_for_range, ":entry", 12, 25),
          (set_visitor, ":entry", "trp_lombard_vetran"),
      (try_end),
      (jump_to_scene, "scn_baltic_town"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_sciri_final_loot",mnf_scale_picture,
  "Hadrianus and Mancinellus watch in horror as you, Wlodowiecus, the old mercenary and the Winnili slaughter Ekkbert and his men, Egino orders his men to not interfere but they are also watching in horror."
  +" ^^Soon, the surviving Winnili start to loot the village and the corpses, you heard a few women and men are being taken slave by the mercenaries. You join them in the pillage and find two gold bars and 10.000 denars worth of loot."
  +" ^^When dawn comes, Egino and his men led the survivors away from you, he will have to lead the rest of the tribe now. {s19}"
  +" The survivors of the Sciri decide to stay away from you as you load the carts with amber and other supplies for your journey back to Kalissa."
  +" ^^After a few days, you are back at the tavern of Kalissia you've visited before leaving for the Baltic. A day later you and your companions meet with Hadrianus cousin."
  +" ^^{s20}",
  "none", [
    (set_background_mesh, "mesh_pic_victory"),
    (str_clear, s19),
    (str_clear, s20),
    (try_begin),
        (quest_slot_eq, "qst_wlodowiecus_adventure_3", slot_quest_object_center, 1),
        (str_store_string, s19, "@Mathildiz, apathetic and disturbed, says nothing. She joins your warband."),
        (str_store_string, s20, "@You haven't seen Mathildiz for a while. Before you meed Hadrianus cousin you search for her. You only find her dead corps. Unable to bear with the pain she had indirectly caused, Mathildiz has slit her own throat in dejection."),
    (try_end),
  ],[
    ("option_1",[],"Continue.",[
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 12), ## looted
      (display_message, "str_quest_updated"),
      (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_3", 6, "@The trade deal failed. You defeated the Sciri and decide to load their capital.", 0),

      (troop_add_gold,"trp_player", 10000),
      (troop_add_item, "trp_player", "itm_temple_gold", 0),
      (troop_add_item, "trp_player", "itm_temple_gold", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),

      (assign, "$temp1", 1),
      (assign, "$temp2", "trp_alwisus"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_castle_germanic_sea_1_in"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_horse|af_override_weapons),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 2, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 2),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_subarmalis_1"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 4, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 4),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_roman_poor7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 5, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 5),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_roman_poor6"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 7, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 7),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_celtic_light7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_caligea"),

      (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_conversation_generic", 1, 0),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_outfit_1 | af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      (set_visitor, 7, "trp_old_mercenary"),
      (set_visitor, 8, "trp_alwisus"),
      (jump_to_scene, "scn_castle_germanic_sea_1_in"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_sciri_final_sub",mnf_scale_picture,
  "The peasants and slaves of the Sciri decide to stay away from you as you load the carts with amber and other supplies for your journey back to Kalissa. {s19}"
  +" ^^Just like your travel through Africa, the return is uneventful, and after a few days, you are back at the tavern you've visited before leaving for the Baltic."
  +" A day later you and your companions meet with Hadrianus cousin.",
  "none", [
    (set_background_mesh, "mesh_pic_victory"),
    (try_begin),
        (quest_slot_eq, "qst_wlodowiecus_adventure_3", slot_quest_object_center, 1),
        (str_store_string, s19, "@Mathildiz joines your warband. She seems to be sad about the events but she seems to be getting over it."),
    (try_end),
  ],[
    ("option_1",[],"Continue.",[
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_current_state, 11), ## subjugated
      (display_message, "str_quest_updated"),
      (add_quest_note_from_sreg, "qst_wlodowiecus_adventure_3", 6, "@The trade deal failed. You defeated the Sciri and decide to spare the lives of the survivors.", 0),

      (try_begin),
          (quest_slot_eq, "qst_wlodowiecus_adventure_3", slot_quest_object_center, 1),
          (call_script, "script_recruit_troop_as_companion", "trp_mathildiz"),
          (call_script, "script_change_player_relation_with_troop", "trp_mathildiz", 100),
      (try_end),

      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),
      (troop_add_item, "trp_player", "itm_amber", 0),

      (assign, "$temp1", 1),
      (assign, "$temp2", "trp_alwisus"),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_castle_germanic_sea_1_in"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_horse|af_override_weapons),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 2, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 2),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_subarmalis_1"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",2, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 4, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 4),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_roman_poor7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",4, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 5, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 5),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_roman_poor6"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",5, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 7, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 7),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_celtic_light7"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",7, "itm_caligea"),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 9, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 9),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic", 9, "itm_germanic_light3"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic", 9, "itm_celtic_boots"),

      (try_begin),
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_conversation_generic", 1, 0),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 1, af_override_outfit_1 | af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 4, "trp_hadrianus"),
      (set_visitor, 5, "trp_mancinellus"),
      (set_visitor, 6, "trp_mathildiz"),
      (set_visitor, 7, "trp_old_mercenary"),
      (set_visitor, 8, "trp_alwisus"),
      (set_visitor, 9, "trp_egino"),
      (jump_to_scene, "scn_castle_germanic_sea_1_in"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_3_sciri_final_end",mnf_scale_picture,
  "You return back to Carnuntum together with Hadrianus cousin Alwisus. The journey is uneventful."
  " As your party reaches Carnuntum, everybody departs. You return to your main party, which has camped near Carnuntum.",
  "none", [
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("option_1",[],"Continue.",[
      (add_xp_as_reward, 10000),
      (store_current_day, ":day"),
      (val_max, ":day", 1),
      (quest_set_slot, "qst_wlodowiecus_adventure_3", slot_quest_timer, ":day"),
      (call_script, "script_end_quest", "qst_wlodowiecus_adventure_3"),
      (jump_to_menu, "mnu_auto_return_map"),
      (rest_for_hours, 72, 16, 0),
    ]),
]),

("wlodowiecus_adventure_1_3_raid_1_died",mnf_scale_picture,
  "You feel the weight of your armor, your limbs growing heavy. As you fall to your knees, the earth embraces you, and your vision fades."
  +" In those final moments, you reflect on the life you've led, the battles you've fought, and the camaraderie you've shared with your fellow warriors."
  +" A profound sense of peace washes over you, and you find solace in the knowledge that you gave your all in the crucible of battle."
  +" With a last, whispered breath, you close your eyes, knowing that you've joined the ranks of those who've gone before you, leaving a legacy of bravery on the battlefield."
  +" Your journey in this world has ended.",
  "none", [
    (set_background_mesh, "mesh_pic_defeat"),
  ],[
    ("option_1",[],"Continue.",[
      (assign, "$temp", 0),
      (jump_to_menu, "mnu_death_waits"),
    ]),
]),

("wlodowiecus_adventure_1_2_start",mnf_scale_picture,
  "You follow Wlodowiecus outside of Leptis Magna, near the front game to the city there's a pair of tents that belong to the travelling Garamantians. Hadrianus, Varus and the old mercenary were standing nearby, talking with the oddly friendly Berbers; Mancinellus can be seen talking with the eldest member of the caravan, whose wizened face formed a wide grin as the Roman handed him a bag full of coins. After an hour of preparation, the caravan departs Leptis Magna and heads into the hot desert ahead of you.",
  "none", [
    (troop_set_inventory_slot, "trp_wlodowiecus", ek_horse, "itm_horse_3"),
    (troop_set_inventory_slot, "trp_hadrianus",  ek_horse, "itm_horse_3"),
    (troop_set_inventory_slot, "trp_mancinellus",  ek_horse, "itm_horse_3"),
    (troop_set_inventory_slot, "trp_varus",  ek_horse, "itm_horse_3"),
    (troop_set_inventory_slot, "trp_old_mercenary",  ek_horse, "itm_horse_3"),
    (set_background_mesh, "mesh_pic_desert"),
  ],[
    ("option_1",[],"Continue.",[
      (add_xp_as_reward, 1500),

      (assign, "$g_next_menu", "mnu_wlodowiecus_adventure_1_2_raid_1"),
      (assign, "$tutorial_state", 0),
      (assign, "$temp3", 1),
      (assign, "$temp1", "mnu_wlodowiecus_adventure_1_2_continue_1"),
      (assign, "$temp2", "mnu_wlodowiecus_adventure_1_2_raid_1_died"),
      (set_jump_mission, "mt_desert_cutscene"),
      (modify_visitors_at_site, "scn_scene_camp_desert"),
      (reset_visitors),

      (set_visitor, 1, "trp_player"),
      (troop_set_slot, "trp_temp_array_a", 1, "trp_mancinellus"),
      (troop_set_slot, "trp_temp_array_a", 2, "trp_wlodowiecus"),
      (troop_set_slot, "trp_temp_array_a", 3, "trp_hadrianus"),
      (troop_set_slot, "trp_temp_array_a", 4, "trp_old_mercenary"),
      (troop_set_slot, "trp_temp_array_a", 5, "trp_varus"),
      (troop_set_slot, "trp_temp_array_a", 6, "trp_sarranid_horseman"),

      (try_begin),
          (eq,"$character_gender", tf_female),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_female),
      (else_try),
          (troop_set_type,"trp_multiplayer_profile_troop_male", tf_male),
      (try_end),
      (str_store_troop_face_keys, s1, "trp_player"),
      (troop_set_face_keys, "trp_multiplayer_profile_troop_male", s1),
      (call_script, "script_dplmc_copy_inventory", "trp_player", "trp_multiplayer_profile_troop_male"),

      (troop_set_slot, "trp_temp_array_a", 7, "trp_multiplayer_profile_troop_male"),
      (jump_to_scene, "scn_scene_camp_desert"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_2_raid_1",mnf_scale_picture,
  "It's been a few days, the desert heat is relentless and nights are cold and cruel. Luckily the Garamantians had everything covered for the most part. You managed to resupply in the Garamantian city of Gadames before continuing forth to the other Garamantian city of Rapsa. Everything went smoothly until the Old Mercenary told the caravan elder about a lone horseman following them. The Elder looked at you and the rest of the company before shouting 'RAIDERS!'. Before you could even react, the lone horseman called forth his men and from behind the desert dunes rode several enemy Garamantians.",
  "none", [
    (set_background_mesh, "mesh_pic_desert"),
  ],[

    ("option_1",[],"Fight!",[
      (assign, "$temp3", 1),
      (assign, "$temp1", "mnu_wlodowiecus_adventure_1_2_continue_1"),
      (assign, "$temp2", "mnu_wlodowiecus_adventure_1_2_raid_1_died"),

      (set_jump_mission, "mt_wlods_advantures_fight"),
      (modify_visitors_at_site, "scn_random_scene_desert_custom_3"),
      (reset_visitors),

      (set_visitor, 1, "trp_player"),
      (set_visitors, 1, "trp_sarranid_horseman", 40),

      (set_visitor, 1, "trp_wlodowiecus"),
      (set_visitor, 1, "trp_hadrianus"),
      (set_visitor, 1, "trp_mancinellus"),
      (set_visitor, 1, "trp_varus"),
      (set_visitor, 1, "trp_old_mercenary"),

      (set_visitors, 4, "trp_gaetuli_horseman", 50),
      (jump_to_scene, "scn_random_scene_desert_custom_3"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_2_raid_1_died",mnf_scale_picture,
  "You don't know how it happened; you were knocked out by one of the Berber bandits alongside the rest of the caravan. You watched as the raiders kidnapped the women and enslaved some of the healthier men before stripping the dead from any riches. You watched as they killed the wounded mercilessly, and you were next, after taking away your belongings, you felt a Garamantian spear sink into your chest. Everything went dark after that.",
  "none", [
    (set_background_mesh, "mesh_pic_desert"),
  ],[

    ("option_1",[],"Continue.",[
      (assign, "$temp", 0),
      (jump_to_menu, "mnu_death_waits"),
    ]),
]),
  ("wlodowiecus_adventure_1_2_continue_1",mnf_scale_picture,
    "The last of the Garamantian bandits fall to you and your companions, some of the wounded bandits manage to escape into the desert despite their wounds but the allied Garamantian Elder insists that they will die out there; Mancinellus is oddly cheerful after that fight, flexing his martial prowess to some of the Garamantian women, Wlodowiecus starts to look for valuables alongside Varus and the Old Mercenary, Hadrianus can be seen making a small Christian prayer before joining in the looting. You and the others get some valuables from the dead bandits.^'See? This expedition pays for itself!' Shouted Mancinellus gleefully while Handrianus rolls his eyes unamused.",
    "none", [
    (set_background_mesh, "mesh_pic_desert"),],
    [

    ("option_1",[],"Continue.",
        [
    (troop_add_gold, "trp_player", 200),
    (add_xp_as_reward, 150),
    (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_rapsa"),
      ]),
    ],
  ),
  ("wlodowiecus_adventure_1_2_rapsa",mnf_scale_picture,
    "The journey to Rapsa continued smoothly after that and in a few days you arrived to the Berber city. You stayed in the city for a day to rest and resupply. Wlodowiecus and the Old Mercenary spent the night by the campfire while Varus snored loudly inside the tent, Mancinellus was busy using his charm on the local women, Hadrianus was nowhere to be seen but Wlodowiecus was not worried about him. You decided to go to bed after a hearty meal. The next day you learned that Hadrianus managed to secure a deal from a group of travelling Jews that were staying in the city. He gives you one piece of jewelry.",
    "none", [
    (set_background_mesh, "mesh_pic_desert"),],
    [

    ("option_1",[],"Continue.",
        [
    (troop_add_item, "trp_player", "itm_jewelry"),
    (add_xp_as_reward, 150),
    (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_camp"),
      ]),
    ],
  ),
  ("wlodowiecus_adventure_1_2_camp",mnf_scale_picture,
    "The travelling continued the following day, this time to the distant Berber city of Alasi. There was some uneasiness among the Garamantians because Mancinellus had seduced the daughter of one of the prominent members of the caravan. Wlodowiecus was ready to punch Mancinellus and break his nose until Hadrianus had an amicable talk with the Garamantian chieftain and eased up the tensions between your group and the Garamantians. The travel after that is relatively calm and after several hours of crossing the dunes, the group decides to camp and rest before continuing to Alasi. You find yourself sitting by the campfire alongside your fellow adventurers.",
    "none", [
    (set_background_mesh, "mesh_pic_desert"),],
    [

    ("option_1",[],"Continue.",
        [
        (quest_set_slot, "qst_wlodowiecus_adventure_2", slot_quest_current_state, 4),
        (assign, "$temp1", 2),
        (assign, "$temp2", "trp_mancinellus"),
        (assign, "$talk_context", 0),
        (set_jump_mission, "mt_conversation_generic"),
        (modify_visitors_at_site, "scn_scene_camp_desert"),
        (reset_visitors),

        (try_for_range, ":entry", 1, 7),
            (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_horse|af_override_weapons|af_override_head),
        (try_end),
        (set_visitor, 1, "trp_player"),
        (set_visitor, 2, "trp_wlodowiecus"),
        (set_visitor, 3, "trp_hadrianus"),
        (set_visitor, 4, "trp_mancinellus"),
        (set_visitor, 5, "trp_varus"),
        (set_visitor, 6, "trp_old_mercenary"),
        (jump_to_scene, "scn_scene_camp_desert"),
        (change_screen_mission),
      ]),
    ],
  ),
  ("wlodowiecus_adventure_1_2_camp1_end",mnf_scale_picture,
    "Despite a few arguments and a few threats, everyone in the company went back to their tents with a good mood. The following morning everyone gathered their belongings and continued forth towards the last known Berber city this deep in the desert, the tribal city of Alasi.^^"+
    "After several days of trekking through the desert, you and your companions finally arrives to Alasi, which was sparsely populated, with only a few inhabitants remaining, when asked about the current situation of the town, the tribesmen reveal that the majority of their tribe had left the city and was travelling the desert, and those few left here were too sick or old to come with them. After exchanging some valuable information with the Berber elders, the caravan learns of another city they can stop by before reaching the Oya river. The 'Ethiope' city of Tabemekka. As soon as Mancinellus heard the word 'Ethiope' a lascivious grin grew on his face, much to the dismay of his companions.",
    "none", [
    (set_background_mesh, "mesh_pic_desert"),],
    [

    ("option_1",[],"Continue.",
        [
    (add_xp_as_reward, 500),
    (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_tabemekka"),
      ]),
    ],
  ),

  ("wlodowiecus_adventure_1_2_tabemekka",mnf_scale_picture,
    "The people of Tabemekka were surprisingly friendly, plenty of times some of the children asked you if they could touch your and your hair, not used to see foreigners besides the travelling Berbers. Wlodowiecus and Hadrianus kept mostly to themselves, Varus was outright dismissive of the tribal people, earning some mockery from the Africans, the old mercenary on the other hand seemed to enjoy talking with the tribespeople despite the heavy language barrier and Mancinellus couldn't stop hitting on the various women of the tribe, from young to old. He even dared to make a move on the chieftess of Tabemekka, which deeply upsets Wlodowiecus. Your stay continued well for a few days until Wlodowiecus decided to leave the next day.",
    "none", [
    (set_background_mesh, "mesh_pic_desert"),],
    [

    ("option_1",[],"Continue.",
        [
    (add_xp_as_reward, 500),
    (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_fuck_1"),
      ]),
    ],
  ),
  ("wlodowiecus_adventure_1_2_fuck_1",mnf_scale_picture,
    "During your last day in Tabemekka, however, while you were washing down near a stream, you were joined by two beautiful African maidens that were wearing colorful skirts and nothing covering their breasts. Both women walked straight towards you with big smiles on their faces, yet neither of them spoke your language, however, it was rather apparent that they were both looking at your body. After a few seconds of awkward silence, one of the ladies approach you and gently presses her hand on your cheek, attempting to kiss you.",
    "none", [
    (set_background_mesh, "mesh_pic_desert"),],
    [

    ("option_1",[],"Allow her to continue.",
        [
    (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_fuck_y"),
      ]),
    ("option_2",[],"Stop her.",
        [
    (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_fuck_n"),
      ]),
    ],
  ),

  ("wlodowiecus_adventure_1_2_fuck_y",mnf_scale_picture,
    "You let the tribal woman kiss you, before you even noticed her companion was standing next to you, gently caressing your body. You spend several hours with these ladies until the three of you were too exhausted to continue, but it was clear that they had enjoyed their time with you. When you returned to the caravan, you are approached by a grinning Mancinellus, who firmly wraps his arm around your neck. 'I hope you enjoyed them!' He says, his wolfish grin growing ever wider. 'They were the chieftess daughters! Mancinellus always tries to take care of his friends!' he shouts before walking away laughing out loud.",
    "none", [
    (set_background_mesh, "mesh_pic_hexe_party"),],
    [

    ("option_1",[],"Continue.",
        [
    (add_xp_as_reward, 1000),
    (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_gao"),
      ]),
    ],
  ),
("wlodowiecus_adventure_1_2_fuck_n",mnf_scale_picture,
  "You gently push the woman away before walking away from stream. When you return to the caravan, a disappointed Mancinellus approaches you. 'Oh, by Venus! How could you refuse the love of two beautiful women {playername}!' he says 'I seduced their mother, the chieftess, and convinced her to offer her daughters to you! They will be so disappointed!' he claims before walking away, sighing in utter disappointment.",
  "none", [
    (set_background_mesh, "mesh_pic_desert"),
  ],[
  ("option_1",[],"Continue.",[
    (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_gao"),
  ]),
]),

("wlodowiecus_adventure_1_2_gao",mnf_scale_picture,
  "The next day the company continues their expedition down south, to one of these mythical gold kingdoms described by Mancinellus, the city of Gao. The travel to Gao was shorter and less enduring than the travel to Tabemekka. In a mere three days you arrived to the vast and expansive city, with hundreds of huts inhabited by people of many professions, such as blacksmiths, potters, fishermen and the like. But while Gao was quite advanced when compared to the other cities encountered on your way, you and your companions notice a severe lack of something important: Gold. You quickly find your answer, when a merchant informs you that the gold monopoly of the Niger belongs to the city of Tombouze, a few days heading west, following the river.",
  "none", [
    (set_background_mesh, "mesh_pic_desert"),
  ],[
  ("option_1",[],"Continue.",[
    (add_xp_as_reward, 500),
    (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_gao_leave"),
  ]),
]),

  ("wlodowiecus_adventure_1_2_gao_leave",mnf_scale_picture,
    "After enjoying some days in Gao, the caravan continues to Tombouze and arrive to the center of the gold trade in just two days. Only to find the surprisingly large city almost abandoned. It was a haunting sight to walk throughout nearly a hundred empty huts before finding living inhabitants, they were a few women and elders living by the houses near river and when asked about the current state of the city, the women say that most have left to seek better lands temporarily. When asked about the gold trade, they admit that only their king and his closest allies know the location of the gold mines and that they have no gold to trade. When hit by this revelation, Wlodowiecus punches Mancinellus so hard in the face that it knocks the Roman for several minutes before regaining consciousness. 'We are leaving!' shouts Wlodowiecus before joining the Garamantian caravan.",
    "none", [
    (set_background_mesh, "mesh_pic_desert"),],
    [

    ("option_1",[],"Continue.",
        [
    (add_xp_as_reward, 500),
    (jump_to_menu, "mnu_wlodowiecus_adventure_1_2_raid_2"),
      ]),
    ],
  ),

  ("wlodowiecus_adventure_1_2_raid_2",mnf_scale_picture,
    "Everyone was quiet, even the talkative Mancinellus, who looked miserable right now. Hadrianus tried to console his Roman friend but to no avail. The caravan was making their way to the city of Djenne Djanno, which the Garamantians wanted to visit before returning to the previous path. When asked why they wanted to stop in this city, the elder of the caravan admits that he just wants to eat one of their delicious meals to lift up his mood after this chaotic expedition. But when the caravan arrives to Djenne Djanno, you are not welcomed by exotic new peoples, but by the javelins of an enemy. It seems like a Gaetuli war party was currently raiding the city and was now going to rob the caravan for approaching their siege!",
    "none", [
    (set_background_mesh, "mesh_pic_desert"),],
    [

    ("option_1",[],"Fight!",
        [
    (assign, "$temp3", 1),
    (assign, "$temp1", "mnu_wlodowiecus_adventure_1_2_continue_2"),
    (assign, "$temp2", "mnu_wlodowiecus_adventure_1_2_raid_2_died"),

    (set_jump_mission, "mt_wlods_advantures_fight"),
    (modify_visitors_at_site, "scn_random_scene_desert_custom_2"),
    (reset_visitors),

    (set_visitor, 1, "trp_player"),
    (set_visitors, 1, "trp_sarranid_horseman", 40),

    (set_visitor, 1, "trp_wlodowiecus"),
    (set_visitor, 1, "trp_hadrianus"),
    (set_visitor, 1, "trp_mancinellus"),
    (set_visitor, 1, "trp_varus"),
    (set_visitor, 1, "trp_old_mercenary"),

    (set_visitors, 4, "trp_gaetuli_horseman", 60),
    (jump_to_scene, "scn_random_scene_desert_custom_2"),
    (change_screen_mission),
      ]),
    ],
  ),

("wlodowiecus_adventure_1_2_continue_2",mnf_scale_picture,
  "Against all odds, you and the caravan manage to fend off the rampaging Gaetuli who run away back to the desert. You and your companions celebrate, but you were not alone, as the inhabitants of Djenne Djanno start to celebrate your victory and treat you as heroes! You are then lead to the chief's house, the biggest and certainly the best equipped building for taking care of important and esteemed guests such as yourselves. For the distinction of saving Djenne Djanno, the chief rewards you with various pieces of gold. While not the grand amount you were hoping for, it was certainly a handsome reward. You and the caravan are then invited to stay in the city and celebrate your victory!",
  "none", [
    (set_background_mesh, "mesh_pic_desert"),
  ],[
    ("option_1",[],"Continue.",[
      (troop_add_items, "trp_player", "itm_temple_gold", 3),
      (troop_add_gold, "trp_player", 10000),
      (add_xp_as_reward, 500),
      # player
      #1-8 heros
      # #9-30 rest
      (quest_set_slot, "qst_wlodowiecus_adventure_2", slot_quest_current_state, 5),
      (assign, "$temp1", 3),
      (assign, "$talk_context", 0),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_subsaharan_african_village"),
      (reset_visitors),

      (try_for_range, ":entry", 1, 31),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_horse),
      (try_end),
      (set_visitor, 1, "trp_player"),
      (set_visitor, 2, "trp_wlodowiecus"),
      (set_visitor, 3, "trp_hadrianus"),
      (set_visitor, 5, "trp_varus"),
      (set_visitor, 6, "trp_old_mercenary"),
      (set_visitor, 7, "trp_yaaba"),
      (set_visitor, 8, "trp_mancinellus"),

      (set_visitor, 9, "trp_sarranid_horseman"),
      (set_visitor, 10, "trp_sarranid_horseman"),
      (set_visitor, 11, "trp_sarranid_horseman"),
      (set_visitor, 12, "trp_sarranid_horseman"),
      (set_visitor, 13, "trp_sarranid_horseman"),
      (set_visitor, 14, "trp_sarranid_horseman"),
      (set_visitor, 15, "trp_african_man"),
      (set_visitor, 16, "trp_african_woman"),
      (set_visitor, 17, "trp_african_man"),
      (set_visitor, 18, "trp_african_woman"),
      (set_visitor, 19, "trp_african_woman"),
      (set_visitor, 20, "trp_african_woman"),
      (set_visitor, 21, "trp_african_woman"),
      (set_visitor, 22, "trp_african_man"),
      (set_visitor, 23, "trp_african_woman"),
      (set_visitor, 24, "trp_african_man"),
      (set_visitor, 25, "trp_african_woman"),
      (set_visitor, 26, "trp_african_woman"),
      (set_visitor, 27, "trp_african_woman"),
      (set_visitor, 28, "trp_african_woman"),
      (set_visitor, 29, "trp_african_man"),
      (set_visitor, 30, "trp_african_woman"),

      (jump_to_scene, "scn_subsaharan_african_village"),
      (change_screen_mission),
    ]),
]),

("wlodowiecus_adventure_1_2_raid_2_died",mnf_scale_picture,
  "You don't know how it happened; you were knocked out by one of the Berber bandits alongside the rest of the caravan. You watched as the raiders kidnapped the women and enslaved some of the healthier men before stripping the dead from any riches. You watched as they killed the wounded mercilessly, and you were next, after taking away your belongings, you felt a Gaetuli spear sink into your chest. Everything went dark after that.",
  "none", [
    (set_background_mesh, "mesh_pic_desert"),
  ],[

    ("option_1",[],"Continue.",[
      (assign, "$temp", 0),
      (jump_to_menu, "mnu_death_waits"),
    ]),
]),

("wlodowiecus_adventure_1_2_final",mnf_scale_picture,
  "The travel back to Rome was as eventful as the travel down to the Oya river, you witnessed strange animals and endured the merciless African weather. But luckily, you didn't have to fight any marauding bands of Berbers. After weeks of seemingly endless hours of trekking the through the desert, you finally arrive to Leptis Magna.",
  "none",[
    (set_background_mesh, "mesh_pic_desert"),
  ],[
    ("option_1",[],"Continue.",[
      (quest_set_slot, "qst_wlodowiecus_adventure_2", slot_quest_current_state, 6),
      (add_xp_as_reward, 8500),
      (troop_add_item, "trp_player", "itm_rice", 0),
      (troop_add_item, "trp_player", "itm_rice", 0),
      (troop_add_item, "trp_player", "itm_rice", 0),
      (troop_add_item, "trp_player", "itm_rice", 0),
      (troop_add_item, "trp_player", "itm_rice", 0),
      (rest_for_hours, 72, 16, 0),
      (call_script, "script_end_quest", "qst_wlodowiecus_adventure_2"),
      (store_current_day, ":day"),
      (val_max, ":day", 1),
      (quest_set_slot, "qst_wlodowiecus_adventure_2", slot_quest_timer, ":day"),
      (change_screen_map),
    ]),
]),

 ###EBD OF WLOD ADVENTURE II
("fief_management",0,
  "Fief management menu.",
  "none", [
    (start_presentation, "prsnt_fief_management"),
  ],[
]),

("return_fief_management",0,
  "Return fief managment menu. HAHA! You are stuck in a menu.",
  "none",[
    (store_encountered_party, "$g_encountered_party"),
    (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (eq, reg61, 1),
        (assign, "$temp4", 0),
        (set_jump_mission,"mt_palace"),
        (modify_visitors_at_site,"scn_imperial_palace"),
        (assign, "$talk_context", tc_court_talk),
        (reset_visitors),

        (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_palace", 0, 0),
          (mission_tpl_entry_set_override_flags, "mt_palace", 0, af_override_outfit_1|af_override_horse),
        (try_end),
        (set_visitor,0,"trp_player"),

        (set_visitor,2,"trp_greek_scholar"),
        (set_visitor,3,"trp_roman_scholar"),
        (set_visitor,4,"trp_military_adviser"),
        (set_visitor,5,"trp_financial_adviser"),
        (set_visitor,6,"trp_diplomatic_adviser"),
        (try_begin),
            (store_relation, ":faction_relation", "fac_kingdom_6", "fac_player_supporters_faction"),
            (ge, ":faction_relation", 0),
            (set_visitor,7,"trp_diplomat_parthia"),
        (try_end),
        (set_visitor,8,"trp_diplomat_eastern"),
        (try_begin),
            (store_relation, ":faction_relation", "fac_garamantes", "fac_player_supporters_faction"),
            (ge, ":faction_relation", 0),
            (set_visitor,9,"trp_diplomat_africa"),
        (try_end),
        (set_visitor,10,"trp_diplomat_india"),
        (try_begin),
            (ge, "$g_heir_of_rome", 1),
            (set_visitor,35,"$g_heir_of_rome"),
        (try_end),
        (set_visitor,14,"trp_housholder"),
        (try_begin),
            (gt, "$g_player_chamberlain", 0),
            (call_script, "script_dplmc_appoint_chamberlain"),  #fix for wrong troops after update
            (set_visitor, 15, "$g_player_chamberlain"),
        (try_end),

        (try_begin),
            (gt, "$g_player_constable", 0),
            (call_script, "script_dplmc_appoint_constable"),  #fix for wrong troops after update
            (set_visitor, 16, "$g_player_constable"),
        (try_end),

        (try_begin),
            (gt, "$g_player_chancellor", 0),
            (call_script, "script_dplmc_appoint_chancellor"), #fix for wrong troops after update
            (set_visitor,17, "$g_player_chancellor"),
        (try_end),
        (try_begin),
            (eq, "$g_player_court", "$current_town"),
            (gt, "$g_player_minister", 0),
            (neg|troop_slot_eq, "trp_player", slot_troop_spouse, "$g_player_minister"),
            (set_visitor, 18, "$g_player_minister"),
        (try_end),
        (try_begin),
            (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
            (gt, ":player_spouse", 0),
            (assign, ":entry", 19),
            (store_random_in_range, ":r", 0, 10),
            (try_begin),
                (troop_slot_eq, ":player_spouse", slot_troop_bachus, 3),
                (troop_slot_eq, ":player_spouse", slot_lord_reputation_type, lrep_adventurous),
                (le, ":r", 5),
                (assign, ":entry", 36),
            (try_end),
            (set_visitor,":entry",":player_spouse"),
        (try_end),
        (set_visitor,20,"trp_praetoriani_milites"),
        (set_visitor,21,"trp_praetoriani_milites"),
        (set_visitor,22,"trp_praetoriani_milites"),
        (set_visitor,23,"trp_praetoriani_milites"),
        (set_visitor,24,"trp_praetoriani_milites"),
        (set_visitor,25,"trp_praetoriani_milites"),
        (set_visitor,26,"trp_praetoriani_milites"),
        (set_visitor,27,"trp_praetoriani_milites"),
        (set_visitor,28,"trp_praetoriani_milites"),
        (set_visitor,29,"trp_praetoriani_milites"),

        (set_visitor,30,"trp_tavern_minstrel_4"),
        (set_visitor,31,"trp_tavern_minstrel_3"),
        (set_visitor,32,"trp_slave"),
        (set_visitor,33,"trp_slave"),
        (set_visitor,34,"trp_slave"),

        (set_visitor,40,"trp_plinius_elder"),

        ##courtiers
        (try_begin),
            (troop_slot_ge, "trp_sporus", slot_troop_betrothed, 0),
            (quest_slot_ge, "qst_freelancing", slot_quest_freelancer_state, 17),
            (set_visitor, 60, "trp_sporus"),
        (try_end),
        (set_visitor, 61, "trp_courtier_locusta"),
        (set_visitor, 62, "trp_courtier_crispinilla"),

        (try_begin),
            (gt, "$praefectus_urbani", -1),
            (set_visitor, 41, "$praefectus_urbani"),
        (try_end),

        (try_begin),
            (troop_slot_eq, "trp_avaritia", slot_troop_spouse, 4),
            (set_visitor,45,"trp_avaritia"),
        (try_end),
        (jump_to_scene, "scn_imperial_palace"),
        (change_screen_mission),
    (else_try),
        (this_or_next|party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_castle),
        (eq, reg61, 2),
        (call_script, "script_enter_court", "$g_encountered_party", -1),
    (else_try),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
        (jump_to_menu, "mnu_village"),
    (else_try),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_latifundium),
        (jump_to_menu, "mnu_latifundium"),
    (else_try),
        (this_or_next|party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_castle),
        (jump_to_menu, "mnu_town"),
    (else_try),
        (display_log_message, "@Issues in return fief management", message_negative),
        (jump_to_menu, "mnu_auto_return_map"),
    (try_end),
    (assign, reg61, 0),
  ],[
]),

############langobard quest
("langobard_landing",0,
  "You arrive at the camp and see hundreds of tents. It seems the Lugians have assembled an army of more than two thousand men! Some warriors approach and inform you their king is awaiting you.",
  "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    (try_begin),
        (quest_slot_eq, "qst_langobard_arrive", slot_quest_temp_slot, 2),
        (quest_set_slot, "qst_langobard_arrive", slot_quest_temp_slot, 3),
       #1 player, #2 king, #3 scout
        #4-11 soldiers
        #12-20 enemies
        #21-23 camera
        (quest_set_slot, "qst_langobard_arrive", slot_quest_current_state, 2),

        (modify_visitors_at_site, "scn_langobard_landing"),
        (reset_visitors),
        (set_jump_mission, "mt_langobard_battle"),
        (options_get_battle_size, ":size"),

        (store_mul, ":number", 400, ":size"),
        (val_div, ":number", 1000),
        (val_add, ":number", 100),

        (val_div, ":number", 8),

        (set_visitor, 1, "trp_player"),
        (set_visitor, 2, "trp_kingdom_13_lord"),
        (set_visitor, 3, "trp_germanic_cavalry"),

        (try_for_range, ":unused", 0,  ":number"),
            (store_random_in_range, ":warrior","trp_germanic_light_clubman", "trp_germanic_noble_spearman_vet"),
            (set_visitor, 4, ":warrior", 1),#1
            (store_random_in_range, ":warrior","trp_germanic_light_clubman", "trp_germanic_noble_spearman_vet"),
            (set_visitors, 5, ":warrior", 1),#2
            (store_random_in_range, ":warrior", germanic_mercenary_troops_begin, germanic_mercenary_troops_end),
            (set_visitors, 6, ":warrior", 1),#3
            (store_random_in_range, ":warrior","trp_germanic_light_clubman", "trp_germanic_noble_spearman_vet"),
            (set_visitors, 7, ":warrior", 1),#4
            (store_random_in_range, ":warrior","trp_germanic_light_clubman", "trp_germanic_noble_spearman_vet"),
            (set_visitors, 8, ":warrior", 1),#5
            (store_random_in_range, ":warrior", germanic_mercenary_troops_begin, germanic_mercenary_troops_end),
            (set_visitors, 9, ":warrior", 1),#6
            (store_random_in_range, ":warrior", germanic_mercenary_troops_begin, germanic_mercenary_troops_end),
            (set_visitors, 10, ":warrior", 1),#7
            (store_random_in_range, ":warrior","trp_germanic_light_clubman", "trp_germanic_noble_spearman_vet"),
            (set_visitors, 11, ":warrior", 1),#8
        (try_end),
        (set_visitor, 4, "trp_germanic_hornman", 1),
        (set_visitor, 5, "trp_germanic_hornman", 1),
        (set_visitor, 6, "trp_germanic_hornman", 1),
        (set_visitor, 7, "trp_germanic_hornman", 1),
        (set_visitor, 8, "trp_germanic_hornman", 1),
        (jump_to_scene, "scn_langobard_landing"),
        (change_screen_mission),
    (try_end),
  ],[
    ("continue",[],"Continue...",[
      (quest_set_slot, "qst_langobard_arrive", slot_quest_temp_slot, 1),
      (call_script, "script_setup_troop_meeting", "trp_kingdom_13_lord", -1, -1),
    ]),
]),

("langobard_defeat",0,
  "You fall and everything turns black.^^You are walking over flower meadows. Shiny figures approach who put wreaths of flowers around your head. The sun is touching you."
  +" The sun is stroking your cheeks.^You are drinking wine, served in golden cups, eating food, served on golden plates."
  +"^An old cat is sitting in front of you, she comes closer and strokes you with her soft pelt. Then she strokes your face with her left paw, while she is giving you water with her right paw."
  +" You slowly drink. While days pass the cat comes, strokes you, gives you to drink and disappears in light."
  +" ^^Days pass. All of a sudden you find yourself lost in a foggy forest - fear and darkness seem to devour you.",
  "none", [
    (set_background_mesh, "mesh_pic_girls"),
  ],[
    ("continue",[],"I must find a way out...",[
      (set_jump_mission, "mt_walhalla"),
      (modify_visitors_at_site, "scn_walhalla_outdoor"),
      (reset_visitors),
      # (set_jump_entry, 0),
      (jump_to_scene, "scn_walhalla_outdoor"),
      (change_screen_mission),
    ], "Go outside."),
    ("continue",[(eq, 1, 0),],"Enter the longhouse.",[
      (set_jump_mission, "mt_walhalla_indoor"),
      (modify_visitors_at_site, "scn_walhalla_indoors"),
      (reset_visitors),
      (set_jump_entry, 0),
      (set_visitor, 1, "trp_germanic_myth_hero_1"),
      (set_visitor, 2, "trp_germanic_myth_hero_2"),
      (set_visitor, 3, "trp_germanic_myth_hero_3"),
      (set_visitor, 4, "trp_germanic_myth_hero_4"),
      (jump_to_scene, "scn_walhalla_indoors"),
      (change_screen_mission),
    ], "Enter the longhouse."),
]),

("langobard_defeat_2",0,
  "Suddenly you awake. Your head hurts terrible. You are lying on a bed in the middle of a longhouse. You stand up and walk towards the door. You open it."
  +" You enter a room where an old woman and two men are standing.",
  "none", [
    (set_background_mesh, "mesh_pic_girls"),
  ],[
    ("continue",[],"Continue...",[
      (party_set_name, "p_langobard_landing", "@Scoringa"),
      (party_set_icon, "p_langobard_landing", "icon_castle_c"),
      #scn_town_germanic_east_castle
      (add_xp_as_reward, 1500),
      (quest_set_slot, "qst_langobard_arrive", slot_quest_current_state, 5),
      (assign, "$temp1", 4),
      (assign, "$temp2", "trp_gambara"),
      (assign, "$talk_context", 0),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, "scn_town_germanic_east_castle"),
      (reset_visitors),
      (try_for_range, ":entry", 16, 19),
          (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_horse|af_override_weapons|af_override_head),
      (try_end),

      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 0, af_override_everything),
      (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 0),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",0, "itm_linen_tunic"),
      (mission_tpl_entry_add_override_item, "mt_conversation_generic",0, "itm_caligea"),

      (set_visitor, 0, "trp_player"),
      (set_visitor, 16, "trp_gambara"),
      (set_visitor, 17, "trp_agio"),
      (set_visitor, 18, "trp_ybor"),
      (jump_to_scene, "scn_town_germanic_east_castle"),
      (change_screen_mission),
    ]),
]),

("longbard_leave",0,
    "You say farewell, gather your belongings, and leave the settlement. You make your way through the woods, but soon you are lost. All the trees look the same! You run around and finally find a path. You follow the path, but after a while, you see the settlement of the Longbeards in the distance! ^^You wander around all day, but you always end up in the settlement of the Longbeards. It is becoming night and you are too tired to move on. You decide to stay at the settlement.^^Gambara and her sons are already awaiting you. They have already prepared a room for you.",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),

    ],
    [
      ("continue",[],"Continue...",
    [
    (add_xp_as_reward, 1500),
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 30),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 30, 10, 0),
    (change_screen_map),
    ]),
]),

 ("longbard_stay",0,
    "After the meal is finished, you want to take a walk around the village. However, Gambara advises you to go to bed instead. She says you are still too weak. You follow her advice.^^You slowly fall asleep. You are dreaming about a raven who is watching you from a tree. He is following you while you are walking through the woods. You stop, as there is a cat sitting in the middle of the road. The cat looks at you...",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),

    ],
    [
      ("continue",[],"Continue...",
    [
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 24),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 30, 10, 0),
    (change_screen_map),
    ]),
]),

 ("longbard_1",0,
    "You awaken on the next day. Gambara brings you breakfast. Then, you decide to take that walk around the village. The men all have long beards, while the women look healthy and strong. You remember that the Lugians thought the Winnili women would be ten feet high and have beards. You speak with Gambara about it and she tells you how she fooled the Lugians: The Winnili only had some hundreds of soldiers while the Lugians assembled an army of thousands, coming from all parts of Germania. Thus, she ordered the women to hide in the forests. When the Lugian army arrived, they spread their hair in front of their faces so as to look bearded and present themselves as warriors. The Lugians thought they were encircled and panicked. Their king Assis was captured. They negotiated a treaty with his brother: Assis shall be set free while the Winnili, now known as Longobardae, the Longbeards, shall obtain the lands at the mouth of the river Suebos.",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_current_state, 9),
    ],
    [
      ("leave",[],"I have spend enough time here. I will say farewell and leave.",
    [
    (jump_to_menu, "mnu_longbard_leave"),
    ]),
     ("continue",[],"Go to bed.",
    [
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 24),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 30, 10, 0),
    (change_screen_map),
    ]),
]),

("longbard_2",0,
    "You dreamed again about ravens and cats.^^After breakfast, you take a walk through the village. You find Ybor sharpening a sword. You look at the sword: its handle is decorated with bronze and it has a long, broad blade perfectly made for cutting. You ask him if it is his sword. He says it is the sword of his father. He is still maintaining it, though nobody uses it. It usually hangs on the wall of the main hall.^^You continue your walk. You come across a woman carrying water. She stumbles, falls, and accidentally spills all the water on your clothes.",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_current_state, 10),
    ],
    [
    ("leave",[],"'You idiot! Watch out!'",
    [
    (quest_get_slot, ":state", "qst_langobard_arrive", slot_quest_importance),
    (val_sub, ":state", 5),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_importance, ":state"),
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 24),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 30, 10, 0),
    (change_screen_map),
    ]),
     ("continue",[],"'No problem. Let me help you.'",
    [
    (jump_to_menu, "mnu_longbard_2_helped"),
    ]),
     ("continue",[],"Ignore her and continue your walk.",
    [
    (quest_get_slot, ":state", "qst_langobard_arrive", slot_quest_importance),
    (val_sub, ":state", 1),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_importance, ":state"),
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 24),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 30, 10, 0),
    (change_screen_map),
    ]),
]),

 ("longbard_2_helped",0,
    "You help her get up. Then, you help her carry the water to her house. She thanks you many times.^^You spend the rest of the day at the beach, watching how the waves hit the coast. When it gets dark, you walk back to the village. The woman whom you helped approaches you and gives you a loaf of bread which she baked today using the water you carried. You thank her.",    "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    ],
    [
     ("continue",[],"Continue...",
    [
    (add_xp_as_reward, 1500),
    (quest_get_slot, ":state", "qst_langobard_arrive", slot_quest_importance),
    (val_add, ":state", 1),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_importance, ":state"),
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 30),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 35, 10, 0),
    (change_screen_map),
    ]),
]),

("longbard_3",0,
    "On the next day, you decide to walk along the river.^^The sky is clear and the sun makes the water gleam. You come across some women who are doing laundy right at the mouth of the river. They seem to be exhausted.^^You notice that if you would continue walking upstream, you would reach another village sooner or later. That way, you wouldn't get lost in the forests.",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_current_state, 11),
    ],
    [
    ("leave",[],"I will walk back to the village.",
    [
    (quest_get_slot, ":state", "qst_langobard_arrive", slot_quest_importance),
    (val_sub, ":state", 1),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_importance, ":state"),
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 24),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 30, 10, 0),
    (change_screen_map),
    ]),
     ("continue",[],"I will walk upstream.",
    [
    (quest_get_slot, ":state", "qst_langobard_arrive", slot_quest_importance),
    (val_sub, ":state", 1),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_importance, ":state"),
    (jump_to_menu, "mnu_longbard_3_leave"),
    ]),
    ("continue",[],"I will help the women with their launder.",
    [
    (jump_to_menu, "mnu_longbard_3_launder"),
    ]),
]),

("longbard_3_launder",0,
    "You approach the women and offer to help them. They giggle, as doing the laundry is women's work, but they are so exhausted that they accept your help anyway. ^^After you finish, you return to the village. The other men are making jokes about you, the strange foreigner, who helped women doing women's work. But, you don't care.^^That the evening, the women you helped approach, bringing you a roasted haunch of meat with vegetables and honey. One of them also gifts you some amber she found at the beach.",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    ],
    [

     ("continue",[],"Continue...",
    [
    (troop_add_item, "trp_player", "itm_amber",0),
    (add_xp_as_reward, 1500),
    (quest_get_slot, ":state", "qst_langobard_arrive", slot_quest_importance),
    (val_add, ":state", 1),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_importance, ":state"),
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 30),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 35, 10, 0),
    (change_screen_map),
    ]),
]),

("longbard_3_leave",0,
    "You continue walking upstream. After hours of exhausting walking, you feel the pain from your old wounds. The pain soon becomes unbearable. You want to sit down next to the river, but you stumble and fall into the water. You try to save yourself by getting back on land but you have no chance in your state. Luckily, Ybor spots you! He was sailing on the river to catch some fish. He helps you out of the water and brings you back to the village.",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    ],
    [
    ("continue",[],"Continue...",
    [
    (add_xp_as_reward, 1500),
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 30),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 35, 10, 0),
    (change_screen_map),
    ]),
]),

("longbard_4",0,
    "The days pass and your strength slowly comes back. You go on your walk through the village again.^^This time, you are walking through the fields the people have cultivated. You spot some slaves working on them. They look tired and are struggling under the burning sun.^^A little cat runs past you. You could swear it's the same one you've dreamed of. She stops in front of a slave for a moment then continues walking.",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_current_state, 12),
    ],
    [
    ("leave",[],"I will walk back to the village.",
    [
    (quest_get_slot, ":state", "qst_langobard_arrive", slot_quest_importance),
    (val_sub, ":state", 1),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_importance, ":state"),
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 24),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 30, 10, 0),
    (change_screen_map),
    ]),
     ("continue",[],"I spend enough time in this village. I will leave now.",
    [
    (jump_to_menu, "mnu_longbard_leave"),
    ]),
    ("continue",[],"Offer the slaves help.",
    [
    (jump_to_menu, "mnu_longbard_4_slaves"),
    ]),

]),

("longbard_4_slaves",0,
    "At first, the slaves think you are joking, but as you grab a hoe they see that you are serious.^^You help them, but soon you feel exhausted and take a break. The other slaves notice and say it's best you stop. They are slaves, after all, and used to this work, while you aren't. But you continue anyway. The more hours pass, the easier it gets. It becomes evening and you return with the slaves to the village. The other people are making some jokes about you, the strange foreigner, who helped slaves doing slave work. But you don't care. It felt good to do something strenuous after all that forced inactivity.^Later that evening, a small child approaches; his father is one of the slaves whom you helped. He gives you a small amulet he crafted.",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    ],
    [

     ("continue",[],"Continue...",
    [
    (add_xp_as_reward, 1500),
    (quest_get_slot, ":state", "qst_langobard_arrive", slot_quest_importance),
    (val_add, ":state", 1),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_importance, ":state"),
    (store_current_hours, ":cur_hour"),
    (val_add, ":cur_hour", 30),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_gold_reward, ":cur_hour"),
    (rest_for_hours, 35, 10, 0),
    (change_screen_map),
    ]),
]),

 ("longbard_finale",0,
    "Today, Agio approaches. He says Gambara wants to speak to you. Both she and her brother Ybor are awaiting you in the hall.",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_current_state, 13),
    ],
    [

    ("continue",[],"Continue...",
    [
    (add_xp_as_reward, 1500),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_current_state, 14),
    (assign, "$temp1", 4),
    (assign, "$temp2", "trp_gambara"),
    (assign, "$talk_context", 0),
    (set_jump_mission, "mt_conversation_generic"),
    (modify_visitors_at_site, "scn_town_germanic_east_castle"),
    (reset_visitors),
    (try_for_range, ":entry", 0, 19),
        (mission_tpl_entry_set_override_flags, "mt_conversation_generic", ":entry", af_override_horse|af_override_weapons|af_override_head),
    (try_end),

    (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 0, af_override_everything),
    (mission_tpl_entry_clear_override_items, "mt_conversation_generic", 0),
    (mission_tpl_entry_add_override_item, "mt_conversation_generic",0, "itm_linen_tunic"),
    (mission_tpl_entry_add_override_item, "mt_conversation_generic",0, "itm_caligea"),

    (set_visitor, 0, "trp_player"),
    (set_visitor, 16, "trp_gambara"),
    (set_visitor, 17, "trp_agio"),
    (set_visitor, 18, "trp_ybor"),
    (jump_to_scene, "scn_town_germanic_east_castle"),
    (change_screen_mission),
    ]),
]),

("longbard_finale_2",0,
  "You leave the village of the Longbeards. After a while, you find your troops who set up camp upstream near the river. You ask them what happened and why they didn't search for you. They answer that, after the Lugian army was defeated, they retreated to a safe position. Only then did they start to search for you, but they didn't search the territory of the Winnili as they feared the Winnili. Your men think they are humans with wolf heads!",
  "none", [
    (set_background_mesh, "mesh_pic_camp"),
    (quest_set_slot, "qst_langobard_arrive", slot_quest_current_state, 15),
  ],
  [
  ("continue",[],"Continue...",[
    (add_xp_as_reward, 1500),
    (call_script, "script_end_quest", "qst_langobard_arrive"),
    (change_screen_map),
    (rest_for_hours, 0,0,0),
    (change_screen_map),
  ]),
]),

("langobard_village",0,
    "You arrive at the village of the Longbeards.",
    "none", [
    (set_background_mesh, "mesh_pic_deserters"),
  ],
  [
  ("continue",[],"Walk around.",[
    (set_jump_mission, "mt_visit_desert_town"),
    (modify_visitors_at_site, "scn_langobard_village"),
    (reset_visitors),

    (assign, ":troop", "trp_lombard_skirmisher"),
    (assign, ":troop2", "trp_lombard_vetran"),
    (assign, ":walker2", "trp_germanic_village_walker"),
    (assign, ":walker1", "trp_germanic_village_walker_female"),

    (set_visitor, 1, ":troop"),
    (set_visitor, 2, ":troop"),
    (set_visitor, 3, ":troop2"),
    (set_visitor, 4, ":troop"),
    (set_visitor, 5, ":troop"),
    (set_visitor, 6, ":troop2"),
    (set_visitor, 7, ":troop"),
    (set_visitor, 8, ":troop"),
    (set_visitor, 9, ":troop"),
    (set_visitor, 10, ":troop2"),
    (set_visitor, 11, ":troop"),
    (set_visitor, 12, ":troop2"),

    (try_for_range,":entry",13,26),
        (store_random_in_range,":rand",0,10),
        (try_begin),
            (is_between, ":rand", 0,4),
            (assign, ":town_walker", ":walker1"),
        (else_try),
            (is_between, ":rand",4,10),
            (assign, ":town_walker", ":walker2"),
        (try_end),
        (mission_tpl_entry_clear_override_items,"mt_visit_desert_town",":entry"),
        (store_random_in_range,":r",0,10),
        (try_begin),
            (gt,":r",2),
            (mission_tpl_entry_add_override_item,"mt_visit_desert_town",":entry","itm_dedal_kufel"),
        (try_end),
        (set_visitor,":entry",":town_walker"),
    (try_end),
    #dedal end

    (set_visitor, 26, ":walker2"),
    (set_visitor, 27, ":walker1"),
    (set_visitor, 28, ":walker2"),
    (set_visitor, 29, ":walker1"),
    (set_visitor, 30, ":walker2"),
    (set_visitor, 31, ":walker1"),
    (set_visitor, 32, ":walker2"),
    (set_visitor, 33, ":walker1"),
    (set_visitor, 34, ":walker2"),
    (set_visitor, 35, ":walker1"),
    (set_visitor, 36, ":walker2"),
    (set_visitor, 37, ":walker1"),
    (set_visitor, 38, ":walker2"),
    (set_visitor, 39, ":walker1"),
    (set_visitor, 40, ":walker2"),
    (set_visitor, 41, ":walker1"),
    (set_visitor, 42, ":walker2"),
    (set_visitor, 43, ":walker1"),
    (set_visitor, 44, ":walker2"),
    (set_visitor, 45, ":walker1"),

    (set_visitor, 46, "trp_ybor"),
    (set_visitor, 47, "trp_gambara"),
    (set_visitor, 48, "trp_agio"),

    (assign, "$talk_context", tc_town_talk),
    (jump_to_scene, "scn_langobard_village"),
    (set_jump_entry, 0),
    (change_screen_mission),
  ]),

    ("continue",[],"Go Back.",[
      (change_screen_map),
    ]),
]),

 ("investment",0,
  "Investment opportunity^^A prominent merchant from {s40} has reached out through your client looking for a loan to finance a potentially profitable business venture in the {s41} sector. They are looking for {reg41} denars and will repay with interest in your next weekly budget. If the venture goes well they will share some profits on top of the original sum, otherwise you will lose the investment. Your client thinks it's a good deal.",
  "none",[
    (set_background_mesh, "mesh_pic_payment"),
    (call_script, "script_cf_get_random_town_of_culture", "fac_culture_7"),
    (assign, reg40, reg0),
    (quest_set_slot, "qst_investment", slot_quest_dont_give_again_remaining_days, 28),
    (try_begin),
        (is_between, reg40, towns_begin, towns_end),
        (str_store_party_name, s40, reg40),
        (store_random_in_range, ":string", "str_investment_request_text1", "str_investment_request_end"),
        (str_store_string, s41, ":string"),

        (store_troop_gold, ":uper_boud", "trp_player"),
        (val_min, ":uper_boud", 100001),
        (store_random_in_range, reg41, 50000, ":uper_boud"),
        (val_div, reg41, 1000),#round it
        (val_mul, reg41, 1000),

        (quest_set_slot, "qst_investment", slot_quest_target_dna, ":string"),#store string
        (quest_set_slot, "qst_investment", slot_quest_target_center, reg40),#store town
        (quest_set_slot, "qst_investment", slot_quest_target_amount, reg41),#store money

        (store_random_in_range, ":interest_rate", 5, 11),
        (quest_set_slot, "qst_investment", slot_quest_convince_value, ":interest_rate"),

        (store_random_in_range, ":faile_rate", 2, 21),
        (quest_set_slot, "qst_investment", slot_quest_failure_consequence, ":faile_rate"),
    (else_try),
        (change_screen_map),
    (try_end),
  ],[

    ("continue",[],"No need to check. Let's do this! [You pay {reg41}. In one or two weeks you will recieve the loan + interests back, if the deal fails you recieve nothing.]",[
      (troop_remove_gold, "trp_player", reg41),
      (store_current_day, ":cur_day"),
      (quest_set_slot, "qst_investment", slot_quest_current_state, ":cur_day"),
      (change_screen_map),
    ]),

    ("continue",[],"Travel to {s40} to better evaluate this deal yourself.",[
      (setup_quest_text, "qst_investment"),
      ##diplomacy start+ fix gender of pronoun
      (str_store_party_name_link, s40, reg40),
      (str_store_string, s2, "@Speak with the Magister Civium in {s40} about the investment opportunity and evaluate the deal."),
      (quest_set_slot, "qst_investment", slot_quest_expiration_days, 15),
      ##diplomacy end+
      (call_script, "script_start_quest", "qst_investment", "trp_argentarius"),
      (change_screen_map),
    ]),

    ("continue",[],"No interest.",
    [
      (quest_set_slot, "qst_investment", slot_quest_target_dna, 0),
      (quest_set_slot, "qst_investment", slot_quest_target_center, 0),
      (quest_set_slot, "qst_investment", slot_quest_target_amount, 0),
      (quest_set_slot, "qst_investment", slot_quest_convince_value, 0),
      (quest_set_slot, "qst_investment", slot_quest_failure_consequence, 0),
      (quest_set_slot, "qst_investment", slot_quest_current_state, 0),
      (change_screen_map),
    ]),
]),

("epidemic_outbreak",0,
  "Sickness and death!^^{s10} is haunted by an outbreak of {s0}. {s1}^The people pray to the gods begging them to redeem them.^{s33}",
  "none", [
    (play_sound, "snd_disease_sound"),
    (str_store_party_name, s10, "$g_notification_menu_var1"),
    (party_get_slot, ":disease", "$g_notification_menu_var1", slot_center_disease),
    (call_script, "script_get_event_details", ":disease"),
    (set_background_mesh, "mesh_pic_family"),
    (str_clear, s33),
    (try_begin),
        (party_slot_eq, "$g_notification_menu_var1", slot_town_lord, "trp_player"),
        (str_store_string, s33, "@You may order a quarantine for the settlement. However, such measures will upset the population as the majority of the population do not believe that it has any effect at all."),
    (try_end),
  ],[
    ("option_1", [
      (party_slot_eq, "$g_notification_menu_var1", slot_town_lord, "trp_player"),
    ],"Order a quarantine.",[
      (jump_to_menu, "mnu_auto_return_map"),
      (party_get_slot, ":disease", "$g_notification_menu_var1", slot_center_disease),
      (val_sub, ":disease", 1),
      (party_set_slot, "$g_notification_menu_var1", slot_center_disease, ":disease"),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", -10),
    ]),
    ("option_2", [
      (party_slot_eq, "$g_notification_menu_var1", slot_town_lord, "trp_player"),
    ],"Do nothing.",[
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("option_3", [
      (neg|party_slot_eq, "$g_notification_menu_var1", slot_town_lord, "trp_player"),
    ],"Continue.",[
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("disaster_event",0,
  "{s23}^^{s24}",
  "none",[
    (set_background_mesh, "mesh_pic_family"),
    (str_store_party_name, s10, "$g_notification_menu_var1"),
    (party_get_slot, ":event", "$g_notification_menu_var1", slot_center_event),
    (call_script, "script_get_event_details", ":event"),
    (assign, "$temp4", reg1),
    (store_sub, "$temp4_1", 100, reg0),
    (val_mul, "$temp4_1", 1000),
    (str_clear, s23),
    (str_clear, s24),
    (try_begin),
        (lt, "$temp4", 0),
        (str_store_string, s23, "@Disaster!^^{s10} was hit by a disastrous {s0}. {s1}^The people pray to the gods that the disaster may end soon."),
        (str_clear, s24),
        (store_faction_of_party, ":fac", "$g_notification_menu_var1"),
        (try_begin),
            (is_between, ":fac", kingdoms_begin, kingdoms_end),
            (faction_slot_eq, ":fac", slot_faction_leader, "trp_player"),
            (faction_slot_eq, ":fac", slot_faction_government_type, gov_imperial),
            (str_store_string, s24, "@The people are calling for aid. You could send funds from the imperial treasury."),
        (else_try),
            (party_slot_eq, "$g_notification_menu_var1", slot_town_lord, "trp_player"),
            (str_store_string, s24, "@The people are calling for aid. You could send funds from your treasury."),
        (try_end),
    (else_try),
        (str_store_string, s23, "@Divine blessing!^^News reach you that {s10} has been blessed by a {s0}. {s1}^The people thank the gods and celebrate."),
    (try_end),
  ],[
    ("option_2", [
      (lt, "$temp4", 0),
      (store_faction_of_party, ":fac", "$g_notification_menu_var1"),
      (is_between, ":fac", kingdoms_begin, kingdoms_end),
      (assign, ":c", 0),
      (try_begin),
        (party_slot_eq, "$g_notification_menu_var1", slot_town_lord, "trp_player"),
        (assign, ":c", 1),
      (else_try),
        (faction_slot_eq, ":fac", slot_faction_leader, "trp_player"),
        (faction_slot_eq, ":fac", slot_faction_government_type, gov_imperial),
        (assign, ":c", 1),
      (try_end),
      (eq, ":c", 1),
      (assign, reg11, "$temp4_1"),
    ],"Sent {reg11} denars.",[
      (call_script, "script_change_center_prosperity", "$g_notification_menu_var1", 4),
      (party_get_slot, ":event", "$g_notification_menu_var1", slot_center_event),
      (val_sub, ":event", 1),
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", 5),
      (call_script, "script_change_player_honor", 5),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (store_faction_of_party, ":fac", "$g_notification_menu_var1"),
      (try_begin),
          (is_between, ":fac", kingdoms_begin, kingdoms_end),
          (faction_slot_eq, ":fac", slot_faction_leader, "trp_player"),
          (faction_slot_eq, ":fac", slot_faction_government_type, gov_imperial),
          (val_mul, "$temp4_1", -1),
          (call_script, "script_add_to_faction_bugdet", slot_faction_spending_edicts, "$players_kingdom", "$temp4_1"),
      (else_try),
          (val_abs, "$temp4_1"),
          (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", "$temp4_1", "trp_player"),
      (try_end),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("option_2", [
      (lt, "$temp4", 0),
      (store_faction_of_party, ":fac", "$g_notification_menu_var1"),
      (is_between, ":fac", kingdoms_begin, kingdoms_end),
      (assign, ":c", 0),
      (try_begin),
        (party_slot_eq, "$g_notification_menu_var1", slot_town_lord, "trp_player"),
        (assign, ":c", 1),
      (else_try),
        (faction_slot_eq, ":fac", slot_faction_leader, "trp_player"),
        (faction_slot_eq, ":fac", slot_faction_government_type, gov_imperial),
        (assign, ":c", 1),
      (try_end),
      (eq, ":c", 1),
      (store_mul, reg10, "$temp4_1", 2),
      (val_div, reg10, 3),
    ],"Sent {reg10} denars.",[
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", 3),
      (call_script, "script_change_player_honor", 3),
      (call_script, "script_change_troop_renown", "trp_player", 8),
      (call_script, "script_change_center_prosperity", "$g_notification_menu_var1", 4),
      (store_faction_of_party, ":fac", "$g_notification_menu_var1"),
      (val_mul, "$temp4_1", 2),
      (val_div, "$temp4_1", 3),
      (try_begin),
          (is_between, ":fac", kingdoms_begin, kingdoms_end),
          (faction_slot_eq, ":fac", slot_faction_leader, "trp_player"),
          (faction_slot_eq, ":fac", slot_faction_government_type, gov_imperial),
          (val_mul, "$temp4_1", -1),
          (call_script, "script_add_to_faction_bugdet", slot_faction_spending_edicts, "$players_kingdom", "$temp4_1"),
      (else_try),
          (val_abs, "$temp4_1"),
          (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", "$temp4_1", "trp_player"),
      (try_end),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("option_2", [
      (lt, "$temp4", 0),
      (store_faction_of_party, ":fac", "$g_notification_menu_var1"),
      (is_between, ":fac", kingdoms_begin, kingdoms_end),
      (assign, ":c", 0),
      (try_begin),
        (party_slot_eq, "$g_notification_menu_var1", slot_town_lord, "trp_player"),
        (assign, ":c", 1),
      (else_try),
        (faction_slot_eq, ":fac", slot_faction_leader, "trp_player"),
        (faction_slot_eq, ":fac", slot_faction_government_type, gov_imperial),
        (assign, ":c", 1),
      (try_end),
      (eq, ":c", 1),
      (store_div, reg10, "$temp4_1", 2),
    ],"Sent {reg10} denars.",[
      (call_script, "script_change_player_relation_with_center", "$g_notification_menu_var1", 2),
      (call_script, "script_change_player_honor", 2),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_change_center_prosperity", "$g_notification_menu_var1", 2),
      (store_faction_of_party, ":fac", "$g_notification_menu_var1"),
      (val_div, "$temp4_1", 2),
      (try_begin),
          (is_between, ":fac", kingdoms_begin, kingdoms_end),
          (faction_slot_eq, ":fac", slot_faction_leader, "trp_player"),
          (faction_slot_eq, ":fac", slot_faction_government_type, gov_imperial),
          (val_mul, "$temp4_1", -1),
          (call_script, "script_add_to_faction_bugdet", slot_faction_spending_edicts, "$players_kingdom", "$temp4_1"),
      (else_try),
          (val_abs, "$temp4_1"),
          (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", "$temp4_1", "trp_player"),
      (try_end),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("option_1", [
    ],"Continue.",[
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("player_raises_to_nobility",0,
    "As you are wealthy and famous enough you have owned yourself the right to be part of the Roman nobility! From now on it is possible for you to be elected a governorship or to obtain high military ranks.",
    "none", [
      (try_begin),
          (check_quest_active, "qst_gain_renown"),
          (call_script, "script_succeed_quest", "qst_gain_renown"),
          (call_script, "script_end_quest", "qst_gain_renown"),
          (add_xp_as_reward, 2000),
          (display_message, "@You have finished one of your goals! You are now part of Roman nobility.", color_good_news),
      (try_end),
      (try_begin),
          (check_quest_active, "qst_join_roman_army"),
          (call_script, "script_cancel_quest", "qst_join_roman_army"),
          (call_script, "script_end_quest", "qst_join_roman_army"),
      (try_end),
    ],[
    ("option_1", [],"Continue.",[
      (try_begin),
          (eq, "$players_kingdom", "fac_player_supporters_faction"),
          (call_script, "script_deactivate_player_faction"),
          (try_for_range, ":npc", active_npcs_begin, active_npcs_end),
              (store_faction_of_troop, ":npc_faction", ":npc"),
              (eq, ":npc_faction", "fac_player_supporters_faction"),
              (troop_slot_eq, ":npc", slot_troop_occupation, slto_kingdom_hero),
              (call_script, "script_change_troop_faction", ":npc", "fac_kingdom_7"),
          (try_end),
      (try_end),

      (try_begin),
          (is_between, "$players_oath_renounced_against_kingdom", kingdoms_begin, kingdoms_end),
          (neq, "$players_oath_renounced_against_kingdom", "fac_kingdom_7"),
          (store_relation, ":relation", "fac_player_supporters_faction", "$players_oath_renounced_against_kingdom"),
          (val_min, ":relation", -40),
          (call_script, "script_set_player_relation_with_faction", "$players_oath_renounced_against_kingdom", ":relation"),
          (call_script, "script_update_all_notes"),
          (assign, "$g_recalculate_ais", 1),
      (try_end),

      (try_begin),
          (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
          (neq, "$players_kingdom", "fac_player_supporters_faction"),
          (neq, "$players_kingdom", "fac_kingdom_7"), #ie, don't leave faction if the player is already part of the same kingdom

          (faction_get_slot, ":old_leader", "$players_kingdom", slot_faction_leader),
          (call_script, "script_add_log_entry", logent_renounced_allegiance,   "trp_player",  -1, ":old_leader", "$players_kingdom"),
          (call_script, "script_player_leave_faction", 0),
      (try_end),

      (call_script, "script_player_join_faction", "fac_kingdom_7"),

      # (try_begin),
          # (gt, "$g_invite_offered_center", 0),
          # (call_script, "script_give_center_to_lord", "$g_invite_offered_center", "trp_player", 0),
          # (try_begin),
              # (faction_slot_eq, "$players_kingdom", slot_faction_political_issue, "$g_invite_offered_center"),
              # (faction_set_slot, "$players_kingdom", slot_faction_political_issue, -1),
          # (try_end),
      # (try_end),

      (faction_get_slot, ":leader","fac_kingdom_7",slot_faction_leader),
      (call_script, "script_add_log_entry", logent_pledged_allegiance,   "trp_player",  -1, ":leader", "fac_kingdom_7"),

      # (try_begin),
          # (check_quest_active, "qst_join_faction"),
          # (eq, "$g_invite_faction_lord", "$g_talk_troop"),
          # (call_script, "script_end_quest", "qst_join_faction"),
      # (else_try),
          # (check_quest_active, "qst_join_faction"),
          # (call_script, "script_abort_quest", "qst_join_faction", 0),
      # (try_end),
      (assign, "$player_has_homage" ,1),
      (assign, "$g_player_banner_granted", 1),
      (assign, "$g_invite_faction", 0),
      (assign, "$g_invite_faction_lord", 0),
      # (assign, "$g_invite_offered_center", 0),
      (assign, "$g_leave_encounter",1),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("recieve_money",0,
    "You find the moneylender and obtain the requested money. Additionally you recieve 2,500 denars as a gift from {s22}.^^As it seems, your intrigue generated minor rumours.",
    "none", [
    (quest_get_slot, ":giver", "qst_collect_requested_money", slot_quest_giver_troop),
    (str_store_troop_name, s22, ":giver"),

    (call_script, "script_troop_change_relation_with_troop", "trp_kingdom_7_lord", "trp_player", -2),
    (display_message, "@Your little intrigue generated minor rumours.", color_bad_news),
    (call_script, "script_change_troop_renown", "trp_player", -10),
    (call_script, "script_change_player_honor", -1),
    ],
    [

    ("option_1", [],"Continue.",
    [
    (quest_get_slot, ":money", "qst_collect_requested_money", slot_quest_target_amount),
    (val_add, ":money", 2500),
    (troop_add_gold, "trp_player", ":money"),

    (call_script, "script_change_influence", "trp_player", 50),

    (call_script, "script_end_quest", "qst_collect_requested_money"),
    (add_xp_as_reward, 250),
    (jump_to_menu, "mnu_town"),]),

]),

("recieve_senate",0,
  "You find the senator friends of {s22} and discuss everything with them during a small feast.^^As it seems, your intrigue generated minor rumours.",
  "none", [
    (set_background_mesh, "mesh_pic_bachus"),

    (quest_get_slot, ":giver", "qst_collect_requested_senate", slot_quest_giver_troop),
    (str_store_troop_name, s22, ":giver"),

    (call_script, "script_troop_change_relation_with_troop", "trp_kingdom_7_lord", "trp_player", -2),
    (display_message, "@Your little intrigue generated minor rumours.", color_bad_news),
    (call_script, "script_change_troop_renown", "trp_player", -10),
    (call_script, "script_change_player_honor", -1),
  ],[
  ("option_1", [],"Continue.",[
    (call_script, "script_change_influence", "trp_player", 50),

    (quest_get_slot, reg1, "qst_collect_requested_senate", slot_quest_target_amount),
    (val_mul, reg1, number_of_senators),
    (val_div, reg1, 1000),
    (call_script, "script_change_senate_support", reg1, 1),

    (call_script, "script_end_quest", "qst_collect_requested_senate"),
    (add_xp_as_reward, 250),
    (jump_to_menu, "mnu_town"),
  ]),
]),

("recieve_influence",0,
  "After entering the town, a messenger informs you where you can find the friends of {s22}. You head towards the meeting point. After several discussions you finish the deal.^^As it seems, your intrigue generated minor rumours.",
  "none", [
    (quest_get_slot, ":giver", "qst_collect_requested_influence", slot_quest_giver_troop),
    (str_store_troop_name, s22, ":giver"),

    (call_script, "script_troop_change_relation_with_troop", "trp_kingdom_7_lord", "trp_player", -2),
    (display_message, "@Your little intrigue generated minor rumours.", color_bad_news),
    (call_script, "script_change_troop_renown", "trp_player", -10),
    (call_script, "script_change_player_honor", -1),
  ],[
  ("option_1", [],"Continue.",[
    (quest_get_slot, ":influence", "qst_collect_requested_influence", slot_quest_target_amount),
    (val_add, ":influence", 100),
    (call_script, "script_change_influence", "trp_player", ":influence"),

    (call_script, "script_end_quest", "qst_collect_requested_influence"),
    (add_xp_as_reward, 250),
    (jump_to_menu, "mnu_town"),
  ]),
]),

##BEGIN: IAZYGES SETTLEMENT EVENTS
("iazyges_delegation",0,
  "Delegation of chieftains^^You are informed that a delegation of chieftains from a Sarmatian tribe called Iazyges has arrived."
  +" They heard from your rise to power and are now bringing gifts and an offer you may want to consider.",
  "none",[
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("option_1", [],"Welcome the delegation and start negotiations.",[
      # (troop_set_slot, "trp_global_variables", g_iazyges_event, 1),

      (party_get_slot, ":conversation_scene", "$current_town", slot_town_castle),
      (modify_visitors_at_site, ":conversation_scene"),
      (reset_visitors),

      (set_jump_mission,"mt_conversation_encounter_special"),
      (set_visitor, 10, "trp_player"),

      (try_begin),
          (troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
          (set_visitor, 11, ":spouse"),
      (try_end),

      (set_visitor, 26, "trp_diplomatic_adviser"),
      (mission_tpl_entry_set_override_flags, "mt_conversation_encounter_special", 10, af_override_horse|af_override_weapons|af_override_head),

      #clear flags for actual courtly conversations?
      (mission_tpl_entry_set_override_flags, "mt_conversation_encounter_special", 0, af_override_horse|af_override_weapons|af_override_head),

      (set_visitor, 0, "trp_kingdom_18_lord"),
      (set_visitor, 0, "trp_knight_3_11"),
      (set_visitor, 0, "trp_knight_3_14"),

      (assign, "$temp", "trp_kingdom_18_lord"),

      (try_begin),
          (gt, "$praefectus_urbani", -1),
          (mission_tpl_entry_set_override_flags, "mt_conversation_encounter_special", 40, af_override_horse|af_override_weapons|af_override_head),
          (set_visitor, 40, "$praefectus_urbani"),
      (try_end),
      (set_visitor, 61, "trp_courtier_crispinilla"),
      (set_visitor, 62, "trp_courtier_locusta"),

      (faction_get_slot, ":guard_troop", "$players_kingdom", slot_faction_guard_troop),
      (set_visitor, 6, ":guard_troop"),
      (set_visitor, 7, ":guard_troop"),

      (assign, "$temp3", 0),#variable for the conversation
      (assign, "$temp2", -1),#variable for the conversation
      (jump_to_scene, ":conversation_scene"),
      (change_screen_mission),
    ]),
    ("option_2", [],"Sarmatians? Send them away!",[
      (troop_set_slot, "trp_global_variables", g_iazyges_event, -1),
      (call_script, "script_enter_palace"),
    ]),
]),

("iazyges_event",0,
  "Settlement of the Iazyges^^In the past decades the Sarmatian tribe of the Iazyges has pressured into the Dacian and Pannonian area. Their chieftains made an agreement with Rome to settle in the Pannonian plains."+
  " The Iazyges want land and grazing grounds while the Romans want an ally against the Dacian threat."+
  "^^The Iazyges tribe invade the Pannonian plains, killing and enslaving the local population with the help of Rome. A new kingdom is established!",
  "none",[
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("option_1", [],"Continue.",[
      (call_script, "script_cf_start_iazyges_invasion", 1),
      (change_screen_map),
    ]),
]),
("iazyges_event_2",0,
  "Invasion of the Iazyges^^In the past decades the Sarmatian tribe of the Iazyges has pressured into the Dacian and Pannonian area. Their chieftains decided to invade the Pannonian plains to gain land and grazing grounds."+
  "^^Their warriors fought hard against the Dacians, but they could only conquer a small part of the plain. Without help from Rome their new kingdom will most likely die out soon.",
  "none",[
    (set_background_mesh, "mesh_pic_khergit"),
  ],[
    ("option_1", [],"Continue.",[
      (call_script, "script_cf_start_iazyges_invasion", 0),
      (change_screen_map),
    ]),
]),

("iazyges_feast",0,
  "All different kinds of food are served, coming from all parts of the world. Among these are the brains of pheasants and peacocks, the tongues of flamingos, the liver of a pike and the milt of a lamprey. The lavish meal impresses the Iazyges chieftains. Then the dessert is served. Meanwhile, a dozen of dancers perform the most stunning and erotic performance the chieftains have ever witnessed. After the performance is finished you yawn to show them that you are already used to such plays. Then you invite them to a bath. During the bath you have several conversations with the chieftains increasing your relation with them.^^As night is slowly pulling a dark veil over the palace you invite them to stay a night here. The chieftains agree and thank you many times for your generosity.^^When they think they are alone, the chieftains discuss their experiences. However, they are overheard by your slaves. The next day you receive the report of your slaves: the Iazyges where so impressed, they think an Empire that can serve such dishes and build such buildings can also easily field armies large enough to crush any enemy. Judging from their reaction, it is very unlikely that they will betray you, they fear your might too much.^^Now it is time to finish the negotiations.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
    (call_script, "script_change_player_relation_with_troop", "trp_kingdom_18_lord", 25),
    (call_script, "script_change_player_relation_with_troop", "trp_knight_3_11", 25),
    (call_script, "script_change_player_relation_with_troop", "trp_knight_3_14", 25),
    (call_script, "script_change_player_relation_with_troop", "trp_knight_3_17", 10),
    (call_script, "script_change_player_relation_with_troop", "trp_knight_3_20", 10),
  ],[
    ("option_1", [],"The Iazyges shall be a Roman protectorate..",[
      (troop_set_slot, "trp_global_variables", g_iazyges_event, 2),
      (change_screen_map),
    ]),
    ("option_2", [],"I don't need additional allies..",[
      (troop_set_slot, "trp_global_variables", g_iazyges_event, -1),
      (change_screen_map),
    ]),
]),
##END: IAZYGES SETTLEMENT EVENTS

("batava_revolt",0,
  "Batava revolt!^^The Germanic tribes living in the province of Germania Inferior have revolted against Roman rule! Roman garrisons in the province have been attacked by the Germanic tribes of the Batava and their allies."
  +" The following speech of their leader Julius Civilis is distributed among the population:"
  +" ^^'Let Syria, Asia Minor, and the East, habituated as it is to despotism, submit to slavery. But freedom is a gift bestowed by nature even on the dumb animals. Courage is the peculiar excellence of man, and the gods help the braver side! Let us fight brothers! Fight for our home, our families and our future!'",
  "none",[
    (set_background_mesh, "mesh_pic_townriot"),
  ],[
    ("option_1", [],"Continue.",[
      (call_script, "script_cf_start_batava_revolt"),
      (change_screen_map),
    ]),
]),

("rags_to_riches_1",0,
    "Upon entering Carthage, a dishevelled looking woman gives you a letter and disappears into the crowd. The letter simply reads: 'Meet me at the tavern.' You have the strange feeling you have seen her somewhere before.",
    "none", [
    (set_background_mesh, "mesh_pic_woman"),
    ],
    [

    ("option_1", [],"Continue.",
    [
    (str_store_string, s2, "@Visit the tavern of Carthago and find the mysterious person who sent you the letter."),
    (call_script, "script_start_quest", "qst_rags_to_riches", "trp_fortuna"),
    (quest_set_slot, "qst_rags_to_riches", slot_quest_current_state, 1),
    (jump_to_menu, "mnu_town"),
    ]),
]),

("rags_to_riches_2",0,
    "A lightning doesn't strike at the same place twice she said.  However, right after you and Sittius Afer left the tavern, the whole place bursts into flames. Surprised, you turn around and want "+
    "to rescue Agrippina from the tavern, but you could only watch as she perishes in agony in the flames. You will always remember her piercing cry of pain. Meanwhile Sittius reports that he "+
    "spotted several armed men who managed to escaped. Soon the vigila arrives and the fire is extinguished. At least it caused no other deads.^^With Agrippas dead, her are promises are null and void. "+
    "It may be better: Staying together with her would have caused only problems for you at the long turn. You can only hope that nobody noticed your conversations with her.",
    "none", [
    (set_background_mesh, "mesh_pic_wildfire"),
    ],
    [

    ("option_1", [],"Continue.",
    [
    (add_xp_as_reward, 2500),
    (call_script, "script_end_quest", "qst_rags_to_riches"),
    (quest_set_slot, "qst_rags_to_riches", slot_quest_current_state, 7),
    (change_screen_map),
    ]),

    ]),
    ("death_of_joseph_arimatrea",0,
    "Then a young man appears with a judge of water in his hands. He notices you are sweating heavily due to the heat and without asking, he takes your cup and fills it with clear water, then he hands it over to you. You say that Joseph of Arimathea has died, just a moment ago. He says, that he already knew he would die today and that he knew you would come and drink out of his cup. You are confused by his words and without thinking you take a sip from the cup. You taste wine! You look at the cup and you see that the water has turned into wine! You want to ask the young man how he made his trick but he has already disappeared.^^A moment later, women and men arrive to prepare Joseph for his funeral. You are still standing there and think how the wine could turn into water.",
    "none", [
    ],
    [

    ("option_1", [],"Most likely it was the heat...",
    [
    (add_xp_as_reward, 2500),
    (troop_add_item, "trp_player", "itm_holy_grail"),
    (jump_to_menu, "mnu_town"),
    ]),
]),

("lose_of_the_gral",0,
  "Lose of the grail^^The bright sun dazzles your light, the stench coming from the Tiber hurts your nose and crowds of people are blocking your path. You never have felt more disgusted by Rome than today. ^^You decide to sit town under a tree. A woman appears with a large judge of wine in her hands. She offers you some. You remember the cup you have been gifted by Joseph of Arimathea. You tell her to fill the cup. Then you drink. You don't know why, but the wine tastes like ordinary water. Either she fooled you or the wine is of bad quality.^^ The people around you spot the fish symbol and the name Chrestos on the cup. People start whispering. And in no time a large crowd has gathered. 'Can it be? It has to be! Chrestos! It is the cup of the Master himself! The Master has shown us a sign!' And while they talk more people gather. ^^The excitement of the crowd accelerates. Some woman start falling on the ground and scream and shout words in foreign languages. Some man raise there arms to the sky and start singing chants praising the name of their Lord. Some start dancing, others fall on their knees and cry. The mania of the crowd increases more and suddenly people start attacking you and try to grab the cup. Wine spills onto your cloths. You cannot keep them back, they are too many. You stumble and fall, and with you the cup falls. You lose sight of the cup. Finally, the vigilia appears and the chaos reaches its peak. People start to through stones at the troops and a riot starts. The riot lasts for one day, bringing death and suffering to many people.^^You check your pockets and find the cup gone.",
  "none", [
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
  ("option_1", [],"The cup is lost...",[
    (add_xp_as_reward, 2500),
    (troop_remove_item, "trp_player", "itm_holy_grail"),
    (jump_to_menu, "mnu_town"),
  ]),
]),

("influence_senate",0,
  "As it seems we have a bug here. HAHA!",
  "none", [
    (start_presentation, "prsnt_influence_senate"),
  ],[
  ("option_1", [],"Flee...",[
    (jump_to_menu, "mnu_town"),
  ]),
]),

("save_file_corrupted",0,
    "Your save file has been corrupted. You can try to restore the save:^^Go to the folder Documents -> Mount&Blade Warband Savegames."
    +"^There open the Aut Caesar aut nihil folder. Copy the file last_savegame_backup.sav and rename it to sg00.sav (or sg01.sav or whatever empty savegame slot you have). Then you can try loading this savegame.",
    "none", [
    (assign, reg0, "$g_corruption_check"),
    (display_message, "@global variable g_corruption_check = {reg0}"),
    (troop_get_slot, reg0, "trp_global_variables", g_corruption_check),
    (display_message, "@slot g_corruption_check = {reg0}"),
  ],[
    ("option_1", [],"Exit to main menu.",[
      (change_screen_quit),
    ]),
]),

("staying_at_antonias_villa",0,
    "You try to sleep but its impossible. The pain is too much. You crap a bottle of wine and drink until you are so drunken that you can't feel the pain anymore. Then you fall asleep. You have nightmares of ghosts haunting you through the underworld. "+
    "The ghosts disappear. You spot your parents under a birch tree. You want to say something but they disintegrate in darkness. The darkness comes and stays.^^You awake at lunchtime. Claudia Antonia is preparing lunch. "+
    "She curses loudly her terrible headache. Then she sits down next do you and starts to eat.",
    "none", [
    (set_background_mesh, "mesh_pic_villa"),
    ],
    [
    ("option_1", [],"Continue.",
    [
        (set_jump_mission, "mt_roman_intro_4"),
        (modify_visitors_at_site,"scn_antonias_house"),
        (reset_visitors),
        (set_visitor, 1, "trp_player"),
        (set_visitor, 2, "trp_antonia"),
        (jump_to_scene, "scn_antonias_house"),
        ##remove spr_draw_bridge_a if needed
        (change_screen_mission),
    ]),
]),
("staying_at_antonias_villa_2",0,
    "The hours pass and all you can do is lie on the bed. Meanwhile, you watch as Antonia goes here and there to do some household chores."+
    " However, judging by the neglected state of the house she does not seem to follow these tasks conscientiously."+
    " At the evening she appears again, serving you a simple dinner.",
    "none", [
    (set_background_mesh, "mesh_pic_villa"),
    ],
    [
    ("option_1", [],"Continue.",
    [
        (set_jump_mission, "mt_roman_intro_4"),
        (modify_visitors_at_site,"scn_antonias_house"),
        (reset_visitors),
        (set_visitor, 1, "trp_player"),
        (set_visitor, 2, "trp_antonia"),
        (jump_to_scene, "scn_antonias_house"),
        ##remove spr_draw_bridge_a if needed
        (change_screen_mission),
    ]),
]),
("staying_at_antonias_villa_final",0,
    "Some days pass and your wounds finally heal. Before you leave, Antonia reminds you about your tasks and says she will send you a message once you are a Roman noble. She also tells you not to visit her again nor to try to find her. Otherwise she may be captured and killed.",
    "none", [
    (set_background_mesh, "mesh_pic_villa"),
    ],
    [
    ("option_1", [],"Continue.",
    [
        (disable_party, "p_underworld"),
        (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("ask_judea_decide",0,
    "You leave the palace. You could wait now and find out what she want to discuss with you. She is for sure angry. But if you just leave immediately she will be even more angry.",
    "none", [
    (set_background_mesh, "mesh_pic_palast"),
    ],
    [
    ("option_1", [],"Wait for Poppaea.",
    [
        (call_script, "script_setup_troop_meeting", "trp_kingdom_7_lady_1", -1, "scn_londinium_castle"),
    ]),
    ("option_2", [],"Leave.",
    [
        (quest_set_slot, "qst_poking_the_lion", slot_quest_current_state, 3),
        (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_1", -25),
        (jump_to_menu, "mnu_town"),
    ]),
]),

("invitation_to_garden_party",0,
    "A rider approaches your party. He delivers an invitation to a great feast that will take place in the gardens of Maecenas in Rome.",
    "none", [
    (set_background_mesh, "mesh_pic_messenger"),
    ],
    [
    ("option_2", [],"Continue.",
    [
      (quest_get_slot,":state", "qst_nero_special_quest", slot_quest_target_dna),
      (val_add, ":state", 1),
      (quest_set_slot, "qst_nero_special_quest", slot_quest_target_dna,":state"),
      (setup_quest_text,  "qst_nero_special_quest"),
      (str_store_string, s2, "@Visit Rome and attend at the feast in the gardens of Maecenas!"),
      (quest_set_slot, "qst_nero_special_quest", slot_quest_expiration_days, 30),
      (quest_set_slot, "qst_nero_special_quest", slot_quest_current_state, 0),
      (call_script, "script_start_quest", "qst_nero_special_quest", "trp_kingdom_7_lord"),
      (call_script, "script_update_all_notes"),
      (change_screen_map),
    ]),
]),

("gardens_of_maecenas_1",0,
  "You enter the gardens of Maecenas, and are immediately overwhelmed by the grandeur and extravagance of the celebrations."
  +" The gardens are beautifully decorated with vibrant flowers and lush greenery, and the air is filled with the sweet scent of blooming roses."
  +"^^As you walk through the gardens, you are greeted by the sound of live music and the laughter of guests. The guests are dressed in their finest attire,"
  +" adorned in elegant togas and sparkling jewelry.^^Then you make your way to the main area of the feast. Your eyes are drawn to Poppaea Sabina,"
  +" Nero's wife. She is dressed in a stunning white and gold gown, with intricate embroidery adorning the bodice and sleeves. Her hair is styled in a sleek bun,"
  +" adorned with a gold headpiece and a string of pearls. She exudes an aura of grace and elegance, the epitome of Roman nobility.^^You can't help but feel a sense"
  +" of awe at the opulence of the scene before you, and you can't wait to indulge in the delicious food and fine wine that are sure to be served.",
  "none", [
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("option_2", [],"It's party time!",[
        (quest_set_slot, "qst_nero_special_quest", slot_quest_current_state, 1),
        # 0 player
        # 1 to 20 are walkers,
        # 21 to 45 are sitting low
        # 45 to 50 are sitting high
        # 50 to 55 are dancers
        # 55 to 60 are musicians
        # 60 to 63 are accorbats
        (modify_visitors_at_site, "scn_gardens_of_manacea"),
        (reset_visitors),
        (set_jump_mission, "mt_gardens_of_maceneas"),
        (set_visitor, 0, "trp_player"),
        (try_for_range, ":entry", 1, 21),
            (store_random_in_range, ":walker", "trp_roman_town_walker", "trp_celtic_town_walker"),
            (set_visitors, ":entry", ":walker", 2),
        (try_end),
        (try_for_range, ":entry", 21, 51),
            (store_random_in_range, ":sitting_low", "trp_guest", "trp_roman_priest_female"),
            (set_visitor, ":entry", ":sitting_low"),
        (try_end),
        (try_for_range, ":entry", 55, 60),
            (store_random_in_range, ":musician", "trp_tavern_minstrel_1", "trp_kingdom_heroes_including_player_begin"),
            (set_visitor, ":entry", ":musician"),
        (try_end),
        (set_visitor, 61, "trp_circus_1"),
        (set_visitor, 62, "trp_circus_2"),
        (set_visitor, 63, "trp_circus_3"),

        (set_visitor, 71, "trp_kingdom_7_lord"),
        (set_visitor, 72, "trp_tigellinus"),
        (set_visitor, 73, "trp_kingdom_7_lady_1"),

        (jump_to_scene, "scn_gardens_of_manacea"),
        (change_screen_mission),
    ]),
]),

("gardens_of_maecenas_2",0,
    "You can't help but feel a spark of attraction to her, she is so beautiful and captivating. She seems to be more relaxed and open as the night goes on, and she starts to share more personal stories with you."
    +"^^As the night comes to an end and the guests start to leave, Poppaea Sabina turns to you and says 'I had such a lovely time talking with you, {playername}. I feel like I can be myself around you.'"
    +" before leaning in and planting a soft kiss on your lips. The kiss is gentle at first, but as the moment lingers, it becomes more passionate. The feeling of her lips against yours is rousing, and you can't help but be swept away by the moment."
    +" The kiss ends with a gentle caress of the cheek and a whisper 'Until we meet again.'"
    +" You are left standing there, feeling a mix of surprise and pleasure, the memory of her kiss will linger in your mind for days to come.",
    "none", [
    (set_background_mesh, "mesh_pic_bachus"),
    ],
    [
    ("option_2", [],"Continue.",
    [
      (add_xp_as_reward, 500),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_1", 15),
      (jump_to_menu, "mnu_gardens_of_maecenas_final"),
    ]),
]),

("gardens_of_maecenas_final",0,
    "As the feast comes to a close, Nero stands at the center of the gardens of Maecenas. He is dressed in a toga of pure white, adorned with gold embroidery, and a golden crown on his head."
    +" In one hand, he holds a golden lyre, and in the other, a scroll of parchment. The guests gather around him, eager to hear the final performance of the evening."
    +" Nero clears his throat, and begins to play the lyre with skill and grace.The notes echo through the gardens, filling the air with a melodious harmony.",
    "none", [
    (set_background_mesh, "mesh_pic_bachus"),
    ],
    [
    ("option_2", [],"Continue.",
    [
      (quest_set_slot, "qst_nero_special_quest", slot_quest_current_state, 2),
      (assign, "$tutorial_state", 0),
      (modify_visitors_at_site, "scn_gardens_of_manacea"),
      (reset_visitors),
      (set_jump_mission, "mt_gardens_of_maceneas"),

      (try_for_range, ":unused", 0, 51),
          (store_random_in_range, ":guest", "trp_guest", "trp_roman_priest_female"),
          (set_visitor, 75, ":guest"),
      (try_end),
      (set_visitor, 75, "trp_tigellinus"),
      (set_visitor, 76, "trp_player"),

      (set_visitor, 74, "trp_kingdom_7_lord"),

      (jump_to_scene, "scn_gardens_of_manacea"),
      (change_screen_mission),
    ]),
]),

("gardens_of_maecenas_concludes",0,
  "As the poem comes to an end, the guests erupt into applause, cheering and clapping for Nero's performance. He smiles, bowing to the crowd, and then turns to his guests,"
  +" raising his lyre in a toast,^^'Let us celebrate this night, and the memories we have made here, may they last forever.'^^"
  +"^^With that, the feast comes to an end, and the guests start to depart, but the memory of the night and Nero's performance, will linger in their minds for a long time.",
  "none", [
  (set_background_mesh, "mesh_pic_bachus"),
  ],[
    ("option_2", [],"Continue.",[
      (call_script, "script_end_quest", "qst_nero_special_quest"),
      (quest_set_slot, "qst_nero_special_quest", slot_quest_target_dna, 0),
      (quest_set_slot, "qst_nero_special_quest", slot_quest_current_state, 0),
      (jump_to_menu, "mnu_town"),
    ]),
]),

("poppaea_event_chain_1",0,
  "You haven't even put off your helmet and handed your sword to the guards as you are stopped by one of Augusta's servants."
  +" She heard of your arrival in Rome and wants to speak with you immediately.",
  "none", [
  (set_background_mesh, "mesh_pic_palast"),
  ],[
    ("option_1", [],"Follow the servant.",[
      (troop_set_slot, "trp_global_variables", g_poppaea_event_chain, 1),
      (modify_visitors_at_site, "scn_imperial_palace_augusta_room"),
      (reset_visitors),
      (set_jump_mission, "mt_special_mission_poppaea_1"),
      (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_special_mission_poppaea_1", 2, 0),
          (mission_tpl_entry_set_override_flags, "mt_special_mission_poppaea_1", 2, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 3, "trp_kingdom_7_lady_1"),
      (jump_to_scene, "scn_imperial_palace_augusta_room"),
      (change_screen_mission),
    ]),
    ("option_2", [],"Tell the servent you have no time.",[
      (troop_set_slot, "trp_global_variables", g_poppaea_event_chain, 2),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_1", -20),
      (jump_to_menu, "mnu_town"),
    ]),
]),

("poppaea_event_chain_final",0,
  "You haven't even put off your helmet and handed your sword to the guards as you are stopped by one of Augusta's servants."
  +" She heard of your arrival in Rome and wants to speak with you immediately.",
  "none", [
  (set_background_mesh, "mesh_pic_palast"),
  ],[
    ("option_1", [],"Follow the servant.",[
      (assign, "$temp1", "itm_roman_noble_dress_2"),
      (troop_set_slot, "trp_global_variables", g_poppaea_event_chain, 3),
      (modify_visitors_at_site, "scn_imperial_palace_augusta_room"),
      (reset_visitors),
      (set_jump_mission, "mt_special_mission_poppaea_1"),
      (try_begin),#second outift
          (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
          (call_script, "script_init_second_outfit", "mt_special_mission_poppaea_1", 2, 0),
          (mission_tpl_entry_set_override_flags, "mt_special_mission_poppaea_1", 2, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 0, "trp_player"),
      (set_visitor, 3, "trp_kingdom_7_lady_1"),
      (jump_to_scene, "scn_imperial_palace_augusta_room"),
      (change_screen_mission),
    ]),
    ("option_2", [],"Tell the servent you have no time.",[
      (troop_set_slot, "trp_global_variables", g_poppaea_event_chain, 4),
      (call_script, "script_change_player_relation_with_troop", "trp_kingdom_7_lady_1", -50),
      (jump_to_menu, "mnu_town"),
    ]),
]),

("year_of_four_ceasars",0,
  "The four Ceasars!^^Nero's popularity among the Roman nobility and senators has been on the decline for some time, emboldening his opposition. Latest reports from Gallia Lugdunensis suggest that local elites may now be disobeying Nero and refusing to pay him taxes. ^^Furthermore, they are calling on the governor of Hispania Tarraconensis to join Gaul in rebellion and declare himself Imperator in opposition to Nero.^^There have also been rumblings in the Senate, where Nero's opponents are mustering support against him. Rumors are circulating about an important vote coming up.^^Finally, Nero's enemies in Rome moved against him politically. With enough votes in the Senate, they officially declared him a public enemy and instructed the Praetorian Guard to place Nero under arrest.^^Though Nero, fearing to be murdered, escaped from Rome together with most loyal servants and committed suicide.^^Yet Galba, Otho, Vitellius and Vespasian are rising to the leaders of their respective parties and proclaim themselves Caesar.",
  "none", [
    (set_background_mesh, "mesh_pic_palast"),
  ],[
    ("option_2", [
      (eq, "$players_kingdom", "fac_kingdom_7"),
    ],"Join Vitellius.",[
      (call_script, "script_start_year_of_four", "fac_kingdom_26"),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("option_2", [
      (eq, "$players_kingdom", "fac_kingdom_7"),
    ],"Join Galba.",[
      (call_script, "script_start_year_of_four", "fac_kingdom_27"),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("option_2", [
      (eq, "$players_kingdom", "fac_kingdom_7"),
    ],"Join Otho.",[
      (call_script, "script_start_year_of_four", "fac_kingdom_24"),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("option_2", [
      (eq, "$players_kingdom", "fac_kingdom_7"),
    ],"Join Vespasian.",[
      (call_script, "script_start_year_of_four", "fac_kingdom_25"),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("option_2", [
      (eq, "$players_kingdom", "fac_kingdom_7"),
    ],"Remain neutral.",[
      (call_script, "script_start_year_of_four", -1),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
    ("option_1", [
      (neq, "$players_kingdom", "fac_kingdom_7"),
    ],"Continue.",
    [
      (call_script, "script_start_year_of_four", -1),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("civil_war_start",0,
  "The Caesars prepared their legions for war. The battle field will decide the fade of Rome!",
  "none", [
      (troop_set_slot, "trp_global_variables", g_civil_war_timer, -1),
    ##(set_background_mesh, "mesh_pic_charge"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 57),
      (position_set_y, pos0, 17),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_civil_war_factions", 0, pos0),
      (play_sound, "snd_message_negative_sound"),
  ],[
    ("option_1", [
    ],"Continue.",[
      (try_for_range, ":faction_1", kingdoms_begin, kingdoms_end),
          (faction_slot_eq, ":faction_1", slot_faction_state, sfs_active),
          (faction_slot_eq, ":faction_1", slot_faction_culture, "fac_culture_7"),
          (try_for_range, ":faction_2", kingdoms_begin, kingdoms_end),
              (faction_slot_eq, ":faction_2", slot_faction_state, sfs_active),
              (faction_slot_eq, ":faction_2", slot_faction_culture, "fac_culture_7"),
              (neq, ":faction_1", ":faction_2"),
              (store_relation, ":relation", ":faction_1", ":faction_2"),
              (ge, ":relation", 0),
              (call_script, "script_diplomacy_start_war_between_kingdoms", ":faction_1", ":faction_2", logent_faction_declares_war_to_end_civil_war),
          (try_end),
      (try_end),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("end_civil_war",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "End of the civil war^^{s22} has defeated his rivals and finally is declared Caesar Augustus.",
  "none",[
    (faction_get_slot, ":leader", "$g_notification_menu_var1", slot_faction_leader),
    (str_store_troop_name_plural, s22, ":leader"),
    (set_background_mesh, "mesh_pic_triumph"),

    (set_fixed_point_multiplier,100),
    (position_set_x,pos0,65),			#left/right movement ( 0 = left edge of screen)
    (position_set_y,pos0,3),			#up/down movement ( 0 = bottom edge of screen)
    (position_set_z,pos0,80),			#in/out movement  (0 = no image, higher #'s make it larger)
    (set_game_menu_tableau_mesh,"tableau_troop_note_mesh",":leader",pos0),
  ],[
    ("answere_1",[],"Continue.",[
      (call_script, "script_end_civil_war", "$g_notification_menu_var1"),
      (change_screen_map),
    ]),
]),

("asket",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You spend several days together with the ascetic. During day you help him cutting wood and gathering resources, while at the evening and during the night he teaches you his knowledge. He has studied the animals living in Caucasian mountains, the plants and trees, but also the movement of the stars.^^One night the sky was clear and you where sitting together with him on a meadow not far from his hut. He showed how one can spot the movement of the stars and explained you that the stars are not fixed but in constant movement. But not only that, he also explained you that the world as total is in movement. Everything is in a constant flow. Humans as well as animals, are constantly born and die. They may build houses, but soon they are destroyed. They may found an empire, but soon it will fall apart. Even the greatest king is sooner or later forgotten. Some people may be remembered for thousands of years, but, as the ascetic says, it is nothing compared to the age of the world.^^The days passes and your knowledge increases.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("answere_1",[],"Continue.",[
      (add_xp_as_reward, 5000),
      (troop_raise_attribute, "trp_player", ca_intelligence, 1),
      (change_screen_map),
      (rest_for_hours, 24 * 3, 16, 0), #rest while no attackable
    ]),
]),

("slave_revlot_failed",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You have failed your task to defeat the slave revolt. Albus and his slaves raided Italy for months until they were killed by local troops.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("answere_1",[],"Continue.",[
      (try_for_parties, ":party"),
        (party_is_active, ":party"),
        (gt, ":party", last_static_party),
        (party_stack_get_troop_id, ":party_leader", ":party", 0),
        (eq, ":party_leader", "trp_albus"),
        (call_script, "script_destroy_party", ":party"),
      (try_end),
      (call_script, "script_change_player_honor", -15),
      (call_script, "script_change_troop_renown", "trp_player", -50),
      (change_screen_map),
    ]),
]),

("treason",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "{s7}",
  "none",[
    (set_background_mesh, "mesh_pic_kreuzigung"),
    (try_begin),
        (faction_slot_eq, "$players_kingdom", slot_faction_government_type, gov_imperial),
        (str_store_string, s7, "@Praetorian guards approach.^^They take you prisoner. The indictment is read and you are found guilty. You are sentenced to death by crucifixion."),
    (else_try),
        (str_store_string, s7, "@Guards of the king approach.^^They take you prisoner. The indictment is read and you are found guilty. You are sentenced to death by cutting of your head with a sword."),
    (try_end),
  ],[
    ("answere_1",[],"Death waits...",[
      (assign, "$temp", 0),
      (jump_to_menu, "mnu_death_waits"),
    ]),
]),

("vitellius_victory",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Thanatos, the somber deity, approaches you, with his cold touch. He brings your soul to Hades' realm, where the River Styx whispers its mournful lament."
  +"^^In the year 2020, the following text about the so called 'year of four Emperors' can be found in an average history book:"
  "^^According to Tacitus, Vitellius proved himself to be a visionary ruler. He embarked on a period of renaissance, promoting art, literature, and philosophy."
  +" He invested heavily in the empire's infrastructure, enhancing trade and communication routes to foster economic prosperity."
  +" Vitellius' administration was marked by justice and fairness, and he surrounded himself with wise counselors, seeking to bridge the divides that had plagued Rome in the past."
  "^^Historians discuss until today whether it is true or Vitellian propaganda.",
  "none",[
    (set_background_mesh, "mesh_pic_kreuzigung"),
  ],[
    ("answere_1",[],"Death waits...",[
      (assign, "$temp", 0),
      (jump_to_menu, "mnu_death_waits"),
    ]),
]),

("otho_victory",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Thanatos, the somber deity, approaches you, with his cold touch. He brings your soul to Hades' realm, where the River Styx whispers its mournful lament."
  +"^^In the year 2020, the following text about the so called 'year of four Emperors' can be found in an average history book:"
  "^^According to Tacitus, Otho proved himself to be a visionary ruler. He embarked on a period of economic growth, promoting art, literature, and philosophy."
  +" He invested heavily in the empire's infrastructure, enhancing trade and communication routes to foster economic prosperity."
  +" Otho' administration was marked by justice and fairness, and he surrounded himself with wise counselors, seeking to bridge the divides that had plagued Rome in the past."
  "^^Historians discuss until today whether it is true or Othonian propaganda.",
  "none",[
    (set_background_mesh, "mesh_pic_kreuzigung"),
  ],[
    ("answere_1",[],"Death waits...",[
      (assign, "$temp", 0),
      (jump_to_menu, "mnu_death_waits"),
    ]),
]),
##############################

("toilet_talk_tavern",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Laughter spills through the narrow streets as you navigate the bustling city together. The camaraderie grows with each step, forging unexpected bonds in the unlikeliest of places."
  +" Through winding alleys and animated chatter, the tavern's glow beckons. The shared adventure, born from a toilet encounter, transforms into a memorable night."
  +" Amidst clinking cups and shared tales, you realize that the most vibrant connections can arise from the most peculiar beginnings.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("answere_1",[],"Continue...",[
      (add_xp_as_reward, 1000),
      (set_jump_mission, "mt_toiletboys"),
      (modify_visitors_at_site, "scn_shitty_tavern"),
      (reset_visitors),

      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_toiletboys", 0, 0),
        (mission_tpl_entry_set_override_flags, "mt_toiletboys", 0, af_override_outfit_1|af_override_horse),
      (try_end),
      (set_visitor, 0, "trp_player"),

      (set_visitor, 1, "trp_romanian"),
      (set_visitor, 2, "trp_spaniard"),
      (set_visitor, 3, "trp_dominican"),

      (jump_to_scene, "scn_shitty_tavern"),
      (change_screen_mission),
    ]),
]),

("toilet_tavern_escape",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "In the dim-lit tavern, Tiganu Tate, Heidus, and Pyromaniacus share a boisterous evening with you. As laughter echoes, the realization dawns - empty pockets all around."
  +" A mischievous plan forms, and the trio bolts, leaving you to grapple with unpaid bills. Caught in their wake, you reluctantly settle the debt, watching the escapade unfold with a mix of annoyance and bemusement."
  +" The misadventure becomes a testament to the unpredictability of camaraderie, where shared moments blend mischief and exasperation, forever etched in the tavern's memories and your wallet's dwindling contents.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("answere_1",[],"Continue...",[
      (troop_set_slot, "trp_global_variables", g_toilet_talk, -7),#retards escaped, player had to pay the bill
      (troop_remove_gold, "trp_player", 2000),
      (jump_to_menu, "mnu_town"),
    ]),
]),

("toilet_tavern_leave",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Amidst raucous laughter and empty tankards, Tiganu Tate, Heidus, and Pyromaniacus find themselves penniless in the tavern."
  +" Reluctantly, you shoulder the burden, settling their bills. Tiganu Tate, ever the provocateur, suggests a visit to a brothel, but you refuse."
  +" With a shake of the head, you part ways, the camaraderie tinged with the realization that shared revelry doesn't always mean shared responsibility."
  +" As the tavern's warmth fades behind you, the night unfolds into separate paths, leaving echoes of camaraderie and a slightly lighter coin purse in your wake.",
  "none",[
    (set_background_mesh, "mesh_pic_orgie"),
  ],[
    ("answere_1",[],"Continue...",[
      (troop_set_slot, "trp_global_variables", g_toilet_talk, -8),#left tavern without any
      (troop_remove_gold, "trp_player", 2000),
      (jump_to_menu, "mnu_town"),
    ]),
]),

("toilet_tavern_go",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Amidst the flickering tavern lights, pockets lighter than spirits, Tiganu Tate, Heidus, and Pyromaniacus face unpaid bills. As coins change hands, you shoulder the cost of revelry."
  +" In the ensuing dilemma, Tiganu Tate, ever mischievous, suggests a diversion to a brothel. A shared glance and a smirk later, you find yourselves navigating the labyrinthine streets toward a different kind of indulgence."
  +" The night unfolds with laughter and whispers, the tavern's financial shadow eclipsed by the fleeting allure of clandestine encounters. You walk under the moonlit through streets."
  +" Finally, you find a suitable location. ",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("answere_1",[],"Continue...",[
      (add_xp_as_reward, 1000),
      (set_jump_mission, "mt_toiletboys"),
      (modify_visitors_at_site, "scn_shitty_tavern"),
      (reset_visitors),

      (try_begin),#second outift
        (call_script, "script_cf_player_use_second_outfit"),#is using second outfit?
        (call_script, "script_init_second_outfit", "mt_toiletboys", 5, 0),
        (mission_tpl_entry_set_override_flags, "mt_toiletboys", 5, af_override_outfit_1|af_override_horse),
      (try_end),

      (set_visitor, 5, "trp_player"),

      (set_visitor, 6, "trp_romanian"),
      (set_visitor, 7, "trp_spaniard"),
      (set_visitor, 8, "trp_dominican"),

      (set_visitor, 9, "trp_whore"),

      (jump_to_scene, "scn_shitty_tavern"),
      (change_screen_mission),
    ]),
]),

("toilet_tavern_victory",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "In the dim-lit tavern, laughter intertwines with the scent of ale, but your merriment is short-lived as the realization dawns - empty pockets all around."
  +" Tiganu Tate, Heidus, and Pyromaniacus eye the exit, hatching a plan to escape unpaid bills. Your conscience intervenes, and with a firm fist, you halt their retreat."
  +" You leave the tavern, while the tavernkeeper squeezes out the unpaid bills.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("answere_1",[],"Continue...",[
      (jump_to_menu, "mnu_town"),
      (troop_set_slot, "trp_global_variables", g_toilet_talk, -9),#tavern fight end
    ]),
]),

("toilet_brothel_escape",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Instinctively, you decide to leave the prostitute behind and quickly find an escape route. Amidst the chaos, you slip away, the echoing sounds of the scuffle fading behind."
  +" The narrow alleys provide a fleeting refuge as you navigate the labyrinthine streets, leaving behind the unsettling scene in the brothel."
  +" The night, which started with shared camaraderie, now lingers as a haunting memory, the shadows of betrayal staining the unexpected escapade in the city's clandestine quarters."
  +"^^The fate of the prostitute is unknown to you.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("answere_1",[],"Continue...",[
      (add_xp_as_reward, 500),
      (jump_to_menu, "mnu_town"),
      (troop_set_slot, "trp_global_variables", g_toilet_talk, -11),#escape
    ]),
]),

("toilet_brothel_victory",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Amidst the dimly lit haze of the brothel, the night takes a dark turn as Tiganu Tate, Heidus, and Pyromaniacus descend into chaos, their wild revelry turning into a violent storm."
  +" The air crackles with aggression, and in a sudden surge of chaos, they target you and the vulnerable prostitute. Fueled by instinct and a surge of protective empathy, you face the aggressors head-on."
  +" The brawl ensues, a collision of fists and desperation in the confined space.^^As the dust settles, Tiganu Tate, Heidus, and Pyromaniacus lie defeated, subdued by your defense."
  +" In the quiet aftermath, your attention turns to the prostitute, who bears witness to a lifetime of hardship etched in her eyes. Unused to kindness, she gazes at you with a mix of surprise and gratitude."
  +" For the first time, someone has intervened, offering protection in a world that had only shown cruelty. The brothel's dim corners witness a fleeting alliance, a moment where an unexpected defender emerges in the midst of shadows,"
  +" breaking the cycle of a harsh and unyielding life. But only for a brief moment. Soon the next drunken 'customer' will appear...",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("answere_1",[],"Continue...",[
      (add_xp_as_reward, 2500),
      (jump_to_menu, "mnu_town"),
      (troop_set_slot, "trp_global_variables", g_toilet_talk, -10),#victory
    ]),
]),

("toilet_brothel_defeat",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "In the shadowy realm of the brothel, the night spirals into chaos as Tiganu Tate, Heidus, and Pyromaniacus succumb to a frenzy, their revelry turning into violent madness."
  +" You stand as the defender of the vulnerable prostitute, determined to shield her from the storm. However, the odds tip against you, and the three assailants overwhelm your defense."
  +" Fists fly, desperation reigns, and despite your best efforts, you and the downtrodden companion succumb to the onslaught.^^As the tumult settles, the dim-lit room bears witness to a disheartening scene"
  +" - you defeated, the prostitute battered, and the atmosphere tainted by the brutality of the encounter. The aftermath hangs heavy in the air, a reminder of the vulnerability that sometimes accompanies"
  +" defiance in the unforgiving corners of Rome's shady quarters.",
  "none",[
    (set_background_mesh, "mesh_pic_party"),
  ],[
    ("answere_1",[],"Continue...",[
      (add_xp_as_reward, 1250),
      (jump_to_menu, "mnu_town"),
      (troop_remove_gold, "trp_player", 2000),
      (troop_set_slot, "trp_global_variables", g_toilet_talk, -12),#brothel defeat
    ]),
]),

("werdheri_fight",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You wait until evening.^^Under the looming gates of Kalissia, you and Werdheri stride purposefully into the shadowed forest. The moonlit path unfolds as you venture towards the imminent clash. The rustling leaves amplify the anticipation. With each step, Werdheri's silent assurance fuels your resolve. The distant murmur of 200 bandits awaits, yet your alliance is an unyielding force against the impending threat. The town behind, the destiny ahead, you and Werdheri vanish into the depths, the pulse of valour echoing in the night.",
  "none",[
    (set_background_mesh, "mesh_pic_cave"),
  ],[
    ("answere_1",[],"Continue...",[
      # 0, 1 player, werdheri
      # 2 to 43 enemies
      (add_xp_as_reward, 1000),
      (set_jump_mission, "mt_werdheri_battle_lair"),
      (modify_visitors_at_site, "scn_werdheri_bandit_lair"),
      (reset_visitors),

      (set_visitor, 44, "trp_player"),
      (set_visitor, 1, "trp_werdheri"),

      (set_visitors, 2, "trp_looter", 3),
      (set_visitors, 3, "trp_looter", 3),
      (set_visitors, 4, "trp_bandit", 2),
      (set_visitors, 5, "trp_looter", 3),
      (set_visitors, 6, "trp_looter", 3),
      (set_visitors, 7, "trp_looter", 2),
      (set_visitors, 8, "trp_germanic_hunter", 3),
      (set_visitors, 9, "trp_looter", 2),
      (set_visitors, 10, "trp_bandit", 2),
      (set_visitors, 11, "trp_looter", 2),
      (set_visitors, 12, "trp_looter", 2),
      (set_visitors, 13, "trp_germanic_hunter", 3),
      (set_visitors, 14, "trp_looter", 2),
      (set_visitors, 15, "trp_bandit", 3),
      (set_visitors, 16, "trp_looter", 3),
      (set_visitors, 17, "trp_bandit", 2),
      (set_visitors, 18, "trp_bandit", 2),
      (set_visitors, 19, "trp_looter", 2),
      (set_visitors, 20, "trp_germanic_hunter", 2),
      (set_visitors, 21, "trp_looter", 2),
      (set_visitors, 22, "trp_looter", 3),
      (set_visitors, 23, "trp_bandit", 2),
      (set_visitors, 24, "trp_looter", 2),
      (set_visitors, 25, "trp_germanic_hunter", 2),
      (set_visitors, 26, "trp_looter", 2),
      (set_visitors, 27, "trp_looter", 3),
      (set_visitors, 28, "trp_bandit", 2),
      (set_visitors, 29, "trp_brigand", 2),
      (set_visitors, 30, "trp_looter", 3),
      (set_visitors, 31, "trp_looter", 3),
      (set_visitors, 32, "trp_bandit", 2),
      (set_visitors, 33, "trp_looter", 3),
      (set_visitors, 34, "trp_brigand", 2),
      (set_visitors, 35, "trp_looter", 3),
      (set_visitors, 36, "trp_looter", 3),
      (set_visitors, 37, "trp_germanic_nightwarrior", 2),
      (set_visitors, 38, "trp_looter", 3),
      (set_visitors, 39, "trp_brigand", 2),
      (set_visitors, 40, "trp_germanic_nightwarrior", 2),
      (set_visitors, 41, "trp_germanic_nightwarrior", 2),
      (set_visitors, 42, "trp_looter", 2),
      (set_visitors, 43, "trp_germanic_nightwarrior", 2),

      (jump_to_scene, "scn_werdheri_bandit_lair"),
      (change_screen_mission),
    ]),
]),

("werdheri_fight_alone",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Werdheri, the Germanic warrior, a solitary tempest, storms into the bandit's lair with an aura of unyielding determination. His eyes ablaze, a reflection of ancient valor, he moves with calculated grace through the shadows."
  +" The air crackles as his sword clashes against the lawless horde. A lone wolf amidst the chaos, Werdheri's strength and skill weave through the bandit ranks."
  +" The cavern echoes with the symphony of battle, his every strike a testament to the indomitable spirit of a warrior facing insurmountable odds."
  +" Against the backdrop of flickering torchlight, Werdheri stands resolute, an unyielding force against the tide of bandits, carving his legacy into the heart of the lair.",
  "none",[
    (set_background_mesh, "mesh_pic_cave"),
  ],[
    ("answere_1",[],"Continue...",[
      (jump_to_menu, "mnu_town"),
    ]),
]),

("werdheri_duel",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "You have now the choice to either run away or take the challenge.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("answere_1",[],"Wait until evening.",[
      (quest_set_slot, "qst_werdheri", slot_quest_current_state, 2),#orm quest
      (jump_to_menu, "mnu_duel"),
    ]),
    ("answere_1",[],"Leave.",[
      (jump_to_menu, "mnu_town"),
      (call_script, "script_fail_quest", "qst_werdheri"),
      (call_script, "script_end_quest", "qst_werdheri"),
      (call_script, "script_change_player_honor", -25),
      (call_script, "script_change_troop_renown", "trp_player", -100),
    ]),
]),

("werdheri_duel_lost",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "As the battle unfolded, you faced Werdheri, a formidable Germanic warrior with a fierce determination in his eyes. The clash of steel resonated in the air as you engaged in a duel, skill against skill, strength against strength. Werdheri's movements were swift and calculated, his blade dancing with lethal precision. Despite your best efforts, the tide turned against you. A powerful swing of Werdheri's sword caught you off guard, and the impact resonated through your body. Stumbling backward, you tried to regain your composure, but Werdheri seized the opportunity. With a swift, decisive strike, his blade found its mark, and you fell to the ground, defeated. The world blurs.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("answere_1",[],"Death waits.",[
      (call_script, "script_fail_quest", "qst_werdheri"),
      (call_script, "script_end_quest", "qst_werdheri"),
      (add_xp_as_reward, 1000),
      (assign, "$temp", 0),
      (jump_to_menu, "mnu_death_waits"),
    ]),
]),

("werdheri_duel_won",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "With a swift and calculated strike, your sword clashes against Werdheri's, the clash echoing through the ancient forest. Werdheri, the formidable Germanic warrior, fights with ferocity and skill, but you anticipate his moves, finding openings in his defense. The duel is a dance of blades under the canopy of ancient trees.^^In a moment of decisive action, you feint to one side and swiftly change your attack angle. Werdheri, caught off guard, attempts to parry, but your blade finds its mark. The clash resonates one final time as Werdheri's weapon is knocked from his grasp and you blade penetrates his chest. Victory is yours, and the forest bears witness to your triumph.",
  "none",[
    (set_background_mesh, "mesh_pic_deserters"),
  ],[
    ("answere_1",[],"Continue...",[
      (jump_to_menu, "mnu_auto_return_map"),
      (call_script, "script_change_troop_renown", "trp_player", 25),
      (add_xp_as_reward, 5000),
      (call_script, "script_end_quest", "qst_werdheri"),
      (troop_add_gold, "trp_player", 2500),
    ]),
]),

("werdheri_lost",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "In the bandit-infested lair, the clash unfolds like a tempest. You and Werdheri, outnumbered but resolute, face the relentless tide."
  +" The echo of clashing steel fills the cavern as you fight valiantly side by side. Despite your fierce defense, overwhelming numbers prevail."
  +" Exhaustion sets in, and with Werdheri at your side, you succumb to the relentless onslaught. The bandits, victorious, claim the darkness."
  +" In the final moments, you find solace in the shared courage, a fleeting echo in the cavern's depths.",
  "none",[
    (set_background_mesh, "mesh_pic_cave"),
  ],[
    ("answere_1",[],"Continue...",[
      (call_script, "script_fail_quest", "qst_werdheri"),
      (call_script, "script_end_quest", "qst_werdheri"),
      (add_xp_as_reward, 1000),
      (assign, "$temp", 0),
      (jump_to_menu, "mnu_death_waits"),
    ]),
]),

("werdheri_won",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "In the heart of the bandit's lair, a symphony of battle ensues. With Werdheri by your side, an indomitable force, you both dance amidst chaos."
  +" The clash of steel resonates against the cavern walls as unity prevails over the marauding horde. Strategic prowess and unwavering resolve turn the tide."
  +" Together, you and Werdheri carve a path through the bandits, their defeat echoing in the lair's depths."
  +" Amidst the fading tumult, victorious breaths are drawn, the lair now silent, marked by the valor of two against the many.",
  "none",[
    (set_background_mesh, "mesh_pic_cave"),
  ],[
    ("answere_1",[],"Continue...",[
      (call_script, "script_end_quest", "qst_werdheri"),
      (quest_set_slot, "qst_werdheri", slot_quest_current_state, 6),
      (add_xp_as_reward, 5000),
      (call_script, "script_setup_troop_meeting", "trp_werdheri", -1, "scn_werdheri_bandit_lair"),
    ]),
]),

("triumph_awared_emperor",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Triumph!^^{s15} has earned his name while leading campaigns and the senate wants to grant him a triumph. You can, however, veto it using your consular authority.",
  "none",[
    (str_store_troop_name_plural, s15, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_triumph"),
  ],[
    ("answere_1",[],"Let {s15} have his triumph!",[
      (jump_to_menu, "mnu_triumph_awared_ai"),
    ]),
    ("answere_1",[],"Veto!",[
      (call_script, "script_change_player_relation_with_troop", "$g_notification_menu_var1", -75),
      (call_script, "script_change_relation_with_family_friends_enemies", "$g_notification_menu_var1", -1, 10, "trp_player"),
      (troop_set_slot, "$g_notification_menu_var1", slot_troop_triumph_points, 0),
      (call_script, "script_change_player_relation_with_center", "p_town_6", -5),
      (jump_to_menu, "mnu_triumph_awared_ai"),
    ]),
]),

("triumph_awared_ai",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Triumph!^^^A messenger informs you about following decree issued by the senate and the Princeps:"
  +"^^Citizens of Rome,^We are honored to announce that {s15} has been awarded a triumph for his exceptional valor and leadership in recent military campaigns."
  +" This prestigious recognition is a testament to {s15}'s unwavering dedication and outstanding achievements in service to Rome."
  +" The Senate and the People of Rome have decreed that a grand procession shall be held to celebrate this momentous occasion."
  +"^Ave Imperator!",
  "none",[
    (str_store_troop_name_plural, s15, "$g_notification_menu_var1"),
    (set_background_mesh, "mesh_pic_triumph"),
  ],[
    ("answere_1",[],"Continue...",[
      (call_script, "script_troop_holds_triumph", "$g_notification_menu_var1"),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("triumph_awared_player",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "Triumph!^^A messenger informs you that a triumph is awarded to you in your name. Travel to Rome at your earliest convenience to claim your triumph",
  "none",[
    (set_background_mesh, "mesh_pic_messenger"),
  ],[
    ("answere_1",[],"Continue...",[
      (setup_quest_text, "qst_triumph"),
      (str_store_party_name_link, s25, "p_town_6"),
      (str_store_string, s2, "@A triumph has been awarded to you. Travel to {s25}."),
      (call_script, "script_start_quest", "qst_triumph", "trp_fortuna"),
      (jump_to_menu, "mnu_auto_return_map"),
    ]),
]),

("prophecy_final",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "As you stand there, inhaling the sweet, intoxicating scent of the underwear, something begins to change in the air. At first, it's subtle—a warm, almost pleasant sensation creeping over your skin. But as the minutes pass, the smell grows stronger, more overpowering, filling your lungs with each breath you take."
  +"^^Bassus, too, seems entranced by the aroma. His eyes are wide, pupils dilated, as he waves his hands in front of his face, trying to push the scent away, but it's no use. He seems almost... lost in it now, his expression slack, his movements erratic. He calls for the slaves, urging them to come closer, but as they step forward, the haze of the fragrance deepens around them."
  +"^^The slaves, too, begin to falter. At first, they stumble toward the smell with curiosity, but soon their faces grow pale, their bodies swaying, as if the air itself is clouding their minds. You can hear them muttering, almost incoherently, as the scent begins to drown out everything else.",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
  ],[
    ("answere_1",[],"Continue...",[
      (jump_to_menu, "mnu_prophecy_final_2"),
    ]),
]),

("prophecy_final_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The haze, once faint, now thickens, wrapping around all of you like a fog. The once-clear air is now dense, oppressive, and suffocating. Each breath becomes harder, your thoughts more muddled, as if the fragrance is weaving itself into your very soul, twisting your perception. You can barely see past the smoke-like fog anymore, and the world around you blurs."
  +"^^Bassus suddenly begins to laugh, an eerie, unsettling sound. It's not the usual joyful laugh, but something manic, tinged with madness. 'It is... it is perfect!', he exclaims, but it's hard to tell if he's speaking to anyone in particular or just to himself. His hands claw at his face, as if trying to remove an invisible mask, but the scent only grows stronger."
  +"^^The slaves, now clearly lost in their dazed stupor, collapse to their knees, mumbling prayers and incoherent words. One of them starts to giggle uncontrollably, their face twisted with delirium.",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
  ],[
    ("answere_1",[],"Continue...",[
      (jump_to_menu, "mnu_prophecy_final_3"),
    ]),
]),

("prophecy_final_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
  "The smell... it's suffocating now. Your thoughts are clouded, your vision is narrowing. It's as if your mind is slipping away with each breath. What was once a simple scent has become something far more sinister, a force that bends your will and distorts your reality. All around you, the madness grows, pulling you deeper into its grasp."
  +"^^Bassus's voice rings out again, louder this time, but it sounds distant, as though he's speaking from another world entirely. 'We're... we're chosen!', he screams. 'The gods have found us! We will be their priests, their servants...' His words are fractured, growing less coherent with each passing second."
  +"^^And then, as if on cue, the haze reaches its peak, and everything fades to black. The world is swallowed by the overwhelming scent, and your mind finally surrenders to the madness.",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
  ],[
    ("answere_1",[],"Continue...",[
      # (jump_to_menu, "mnu_prophecy_final_4"),

      (set_jump_mission, "mt_explore_carthage"),
      (modify_visitors_at_site, "scn_ruins_of_carthage"),
      (reset_visitors),
      (quest_set_slot, "qst_prophecy_of_caeselius_bassus", slot_quest_current_state, 12),
      (set_visitor, 5, "trp_player"),
      (set_visitor, 3, "trp_african_myth_hero_4"),

      (jump_to_scene, "scn_ruins_of_carthage"),
      (change_screen_mission),
    ]),
]),

("prophecy_final_4",menu_text_color(0xFF000000)|mnf_disable_all_keys,
"You awaken slowly, your mind heavy and muddled as though emerging from a deep fog. The oppressive haze that consumed you is gone, and so is Hannibal. As your senses return, you notice Bassus kneeling before you."
+" His nose is bloodied, his face mottled with bruises, and his expression one of profound guilt. He stammers out apologies, his voice trembling with shame and regret."
+"^^Pain courses through your body like a relentless tide. Your hands throb, raw and scraped, evidence of some forgotten struggle. It's only then that you realize your surroundings have changed."
+" The ruins of Carthage are nowhere in sight. Instead, you find yourself in the quiet, cool confines of the governor's palace.",
  "none",[
    (set_background_mesh, "mesh_pic_omen_bird"),
  ],[
    ("answere_1",[],"Continue...",[
      (assign, "$temp1", 4),
      (assign, "$temp2", "trp_town_28_seneschal"),
      (party_get_slot, ":castle_scene", "$g_encountered_party", slot_town_castle),
      (quest_set_slot, "qst_prophecy_of_caeselius_bassus", slot_quest_current_state, 14),
      (set_jump_mission, "mt_conversation_generic"),
      (modify_visitors_at_site, ":castle_scene"),
      (reset_visitors),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 16, af_override_weapons|af_override_horse|af_override_head),
      (set_visitor, 16, "trp_player"),
      (mission_tpl_entry_set_override_flags, "mt_conversation_generic", 17, af_override_weapons|af_override_horse|af_override_head),
      (set_visitor, 17, "trp_statthalter_new_12"),
      (set_visitor, 33, "trp_town_28_seneschal"),
      (jump_to_scene, ":castle_scene"),
      (change_screen_mission),
    ]),
]),
]#end of file